# Director's Console - Docker Compose Configuration
# Usage: docker-compose up -d
#
# PROJECT FOLDERS:
# To access your projects, set the PROJECTS_PATH environment variable:
#   Windows:  set PROJECTS_PATH=Z:\Python\DirectorsConsole\Projects
#   Linux:    export PROJECTS_PATH=/mnt/nas/Python/DirectorsConsole/Projects
# Then run: docker-compose up -d
#
# Or edit the volumes section below directly.

services:
  # Cinema Prompt Engineering (Backend + Frontend)
  cpe:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: directors-console-cpe
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
      - CPE_API_PORT=8000
    volumes:
      # Persist templates and data
      - cpe-data:/app/data
      - cpe-templates:/app/templates
      
      # === PROJECT FOLDERS ===
      # Edit these paths to match your drives from Docker Desktop File Sharing
      - "V:/:/projects/nas1"
      - "W:/:/projects/nas2"
      - "Y:/:/projects/nas3"
      - "Z:/:/projects/nas4"
      
      # Mount local templates for development (optional)
      # - ./CinemaPromptEngineering/templates_system:/app/templates_system:ro
    networks:
      - directors-console
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Orchestrator (ComfyUI Job Manager) - OPTIONAL
  # Note: The UI's Node Manager saves nodes to browser localStorage and connects
  # directly to ComfyUI. You don't need Orchestrator unless you want job queuing.
  orchestrator:
    build:
      context: .
      dockerfile: Dockerfile.orchestrator
    container_name: directors-console-orchestrator
    ports:
      - "8020:8020"
    environment:
      - PYTHONUNBUFFERED=1
      - ORCHESTRATOR_PORT=8020
      # Only needed if using Orchestrator job queuing (optional):
      # - COMFY_NODES=192.168.1.100:8188,192.168.1.101:8188
    volumes:
      # Persist orchestrator data
      - orchestrator-data:/app/data
      # Job inbox/outbox folders
      - orchestrator-inbox:/app/inbox
      - orchestrator-outbox:/app/outbox
      
      # === PROJECT FOLDERS (same as CPE) ===
      - "V:/:/projects/nas1"
      - "W:/:/projects/nas2"
      - "Y:/:/projects/nas3"
      - "Z:/:/projects/nas4"
      
      # Mount custom config (optional)
      # - ./Orchestrator/config.yaml:/app/config.yaml:ro
    networks:
      - directors-console
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8020/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  directors-console:
    driver: bridge

volumes:
  cpe-data:
  cpe-templates:
  orchestrator-data:
  orchestrator-inbox:
  orchestrator-outbox:
