var e,t,n,r,i,a,o,s,l,c,u,d,h,p,m,f,g,v,y,_,x,b,w,S,M,E,C,T,k,P,A,N,R,L,I,j,D,O,U,F,z,B,H,V,G,W,$,X,q,K,Y,Z,J,Q,ee,te,ne,re,ie,ae,oe,se,le,ce,ue,de,he,pe,me,fe,ge,ve,ye,_e,xe,be,we,Se,Me,Ee,Ce,Te,ke,Pe,Ae,Ne,Re,Le=Object.defineProperty,Ie=e=>{throw TypeError(e)},je=(e,t,n)=>((e,t,n)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),De=(e,t,n)=>t.has(e)||Ie("Cannot "+n),Oe=(e,t,n)=>(De(e,t,"read from private field"),n?n.call(e):t.get(e)),Ue=(e,t,n)=>t.has(e)?Ie("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Fe=(e,t,n,r)=>(De(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),ze=(e,t,n)=>(De(e,t,"access private method"),n),Be=(e,t,n,r)=>({set _(r){Fe(e,t,r,n)},get _(){return Oe(e,t,r)}});!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var He="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ge={exports:{}},We={},$e={exports:{}},Xe={},qe=Symbol.for("react.element"),Ke=Symbol.for("react.portal"),Ye=Symbol.for("react.fragment"),Ze=Symbol.for("react.strict_mode"),Je=Symbol.for("react.profiler"),Qe=Symbol.for("react.provider"),et=Symbol.for("react.context"),tt=Symbol.for("react.forward_ref"),nt=Symbol.for("react.suspense"),rt=Symbol.for("react.memo"),it=Symbol.for("react.lazy"),at=Symbol.iterator;var ot={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},st=Object.assign,lt={};function ct(e,t,n){this.props=e,this.context=t,this.refs=lt,this.updater=n||ot}function ut(){}function dt(e,t,n){this.props=e,this.context=t,this.refs=lt,this.updater=n||ot}ct.prototype.isReactComponent={},ct.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ct.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},ut.prototype=ct.prototype;var ht=dt.prototype=new ut;ht.constructor=dt,st(ht,ct.prototype),ht.isPureReactComponent=!0;var pt=Array.isArray,mt=Object.prototype.hasOwnProperty,ft={current:null},gt={key:!0,ref:!0,__self:!0,__source:!0};function vt(e,t,n){var r,i={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)mt.call(t,r)&&!gt.hasOwnProperty(r)&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var l=Array(s),c=0;c<s;c++)l[c]=arguments[c+2];i.children=l}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return{$$typeof:qe,type:e,key:a,ref:o,props:i,_owner:ft.current}}function yt(e){return"object"==typeof e&&null!==e&&e.$$typeof===qe}var _t=/\/+/g;function xt(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function bt(e,t,n,r,i){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var o=!1;if(null===e)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case qe:case Ke:o=!0}}if(o)return i=i(o=e),e=""===r?"."+xt(o,0):r,pt(i)?(n="",null!=e&&(n=e.replace(_t,"$&/")+"/"),bt(i,t,n,"",function(e){return e})):null!=i&&(yt(i)&&(i=function(e,t){return{$$typeof:qe,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(_t,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=""===r?".":r+":",pt(e))for(var s=0;s<e.length;s++){var l=r+xt(a=e[s],s);o+=bt(a,t,n,l,i)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=at&&e[at]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),s=0;!(a=e.next()).done;)o+=bt(a=a.value,t,n,l=r+xt(a,s++),i);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function wt(e,t,n){if(null==e)return e;var r=[],i=0;return bt(e,r,"","",function(e){return t.call(n,e,i++)}),r}function St(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var Mt={current:null},Et={transition:null},Ct={ReactCurrentDispatcher:Mt,ReactCurrentBatchConfig:Et,ReactCurrentOwner:ft};function Tt(){throw Error("act(...) is not supported in production builds of React.")}Xe.Children={map:wt,forEach:function(e,t,n){wt(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return wt(e,function(){t++}),t},toArray:function(e){return wt(e,function(e){return e})||[]},only:function(e){if(!yt(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Xe.Component=ct,Xe.Fragment=Ye,Xe.Profiler=Je,Xe.PureComponent=dt,Xe.StrictMode=Ze,Xe.Suspense=nt,Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ct,Xe.act=Tt,Xe.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=st({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=ft.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(l in t)mt.call(t,l)&&!gt.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==s?s[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){s=Array(l);for(var c=0;c<l;c++)s[c]=arguments[c+2];r.children=s}return{$$typeof:qe,type:e.type,key:i,ref:a,props:r,_owner:o}},Xe.createContext=function(e){return(e={$$typeof:et,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:Qe,_context:e},e.Consumer=e},Xe.createElement=vt,Xe.createFactory=function(e){var t=vt.bind(null,e);return t.type=e,t},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(e){return{$$typeof:tt,render:e}},Xe.isValidElement=yt,Xe.lazy=function(e){return{$$typeof:it,_payload:{_status:-1,_result:e},_init:St}},Xe.memo=function(e,t){return{$$typeof:rt,type:e,compare:void 0===t?null:t}},Xe.startTransition=function(e){var t=Et.transition;Et.transition={};try{e()}finally{Et.transition=t}},Xe.unstable_act=Tt,Xe.useCallback=function(e,t){return Mt.current.useCallback(e,t)},Xe.useContext=function(e){return Mt.current.useContext(e)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(e){return Mt.current.useDeferredValue(e)},Xe.useEffect=function(e,t){return Mt.current.useEffect(e,t)},Xe.useId=function(){return Mt.current.useId()},Xe.useImperativeHandle=function(e,t,n){return Mt.current.useImperativeHandle(e,t,n)},Xe.useInsertionEffect=function(e,t){return Mt.current.useInsertionEffect(e,t)},Xe.useLayoutEffect=function(e,t){return Mt.current.useLayoutEffect(e,t)},Xe.useMemo=function(e,t){return Mt.current.useMemo(e,t)},Xe.useReducer=function(e,t,n){return Mt.current.useReducer(e,t,n)},Xe.useRef=function(e){return Mt.current.useRef(e)},Xe.useState=function(e){return Mt.current.useState(e)},Xe.useSyncExternalStore=function(e,t,n){return Mt.current.useSyncExternalStore(e,t,n)},Xe.useTransition=function(){return Mt.current.useTransition()},Xe.version="18.3.1",$e.exports=Xe;var kt=$e.exports;const Pt=Ve(kt);
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var At=kt,Nt=Symbol.for("react.element"),Rt=Symbol.for("react.fragment"),Lt=Object.prototype.hasOwnProperty,It=At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jt={key:!0,ref:!0,__self:!0,__source:!0};function Dt(e,t,n){var r,i={},a=null,o=null;for(r in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)Lt.call(t,r)&&!jt.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:Nt,type:e,key:a,ref:o,props:i,_owner:It.current}}We.Fragment=Rt,We.jsx=Dt,We.jsxs=Dt,Ge.exports=We;var Ot=Ge.exports,Ut={},Ft={exports:{}},zt={},Bt={exports:{}},Ht={};
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,h=3,p=!1,m=!1,f=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function x(e){if(f=!1,_(e),!m)if(null!==n(l))m=!0,R(b);else{var t=n(c);null!==t&&L(x,t.startTime-e)}}function b(t,i){m=!1,f&&(f=!1,v(E),E=-1),p=!0;var a=h;try{for(_(i),d=n(l);null!==d&&(!(d.expirationTime>i)||t&&!k());){var o=d.callback;if("function"==typeof o){d.callback=null,h=d.priorityLevel;var s=o(d.expirationTime<=i);i=e.unstable_now(),"function"==typeof s?d.callback=s:d===n(l)&&r(l),_(i)}else r(l);d=n(l)}if(null!==d)var u=!0;else{var g=n(c);null!==g&&L(x,g.startTime-i),u=!1}return u}finally{d=null,h=a,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,S=!1,M=null,E=-1,C=5,T=-1;function k(){return!(e.unstable_now()-T<C)}function P(){if(null!==M){var t=e.unstable_now();T=t;var n=!0;try{n=M(!0,t)}finally{n?w():(S=!1,M=null)}}else S=!1}if("function"==typeof y)w=function(){y(P)};else if("undefined"!=typeof MessageChannel){var A=new MessageChannel,N=A.port2;A.port1.onmessage=P,w=function(){N.postMessage(null)}}else w=function(){g(P,0)};function R(e){M=e,S||(S=!0,w())}function L(t,n){E=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,R(b))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?o+a:o:a=o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(r.sortIndex=a,t(c,r),null===n(l)&&r===n(c)&&(f?(v(E),E=-1):f=!0,L(x,a-o))):(r.sortIndex=s,t(l,r),m||p||(m=!0,R(b))),r},e.unstable_shouldYield=k,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(Ht),Bt.exports=Ht;var Vt=Bt.exports,Gt=kt,Wt=Vt;
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function $t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Xt=new Set,qt={};function Kt(e,t){Yt(e,t),Yt(e+"Capture",t)}function Yt(e,t){for(qt[e]=t,e=0;e<t.length;e++)Xt.add(t[e])}var Zt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Jt=Object.prototype.hasOwnProperty,Qt=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,en={},tn={};function nn(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var rn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){rn[e]=new nn(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];rn[t]=new nn(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){rn[e]=new nn(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){rn[e]=new nn(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){rn[e]=new nn(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){rn[e]=new nn(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){rn[e]=new nn(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){rn[e]=new nn(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){rn[e]=new nn(e,5,!1,e.toLowerCase(),null,!1,!1)});var an=/[\-:]([a-z])/g;function on(e){return e[1].toUpperCase()}function sn(e,t,n,r){var i=rn.hasOwnProperty(t)?rn[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!Jt.call(tn,e)||!Jt.call(en,e)&&(Qt.test(e)?tn[e]=!0:(en[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(an,on);rn[t]=new nn(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(an,on);rn[t]=new nn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(an,on);rn[t]=new nn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){rn[e]=new nn(e,1,!1,e.toLowerCase(),null,!1,!1)}),rn.xlinkHref=new nn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){rn[e]=new nn(e,1,!1,e.toLowerCase(),null,!0,!0)});var ln=Gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cn=Symbol.for("react.element"),un=Symbol.for("react.portal"),dn=Symbol.for("react.fragment"),hn=Symbol.for("react.strict_mode"),pn=Symbol.for("react.profiler"),mn=Symbol.for("react.provider"),fn=Symbol.for("react.context"),gn=Symbol.for("react.forward_ref"),vn=Symbol.for("react.suspense"),yn=Symbol.for("react.suspense_list"),_n=Symbol.for("react.memo"),xn=Symbol.for("react.lazy"),bn=Symbol.for("react.offscreen"),wn=Symbol.iterator;function Sn(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=wn&&e[wn]||e["@@iterator"])?e:null}var Mn,En=Object.assign;function Cn(e){if(void 0===Mn)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Mn=t&&t[1]||""}return"\n"+Mn+e}var Tn=!1;function kn(e,t){if(!e||Tn)return"";Tn=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"==typeof c.stack){for(var i=c.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var l="\n"+i[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{Tn=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Cn(e):""}function Pn(e){switch(e.tag){case 5:return Cn(e.type);case 16:return Cn("Lazy");case 13:return Cn("Suspense");case 19:return Cn("SuspenseList");case 0:case 2:case 15:return e=kn(e.type,!1);case 11:return e=kn(e.type.render,!1);case 1:return e=kn(e.type,!0);default:return""}}function An(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case dn:return"Fragment";case un:return"Portal";case pn:return"Profiler";case hn:return"StrictMode";case vn:return"Suspense";case yn:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case fn:return(e.displayName||"Context")+".Consumer";case mn:return(e._context.displayName||"Context")+".Provider";case gn:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case _n:return null!==(t=e.displayName||null)?t:An(e.type)||"Memo";case xn:t=e._payload,e=e._init;try{return An(e(t))}catch(n){}}return null}function Nn(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return An(t);case 8:return t===hn?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function Rn(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Ln(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function In(e){e._valueTracker||(e._valueTracker=function(e){var t=Ln(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function jn(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Ln(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Dn(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function On(e,t){var n=t.checked;return En({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Un(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=Rn(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Fn(e,t){null!=(t=t.checked)&&sn(e,"checked",t,!1)}function zn(e,t){Fn(e,t);var n=Rn(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Hn(e,t.type,n):t.hasOwnProperty("defaultValue")&&Hn(e,t.type,Rn(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Bn(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Hn(e,t,n){"number"===t&&Dn(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Vn=Array.isArray;function Gn(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Rn(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Wn(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error($t(91));return En({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function $n(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error($t(92));if(Vn(n)){if(1<n.length)throw Error($t(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Rn(n)}}function Xn(e,t){var n=Rn(t.value),r=Rn(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function qn(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function Kn(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yn(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Kn(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Zn,Jn,Qn=(Jn=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((Zn=Zn||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Zn.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return Jn(e,t)})}:Jn);function er(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var tr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nr=["Webkit","ms","Moz","O"];function rr(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||tr.hasOwnProperty(e)&&tr[e]?(""+t).trim():t+"px"}function ir(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=rr(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(tr).forEach(function(e){nr.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),tr[t]=tr[e]})});var ar=En({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function or(e,t){if(t){if(ar[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error($t(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error($t(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error($t(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error($t(62))}}function sr(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lr=null;function cr(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ur=null,dr=null,hr=null;function pr(e){if(e=ss(e)){if("function"!=typeof ur)throw Error($t(280));var t=e.stateNode;t&&(t=cs(t),ur(e.stateNode,e.type,t))}}function mr(e){dr?hr?hr.push(e):hr=[e]:dr=e}function fr(){if(dr){var e=dr,t=hr;if(hr=dr=null,pr(e),t)for(e=0;e<t.length;e++)pr(t[e])}}function gr(e,t){return e(t)}function vr(){}var yr=!1;function _r(e,t,n){if(yr)return e(t,n);yr=!0;try{return gr(e,t,n)}finally{yr=!1,(null!==dr||null!==hr)&&(vr(),fr())}}function xr(e,t){var n=e.stateNode;if(null===n)return null;var r=cs(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error($t(231,t,typeof n));return n}var br=!1;if(Zt)try{var wr={};Object.defineProperty(wr,"passive",{get:function(){br=!0}}),window.addEventListener("test",wr,wr),window.removeEventListener("test",wr,wr)}catch(Jn){br=!1}function Sr(e,t,n,r,i,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Mr=!1,Er=null,Cr=!1,Tr=null,kr={onError:function(e){Mr=!0,Er=e}};function Pr(e,t,n,r,i,a,o,s,l){Mr=!1,Er=null,Sr.apply(kr,arguments)}function Ar(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Nr(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Rr(e){if(Ar(e)!==e)throw Error($t(188))}function Lr(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ar(e)))throw Error($t(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Rr(i),e;if(a===r)return Rr(i),t;a=a.sibling}throw Error($t(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error($t(189))}}if(n.alternate!==r)throw Error($t(190))}if(3!==n.tag)throw Error($t(188));return n.stateNode.current===n?e:t}(e))?Ir(e):null}function Ir(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ir(e);if(null!==t)return t;e=e.sibling}return null}var jr=Wt.unstable_scheduleCallback,Dr=Wt.unstable_cancelCallback,Or=Wt.unstable_shouldYield,Ur=Wt.unstable_requestPaint,Fr=Wt.unstable_now,zr=Wt.unstable_getCurrentPriorityLevel,Br=Wt.unstable_ImmediatePriority,Hr=Wt.unstable_UserBlockingPriority,Vr=Wt.unstable_NormalPriority,Gr=Wt.unstable_LowPriority,Wr=Wt.unstable_IdlePriority,$r=null,Xr=null;var qr=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(Kr(e)/Yr|0)|0},Kr=Math.log,Yr=Math.LN2;var Zr=64,Jr=4194304;function Qr(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ei(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=Qr(s):0!==(a&=o)&&(r=Qr(a))}else 0!==(o=n&~i)?r=Qr(o):0!==a&&(r=Qr(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&4194240&a))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-qr(t)),r|=e[n],t&=~i;return r}function ti(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ni(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ri(){var e=Zr;return!(4194240&(Zr<<=1))&&(Zr=64),e}function ii(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ai(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-qr(t)]=n}function oi(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-qr(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var si=0;function li(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var ci,ui,di,hi,pi,mi=!1,fi=[],gi=null,vi=null,yi=null,_i=new Map,xi=new Map,bi=[],wi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Si(e,t){switch(e){case"focusin":case"focusout":gi=null;break;case"dragenter":case"dragleave":vi=null;break;case"mouseover":case"mouseout":yi=null;break;case"pointerover":case"pointerout":_i.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xi.delete(t.pointerId)}}function Mi(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=ss(t))&&ui(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ei(e){var t=os(e.target);if(null!==t){var n=Ar(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Nr(n)))return e.blockedOn=t,void pi(e.priority,function(){di(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ci(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Oi(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ss(n))&&ui(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);lr=r,n.target.dispatchEvent(r),lr=null,t.shift()}return!0}function Ti(e,t,n){Ci(e)&&n.delete(t)}function ki(){mi=!1,null!==gi&&Ci(gi)&&(gi=null),null!==vi&&Ci(vi)&&(vi=null),null!==yi&&Ci(yi)&&(yi=null),_i.forEach(Ti),xi.forEach(Ti)}function Pi(e,t){e.blockedOn===t&&(e.blockedOn=null,mi||(mi=!0,Wt.unstable_scheduleCallback(Wt.unstable_NormalPriority,ki)))}function Ai(e){function t(t){return Pi(t,e)}if(0<fi.length){Pi(fi[0],e);for(var n=1;n<fi.length;n++){var r=fi[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==gi&&Pi(gi,e),null!==vi&&Pi(vi,e),null!==yi&&Pi(yi,e),_i.forEach(t),xi.forEach(t),n=0;n<bi.length;n++)(r=bi[n]).blockedOn===e&&(r.blockedOn=null);for(;0<bi.length&&null===(n=bi[0]).blockedOn;)Ei(n),null===n.blockedOn&&bi.shift()}var Ni=ln.ReactCurrentBatchConfig,Ri=!0;function Li(e,t,n,r){var i=si,a=Ni.transition;Ni.transition=null;try{si=1,ji(e,t,n,r)}finally{si=i,Ni.transition=a}}function Ii(e,t,n,r){var i=si,a=Ni.transition;Ni.transition=null;try{si=4,ji(e,t,n,r)}finally{si=i,Ni.transition=a}}function ji(e,t,n,r){if(Ri){var i=Oi(e,t,n,r);if(null===i)Ro(e,t,r,Di,n),Si(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return gi=Mi(gi,e,t,n,r,i),!0;case"dragenter":return vi=Mi(vi,e,t,n,r,i),!0;case"mouseover":return yi=Mi(yi,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return _i.set(a,Mi(_i.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,xi.set(a,Mi(xi.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Si(e,r),4&t&&-1<wi.indexOf(e)){for(;null!==i;){var a=ss(i);if(null!==a&&ci(a),null===(a=Oi(e,t,n,r))&&Ro(e,t,r,Di,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Ro(e,t,r,null,n)}}var Di=null;function Oi(e,t,n,r){if(Di=null,null!==(e=os(e=cr(r))))if(null===(t=Ar(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Nr(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Di=e,null}function Ui(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zr()){case Br:return 1;case Hr:return 4;case Vr:case Gr:return 16;case Wr:return 536870912;default:return 16}default:return 16}}var Fi=null,zi=null,Bi=null;function Hi(){if(Bi)return Bi;var e,t,n=zi,r=n.length,i="value"in Fi?Fi.value:Fi.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Bi=i.slice(e,1<t?1-t:void 0)}function Vi(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Gi(){return!0}function Wi(){return!1}function $i(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Gi:Wi,this.isPropagationStopped=Wi,this}return En(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Gi)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Gi)},persist:function(){},isPersistent:Gi}),t}var Xi,qi,Ki,Yi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zi=$i(Yi),Ji=En({},Yi,{view:0,detail:0}),Qi=$i(Ji),ea=En({},Ji,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ha,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ki&&(Ki&&"mousemove"===e.type?(Xi=e.screenX-Ki.screenX,qi=e.screenY-Ki.screenY):qi=Xi=0,Ki=e),Xi)},movementY:function(e){return"movementY"in e?e.movementY:qi}}),ta=$i(ea),na=$i(En({},ea,{dataTransfer:0})),ra=$i(En({},Ji,{relatedTarget:0})),ia=$i(En({},Yi,{animationName:0,elapsedTime:0,pseudoElement:0})),aa=En({},Yi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),oa=$i(aa),sa=$i(En({},Yi,{data:0})),la={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ca={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ua={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function da(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ua[e])&&!!t[e]}function ha(){return da}var pa=En({},Ji,{key:function(e){if(e.key){var t=la[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Vi(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ca[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ha,charCode:function(e){return"keypress"===e.type?Vi(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Vi(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ma=$i(pa),fa=$i(En({},ea,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),ga=$i(En({},Ji,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ha})),va=$i(En({},Yi,{propertyName:0,elapsedTime:0,pseudoElement:0})),ya=En({},ea,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_a=$i(ya),xa=[9,13,27,32],ba=Zt&&"CompositionEvent"in window,wa=null;Zt&&"documentMode"in document&&(wa=document.documentMode);var Sa=Zt&&"TextEvent"in window&&!wa,Ma=Zt&&(!ba||wa&&8<wa&&11>=wa),Ea=String.fromCharCode(32),Ca=!1;function Ta(e,t){switch(e){case"keyup":return-1!==xa.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ka(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Pa=!1;var Aa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Na(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Aa[e.type]:"textarea"===t}function Ra(e,t,n,r){mr(r),0<(t=Io(t,"onChange")).length&&(n=new Zi("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var La=null,Ia=null;function ja(e){Co(e,0)}function Da(e){if(jn(ls(e)))return e}function Oa(e,t){if("change"===e)return t}var Ua=!1;if(Zt){var Fa;if(Zt){var za="oninput"in document;if(!za){var Ba=document.createElement("div");Ba.setAttribute("oninput","return;"),za="function"==typeof Ba.oninput}Fa=za}else Fa=!1;Ua=Fa&&(!document.documentMode||9<document.documentMode)}function Ha(){La&&(La.detachEvent("onpropertychange",Va),Ia=La=null)}function Va(e){if("value"===e.propertyName&&Da(Ia)){var t=[];Ra(t,Ia,e,cr(e)),_r(ja,t)}}function Ga(e,t,n){"focusin"===e?(Ha(),Ia=n,(La=t).attachEvent("onpropertychange",Va)):"focusout"===e&&Ha()}function Wa(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Da(Ia)}function $a(e,t){if("click"===e)return Da(t)}function Xa(e,t){if("input"===e||"change"===e)return Da(t)}var qa="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Ka(e,t){if(qa(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Jt.call(t,i)||!qa(e[i],t[i]))return!1}return!0}function Ya(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Za(e,t){var n,r=Ya(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ya(r)}}function Ja(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Ja(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Qa(){for(var e=window,t=Dn();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Dn((e=t.contentWindow).document)}return t}function eo(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function to(e){var t=Qa(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Ja(n.ownerDocument.documentElement,n)){if(null!==r&&eo(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=Za(n,a);var o=Za(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var no=Zt&&"documentMode"in document&&11>=document.documentMode,ro=null,io=null,ao=null,oo=!1;function so(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;oo||null==ro||ro!==Dn(r)||("selectionStart"in(r=ro)&&eo(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},ao&&Ka(ao,r)||(ao=r,0<(r=Io(io,"onSelect")).length&&(t=new Zi("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ro)))}function lo(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var co={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionend:lo("Transition","TransitionEnd")},uo={},ho={};function po(e){if(uo[e])return uo[e];if(!co[e])return e;var t,n=co[e];for(t in n)if(n.hasOwnProperty(t)&&t in ho)return uo[e]=n[t];return e}Zt&&(ho=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);var mo=po("animationend"),fo=po("animationiteration"),go=po("animationstart"),vo=po("transitionend"),yo=new Map,_o="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xo(e,t){yo.set(e,t),Kt(t,[e])}for(var bo=0;bo<_o.length;bo++){var wo=_o[bo];xo(wo.toLowerCase(),"on"+(wo[0].toUpperCase()+wo.slice(1)))}xo(mo,"onAnimationEnd"),xo(fo,"onAnimationIteration"),xo(go,"onAnimationStart"),xo("dblclick","onDoubleClick"),xo("focusin","onFocus"),xo("focusout","onBlur"),xo(vo,"onTransitionEnd"),Yt("onMouseEnter",["mouseout","mouseover"]),Yt("onMouseLeave",["mouseout","mouseover"]),Yt("onPointerEnter",["pointerout","pointerover"]),Yt("onPointerLeave",["pointerout","pointerover"]),Kt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Kt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Kt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Kt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Kt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Kt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var So="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mo=new Set("cancel close invalid load scroll toggle".split(" ").concat(So));function Eo(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,o,s,l){if(Pr.apply(this,arguments),Mr){if(!Mr)throw Error($t(198));var c=Er;Mr=!1,Er=null,Cr||(Cr=!0,Tr=c)}}(r,t,void 0,e),e.currentTarget=null}function Co(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;Eo(i,s,c),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;Eo(i,s,c),a=l}}}if(Cr)throw e=Tr,Cr=!1,Tr=null,e}function To(e,t){var n=t[rs];void 0===n&&(n=t[rs]=new Set);var r=e+"__bubble";n.has(r)||(No(t,e,2,!1),n.add(r))}function ko(e,t,n){var r=0;t&&(r|=4),No(n,e,r,t)}var Po="_reactListening"+Math.random().toString(36).slice(2);function Ao(e){if(!e[Po]){e[Po]=!0,Xt.forEach(function(t){"selectionchange"!==t&&(Mo.has(t)||ko(t,!1,e),ko(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Po]||(t[Po]=!0,ko("selectionchange",!1,t))}}function No(e,t,n,r){switch(Ui(t)){case 1:var i=Li;break;case 4:i=Ii;break;default:i=ji}n=i.bind(null,t,n,e),i=void 0,!br||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Ro(e,t,n,r,i){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=os(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}_r(function(){var r=a,i=cr(n),o=[];e:{var s=yo.get(e);if(void 0!==s){var l=Zi,c=e;switch(e){case"keypress":if(0===Vi(n))break e;case"keydown":case"keyup":l=ma;break;case"focusin":c="focus",l=ra;break;case"focusout":c="blur",l=ra;break;case"beforeblur":case"afterblur":l=ra;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ta;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=na;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=ga;break;case mo:case fo:case go:l=ia;break;case vo:l=va;break;case"scroll":l=Qi;break;case"wheel":l=_a;break;case"copy":case"cut":case"paste":l=oa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=fa}var u=!!(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,m=r;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=xr(m,h))&&u.push(Lo(m,f,p)))),d)break;m=m.return}0<u.length&&(s=new l(s,c,null,n,i),o.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===lr||!(c=n.relatedTarget||n.fromElement)||!os(c)&&!c[ns])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?os(c):null)&&(c!==(d=Ar(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=ta,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=fa,f="onPointerLeave",h="onPointerEnter",m="pointer"),d=null==l?s:ls(l),p=null==c?s:ls(c),(s=new u(f,m+"leave",l,n,i)).target=d,s.relatedTarget=p,f=null,os(i)===r&&((u=new u(h,m+"enter",c,n,i)).target=p,u.relatedTarget=d,f=u),d=f,l&&c)e:{for(h=c,m=0,p=u=l;p;p=jo(p))m++;for(p=0,f=h;f;f=jo(f))p++;for(;0<m-p;)u=jo(u),m--;for(;0<p-m;)h=jo(h),p--;for(;m--;){if(u===h||null!==h&&u===h.alternate)break e;u=jo(u),h=jo(h)}u=null}else u=null;null!==l&&Do(o,s,l,u,!1),null!==c&&null!==d&&Do(o,d,c,u,!0)}if("select"===(l=(s=r?ls(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Oa;else if(Na(s))if(Ua)g=Xa;else{g=Wa;var v=Ga}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=$a);switch(g&&(g=g(e,r))?Ra(o,g,n,i):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&Hn(s,"number",s.value)),v=r?ls(r):window,e){case"focusin":(Na(v)||"true"===v.contentEditable)&&(ro=v,io=r,ao=null);break;case"focusout":ao=io=ro=null;break;case"mousedown":oo=!0;break;case"contextmenu":case"mouseup":case"dragend":oo=!1,so(o,n,i);break;case"selectionchange":if(no)break;case"keydown":case"keyup":so(o,n,i)}var y;if(ba)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Pa?Ta(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Ma&&"ko"!==n.locale&&(Pa||"onCompositionStart"!==_?"onCompositionEnd"===_&&Pa&&(y=Hi()):(zi="value"in(Fi=i)?Fi.value:Fi.textContent,Pa=!0)),0<(v=Io(r,_)).length&&(_=new sa(_,e,null,n,i),o.push({event:_,listeners:v}),y?_.data=y:null!==(y=ka(n))&&(_.data=y))),(y=Sa?function(e,t){switch(e){case"compositionend":return ka(t);case"keypress":return 32!==t.which?null:(Ca=!0,Ea);case"textInput":return(e=t.data)===Ea&&Ca?null:e;default:return null}}(e,n):function(e,t){if(Pa)return"compositionend"===e||!ba&&Ta(e,t)?(e=Hi(),Bi=zi=Fi=null,Pa=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ma&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Io(r,"onBeforeInput")).length&&(i=new sa("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=y))}Co(o,t)})}function Lo(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Io(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=xr(e,n))&&r.unshift(Lo(e,a,i)),null!=(a=xr(e,t))&&r.push(Lo(e,a,i))),e=e.return}return r}function jo(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Do(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(l=xr(n,a))&&o.unshift(Lo(n,l,s)):i||null!=(l=xr(n,a))&&o.push(Lo(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Oo=/\r\n?/g,Uo=/\u0000|\uFFFD/g;function Fo(e){return("string"==typeof e?e:""+e).replace(Oo,"\n").replace(Uo,"")}function zo(e,t,n){if(t=Fo(t),Fo(e)!==t&&n)throw Error($t(425))}function Bo(){}var Ho=null,Vo=null;function Go(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Wo="function"==typeof setTimeout?setTimeout:void 0,$o="function"==typeof clearTimeout?clearTimeout:void 0,Xo="function"==typeof Promise?Promise:void 0,qo="function"==typeof queueMicrotask?queueMicrotask:void 0!==Xo?function(e){return Xo.resolve(null).then(e).catch(Ko)}:Wo;function Ko(e){setTimeout(function(){throw e})}function Yo(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ai(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ai(t)}function Zo(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function Jo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Qo=Math.random().toString(36).slice(2),es="__reactFiber$"+Qo,ts="__reactProps$"+Qo,ns="__reactContainer$"+Qo,rs="__reactEvents$"+Qo,is="__reactListeners$"+Qo,as="__reactHandles$"+Qo;function os(e){var t=e[es];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ns]||n[es]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Jo(e);null!==e;){if(n=e[es])return n;e=Jo(e)}return t}n=(e=n).parentNode}return null}function ss(e){return!(e=e[es]||e[ns])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ls(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error($t(33))}function cs(e){return e[ts]||null}var us=[],ds=-1;function hs(e){return{current:e}}function ps(e){0>ds||(e.current=us[ds],us[ds]=null,ds--)}function ms(e,t){ds++,us[ds]=e.current,e.current=t}var fs={},gs=hs(fs),vs=hs(!1),ys=fs;function _s(e,t){var n=e.type.contextTypes;if(!n)return fs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function xs(e){return null!=(e=e.childContextTypes)}function bs(){ps(vs),ps(gs)}function ws(e,t,n){if(gs.current!==fs)throw Error($t(168));ms(gs,t),ms(vs,n)}function Ss(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error($t(108,Nn(e)||"Unknown",i));return En({},n,r)}function Ms(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fs,ys=gs.current,ms(gs,e),ms(vs,vs.current),!0}function Es(e,t,n){var r=e.stateNode;if(!r)throw Error($t(169));n?(e=Ss(e,t,ys),r.__reactInternalMemoizedMergedChildContext=e,ps(vs),ps(gs),ms(gs,e)):ps(vs),ms(vs,n)}var Cs=null,Ts=!1,ks=!1;function Ps(e){null===Cs?Cs=[e]:Cs.push(e)}function As(){if(!ks&&null!==Cs){ks=!0;var e=0,t=si;try{var n=Cs;for(si=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Cs=null,Ts=!1}catch(i){throw null!==Cs&&(Cs=Cs.slice(e+1)),jr(Br,As),i}finally{si=t,ks=!1}}return null}var Ns=[],Rs=0,Ls=null,Is=0,js=[],Ds=0,Os=null,Us=1,Fs="";function zs(e,t){Ns[Rs++]=Is,Ns[Rs++]=Ls,Ls=e,Is=t}function Bs(e,t,n){js[Ds++]=Us,js[Ds++]=Fs,js[Ds++]=Os,Os=e;var r=Us;e=Fs;var i=32-qr(r)-1;r&=~(1<<i),n+=1;var a=32-qr(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Us=1<<32-qr(t)+i|n<<i|r,Fs=a+e}else Us=1<<a|n<<i|r,Fs=e}function Hs(e){null!==e.return&&(zs(e,1),Bs(e,1,0))}function Vs(e){for(;e===Ls;)Ls=Ns[--Rs],Ns[Rs]=null,Is=Ns[--Rs],Ns[Rs]=null;for(;e===Os;)Os=js[--Ds],js[Ds]=null,Fs=js[--Ds],js[Ds]=null,Us=js[--Ds],js[Ds]=null}var Gs=null,Ws=null,$s=!1,Xs=null;function qs(e,t){var n=yh(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Ks(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,Gs=e,Ws=Zo(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,Gs=e,Ws=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Os?{id:Us,overflow:Fs}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=yh(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Gs=e,Ws=null,!0);default:return!1}}function Ys(e){return!(!(1&e.mode)||128&e.flags)}function Zs(e){if($s){var t=Ws;if(t){var n=t;if(!Ks(e,t)){if(Ys(e))throw Error($t(418));t=Zo(n.nextSibling);var r=Gs;t&&Ks(e,t)?qs(r,n):(e.flags=-4097&e.flags|2,$s=!1,Gs=e)}}else{if(Ys(e))throw Error($t(418));e.flags=-4097&e.flags|2,$s=!1,Gs=e}}}function Js(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Gs=e}function Qs(e){if(e!==Gs)return!1;if(!$s)return Js(e),$s=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!Go(e.type,e.memoizedProps)),t&&(t=Ws)){if(Ys(e))throw el(),Error($t(418));for(;t;)qs(e,t),t=Zo(t.nextSibling)}if(Js(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error($t(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Ws=Zo(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Ws=null}}else Ws=Gs?Zo(e.stateNode.nextSibling):null;return!0}function el(){for(var e=Ws;e;)e=Zo(e.nextSibling)}function tl(){Ws=Gs=null,$s=!1}function nl(e){null===Xs?Xs=[e]:Xs.push(e)}var rl=ln.ReactCurrentBatchConfig;function il(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error($t(309));var r=n.stateNode}if(!r)throw Error($t(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=i.refs;null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error($t(284));if(!n._owner)throw Error($t(290,e))}return e}function al(e,t){throw e=Object.prototype.toString.call(t),Error($t(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ol(e){return(0,e._init)(e._payload)}function sl(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=xh(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function s(e,t,n,r){return null===t||6!==t.tag?((t=Mh(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===dn?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===xn&&ol(a)===t.type)?((r=i(t,n.props)).ref=il(e,t,n),r.return=e,r):((r=bh(n.type,n.key,n.props,null,e.mode,r)).ref=il(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Eh(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=wh(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Mh(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case cn:return(n=bh(t.type,t.key,t.props,null,e.mode,n)).ref=il(e,null,t),n.return=e,n;case un:return(t=Eh(t,e.mode,n)).return=e,t;case xn:return d(e,(0,t._init)(t._payload),n)}if(Vn(t)||Sn(t))return(t=wh(t,e.mode,n,null)).return=e,t;al(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:s(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case cn:return n.key===i?l(e,t,n,r):null;case un:return n.key===i?c(e,t,n,r):null;case xn:return h(e,t,(i=n._init)(n._payload),r)}if(Vn(n)||Sn(n))return null!==i?null:u(e,t,n,r,null);al(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return s(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case cn:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case un:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case xn:return p(e,t,n,(0,r._init)(r._payload),i)}if(Vn(r)||Sn(r))return u(t,e=e.get(n)||null,r,i,null);al(t,r)}return null}return function s(l,c,u,m){if("object"==typeof u&&null!==u&&u.type===dn&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case cn:e:{for(var f=u.key,g=c;null!==g;){if(g.key===f){if((f=u.type)===dn){if(7===g.tag){n(l,g.sibling),(c=i(g,u.props.children)).return=l,l=c;break e}}else if(g.elementType===f||"object"==typeof f&&null!==f&&f.$$typeof===xn&&ol(f)===g.type){n(l,g.sibling),(c=i(g,u.props)).ref=il(l,g,u),c.return=l,l=c;break e}n(l,g);break}t(l,g),g=g.sibling}u.type===dn?((c=wh(u.props.children,l.mode,m,u.key)).return=l,l=c):((m=bh(u.type,u.key,u.props,null,l.mode,m)).ref=il(l,c,u),m.return=l,l=m)}return o(l);case un:e:{for(g=u.key;null!==c;){if(c.key===g){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(c=i(c,u.children||[])).return=l,l=c;break e}n(l,c);break}t(l,c),c=c.sibling}(c=Eh(u,l.mode,m)).return=l,l=c}return o(l);case xn:return s(l,c,(g=u._init)(u._payload),m)}if(Vn(u))return function(i,o,s,l){for(var c=null,u=null,m=o,f=o=0,g=null;null!==m&&f<s.length;f++){m.index>f?(g=m,m=null):g=m.sibling;var v=h(i,m,s[f],l);if(null===v){null===m&&(m=g);break}e&&m&&null===v.alternate&&t(i,m),o=a(v,o,f),null===u?c=v:u.sibling=v,u=v,m=g}if(f===s.length)return n(i,m),$s&&zs(i,f),c;if(null===m){for(;f<s.length;f++)null!==(m=d(i,s[f],l))&&(o=a(m,o,f),null===u?c=m:u.sibling=m,u=m);return $s&&zs(i,f),c}for(m=r(i,m);f<s.length;f++)null!==(g=p(m,i,f,s[f],l))&&(e&&null!==g.alternate&&m.delete(null===g.key?f:g.key),o=a(g,o,f),null===u?c=g:u.sibling=g,u=g);return e&&m.forEach(function(e){return t(i,e)}),$s&&zs(i,f),c}(l,c,u,m);if(Sn(u))return function(i,o,s,l){var c=Sn(s);if("function"!=typeof c)throw Error($t(150));if(null==(s=c.call(s)))throw Error($t(151));for(var u=c=null,m=o,f=o=0,g=null,v=s.next();null!==m&&!v.done;f++,v=s.next()){m.index>f?(g=m,m=null):g=m.sibling;var y=h(i,m,v.value,l);if(null===y){null===m&&(m=g);break}e&&m&&null===y.alternate&&t(i,m),o=a(y,o,f),null===u?c=y:u.sibling=y,u=y,m=g}if(v.done)return n(i,m),$s&&zs(i,f),c;if(null===m){for(;!v.done;f++,v=s.next())null!==(v=d(i,v.value,l))&&(o=a(v,o,f),null===u?c=v:u.sibling=v,u=v);return $s&&zs(i,f),c}for(m=r(i,m);!v.done;f++,v=s.next())null!==(v=p(m,i,f,v.value,l))&&(e&&null!==v.alternate&&m.delete(null===v.key?f:v.key),o=a(v,o,f),null===u?c=v:u.sibling=v,u=v);return e&&m.forEach(function(e){return t(i,e)}),$s&&zs(i,f),c}(l,c,u,m);al(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(c=i(c,u)).return=l,l=c):(n(l,c),(c=Mh(u,l.mode,m)).return=l,l=c),o(l)):n(l,c)}}var ll=sl(!0),cl=sl(!1),ul=hs(null),dl=null,hl=null,pl=null;function ml(){pl=hl=dl=null}function fl(e){var t=ul.current;ps(ul),e._currentValue=t}function gl(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function vl(e,t){dl=e,pl=hl=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ou=!0),e.firstContext=null)}function yl(e){var t=e._currentValue;if(pl!==e)if(e={context:e,memoizedValue:t,next:null},null===hl){if(null===dl)throw Error($t(308));hl=e,dl.dependencies={lanes:0,firstContext:e}}else hl=hl.next=e;return t}var _l=null;function xl(e){null===_l?_l=[e]:_l.push(e)}function bl(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,xl(t)):(n.next=i.next,i.next=n),t.interleaved=n,wl(e,r)}function wl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Sl=!1;function Ml(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function El(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Cl(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Tl(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&fd){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,wl(e,n)}return null===(i=r.interleaved)?(t.next=t,xl(r)):(t.next=i.next,i.next=t),r.interleaved=t,wl(e,n)}function kl(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,oi(e,n)}}function Pl(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Al(e,t,n,r){var i=e.updateQueue;Sl=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=i.baseState;for(o=0,u=c=l=null,s=a;;){var h=s.lane,p=s.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,f=s;switch(h=t,p=n,f.tag){case 1:if("function"==typeof(m=f.payload)){d=m.call(p,d,h);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(h="function"==typeof(m=f.payload)?m.call(p,d,h):m))break e;d=En({},d,h);break e;case 2:Sl=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Sd|=o,e.lanes=o,e.memoizedState=d}}function Nl(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error($t(191,i));i.call(r)}}}var Rl={},Ll=hs(Rl),Il=hs(Rl),jl=hs(Rl);function Dl(e){if(e===Rl)throw Error($t(174));return e}function Ol(e,t){switch(ms(jl,t),ms(Il,e),ms(Ll,Rl),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Yn(null,"");break;default:t=Yn(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ps(Ll),ms(Ll,t)}function Ul(){ps(Ll),ps(Il),ps(jl)}function Fl(e){Dl(jl.current);var t=Dl(Ll.current),n=Yn(t,e.type);t!==n&&(ms(Il,e),ms(Ll,n))}function zl(e){Il.current===e&&(ps(Ll),ps(Il))}var Bl=hs(0);function Hl(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Vl=[];function Gl(){for(var e=0;e<Vl.length;e++)Vl[e]._workInProgressVersionPrimary=null;Vl.length=0}var Wl=ln.ReactCurrentDispatcher,$l=ln.ReactCurrentBatchConfig,Xl=0,ql=null,Kl=null,Yl=null,Zl=!1,Jl=!1,Ql=0,ec=0;function tc(){throw Error($t(321))}function nc(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!qa(e[n],t[n]))return!1;return!0}function rc(e,t,n,r,i,a){if(Xl=a,ql=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Wl.current=null===e||null===e.memoizedState?zc:Bc,e=n(r,i),Jl){a=0;do{if(Jl=!1,Ql=0,25<=a)throw Error($t(301));a+=1,Yl=Kl=null,t.updateQueue=null,Wl.current=Hc,e=n(r,i)}while(Jl)}if(Wl.current=Fc,t=null!==Kl&&null!==Kl.next,Xl=0,Yl=Kl=ql=null,Zl=!1,t)throw Error($t(300));return e}function ic(){var e=0!==Ql;return Ql=0,e}function ac(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Yl?ql.memoizedState=Yl=e:Yl=Yl.next=e,Yl}function oc(){if(null===Kl){var e=ql.alternate;e=null!==e?e.memoizedState:null}else e=Kl.next;var t=null===Yl?ql.memoizedState:Yl.next;if(null!==t)Yl=t,Kl=e;else{if(null===e)throw Error($t(310));e={memoizedState:(Kl=e).memoizedState,baseState:Kl.baseState,baseQueue:Kl.baseQueue,queue:Kl.queue,next:null},null===Yl?ql.memoizedState=Yl=e:Yl=Yl.next=e}return Yl}function sc(e,t){return"function"==typeof t?t(e):t}function lc(e){var t=oc(),n=t.queue;if(null===n)throw Error($t(311));n.lastRenderedReducer=e;var r=Kl,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var s=o=null,l=null,c=a;do{var u=c.lane;if((Xl&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(s=l=d,o=r):l=l.next=d,ql.lanes|=u,Sd|=u}c=c.next}while(null!==c&&c!==a);null===l?o=r:l.next=s,qa(r,t.memoizedState)||(ou=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,ql.lanes|=a,Sd|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function cc(e){var t=oc(),n=t.queue;if(null===n)throw Error($t(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);qa(a,t.memoizedState)||(ou=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function uc(){}function dc(e,t){var n=ql,r=oc(),i=t(),a=!qa(r.memoizedState,i);if(a&&(r.memoizedState=i,ou=!0),r=r.queue,Sc(mc.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==Yl&&1&Yl.memoizedState.tag){if(n.flags|=2048,yc(9,pc.bind(null,n,r,i,t),void 0,null),null===gd)throw Error($t(349));30&Xl||hc(n,t,i)}return i}function hc(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ql.updateQueue)?(t={lastEffect:null,stores:null},ql.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function pc(e,t,n,r){t.value=n,t.getSnapshot=r,fc(t)&&gc(e)}function mc(e,t,n){return n(function(){fc(t)&&gc(e)})}function fc(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!qa(e,n)}catch(r){return!0}}function gc(e){var t=wl(e,1);null!==t&&Vd(t,e,1,-1)}function vc(e){var t=ac();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sc,lastRenderedState:e},t.queue=e,e=e.dispatch=jc.bind(null,ql,e),[t.memoizedState,e]}function yc(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ql.updateQueue)?(t={lastEffect:null,stores:null},ql.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function _c(){return oc().memoizedState}function xc(e,t,n,r){var i=ac();ql.flags|=e,i.memoizedState=yc(1|t,n,void 0,void 0===r?null:r)}function bc(e,t,n,r){var i=oc();r=void 0===r?null:r;var a=void 0;if(null!==Kl){var o=Kl.memoizedState;if(a=o.destroy,null!==r&&nc(r,o.deps))return void(i.memoizedState=yc(t,n,a,r))}ql.flags|=e,i.memoizedState=yc(1|t,n,a,r)}function wc(e,t){return xc(8390656,8,e,t)}function Sc(e,t){return bc(2048,8,e,t)}function Mc(e,t){return bc(4,2,e,t)}function Ec(e,t){return bc(4,4,e,t)}function Cc(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Tc(e,t,n){return n=null!=n?n.concat([e]):null,bc(4,4,Cc.bind(null,t,e),n)}function kc(){}function Pc(e,t){var n=oc();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&nc(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ac(e,t){var n=oc();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&nc(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Nc(e,t,n){return 21&Xl?(qa(n,t)||(n=ri(),ql.lanes|=n,Sd|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ou=!0),e.memoizedState=n)}function Rc(e,t){var n=si;si=0!==n&&4>n?n:4,e(!0);var r=$l.transition;$l.transition={};try{e(!1),t()}finally{si=n,$l.transition=r}}function Lc(){return oc().memoizedState}function Ic(e,t,n){var r=Hd(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Dc(e))Oc(t,n);else if(null!==(n=bl(e,t,n,r))){Vd(n,e,r,Bd()),Uc(n,t,r)}}function jc(e,t,n){var r=Hd(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Dc(e))Oc(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,qa(s,o)){var l=t.interleaved;return null===l?(i.next=i,xl(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=bl(e,t,i,r))&&(Vd(n,e,r,i=Bd()),Uc(n,t,r))}}function Dc(e){var t=e.alternate;return e===ql||null!==t&&t===ql}function Oc(e,t){Jl=Zl=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Uc(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,oi(e,n)}}var Fc={readContext:yl,useCallback:tc,useContext:tc,useEffect:tc,useImperativeHandle:tc,useInsertionEffect:tc,useLayoutEffect:tc,useMemo:tc,useReducer:tc,useRef:tc,useState:tc,useDebugValue:tc,useDeferredValue:tc,useTransition:tc,useMutableSource:tc,useSyncExternalStore:tc,useId:tc,unstable_isNewReconciler:!1},zc={readContext:yl,useCallback:function(e,t){return ac().memoizedState=[e,void 0===t?null:t],e},useContext:yl,useEffect:wc,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,xc(4194308,4,Cc.bind(null,t,e),n)},useLayoutEffect:function(e,t){return xc(4194308,4,e,t)},useInsertionEffect:function(e,t){return xc(4,2,e,t)},useMemo:function(e,t){var n=ac();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ac();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ic.bind(null,ql,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ac().memoizedState=e},useState:vc,useDebugValue:kc,useDeferredValue:function(e){return ac().memoizedState=e},useTransition:function(){var e=vc(!1),t=e[0];return e=Rc.bind(null,e[1]),ac().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ql,i=ac();if($s){if(void 0===n)throw Error($t(407));n=n()}else{if(n=t(),null===gd)throw Error($t(349));30&Xl||hc(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,wc(mc.bind(null,r,a,e),[e]),r.flags|=2048,yc(9,pc.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=ac(),t=gd.identifierPrefix;if($s){var n=Fs;t=":"+t+"R"+(n=(Us&~(1<<32-qr(Us)-1)).toString(32)+n),0<(n=Ql++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ec++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Bc={readContext:yl,useCallback:Pc,useContext:yl,useEffect:Sc,useImperativeHandle:Tc,useInsertionEffect:Mc,useLayoutEffect:Ec,useMemo:Ac,useReducer:lc,useRef:_c,useState:function(){return lc(sc)},useDebugValue:kc,useDeferredValue:function(e){return Nc(oc(),Kl.memoizedState,e)},useTransition:function(){return[lc(sc)[0],oc().memoizedState]},useMutableSource:uc,useSyncExternalStore:dc,useId:Lc,unstable_isNewReconciler:!1},Hc={readContext:yl,useCallback:Pc,useContext:yl,useEffect:Sc,useImperativeHandle:Tc,useInsertionEffect:Mc,useLayoutEffect:Ec,useMemo:Ac,useReducer:cc,useRef:_c,useState:function(){return cc(sc)},useDebugValue:kc,useDeferredValue:function(e){var t=oc();return null===Kl?t.memoizedState=e:Nc(t,Kl.memoizedState,e)},useTransition:function(){return[cc(sc)[0],oc().memoizedState]},useMutableSource:uc,useSyncExternalStore:dc,useId:Lc,unstable_isNewReconciler:!1};function Vc(e,t){if(e&&e.defaultProps){for(var n in t=En({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function Gc(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:En({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Wc={isMounted:function(e){return!!(e=e._reactInternals)&&Ar(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Bd(),i=Hd(e),a=Cl(r,i);a.payload=t,null!=n&&(a.callback=n),null!==(t=Tl(e,a,i))&&(Vd(t,e,i,r),kl(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Bd(),i=Hd(e),a=Cl(r,i);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Tl(e,a,i))&&(Vd(t,e,i,r),kl(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Bd(),r=Hd(e),i=Cl(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=Tl(e,i,r))&&(Vd(t,e,r,n),kl(t,e,r))}};function $c(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!Ka(n,r)||!Ka(i,a))}function Xc(e,t,n){var r=!1,i=fs,a=t.contextType;return"object"==typeof a&&null!==a?a=yl(a):(i=xs(t)?ys:gs.current,a=(r=null!=(r=t.contextTypes))?_s(e,i):fs),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Wc,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function qc(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Wc.enqueueReplaceState(t,t.state,null)}function Kc(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Ml(e);var a=t.contextType;"object"==typeof a&&null!==a?i.context=yl(a):(a=xs(t)?ys:gs.current,i.context=_s(e,a)),i.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(Gc(e,t,a,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Wc.enqueueReplaceState(i,i.state,null),Al(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function Yc(e,t){try{var n="",r=t;do{n+=Pn(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function Zc(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function Jc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Qc="function"==typeof WeakMap?WeakMap:Map;function eu(e,t,n){(n=Cl(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Nd||(Nd=!0,Rd=r),Jc(0,t)},n}function tu(e,t,n){(n=Cl(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Jc(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){Jc(0,t),"function"!=typeof r&&(null===Ld?Ld=new Set([this]):Ld.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function nu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Qc;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=hh.bind(null,e,t,n),t.then(e,e))}function ru(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function iu(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Cl(-1,1)).tag=2,Tl(n,t,1))),n.lanes|=1),e)}var au=ln.ReactCurrentOwner,ou=!1;function su(e,t,n,r){t.child=null===e?cl(t,null,n,r):ll(t,e.child,n,r)}function lu(e,t,n,r,i){n=n.render;var a=t.ref;return vl(t,i),r=rc(e,t,n,r,a,i),n=ic(),null===e||ou?($s&&n&&Hs(t),t.flags|=1,su(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Nu(e,t,i))}function cu(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||_h(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=bh(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,uu(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:Ka)(o,r)&&e.ref===t.ref)return Nu(e,t,i)}return t.flags|=1,(e=xh(a,r)).ref=t.ref,e.return=t,t.child=e}function uu(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(Ka(a,r)&&e.ref===t.ref){if(ou=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Nu(e,t,i);131072&e.flags&&(ou=!0)}}return pu(e,t,n,r,i)}function du(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ms(xd,_d),_d|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,ms(xd,_d),_d|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ms(xd,_d),_d|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,ms(xd,_d),_d|=r;return su(e,t,i,n),t.child}function hu(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function pu(e,t,n,r,i){var a=xs(n)?ys:gs.current;return a=_s(t,a),vl(t,i),n=rc(e,t,n,r,a,i),r=ic(),null===e||ou?($s&&r&&Hs(t),t.flags|=1,su(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Nu(e,t,i))}function mu(e,t,n,r,i){if(xs(n)){var a=!0;Ms(t)}else a=!1;if(vl(t,i),null===t.stateNode)Au(e,t),Xc(t,n,r),Kc(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"==typeof c&&null!==c?c=yl(c):c=_s(t,c=xs(n)?ys:gs.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==r||l!==c)&&qc(t,o,r,c),Sl=!1;var h=t.memoizedState;o.state=h,Al(t,r,o,i),l=t.memoizedState,s!==r||h!==l||vs.current||Sl?("function"==typeof u&&(Gc(t,n,u,r),l=t.memoizedState),(s=Sl||$c(t,n,s,r,h,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):("function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,El(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:Vc(t.type,s),o.props=c,d=t.pendingProps,h=o.context,"object"==typeof(l=n.contextType)&&null!==l?l=yl(l):l=_s(t,l=xs(n)?ys:gs.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||h!==l)&&qc(t,o,r,l),Sl=!1,h=t.memoizedState,o.state=h,Al(t,r,o,i);var m=t.memoizedState;s!==d||h!==m||vs.current||Sl?("function"==typeof p&&(Gc(t,n,p,r),m=t.memoizedState),(c=Sl||$c(t,n,c,r,h,m,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,m,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,m,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=l,r=c):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return fu(e,t,n,r,a,i)}function fu(e,t,n,r,i,a){hu(e,t);var o=!!(128&t.flags);if(!r&&!o)return i&&Es(t,n,!1),Nu(e,t,a);r=t.stateNode,au.current=t;var s=o&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=ll(t,e.child,null,a),t.child=ll(t,null,s,a)):su(e,t,s,a),t.memoizedState=r.state,i&&Es(t,n,!0),t.child}function gu(e){var t=e.stateNode;t.pendingContext?ws(0,t.pendingContext,t.pendingContext!==t.context):t.context&&ws(0,t.context,!1),Ol(e,t.containerInfo)}function vu(e,t,n,r,i){return tl(),nl(i),t.flags|=256,su(e,t,n,r),t.child}var yu,_u,xu,bu,wu={dehydrated:null,treeContext:null,retryLane:0};function Su(e){return{baseLanes:e,cachePool:null,transitions:null}}function Mu(e,t,n){var r,i=t.pendingProps,a=Bl.current,o=!1,s=!!(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&!!(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),ms(Bl,1&a),null===e)return Zs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},1&i||null===o?o=Sh(s,i,0,null):(o.childLanes=0,o.pendingProps=s),e=wh(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Su(n),t.memoizedState=wu,e):Eu(t,s));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,o){if(n)return 256&t.flags?(t.flags&=-257,Cu(e,t,o,r=Zc(Error($t(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=Sh({mode:"visible",children:r.children},i,0,null),(a=wh(a,i,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,1&t.mode&&ll(t,e.child,null,o),t.child.memoizedState=Su(o),t.memoizedState=wu,a);if(!(1&t.mode))return Cu(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var s=r.dgst;return r=s,Cu(e,t,o,r=Zc(a=Error($t(419)),r,void 0))}if(s=0!==(o&e.childLanes),ou||s){if(null!==(r=gd)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|o))?0:i)&&i!==a.retryLane&&(a.retryLane=i,wl(e,i),Vd(r,e,i,-1))}return nh(),Cu(e,t,o,r=Zc(Error($t(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=mh.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,Ws=Zo(i.nextSibling),Gs=t,$s=!0,Xs=null,null!==e&&(js[Ds++]=Us,js[Ds++]=Fs,js[Ds++]=Os,Us=e.id,Fs=e.overflow,Os=t),t=Eu(t,r.children),t.flags|=4096,t)}(e,t,s,i,r,a,n);if(o){o=i.fallback,s=t.mode,r=(a=e.child).sibling;var l={mode:"hidden",children:i.children};return 1&s||t.child===a?(i=xh(a,l)).subtreeFlags=14680064&a.subtreeFlags:((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null),null!==r?o=xh(r,o):(o=wh(o,s,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,s=null===(s=e.child.memoizedState)?Su(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=wu,i}return e=(o=e.child).sibling,i=xh(o,{mode:"visible",children:i.children}),!(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Eu(e,t){return(t=Sh({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Cu(e,t,n,r){return null!==r&&nl(r),ll(t,e.child,null,n),(e=Eu(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Tu(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),gl(e.return,t,n)}function ku(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Pu(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(su(e,t,r.children,n),2&(r=Bl.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Tu(e,n,t);else if(19===e.tag)Tu(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ms(Bl,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Hl(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),ku(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Hl(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}ku(t,!0,n,null,a);break;case"together":ku(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Au(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Nu(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Sd|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error($t(153));if(null!==t.child){for(n=xh(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=xh(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ru(e,t){if(!$s)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Lu(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Iu(e,t,n){var r=t.pendingProps;switch(Vs(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lu(t),null;case 1:case 17:return xs(t.type)&&bs(),Lu(t),null;case 3:return r=t.stateNode,Ul(),ps(vs),ps(gs),Gl(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Qs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==Xs&&(Xd(Xs),Xs=null))),_u(e,t),Lu(t),null;case 5:zl(t);var i=Dl(jl.current);if(n=t.type,null!==e&&null!=t.stateNode)xu(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error($t(166));return Lu(t),null}if(e=Dl(Ll.current),Qs(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[es]=t,r[ts]=a,e=!!(1&t.mode),n){case"dialog":To("cancel",r),To("close",r);break;case"iframe":case"object":case"embed":To("load",r);break;case"video":case"audio":for(i=0;i<So.length;i++)To(So[i],r);break;case"source":To("error",r);break;case"img":case"image":case"link":To("error",r),To("load",r);break;case"details":To("toggle",r);break;case"input":Un(r,a),To("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},To("invalid",r);break;case"textarea":$n(r,a),To("invalid",r)}for(var o in or(n,a),i=null,a)if(a.hasOwnProperty(o)){var s=a[o];"children"===o?"string"==typeof s?r.textContent!==s&&(!0!==a.suppressHydrationWarning&&zo(r.textContent,s,e),i=["children",s]):"number"==typeof s&&r.textContent!==""+s&&(!0!==a.suppressHydrationWarning&&zo(r.textContent,s,e),i=["children",""+s]):qt.hasOwnProperty(o)&&null!=s&&"onScroll"===o&&To("scroll",r)}switch(n){case"input":In(r),Bn(r,a,!0);break;case"textarea":In(r),qn(r);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(r.onclick=Bo)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{o=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=Kn(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),"select"===n&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[es]=t,e[ts]=r,yu(e,t,!1,!1),t.stateNode=e;e:{switch(o=sr(n,r),n){case"dialog":To("cancel",e),To("close",e),i=r;break;case"iframe":case"object":case"embed":To("load",e),i=r;break;case"video":case"audio":for(i=0;i<So.length;i++)To(So[i],e);i=r;break;case"source":To("error",e),i=r;break;case"img":case"image":case"link":To("error",e),To("load",e),i=r;break;case"details":To("toggle",e),i=r;break;case"input":Un(e,r),i=On(e,r),To("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=En({},r,{value:void 0}),To("invalid",e);break;case"textarea":$n(e,r),i=Wn(e,r),To("invalid",e)}for(a in or(n,i),s=i)if(s.hasOwnProperty(a)){var l=s[a];"style"===a?ir(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&Qn(e,l):"children"===a?"string"==typeof l?("textarea"!==n||""!==l)&&er(e,l):"number"==typeof l&&er(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(qt.hasOwnProperty(a)?null!=l&&"onScroll"===a&&To("scroll",e):null!=l&&sn(e,a,l,o))}switch(n){case"input":In(e),Bn(e,r,!1);break;case"textarea":In(e),qn(e);break;case"option":null!=r.value&&e.setAttribute("value",""+Rn(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?Gn(e,!!r.multiple,a,!1):null!=r.defaultValue&&Gn(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Bo)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Lu(t),null;case 6:if(e&&null!=t.stateNode)bu(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error($t(166));if(n=Dl(jl.current),Dl(Ll.current),Qs(t)){if(r=t.stateNode,n=t.memoizedProps,r[es]=t,(a=r.nodeValue!==n)&&null!==(e=Gs))switch(e.tag){case 3:zo(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&zo(r.nodeValue,n,!!(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[es]=t,t.stateNode=r}return Lu(t),null;case 13:if(ps(Bl),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if($s&&null!==Ws&&1&t.mode&&!(128&t.flags))el(),tl(),t.flags|=98560,a=!1;else if(a=Qs(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error($t(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error($t(317));a[es]=t}else tl(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Lu(t),a=!1}else null!==Xs&&(Xd(Xs),Xs=null),a=!0;if(!a)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&Bl.current?0===bd&&(bd=3):nh())),null!==t.updateQueue&&(t.flags|=4),Lu(t),null);case 4:return Ul(),_u(e,t),null===e&&Ao(t.stateNode.containerInfo),Lu(t),null;case 10:return fl(t.type._context),Lu(t),null;case 19:if(ps(Bl),null===(a=t.memoizedState))return Lu(t),null;if(r=!!(128&t.flags),null===(o=a.rendering))if(r)Ru(a,!1);else{if(0!==bd||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=Hl(e))){for(t.flags|=128,Ru(a,!1),null!==(r=o.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(o=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ms(Bl,1&Bl.current|2),t.child}e=e.sibling}null!==a.tail&&Fr()>Pd&&(t.flags|=128,r=!0,Ru(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Hl(o))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ru(a,!0),null===a.tail&&"hidden"===a.tailMode&&!o.alternate&&!$s)return Lu(t),null}else 2*Fr()-a.renderingStartTime>Pd&&1073741824!==n&&(t.flags|=128,r=!0,Ru(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(null!==(n=a.last)?n.sibling=o:t.child=o,a.last=o)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Fr(),t.sibling=null,n=Bl.current,ms(Bl,r?1&n|2:1&n),t):(Lu(t),null);case 22:case 23:return Jd(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&_d)&&(Lu(t),6&t.subtreeFlags&&(t.flags|=8192)):Lu(t),null;case 24:case 25:return null}throw Error($t(156,t.tag))}function ju(e,t){switch(Vs(t),t.tag){case 1:return xs(t.type)&&bs(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ul(),ps(vs),ps(gs),Gl(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return zl(t),null;case 13:if(ps(Bl),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error($t(340));tl()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ps(Bl),null;case 4:return Ul(),null;case 10:return fl(t.type._context),null;case 22:case 23:return Jd(),null;default:return null}}yu=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},_u=function(){},xu=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Dl(Ll.current);var a,o=null;switch(n){case"input":i=On(e,i),r=On(e,r),o=[];break;case"select":i=En({},i,{value:void 0}),r=En({},r,{value:void 0}),o=[];break;case"textarea":i=Wn(e,i),r=Wn(e,r),o=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Bo)}for(c in or(n,r),n=null,i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&null!=i[c])if("style"===c){var s=i[c];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(qt.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(s=null!=i?i[c]:void 0,r.hasOwnProperty(c)&&l!==s&&(null!=l||null!=s))if("style"===c)if(s){for(a in s)!s.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&s[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,s=s?s.__html:void 0,null!=l&&s!==l&&(o=o||[]).push(c,l)):"children"===c?"string"!=typeof l&&"number"!=typeof l||(o=o||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(qt.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&To("scroll",e),o||s===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},bu=function(e,t,n,r){n!==r&&(t.flags|=4)};var Du=!1,Ou=!1,Uu="function"==typeof WeakSet?WeakSet:Set,Fu=null;function zu(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(r){dh(e,t,r)}else n.current=null}function Bu(e,t,n){try{n()}catch(r){dh(e,t,r)}}var Hu=!1;function Vu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&Bu(t,n,a)}i=i.next}while(i!==r)}}function Gu(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Wu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function $u(e){var t=e.alternate;null!==t&&(e.alternate=null,$u(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[es],delete t[ts],delete t[rs],delete t[is],delete t[as])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Xu(e){return 5===e.tag||3===e.tag||4===e.tag}function qu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Xu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Ku(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Bo));else if(4!==r&&null!==(e=e.child))for(Ku(e,t,n),e=e.sibling;null!==e;)Ku(e,t,n),e=e.sibling}function Yu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(Yu(e,t,n),e=e.sibling;null!==e;)Yu(e,t,n),e=e.sibling}var Zu=null,Ju=!1;function Qu(e,t,n){for(n=n.child;null!==n;)ed(e,t,n),n=n.sibling}function ed(e,t,n){if(Xr&&"function"==typeof Xr.onCommitFiberUnmount)try{Xr.onCommitFiberUnmount($r,n)}catch(s){}switch(n.tag){case 5:Ou||zu(n,t);case 6:var r=Zu,i=Ju;Zu=null,Qu(e,t,n),Ju=i,null!==(Zu=r)&&(Ju?(e=Zu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):Zu.removeChild(n.stateNode));break;case 18:null!==Zu&&(Ju?(e=Zu,n=n.stateNode,8===e.nodeType?Yo(e.parentNode,n):1===e.nodeType&&Yo(e,n),Ai(e)):Yo(Zu,n.stateNode));break;case 4:r=Zu,i=Ju,Zu=n.stateNode.containerInfo,Ju=!0,Qu(e,t,n),Zu=r,Ju=i;break;case 0:case 11:case 14:case 15:if(!Ou&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(2&a||4&a)&&Bu(n,t,o),i=i.next}while(i!==r)}Qu(e,t,n);break;case 1:if(!Ou&&(zu(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){dh(n,t,s)}Qu(e,t,n);break;case 21:Qu(e,t,n);break;case 22:1&n.mode?(Ou=(r=Ou)||null!==n.memoizedState,Qu(e,t,n),Ou=r):Qu(e,t,n);break;default:Qu(e,t,n)}}function td(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Uu),t.forEach(function(t){var r=fh.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function nd(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,s=o;e:for(;null!==s;){switch(s.tag){case 5:Zu=s.stateNode,Ju=!1;break e;case 3:case 4:Zu=s.stateNode.containerInfo,Ju=!0;break e}s=s.return}if(null===Zu)throw Error($t(160));ed(a,o,i),Zu=null,Ju=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(c){dh(i,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)rd(t,e),t=t.sibling}function rd(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nd(t,e),id(e),4&r){try{Vu(3,e,e.return),Gu(3,e)}catch(f){dh(e,e.return,f)}try{Vu(5,e,e.return)}catch(f){dh(e,e.return,f)}}break;case 1:nd(t,e),id(e),512&r&&null!==n&&zu(n,n.return);break;case 5:if(nd(t,e),id(e),512&r&&null!==n&&zu(n,n.return),32&e.flags){var i=e.stateNode;try{er(i,"")}catch(f){dh(e,e.return,f)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,s=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===s&&"radio"===a.type&&null!=a.name&&Fn(i,a),sr(s,o);var c=sr(s,a);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];"style"===u?ir(i,d):"dangerouslySetInnerHTML"===u?Qn(i,d):"children"===u?er(i,d):sn(i,u,d,c)}switch(s){case"input":zn(i,a);break;case"textarea":Xn(i,a);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?Gn(i,!!a.multiple,p,!1):h!==!!a.multiple&&(null!=a.defaultValue?Gn(i,!!a.multiple,a.defaultValue,!0):Gn(i,!!a.multiple,a.multiple?[]:"",!1))}i[ts]=a}catch(f){dh(e,e.return,f)}}break;case 6:if(nd(t,e),id(e),4&r){if(null===e.stateNode)throw Error($t(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(f){dh(e,e.return,f)}}break;case 3:if(nd(t,e),id(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ai(t.containerInfo)}catch(f){dh(e,e.return,f)}break;case 4:default:nd(t,e),id(e);break;case 13:nd(t,e),id(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(kd=Fr())),4&r&&td(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Ou=(c=Ou)||u,nd(t,e),Ou=c):nd(t,e),id(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!u&&1&e.mode)for(Fu=e,u=e.child;null!==u;){for(d=Fu=u;null!==Fu;){switch(p=(h=Fu).child,h.tag){case 0:case 11:case 14:case 15:Vu(4,h,h.return);break;case 1:zu(h,h.return);var m=h.stateNode;if("function"==typeof m.componentWillUnmount){r=h,n=h.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(f){dh(r,n,f)}}break;case 5:zu(h,h.return);break;case 22:if(null!==h.memoizedState){ld(d);continue}}null!==p?(p.return=h,Fu=p):ld(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{i=d.stateNode,c?"function"==typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(s=d.stateNode,o=null!=(l=d.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,s.style.display=rr("display",o))}catch(f){dh(e,e.return,f)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(f){dh(e,e.return,f)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:nd(t,e),id(e),4&r&&td(e);case 21:}}function id(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(Xu(n)){var r=n;break e}n=n.return}throw Error($t(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(er(i,""),r.flags&=-33),Yu(e,qu(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;Ku(e,qu(e),a);break;default:throw Error($t(161))}}catch(o){dh(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function ad(e,t,n){Fu=e,od(e)}function od(e,t,n){for(var r=!!(1&e.mode);null!==Fu;){var i=Fu,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Du;if(!o){var s=i.alternate,l=null!==s&&null!==s.memoizedState||Ou;s=Du;var c=Ou;if(Du=o,(Ou=l)&&!c)for(Fu=i;null!==Fu;)l=(o=Fu).child,22===o.tag&&null!==o.memoizedState?cd(i):null!==l?(l.return=o,Fu=l):cd(i);for(;null!==a;)Fu=a,od(a),a=a.sibling;Fu=i,Du=s,Ou=c}sd(e)}else 8772&i.subtreeFlags&&null!==a?(a.return=i,Fu=a):sd(e)}}function sd(e){for(;null!==Fu;){var t=Fu;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Ou||Gu(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ou)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Vc(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Nl(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Nl(t,o,n)}break;case 5:var s=t.stateNode;if(null===n&&4&t.flags){n=s;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Ai(d)}}}break;default:throw Error($t(163))}Ou||512&t.flags&&Wu(t)}catch(h){dh(t,t.return,h)}}if(t===e){Fu=null;break}if(null!==(n=t.sibling)){n.return=t.return,Fu=n;break}Fu=t.return}}function ld(e){for(;null!==Fu;){var t=Fu;if(t===e){Fu=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Fu=n;break}Fu=t.return}}function cd(e){for(;null!==Fu;){var t=Fu;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Gu(4,t)}catch(l){dh(t,n,l)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){dh(t,i,l)}}var a=t.return;try{Wu(t)}catch(l){dh(t,a,l)}break;case 5:var o=t.return;try{Wu(t)}catch(l){dh(t,o,l)}}}catch(l){dh(t,t.return,l)}if(t===e){Fu=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Fu=s;break}Fu=t.return}}var ud,dd=Math.ceil,hd=ln.ReactCurrentDispatcher,pd=ln.ReactCurrentOwner,md=ln.ReactCurrentBatchConfig,fd=0,gd=null,vd=null,yd=0,_d=0,xd=hs(0),bd=0,wd=null,Sd=0,Md=0,Ed=0,Cd=null,Td=null,kd=0,Pd=1/0,Ad=null,Nd=!1,Rd=null,Ld=null,Id=!1,jd=null,Dd=0,Od=0,Ud=null,Fd=-1,zd=0;function Bd(){return 6&fd?Fr():-1!==Fd?Fd:Fd=Fr()}function Hd(e){return 1&e.mode?2&fd&&0!==yd?yd&-yd:null!==rl.transition?(0===zd&&(zd=ri()),zd):0!==(e=si)?e:e=void 0===(e=window.event)?16:Ui(e.type):1}function Vd(e,t,n,r){if(50<Od)throw Od=0,Ud=null,Error($t(185));ai(e,n,r),2&fd&&e===gd||(e===gd&&(!(2&fd)&&(Md|=n),4===bd&&qd(e,yd)),Gd(e,r),1===n&&0===fd&&!(1&t.mode)&&(Pd=Fr()+500,Ts&&As()))}function Gd(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-qr(a),s=1<<o,l=i[o];-1===l?0!==(s&n)&&0===(s&r)||(i[o]=ti(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ei(e,e===gd?yd:0);if(0===r)null!==n&&Dr(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Dr(n),1===t)0===e.tag?function(e){Ts=!0,Ps(e)}(Kd.bind(null,e)):Ps(Kd.bind(null,e)),qo(function(){!(6&fd)&&As()}),n=null;else{switch(li(r)){case 1:n=Br;break;case 4:n=Hr;break;case 16:default:n=Vr;break;case 536870912:n=Wr}n=gh(n,Wd.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Wd(e,t){if(Fd=-1,zd=0,6&fd)throw Error($t(327));var n=e.callbackNode;if(ch()&&e.callbackNode!==n)return null;var r=ei(e,e===gd?yd:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||t)t=rh(e,r);else{t=r;var i=fd;fd|=2;var a=th();for(gd===e&&yd===t||(Ad=null,Pd=Fr()+500,Qd(e,t));;)try{ah();break}catch(s){eh(e,s)}ml(),hd.current=a,fd=i,null!==vd?t=0:(gd=null,yd=0,t=bd)}if(0!==t){if(2===t&&(0!==(i=ni(e))&&(r=i,t=$d(e,i))),1===t)throw n=wd,Qd(e,0),qd(e,r),Gd(e,Fr()),n;if(6===t)qd(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!qa(a(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)||(t=rh(e,r),2===t&&(a=ni(e),0!==a&&(r=a,t=$d(e,a))),1!==t)))throw n=wd,Qd(e,0),qd(e,r),Gd(e,Fr()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error($t(345));case 2:case 5:lh(e,Td,Ad);break;case 3:if(qd(e,r),(130023424&r)===r&&10<(t=kd+500-Fr())){if(0!==ei(e,0))break;if(((i=e.suspendedLanes)&r)!==r){Bd(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Wo(lh.bind(null,e,Td,Ad),t);break}lh(e,Td,Ad);break;case 4:if(qd(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-qr(r);a=1<<o,(o=t[o])>i&&(i=o),r&=~a}if(r=i,10<(r=(120>(r=Fr()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*dd(r/1960))-r)){e.timeoutHandle=Wo(lh.bind(null,e,Td,Ad),r);break}lh(e,Td,Ad);break;default:throw Error($t(329))}}}return Gd(e,Fr()),e.callbackNode===n?Wd.bind(null,e):null}function $d(e,t){var n=Cd;return e.current.memoizedState.isDehydrated&&(Qd(e,t).flags|=256),2!==(e=rh(e,t))&&(t=Td,Td=n,null!==t&&Xd(t)),e}function Xd(e){null===Td?Td=e:Td.push.apply(Td,e)}function qd(e,t){for(t&=~Ed,t&=~Md,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-qr(t),r=1<<n;e[n]=-1,t&=~r}}function Kd(e){if(6&fd)throw Error($t(327));ch();var t=ei(e,0);if(!(1&t))return Gd(e,Fr()),null;var n=rh(e,t);if(0!==e.tag&&2===n){var r=ni(e);0!==r&&(t=r,n=$d(e,r))}if(1===n)throw n=wd,Qd(e,0),qd(e,t),Gd(e,Fr()),n;if(6===n)throw Error($t(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,lh(e,Td,Ad),Gd(e,Fr()),null}function Yd(e,t){var n=fd;fd|=1;try{return e(t)}finally{0===(fd=n)&&(Pd=Fr()+500,Ts&&As())}}function Zd(e){null!==jd&&0===jd.tag&&!(6&fd)&&ch();var t=fd;fd|=1;var n=md.transition,r=si;try{if(md.transition=null,si=1,e)return e()}finally{si=r,md.transition=n,!(6&(fd=t))&&As()}}function Jd(){_d=xd.current,ps(xd)}function Qd(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,$o(n)),null!==vd)for(n=vd.return;null!==n;){var r=n;switch(Vs(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&bs();break;case 3:Ul(),ps(vs),ps(gs),Gl();break;case 5:zl(r);break;case 4:Ul();break;case 13:case 19:ps(Bl);break;case 10:fl(r.type._context);break;case 22:case 23:Jd()}n=n.return}if(gd=e,vd=e=xh(e.current,null),yd=_d=t,bd=0,wd=null,Ed=Md=Sd=0,Td=Cd=null,null!==_l){for(t=0;t<_l.length;t++)if(null!==(r=(n=_l[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}_l=null}return e}function eh(e,t){for(;;){var n=vd;try{if(ml(),Wl.current=Fc,Zl){for(var r=ql.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Zl=!1}if(Xl=0,Yl=Kl=ql=null,Jl=!1,Ql=0,pd.current=null,null===n||null===n.return){bd=1,wd=t,vd=null;break}e:{var a=e,o=n.return,s=n,l=t;if(t=yd,s.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l,u=s,d=u.tag;if(!(1&u.mode||0!==d&&11!==d&&15!==d)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=ru(o);if(null!==p){p.flags&=-257,iu(p,o,s,0,t),1&p.mode&&nu(a,c,t),l=c;var m=(t=p).updateQueue;if(null===m){var f=new Set;f.add(l),t.updateQueue=f}else m.add(l);break e}if(!(1&t)){nu(a,c,t),nh();break e}l=Error($t(426))}else if($s&&1&s.mode){var g=ru(o);if(null!==g){!(65536&g.flags)&&(g.flags|=256),iu(g,o,s,0,t),nl(Yc(l,s));break e}}a=l=Yc(l,s),4!==bd&&(bd=2),null===Cd?Cd=[a]:Cd.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Pl(a,eu(0,l,t));break e;case 1:s=l;var v=a.type,y=a.stateNode;if(!(128&a.flags||"function"!=typeof v.getDerivedStateFromError&&(null===y||"function"!=typeof y.componentDidCatch||null!==Ld&&Ld.has(y)))){a.flags|=65536,t&=-t,a.lanes|=t,Pl(a,tu(a,s,t));break e}}a=a.return}while(null!==a)}sh(n)}catch(_){t=_,vd===n&&null!==n&&(vd=n=n.return);continue}break}}function th(){var e=hd.current;return hd.current=Fc,null===e?Fc:e}function nh(){0!==bd&&3!==bd&&2!==bd||(bd=4),null===gd||!(268435455&Sd)&&!(268435455&Md)||qd(gd,yd)}function rh(e,t){var n=fd;fd|=2;var r=th();for(gd===e&&yd===t||(Ad=null,Qd(e,t));;)try{ih();break}catch(i){eh(e,i)}if(ml(),fd=n,hd.current=r,null!==vd)throw Error($t(261));return gd=null,yd=0,bd}function ih(){for(;null!==vd;)oh(vd)}function ah(){for(;null!==vd&&!Or();)oh(vd)}function oh(e){var t=ud(e.alternate,e,_d);e.memoizedProps=e.pendingProps,null===t?sh(e):vd=t,pd.current=null}function sh(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=ju(n,t)))return n.flags&=32767,void(vd=n);if(null===e)return bd=6,void(vd=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Iu(n,t,_d)))return void(vd=n);if(null!==(t=t.sibling))return void(vd=t);vd=t=e}while(null!==t);0===bd&&(bd=5)}function lh(e,t,n){var r=si,i=md.transition;try{md.transition=null,si=1,function(e,t,n,r){do{ch()}while(null!==jd);if(6&fd)throw Error($t(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error($t(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-qr(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,a),e===gd&&(vd=gd=null,yd=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Id||(Id=!0,gh(Vr,function(){return ch(),null})),a=!!(15990&n.flags),!!(15990&n.subtreeFlags)||a){a=md.transition,md.transition=null;var o=si;si=1;var s=fd;fd|=4,pd.current=null,function(e,t){if(Ho=Ri,eo(e=Qa())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(x){n=null;break e}var o=0,s=-1,l=-1,c=0,u=0,d=e,h=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(s=o+i),d!==a||0!==r&&3!==d.nodeType||(l=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)h=d,d=p;for(;;){if(d===e)break t;if(h===n&&++c===i&&(s=o),h===a&&++u===r&&(l=o),null!==(p=d.nextSibling))break;h=(d=h).parentNode}d=p}n=-1===s||-1===l?null:{start:s,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Vo={focusedElem:e,selectionRange:n},Ri=!1,Fu=t;null!==Fu;)if(e=(t=Fu).child,1028&t.subtreeFlags&&null!==e)e.return=t,Fu=e;else for(;null!==Fu;){t=Fu;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var f=m.memoizedProps,g=m.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?f:Vc(t.type,f),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error($t(163))}}catch(x){dh(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Fu=e;break}Fu=t.return}m=Hu,Hu=!1}(e,n),rd(n,e),to(Vo),Ri=!!Ho,Vo=Ho=null,e.current=n,ad(n),Ur(),fd=s,si=o,md.transition=a}else e.current=n;if(Id&&(Id=!1,jd=e,Dd=i),a=e.pendingLanes,0===a&&(Ld=null),function(e){if(Xr&&"function"==typeof Xr.onCommitFiberRoot)try{Xr.onCommitFiberRoot($r,e,void 0,!(128&~e.current.flags))}catch(t){}}(n.stateNode),Gd(e,Fr()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Nd)throw Nd=!1,e=Rd,Rd=null,e;!!(1&Dd)&&0!==e.tag&&ch(),a=e.pendingLanes,1&a?e===Ud?Od++:(Od=0,Ud=e):Od=0,As()}(e,t,n,r)}finally{md.transition=i,si=r}return null}function ch(){if(null!==jd){var e=li(Dd),t=md.transition,n=si;try{if(md.transition=null,si=16>e?16:e,null===jd)var r=!1;else{if(e=jd,jd=null,Dd=0,6&fd)throw Error($t(331));var i=fd;for(fd|=4,Fu=e.current;null!==Fu;){var a=Fu,o=a.child;if(16&Fu.flags){var s=a.deletions;if(null!==s){for(var l=0;l<s.length;l++){var c=s[l];for(Fu=c;null!==Fu;){var u=Fu;switch(u.tag){case 0:case 11:case 15:Vu(8,u,a)}var d=u.child;if(null!==d)d.return=u,Fu=d;else for(;null!==Fu;){var h=(u=Fu).sibling,p=u.return;if($u(u),u===c){Fu=null;break}if(null!==h){h.return=p,Fu=h;break}Fu=p}}}var m=a.alternate;if(null!==m){var f=m.child;if(null!==f){m.child=null;do{var g=f.sibling;f.sibling=null,f=g}while(null!==f)}}Fu=a}}if(2064&a.subtreeFlags&&null!==o)o.return=a,Fu=o;else e:for(;null!==Fu;){if(2048&(a=Fu).flags)switch(a.tag){case 0:case 11:case 15:Vu(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,Fu=v;break e}Fu=a.return}}var y=e.current;for(Fu=y;null!==Fu;){var _=(o=Fu).child;if(2064&o.subtreeFlags&&null!==_)_.return=o,Fu=_;else e:for(o=y;null!==Fu;){if(2048&(s=Fu).flags)try{switch(s.tag){case 0:case 11:case 15:Gu(9,s)}}catch(b){dh(s,s.return,b)}if(s===o){Fu=null;break e}var x=s.sibling;if(null!==x){x.return=s.return,Fu=x;break e}Fu=s.return}}if(fd=i,As(),Xr&&"function"==typeof Xr.onPostCommitFiberRoot)try{Xr.onPostCommitFiberRoot($r,e)}catch(b){}r=!0}return r}finally{si=n,md.transition=t}}return!1}function uh(e,t,n){e=Tl(e,t=eu(0,t=Yc(n,t),1),1),t=Bd(),null!==e&&(ai(e,1,t),Gd(e,t))}function dh(e,t,n){if(3===e.tag)uh(e,e,n);else for(;null!==t;){if(3===t.tag){uh(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Ld||!Ld.has(r))){t=Tl(t,e=tu(t,e=Yc(n,e),1),1),e=Bd(),null!==t&&(ai(t,1,e),Gd(t,e));break}}t=t.return}}function hh(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Bd(),e.pingedLanes|=e.suspendedLanes&n,gd===e&&(yd&n)===n&&(4===bd||3===bd&&(130023424&yd)===yd&&500>Fr()-kd?Qd(e,0):Ed|=n),Gd(e,t)}function ph(e,t){0===t&&(1&e.mode?(t=Jr,!(130023424&(Jr<<=1))&&(Jr=4194304)):t=1);var n=Bd();null!==(e=wl(e,t))&&(ai(e,t,n),Gd(e,n))}function mh(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ph(e,n)}function fh(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error($t(314))}null!==r&&r.delete(t),ph(e,n)}function gh(e,t){return jr(e,t)}function vh(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yh(e,t,n,r){return new vh(e,t,n,r)}function _h(e){return!(!(e=e.prototype)||!e.isReactComponent)}function xh(e,t){var n=e.alternate;return null===n?((n=yh(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function bh(e,t,n,r,i,a){var o=2;if(r=e,"function"==typeof e)_h(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case dn:return wh(n.children,i,a,t);case hn:o=8,i|=8;break;case pn:return(e=yh(12,n,t,2|i)).elementType=pn,e.lanes=a,e;case vn:return(e=yh(13,n,t,i)).elementType=vn,e.lanes=a,e;case yn:return(e=yh(19,n,t,i)).elementType=yn,e.lanes=a,e;case bn:return Sh(n,i,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case mn:o=10;break e;case fn:o=9;break e;case gn:o=11;break e;case _n:o=14;break e;case xn:o=16,r=null;break e}throw Error($t(130,null==e?e:typeof e,""))}return(t=yh(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function wh(e,t,n,r){return(e=yh(7,e,r,t)).lanes=n,e}function Sh(e,t,n,r){return(e=yh(22,e,r,t)).elementType=bn,e.lanes=n,e.stateNode={isHidden:!1},e}function Mh(e,t,n){return(e=yh(6,e,null,t)).lanes=n,e}function Eh(e,t,n){return(t=yh(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ch(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ii(0),this.expirationTimes=ii(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ii(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Th(e,t,n,r,i,a,o,s,l){return e=new Ch(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=yh(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ml(a),e}function kh(e){if(!e)return fs;e:{if(Ar(e=e._reactInternals)!==e||1!==e.tag)throw Error($t(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xs(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error($t(171))}if(1===e.tag){var n=e.type;if(xs(n))return Ss(e,n,t)}return t}function Ph(e,t,n,r,i,a,o,s,l){return(e=Th(n,r,!0,e,0,a,0,s,l)).context=kh(null),n=e.current,(a=Cl(r=Bd(),i=Hd(n))).callback=null!=t?t:null,Tl(n,a,i),e.current.lanes=i,ai(e,i,r),Gd(e,r),e}function Ah(e,t,n,r){var i=t.current,a=Bd(),o=Hd(i);return n=kh(n),null===t.context?t.context=n:t.pendingContext=n,(t=Cl(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Tl(i,t,o))&&(Vd(e,i,o,a),kl(e,i,o)),o}function Nh(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Rh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Lh(e,t){Rh(e,t),(e=e.alternate)&&Rh(e,t)}ud=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||vs.current)ou=!0;else{if(0===(e.lanes&n)&&!(128&t.flags))return ou=!1,function(e,t,n){switch(t.tag){case 3:gu(t),tl();break;case 5:Fl(t);break;case 1:xs(t.type)&&Ms(t);break;case 4:Ol(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;ms(ul,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(ms(Bl,1&Bl.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Mu(e,t,n):(ms(Bl,1&Bl.current),null!==(e=Nu(e,t,n))?e.sibling:null);ms(Bl,1&Bl.current);break;case 19:if(r=0!==(n&t.childLanes),128&e.flags){if(r)return Pu(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ms(Bl,Bl.current),r)break;return null;case 22:case 23:return t.lanes=0,du(e,t,n)}return Nu(e,t,n)}(e,t,n);ou=!!(131072&e.flags)}else ou=!1,$s&&1048576&t.flags&&Bs(t,Is,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Au(e,t),e=t.pendingProps;var i=_s(t,gs.current);vl(t,n),i=rc(null,t,r,e,i,n);var a=ic();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xs(r)?(a=!0,Ms(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ml(t),i.updater=Wc,t.stateNode=i,i._reactInternals=t,Kc(t,r,e,n),t=fu(null,t,r,!0,a,n)):(t.tag=0,$s&&a&&Hs(t),su(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Au(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return _h(e)?1:0;if(null!=e){if((e=e.$$typeof)===gn)return 11;if(e===_n)return 14}return 2}(r),e=Vc(r,e),i){case 0:t=pu(null,t,r,e,n);break e;case 1:t=mu(null,t,r,e,n);break e;case 11:t=lu(null,t,r,e,n);break e;case 14:t=cu(null,t,r,Vc(r.type,e),n);break e}throw Error($t(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,pu(e,t,r,i=t.elementType===r?i:Vc(r,i),n);case 1:return r=t.type,i=t.pendingProps,mu(e,t,r,i=t.elementType===r?i:Vc(r,i),n);case 3:e:{if(gu(t),null===e)throw Error($t(387));r=t.pendingProps,i=(a=t.memoizedState).element,El(e,t),Al(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=vu(e,t,r,n,i=Yc(Error($t(423)),t));break e}if(r!==i){t=vu(e,t,r,n,i=Yc(Error($t(424)),t));break e}for(Ws=Zo(t.stateNode.containerInfo.firstChild),Gs=t,$s=!0,Xs=null,n=cl(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(tl(),r===i){t=Nu(e,t,n);break e}su(e,t,r,n)}t=t.child}return t;case 5:return Fl(t),null===e&&Zs(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,Go(r,i)?o=null:null!==a&&Go(r,a)&&(t.flags|=32),hu(e,t),su(e,t,o,n),t.child;case 6:return null===e&&Zs(t),null;case 13:return Mu(e,t,n);case 4:return Ol(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ll(t,null,r,n):su(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,lu(e,t,r,i=t.elementType===r?i:Vc(r,i),n);case 7:return su(e,t,t.pendingProps,n),t.child;case 8:case 12:return su(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,ms(ul,r._currentValue),r._currentValue=o,null!==a)if(qa(a.value,o)){if(a.children===i.children&&!vs.current){t=Nu(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var s=a.dependencies;if(null!==s){o=a.child;for(var l=s.firstContext;null!==l;){if(l.context===r){if(1===a.tag){(l=Cl(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var u=(c=c.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),gl(a.return,n,t),s.lanes|=n;break}l=l.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error($t(341));o.lanes|=n,null!==(s=o.alternate)&&(s.lanes|=n),gl(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}su(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,vl(t,n),r=r(i=yl(i)),t.flags|=1,su(e,t,r,n),t.child;case 14:return i=Vc(r=t.type,t.pendingProps),cu(e,t,r,i=Vc(r.type,i),n);case 15:return uu(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Vc(r,i),Au(e,t),t.tag=1,xs(r)?(e=!0,Ms(t)):e=!1,vl(t,n),Xc(t,r,i),Kc(t,r,i,n),fu(null,t,r,!0,e,n);case 19:return Pu(e,t,n);case 22:return du(e,t,n)}throw Error($t(156,t.tag))};var Ih="function"==typeof reportError?reportError:function(e){console.error(e)};function jh(e){this._internalRoot=e}function Dh(e){this._internalRoot=e}function Oh(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Uh(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Fh(){}function zh(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"==typeof i){var s=i;i=function(){var e=Nh(o);s.call(e)}}Ah(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"==typeof r){var a=r;r=function(){var e=Nh(o);a.call(e)}}var o=Ph(t,r,e,0,null,!1,0,"",Fh);return e._reactRootContainer=o,e[ns]=o.current,Ao(8===e.nodeType?e.parentNode:e),Zd(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var s=r;r=function(){var e=Nh(l);s.call(e)}}var l=Th(e,0,!1,null,0,!1,0,"",Fh);return e._reactRootContainer=l,e[ns]=l.current,Ao(8===e.nodeType?e.parentNode:e),Zd(function(){Ah(t,l,n,r)}),l}(n,t,e,i,r);return Nh(o)}Dh.prototype.render=jh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error($t(409));Ah(e,t,null,null)},Dh.prototype.unmount=jh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Zd(function(){Ah(null,e,null,null)}),t[ns]=null}},Dh.prototype.unstable_scheduleHydration=function(e){if(e){var t=hi();e={blockedOn:null,target:e,priority:t};for(var n=0;n<bi.length&&0!==t&&t<bi[n].priority;n++);bi.splice(n,0,e),0===n&&Ei(e)}},ci=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Qr(t.pendingLanes);0!==n&&(oi(t,1|n),Gd(t,Fr()),!(6&fd)&&(Pd=Fr()+500,As()))}break;case 13:Zd(function(){var t=wl(e,1);if(null!==t){var n=Bd();Vd(t,e,1,n)}}),Lh(e,1)}},ui=function(e){if(13===e.tag){var t=wl(e,134217728);if(null!==t)Vd(t,e,134217728,Bd());Lh(e,134217728)}},di=function(e){if(13===e.tag){var t=Hd(e),n=wl(e,t);if(null!==n)Vd(n,e,t,Bd());Lh(e,t)}},hi=function(){return si},pi=function(e,t){var n=si;try{return si=e,t()}finally{si=n}},ur=function(e,t,n){switch(t){case"input":if(zn(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=cs(r);if(!i)throw Error($t(90));jn(r),zn(r,i)}}}break;case"textarea":Xn(e,n);break;case"select":null!=(t=n.value)&&Gn(e,!!n.multiple,t,!1)}},gr=Yd,vr=Zd;var Bh={usingClientEntryPoint:!1,Events:[ss,ls,cs,mr,fr,Yd]},Hh={findFiberByHostInstance:os,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Vh={bundleType:Hh.bundleType,version:Hh.version,rendererPackageName:Hh.rendererPackageName,rendererConfig:Hh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ln.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Lr(e))?null:e.stateNode},findFiberByHostInstance:Hh.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Gh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gh.isDisabled&&Gh.supportsFiber)try{$r=Gh.inject(Vh),Xr=Gh}catch(Jn){}}zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bh,zt.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Oh(t))throw Error($t(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:un,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},zt.createRoot=function(e,t){if(!Oh(e))throw Error($t(299));var n=!1,r="",i=Ih;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Th(e,1,!1,null,0,n,0,r,i),e[ns]=t.current,Ao(8===e.nodeType?e.parentNode:e),new jh(t)},zt.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error($t(188));throw e=Object.keys(e).join(","),Error($t(268,e))}return e=null===(e=Lr(t))?null:e.stateNode},zt.flushSync=function(e){return Zd(e)},zt.hydrate=function(e,t,n){if(!Uh(t))throw Error($t(200));return zh(null,e,t,!0,n)},zt.hydrateRoot=function(e,t,n){if(!Oh(e))throw Error($t(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",o=Ih;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Ph(t,null,e,1,null!=n?n:null,i,0,a,o),e[ns]=t.current,Ao(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Dh(t)},zt.render=function(e,t,n){if(!Uh(t))throw Error($t(200));return zh(null,e,t,!1,n)},zt.unmountComponentAtNode=function(e){if(!Uh(e))throw Error($t(40));return!!e._reactRootContainer&&(Zd(function(){zh(null,null,e,!1,function(){e._reactRootContainer=null,e[ns]=null})}),!0)},zt.unstable_batchedUpdates=Yd,zt.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Uh(n))throw Error($t(200));if(null==e||void 0===e._reactInternals)throw Error($t(38));return zh(e,t,n,!1,r)},zt.version="18.3.1-next-f1338f8080-20240426",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),Ft.exports=zt;var Wh=Ft.exports;Ut.createRoot=Wh.createRoot,Ut.hydrateRoot=Wh.hydrateRoot;var $h=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xh={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},qh=new(n=class{constructor(){Ue(this,e,Xh),Ue(this,t,!1)}setTimeoutProvider(t){Fe(this,e,t)}setTimeout(t,n){return Oe(this,e).setTimeout(t,n)}clearTimeout(t){Oe(this,e).clearTimeout(t)}setInterval(t,n){return Oe(this,e).setInterval(t,n)}clearInterval(t){Oe(this,e).clearInterval(t)}},e=new WeakMap,t=new WeakMap,n);var Kh="undefined"==typeof window||"Deno"in globalThis;function Yh(){}function Zh(e){return"number"==typeof e&&e>=0&&e!==1/0}function Jh(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Qh(e,t){return"function"==typeof e?e(t):e}function ep(e,t){return"function"==typeof e?e(t):e}function tp(e,t){const{type:n="all",exact:r,fetchStatus:i,predicate:a,queryKey:o,stale:s}=e;if(o)if(r){if(t.queryHash!==rp(o,t.options))return!1}else if(!ap(t.queryKey,o))return!1;if("all"!==n){const e=t.isActive();if("active"===n&&!e)return!1;if("inactive"===n&&e)return!1}return("boolean"!=typeof s||t.isStale()===s)&&((!i||i===t.state.fetchStatus)&&!(a&&!a(t)))}function np(e,t){const{exact:n,status:r,predicate:i,mutationKey:a}=e;if(a){if(!t.options.mutationKey)return!1;if(n){if(ip(t.options.mutationKey)!==ip(a))return!1}else if(!ap(t.options.mutationKey,a))return!1}return(!r||t.state.status===r)&&!(i&&!i(t))}function rp(e,t){return((null==t?void 0:t.queryKeyHashFn)||ip)(e)}function ip(e){return JSON.stringify(e,(e,t)=>up(t)?Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{}):t)}function ap(e,t){return e===t||typeof e==typeof t&&(!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(n=>ap(e[n],t[n])))}var op=Object.prototype.hasOwnProperty;function sp(e,t,n=0){if(e===t)return e;if(n>500)return t;const r=cp(e)&&cp(t);if(!(r||up(e)&&up(t)))return t;const i=(r?e:Object.keys(e)).length,a=r?t:Object.keys(t),o=a.length,s=r?new Array(o):{};let l=0;for(let c=0;c<o;c++){const o=r?c:a[c],u=e[o],d=t[o];if(u===d){s[o]=u,(r?c<i:op.call(e,o))&&l++;continue}if(null===u||null===d||"object"!=typeof u||"object"!=typeof d){s[o]=d;continue}const h=sp(u,d,n+1);s[o]=h,h===u&&l++}return i===o&&l===i?e:s}function lp(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function cp(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function up(e){if(!dp(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!!dp(n)&&(!!n.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function dp(e){return"[object Object]"===Object.prototype.toString.call(e)}function hp(e,t,n){return"function"==typeof n.structuralSharing?n.structuralSharing(e,t):!1!==n.structuralSharing?sp(e,t):t}function pp(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function mp(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var fp=Symbol();function gp(e,t){return!e.queryFn&&(null==t?void 0:t.initialPromise)?()=>t.initialPromise:e.queryFn&&e.queryFn!==fp?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}function vp(e,t){return"function"==typeof e?e(...t):!!e}var yp=new(o=class extends $h{constructor(){super(),Ue(this,r),Ue(this,i),Ue(this,a),Fe(this,a,e=>{if(!Kh&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){Oe(this,i)||this.setEventListener(Oe(this,a))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=Oe(this,i))||e.call(this),Fe(this,i,void 0))}setEventListener(e){var t;Fe(this,a,e),null==(t=Oe(this,i))||t.call(this),Fe(this,i,e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){Oe(this,r)!==e&&(Fe(this,r,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return"boolean"==typeof Oe(this,r)?Oe(this,r):"hidden"!==(null==(e=globalThis.document)?void 0:e.visibilityState)}},r=new WeakMap,i=new WeakMap,a=new WeakMap,o);function _p(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});function r(e){Object.assign(n,e),delete n.resolve,delete n.reject}return n.status="pending",n.catch(()=>{}),n.resolve=t=>{r({status:"fulfilled",value:t}),e(t)},n.reject=e=>{r({status:"rejected",reason:e}),t(e)},n}var xp=function(e){setTimeout(e,0)};var bp=function(){let e=[],t=0,n=e=>{e()},r=e=>{e()},i=xp;const a=r=>{t?e.push(r):i(()=>{n(r)})};return{batch:a=>{let o;t++;try{o=a()}finally{t--,t||(()=>{const t=e;e=[],t.length&&i(()=>{r(()=>{t.forEach(e=>{n(e)})})})})()}return o},batchCalls:e=>(...t)=>{a(()=>{e(...t)})},schedule:a,setNotifyFunction:e=>{n=e},setBatchNotifyFunction:e=>{r=e},setScheduler:e=>{i=e}}}(),wp=new(u=class extends $h{constructor(){super(),Ue(this,s,!0),Ue(this,l),Ue(this,c),Fe(this,c,e=>{if(!Kh&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){Oe(this,l)||this.setEventListener(Oe(this,c))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=Oe(this,l))||e.call(this),Fe(this,l,void 0))}setEventListener(e){var t;Fe(this,c,e),null==(t=Oe(this,l))||t.call(this),Fe(this,l,e(this.setOnline.bind(this)))}setOnline(e){Oe(this,s)!==e&&(Fe(this,s,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return Oe(this,s)}},s=new WeakMap,l=new WeakMap,c=new WeakMap,u);function Sp(e){return Math.min(1e3*2**e,3e4)}function Mp(e){return"online"!==(e??"online")||wp.isOnline()}var Ep=class extends Error{constructor(e){super("CancelledError"),this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent}};function Cp(e){let t,n=!1,r=0;const i=_p(),a=()=>"pending"!==i.status,o=()=>yp.isFocused()&&("always"===e.networkMode||wp.isOnline())&&e.canRun(),s=()=>Mp(e.networkMode)&&e.canRun(),l=e=>{a()||(null==t||t(),i.resolve(e))},c=e=>{a()||(null==t||t(),i.reject(e))},u=()=>new Promise(n=>{var r;t=e=>{(a()||o())&&n(e)},null==(r=e.onPause)||r.call(e)}).then(()=>{var n;t=void 0,a()||null==(n=e.onContinue)||n.call(e)}),d=()=>{if(a())return;let t;const i=0===r?e.initialPromise:void 0;try{t=i??e.fn()}catch(s){t=Promise.reject(s)}Promise.resolve(t).then(l).catch(t=>{var i;if(a())return;const s=e.retry??(Kh?0:3),l=e.retryDelay??Sp,h="function"==typeof l?l(r,t):l,p=!0===s||"number"==typeof s&&r<s||"function"==typeof s&&s(r,t);var m;!n&&p?(r++,null==(i=e.onFail)||i.call(e,r,t),(m=h,new Promise(e=>{qh.setTimeout(e,m)})).then(()=>o()?void 0:u()).then(()=>{n?c(t):d()})):c(t)})};return{promise:i,status:()=>i.status,cancel:t=>{var n;if(!a()){const r=new Ep(t);c(r),null==(n=e.onCancel)||n.call(e,r)}},continue:()=>(null==t||t(),i),cancelRetry:()=>{n=!0},continueRetry:()=>{n=!1},canStart:s,start:()=>(s()?d():u().then(d),i)}}var Tp=(h=class{constructor(){Ue(this,d)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Zh(this.gcTime)&&Fe(this,d,qh.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Kh?1/0:3e5))}clearGcTimeout(){Oe(this,d)&&(qh.clearTimeout(Oe(this,d)),Fe(this,d,void 0))}},d=new WeakMap,h),kp=(w=class extends Tp{constructor(e){super(),Ue(this,x),Ue(this,p),Ue(this,m),Ue(this,f),Ue(this,g),Ue(this,v),Ue(this,y),Ue(this,_),Fe(this,_,!1),Fe(this,y,e.defaultOptions),this.setOptions(e.options),this.observers=[],Fe(this,g,e.client),Fe(this,f,Oe(this,g).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Fe(this,p,Np(this.options)),this.state=e.state??Oe(this,p),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null==(e=Oe(this,v))?void 0:e.promise}setOptions(e){if(this.options={...Oe(this,y),...e},this.updateGcTime(this.options.gcTime),this.state&&void 0===this.state.data){const e=Np(this.options);void 0!==e.data&&(this.setState(Ap(e.data,e.dataUpdatedAt)),Fe(this,p,e))}}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||Oe(this,f).remove(this)}setData(e,t){const n=hp(this.state.data,e,this.options);return ze(this,x,b).call(this,{data:n,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt,manual:null==t?void 0:t.manual}),n}setState(e,t){ze(this,x,b).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t,n;const r=null==(t=Oe(this,v))?void 0:t.promise;return null==(n=Oe(this,v))||n.cancel(e),r?r.then(Yh).catch(Yh):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Oe(this,p))}isActive(){return this.observers.some(e=>!1!==ep(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===fp||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===Qh(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!Jh(this.state.dataUpdatedAt,e))}onFocus(){var e;const t=this.observers.find(e=>e.shouldFetchOnWindowFocus());null==t||t.refetch({cancelRefetch:!1}),null==(e=Oe(this,v))||e.continue()}onOnline(){var e;const t=this.observers.find(e=>e.shouldFetchOnReconnect());null==t||t.refetch({cancelRefetch:!1}),null==(e=Oe(this,v))||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Oe(this,f).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(Oe(this,v)&&(Oe(this,_)?Oe(this,v).cancel({revert:!0}):Oe(this,v).cancelRetry()),this.scheduleGc()),Oe(this,f).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ze(this,x,b).call(this,{type:"invalidate"})}async fetch(e,t){var n,r,i,a,o,s,l,c,u,d,h,p;if("idle"!==this.state.fetchStatus&&"rejected"!==(null==(n=Oe(this,v))?void 0:n.status()))if(void 0!==this.state.data&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(Oe(this,v))return Oe(this,v).continueRetry(),Oe(this,v).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const y=new AbortController,w=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(Fe(this,_,!0),y.signal)})},S=()=>{const e=gp(this.options,t),n=(()=>{const e={client:Oe(this,g),queryKey:this.queryKey,meta:this.meta};return w(e),e})();return Fe(this,_,!1),this.options.persister?this.options.persister(e,n,this):e(n)},M=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:Oe(this,g),state:this.state,fetchFn:S};return w(e),e})();null==(r=this.options.behavior)||r.onFetch(M,this),Fe(this,m,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===(null==(i=M.fetchOptions)?void 0:i.meta)||ze(this,x,b).call(this,{type:"fetch",meta:null==(a=M.fetchOptions)?void 0:a.meta}),Fe(this,v,Cp({initialPromise:null==t?void 0:t.initialPromise,fn:M.fetchFn,onCancel:e=>{e instanceof Ep&&e.revert&&this.setState({...Oe(this,m),fetchStatus:"idle"}),y.abort()},onFail:(e,t)=>{ze(this,x,b).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{ze(this,x,b).call(this,{type:"pause"})},onContinue:()=>{ze(this,x,b).call(this,{type:"continue"})},retry:M.options.retry,retryDelay:M.options.retryDelay,networkMode:M.options.networkMode,canRun:()=>!0}));try{const e=await Oe(this,v).start();if(void 0===e)throw new Error(`${this.queryHash} data is undefined`);return this.setData(e),null==(s=(o=Oe(this,f).config).onSuccess)||s.call(o,e,this),null==(c=(l=Oe(this,f).config).onSettled)||c.call(l,e,this.state.error,this),e}catch(E){if(E instanceof Ep){if(E.silent)return Oe(this,v).promise;if(E.revert){if(void 0===this.state.data)throw E;return this.state.data}}throw ze(this,x,b).call(this,{type:"error",error:E}),null==(d=(u=Oe(this,f).config).onError)||d.call(u,E,this),null==(p=(h=Oe(this,f).config).onSettled)||p.call(h,this.state.data,E,this),E}finally{this.scheduleGc()}}},p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,_=new WeakMap,x=new WeakSet,b=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...Pp(t.data,this.options),fetchMeta:e.meta??null};case"success":const n={...t,...Ap(e.data,e.dataUpdatedAt),dataUpdateCount:t.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Fe(this,m,e.manual?n:void 0),n;case"error":const r=e.error;return{...t,error:r,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}})(this.state),bp.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),Oe(this,f).notify({query:this,type:"updated",action:e})})},w);function Pp(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Mp(t.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}function Ap(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Np(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,n=void 0!==t,r=n?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Rp=(q=class extends $h{constructor(e,t){super(),Ue(this,U),Ue(this,S),Ue(this,M),Ue(this,E),Ue(this,C),Ue(this,T),Ue(this,k),Ue(this,P),Ue(this,A),Ue(this,N),Ue(this,R),Ue(this,L),Ue(this,I),Ue(this,j),Ue(this,D),Ue(this,O,new Set),this.options=t,Fe(this,S,e),Fe(this,A,null),Fe(this,P,_p()),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(Oe(this,M).addObserver(this),Lp(Oe(this,M),this.options)?ze(this,U,F).call(this):this.updateResult(),ze(this,U,V).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ip(Oe(this,M),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ip(Oe(this,M),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ze(this,U,G).call(this),ze(this,U,W).call(this),Oe(this,M).removeObserver(this)}setOptions(e){const t=this.options,n=Oe(this,M);if(this.options=Oe(this,S).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof ep(this.options.enabled,Oe(this,M)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ze(this,U,$).call(this),Oe(this,M).setOptions(this.options),t._defaulted&&!lp(this.options,t)&&Oe(this,S).getQueryCache().notify({type:"observerOptionsUpdated",query:Oe(this,M),observer:this});const r=this.hasListeners();r&&jp(Oe(this,M),n,this.options,t)&&ze(this,U,F).call(this),this.updateResult(),!r||Oe(this,M)===n&&ep(this.options.enabled,Oe(this,M))===ep(t.enabled,Oe(this,M))&&Qh(this.options.staleTime,Oe(this,M))===Qh(t.staleTime,Oe(this,M))||ze(this,U,z).call(this);const i=ze(this,U,B).call(this);!r||Oe(this,M)===n&&ep(this.options.enabled,Oe(this,M))===ep(t.enabled,Oe(this,M))&&i===Oe(this,D)||ze(this,U,H).call(this,i)}getOptimisticResult(e){const t=Oe(this,S).getQueryCache().build(Oe(this,S),e),n=this.createResult(t,e);return function(e,t){if(!lp(e.getCurrentResult(),t))return!0;return!1}(this,n)&&(Fe(this,C,n),Fe(this,k,this.options),Fe(this,T,Oe(this,M).state)),n}getCurrentResult(){return Oe(this,C)}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),null==t||t(n),"promise"===n&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==Oe(this,P).status||Oe(this,P).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,n))})}trackProp(e){Oe(this,O).add(e)}getCurrentQuery(){return Oe(this,M)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=Oe(this,S).defaultQueryOptions(e),n=Oe(this,S).getQueryCache().build(Oe(this,S),t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return ze(this,U,F).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),Oe(this,C)))}createResult(e,t){var n;const r=Oe(this,M),i=this.options,a=Oe(this,C),o=Oe(this,T),s=Oe(this,k),l=e!==r?e.state:Oe(this,E),{state:c}=e;let u,d={...c},h=!1;if(t._optimisticResults){const n=this.hasListeners(),a=!n&&Lp(e,t),o=n&&jp(e,r,t,i);(a||o)&&(d={...d,...Pp(c.data,e.options)}),"isRestoring"===t._optimisticResults&&(d.fetchStatus="idle")}let{error:p,errorUpdatedAt:m,status:f}=d;u=d.data;let g=!1;if(void 0!==t.placeholderData&&void 0===u&&"pending"===f){let e;(null==a?void 0:a.isPlaceholderData)&&t.placeholderData===(null==s?void 0:s.placeholderData)?(e=a.data,g=!0):e="function"==typeof t.placeholderData?t.placeholderData(null==(n=Oe(this,L))?void 0:n.state.data,Oe(this,L)):t.placeholderData,void 0!==e&&(f="success",u=hp(null==a?void 0:a.data,e,t),h=!0)}if(t.select&&void 0!==u&&!g)if(a&&u===(null==o?void 0:o.data)&&t.select===Oe(this,N))u=Oe(this,R);else try{Fe(this,N,t.select),u=t.select(u),u=hp(null==a?void 0:a.data,u,t),Fe(this,R,u),Fe(this,A,null)}catch(S){Fe(this,A,S)}Oe(this,A)&&(p=Oe(this,A),u=Oe(this,R),m=Date.now(),f="error");const v="fetching"===d.fetchStatus,y="pending"===f,_="error"===f,x=y&&v,b=void 0!==u,w={status:f,fetchStatus:d.fetchStatus,isPending:y,isSuccess:"success"===f,isError:_,isInitialLoading:x,isLoading:x,data:u,dataUpdatedAt:d.dataUpdatedAt,error:p,errorUpdatedAt:m,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>l.dataUpdateCount||d.errorUpdateCount>l.errorUpdateCount,isFetching:v,isRefetching:v&&!y,isLoadingError:_&&!b,isPaused:"paused"===d.fetchStatus,isPlaceholderData:h,isRefetchError:_&&b,isStale:Dp(e,t),refetch:this.refetch,promise:Oe(this,P),isEnabled:!1!==ep(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=void 0!==w.data,n="error"===w.status&&!t,i=e=>{n?e.reject(w.error):t&&e.resolve(w.data)},a=()=>{const e=Fe(this,P,w.promise=_p());i(e)},o=Oe(this,P);switch(o.status){case"pending":e.queryHash===r.queryHash&&i(o);break;case"fulfilled":(n||w.data!==o.value)&&a();break;case"rejected":n&&w.error===o.reason||a()}}return w}updateResult(){const e=Oe(this,C),t=this.createResult(Oe(this,M),this.options);if(Fe(this,T,Oe(this,M).state),Fe(this,k,this.options),void 0!==Oe(this,T).data&&Fe(this,L,Oe(this,M)),lp(t,e))return;Fe(this,C,t);ze(this,U,X).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,n="function"==typeof t?t():t;if("all"===n||!n&&!Oe(this,O).size)return!0;const r=new Set(n??Oe(this,O));return this.options.throwOnError&&r.add("error"),Object.keys(Oe(this,C)).some(t=>{const n=t;return Oe(this,C)[n]!==e[n]&&r.has(n)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ze(this,U,V).call(this)}},S=new WeakMap,M=new WeakMap,E=new WeakMap,C=new WeakMap,T=new WeakMap,k=new WeakMap,P=new WeakMap,A=new WeakMap,N=new WeakMap,R=new WeakMap,L=new WeakMap,I=new WeakMap,j=new WeakMap,D=new WeakMap,O=new WeakMap,U=new WeakSet,F=function(e){ze(this,U,$).call(this);let t=Oe(this,M).fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(Yh)),t},z=function(){ze(this,U,G).call(this);const e=Qh(this.options.staleTime,Oe(this,M));if(Kh||Oe(this,C).isStale||!Zh(e))return;const t=Jh(Oe(this,C).dataUpdatedAt,e)+1;Fe(this,I,qh.setTimeout(()=>{Oe(this,C).isStale||this.updateResult()},t))},B=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(Oe(this,M)):this.options.refetchInterval)??!1},H=function(e){ze(this,U,W).call(this),Fe(this,D,e),!Kh&&!1!==ep(this.options.enabled,Oe(this,M))&&Zh(Oe(this,D))&&0!==Oe(this,D)&&Fe(this,j,qh.setInterval(()=>{(this.options.refetchIntervalInBackground||yp.isFocused())&&ze(this,U,F).call(this)},Oe(this,D)))},V=function(){ze(this,U,z).call(this),ze(this,U,H).call(this,ze(this,U,B).call(this))},G=function(){Oe(this,I)&&(qh.clearTimeout(Oe(this,I)),Fe(this,I,void 0))},W=function(){Oe(this,j)&&(qh.clearInterval(Oe(this,j)),Fe(this,j,void 0))},$=function(){const e=Oe(this,S).getQueryCache().build(Oe(this,S),this.options);if(e===Oe(this,M))return;const t=Oe(this,M);Fe(this,M,e),Fe(this,E,e.state),this.hasListeners()&&(null==t||t.removeObserver(this),e.addObserver(this))},X=function(e){bp.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(Oe(this,C))}),Oe(this,S).getQueryCache().notify({query:Oe(this,M),type:"observerResultsUpdated"})})},q);function Lp(e,t){return function(e,t){return!1!==ep(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&Ip(e,t,t.refetchOnMount)}function Ip(e,t,n){if(!1!==ep(t.enabled,e)&&"static"!==Qh(t.staleTime,e)){const r="function"==typeof n?n(e):n;return"always"===r||!1!==r&&Dp(e,t)}return!1}function jp(e,t,n,r){return(e!==t||!1===ep(r.enabled,e))&&(!n.suspense||"error"!==e.state.status)&&Dp(e,n)}function Dp(e,t){return!1!==ep(t.enabled,e)&&e.isStaleByTime(Qh(t.staleTime,e))}function Op(e){return{onFetch:(t,n)=>{var r,i,a,o,s;const l=t.options,c=null==(a=null==(i=null==(r=t.fetchOptions)?void 0:r.meta)?void 0:i.fetchMore)?void 0:a.direction,u=(null==(o=t.state.data)?void 0:o.pages)||[],d=(null==(s=t.state.data)?void 0:s.pageParams)||[];let h={pages:[],pageParams:[]},p=0;const m=async()=>{let n=!1;const r=e=>{!function(e,t,n){let r,i=!1;Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(r??(r=t()),i||(i=!0,r.aborted?n():r.addEventListener("abort",n,{once:!0})),r)})}(e,()=>t.signal,()=>n=!0)},i=gp(t.options,t.fetchOptions),a=async(e,a,o)=>{if(n)return Promise.reject();if(null==a&&e.pages.length)return Promise.resolve(e);const s=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:a,direction:o?"backward":"forward",meta:t.options.meta};return r(e),e})(),l=await i(s),{maxPages:c}=t.options,u=o?mp:pp;return{pages:u(e.pages,l,c),pageParams:u(e.pageParams,a,c)}};if(c&&u.length){const e="backward"===c,t={pages:u,pageParams:d},n=(e?Fp:Up)(l,t);h=await a(t,n,e)}else{const t=e??u.length;do{const e=0===p?d[0]??l.initialPageParam:Up(l,h);if(p>0&&null==e)break;h=await a(h,e),p++}while(p<t)}return h};t.options.persister?t.fetchFn=()=>{var e,r;return null==(r=(e=t.options).persister)?void 0:r.call(e,m,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=m}}}function Up(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function Fp(e,{pages:t,pageParams:n}){var r;return t.length>0?null==(r=e.getPreviousPageParam)?void 0:r.call(e,t[0],t,n[0],n):void 0}var zp=(te=class extends Tp{constructor(e){super(),Ue(this,Q),Ue(this,K),Ue(this,Y),Ue(this,Z),Ue(this,J),Fe(this,K,e.client),this.mutationId=e.mutationId,Fe(this,Z,e.mutationCache),Fe(this,Y,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Oe(this,Y).includes(e)||(Oe(this,Y).push(e),this.clearGcTimeout(),Oe(this,Z).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Fe(this,Y,Oe(this,Y).filter(t=>t!==e)),this.scheduleGc(),Oe(this,Z).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Oe(this,Y).length||("pending"===this.state.status?this.scheduleGc():Oe(this,Z).remove(this))}continue(){var e;return(null==(e=Oe(this,J))?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var t,n,r,i,a,o,s,l,c,u,d,h,p,m,f,g,v,y,_,x;const b=()=>{ze(this,Q,ee).call(this,{type:"continue"})},w={client:Oe(this,K),meta:this.options.meta,mutationKey:this.options.mutationKey};Fe(this,J,Cp({fn:()=>this.options.mutationFn?this.options.mutationFn(e,w):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{ze(this,Q,ee).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{ze(this,Q,ee).call(this,{type:"pause"})},onContinue:b,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Oe(this,Z).canRun(this)}));const S="pending"===this.state.status,M=!Oe(this,J).canStart();try{if(S)b();else{ze(this,Q,ee).call(this,{type:"pending",variables:e,isPaused:M}),await(null==(n=(t=Oe(this,Z).config).onMutate)?void 0:n.call(t,e,this,w));const a=await(null==(i=(r=this.options).onMutate)?void 0:i.call(r,e,w));a!==this.state.context&&ze(this,Q,ee).call(this,{type:"pending",context:a,variables:e,isPaused:M})}const p=await Oe(this,J).start();return await(null==(o=(a=Oe(this,Z).config).onSuccess)?void 0:o.call(a,p,e,this.state.context,this,w)),await(null==(l=(s=this.options).onSuccess)?void 0:l.call(s,p,e,this.state.context,w)),await(null==(u=(c=Oe(this,Z).config).onSettled)?void 0:u.call(c,p,null,this.state.variables,this.state.context,this,w)),await(null==(h=(d=this.options).onSettled)?void 0:h.call(d,p,null,e,this.state.context,w)),ze(this,Q,ee).call(this,{type:"success",data:p}),p}catch(E){try{await(null==(m=(p=Oe(this,Z).config).onError)?void 0:m.call(p,E,e,this.state.context,this,w))}catch(C){Promise.reject(C)}try{await(null==(g=(f=this.options).onError)?void 0:g.call(f,E,e,this.state.context,w))}catch(C){Promise.reject(C)}try{await(null==(y=(v=Oe(this,Z).config).onSettled)?void 0:y.call(v,void 0,E,this.state.variables,this.state.context,this,w))}catch(C){Promise.reject(C)}try{await(null==(x=(_=this.options).onSettled)?void 0:x.call(_,void 0,E,e,this.state.context,w))}catch(C){Promise.reject(C)}throw ze(this,Q,ee).call(this,{type:"error",error:E}),E}finally{Oe(this,Z).runNext(this)}}},K=new WeakMap,Y=new WeakMap,Z=new WeakMap,J=new WeakMap,Q=new WeakSet,ee=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),bp.batch(()=>{Oe(this,Y).forEach(t=>{t.onMutationUpdate(e)}),Oe(this,Z).notify({mutation:this,type:"updated",action:e})})},te);var Bp=(ae=class extends $h{constructor(e={}){super(),Ue(this,ne),Ue(this,re),Ue(this,ie),this.config=e,Fe(this,ne,new Set),Fe(this,re,new Map),Fe(this,ie,0)}build(e,t,n){const r=new zp({client:e,mutationCache:this,mutationId:++Be(this,ie)._,options:e.defaultMutationOptions(t),state:n});return this.add(r),r}add(e){Oe(this,ne).add(e);const t=Hp(e);if("string"==typeof t){const n=Oe(this,re).get(t);n?n.push(e):Oe(this,re).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(Oe(this,ne).delete(e)){const t=Hp(e);if("string"==typeof t){const n=Oe(this,re).get(t);if(n)if(n.length>1){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}else n[0]===e&&Oe(this,re).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Hp(e);if("string"==typeof t){const n=Oe(this,re).get(t),r=null==n?void 0:n.find(e=>"pending"===e.state.status);return!r||r===e}return!0}runNext(e){var t;const n=Hp(e);if("string"==typeof n){const r=null==(t=Oe(this,re).get(n))?void 0:t.find(t=>t!==e&&t.state.isPaused);return(null==r?void 0:r.continue())??Promise.resolve()}return Promise.resolve()}clear(){bp.batch(()=>{Oe(this,ne).forEach(e=>{this.notify({type:"removed",mutation:e})}),Oe(this,ne).clear(),Oe(this,re).clear()})}getAll(){return Array.from(Oe(this,ne))}find(e){const t={exact:!0,...e};return this.getAll().find(e=>np(t,e))}findAll(e={}){return this.getAll().filter(t=>np(e,t))}notify(e){bp.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return bp.batch(()=>Promise.all(e.map(e=>e.continue().catch(Yh))))}},ne=new WeakMap,re=new WeakMap,ie=new WeakMap,ae);function Hp(e){var t;return null==(t=e.options.scope)?void 0:t.id}function Vp(e,t){const n=new Set(t);return e.filter(e=>!n.has(e))}var Gp=(be=class extends $h{constructor(e,t,n){super(),Ue(this,fe),Ue(this,oe),Ue(this,se),Ue(this,le),Ue(this,ce),Ue(this,ue),Ue(this,de),Ue(this,he),Ue(this,pe),Ue(this,me,[]),Fe(this,oe,e),Fe(this,ce,n),Fe(this,le,[]),Fe(this,ue,[]),Fe(this,se,[]),this.setQueries(t)}onSubscribe(){1===this.listeners.size&&Oe(this,ue).forEach(e=>{e.subscribe(t=>{ze(this,fe,_e).call(this,e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,Oe(this,ue).forEach(e=>{e.destroy()})}setQueries(e,t){Fe(this,le,e),Fe(this,ce,t),bp.batch(()=>{const e=Oe(this,ue),t=ze(this,fe,ye).call(this,Oe(this,le));t.forEach(e=>e.observer.setOptions(e.defaultedQueryOptions));const n=t.map(e=>e.observer),r=n.map(e=>e.getCurrentResult()),i=e.length!==n.length,a=n.some((t,n)=>t!==e[n]),o=i||a,s=!!o||r.some((e,t)=>{const n=Oe(this,se)[t];return!n||!lp(e,n)});(o||s)&&(o&&(Fe(this,me,t),Fe(this,ue,n)),Fe(this,se,r),this.hasListeners()&&(o&&(Vp(e,n).forEach(e=>{e.destroy()}),Vp(n,e).forEach(e=>{e.subscribe(t=>{ze(this,fe,_e).call(this,e,t)})})),ze(this,fe,xe).call(this)))})}getCurrentResult(){return Oe(this,se)}getQueries(){return Oe(this,ue).map(e=>e.getCurrentQuery())}getObservers(){return Oe(this,ue)}getOptimisticResult(e,t){const n=ze(this,fe,ye).call(this,e),r=n.map(e=>e.observer.getOptimisticResult(e.defaultedQueryOptions));return[r,e=>ze(this,fe,ve).call(this,e??r,t),()=>ze(this,fe,ge).call(this,r,n)]}},oe=new WeakMap,se=new WeakMap,le=new WeakMap,ce=new WeakMap,ue=new WeakMap,de=new WeakMap,he=new WeakMap,pe=new WeakMap,me=new WeakMap,fe=new WeakSet,ge=function(e,t){return t.map((n,r)=>{const i=e[r];return n.defaultedQueryOptions.notifyOnChangeProps?i:n.observer.trackResult(i,e=>{t.forEach(t=>{t.observer.trackProp(e)})})})},ve=function(e,t){return t?(Oe(this,de)&&Oe(this,se)===Oe(this,pe)&&t===Oe(this,he)||(Fe(this,he,t),Fe(this,pe,Oe(this,se)),Fe(this,de,sp(Oe(this,de),t(e)))),Oe(this,de)):e},ye=function(e){const t=new Map;Oe(this,ue).forEach(e=>{const n=e.options.queryHash;if(!n)return;const r=t.get(n);r?r.push(e):t.set(n,[e])});const n=[];return e.forEach(e=>{var r;const i=Oe(this,oe).defaultQueryOptions(e),a=(null==(r=t.get(i.queryHash))?void 0:r.shift())??new Rp(Oe(this,oe),i);n.push({defaultedQueryOptions:i,observer:a})}),n},_e=function(e,t){const n=Oe(this,ue).indexOf(e);-1!==n&&(Fe(this,se,function(e,t,n){const r=e.slice(0);return r[t]=n,r}(Oe(this,se),n,t)),ze(this,fe,xe).call(this))},xe=function(){var e;if(this.hasListeners()){const t=Oe(this,de),n=ze(this,fe,ge).call(this,Oe(this,se),Oe(this,me));t!==ze(this,fe,ve).call(this,n,null==(e=Oe(this,ce))?void 0:e.combine)&&bp.batch(()=>{this.listeners.forEach(e=>{e(Oe(this,se))})})}},be),Wp=(Se=class extends $h{constructor(e={}){super(),Ue(this,we),this.config=e,Fe(this,we,new Map)}build(e,t,n){const r=t.queryKey,i=t.queryHash??rp(r,t);let a=this.get(i);return a||(a=new kp({client:e,queryKey:r,queryHash:i,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r)}),this.add(a)),a}add(e){Oe(this,we).has(e.queryHash)||(Oe(this,we).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=Oe(this,we).get(e.queryHash);t&&(e.destroy(),t===e&&Oe(this,we).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){bp.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Oe(this,we).get(e)}getAll(){return[...Oe(this,we).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>tp(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>tp(e,t)):t}notify(e){bp.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){bp.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){bp.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},we=new WeakMap,Se),$p=(Re=class{constructor(e={}){Ue(this,Me),Ue(this,Ee),Ue(this,Ce),Ue(this,Te),Ue(this,ke),Ue(this,Pe),Ue(this,Ae),Ue(this,Ne),Fe(this,Me,e.queryCache||new Wp),Fe(this,Ee,e.mutationCache||new Bp),Fe(this,Ce,e.defaultOptions||{}),Fe(this,Te,new Map),Fe(this,ke,new Map),Fe(this,Pe,0)}mount(){Be(this,Pe)._++,1===Oe(this,Pe)&&(Fe(this,Ae,yp.subscribe(async e=>{e&&(await this.resumePausedMutations(),Oe(this,Me).onFocus())})),Fe(this,Ne,wp.subscribe(async e=>{e&&(await this.resumePausedMutations(),Oe(this,Me).onOnline())})))}unmount(){var e,t;Be(this,Pe)._--,0===Oe(this,Pe)&&(null==(e=Oe(this,Ae))||e.call(this),Fe(this,Ae,void 0),null==(t=Oe(this,Ne))||t.call(this),Fe(this,Ne,void 0))}isFetching(e){return Oe(this,Me).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Oe(this,Ee).findAll({...e,status:"pending"}).length}getQueryData(e){var t;const n=this.defaultQueryOptions({queryKey:e});return null==(t=Oe(this,Me).get(n.queryHash))?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=Oe(this,Me).build(this,t),r=n.state.data;return void 0===r?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Qh(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return Oe(this,Me).findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),i=Oe(this,Me).get(r.queryHash),a=function(e,t){return"function"==typeof e?e(t):e}(t,null==i?void 0:i.state.data);if(void 0!==a)return Oe(this,Me).build(this,r).setData(a,{...n,manual:!0})}setQueriesData(e,t,n){return bp.batch(()=>Oe(this,Me).findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,n)]))}getQueryState(e){var t;const n=this.defaultQueryOptions({queryKey:e});return null==(t=Oe(this,Me).get(n.queryHash))?void 0:t.state}removeQueries(e){const t=Oe(this,Me);bp.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const n=Oe(this,Me);return bp.batch(()=>(n.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=bp.batch(()=>Oe(this,Me).findAll(e).map(e=>e.cancel(n)));return Promise.all(r).then(Yh).catch(Yh)}invalidateQueries(e,t={}){return bp.batch(()=>(Oe(this,Me).findAll(e).forEach(e=>{e.invalidate()}),"none"===(null==e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries({...e,type:(null==e?void 0:e.refetchType)??(null==e?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=bp.batch(()=>Oe(this,Me).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,n);return n.throwOnError||(t=t.catch(Yh)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(r).then(Yh)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const n=Oe(this,Me).build(this,t);return n.isStaleByTime(Qh(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Yh).catch(Yh)}fetchInfiniteQuery(e){return e.behavior=Op(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Yh).catch(Yh)}ensureInfiniteQueryData(e){return e.behavior=Op(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return wp.isOnline()?Oe(this,Ee).resumePausedMutations():Promise.resolve()}getQueryCache(){return Oe(this,Me)}getMutationCache(){return Oe(this,Ee)}getDefaultOptions(){return Oe(this,Ce)}setDefaultOptions(e){Fe(this,Ce,e)}setQueryDefaults(e,t){Oe(this,Te).set(ip(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Oe(this,Te).values()],n={};return t.forEach(t=>{ap(e,t.queryKey)&&Object.assign(n,t.defaultOptions)}),n}setMutationDefaults(e,t){Oe(this,ke).set(ip(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Oe(this,ke).values()],n={};return t.forEach(t=>{ap(e,t.mutationKey)&&Object.assign(n,t.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Oe(this,Ce).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=rp(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===fp&&(t.enabled=!1),t}defaultMutationOptions(e){return(null==e?void 0:e._defaulted)?e:{...Oe(this,Ce).mutations,...(null==e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Oe(this,Me).clear(),Oe(this,Ee).clear()}},Me=new WeakMap,Ee=new WeakMap,Ce=new WeakMap,Te=new WeakMap,ke=new WeakMap,Pe=new WeakMap,Ae=new WeakMap,Ne=new WeakMap,Re),Xp=kt.createContext(void 0),qp=({client:e,children:t})=>(kt.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),Ot.jsx(Xp.Provider,{value:e,children:t})),Kp=kt.createContext(!1);Kp.Provider;var Yp=kt.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),Zp=(e,t)=>(null==e?void 0:e.suspense)&&t.isPending,Jp=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function Qp({queries:e,...t},n){const r=(()=>{const e=kt.useContext(Xp);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e})(),i=kt.useContext(Kp),a=kt.useContext(Yp),o=kt.useMemo(()=>e.map(e=>{const t=r.defaultQueryOptions(e);return t._optimisticResults=i?"isRestoring":"optimistic",t}),[e,r,i]);o.forEach(e=>{(e=>{if(e.suspense){const t=1e3,n=e=>"static"===e?e:Math.max(e??t,t),r=e.staleTime;e.staleTime="function"==typeof r?(...e)=>n(r(...e)):n(r),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,t))}})(e);const t=r.getQueryCache().get(e.queryHash);((e,t,n)=>{const r=(null==n?void 0:n.state.error)&&"function"==typeof e.throwOnError?vp(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||r)&&(t.isReset()||(e.retryOnMount=!1))})(e,a,t)}),(e=>{kt.useEffect(()=>{e.clearReset()},[e])})(a);const[s]=kt.useState(()=>new Gp(r,o,t)),[l,c,u]=s.getOptimisticResult(o,t.combine),d=!i&&!1!==t.subscribed;kt.useSyncExternalStore(kt.useCallback(e=>d?s.subscribe(bp.batchCalls(e)):Yh,[s,d]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),kt.useEffect(()=>{s.setQueries(o,t)},[o,t,s]);const h=l.some((e,t)=>Zp(o[t],e))?l.flatMap((e,t)=>{const n=o[t];if(n){const t=new Rp(r,n);if(Zp(n,e))return Jp(n,t,a);((e,t)=>e.isLoading&&e.isFetching&&!t)(e,i)&&Jp(n,t,a)}return[]}):[];if(h.length>0)throw Promise.all(h);const p=l.find((e,t)=>{const n=o[t];return n&&(({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(i&&void 0===e.data||vp(n,[e.error,r])))({result:e,errorResetBoundary:a,throwOnError:n.throwOnError,query:r.getQueryCache().get(n.queryHash),suspense:n.suspense})});if(null==p?void 0:p.error)throw p.error;return c(u())}const em=e=>"string"==typeof e,tm=()=>{let e,t;const n=new Promise((n,r)=>{e=n,t=r});return n.resolve=e,n.reject=t,n},nm=e=>null==e?"":""+e,rm=/###/g,im=e=>e&&e.indexOf("###")>-1?e.replace(rm,"."):e,am=e=>!e||em(e),om=(e,t,n)=>{const r=em(t)?t.split("."):t;let i=0;for(;i<r.length-1;){if(am(e))return{};const t=im(r[i]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++i}return am(e)?{}:{obj:e,k:im(r[i])}},sm=(e,t,n)=>{const{obj:r,k:i}=om(e,t,Object);if(void 0!==r||1===t.length)return void(r[i]=n);let a=t[t.length-1],o=t.slice(0,t.length-1),s=om(e,o,Object);for(;void 0===s.obj&&o.length;)a=`${o[o.length-1]}.${a}`,o=o.slice(0,o.length-1),s=om(e,o,Object),(null==s?void 0:s.obj)&&void 0!==s.obj[`${s.k}.${a}`]&&(s.obj=void 0);s.obj[`${s.k}.${a}`]=n},lm=(e,t)=>{const{obj:n,k:r}=om(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},cm=(e,t,n)=>{for(const r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?em(e[r])||e[r]instanceof String||em(t[r])||t[r]instanceof String?n&&(e[r]=t[r]):cm(e[r],t[r],n):e[r]=t[r]);return e},um=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var dm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const hm=e=>em(e)?e.replace(/[&<>"'\/]/g,e=>dm[e]):e;const pm=[" ",",","?","!",";"],mm=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}(20),fm=(e,t,n=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const r=t.split(n);let i=e;for(let a=0;a<r.length;){if(!i||"object"!=typeof i)return;let e,t="";for(let o=a;o<r.length;++o)if(o!==a&&(t+=n),t+=r[o],e=i[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&o<r.length-1)continue;a+=o-a+1;break}i=e}return i},gm=e=>null==e?void 0:e.replace("_","-"),vm={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,r;null==(r=null==(n=null==console?void 0:console[e])?void 0:n.apply)||r.call(n,console,t)}};class ym{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||vm,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,r){return r&&!this.debug?null:(em(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new ym(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new ym(this.logger,e)}}var _m=new ym;class xm{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){if(this.observers[e]){Array.from(this.observers[e].entries()).forEach(([e,n])=>{for(let r=0;r<n;r++)e(...t)})}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach(([n,r])=>{for(let i=0;i<r;i++)n.apply(n,[e,...t])})}}}class bm extends xm{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n,r={}){var i,a;const o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,s=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],n&&(Array.isArray(n)?l.push(...n):em(n)&&o?l.push(...n.split(o)):l.push(n)));const c=lm(this.data,l);return!c&&!t&&!n&&e.indexOf(".")>-1&&(e=l[0],t=l[1],n=l.slice(2).join(".")),!c&&s&&em(n)?fm(null==(a=null==(i=this.data)?void 0:i[e])?void 0:a[t],n,o):c}addResource(e,t,n,r,i={silent:!1}){const a=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let o=[e,t];n&&(o=o.concat(a?n.split(a):n)),e.indexOf(".")>-1&&(o=e.split("."),r=t,t=o[1]),this.addNamespaces(t),sm(this.data,o,r),i.silent||this.emit("added",e,t,n,r)}addResources(e,t,n,r={silent:!1}){for(const i in n)(em(n[i])||Array.isArray(n[i]))&&this.addResource(e,t,i,n[i],{silent:!0});r.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,r,i,a={silent:!1,skipCopy:!1}){let o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),r=n,n=t,t=o[1]),this.addNamespaces(t);let s=lm(this.data,o)||{};a.skipCopy||(n=JSON.parse(JSON.stringify(n))),r?cm(s,n,i):s={...s,...n},sm(this.data,o,s),a.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var wm={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,r,i){return e.forEach(e=>{var a;t=(null==(a=this.processors[e])?void 0:a.process(t,n,r,i))??t}),t}};const Sm=Symbol("i18next/PATH_KEY");function Mm(e,t){const{[Sm]:n}=e(function(){const e=[],t=Object.create(null);let n;return t.get=(r,i)=>{var a;return null==(a=null==n?void 0:n.revoke)||a.call(n),i===Sm?e:(e.push(i),n=Proxy.revocable(r,t),n.proxy)},Proxy.revocable(Object.create(null),t).proxy}());return n.join((null==t?void 0:t.keySeparator)??".")}const Em={},Cm=e=>!em(e)&&"boolean"!=typeof e&&"number"!=typeof e;class Tm extends xm{constructor(e,t={}){super(),((e,t,n)=>{e.forEach(e=>{t[e]&&(n[e]=t[e])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=_m.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const n={...t};if(null==e)return!1;const r=this.resolve(e,n);if(void 0===(null==r?void 0:r.res))return!1;const i=Cm(r.res);return!1!==n.returnObjects||!i}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const a=n&&e.indexOf(n)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,n)=>{t=t||"",n=n||"";const r=pm.filter(e=>t.indexOf(e)<0&&n.indexOf(e)<0);if(0===r.length)return!0;const i=mm.getRegExp(`(${r.map(e=>"?"===e?"\\?":e).join("|")})`);let a=!i.test(e);if(!a){const t=e.indexOf(n);t>0&&!i.test(e.substring(0,t))&&(a=!0)}return a})(e,n,r));if(a&&!o){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:em(i)?[i]:i};const a=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(a[0])>-1)&&(i=a.shift()),e=a.join(r)}return{key:e,namespaces:em(i)?[i]:i}}translate(e,t,n){let r="object"==typeof t?{...t}:t;if("object"!=typeof r&&this.options.overloadTranslationOptionHandler&&(r=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof r&&(r={...r}),r||(r={}),null==e)return"";"function"==typeof e&&(e=Mm(e,{...this.options,...r})),Array.isArray(e)||(e=[String(e)]);const i=void 0!==r.returnDetails?r.returnDetails:this.options.returnDetails,a=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],r),l=s[s.length-1];let c=void 0!==r.nsSeparator?r.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");const u=r.lng||this.language,d=r.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==u?void 0:u.toLowerCase()))return d?i?{res:`${l}${c}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(r)}:`${l}${c}${o}`:i?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(r)}:o;const h=this.resolve(e,r);let p=null==h?void 0:h.res;const m=(null==h?void 0:h.usedKey)||o,f=(null==h?void 0:h.exactUsedKey)||o,g=void 0!==r.joinArrays?r.joinArrays:this.options.joinArrays,v=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==r.count&&!em(r.count),_=Tm.hasDefaultValue(r),x=y?this.pluralResolver.getSuffix(u,r.count,r):"",b=r.ordinal&&y?this.pluralResolver.getSuffix(u,r.count,{ordinal:!1}):"",w=y&&!r.ordinal&&0===r.count,S=w&&r[`defaultValue${this.options.pluralSeparator}zero`]||r[`defaultValue${x}`]||r[`defaultValue${b}`]||r.defaultValue;let M=p;v&&!p&&_&&(M=S);const E=Cm(M),C=Object.prototype.toString.apply(M);if(!(v&&M&&E&&["[object Number]","[object Function]","[object RegExp]"].indexOf(C)<0)||em(g)&&Array.isArray(M))if(v&&em(g)&&Array.isArray(p))p=p.join(g),p&&(p=this.extendTranslation(p,e,r,n));else{let t=!1,i=!1;!this.isValidLookup(p)&&_&&(t=!0,p=S),this.isValidLookup(p)||(i=!0,p=o);const s=(r.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&i?void 0:p,d=_&&S!==p&&this.options.updateMissing;if(i||t||d){if(this.logger.log(d?"updateKey":"missingKey",u,l,o,d?S:p),a){const e=this.resolve(o,{...r,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,r.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let r=0;r<t.length;r++)e.push(t[r]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(r.lng||this.language):e.push(r.lng||this.language);const n=(e,t,n)=>{var i;const a=_&&n!==p?n:s;this.options.missingKeyHandler?this.options.missingKeyHandler(e,l,t,a,d,r):(null==(i=this.backendConnector)?void 0:i.saveMissing)&&this.backendConnector.saveMissing(e,l,t,a,d,r),this.emit("missingKey",e,l,t,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,r);w&&r[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{n([e],o+t,r[`defaultValue${t}`]||S)})}):n(e,o,S))}p=this.extendTranslation(p,e,r,h,n),i&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${l}${c}${o}`),(i||t)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${o}`:o,t?p:void 0,r))}else{if(!r.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,M,{...r,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(h.res=e,h.usedParams=this.getUsedParamsDetails(r),h):e}if(a){const e=Array.isArray(M),t=e?[]:{},n=e?f:m;for(const i in M)if(Object.prototype.hasOwnProperty.call(M,i)){const e=`${n}${a}${i}`;t[i]=_&&!p?this.translate(e,{...r,defaultValue:Cm(S)?S[i]:void 0,joinArrays:!1,ns:s}):this.translate(e,{...r,joinArrays:!1,ns:s}),t[i]===e&&(t[i]=M[i])}p=t}}return i?(h.res=p,h.usedParams=this.getUsedParamsDetails(r),h):p}extendTranslation(e,t,n,r,i){var a,o;if(null==(a=this.i18nFormat)?void 0:a.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const a=em(e)&&(void 0!==(null==(o=null==n?void 0:n.interpolation)?void 0:o.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let s;if(a){const t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let l=n.replace&&!em(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),e=this.interpolator.interpolate(e,l,n.lng||this.language||r.usedLng,n),a){const t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(n.nest=!1)}!n.lng&&r&&r.res&&(n.lng=this.language||r.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(...e)=>(null==i?void 0:i[0])!==e[0]||n.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),n)),n.interpolation&&this.interpolator.reset()}const s=n.postProcess||this.options.postProcess,l=em(s)?[s]:s;return null!=e&&(null==l?void 0:l.length)&&!1!==n.applyPostProcessor&&(e=wm.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e,t={}){let n,r,i,a,o;return em(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(n))return;const s=this.extractFromKey(e,t),l=s.key;r=l;let c=s.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const u=void 0!==t.count&&!em(t.count),d=u&&!t.ordinal&&0===t.count,h=void 0!==t.context&&(em(t.context)||"number"==typeof t.context)&&""!==t.context,p=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(e=>{var s,c;this.isValidLookup(n)||(o=e,Em[`${p[0]}-${e}`]||!(null==(s=this.utils)?void 0:s.hasLoadedNamespace)||(null==(c=this.utils)?void 0:c.hasLoadedNamespace(o))||(Em[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${r}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(r=>{var o;if(this.isValidLookup(n))return;a=r;const s=[l];if(null==(o=this.i18nFormat)?void 0:o.addLookupKeys)this.i18nFormat.addLookupKeys(s,l,r,e,t);else{let e;u&&(e=this.pluralResolver.getSuffix(r,t.count,t));const n=`${this.options.pluralSeparator}zero`,i=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(t.ordinal&&0===e.indexOf(i)&&s.push(l+e.replace(i,this.options.pluralSeparator)),s.push(l+e),d&&s.push(l+n)),h){const r=`${l}${this.options.contextSeparator||"_"}${t.context}`;s.push(r),u&&(t.ordinal&&0===e.indexOf(i)&&s.push(r+e.replace(i,this.options.pluralSeparator)),s.push(r+e),d&&s.push(r+n))}}let c;for(;c=s.pop();)this.isValidLookup(n)||(i=c,n=this.getResource(r,e,c,t))}))})}),{res:n,usedKey:r,exactUsedKey:i,usedLng:a,usedNS:o}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n,r={}){var i;return(null==(i=this.i18nFormat)?void 0:i.getResource)?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!em(e.replace);let r=n?e.replace:e;if(n&&void 0!==e.count&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!n){r={...r};for(const e of t)delete r[e]}return r}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}class km{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=_m.create("languageUtils")}getScriptPartFromCode(e){if(!(e=gm(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=gm(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(em(e)&&e.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(e)[0]}catch(t){}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const n=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(n)||(t=n)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const n=this.getScriptPartFromCode(e);if(this.isSupportedCode(n))return t=n;const r=this.getLanguagePartFromCode(e);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(e=>e===r?e:e.indexOf("-")<0&&r.indexOf("-")<0?void 0:e.indexOf("-")>0&&r.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===r||0===e.indexOf(r)&&r.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),em(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),r=[],i=e=>{e&&(this.isSupportedCode(e)?r.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return em(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):em(e)&&i(this.formatLanguageCode(e)),n.forEach(e=>{r.indexOf(e)<0&&i(this.formatLanguageCode(e))}),r}}const Pm={zero:0,one:1,two:2,few:3,many:4,other:5},Am={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Nm{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=_m.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const n=gm("dev"===e?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:n,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let a;try{a=new Intl.PluralRules(n,{type:r})}catch(o){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Am;if(!e.match(/-|_/))return Am;const n=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(n,t)}return this.pluralRulesCache[i]=a,a}needsPlural(e,t={}){let n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),(null==n?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t,n={}){return this.getSuffixes(e,n).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?n.resolvedOptions().pluralCategories.sort((e,t)=>Pm[e]-Pm[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,n={}){const r=this.getRule(e,n);return r?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,n))}}const Rm=(e,t,n,r=".",i=!0)=>{let a=((e,t,n)=>{const r=lm(e,n);return void 0!==r?r:lm(t,n)})(e,t,n);return!a&&i&&em(n)&&(a=fm(e,n,r),void 0===a&&(a=fm(t,n,r))),a},Lm=e=>e.replace(/\$/g,"$$$$");class Im{constructor(e={}){var t;this.logger=_m.create("interpolator"),this.options=e,this.format=(null==(t=null==e?void 0:e.interpolation)?void 0:t.format)||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:r,prefix:i,prefixEscaped:a,suffix:o,suffixEscaped:s,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:m,nestingOptionsSeparator:f,maxReplaces:g,alwaysFormat:v}=e.interpolation;this.escape=void 0!==t?t:hm,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==r&&r,this.prefix=i?um(i):a||"{{",this.suffix=o?um(o):s||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?um(d):h||um("$t("),this.nestingSuffix=p?um(p):m||um(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=g||1e3,this.alwaysFormat=void 0!==v&&v,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,n,r){var i;let a,o,s;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const i=Rm(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,n,{...r,...t,interpolationkey:e}):i}const i=e.split(this.formatSeparator),a=i.shift().trim(),o=i.join(this.formatSeparator).trim();return this.format(Rm(t,l,a,this.options.keySeparator,this.options.ignoreJSONStructure),o,n,{...r,...t,interpolationkey:a})};this.resetRegExp();const u=(null==r?void 0:r.missingInterpolationHandler)||this.options.missingInterpolationHandler,d=void 0!==(null==(i=null==r?void 0:r.interpolation)?void 0:i.skipOnVariables)?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>Lm(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?Lm(this.escape(e)):Lm(e)}].forEach(t=>{for(s=0;a=t.regex.exec(e);){const n=a[1].trim();if(o=c(n),void 0===o)if("function"==typeof u){const t=u(e,a,r);o=em(t)?t:""}else if(r&&Object.prototype.hasOwnProperty.call(r,n))o="";else{if(d){o=a[0];continue}this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),o=""}else em(o)||this.useRawValueToEscape||(o=nm(o));const i=t.safeValue(o);if(e=e.replace(a[0],i),d?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=a[0].length):t.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,t,n={}){let r,i,a;const o=(e,t)=>{const n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;const r=e.split(new RegExp(`${n}[ ]*{`));let i=`{${r[1]}`;e=r[0],i=this.interpolate(i,a);const o=i.match(/'/g),s=i.match(/"/g);(((null==o?void 0:o.length)??0)%2==0&&!s||s.length%2!=0)&&(i=i.replace(/'/g,'"'));try{a=JSON.parse(i),t&&(a={...t,...a})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${n}${i}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,e};for(;r=this.nestingRegexp.exec(e);){let s=[];a={...n},a=a.replace&&!em(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const l=/{.*}/.test(r[1])?r[1].lastIndexOf("}")+1:r[1].indexOf(this.formatSeparator);if(-1!==l&&(s=r[1].slice(l).split(this.formatSeparator).map(e=>e.trim()).filter(Boolean),r[1]=r[1].slice(0,l)),i=t(o.call(this,r[1].trim(),a),a),i&&r[0]===e&&!em(i))return i;em(i)||(i=nm(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),s.length&&(i=s.reduce((e,t)=>this.format(e,t,n.lng,{...n,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const jm=e=>{const t={};return(n,r,i)=>{let a=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(a={...a,[i.interpolationkey]:void 0});const o=r+JSON.stringify(a);let s=t[o];return s||(s=e(gm(r),i),t[o]=s),s(n)}},Dm=e=>(t,n,r)=>e(gm(n),r)(t);class Om{constructor(e={}){this.logger=_m.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const n=t.cacheInBuiltFormats?jm:Dm;this.formats={number:n((e,t)=>{const n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)}),currency:n((e,t)=>{const n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)}),datetime:n((e,t)=>{const n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)}),relativetime:n((e,t)=>{const n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")}),list:n((e,t)=>{const n=new Intl.ListFormat(e,{...t});return e=>n.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=jm(t)}format(e,t,n,r={}){const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(e=>e.indexOf(")")>-1)){const e=i.findIndex(e=>e.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,e)].join(this.formatSeparator)}return i.reduce((e,t)=>{var i;const{formatName:a,formatOptions:o}=(e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const r=e.split("(");t=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);"currency"===t&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(e=>{if(e){const[t,...r]=e.split(":"),i=r.join(":").trim().replace(/^'+|'+$/g,""),a=t.trim();n[a]||(n[a]=i),"false"===i&&(n[a]=!1),"true"===i&&(n[a]=!0),isNaN(i)||(n[a]=parseInt(i,10))}})}return{formatName:t,formatOptions:n}})(t);if(this.formats[a]){let t=e;try{const s=(null==(i=null==r?void 0:r.formatParams)?void 0:i[r.interpolationkey])||{},l=s.locale||s.lng||r.locale||r.lng||n;t=this.formats[a](e,l,{...o,...r,...s})}catch(s){this.logger.warn(s)}return t}return this.logger.warn(`there was no format function for ${a}`),e},e)}}class Um extends xm{constructor(e,t,n,r={}){var i,a;super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=r,this.logger=_m.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],null==(a=null==(i=this.backend)?void 0:i.init)||a.call(i,n,r.backend,r)}queueLoad(e,t,n,r){const i={},a={},o={},s={};return e.forEach(e=>{let r=!0;t.forEach(t=>{const o=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[o]=2:this.state[o]<0||(1===this.state[o]?void 0===a[o]&&(a[o]=!0):(this.state[o]=1,r=!1,void 0===a[o]&&(a[o]=!0),void 0===i[o]&&(i[o]=!0),void 0===s[t]&&(s[t]=!0)))}),r||(o[e]=!0)}),(Object.keys(i).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(s)}}loaded(e,t,n){const r=e.split("|"),i=r[0],a=r[1];t&&this.emit("failedLoading",i,a,t),!t&&n&&this.store.addResourceBundle(i,a,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);const o={};this.queue.forEach(n=>{((e,t,n)=>{const{obj:r,k:i}=om(e,t,Object);r[i]=r[i]||[],r[i].push(n)})(n.loaded,[i],a),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach(e=>{o[e]||(o[e]={});const t=n.loaded[e];t.length&&t.forEach(t=>{void 0===o[e][t]&&(o[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(e=>!e.done)}read(e,t,n,r=0,i=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:r,wait:i,callback:a});this.readingCalls++;const o=(o,s)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}o&&s&&r<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,n,r+1,2*i,a)},i):a(o,s)},s=this.backend[n].bind(this.backend);if(2!==s.length)return s(e,t,o);try{const n=s(e,t);n&&"function"==typeof n.then?n.then(e=>o(null,e)).catch(o):o(null,n)}catch(l){o(l)}}prepareLoading(e,t,n={},r){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();em(e)&&(e=this.languageUtils.toResolveHierarchy(e)),em(t)&&(t=[t]);const i=this.queueLoad(e,t,n,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e,t=""){const n=e.split("|"),r=n[0],i=n[1];this.read(r,i,"read",void 0,void 0,(n,a)=>{n&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,n),!n&&a&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,a),this.loaded(e,n,a)})}saveMissing(e,t,n,r,i,a={},o=()=>{}){var s,l,c,u,d;if(!(null==(l=null==(s=this.services)?void 0:s.utils)?void 0:l.hasLoadedNamespace)||(null==(u=null==(c=this.services)?void 0:c.utils)?void 0:u.hasLoadedNamespace(t))){if(null!=n&&""!==n){if(null==(d=this.backend)?void 0:d.create){const s={...a,isUpdate:i},l=this.backend.create.bind(this.backend);if(l.length<6)try{let i;i=5===l.length?l(e,t,n,r,s):l(e,t,n,r),i&&"function"==typeof i.then?i.then(e=>o(null,e)).catch(o):o(null,i)}catch(h){o(h)}else l(e,t,n,r,o,s)}e&&e[0]&&this.store.addResource(e[0],t,n,r)}}else this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const Fm=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),em(e[1])&&(t.defaultValue=e[1]),em(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach(e=>{t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),zm=e=>{var t,n;return em(e.ns)&&(e.ns=[e.ns]),em(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),em(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(n=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},Bm=()=>{};class Hm extends xm{constructor(e={},t){var n;if(super(),this.options=zm(e),this.services={},this.logger=_m,this.modules={external:[]},n=this,Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(e=>{"function"==typeof n[e]&&(n[e]=n[e].bind(n))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(em(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const n=Fm();var r,i,a,o,s,l,c,u,d,h;this.options={...n,...this.options,...zm(e)},this.options.interpolation={...n.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator),"function"!=typeof this.options.overloadTranslationOptionHandler&&(this.options.overloadTranslationOptionHandler=n.overloadTranslationOptionHandler),!1===this.options.showSupportNotice||((null==(o=null==(a=null==(i=null==(r=this)?void 0:r.modules)?void 0:i.backend)?void 0:a.name)?void 0:o.indexOf("Locize"))>0||(null==(u=null==(c=null==(l=null==(s=null==r?void 0:r.modules)?void 0:s.backend)?void 0:l.constructor)?void 0:c.name)?void 0:u.indexOf("Locize"))>0||(null==(h=null==(d=null==r?void 0:r.options)?void 0:d.backend)?void 0:h.backends)&&r.options.backend.backends.some(e=>{var t,n,r;return(null==(t=null==e?void 0:e.name)?void 0:t.indexOf("Locize"))>0||(null==(r=null==(n=null==e?void 0:e.constructor)?void 0:n.name)?void 0:r.indexOf("Locize"))>0}))||"undefined"!=typeof console&&void 0!==console.info&&console.info(" i18next is maintained with support from locize.com  consider powering your project with managed localization (AI, CDN, integrations): https://locize.com ");const p=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?_m.init(p(this.modules.logger),this.options):_m.init(null,this.options),e=this.modules.formatter?this.modules.formatter:Om;const t=new km(this.options);this.store=new bm(this.options.resources,this.options);const r=this.services;r.logger=_m,r.resourceStore=this.store,r.languageUtils=t,r.pluralResolver=new Nm(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix});this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),!e||this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format||(r.formatter=p(e),r.formatter.init&&r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new Im(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new Um(p(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(r.languageDetector=p(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=p(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new Tm(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=Bm),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const m=tm(),f=()=>{const e=(e,n)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),m.resolve(n),t(e,n)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?f():setTimeout(f,0),m}loadResources(e,t=Bm){var n,r;let i=t;const a=em(e)?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==a?void 0:a.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return i();const e=[],t=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};if(a)t(a);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e))}null==(r=null==(n=this.options.preload)?void 0:n.forEach)||r.call(n,e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),i(e)})}else i(null)}reloadResources(e,t,n){const r=tm();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=Bm),this.services.backendConnector.reload(e,t,e=>{r.resolve(),n(e)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&wm.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const n=tm();this.emit("languageChanging",e);const r=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},i=(i,a)=>{a?this.isLanguageChangingTo===e&&(r(a),this.translator.changeLanguage(a),this.isLanguageChangingTo=void 0,this.emit("languageChanged",a),this.logger.log("languageChanged",a)):this.isLanguageChangingTo=void 0,n.resolve((...e)=>this.t(...e)),t&&t(i,(...e)=>this.t(...e))},a=t=>{var n,a;e||t||!this.services.languageDetector||(t=[]);const o=em(t)?t:t&&t[0],s=this.store.hasLanguageSomeTranslations(o)?o:this.services.languageUtils.getBestMatchFromCodes(em(t)?[t]:t);s&&(this.language||r(s),this.translator.language||this.translator.changeLanguage(s),null==(a=null==(n=this.services.languageDetector)?void 0:n.cacheUserLanguage)||a.call(n,s)),this.loadResources(s,e=>{i(e,s)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e):a(this.services.languageDetector.detect()),n}getFixedT(e,t,n){const r=(e,t,...i)=>{let a;a="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(i)):{...t},a.lng=a.lng||r.lng,a.lngs=a.lngs||r.lngs,a.ns=a.ns||r.ns,""!==a.keyPrefix&&(a.keyPrefix=a.keyPrefix||n||r.keyPrefix);const o=this.options.keySeparator||".";let s;return a.keyPrefix&&Array.isArray(e)?s=e.map(e=>("function"==typeof e&&(e=Mm(e,{...this.options,...t})),`${a.keyPrefix}${o}${e}`)):("function"==typeof e&&(e=Mm(e,{...this.options,...t})),s=a.keyPrefix?`${a.keyPrefix}${o}${e}`:e),this.t(s,a)};return em(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=n,r}t(...e){var t;return null==(t=this.translator)?void 0:t.translate(...e)}exists(...e){var t;return null==(t=this.translator)?void 0:t.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const a=(e,t)=>{const n=this.services.backendConnector.state[`${e}|${t}`];return-1===n||0===n||2===n};if(t.precheck){const e=t.precheck(this,a);if(void 0!==e)return e}return!!this.hasResourceBundle(n,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!a(n,e)||r&&!a(i,e)))}loadNamespaces(e,t){const n=tm();return this.options.ns?(em(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=tm();em(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(e=>r.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return i.length?(this.options.preload=r.concat(i),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}dir(e){var t,n;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";try{const t=new Intl.Locale(e);if(t&&t.getTextInfo){const e=t.getTextInfo();if(e&&e.direction)return e.direction}}catch(i){}const r=(null==(n=this.services)?void 0:n.languageUtils)||new km(Fm());return e.toLowerCase().indexOf("-latn")>1?"ltr":["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const n=new Hm(e,t);return n.createInstance=Hm.createInstance,n}cloneInstance(e={},t=Bm){const n=e.forkResourceStore;n&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Hm(r);void 0===e.debug&&void 0===e.prefix||(i.logger=i.logger.clone(e));if(["store","services","language"].forEach(e=>{i[e]=this[e]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},n){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((n,r)=>(n[r]={...e[t][r]},n),e[t]),e),{});i.store=new bm(e,r),i.services.resourceStore=i.store}if(e.interpolation){const t={...Fm().interpolation,...this.options.interpolation,...e.interpolation},n={...r,interpolation:t};i.services.interpolator=new Im(n)}return i.translator=new Tm(i.services,r),i.translator.on("*",(e,...t)=>{i.emit(e,...t)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Vm=Hm.createInstance();Vm.createInstance,Vm.dir,Vm.init,Vm.loadResources,Vm.reloadResources,Vm.use,Vm.changeLanguage,Vm.getFixedT,Vm.t,Vm.exists,Vm.setDefaultNamespace,Vm.hasLoadedNamespace,Vm.loadNamespaces,Vm.loadLanguages;const Gm={},Wm=(e,t,n,r)=>{Km(n)&&Gm[n]||(Km(n)&&(Gm[n]=new Date),((e,t,n,r)=>{var i,a,o,s;const l=[n,{code:t,...r||{}}];if(null==(a=null==(i=null==e?void 0:e.services)?void 0:i.logger)?void 0:a.forward)return e.services.logger.forward(l,"warn","react-i18next::",!0);Km(l[0])&&(l[0]=`react-i18next:: ${l[0]}`),(null==(s=null==(o=null==e?void 0:e.services)?void 0:o.logger)?void 0:s.warn)?e.services.logger.warn(...l):(null==console?void 0:console.warn)&&console.warn(...l)})(e,t,n,r))},$m=(e,t)=>()=>{if(e.isInitialized)t();else{const n=()=>{setTimeout(()=>{e.off("initialized",n)},0),t()};e.on("initialized",n)}},Xm=(e,t,n)=>{e.loadNamespaces(t,$m(e,n))},qm=(e,t,n,r)=>{if(Km(n)&&(n=[n]),e.options.preload&&e.options.preload.indexOf(t)>-1)return Xm(e,n,r);n.forEach(t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)}),e.loadLanguages(t,$m(e,r))},Km=e=>"string"==typeof e,Ym=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Zm={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},Jm=e=>Zm[e];let Qm={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(Ym,Jm),transDefaultProps:void 0};let ef;const tf={type:"3rdParty",init(e){((e={})=>{Qm={...Qm,...e}})(e.options.react),(e=>{ef=e})(e)}},nf=kt.createContext();class rf{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var af={exports:{}},of={},sf=kt;var lf="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},cf=sf.useState,uf=sf.useEffect,df=sf.useLayoutEffect,hf=sf.useDebugValue;function pf(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!lf(e,n)}catch(r){return!0}}var mf="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=cf({inst:{value:n,getSnapshot:t}}),i=r[0].inst,a=r[1];return df(function(){i.value=n,i.getSnapshot=t,pf(i)&&a({inst:i})},[e,n,t]),uf(function(){return pf(i)&&a({inst:i}),e(function(){pf(i)&&a({inst:i})})},[e]),hf(n),n};of.useSyncExternalStore=void 0!==sf.useSyncExternalStore?sf.useSyncExternalStore:mf,af.exports=of;var ff=af.exports;const gf={t:(e,t)=>{return Km(t)?t:"object"==typeof(n=t)&&null!==n&&Km(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e;var n},ready:!1},vf=()=>()=>{},yf=(e,t={})=>{var n,r,i;const{i18n:a}=t,{i18n:o,defaultNS:s}=kt.useContext(nf)||{},l=a||o||ef;l&&!l.reportNamespaces&&(l.reportNamespaces=new rf),l||Wm(l,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const c=kt.useMemo(()=>{var e;return{...Qm,...null==(e=null==l?void 0:l.options)?void 0:e.react,...t}},[l,t]),{useSuspense:u,keyPrefix:d}=c,h=s||(null==(n=null==l?void 0:l.options)?void 0:n.defaultNS),p=Km(h)?[h]:h||["translation"],m=kt.useMemo(()=>p,p);null==(i=null==(r=null==l?void 0:l.reportNamespaces)?void 0:r.addUsedNamespaces)||i.call(r,m);const f=kt.useRef(0),g=kt.useCallback(e=>{if(!l)return vf;const{bindI18n:t,bindI18nStore:n}=c,r=()=>{f.current+=1,e()};return t&&l.on(t,r),n&&l.store.on(n,r),()=>{t&&t.split(" ").forEach(e=>l.off(e,r)),n&&n.split(" ").forEach(e=>l.store.off(e,r))}},[l,c]),v=kt.useRef(),y=kt.useCallback(()=>{if(!l)return gf;const e=!(!l.isInitialized&&!l.initializedStoreOnce)&&m.every(e=>((e,t,n={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:n.lng,precheck:(t,r)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!r(t.isLanguageChangingTo,e))return!1}}):(Wm(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0))(e,l,c)),n=t.lng||l.language,r=f.current,i=v.current;if(i&&i.ready===e&&i.lng===n&&i.keyPrefix===d&&i.revision===r)return i;const a={t:l.getFixedT(n,"fallback"===c.nsMode?m:m[0],d),ready:e,lng:n,keyPrefix:d,revision:r};return v.current=a,a},[l,m,d,c,t.lng]),[_,x]=kt.useState(0),{t:b,ready:w}=ff.useSyncExternalStore(g,y,y);kt.useEffect(()=>{if(l&&!w&&!u){const e=()=>x(e=>e+1);t.lng?qm(l,t.lng,m,e):Xm(l,m,e)}},[l,t.lng,m,w,u,_]);const S=l||{},M=kt.useRef(null),E=kt.useRef(),C=e=>{const t=Object.getOwnPropertyDescriptors(e);t.__original&&delete t.__original;const n=Object.create(Object.getPrototypeOf(e),t);if(!Object.prototype.hasOwnProperty.call(n,"__original"))try{Object.defineProperty(n,"__original",{value:e,writable:!1,enumerable:!1,configurable:!1})}catch(r){}return n},T=kt.useMemo(()=>{const e=S,t=null==e?void 0:e.language;let n=e;e&&(M.current&&M.current.__original===e?E.current!==t?(n=C(e),M.current=n,E.current=t):n=M.current:(n=C(e),M.current=n,E.current=t));const r=[b,n,w];return r.t=b,r.i18n=n,r.ready=w,r},[b,S,w,S.resolvedLanguage,S.language,S.languages]);if(l&&u&&!w)throw new Promise(e=>{const n=()=>e();t.lng?qm(l,t.lng,m,n):Xm(l,m,n)});return T},_f={},xf=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!==(_f?"production":void 0)&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=t=e(r,i,a);return a};var bf={exports:{}},wf={},Sf=kt,Mf=ff;var Ef="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Cf=Mf.useSyncExternalStore,Tf=Sf.useRef,kf=Sf.useEffect,Pf=Sf.useMemo,Af=Sf.useDebugValue;wf.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var a=Tf(null);if(null===a.current){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=Pf(function(){function e(e){if(!l){if(l=!0,a=e,e=r(e),void 0!==i&&o.hasValue){var t=o.value;if(i(t,e))return s=t}return s=e}if(t=s,Ef(a,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(a=e,t):(a=e,s=n)}var a,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]);var s=Cf(e,a[0],a[1]);return kf(function(){o.hasValue=!0,o.value=s},[s]),Af(s),s},bf.exports=wf;const Nf=Ve(bf.exports),Rf={},{useDebugValue:Lf}=Pt,{useSyncExternalStoreWithSelector:If}=Nf;let jf=!1;const Df=e=>e;const Of=e=>{"production"!==(Rf?"production":void 0)&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?xf(e):xf)(e):e,n=(e,n)=>function(e,t=Df,n){"production"!==(Rf?"production":void 0)&&n&&!jf&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),jf=!0);const r=If(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Lf(r),r}(t,e,n);return Object.assign(n,t),n},Uf={camera:{camera_type:"Digital",manufacturer:"ARRI",body:"Alexa_35",sensor:"Super35",weight_class:"Medium",film_stock:"None",aspect_ratio:"1.85:1"},lens:{manufacturer:"ARRI",family:"ARRI_Signature_Prime",focal_length_mm:35,is_anamorphic:!1},movement:{equipment:"Static",movement_type:"Static",timing:"Static"},lighting:{time_of_day:"Afternoon",source:"Sun",style:"Naturalistic"},visual_grammar:{shot_size:"MS",composition:"Rule_of_Thirds",mood:"Contemplative",color_tone:"Neutral_Saturated"}},Ff={medium:"2D",style_domain:"Anime",rendering:{line_treatment:"Clean",color_application:"Cel",lighting_model:"Naturalistic_Simulated",surface_detail:"Smooth"},motion:{motion_style:"Full",virtual_camera:"Digital_Pan"},visual_grammar:{shot_size:"MS",composition:"Rule_of_Thirds",mood:"Contemplative",color_tone:"Neutral_Saturated"}},zf=(Bf=e=>({projectType:"live_action",setProjectType:t=>e({projectType:t}),liveActionConfig:Uf,animationConfig:Ff,setLiveActionConfig:t=>e({liveActionConfig:t}),setAnimationConfig:t=>e({animationConfig:t}),updateLiveAction:(t,n)=>e(e=>({liveActionConfig:{...e.liveActionConfig,[t]:"object"==typeof e.liveActionConfig[t]?{...e.liveActionConfig[t],...n}:n}})),updateAnimation:(t,n)=>e(e=>({animationConfig:{...e.animationConfig,[t]:"object"==typeof e.animationConfig[t]?{...e.animationConfig[t],...n}:n}})),validationResult:null,setValidationResult:t=>e({validationResult:t}),generatedPrompt:"",negativePrompt:null,setGeneratedPrompt:(t,n=null)=>e({generatedPrompt:t,negativePrompt:n}),targetModel:"generic",setTargetModel:t=>e({targetModel:t}),selectedLiveActionPreset:null,selectedAnimationPreset:null,liveActionPresetList:[],animationPresetList:[],setSelectedLiveActionPreset:t=>e({selectedLiveActionPreset:t}),setSelectedAnimationPreset:t=>e({selectedAnimationPreset:t}),setLiveActionPresetList:t=>e({liveActionPresetList:t}),setAnimationPresetList:t=>e({animationPresetList:t}),applyLiveActionPresetConfig:(t,n)=>e({liveActionConfig:t,selectedLiveActionPreset:n,validationResult:null,generatedPrompt:"",negativePrompt:null}),applyAnimationPresetConfig:(t,n)=>e({animationConfig:t,selectedAnimationPreset:n,validationResult:null,generatedPrompt:"",negativePrompt:null}),clearPreset:()=>e({selectedLiveActionPreset:null,selectedAnimationPreset:null}),resetConfig:()=>e({liveActionConfig:Uf,animationConfig:Ff,validationResult:null,generatedPrompt:"",negativePrompt:null,selectedLiveActionPreset:null,selectedAnimationPreset:null}),cpePromptForStoryboard:null,setCpePromptForStoryboard:t=>e({cpePromptForStoryboard:t})}))?Of(Bf):Of;var Bf;const Hf=new class{async fetch(e,t){const n=await fetch(`${e}`,{...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.detail||`API error: ${n.status}`)}return n.json()}async getOptions(e,t,n){return this.fetch("/options",{method:"POST",body:JSON.stringify({project_type:e,field_path:t,current_config:n})})}async getEnumValues(e){return(await this.fetch(`/enums/${e}`)).values}async listEnums(){return this.fetch("/enums")}async validateLiveAction(e){return this.fetch("/validate",{method:"POST",body:JSON.stringify({project_type:"live_action",config:e})})}async validateAnimation(e){return this.fetch("/validate",{method:"POST",body:JSON.stringify({project_type:"animation",config:e})})}async generateLiveActionPrompt(e,t="generic"){return this.fetch("/generate-prompt",{method:"POST",body:JSON.stringify({project_type:"live_action",config:e,target_model:t})})}async generateAnimationPrompt(e,t="generic"){return this.fetch("/generate-prompt",{method:"POST",body:JSON.stringify({project_type:"animation",config:e,target_model:t})})}async getLiveActionPresets(){return this.fetch("/presets/live-action")}async getAnimationPresets(){return this.fetch("/presets/animation")}async getLiveActionPreset(e){return this.fetch(`/presets/live-action/${e}`)}async getCinematographyStyle(e){return this.fetch(`/presets/live-action/${e}/cinematography-style`)}async getAnimationPreset(e){return this.fetch(`/presets/animation/${e}`)}async applyLiveActionPreset(e,t){return this.fetch("/apply-preset/live-action",{method:"POST",body:JSON.stringify({preset_id:e,overrides:t??null})})}async applyAnimationPreset(e,t){return this.fetch("/apply-preset/animation",{method:"POST",body:JSON.stringify({preset_id:e,overrides:t??null})})}async searchPresets(e,t,n){const r=new URLSearchParams({q:e});return t&&r.append("project_type",t),n&&r.append("limit",n.toString()),this.fetch(`/presets/search?${r.toString()}`)}async getEras(){return this.fetch("/presets/eras")}async getDomains(){return this.fetch("/presets/domains")}async listProviders(){return this.fetch("/settings/providers")}async getProvider(e){return this.fetch(`/settings/providers/${e}`)}async testProviderConnection(e,t){return this.fetch(`/settings/providers/${e}/test`,{method:"POST",body:JSON.stringify({endpoint:null==t?void 0:t.endpoint,api_key:null==t?void 0:t.apiKey})})}async detectLocalProviders(){return this.fetch("/settings/providers/local/detect")}async testCustomEndpoint(e,t){return this.fetch("/settings/custom-endpoint/test",{method:"POST",body:JSON.stringify({endpoint:e,api_key:t})})}async listOAuthProviders(){return this.fetch("/settings/oauth/providers")}async initiateOAuth(e,t,n){return this.fetch(`/settings/oauth/${e}/authorize`,{method:"POST",body:JSON.stringify({client_id:n||"",redirect_uri:t})})}async exchangeOAuthCode(e,t,n,r,i,a){return this.fetch(`/settings/oauth/${e}/callback`,{method:"POST",body:JSON.stringify({code:t,state:n,client_id:i||"",client_secret:a,redirect_uri:r})})}async getOAuthFlowType(e){return this.fetch(`/settings/oauth/${e}/flow-type`)}async requestDeviceCode(e,t){return this.fetch(`/settings/oauth/${e}/device-code`,{method:"POST",body:JSON.stringify({client_id:t||null})})}async pollDeviceToken(e,t,n){return this.fetch(`/settings/oauth/${e}/device-poll`,{method:"POST",body:JSON.stringify({client_id:n||null,device_code:t})})}async startCallbackServer(e,t,n,r){return this.fetch(`/settings/oauth/${e}/start-callback-server`,{method:"POST",body:JSON.stringify({state:t,code_verifier:n||null,custom_redirect_uri:r||null})})}async pollCallbackToken(e,t){return this.fetch(`/settings/oauth/${e}/poll-token?state=${encodeURIComponent(t)}`)}async stopCallbackServer(e,t){return this.fetch(`/settings/oauth/${e}/callback-server?state=${encodeURIComponent(t)}`,{method:"DELETE"})}async getCallbackServerStatus(e,t){return this.fetch(`/settings/oauth/${e}/callback-server-status?state=${encodeURIComponent(t)}`)}async refreshOAuthToken(e){return this.fetch(`/settings/oauth/${e}/refresh`,{method:"POST"})}async enhancePrompt(e){return this.fetch("/enhance-prompt",{method:"POST",body:JSON.stringify({user_prompt:e.userPrompt,llm_provider:e.llmProvider,llm_model:e.llmModel,target_model:e.targetModel,project_type:e.projectType,config:e.config,credentials:{api_key:e.credentials.apiKey,endpoint:e.credentials.endpoint,oauth_token:e.credentials.oauthToken}})})}async fetchLlmModels(e){return this.fetch("/llm/models",{method:"POST",body:JSON.stringify({provider:e.provider,credentials:{api_key:e.credentials.apiKey,endpoint:e.credentials.endpoint,oauth_token:e.credentials.oauthToken}})})}async getTargetModels(){return this.fetch("/target-models")}async getAllCredentials(){return this.fetch("/credentials")}async getProviderCredentials(e){return this.fetch(`/credentials/${e}`)}async updateProviderCredentials(e,t){return this.fetch(`/credentials/${e}`,{method:"PUT",body:JSON.stringify({api_key:t.api_key,endpoint:t.endpoint,oauth_token:t.oauth_token,oauth_refresh_token:t.oauth_refresh_token,oauth_client_id:t.oauth_client_id,oauth_client_secret:t.oauth_client_secret})})}async deleteProviderCredentials(e){return this.fetch(`/credentials/${e}`,{method:"DELETE"})}async getSettings(){return this.fetch("/settings")}async updateSettings(e){return this.fetch("/settings",{method:"PUT",body:JSON.stringify({active_provider:e.active_provider,selected_model:e.selected_model,target_model:e.target_model})})}async importCredentials(e){return this.fetch("/credentials/import",{method:"POST",body:JSON.stringify({data:e})})}},Vf="cinema-ai-provider-settings",Gf="cinema-llm-settings",Wf="cinema-target-model",$f="cinema-credentials-migrated",Xf=[{id:"openai",name:"OpenAI",type:"api_key",description:"GPT-4, GPT-4V for prompt enhancement and analysis",defaultEndpoint:"https://api.openai.com/v1",docsUrl:"https://platform.openai.com/docs"},{id:"google",name:"Google AI (Gemini)",type:"api_key",description:"Gemini Pro for multimodal prompt generation",defaultEndpoint:"https://generativelanguage.googleapis.com/v1",docsUrl:"https://ai.google.dev/docs"},{id:"anthropic",name:"Anthropic",type:"api_key",description:"Claude for prompt refinement and analysis",defaultEndpoint:"https://api.anthropic.com/v1",docsUrl:"https://docs.anthropic.com"},{id:"openrouter",name:"OpenRouter",type:"api_key",description:"Aggregated access to multiple AI models",defaultEndpoint:"https://openrouter.ai/api/v1",docsUrl:"https://openrouter.ai/docs"},{id:"replicate",name:"Replicate",type:"api_key",description:"Run open-source models including Llama, Mistral",defaultEndpoint:"https://api.replicate.com/v1",docsUrl:"https://replicate.com/docs"},{id:"stability",name:"Stability AI",type:"api_key",description:"Stable LM and language models",defaultEndpoint:"https://api.stability.ai/v1",docsUrl:"https://platform.stability.ai/docs"},{id:"ollama",name:"Ollama",type:"local",description:"Local LLM server (Llama, Mistral, etc.)",defaultEndpoint:"http://localhost:11434",docsUrl:"https://ollama.ai/docs"},{id:"lmstudio",name:"LM Studio",type:"local",description:"Local LLM with OpenAI-compatible API",defaultEndpoint:"http://localhost:1234/v1",docsUrl:"https://lmstudio.ai/docs"},{id:"github_copilot",name:"GitHub Copilot",type:"oauth",description:"AI assistance via GitHub OAuth (device flow)",docsUrl:"https://docs.github.com/en/copilot"},{id:"github_models",name:"GitHub Models",type:"api_key",description:"Access GPT-4o, Claude, Llama via GitHub PAT (requires models:read permission)",docsUrl:"https://docs.github.com/en/github-models/quickstart"},{id:"antigravity",name:"Antigravity (Gemini/Claude)",type:"oauth",description:"Google OAuth for Gemini 3 Pro and Claude models via Antigravity",docsUrl:"https://github.com/NoeFabris/opencode-antigravity-auth"},{id:"openai_codex",name:"OpenAI Codex (ChatGPT Plus/Pro)",type:"oauth",description:"OAuth for GPT-5.x models with ChatGPT subscription",docsUrl:"https://help.openai.com/en/articles/11369540-using-codex-with-your-chatgpt-plan"}],qf={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"flex-end",zIndex:1e3,backdropFilter:"blur(4px)"},panel:{width:"420px",maxWidth:"100%",height:"100%",backgroundColor:"var(--bg-medium)",borderLeft:"1px solid var(--border-subtle)",display:"flex",flexDirection:"column",overflow:"hidden",animation:"slideInRight 0.2s ease-out"},header:{padding:"1.25rem 1.5rem",borderBottom:"1px solid var(--border-subtle)",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"var(--bg-dark)"},headerTitle:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)",margin:0},closeButton:{background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",padding:"0.5rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},content:{flex:1,overflowY:"auto",padding:"1.5rem"},section:{marginBottom:"1.5rem"},sectionTitle:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.75rem"},label:{display:"block",fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"0.5rem"},select:{width:"100%",padding:"0.65rem 0.75rem",backgroundColor:"var(--bg-dark)",border:"1px solid var(--border-subtle)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"0.9rem",outline:"none",cursor:"pointer",transition:"border-color 0.15s ease",appearance:"none",backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center"},providerInfo:{backgroundColor:"var(--bg-dark)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"1rem",marginTop:"1rem"},providerName:{fontSize:"1rem",fontWeight:500,color:"var(--text-primary)",marginBottom:"0.35rem"},providerDescription:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"1rem",lineHeight:1.4},inputGroup:{marginBottom:"0.75rem"},inputLabel:{display:"block",fontSize:"0.75rem",color:"var(--text-secondary)",marginBottom:"0.35rem"},input:{width:"100%",padding:"0.6rem 0.75rem",backgroundColor:"var(--bg-medium)",border:"1px solid var(--border-subtle)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"0.85rem",outline:"none",transition:"border-color 0.15s ease",boxSizing:"border-box"},buttonRow:{display:"flex",gap:"0.5rem",marginTop:"1rem"},button:{padding:"0.5rem 0.85rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,cursor:"pointer",transition:"all 0.15s ease",border:"none"},buttonPrimary:{backgroundColor:"var(--accent-primary)",color:"white"},buttonSecondary:{backgroundColor:"var(--bg-light)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},buttonOAuth:{backgroundColor:"var(--bg-light)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",justifyContent:"center",padding:"0.65rem 1rem"},statusRow:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.75rem",padding:"0.5rem 0.75rem",backgroundColor:"var(--bg-medium)",borderRadius:"6px",fontSize:"0.8rem"},statusDot:{width:"8px",height:"8px",borderRadius:"50%",flexShrink:0},footer:{padding:"1rem 1.5rem",borderTop:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-dark)",display:"flex",justifyContent:"flex-end",gap:"0.75rem"},errorText:{fontSize:"0.75rem",color:"var(--error)",marginTop:"0.35rem"},successText:{fontSize:"0.75rem",color:"var(--success)",marginTop:"0.35rem"},docsLink:{fontSize:"0.75rem",color:"var(--accent-primary)",textDecoration:"none",display:"inline-flex",alignItems:"center",gap:"0.25rem",marginTop:"0.5rem"}};function Kf(){try{const e=localStorage.getItem(Vf);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load settings from localStorage:",e)}return{activeProvider:null,providers:{}}}function Yf(){localStorage.setItem($f,"true")}async function Zf(e,t){try{await Hf.updateProviderCredentials(e,{api_key:t.apiKey,endpoint:t.endpoint,oauth_token:t.oauthToken,oauth_refresh_token:t.oauthRefreshToken,oauth_client_id:t.oauthClientId,oauth_client_secret:t.oauthClientSecret})}catch(n){throw console.error(`Failed to save credentials for ${e} to server:`,n),n}}async function Jf(){try{if("true"===localStorage.getItem($f))return!1;const e=Kf();if(!(e.activeProvider||Object.keys(e.providers).length>0))return Yf(),!1;const t=await Hf.getAllCredentials();if(t.active_provider||Object.keys(t.providers).length>0)return Yf(),!1;console.log("[Settings] Migrating credentials from localStorage to server..."),await Hf.importCredentials({activeProvider:e.activeProvider||void 0,providers:e.providers});const n=ng();n&&await Hf.updateSettings({selected_model:n.model});const r=sg();return r&&await Hf.updateSettings({target_model:r}),Yf(),console.log("[Settings] Migration complete!"),!0}catch(e){return console.error("Failed to migrate localStorage to server:",e),!1}}function Qf(){return Kf()}function eg(e){!function(e){try{localStorage.setItem(Vf,JSON.stringify(e))}catch(t){console.error("Failed to save settings to localStorage:",t)}}(e)}function tg(e,t){return{disconnected:e("settings.status.disconnected"),connecting:e("settings.status.connecting"),connected:e("settings.status.connected"),error:e("settings.status.error")}[t]}function ng(){try{const e=localStorage.getItem(Gf);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load LLM settings from localStorage:",e)}return null}function rg(e){try{localStorage.setItem(Gf,JSON.stringify(e))}catch(t){console.error("Failed to save LLM settings to localStorage:",t)}}function ig(){return ng()}function ag(e){rg(e),async function(e){try{await Hf.updateSettings({selected_model:`${e.provider}:${e.model}`}),rg(e)}catch(t){console.error("Failed to save LLM settings to server:",t),rg(e)}}(e).catch(console.error)}function og(){return ig()}function sg(){try{return localStorage.getItem(Wf)}catch(e){return console.error("Failed to load target model from localStorage:",e),null}}function lg(e){try{localStorage.setItem(Wf,e)}catch(t){console.error("Failed to save target model to localStorage:",t)}}function cg(e){lg(e),async function(e){try{await Hf.updateSettings({target_model:e}),lg(e)}catch(t){console.error("Failed to save target model to server:",t),lg(e)}}(e).catch(console.error)}function ug({isOpen:e,onClose:t}){const{t:n}=yf(),[r,i]=kt.useState(null),[a,o]=kt.useState({}),[s,l]=kt.useState("disconnected"),[c,u]=kt.useState(null),[d,h]=kt.useState(!1),[p,m]=kt.useState(!1),[f,g]=kt.useState(!1),[v,y]=kt.useState(""),[_,x]=kt.useState(""),[b,w]=kt.useState([]),[S,M]=kt.useState(!1),[E,C]=kt.useState(null),[T,k]=kt.useState(!1),[P,A]=kt.useState(null),N=async e=>{var t,n;const r={...e};if((null==(t=e.github_copilot)?void 0:t.oauthRefreshToken)&&(null==(n=e.github_copilot)?void 0:n.oauthToken))try{const t=e.github_copilot.oauthToken;if(t.startsWith("eyJ"))try{const e=JSON.parse(atob(t.split(".")[1])),n=e.exp?1e3*e.exp:0,i=Date.now();if(n>0&&n-i<3e5){console.log("[Settings] GitHub Copilot token expires soon, refreshing...");const e=await Hf.refreshOAuthToken("github_copilot");e.success&&e.oauth_token?(console.log("[Settings] GitHub Copilot token refreshed successfully"),r.github_copilot={...r.github_copilot,oauthToken:e.oauth_token}):console.warn("[Settings] Failed to refresh GitHub Copilot token:",e.error_description)}}catch(i){console.log("[Settings] Could not decode token expiration, attempting refresh...");const e=await Hf.refreshOAuthToken("github_copilot");e.success&&e.oauth_token&&(r.github_copilot={...r.github_copilot,oauthToken:e.oauth_token})}}catch(a){console.warn("[Settings] Error refreshing GitHub Copilot token:",a)}return r};kt.useEffect(()=>{if(!e)return;let t=!0;return(async()=>{try{await Jf();let e=await async function(){try{const t=await Hf.getAllCredentials(),n={};for(const r of Object.keys(t.providers))try{const e=await Hf.getProviderCredentials(r);e.exists&&(n[r]={apiKey:e.api_key,endpoint:e.endpoint,oauthToken:e.oauth_token,oauthRefreshToken:e.oauth_refresh_token,oauthClientId:e.oauth_client_id,oauthClientSecret:e.oauth_client_secret})}catch(e){console.warn(`Failed to load credentials for ${r}:`,e)}return{activeProvider:t.active_provider,providers:n}}catch(t){return console.error("Failed to load settings from server:",t),Kf()}}();if(!t)return;if(e={...e,providers:await N(e.providers)},!t)return;i(e.activeProvider),o(e.providers),l("disconnected"),u(null),m(!1);const n=await async function(){try{const e=await Hf.getSettings();if(e.selected_model){const[t,n]=e.selected_model.includes(":")?e.selected_model.split(":"):["",e.selected_model];return{provider:t,model:n}}return null}catch(e){return console.error("Failed to load LLM settings from server:",e),ng()}}();n&&t&&(y(n.provider),x(n.model))}catch(e){if(console.error("Failed to load settings from server, falling back to localStorage:",e),!t)return;const n=Qf();i(n.activeProvider),o(n.providers),l("disconnected"),u(null),m(!1);const r=ig();r&&(y(r.provider),x(r.model))}})(),()=>{t=!1}},[e]),kt.useEffect(()=>{if(!v)return void w([]);const e=a[v],t=Xf.find(e=>e.id===v);if(!("api_key"===(null==t?void 0:t.type)&&(null==e?void 0:e.apiKey)||"oauth"===(null==t?void 0:t.type)&&(null==e?void 0:e.oauthToken)||"local"===(null==t?void 0:t.type)&&((null==e?void 0:e.endpoint)||(null==t?void 0:t.defaultEndpoint)))){const e=dg[v]||"Configure credentials to fetch available models.";return w([{id:"",name:` ${e}`,recommended:!1}]),void x("")}M(!0),Hf.fetchLlmModels({provider:v,credentials:{apiKey:null==e?void 0:e.apiKey,endpoint:null==e?void 0:e.endpoint,oauthToken:null==e?void 0:e.oauthToken}}).then(e=>{var t;if(e.success&&e.models.length>0){if(w(e.models),!e.models.find(e=>e.id===_)){const n=e.models.find(e=>e.recommended);x((null==n?void 0:n.id)||(null==(t=e.models[0])?void 0:t.id)||"")}}else{const t=e.error||"No models available. Check your credentials or provider status.";w([{id:"",name:` ${t}`,recommended:!1}]),x("")}}).catch(e=>{const t=(null==e?void 0:e.message)||"Failed to fetch models. Check your connection and credentials.";w([{id:"",name:` ${t}`,recommended:!1}]),x("")}).finally(()=>M(!1))},[v,a]);const R=r?Xf.find(e=>e.id===r):null,L=r&&a[r]||{},I=kt.useCallback(e=>{i(e||null),l("disconnected"),u(null),m(!0)},[]),j=kt.useCallback((e,t)=>{r&&(o(n=>{const i={...n,[r]:{...n[r],[e]:t||void 0}};if("oauthToken"===e||"oauthRefreshToken"===e||"oauthClientId"===e||"oauthClientSecret"===e){const t=i[r];Zf(r,t).catch(t=>{console.error(`Failed to persist ${e} to server:`,t)})}return i}),m(!0),l("disconnected"))},[r]),D=kt.useCallback(async()=>{if(r&&R){h(!0),l("connecting"),u(null);try{const e=a[r]||{},t=await Hf.testProviderConnection(r,{endpoint:e.endpoint,apiKey:e.apiKey});l(t.status),t.success||u(t.message)}catch(e){l("error"),u(e instanceof Error?e.message:"Connection test failed")}finally{h(!1)}}},[r,R,a]),O=kt.useCallback(async()=>{if(r&&R){l("connecting"),u(null),A(null);try{const t=await Hf.getOAuthFlowType(r);if("device"===t.flow_type){const e=a[r]||{},t=await Hf.requestDeviceCode(r,e.oauthClientId);C({userCode:t.user_code,verificationUri:t.verification_uri,deviceCode:t.device_code,interval:t.interval,expiresIn:t.expires_in}),k(!0);const n=1e3*t.interval,i=Date.now()+1e3*t.expires_in,o=async()=>{if(Date.now()>i)return k(!1),C(null),l("error"),void u("Authorization timed out. Please try again.");try{const i=await Hf.pollDeviceToken(r,t.device_code,e.oauthClientId);if(i.success&&i.access_token)k(!1),C(null),"github_copilot"===r&&i.copilot_token?(j("oauthToken",i.copilot_token),j("oauthRefreshToken",i.access_token)):(j("oauthToken",i.access_token),i.refresh_token&&j("oauthRefreshToken",i.refresh_token)),l("connected");else if(i.should_continue){const e=i.slow_down?2*n:n;setTimeout(o,e)}else k(!1),C(null),l("error"),u(i.error_description||i.error||"Authorization failed")}catch(a){k(!1),C(null),l("error"),u(a instanceof Error?a.message:"Polling failed")}};setTimeout(o,n)}else{const n=!!(null==(e=window.pywebview)?void 0:e.api);let i;i=n?`http://localhost:${8765}/oauth-callback`:`${window.location.origin}/oauth/callback`;const o=a[r]||{},c=await Hf.initiateOAuth(r,i,o.oauthClientId);if(!c.authorization_url)throw new Error("Failed to get authorization URL");sessionStorage.setItem("oauth_state",c.state),sessionStorage.setItem("oauth_provider",r);if(null!=t.redirect_uri||n){const e=await Hf.startCallbackServer(r,c.state,void 0,n&&!t.redirect_uri?i:void 0);if(!e.success)throw new Error(e.error_description||e.error||"Failed to start callback server");let a=null;if(n)await(async e=>{var t;const n=null==(t=window.pywebview)?void 0:t.api;if(null==n?void 0:n.open_in_browser)try{return await n.open_in_browser(e),!0}catch(i){console.error("Failed to open URL via pywebview API:",i)}const r=document.createElement("a");return r.href=e,r.target="_blank",r.rel="noopener noreferrer",document.body.appendChild(r),r.click(),document.body.removeChild(r),!0})(c.authorization_url);else if(a=window.open(c.authorization_url,"oauth-popup","width=600,height=700,scrollbars=yes"),!a)return void(window.location.href=c.authorization_url);k(!0);const o=2e3,s=Date.now()+3e5,d=async()=>{if(Date.now()>s)return k(!1),l("error"),u("Authorization timed out. Please try again."),void(await Hf.stopCallbackServer(r,c.state));try{const e=await Hf.pollCallbackToken(r,c.state);if(e.success&&e.access_token){if(k(!1),j("oauthToken",e.access_token),e.refresh_token&&j("oauthRefreshToken",e.refresh_token),l("connected"),a)try{a.close()}catch{}}else if(e.pending)setTimeout(d,o);else if(k(!1),l("error"),u(e.error_description||e.error||"Authorization failed"),a)try{a.close()}catch{}}catch(e){if(k(!1),l("error"),u(e instanceof Error?e.message:"Polling failed"),a)try{a.close()}catch{}}};setTimeout(d,o)}else{if(!window.open(c.authorization_url,"oauth-popup","width=600,height=700,scrollbars=yes"))throw new Error("Popup blocked. Please allow popups for this site.");const e=t=>{var n;t.origin===window.location.origin&&"oauth_callback"===(null==(n=t.data)?void 0:n.type)&&(window.removeEventListener("message",e),t.data.error?(l("error"),u(t.data.error_description||t.data.error)):t.data.access_token&&(j("oauthToken",t.data.access_token),t.data.refresh_token&&j("oauthRefreshToken",t.data.refresh_token),l("connected")))};window.addEventListener("message",e),setTimeout(()=>{window.removeEventListener("message",e),"connecting"===s&&(l("disconnected"),u("Authorization timed out or was cancelled. You can paste your access token manually below."))},12e4)}}}catch(t){l("error"),u(t instanceof Error?t.message:"OAuth initiation failed"),C(null)}var e}},[r,R,j,s]),U=kt.useCallback(()=>{k(!1),C(null),l("disconnected"),A(null)},[]),F=kt.useCallback(async()=>{h(!0);try{const e=await Hf.detectLocalProviders();if(e.count>0){const t={...a};e.detected.forEach(({provider_id:e,endpoint:n})=>{t[e]={...t[e],endpoint:n}}),o(t),m(!0);e.detected.find(e=>e.provider_id===r)&&l("connected")}}catch(e){console.error("Auto-detect failed:",e)}finally{h(!1)}},[r,a]),z=kt.useCallback(async()=>{try{for(const[t,n]of Object.entries(a))(n.apiKey||n.endpoint||n.oauthToken)&&await Zf(t,n);const e=v&&_?`${v}:${_}`:null;await async function(e,t){try{await Hf.updateSettings({active_provider:e||void 0,selected_model:t||void 0})}catch(n){throw console.error("Failed to save settings to server:",n),n}}(r,e);eg({activeProvider:r,providers:a}),v&&_&&ag({provider:v,model:_}),m(!1),t()}catch(e){console.error("Failed to save settings to server:",e);eg({activeProvider:r,providers:a}),v&&_&&ag({provider:v,model:_}),m(!1),t()}},[r,a,v,_,t]),B=kt.useCallback(()=>{if(p){if(!window.confirm(n("settings.unsavedChangesConfirm")))return}t()},[p,t,n]);return e?Ot.jsxs("div",{style:qf.overlay,onClick:e=>e.target===e.currentTarget&&B(),role:"dialog","aria-modal":"true","aria-labelledby":"settings-title",children:[Ot.jsxs("div",{style:qf.panel,children:[Ot.jsxs("header",{style:qf.header,children:[Ot.jsx("h2",{id:"settings-title",style:qf.headerTitle,children:n("settings.title")}),Ot.jsx("button",{style:qf.closeButton,onClick:B,"aria-label":n("settings.close"),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--bg-light)",e.currentTarget.style.color="var(--text-primary)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text-muted)"},children:Ot.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ot.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ot.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),Ot.jsxs("div",{style:qf.content,children:[Ot.jsxs("section",{style:qf.section,children:[Ot.jsx("label",{style:qf.label,htmlFor:"provider-select",children:n("settings.selectProvider")}),Ot.jsxs("select",{id:"provider-select",style:qf.select,value:r||"",onChange:e=>I(e.target.value),children:[Ot.jsx("option",{value:"",children:n("settings.selectProviderPlaceholder")}),Ot.jsx("optgroup",{label:n("settings.cloudApi"),children:Xf.filter(e=>"api_key"===e.type).map(e=>Ot.jsx("option",{value:e.id,children:e.name},e.id))}),Ot.jsx("optgroup",{label:n("settings.localNoAuth"),children:Xf.filter(e=>"local"===e.type).map(e=>Ot.jsx("option",{value:e.id,children:e.name},e.id))}),Ot.jsx("optgroup",{label:n("settings.oauth"),children:Xf.filter(e=>"oauth"===e.type).map(e=>Ot.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),R&&Ot.jsxs("section",{style:qf.section,children:[Ot.jsx("h3",{style:qf.sectionTitle,children:n("settings.configuration")}),Ot.jsxs("div",{style:qf.providerInfo,children:[Ot.jsx("div",{style:qf.providerName,children:R.name}),Ot.jsx("p",{style:qf.providerDescription,children:R.description}),"api_key"===R.type&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("div",{style:qf.inputGroup,children:[Ot.jsx("label",{style:qf.inputLabel,htmlFor:"api-key",children:"API Key"}),Ot.jsxs("div",{style:{position:"relative"},children:[Ot.jsx("input",{id:"api-key",type:f?"text":"password",style:qf.input,placeholder:"Enter your API key",value:L.apiKey||"",onChange:e=>j("apiKey",e.target.value),autoComplete:"off"}),Ot.jsx("button",{type:"button",onClick:()=>g(!f),style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",padding:"4px",fontSize:"0.75rem"},children:f?"Hide":"Show"})]})]}),Ot.jsxs("div",{style:qf.inputGroup,children:[Ot.jsx("label",{style:qf.inputLabel,htmlFor:"endpoint",children:"Custom Endpoint (optional)"}),Ot.jsx("input",{id:"endpoint",type:"text",style:qf.input,placeholder:R.defaultEndpoint,value:L.endpoint||"",onChange:e=>j("endpoint",e.target.value)})]}),Ot.jsx("div",{style:qf.buttonRow,children:Ot.jsx("button",{style:{...qf.button,...qf.buttonSecondary,opacity:d?.6:1},onClick:D,disabled:!L.apiKey||d,children:d?"Testing...":"Test Connection"})})]}),"local"===R.type&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("div",{style:qf.inputGroup,children:[Ot.jsx("label",{style:qf.inputLabel,htmlFor:"endpoint",children:"Endpoint URL"}),Ot.jsx("input",{id:"endpoint",type:"text",style:qf.input,placeholder:R.defaultEndpoint,value:L.endpoint||R.defaultEndpoint||"",onChange:e=>j("endpoint",e.target.value)})]}),Ot.jsxs("div",{style:qf.buttonRow,children:[Ot.jsx("button",{style:{...qf.button,...qf.buttonSecondary,opacity:d?.6:1},onClick:D,disabled:d,children:d?"Testing...":"Test Connection"}),Ot.jsx("button",{style:{...qf.button,...qf.buttonSecondary,opacity:d?.6:1},onClick:F,disabled:d,children:"Auto-Detect"})]})]}),"oauth"===R.type&&Ot.jsx(Ot.Fragment,{children:L.oauthToken?Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("div",{style:qf.statusRow,children:[Ot.jsx("span",{style:{...qf.statusDot,backgroundColor:"var(--success)"}}),Ot.jsx("span",{style:{color:"var(--text-secondary)"},children:"Connected via OAuth"})]}),Ot.jsx("div",{style:qf.buttonRow,children:Ot.jsx("button",{style:{...qf.button,...qf.buttonSecondary,flex:1},onClick:()=>{j("oauthToken",""),j("oauthRefreshToken",""),l("disconnected")},children:"Disconnect"})})]}):E?Ot.jsxs("div",{style:{backgroundColor:"var(--bg-medium)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"1.25rem",textAlign:"center"},children:[Ot.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:"Enter this code at the link below:"}),Ot.jsx("div",{style:{fontSize:"1.75rem",fontFamily:"monospace",fontWeight:700,color:"var(--accent-primary)",letterSpacing:"0.15em",padding:"0.75rem 1rem",backgroundColor:"var(--bg-dark)",borderRadius:"6px",marginBottom:"1rem",userSelect:"all",cursor:"pointer"},title:"Click to select",onClick:e=>{const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e.currentTarget),null==t||t.removeAllRanges(),null==t||t.addRange(n)},children:E.userCode}),Ot.jsxs("a",{href:E.verificationUri,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.6rem 1rem",backgroundColor:"var(--accent-primary)",color:"white",textDecoration:"none",borderRadius:"6px",fontSize:"0.85rem",fontWeight:500,marginBottom:"1rem"},children:[Ot.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ot.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),Ot.jsx("path",{d:"M15 3h6v6"}),Ot.jsx("path",{d:"M10 14L21 3"})]}),"Open ",E.verificationUri.replace("https://","")]}),T&&Ot.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:"var(--text-muted)",fontSize:"0.8rem",marginBottom:"1rem"},children:[Ot.jsx("span",{style:{width:"12px",height:"12px",border:"2px solid var(--text-muted)",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Waiting for authorization..."]}),P&&Ot.jsx("p",{style:{...qf.errorText,marginBottom:"0.75rem"},children:P}),Ot.jsx("button",{style:{...qf.button,...qf.buttonSecondary,width:"100%"},onClick:U,children:"Cancel"})]}):Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("button",{style:{...qf.button,...qf.buttonOAuth},onClick:O,disabled:T,children:["github_copilot"===r?Ot.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ot.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})}):"openai_codex"===r?Ot.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ot.jsx("path",{d:"M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.896zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08-4.778 2.758a.795.795 0 0 0-.392.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"})}):Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[Ot.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),Ot.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),Ot.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),Ot.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Connect with ",R.name]}),Ot.jsx("div",{style:{marginTop:"1rem"},children:Ot.jsxs("div",{style:qf.inputGroup,children:[Ot.jsx("label",{style:qf.inputLabel,htmlFor:"oauth-token",children:"Or paste access token manually"}),Ot.jsx("input",{id:"oauth-token",type:"password",style:qf.input,placeholder:"Access token",value:L.oauthToken||"",onChange:e=>j("oauthToken",e.target.value),autoComplete:"off"})]})})]})}),"disconnected"!==s&&Ot.jsxs("div",{style:qf.statusRow,children:[Ot.jsx("span",{style:{...qf.statusDot,backgroundColor:(H=s,{disconnected:"var(--text-muted)",connecting:"var(--warning)",connected:"var(--success)",error:"var(--error)"}[H])}}),Ot.jsx("span",{style:{color:"var(--text-secondary)"},children:tg(n,s)})]}),c&&Ot.jsx("p",{style:qf.errorText,children:c}),"connected"===s&&Ot.jsx("p",{style:qf.successText,children:"Connection successful!"}),R.docsUrl&&Ot.jsxs("a",{href:R.docsUrl,target:"_blank",rel:"noopener noreferrer",style:qf.docsLink,children:[Ot.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ot.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),Ot.jsx("path",{d:"M15 3h6v6"}),Ot.jsx("path",{d:"M10 14L21 3"})]}),"View documentation"]})]})]}),Ot.jsxs("section",{style:qf.section,children:[Ot.jsx("h3",{style:qf.sectionTitle,children:"Default LLM Model"}),Ot.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"1rem",lineHeight:1.4},children:"Select the default provider and model for AI prompt enhancement. This persists across sessions."}),Ot.jsxs("div",{style:qf.inputGroup,children:[Ot.jsx("label",{style:qf.inputLabel,htmlFor:"llm-provider-select",children:"LLM Provider"}),Ot.jsxs("select",{id:"llm-provider-select",style:qf.select,value:v,onChange:e=>{y(e.target.value),x(""),m(!0)},children:[Ot.jsx("option",{value:"",children:"-- Select provider --"}),Xf.map(e=>{const t=a[e.id],n="api_key"===e.type&&(null==t?void 0:t.apiKey)||"oauth"===e.type&&(null==t?void 0:t.oauthToken)||"local"===e.type&&((null==t?void 0:t.endpoint)||e.defaultEndpoint);return Ot.jsxs("option",{value:e.id,disabled:!n,children:[e.name," ",n?"":"(not configured)"]},e.id)})]})]}),v&&Ot.jsxs("div",{style:qf.inputGroup,children:[Ot.jsxs("label",{style:qf.inputLabel,htmlFor:"llm-model-select",children:["Model ",S&&Ot.jsx("span",{style:{color:"var(--text-muted)"},children:"(loading...)"})]}),Ot.jsxs("select",{id:"llm-model-select",style:qf.select,value:_,onChange:e=>{x(e.target.value),m(!0)},disabled:S||0===b.length,children:[Ot.jsx("option",{value:"",children:"-- Select model --"}),b.map(e=>Ot.jsxs("option",{value:e.id,children:[e.name," ",e.recommended?"(recommended)":""]},e.id))]})]})]}),!R&&Ot.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)",fontSize:"0.9rem"},children:"Select an AI provider to configure it for prompt enhancement."})]}),Ot.jsxs("footer",{style:qf.footer,children:[Ot.jsx("button",{style:{...qf.button,...qf.buttonSecondary},onClick:B,children:"Cancel"}),Ot.jsx("button",{style:{...qf.button,...qf.buttonPrimary,opacity:p?1:.5},onClick:z,disabled:!p,children:"Save Changes"})]})]}),Ot.jsx("style",{children:"\n        @keyframes slideInRight {\n          from {\n            transform: translateX(100%);\n          }\n          to {\n            transform: translateX(0);\n          }\n        }\n        @keyframes spin {\n          from {\n            transform: rotate(0deg);\n          }\n          to {\n            transform: rotate(360deg);\n          }\n        }\n      "})]}):null;var H}const dg={openai:"Enter your OpenAI API key to fetch available models.",anthropic:"Enter your Anthropic API key to fetch available models.",google:"Enter your Google AI API key to fetch available models.",openrouter:"Enter your OpenRouter API key to fetch available models.",replicate:"Enter your Replicate API token to fetch available models.",stability:"Enter your Stability AI API key to fetch available models.",ollama:"Ensure Ollama is running locally to fetch available models.",lmstudio:"Ensure LM Studio is running locally to fetch available models.",github_copilot:"Enter your GitHub PAT with models:read permission to fetch available models.",antigravity:"Complete Google OAuth authentication to fetch available models.",openai_codex:"Complete ChatGPT OAuth authentication to fetch available models."};function hg(){const e=Qf(),t=[];for(const n of Xf){const r=e.providers[n.id];("api_key"===n.type&&(null==r?void 0:r.apiKey)||"oauth"===n.type&&(null==r?void 0:r.oauthToken)||"local"===n.type&&((null==r?void 0:r.endpoint)||n.defaultEndpoint))&&t.push({providerId:n.id,providerName:n.name,providerType:n.type,credentials:r||{},models:[],isActive:e.activeProvider===n.id})}return t}const pg={camera_type:["Digital","Film"],camera_manufacturer:["ARRI","RED","Sony","Canon","Blackmagic","Panasonic","DJI","Nikon"],camera_manufacturer_film:["ARRI_Film","Eclair","Panavision","Mitchell","IMAX","Vintage"],camera_body:["Alexa_35","Alexa_Mini","Alexa_Mini_LF","Alexa_LF","Alexa_65","V_Raptor","V_Raptor_X","V_Raptor_XL","Komodo_X","Monstro_8K","Venice_2","FX9","FX6","C700_FF","C500_Mark_II","C300_Mark_III","Ursa_Mini_Pro_12K","Pocket_6K","Varicam_LT","S1H","Z9","Inspire_3","Mavic_3_Cine"],camera_body_film:["Arricam_ST","Arricam_LT","ARRI_535B","ARRI_35BL","ARRI_35_III","Arriflex_35","Arriflex_35BL","Arriflex_435","Eclair_NPR","Panavision_Millennium_XL2","Panavision_Millennium","Panavision_Platinum","Panavision_Gold","Panavision_Panastar","Panavision_Panaflex","Super_Panavision_70","Ultra_Panavision_70","Panavision_XL","Mitchell_BNC","Mitchell_BNCR","Mitchell_BFC_65","IMAX_MSM_9802","IMAX_MKIV","IMAX_GT","Alexa","Alexa_XT","RED_One","UFA_Custom","Pathe_Studio"],film_stock:["Kodak_Vision3_500T_5219","Kodak_Vision3_250D_5207","Kodak_Vision3_200T_5213","Kodak_Vision3_50D_5203","Kodak_Vision2_500T_5218","Kodak_Vision2_200T_5217","Kodak_Vision_500T_5279","Kodak_Vision_320T_5277","Kodak_Double_X_5222","Kodak_Tri_X","Eastman_Double_X","Eastman_Plus_X","Eastman_5247","Eastman_5293","Eastman_5294","Eastman_5250","Eastman_5254","Technicolor","Kodachrome","Fuji_Eterna_500T","Fuji_Eterna_250D","Fuji_Eterna_250T"],film_stock_65mm:["Kodak_65mm_500T","Kodak_65mm_250D","Kodak_65mm_200T"],film_stock_imax:["IMAX_500T","IMAX_250D"],aspect_ratio:["1.33:1","1.37:1","1.66:1","1.78:1","1.85:1","2.20:1","2.35:1","2.39:1","2.76:1","1.43:1","1.90:1"],lens_manufacturer:["ARRI","Zeiss","Cooke","Panavision","Angenieux","Leica","Canon","Sony","Sigma","Fujifilm","Hawk","Hasselblad","Technovision","Bausch_Lomb","Todd_AO","Kowa","Vintage","Warner_Bros","Paramount","Pathe"],lens_family:["ARRI_Signature_Prime","ARRI_Master_Prime","ARRI_Ultra_Prime","ARRI_Prime_65","ARRI_Prime_DNA","Zeiss_Supreme_Prime","Zeiss_Master_Prime","Zeiss_CP3","Zeiss_Super_Speed","Zeiss_Standard_Speed","Zeiss_Ultra_Prime","Zeiss_Planar_f0.7","Cooke_S7","Cooke_S4","Cooke_Panchro","Cooke_Speed_Panchro","Panavision_Primo","Panavision_Primo_70","Panavision_C_Series","Panavision_E_Series","Panavision_Super_Speed","Panavision_Standard","Panavision_Ultra_Speed","Panavision_Auto_Panatar","Ultra_Panavision_Optics","Angenieux_Optimo","Leica_Summicron_C","Leica_Summilux_C","Canon_Sumire","Canon_K35","Sony_CineAlta","Sigma_Cine","Hawk_V_Lite","Hawk_V_Plus","Hasselblad_HC","Hasselblad_V","IMAX_Optics","Bausch_Lomb_Super_Baltar","Bausch_Lomb_Baltar","Todd_AO","Kowa_Anamorphic","Vintage_Spherical","Vintage_Anamorphic"],focal_length_mm:[14,18,21,24,28,32,35,40,50,65,75,85,100,135,150,200],movement_equipment:["Static","Handheld","Steadicam","Gimbal","Dolly","Crane","Jib","Technocrane","Drone"],movement_type:["Static","Pan","Tilt","Track_In","Track_Out","Arc","Crane_Up","Crane_Down","Dolly_Zoom"],movement_timing:["Static","Very_Slow","Slow","Moderate","Fast","Whip_Fast"],time_of_day:["Dawn","Morning","Midday","Afternoon","Golden_Hour","Blue_Hour","Dusk","Night"],lighting_source:["Sun","Moon","Tungsten","HMI","LED","Kino_Flo","Neon","Practical","Mixed"],lighting_style:["High_Key","Low_Key","Soft","Hard","Naturalistic","Expressionistic","Chiaroscuro"],animation_medium:["2D","3D","Hybrid","StopMotion"],style_domain:["Anime","Manga","ThreeD","Illustration"],line_treatment:["Clean","Sketchy","Bold","Thin","Variable","None"],color_application:["Cel","Gradient","Watercolor","Flat","Textured","Monochrome","Monochrome_Ink"],lighting_model:["Flat","Cel_Shaded","Soft_Shaded","Naturalistic_Simulated","Raytraced"],surface_detail:["Smooth","Textured","Detailed","Photoreal","Stylized"],motion_style:["None","Limited","Full","Exaggerated","Snappy","Fluid"],virtual_camera:["Locked","Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld","Motion_Comic"],shot_size:["EWS","WS","MWS","MS","MCU","CU","BCU","ECU","OTS","POV"],composition:["Rule_of_Thirds","Centered","Symmetrical","Asymmetrical","Negative_Space","Leading_Lines"],mood:["Cheerful","Happy","Hopeful","Whimsical","Adventurous","Romantic","Sensual","Passionate","Intimate","Melancholic","Somber","Reflective","Contemplative","Introspective","Tender","Bittersweet","Nostalgic","Surreal","Dreamlike","Hallucinatory","Transcendent","Meditative","Philosophical","Psychedelic","Gloomy","Menacing","Oppressive","Paranoid","Tense","Anxious","Claustrophobic","Brutal","Traumatic","Unsettling","Ominous","Suspenseful","Mysterious","Haunting","Bleak","Tragic","Lonely","Aggressive","Angry","Rebellious","Kinetic","Urgent","Provocative","Unhinged","Chaotic","Frantic","Intense","Noir","Hardboiled","Fatalistic","Cynical","World_Weary","Gothic","Macabre","Grotesque","Eldritch","Dread","Documentary","Realistic","Observational","Journalistic","Verite","Epic","Serene"],color_tone:["Warm_Saturated","Warm_Desaturated","Cool_Saturated","Cool_Desaturated","Neutral_Saturated","Neutral_Desaturated","Monochrome","Sepia","Teal_Orange"],target_model:["generic","midjourney","flux.1","flux.1_pro","flux_kontext","flux_krea","dall-e_3","gpt-image","ideogram_2.0","leonardo_ai","sdxl","stable_diffusion_3","z-image_turbo","qwen_image","sora","sora_2","veo_2","veo_3","runway_gen-3","runway_gen-4","kling_1.6","pika_2.0","luma_dream_machine","ltx_2","cogvideox","hunyuan","wan_2.1","wan_2.2","minimax_video","qwen_vl"]},mg={generic:"Generic",midjourney:"Midjourney","flux.1":"FLUX.1","flux.1_pro":"FLUX.1 Pro",flux_kontext:"Flux Kontext",flux_krea:"Flux Krea","dall-e_3":"DALL-E 3","gpt-image":"GPT-Image (4o)","ideogram_2.0":"Ideogram 2.0",leonardo_ai:"Leonardo AI",sdxl:"Stable Diffusion XL",stable_diffusion_3:"Stable Diffusion 3","z-image_turbo":"Z-Image Turbo",qwen_image:"Qwen-Image",sora:"Sora",sora_2:"Sora 2",veo_2:"Veo 2",veo_3:"Veo 3","runway_gen-3":"Runway Gen-3","runway_gen-4":"Runway Gen-4","kling_1.6":"Kling 1.6","pika_2.0":"Pika 2.0",luma_dream_machine:"Luma Dream Machine",ltx_2:"LTX-2",cogvideox:"CogVideoX",hunyuan:"Hunyuan Video","wan_2.1":"Wan 2.1","wan_2.2":"Wan 2.2",minimax_video:"Minimax Video",qwen_vl:"Qwen VL"},fg=new Set(["midjourney","flux.1","flux.1_pro","flux_kontext","flux_krea","dall-e_3","gpt-image","ideogram_2.0","leonardo_ai","sdxl","stable_diffusion_3","z-image_turbo","qwen_image"]),gg={EWS:"Extreme Wide Shot (EWS)",WS:"Wide Shot (WS)",MWS:"Medium Wide Shot (MWS)",MS:"Medium Shot (MS)",MCU:"Medium Close-Up (MCU)",CU:"Close-Up (CU)",BCU:"Big Close-Up (BCU)",ECU:"Extreme Close-Up (ECU)",OTS:"Over-The-Shoulder (OTS)",POV:"Point-of-View (POV)"},vg={Alexa_35:"ARRI Alexa 35",Alexa_Mini:"ARRI Alexa Mini",Alexa_Mini_LF:"ARRI Alexa Mini LF",Alexa_LF:"ARRI Alexa LF",Alexa_65:"ARRI Alexa 65",V_Raptor:"RED V-Raptor",V_Raptor_X:"RED V-Raptor X",V_Raptor_XL:"RED V-Raptor XL",Komodo_X:"RED Komodo-X",Monstro_8K:"RED Monstro 8K",Venice_2:"Sony Venice 2",FX9:"Sony FX9",FX6:"Sony FX6",C700_FF:"Canon C700 FF",C500_Mark_II:"Canon C500 Mark II",C300_Mark_III:"Canon C300 Mark III",Ursa_Mini_Pro_12K:"Blackmagic URSA Mini Pro 12K",Pocket_6K:"Blackmagic Pocket Cinema 6K",Varicam_LT:"Panasonic VariCam LT",S1H:"Panasonic S1H",Z9:"Nikon Z9",Inspire_3:"DJI Inspire 3",Mavic_3_Cine:"DJI Mavic 3 Cine",Arricam_ST:"ARRI Arricam ST",Arricam_LT:"ARRI Arricam LT",ARRI_535B:"ARRI 535B",ARRI_35BL:"ARRI 35BL",ARRI_35_III:"ARRI 35 III",Panavision_Millennium_XL2:"Panavision Millennium XL2",Panavision_Millennium:"Panavision Millennium",Panavision_Platinum:"Panavision Platinum",Panavision_Gold:"Panavision Gold",Panavision_Panastar:"Panavision Panastar",Panavision_Panaflex:"Panavision Panaflex",Super_Panavision_70:"Super Panavision 70",Ultra_Panavision_70:"Ultra Panavision 70 (MGM)",Mitchell_BNC:"Mitchell BNC",Mitchell_BNCR:"Mitchell BNCR",Mitchell_BFC_65:"Mitchell BFC 65mm",IMAX_MSM_9802:"IMAX MSM 9802",IMAX_MKIV:"IMAX MKIV",IMAX_GT:"IMAX GT"},yg={ARRI_Signature_Prime:"ARRI Signature Prime",ARRI_Master_Prime:"ARRI/Zeiss Master Prime",ARRI_Ultra_Prime:"ARRI/Zeiss Ultra Prime",ARRI_Prime_65:"ARRI Prime 65 (65mm Format)",ARRI_Prime_DNA:"ARRI Prime DNA LF",Zeiss_Supreme_Prime:"Zeiss Supreme Prime",Zeiss_Master_Prime:"Zeiss Master Prime",Zeiss_CP3:"Zeiss CP.3",Cooke_S7:"Cooke S7/i Full Frame",Cooke_S4:"Cooke S4/i",Cooke_Panchro:"Cooke Panchro/i Classic",Cooke_Speed_Panchro:"Cooke Speed Panchro (Vintage)",Panavision_Primo:"Panavision Primo",Panavision_Primo_70:"Panavision Primo 70",Panavision_C_Series:"Panavision C-Series Anamorphic",Panavision_E_Series:"Panavision E-Series Anamorphic",Panavision_Super_Speed:"Panavision Super Speed (Z-Series)",Panavision_Standard:"Panavision Standard (Pre-1970)",Panavision_Ultra_Speed:"Panavision Ultra Speed",Panavision_Auto_Panatar:"Panavision Auto Panatar",Angenieux_Optimo:"Angnieux Optimo",Leica_Summicron_C:"Leica Summicron-C",Leica_Summilux_C:"Leica Summilux-C",Canon_Sumire:"Canon Sumire Prime",Sony_CineAlta:"Sony CineAlta",Sigma_Cine:"Sigma Cine",Bausch_Lomb_Super_Baltar:"Bausch & Lomb Super Baltar",Bausch_Lomb_Baltar:"Bausch & Lomb Baltar",Zeiss_Planar_f07:"Zeiss Planar f/0.7 (Kubrick)",Zeiss_Super_Speed:"Zeiss Super Speed",Zeiss_Standard_Speed:"Zeiss Standard Speed (Mk II/III)",Canon_K35:"Canon K35",Kowa_Anamorphic:"Kowa Anamorphic (Cinerama)",Todd_AO:"Todd-AO 70mm Optics",Ultra_Panavision_Optics:"Ultra Panavision 70 Optics",Vintage_Spherical:"Vintage Spherical (Generic)",Vintage_Anamorphic:"Vintage Anamorphic (Generic)",Hawk_V_Lite:"Hawk V-Lite Anamorphic",Hawk_V_Plus:"Hawk V-Plus Anamorphic",Hasselblad_HC:"Hasselblad HC (Medium Format)",Hasselblad_V:"Hasselblad V-System (Carl Zeiss)",IMAX_Optics:"IMAX Custom Optics"},_g={Alexa_35:"Medium",Alexa_Mini:"Light",Alexa_Mini_LF:"Medium",Alexa_LF:"Medium",Alexa_65:"Heavy",V_Raptor:"Light",V_Raptor_X:"Light",V_Raptor_XL:"Medium",Komodo_X:"Light",Monstro_8K:"Medium",Venice_2:"Heavy",FX9:"Heavy",FX6:"Light",C700_FF:"Heavy",C500_Mark_II:"Medium",C300_Mark_III:"Medium",Ursa_Mini_Pro_12K:"Heavy",Pocket_6K:"Light",Varicam_LT:"Medium",S1H:"Light",Z9:"Light",Inspire_3:"Light",Mavic_3_Cine:"Light",Arricam_ST:"Heavy",Arricam_LT:"Medium",ARRI_535B:"Heavy",ARRI_35BL:"Heavy",ARRI_35_III:"Medium",Panavision_Millennium_XL2:"Heavy",Panavision_Millennium:"Heavy",Panavision_Platinum:"Heavy",Panavision_Gold:"Heavy",Panavision_Panastar:"Heavy",Panavision_Panaflex:"Heavy",Super_Panavision_70:"Heavy",Ultra_Panavision_70:"Heavy",Mitchell_BNC:"Heavy",Mitchell_BNCR:"Heavy",Mitchell_BFC_65:"Heavy",IMAX_MSM_9802:"Heavy",IMAX_MKIV:"Heavy",IMAX_GT:"Heavy"},xg={ARRI:["Alexa_35","Alexa_Mini","Alexa_Mini_LF","Alexa_LF","Alexa_65"],RED:["V_Raptor","V_Raptor_X","V_Raptor_XL","Komodo_X","Monstro_8K"],Sony:["Venice_2","FX9","FX6"],Canon:["C700_FF","C500_Mark_II","C300_Mark_III"],Blackmagic:["Ursa_Mini_Pro_12K","Pocket_6K"],Panasonic:["Varicam_LT","S1H"],Nikon:["Z9"],DJI:["Inspire_3","Mavic_3_Cine"],ARRI_Film:["Arricam_ST","Arricam_LT","ARRI_535B","ARRI_35BL","ARRI_35_III","Arriflex_35","Arriflex_35BL","Arriflex_435"],Eclair:["Eclair_NPR"],Panavision:["Panavision_Millennium_XL2","Panavision_Millennium","Panavision_Platinum","Panavision_Gold","Panavision_Panastar","Panavision_Panaflex","Super_Panavision_70","Ultra_Panavision_70","Panavision_XL"],Mitchell:["Mitchell_BNC","Mitchell_BNCR","Mitchell_BFC_65"],IMAX:["IMAX_MSM_9802","IMAX_MKIV","IMAX_GT"],Vintage:["UFA_Custom","Pathe_Studio","Alexa","Alexa_XT","RED_One"]},bg=["Handheld","Gimbal","Drone"],wg={Static:["Static"],Handheld:["Static","Pan","Tilt"],Steadicam:["Static","Pan","Tilt","Track_In","Track_Out","Arc"],Gimbal:["Static","Pan","Tilt","Track_In","Track_Out","Arc"],Dolly:["Static","Track_In","Track_Out","Dolly_Zoom"],Slider:["Static","Track_In","Track_Out","Dolly_Zoom"],Crane:["Static","Crane_Up","Crane_Down","Arc"],Jib:["Static","Crane_Up","Crane_Down","Arc"],Technocrane:["Static","Pan","Tilt","Track_In","Track_Out","Crane_Up","Crane_Down","Arc"],Drone:["Static","Track_In","Track_Out","Crane_Up","Crane_Down","Arc"]},Sg={Dolly_Zoom:["Dolly","Slider"]},Mg={Dolly_Zoom:["Static","Very_Slow","Slow","Moderate"]},Eg={Night:["Moon","Tungsten","HMI","LED","Kino_Flo","Neon","Practical","Mixed"],Blue_Hour:["Moon","Tungsten","HMI","LED","Kino_Flo","Neon","Practical","Mixed"],Midday:["Sun","HMI","LED","Kino_Flo","Practical","Mixed"]},Cg={HMI:1972,Kino_Flo:1987,LED:2002},Tg={Midday:["High_Key","Soft","Hard","Naturalistic"]},kg={Cheerful:{disallowed:["Low_Key"],preferred:["High_Key","Soft"]},Hopeful:{disallowed:["Low_Key"],preferred:["High_Key","Soft","Naturalistic"]},Gloomy:{disallowed:[],preferred:["Low_Key","Hard"]},Menacing:{disallowed:[],preferred:["Low_Key","Hard","Chiaroscuro"]},Noir:{disallowed:[],preferred:["Low_Key","Chiaroscuro","Hard"]},Paranoid:{disallowed:[],preferred:["Low_Key","Hard"]}},Pg={Manga:{disallowed_colors:["Cel","Gradient","Watercolor","Flat","Textured"],disallowed_cameras:["Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld"],disallowed_motion:["Limited","Full","Exaggerated","Snappy","Fluid"],required_lighting:["Flat"]},Illustration:{disallowed_motion:["Limited","Full","Exaggerated","Snappy","Fluid"],disallowed_cameras:["Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld"]},Anime:{disallowed_cameras:["Simulated_Handheld"],disallowed_lighting:["Raytraced"]},ThreeD:{disallowed_lighting:["Flat"]}},Ag={"2D":["Free_3D"]},Ng={None:["Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld"]};function Rg(e,t){return e<=24&&["CU","BCU","ECU"].includes(t)?`Wide lens (${e}mm) on ${t} causes facial distortion`:e<=18&&["MCU"].includes(t)?`Very wide lens (${e}mm) on ${t} may cause noticeable distortion`:e>=135&&["EWS","WS"].includes(t)?`Long lens (${e}mm) on ${t} creates extreme compression`:e>=100&&"EWS"===t?`Telephoto (${e}mm) on EWS is unusual - extreme distance required`:"ECU"===t&&e<85?"ECU typically uses 85-135mm lenses for flattering perspective":"EWS"===t&&e>35?"EWS typically uses 14-24mm for maximum environmental context":null}const Lg={Alexa_35:"S35",Alexa_Mini:"S35",Alexa_Mini_LF:"LF",Alexa_LF:"LF",Alexa_65:"65mm",V_Raptor:"FF",V_Raptor_X:"FF",V_Raptor_XL:"FF",Komodo_X:"S35",Monstro_8K:"FF",Venice_2:"FF",FX9:"FF",FX6:"FF",C700_FF:"FF",C500_Mark_II:"FF",C300_Mark_III:"S35",Ursa_Mini_Pro_12K:"S35",Pocket_6K:"S35",Varicam_LT:"S35",S1H:"FF",Z9:"FF",Inspire_3:"FF",Mavic_3_Cine:"M43",Arricam_ST:"S35",Arricam_LT:"S35",ARRI_535B:"S35",ARRI_35BL:"S35",ARRI_35_III:"S35",Panavision_Millennium_XL2:"S35",Panavision_Millennium:"S35",Panavision_Platinum:"S35",Panavision_Gold:"S35",Panavision_Panastar:"S35",Panavision_Panaflex:"S35",Super_Panavision_70:"65mm",Ultra_Panavision_70:"65mm",Mitchell_BNC:"S35",Mitchell_BNCR:"S35",Mitchell_BFC_65:"65mm",IMAX_MSM_9802:"IMAX_15perf",IMAX_MKIV:"IMAX_15perf",IMAX_GT:"IMAX_15perf"},Ig={Alexa_35:"LPL",Alexa_Mini:"PL",Alexa_Mini_LF:"LPL",Alexa_LF:"LPL",Alexa_65:"XPL",V_Raptor:"RF",V_Raptor_X:"RF",V_Raptor_XL:"RF",Komodo_X:"RF",Monstro_8K:"PL",Venice_2:"PL",FX9:"E",FX6:"E",C700_FF:"PL",C500_Mark_II:"EF",C300_Mark_III:"EF",Ursa_Mini_Pro_12K:"PL",Pocket_6K:"EF",Varicam_LT:"PL",S1H:"L",Z9:"Z",Inspire_3:"DL",Mavic_3_Cine:"Fixed",Arricam_ST:"PL",Arricam_LT:"PL",ARRI_535B:"PL",ARRI_35BL:"PL",ARRI_35_III:"PL",Panavision_Millennium_XL2:"Panavision",Panavision_Millennium:"Panavision",Panavision_Platinum:"Panavision",Panavision_Gold:"Panavision",Panavision_Panastar:"Panavision",Panavision_Panaflex:"Panavision",Super_Panavision_70:"Panavision_65",Ultra_Panavision_70:"Panavision_65",Mitchell_BNC:"Mitchell_Standard",Mitchell_BNCR:"Mitchell_Standard",Mitchell_BFC_65:"Mitchell_Standard",IMAX_MSM_9802:"IMAX_Standard",IMAX_MKIV:"IMAX_Standard",IMAX_GT:"IMAX_Standard"},jg={ARRI_Ultra_Prime:["S35"],ARRI_Master_Prime:["S35"],ARRI_Signature_Prime:["S35","FF","LF"],ARRI_Prime_65:["LF","65mm"],ARRI_Prime_DNA:["LF","65mm"],Zeiss_Master_Prime:["S35"],Zeiss_CP3:["S35","FF"],Zeiss_Supreme_Prime:["S35","FF","LF"],Cooke_S4:["S35"],Cooke_Panchro:["S35"],Cooke_Speed_Panchro:["S35"],Cooke_S7:["S35","FF","LF"],Panavision_Primo:["S35"],Panavision_C_Series:["S35"],Panavision_E_Series:["S35"],Panavision_Super_Speed:["S35"],Panavision_Standard:["S35"],Panavision_Ultra_Speed:["S35"],Panavision_Auto_Panatar:["S35"],Panavision_Primo_70:["S35","FF","LF","65mm"],Ultra_Panavision_Optics:["65mm"],Angenieux_Optimo:["S35","FF"],Leica_Summicron_C:["S35","FF"],Leica_Summilux_C:["S35","FF"],Canon_Sumire:["S35","FF"],Canon_K35:["S35"],Sony_CineAlta:["S35","FF"],Sigma_Cine:["S35","FF"],Bausch_Lomb_Super_Baltar:["S35"],Bausch_Lomb_Baltar:["S35"],Zeiss_Planar_f07:["S35"],Zeiss_Super_Speed:["S35"],Zeiss_Standard_Speed:["S35"],Kowa_Anamorphic:["S35"],Todd_AO:["65mm","IMAX_15perf"],Hasselblad_HC:["FF","LF","65mm"],Hasselblad_V:["FF","LF","65mm","IMAX_15perf"],IMAX_Optics:["IMAX_15perf","65mm","LF"]},Dg={ARRI_Ultra_Prime:["PL","LPL"],ARRI_Master_Prime:["PL","LPL"],ARRI_Signature_Prime:["LPL","PL"],ARRI_Prime_65:["XPL"],ARRI_Prime_DNA:["LPL"],Zeiss_Master_Prime:["PL","LPL"],Zeiss_CP3:["PL","LPL","EF"],Zeiss_Supreme_Prime:["PL","LPL"],Cooke_S4:["PL","LPL"],Cooke_Panchro:["PL","LPL"],Cooke_S7:["PL","LPL"],Cooke_Speed_Panchro:["PL"],Angenieux_Optimo:["PL","LPL"],Leica_Summicron_C:["PL","LPL"],Leica_Summilux_C:["PL","LPL"],Canon_Sumire:["PL","EF"],Canon_K35:["PL"],Sony_CineAlta:["PL","E"],Sigma_Cine:["PL","EF","E"],Panavision_Primo:["Panavision"],Panavision_Primo_70:["Panavision","Panavision_65","XPL"],Panavision_C_Series:["Panavision"],Panavision_E_Series:["Panavision"],Panavision_Super_Speed:["Panavision"],Panavision_Standard:["Panavision"],Panavision_Ultra_Speed:["Panavision"],Panavision_Auto_Panatar:["Panavision"],Ultra_Panavision_Optics:["Panavision_65"],Bausch_Lomb_Super_Baltar:["PL","Mitchell_Standard"],Bausch_Lomb_Baltar:["PL","Mitchell_Standard"],Zeiss_Planar_f07:["PL"],Zeiss_Super_Speed:["PL"],Zeiss_Standard_Speed:["PL"],Kowa_Anamorphic:["PL","Mitchell_Standard"],Todd_AO:["Mitchell_Standard","IMAX_Standard"]},Og={ARRI:["ARRI_Signature_Prime","ARRI_Master_Prime","ARRI_Ultra_Prime","ARRI_Prime_65","ARRI_Prime_DNA"],Zeiss:["Zeiss_Supreme_Prime","Zeiss_Master_Prime","Zeiss_CP3","Zeiss_Super_Speed","Zeiss_Standard_Speed","Zeiss_Ultra_Prime","Zeiss_Planar_f0.7"],Cooke:["Cooke_S7","Cooke_S4","Cooke_Panchro","Cooke_Speed_Panchro"],Panavision:["Panavision_Primo","Panavision_Primo_70","Panavision_C_Series","Panavision_E_Series","Panavision_Super_Speed","Panavision_Standard","Panavision_Ultra_Speed","Panavision_Auto_Panatar","Ultra_Panavision_Optics"],Angenieux:["Angenieux_Optimo"],Leica:["Leica_Summicron_C","Leica_Summilux_C"],Canon:["Canon_Sumire","Canon_K35"],Sony:["Sony_CineAlta"],Sigma:["Sigma_Cine"],Fujifilm:[],Hawk:["Hawk_V_Lite","Hawk_V_Plus"],Technovision:["Vintage_Anamorphic"],Bausch_Lomb:["Bausch_Lomb_Super_Baltar","Bausch_Lomb_Baltar"],Todd_AO:["Todd_AO"],Kowa:["Kowa_Anamorphic"],Vintage:["Vintage_Spherical","Vintage_Anamorphic"],Hasselblad:["Hasselblad_HC","Hasselblad_V","IMAX_Optics"],IMAX:["IMAX_Optics","Hasselblad_V"],Warner_Bros:["Vintage_Spherical"],Paramount:["Vintage_Spherical"],Pathe:["Vintage_Spherical"]},Ug={ARRI_Signature_Prime:[12,15,18,21,25,29,35,40,47,58,75,95,125,150],ARRI_Master_Prime:[12,14,16,18,21,25,27,32,35,40,50,65,75,100,135],ARRI_Ultra_Prime:[8,10,12,14,16,20,24,28,32,40,50,65,85,100,135],ARRI_Prime_65:[24,28,35,50,80,100,150],ARRI_Prime_DNA:[18,21,25,32,35,50,65,80,100,135],Zeiss_Supreme_Prime:[15,18,21,25,29,35,50,65,85,100,135],Zeiss_Master_Prime:[12,14,16,18,21,25,27,32,35,40,50,65,75,100,135],Zeiss_CP3:[15,18,21,25,28,35,50,85,100,135],Cooke_S7:[16,18,21,25,32,40,50,65,75,100,135],Cooke_S4:[12,14,16,18,21,25,27,32,35,40,50,65,75,100,135],Cooke_Panchro:[18,21,25,32,40,50,75,100],Panavision_Primo:[14,17,21,27,35,40,50,75,100],Panavision_Primo_70:[27,35,40,50,65,80,100,125,150,200],Panavision_C_Series:[17,21,27,35,40,50,75,100],Angenieux_Optimo:[15,24,28,35,40,50,70,100,135,200,290],Leica_Summicron_C:[15,18,21,25,29,35,40,50,75,100,135],Leica_Summilux_C:[16,18,21,25,29,35,40,50,65,75,100],Canon_Sumire:[14,20,24,35,50,85,135],Sony_CineAlta:[20,24,35,50,85,100,135],Sigma_Cine:[14,20,24,28,35,40,50,85,105,135],Hasselblad_HC:[24,28,35,50,80,100,120,150,210],Hasselblad_V:[40,50,60,80,100,120,150,180,250],IMAX_Optics:[35,40,50,80,100,110,150]},Fg={Alexa_65:{required_families:["ARRI_Prime_65","ARRI_Prime_DNA","Panavision_Primo_70","Hasselblad_V"],reason:"65mm sensor requires specialized 65mm format lenses"}};function zg(e){if(e.includes("Panavision")||e.startsWith("Super_Panavision")||e.startsWith("Ultra_Panavision"))return"Panavision cameras require Panavision lenses (closed ecosystem)";const t=Fg[e];if(null==t?void 0:t.reason)return t.reason;const n=Lg[e];return"LF"===n?"Large Format camera - S35-only lenses excluded":"65mm"===n?"65mm sensor - requires specialized 65mm format lenses":null}const Bg={ARRI:"German precision. Industry-leading color science, exceptional highlight handling. Alexa is the gold standard.",RED:"American high-resolution pioneer. Compact bodies, 8K capable. Popular for indie to blockbuster.",Sony:"Japanese innovation. Dual ISO, excellent low-light. Venice for cinema, FX for broadcast.",Canon:"Japanese reliability. Cinema EOS line bridges photo/video. Strong autofocus, organic color.",Blackmagic:"Australian value leader. Affordable cinema cameras with DaVinci color science.",Panasonic:"Japanese innovation. VariCam for broadcast, S-series for hybrid. Dual native ISO.",Nikon:"Japanese stills heritage. Z-mount system pushing into cinema with Z9.",DJI:"Chinese aerial pioneers. Integrated camera/gimbal drones. Aerial cinematography standard.",ARRI_Film:"German film cameras (1917-present). Arricam series for modern film, 35 III/BL for classics. Industry workhorse.",Panavision:"Hollywood exclusive. Closed ecosystem (cameras + lenses). Rental-only. Millennium XL2 is modern standard.",Mitchell:"American classic (1920s-1970s). BNC was the Hollywood standard. Quiet for sync-sound. Now vintage/specialty.",IMAX:"Canadian large-format pioneer. 65mm/70mm film for immersive exhibition. 15-perf for ultimate resolution."},Hg={ARRI:"German engineering. Clean, modern, technically precise. Signature Prime and Master Prime series.",Zeiss:"Legendary optics. Clinical sharpness, minimal distortion. Supreme and Master series.",Cooke:'British warmth. The "Cooke Look"flattering skin tones, organic feel. S4 and S7 series.',Panavision:"Hollywood exclusive. Rental-only ecosystem. Primo series, anamorphic heritage.",Angenieux:"French zoom masters. Cinema-quality zooms that rival primes. Optimo series.",Leica:"German micro-contrast. Legendary still lens rendering brought to cinema. Summilux/Summicron.",Canon:"Japanese reliability. Warm, organic Sumire series for digital cinema.",Sony:"Matched to Venice cameras. CineAlta series optimized for Sony color science.",Sigma:"Japanese value. Sharp, modern cine lenses at accessible price points.",Fujifilm:"Japanese broadcast heritage. Fujinon series for cinema and broadcast.",Bausch_Lomb:"American classic. Super Baltar lenses defined Golden Age Hollywood. Warm, glowing highlights.",Todd_AO:"American large-format pioneer. 70mm optics for epic roadshow presentations.",Kowa:"Japanese anamorphic. Cinerama-era optics. Distinctive flares, vintage character."},Vg={Alexa_35:"ARRI flagship S35 camera. 4.6K sensor with exceptional highlight handling and organic color science. Industry standard for narrative filmmaking.",Alexa_Mini:"Compact S35 workhorse. Same sensor as larger ALEXAs but in gimbal-friendly form factor. Versatile for documentary to blockbuster.",Alexa_Mini_LF:"Large format version of Mini. Shallower depth of field and wider field of view. Popular for cinematic drama.",Alexa_LF:"ARRI Large Format camera. Same sensor as Mini LF in traditional body. Exceptional image quality.",Alexa_65:"Ultra-large 65mm format. Requires specialized optics. Used for epic visuals (Dune, Joker). Heavyno handheld.",V_Raptor:"RED's 8K VistaVision camera. Compact, high resolution. Popular for episodic TV and indie features.",V_Raptor_X:"RED V-Raptor [X]. Enhanced sensor with improved low-light performance.",V_Raptor_XL:"Larger V-Raptor with internal ND filters and XLR audio. Studio-friendly configuration.",Komodo_X:"RED compact body. S35 6K sensor in ultra-small package. Run-and-gun and gimbal favorite.",Monstro_8K:"RED 8K sensor. Large format with exceptional resolution. High-end production standard.",Venice_2:"Sony dual ISO marvel. 8.6K full-frame. Exceptional low-light performance. Heavystudio/dolly use.",FX9:"Sony full-frame camcorder. Built-in ND, XLR. Documentary and broadcast standard.",FX6:"Compact full-frame Sony. Run-and-gun form factor with Venice color science.",Arricam_ST:"ARRI Studio model. Quiet for sync-sound. Standard size for studio work. Modern film workhorse.",Arricam_LT:"ARRI Lite model. Lighter for handheld/Steadicam. Same gate as ST, smaller body.",ARRI_535B:"ARRI 535 evolution. 4-perf with crystal sync. Last generation before digital transition.",ARRI_35BL:"ARRI Blimped. Ultra-quiet for sync-sound. 1970s-2000s television standard.",ARRI_35_III:"ARRI lightweight. Popular for documentary, news, handheld narrative. Compact and reliable.",Panavision_Millennium_XL2:"Modern Panavision standard. Ultra-quiet, anamorphic-ready. Most rented film camera 2000-2015.",Panavision_Millennium:"Original Millennium. First truly quiet Panavision. Late 1990s flagship.",Panavision_Platinum:"Panavision 1980s flagship. Used on countless blockbusters. Heavy but reliable.",Panavision_Gold:"Panavision 1970s standard. The Empire Strikes Back, Blade Runner era.",Panavision_Panastar:"High-speed Panavision. Built for slow-motion. Action sequences, sports.",Panavision_Panaflex:"Original Panaflex. First self-blimped Panavision. Revolutionary quiet operation.",Super_Panavision_70:"Spherical 65mm. Lawrence of Arabia, 2001. Epic scale without anamorphic squeeze.",Ultra_Panavision_70:"Anamorphic 65mm. Ben-Hur, The Hateful Eight. Widest theatrical ratio (2.76:1).",Mitchell_BNC:"Mitchell Blimped Newsreel Camera. Hollywood studio standard 1930s-1960s. Whisper-quiet.",Mitchell_BNCR:"Mitchell Reflex. Added through-the-lens viewing. Easier operator workflow.",Mitchell_BFC_65:"Mitchell 65mm. Used for Todd-AO, early widescreen epics. Oklahoma!, Around the World.",IMAX_MSM_9802:"IMAX standard camera. 15-perf 65mm. Used for documentaries, nature films.",IMAX_MKIV:"IMAX Mark IV. Lighter than 9802. Enabled more dynamic IMAX shooting.",IMAX_GT:"IMAX Grand Theatre. Largest format camera. IMAX Dome/OMNIMAX presentations."},Gg={Static:"Tripod-mounted. Rock-solid stability for dialogue, interviews, architectural shots. No operator fatigue.",Handheld:"Shoulder-mounted or body-braced. Organic energy, documentary feel. Limited by camera weightheavy cameras cause fatigue.",Steadicam:"Vest-mounted stabilizer. Smooth floating movement. Classic long takes (Goodfellas hallway). Requires trained operator.",Gimbal:"Electronic 3-axis stabilizer. Modern alternative to Steadicam. Weight-limited, typically under 3kg.",Dolly:"Wheeled platform on track. Precise, repeatable moves. Essential for Dolly Zoom (Vertigo effect).",Crane:"Elevated arm for sweeping vertical moves. Dramatic reveals, establishing shots. Requires setup time.",Jib:"Smaller crane arm. Crane-style moves in tighter spaces. More portable than full crane.",Technocrane:"Telescoping crane with remote head. Complex compound moves. High-end commercial/film standard.",Drone:"Aerial platform. Sweeping establishing shots, impossible angles. Weight-limited, outdoor-preferred."},Wg={Static:"No camera movement. Lets blocking and performance drive energy. Theatre-derived staging.",Pan:"Horizontal rotation on tripod head. Follows action left-right. Reveals space laterally.",Tilt:"Vertical rotation on tripod head. Reveals height, follows vertical action.",Track_In:"Camera moves toward subject. Increases intimacy, reveals detail. Push-in intensifies moment.",Track_Out:"Camera moves away from subject. Reveals context, creates distance. Pull-out diminishes subject.",Arc:"Camera orbits around subject. Adds dimensionality, shows all sides. Dynamic without cutting.",Crane_Up:"Camera rises vertically. Triumphant, revelatory. Often ends establishing shots.",Crane_Down:"Camera descends. Arrival, focus narrowing. Often begins scenes with overview.",Dolly_Zoom:"Vertigo effect: dolly + opposing zoom. Disorientation, realization. Requires Dolly or Slider equipment."},$g={Static:"No movementcamera holds position. Contemplative, observational.",Very_Slow:"Extremely deliberate pace. Meditative, hypnotic. Art cinema, contemplative sequences.",Slow:"Deliberate, meditative pace. Builds atmosphere, prolongs tension. Tarkovsky, slow cinema.",Moderate:"Natural conversational pace. Unobtrusive, standard coverage.",Fast:"Energetic, urgent movement. Action sequences, chase scenes. Can be disorienting if excessive.",Whip_Fast:"Ultra-rapid whip pans/tilts. Comedic timing, sudden reveals. Wes Anderson, Edgar Wright."},Xg={Dawn:"Pre-sunrise. Cool blue ambient transitioning to warm. Quiet, hopeful, new beginnings.",Morning:"Low warm sun angle. Long shadows. Fresh energy. Soft backlight opportunities.",Midday:"Harsh overhead sun. High contrast, strong shadows. Challenging for faces. Use fill or find shade.",Afternoon:"Sun lowering. Warmer tones beginning. Most flexible natural light window.",Golden_Hour:"Magic hour near sunset. Warm, soft, directional. Cinematographer's favorite. Brief window.",Blue_Hour:"Post-sunset twilight. Cool ambient with artificial lights gaining prominence. Magical quality.",Dusk:"Transition to night. Mixed natural/artificial. Nostalgic, end-of-day feeling.",Night:"After dark. Requires artificial sources. High drama potential. No sun available."},qg={Sun:"Natural daylight. Hard source, warm. Unavailable at night. Golden hour = soft; midday = harsh.",Moon:"Night ambience. Typically simulated with HMI + diffusion. Cool blue cast. Low level.",Tungsten:"Classic incandescent. Warm 3200K. Traditional film lighting. Softens with diffusion.",HMI:"Daylight-balanced arcs. High output, can simulate sun through windows. Available since 1972.",LED:"Modern solid-state. Variable color temperature, low power. Available widespread since ~2002.",Kino_Flo:"Fluorescent tubes designed for film. Soft, even. Available since 1987. Portrait favorite.",Neon:"Practical neon tubes. Colored accent light. Cyberpunk, noir aesthetic.",Practical:"In-frame light sourceslamps, signs, screens. Motivated light. Adds realism.",Mixed:"Multiple source types. Complex setups. Color temperature mismatches can be stylistic."},Kg={High_Key:"Bright, even lighting. Minimal shadows. Comedies, sitcoms, commercials. Upbeat mood.",Low_Key:"High contrast, deep shadows. Noir, thriller. Cannot achieve at midday without blackout.",Soft:"Diffused sources, gentle gradients. Flattering for faces. Romantic, dreamy.",Hard:"Direct sources, sharp shadows. Dramatic, edgy. Can be unflattering.",Naturalistic:"Motivated by scene logic. Windows provide light because windows exist. Subtle intervention.",Expressionistic:"Stylized beyond realism. Colored gels, unusual angles. Horror, fantasy, music video.",Chiaroscuro:"Renaissance painting style. Strong directional light, deep black shadows. Caravaggio influence."},Yg={EWS:"Extreme Wide Shot. Vast landscapes, establishing scale. Subject tiny in frame. Best with 14-24mm.",WS:"Wide Shot. Full environment context. Subject head-to-toe with surroundings.",MWS:"Medium Wide Shot. Subject with significant environment. Waist-up with room around.",MS:"Medium Shot. Waist-up framing. Dialogue standard. Balances face and gesture.",MCU:"Medium Close-Up. Chest-up framing. Emotional emphasis while showing some body language.",CU:"Close-Up. Face fills frame. Maximum emotional impact. Typically 50-100mm lens.",BCU:"Big Close-Up. Eyes to chin. Intense, intimate. Reveals micro-expressions.",ECU:"Extreme Close-Up. Single feature (eye, mouth, hand). Abstract, hyper-detailed. Best with 85-135mm.",OTS:"Over-The-Shoulder. Conversation framing with foreground shoulder. Establishes spatial relationship.",POV:"Point-of-View. Through character's eyes. Subjective experience. Often handheld."},Zg={Rule_of_Thirds:"Subject on grid intersections. Dynamic, natural-feeling. Most common technique.",Centered:"Subject dead center. Formal, confrontational. Wes Anderson, Stanley Kubrick.",Symmetrical:"Mirror-balanced frame. Order, stability, unease (context-dependent).",Asymmetrical:"Intentionally unbalanced. Tension, instability. Weight on one side.",Negative_Space:"Large empty areas. Isolation, loneliness, anticipation. Subject small in frame.",Leading_Lines:"Environmental lines draw eye to subject. Roads, hallways, architecture."},Jg={Cheerful:"Light, happy, optimistic. Requires bright lightingincompatible with Low-Key.",Happy:"Joyful, upbeat energy. High-key lighting, warm colors. Feel-good moments.",Hopeful:"Aspirational, forward-looking. Often warm tones, rising camera moves.",Whimsical:"Playful, quirky. Unusual angles, bright colors. Wes Anderson territory.",Adventurous:"Excitement and discovery. Dynamic movement, expansive framing.",Romantic:"Intimate, warm. Soft lighting, close framing. Golden hues.",Sensual:"Physical intimacy emphasized. Close framing, shallow focus, warm tones.",Passionate:"Intense emotional/physical connection. Dynamic, warm, urgent.",Intimate:"Personal, close. Quiet moments, private spaces.",Melancholic:"Sad but beautiful. Muted colors, soft light. Autumnal feel.",Somber:"Grave, serious tone. Muted palette, measured pacing.",Reflective:"Looking inward or back. Often static, natural light.",Contemplative:"Thoughtful, introspective. Slow pacing, quiet moments.",Introspective:"Internal focus. Close-ups, negative space, silence.",Tender:"Gentle emotional vulnerability. Soft light, close framing.",Bittersweet:"Joy tinged with sadness. Warm but muted. Nostalgic undertones.",Nostalgic:"Warm recollection. Often sepia or warm desaturated. Period feel.",Serene:"Peaceful, calm. Static or slow movement. Balanced composition.",Surreal:"Dream-like, illogical. Unusual angles, unexpected lighting.",Dreamlike:"Soft, ethereal. Diffusion, bloom. Often overexposed edges.",Hallucinatory:"Distorted reality. Warped visuals, unstable framing, vivid colors.",Transcendent:"Beyond ordinary experience. Ethereal light, expansive space.",Meditative:"Deeply calm, trance-like. Minimal movement, extended takes.",Philosophical:"Contemplating existence. Often static, faces in thought.",Psychedelic:"Altered consciousness. Saturated colors, distortion, disorientation.",Gloomy:"Persistent darkness. Low-key required. Minimal color.",Menacing:"Active threat present. Low angles, shadows encroaching.",Oppressive:"Suffocating pressure. Tight framing, heavy shadows, claustrophobic.",Paranoid:"Threatened from all sides. Wide angles, looking around.",Tense:"Building pressure. Tight framing, restricted movement.",Anxious:"Uncomfortable uncertainty. Handheld, tight, distorted.",Claustrophobic:"Trapped, no escape. Tight spaces, close walls, shallow depth.",Brutal:"Harsh, unforgiving violence. Hard light, stark framing.",Traumatic:"Psychological damage. Fragmented, unstable, overwhelming.",Unsettling:"Something wrong but unclear. Slightly off framing, odd timing.",Ominous:"Impending doom. Low angles, heavy shadows.",Suspenseful:"Anticipating threat. Slow reveals, sound design crucial.",Mysterious:"Intriguing unknowns. Shadows, partial reveals. Cool or neutral tones.",Haunting:"Lingering unease. Cool tones, slow drift.",Bleak:"Hopeless emptiness. Desaturated, harsh environments.",Tragic:"Profound loss. Often static, allowing weight to settle.",Lonely:"Isolation emphasized. Negative space, single subjects.",Aggressive:"Confrontational energy. Fast movement, tight angles.",Angry:"Visible rage. Tight close-ups, red accents, unstable framing.",Rebellious:"Defiant energy. Dutch angles, punk aesthetic, bold choices.",Kinetic:"Pure motion energy. Fast cuts, dynamic camera, action-driven.",Urgent:"Time-critical pressure. Fast pacing, close framing, breathless.",Provocative:"Deliberately challenging. Bold framing, direct confrontation.",Unhinged:"Lost control. Erratic movement, unpredictable framing.",Chaotic:"Disorder and confusion. Handheld, rapid cutting.",Frantic:"Desperate urgency. Fast, unstable, breathless.",Intense:"High stakes focus. Close, direct, immediate.",Noir:"Classic film noir aesthetic. High contrast, shadows, morally ambiguous.",Hardboiled:"Tough, cynical detective fiction. Urban night, practical lighting.",Fatalistic:"Inevitable doom accepted. Static, resigned framing.",Cynical:"Distrustful, world-weary. Cool tones, detached framing.",World_Weary:"Exhausted by experience. Heavy, slow, desaturated.",Gothic:"Dark romanticism. Architecture, shadows, supernatural undertones.",Macabre:"Death and decay fascination. Shadow, texture, unsettling beauty.",Grotesque:"Distorted, disturbing forms. Wide angles, harsh light.",Eldritch:"Cosmic, unknowable horror. Vast scale, alien geometry.",Dread:"Paralyzing fear of what comes. Static, inevitable approach.",Documentary:"Observational realism. Natural light, handheld, unobtrusive.",Realistic:"Naturalistic presentation. Motivated lighting, believable blocking.",Observational:"Fly-on-wall perspective. Distance, patience, non-intervention.",Journalistic:"News/reportage style. Handheld, available light, urgent.",Verite:"Cinema veritetruth of the moment. Raw, unpolished, authentic.",Epic:"Grand scale. Wide shots, sweeping movements, orchestral feel."},Qg={Warm_Saturated:"Rich, vivid warm colors. Energetic, inviting. Summer, nostalgia.",Warm_Desaturated:"Muted warm tones. Period films, memory sequences. Sepia influence.",Cool_Saturated:"Vivid blues and cyans. Sci-fi, night exteriors. Electric feel.",Cool_Desaturated:"Muted blues. Noir, thriller, depression. Clinical or bleak.",Neutral_Saturated:"Balanced vivid colors. Commercials, bright films.",Neutral_Desaturated:"Muted neutral palette. Documentary, realism. Low intervention.",Monochrome:"Black and white. Classic, graphic, timeless. Bold artistic choice.",Sepia:"Brown-toned monochrome. Historical, aged, nostalgic.",Teal_Orange:"Complementary color grade. Blockbuster look. Skin pops against teal shadows."},ev={ARRI_Signature_Prime:"Modern LF lenses. Clean with subtle character. Gentle fall-off. Current ARRI flagship.",ARRI_Master_Prime:"Ultra-sharp S35 lenses. Clinical precision. High contrast. Technical perfection.",ARRI_Ultra_Prime:"Compact S35 primes. Neutral rendering. Documentary and narrative workhorse.",ARRI_Prime_65:"65mm format lenses for Alexa 65. Cinema-scale optics. XPL mount. Used on Roma, The Revenant.",ARRI_Prime_DNA:"DNA Large Format lenses. Organic character with modern resolution. Beautiful flares. Used on Parasite.",Zeiss_Supreme_Prime:"Modern high-speed LF lenses. Smooth bokeh, gentle flares. Clean aesthetic.",Zeiss_Master_Prime:"S35 reference standard. Maximum sharpness. Minimal distortion.",Zeiss_CP3:"Compact primes. Good value, solid performance. Indie production favorite.",Cooke_S7:"Full-frame Cooke Look. Warm skin tones, gentle rolloff. Organic character.",Cooke_S4:"Classic S35 primes. The definitive Cooke Look. Slight warmth, beautiful faces.",Cooke_Panchro:"Vintage rehoused classics. Period character. Soft, romantic.",Panavision_Primo:"Hollywood standard S35. Exclusive ecosystem. Pristine but characterful.",Panavision_Primo_70:"65mm format coverage. For Alexa 65 and large format. Epic scale optics.",Panavision_C_Series:"Compact anamorphic. Squeezed 2x. Classic anamorphic flares and bokeh.",Angenieux_Optimo:"Premium zoom lenses. Rare prime-like zoom quality. Versatile focal ranges.",Leica_Summicron_C:"Cinema rehoused Leicas. Legendary Leica rendering. Subtle micro-contrast.",Leica_Summilux_C:"Fast Leica cine primes. Faster than Summicron. More bokeh potential.",Canon_Sumire:"Warm, organic primes. Intended for digital cinema. Pleasing skin tones.",Sony_CineAlta:"Matched to Venice cameras. Optimized for Sony color science.",Sigma_Cine:"High-value cine lenses. Sharp, modern. Excellent cost-performance."},tv={"2D":"Traditional flat animation. Hand-drawn or digital. Classic anime, Disney, independent animation.","3D":"Computer-generated 3D. Full dimensional lighting and camera freedom. Pixar, modern features.",Hybrid:"Mix of 2D and 3D elements. 3D backgrounds with 2D characters, or vice versa. Spider-Verse style.",StopMotion:"Physical puppets/models photographed frame-by-frame. Laika, Aardman. Tactile, handcrafted."},nv={Anime:"Japanese animation tradition. 2D/hybrid. Expressive, stylized. Limited to full animation range.",Manga:"Japanese comic style. Static, monochrome only. High contrast ink aesthetic. No motion.",ThreeD:"3D computer animation. Dimensional lighting required. Smooth to exaggerated motion.",Illustration:"Static artwork. Single frame presentation. No motion, locked frame only."},rv={Clean:"Smooth, uniform outlines. Professional anime standard. Digital precision.",Sketchy:"Rough, hand-drawn appearance. Artistic, unpolished charm. Indie aesthetic.",Bold:"Thick, prominent outlines. High contrast, graphic impact. Cartoon/comic style.",Thin:"Delicate, fine lines. Detailed, elegant. Illustration quality.",Variable:"Line weight varies with pressure/form. Dynamic, expressive. Traditional art feel.",None:"No outlines (lineless). Shapes defined by color only. 3D or painterly styles."},iv={Cel:"Traditional anime cel coloring. Flat colors with hard shadows. Classic look.",Gradient:"Smooth color transitions. Softer, more dimensional than cel.",Watercolor:"Painted, textured appearance. Artistic, handcrafted feel.",Flat:"Solid colors, no shading. Graphic design influence. Bold, simple.",Textured:"Surface texture in color fills. Adds tactile quality.",Monochrome:"Single color or grayscale. Stylistic choice for color animation.",Monochrome_Ink:"Black and white ink style. Required for Manga domain."},av={Flat:"No dimensional shading. Graphic, 2D. Cannot use for 3D domain.",Cel_Shaded:"Hard shadow edges. Anime standard. Stylized dimensionality.",Soft_Shaded:"Smooth shadow gradients. More realistic while still stylized.",Naturalistic_Simulated:"Realistic light behavior simulated in 2D. Complex, labor-intensive.",Raytraced:"Physically accurate 3D lighting. Photorealistic. Not for anime style."},ov={Smooth:"Clean, untextured surfaces. Classic anime look. Fast to render.",Textured:"Subtle surface variation. Adds visual interest without overwhelming.",Detailed:"Rich surface complexity. Fabric weave, skin pores, material specifics.",Photoreal:"Photorealistic surface rendering. Full material simulation. 3D only.",Stylized:"Artistic interpretation of surfaces. Hand-painted textures, illustrative."},sv={None:"Static image. No animation. Required for Manga and Illustration domains.",Limited:"Traditional anime efficiency. 8-12 fps on twos/threes. Strategic movement.",Full:"Full animation. 24 fps on ones. Disney-quality. High budget.",Exaggerated:"Beyond reality. Squash and stretch. Cartoon physics.",Snappy:"Quick, punchy timing. Modern digital animation trend.",Fluid:"Smooth, continuous motion. Graceful, flowing. High frame count."},lv={Locked:"Static frame. No camera movement. Required for Manga/Illustration.",Digital_Pan:"Horizontal digital movement across artwork. Classic anime technique.",Digital_Zoom:"Scale change on artwork. Ken Burns effect. Creates depth illusion.",Parallax:"Layered movement at different speeds. Creates depth in 2D.",Free_3D:"Full 3D camera movement. Requires 3D medium.",Simulated_Handheld:"Artificial shake/drift. Adds documentary feel. Not for anime.",Motion_Comic:"Panel-to-panel reveals. Comic book presentation style."},cv="Camera brand. ARRI, RED, and Sony dominate professional cinema. Each has unique color science and sensor technology.",uv="The specific camera model. Determines sensor size (S35, Full Frame, 65mm), resolution, weight class, and compatible lens mounts.",dv="Lens brand. Each manufacturer has a signature rendering styleCooke is warm, Zeiss is clinical, ARRI is balanced.",hv="The lens series. Different families have different optical character, coverage (S35 vs Full Frame), and focal length options.",pv="Lens focal length in millimeters. Wide (14-24mm) for environments, Normal (35-50mm) for natural look, Long (85-135mm) for close-ups.",mv="Anamorphic lenses squeeze a wider field of view onto the sensor, creating the classic widescreen look with oval bokeh and horizontal flares.",fv="Physical support system. Determines what camera movements are possible. Heavy cameras restrict to Tripod/Dolly/Crane.",gv="The specific camera move. Each creates different emotional effectspush-in intensifies, pull-out reveals context.",vv="Speed of camera movement. Slow builds atmosphere, Fast adds energy. Dolly Zoom requires slower timing for effect.",yv="Scene time setting. Determines available natural light and shadows. Night eliminates Sun as a source option.",_v="Primary light source in the scene. Filtered by time of day and erano LED before 2002, no Sun at night.",xv="Overall lighting approach. High-Key is bright/even (comedy), Low-Key is dark/contrasty (noir). Some moods restrict options.",bv="How much of the subject fills the frame. Wide shots establish environment, close-ups show emotion and detail.",wv="Frame arrangement principles. Rule of Thirds is most common, Centered is formal/confrontational (Kubrick, Anderson).",Sv="Emotional tone of the shot. Some presets restrict moodsBlade Runner blocks Cheerful, etc. Affects lighting compatibility.",Mv="Color grading direction. Warm/Cool temperature and Saturated/Desaturated intensity. Sets the emotional palette.",Ev="2D (traditional/digital flat) or 3D (computer generated). Affects available rendering and camera options.",Cv="Animation tradition. Anime (Japanese 2D), Manga (static comics), 3D (Pixar-style), or Illustration (single frame art).",Tv="How outlines are rendered. Anime typically uses clean dark lines, 3D may have no lines (lineless) or stylized edges.",kv="How color fills shapes. Cel = flat with hard shadows, Gradient = smooth transitions. Manga must be Monochrome_Ink.",Pv="How light/shadow is represented. Flat = no shading, Cel_Shaded = hard shadows, Raytraced = photorealistic (3D only).",Av="Texture complexity. Minimal for clean anime look, Detailed for complex surfaces. Affects rendering style.",Nv="Animation approach. Limited = efficient 12fps (anime), Full = 24fps fluid (Disney). Manga/Illustration must be None.",Rv="Camera movement in animation. 2D uses pans/zooms over artwork, 3D has free movement. Static domains require Locked.";function Lv(e,t="Digital"){const n=xg[e]||[];return("Film"===t?pg.camera_body_film:pg.camera_body).map(t=>{var r,i;const a=null==(r=Vg)?void 0:r[t];if(n.length>0&&!n.includes(t)){const n=(null==(i=Object.entries(xg).find(([e,n])=>n.includes(t)))?void 0:i[0])||"another manufacturer";return{value:t,disabled:!0,reason:`${vg[t]||t.replace(/_/g," ")} is made by ${n}, not ${e}.`,description:a}}return{value:t,disabled:!1,description:a}})}function Iv(e,t){const n=_g[e]||"Medium",r=Sg[t];return pg.movement_equipment.map(i=>{var a;const o=null==(a=Gg)?void 0:a[i];return"Heavy"===n&&bg.includes(i)?{value:i,disabled:!0,reason:` ${vg[e]||e} (~${"Heavy"===n?">4kg":"3-4kg"}) exceeds ${i} weight limit. ${i} typically supports <${"Drone"===i?"3kg":"4kg"} payloads.`,description:o}:r&&!r.includes(i)?{value:i,disabled:!0,reason:` ${t} requires ${r.join(" or ")}physically impossible with ${i}.`,description:o}:{value:i,disabled:!1,description:o}})}function jv(e){const t=wg[e]||pg.movement_type;return pg.movement_type.map(n=>{var r;const i=null==(r=Wg)?void 0:r[n];if(!t.includes(n)){let t=` ${e} cannot perform ${n}`;return t+="Static"===e?"static mount has no movement capability.":"Handheld"===e?"handheld is limited to pan/tilt rotations.":"Crane"===e||"Jib"===e?"arm-based equipment cannot track horizontally.":"Dolly"===e?"dolly can only track (forward/back), not lift.":"Drone"===e?"drone movement is primarily aerial translation.":`physically limited by ${e} mechanics.`,{value:n,disabled:!0,reason:t,description:i}}return{value:n,disabled:!1,description:i}})}function Dv(e,t,n,r){const i=Eg[e],a=n?function(e){if(!e)return[];const t=[];for(const[n,r]of Object.entries(Cg))e<r&&t.push(n);return t}(n):[];return pg.lighting_source.map(o=>{var s;const l=null==(s=qg)?void 0:s[o];if(i&&!i.includes(o))return"Sun"!==o||"Night"!==e&&"Blue_Hour"!==e?"Moon"===o&&"Midday"===e?{value:o,disabled:!0,reason:" Moonlight is too faint to compete with midday sunwould be invisible.",description:l}:{value:o,disabled:!0,reason:` ${o} unavailable at ${e.replace(/_/g," ")}.`,description:l}:{value:o,disabled:!0,reason:` Sun is below horizon at ${e.replace(/_/g," ")}physically impossible as primary source.`,description:l};if(t.includes(o))return{value:o,disabled:!0,reason:` ${o} conflicts with ${r||"preset"} aestheticwould break period/style consistency.`,description:l};if(a.includes(o)){return{value:o,disabled:!0,reason:` ${o} technology didn't exist in ${n}invented ${Cg[o]}. Would be historically anachronistic.`,description:l}}return{value:o,disabled:!1,description:l}})}function Ov(e,t){const n=Tg[e],r=t?kg[t]:null;return pg.lighting_style.map(i=>{var a;const o=null==(a=Kg)?void 0:a[i];return n&&!n.includes(i)?"Low_Key"===i&&"Midday"===e?{value:i,disabled:!0,reason:" Low-Key requires controlled darknessmidday sun floods scene with ambient light. Need blackout or interior.",description:o}:{value:i,disabled:!0,reason:` ${i} not achievable at ${e.replace(/_/g," ")}.`,description:o}:t&&(null==r?void 0:r.disallowed.includes(i))?{value:i,disabled:!0,reason:` ${i.replace(/_/g," ")} creates tonal dissonance with "${t}" moodshadows and contrast undermine ${t.toLowerCase()} emotional intent.`,description:o}:{value:i,disabled:!1,description:o}})}function Uv(e){const t=Mg[e];return pg.movement_timing.map(n=>{var r;const i=null==(r=$g)?void 0:r[n];return t&&!t.includes(n)?"Dolly_Zoom"===e?{value:n,disabled:!0,reason:` Dolly Zoom (Vertigo effect) at ${n.replace(/_/g," ")} speed is disorientingthe simultaneous zoom/dolly becomes unreadable. Use Slow or Moderate for the effect to register psychologically.`,description:i}:{value:n,disabled:!0,reason:` ${n.replace(/_/g," ")} is too fast for ${e.replace(/_/g," ")}.`,description:i}:{value:n,disabled:!1,description:i}})}function Fv(e,t){return pg.mood.map(n=>{var r;const i=null==(r=Jg)?void 0:r[n];return e.length>0?e.includes(n)?{value:n,disabled:!1,reason:` Recommended for ${t||"this style"}aligns with the preset's visual identity.`,description:i}:{value:n,disabled:!1,reason:` Not typical for ${t||"this style"}. Recommended moods: ${e.join(", ")}.`,description:i}:{value:n,disabled:!1,description:i}})}function zv(e,t){const n=Lg[e],r=Ig[e],i=Fg[e],a=t?Og[t]:null;return pg.lens_family.map(o=>{var s,l;const c=null==(s=ev)?void 0:s[o];if(a&&!a.includes(o)){const e=null==(l=Object.entries(Og).find(([e,t])=>t.includes(o)))?void 0:l[0];return{value:o,disabled:!0,reason:` ${yg[o]||o.replace(/_/g," ")} is made by ${e}, not ${t}. Change manufacturer filter to use these lenses.`,description:c}}if((null==i?void 0:i.required_families)&&!i.required_families.includes(o))return{value:o,disabled:!0,reason:` ${vg[e]||e}'s ${n} sensor (65mm) requires specialized large-format optics. Only ${i.required_families.map(e=>yg[e]||e).join(", ")} covers this format.`,description:c};const u=jg[o];if(u){if("65mm"===n&&!u.includes("65mm"))return{value:o,disabled:!0,reason:` ${yg[o]||o.replace(/_/g," ")} cannot cover 65mm sensorwould vignette severely. Designed for ${u.join("/")}.`,description:c};if("LF"===n&&!u.includes("LF")&&!u.includes("FF"))return{value:o,disabled:!0,reason:` ${yg[o]||o.replace(/_/g," ")} is S35-onlywould show dark corners (vignette) on Large Format sensor.`,description:c}}const d=Dg[o];if(d&&r){if(!(d.includes(r)||"LPL"===r&&d.includes("PL")||"RF"===r&&d.includes("PL")||"E"===r&&(d.includes("PL")||d.includes("E"))))return{value:o,disabled:!0,reason:` ${yg[o]||o.replace(/_/g," ")} uses ${d.join("/")} mountincompatible with ${vg[e]||e}'s ${r} mount without adapter.`,description:c}}return{value:o,disabled:!1,description:c}})}function Bv(e){const t=Ug[e];return pg.focal_length_mm.map(n=>{let r="";if(r=n<=18?`Ultra-wide ${n}mm. Dramatic perspective, environment emphasis. Distorts faces up close.`:n<=28?`Wide ${n}mm. Environmental context with subject. Some perspective distortion.`:n<=40?`Normal ${n}mm. Close to human vision. Versatile, neutral perspective.`:n<=65?`Standard ${n}mm. Classic portrait range begins. Flattering for faces.`:n<=100?`Portrait ${n}mm. Compressed perspective, beautiful bokeh. Intimate close-ups.`:`Telephoto ${n}mm. Strong compression, shallow depth. Surveillance, sports, intimate detail.`,t&&!t.includes(n)){const i=t.reduce((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e);return{value:String(n),disabled:!0,reason:` ${yg[e]||e.replace(/_/g," ")} isn't manufactured in ${n}mm. Nearest available: ${i}mm. Lens sets have specific focal lengths.`,description:r}}return{value:String(n),disabled:!1,description:r}})}function Hv(e){return e.startsWith("IMAX_")?["1.43:1","1.90:1","2.20:1"]:"Ultra_Panavision_70"===e?["2.76:1","2.39:1","2.20:1"]:"Super_Panavision_70"===e?["2.20:1","2.35:1","2.39:1"]:pg.aspect_ratio}function Vv(e){const t=Pg[e];return pg.color_application.map(n=>{var r,i;const a=null==(r=iv)?void 0:r[n];return(null==(i=null==t?void 0:t.disallowed_colors)?void 0:i.includes(n))?"Manga"===e?{value:n,disabled:!0,reason:" Manga is defined by monochrome ink aestheticcolor would fundamentally change the medium.",description:a}:{value:n,disabled:!0,reason:` ${n} not available for ${e}.`,description:a}:{value:n,disabled:!1,description:a}})}function Gv(e,t,n){const r=Pg[e],i=Ag[t],a=n?Ng[n]:null;return pg.virtual_camera.map(n=>{var o,s;const l=null==(o=lv)?void 0:o[n];return(null==(s=null==r?void 0:r.disallowed_cameras)?void 0:s.includes(n))?"Anime"===e&&"Simulated_Handheld"===n?{value:n,disabled:!0,reason:" Anime tradition relies on deliberate, controlled framingsimulated handheld conflicts with the aesthetic.",description:l}:"Manga"===e?{value:n,disabled:!0,reason:" Manga is printed static artworkcamera movement doesn't exist in the medium.",description:l}:"Illustration"===e?{value:n,disabled:!0,reason:" Illustration is a single static imageno temporal dimension for camera movement.",description:l}:{value:n,disabled:!0,reason:` ${n} not compatible with ${e}.`,description:l}:(null==i?void 0:i.includes(n))?{value:n,disabled:!0,reason:` ${n} requires true 3D geometry${t} medium lacks the dimensional data for free camera movement.`,description:l}:(null==a?void 0:a.includes(n))?{value:n,disabled:!0,reason:' Motion Style is "None"camera movement requires animated frames to be perceptible.',description:l}:{value:n,disabled:!1,description:l}})}function Wv(e){const t=Pg[e];return pg.motion_style.map(n=>{var r,i;const a=null==(r=sv)?void 0:r[n];return(null==(i=null==t?void 0:t.disallowed_motion)?void 0:i.includes(n))?"Manga"===e?{value:n,disabled:!0,reason:" Manga is printed static artworkmotion exists only in reader's imagination through visual storytelling.",description:a}:"Illustration"===e?{value:n,disabled:!0,reason:" Illustration is a single frameno animation component exists.",description:a}:{value:n,disabled:!0,reason:` ${e} is staticno motion animation.`,description:a}:{value:n,disabled:!1,description:a}})}function $v(e){const t=Pg[e];return pg.lighting_model.map(n=>{var r,i;const a=null==(r=av)?void 0:r[n];return(null==t?void 0:t.required_lighting)&&!t.required_lighting.includes(n)?{value:n,disabled:!0,reason:` ${e} requires ${t.required_lighting.join("/")} lightingdimensional shading conflicts with the graphic ink aesthetic.`,description:a}:(null==(i=null==t?void 0:t.disallowed_lighting)?void 0:i.includes(n))?"Anime"===e&&"Raytraced"===n?{value:n,disabled:!0,reason:" Raytracing produces photorealistic lightingconflicts with anime's stylized cel-shaded aesthetic.",description:a}:"ThreeD"===e&&"Flat"===n?{value:n,disabled:!0,reason:" 3D animation requires dimensional lightingflat lighting defeats the purpose of 3D geometry.",description:a}:{value:n,disabled:!0,reason:` ${n} not compatible with ${e}.`,description:a}:{value:n,disabled:!1,description:a}})}function Xv(e){const t={amelie:"amlie",an_andalusian_dog:"andalusian-dog",un_chien_andalou:"andalusian-dog",battle_of_algiers:"the-battle-of-algiers",one_flew_over_cuckoos_nest:"one-flew-over-the-cuckoos-nest",star_wars_anh:"star-wars-a-new-hope",la_la_land:null,the_social_network:null,joker:null,drive:null,solaris:"solaris",spirited_away:null,princess_mononoke:null,your_name:null,perfect_blue:null,paprika:null,toy_story:null,wall_e:null,spider_verse:"spider-verse",ratatouille:null,finding_nemo:null,arcane:"arcane",love_death_robots:null,into_the_spider_verse:"spider-verse",studio_ghibli_generic:null};if(e in t){const n=t[e];return null===n?null:`/movie-frames/${n}.jpg`}return`/movie-frames/${e.replace(/_/g,"-").toLowerCase()}.jpg`}function qv(e){return e.disabled&&e.reason?e.description?`${e.reason}\n\n ${e.description}`:e.reason:e.description||""}const Kv=["camera.camera_type","camera.manufacturer","camera.body","camera.film_stock","camera.aspect_ratio","lens.manufacturer","lens.family","movement.equipment","movement.movement_type","movement.timing","lighting.time_of_day","lighting.source","lighting.style","visual_grammar.shot_size","visual_grammar.composition","visual_grammar.mood","visual_grammar.color_tone"],Yv=["medium","style_domain","rendering.line_treatment","rendering.color_application","rendering.lighting_model","rendering.surface_detail","motion.motion_style","motion.virtual_camera","visual_grammar.shot_size","visual_grammar.composition","visual_grammar.mood","visual_grammar.color_tone"];function Zv(){const{projectType:e,setProjectType:t,liveActionConfig:n,animationConfig:r,setLiveActionConfig:i,setAnimationConfig:a,updateLiveAction:o,updateAnimation:s,validationResult:l,setValidationResult:c,generatedPrompt:u,negativePrompt:d,setGeneratedPrompt:h,targetModel:p,setTargetModel:m,selectedLiveActionPreset:f,selectedAnimationPreset:g,liveActionPresetList:v,animationPresetList:y,setLiveActionPresetList:_,setAnimationPresetList:x,applyLiveActionPresetConfig:b,applyAnimationPresetConfig:w,clearPreset:S,setCpePromptForStoryboard:M}=zf(),{t:E}=yf(),[C,T]=kt.useState(!1),[k,P]=kt.useState(!1),[A,N]=kt.useState(!1),[R,L]=kt.useState(!1),[I,j]=kt.useState(""),[D,O]=kt.useState(null),[U,F]=kt.useState(!1),[z,B]=kt.useState(!1),[H,V]=kt.useState({type:"live_action",config:n});kt.useEffect(()=>{const t=setTimeout(()=>{V({type:e,config:"live_action"===e?n:r})},300);return()=>clearTimeout(t)},[e,n,r]);const G=Qp({queries:("live_action"===e?Kv:Yv).map(e=>({queryKey:["options",H.type,e,H.config],queryFn:()=>Hf.getOptions(H.type,e,H.config),staleTime:6e4,retry:!1}))}),W=kt.useMemo(()=>{const e={};return G.forEach(t=>{t.data&&(e[t.data.field_path]=t.data)}),e},[G]),$=kt.useCallback((e,t)=>{const n=W[e];if(!n)return t;const r=new Map(t.map(e=>[e.value,e])),i=new Set([...t.map(e=>e.value),...n.options,...n.disabled_options]),a=Array.from(i).sort((e,n)=>{const r=t.findIndex(t=>t.value===e),i=t.findIndex(e=>e.value===n);return-1!==r&&-1!==i?r-i:-1!==r?-1:-1!==i?1:0});return a.map(e=>{const t=r.get(e),i=n.disabled_options.includes(e),a=n.options.includes(e);let o=(null==t?void 0:t.disabled)??!1,s=null==t?void 0:t.reason;return i?(o=!0,s=n.disabled_reasons[e]||s):a&&(o=!1,s=void 0),{value:e,disabled:o,reason:s,description:null==t?void 0:t.description}})},[W]),[X,q]=kt.useState(""),K=kt.useRef(!1),[Y,Z]=kt.useState(()=>{const e=og();return(null==e?void 0:e.provider)||""}),[J,Q]=kt.useState(()=>{const e=og();return(null==e?void 0:e.model)||""}),[ee,te]=kt.useState([]),[ne,re]=kt.useState(!1),[ie,ae]=kt.useState(null),[oe,se]=kt.useState(""),[le,ce]=kt.useState([]),[ue,de]=kt.useState([]),[he,pe]=kt.useState(!1),me=kt.useMemo(()=>{const e=ue.find(e=>e.id===p);return e?"Image"===e.category:fg.has(p)},[ue,p]),fe=kt.useMemo(()=>{if("live_action"===e){const e=n.movement;return!!e&&"Static"!==e.movement_type}return!1},[e,n,r]),[ge,ve]=kt.useState(()=>{const e=localStorage.getItem("cpe-ui-state");if(e)try{return JSON.parse(e).isPresetPanelOpen??!0}catch{}const t=localStorage.getItem("presetPanelOpen");return null===t||"true"===t}),[ye,_e]=kt.useState(()=>{const e=localStorage.getItem("cpe-ui-state");if(e)try{return JSON.parse(e).presetPanelWidth??360}catch{}const t=localStorage.getItem("presetPanelWidth");return t?parseInt(t,10):360}),[xe,be]=kt.useState(()=>{const e=localStorage.getItem("cpe-ui-state");if(e)try{return JSON.parse(e).presetPanelTab??"browser"}catch{}return"browser"}),[we,Se]=kt.useState(!1),Me=kt.useRef(null),Ee=kt.useRef(!0),Ce=kt.useRef(null);kt.useEffect(()=>{if(!Ee.current)return Ce.current&&clearTimeout(Ce.current),Ce.current=setTimeout(async()=>{L(!0);try{const t="live_action"===e?await Hf.validateLiveAction(n):await Hf.validateAnimation(r);c(t)}catch(t){console.error("Validation error:",t)}finally{L(!1)}},300),()=>{Ce.current&&clearTimeout(Ce.current)};Ee.current=!1},[e,n,r,c]),kt.useEffect(()=>{const e=e=>{var n;if(!e.data||"INIT_CONFIG"!==e.data.type)return;const r=e.data.payload;if(!(null==r?void 0:r.config))return;Te.current=!0,"live_action"===r.projectType?(t("live_action"),i(r.config)):"animation"===r.projectType&&(t("animation"),a(r.config));const o=r.userPrompt??(null==(n=r.config)?void 0:n.user_prompt)??"";void 0!==o&&(K.current=!0,q(o)),void 0!==r.prompt&&h(r.prompt||"",null),void 0!==r.enhancedPrompt&&se(r.enhancedPrompt||"")};return window.addEventListener("message",e),window.parent&&window.parent!==window&&window.parent.postMessage({type:"READY"},"*"),()=>window.removeEventListener("message",e)},[t,i,a,h]);const Te=kt.useRef(!1);kt.useEffect(()=>{const e=hg();te(e);const t=og();t?(Z(t.provider),Q(t.model)):e.length>0&&!Y&&(Z(e[0].providerId),e[0].models.length>0&&Q(e[0].models[0]))},[z]),kt.useEffect(()=>{const e=sg();e&&m(e),pe(!0),Hf.getTargetModels().then(t=>{de(t);const n=e||p;t.length>0&&!t.find(e=>e.id===n)&&m(t[0].id)}).catch(e=>{console.error("Failed to fetch target models:",e)}).finally(()=>{pe(!1)})},[]),kt.useEffect(()=>{const e={isPresetPanelOpen:ge,presetPanelWidth:ye,presetPanelTab:xe};localStorage.setItem("cpe-ui-state",JSON.stringify(e)),localStorage.setItem("presetPanelOpen",String(ge)),localStorage.setItem("presetPanelWidth",String(ye))},[ge,ye,xe]),kt.useEffect(()=>{cg(p)},[p]);const ke=kt.useCallback(e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;if("pointerId"in e&&t.setPointerCapture)try{t.setPointerCapture(e.pointerId)}catch{}Se(!0),document.body.classList.add("preset-panel-resizing")},[]),Pe=kt.useCallback(e=>{if(!ge)return;const t=Me.current;if(!t)return;const n=t.getBoundingClientRect();e.clientX-n.left<=12&&ke(e)},[ge,ke]);kt.useEffect(()=>{if(!we)return;const e=e=>{e.preventDefault();const t=window.innerWidth-e.clientX,n=Math.max(280,window.innerWidth-40),r=Math.max(280,Math.min(n,t));_e(r)},t=()=>{Se(!1),document.body.classList.remove("preset-panel-resizing")};return document.addEventListener("pointermove",e),document.addEventListener("pointerup",t),document.addEventListener("pointercancel",t),document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("pointermove",e),document.removeEventListener("pointerup",t),document.removeEventListener("pointercancel",t),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.body.classList.remove("preset-panel-resizing")}},[we]),kt.useEffect(()=>{(async()=>{P(!0);try{if("live_action"===e){const e=await Hf.getLiveActionPresets();_(e.presets)}else{const e=await Hf.getAnimationPresets();x(e.presets)}}catch(t){console.error("Failed to load presets:",t)}finally{P(!1)}})()},[e,_,x]);const Ae=kt.useCallback(async t=>{N(!0),O(null);try{if("live_action"===e){const e=await Hf.applyLiveActionPreset(t);b(e.config,e.preset),c(e.validation),F(!0),Hf.getCinematographyStyle(t).then(e=>O(e)).catch(()=>O(null)).finally(()=>F(!1))}else{const e=await Hf.applyAnimationPreset(t);w(e.config,e.preset),c(e.validation)}}catch(n){console.error("Failed to apply preset:",n)}finally{N(!1)}},[e,b,w,c]),Ne=kt.useCallback(async()=>{T(!0),ce([]);try{const t="live_action"===e?await Hf.generateLiveActionPrompt(n,p):await Hf.generateAnimationPrompt(r,p);h(t.prompt,t.negative_prompt),c(t.validation)}catch(t){console.error("Failed to generate prompt:",t)}finally{T(!1)}},[e,n,r,p,h,c]),Re=kt.useCallback(()=>{navigator.clipboard.writeText(u)},[u]),Le=kt.useCallback(async()=>{if(ce([]),!X.trim())return void ae("Please enter a prompt idea to enhance");if(!Y||!J)return void ae("Please select an LLM provider and model. Configure providers in Settings.");const t=ee.find(e=>e.providerId===Y);if(t){re(!0),ae(null);try{const i=await Hf.enhancePrompt({userPrompt:X.trim(),llmProvider:Y,llmModel:J,targetModel:p,projectType:e,config:"live_action"===e?n:r,credentials:{apiKey:t.credentials.apiKey,endpoint:t.credentials.endpoint,oauthToken:t.credentials.oauthToken}});i.success?(se(i.enhanced_prompt),ce(i.warnings??[])):ae(i.error||"Enhancement failed")}catch(i){console.error("Failed to enhance prompt:",i),ae(i instanceof Error?i.message:"Enhancement failed"),ce([])}finally{re(!1)}}else ae("Selected provider not found. Please configure in Settings.")},[X,Y,J,ee,p,e,n,r]),Ie=e=>{switch(e){case"hard":return"hard";case"warning":return"warning";case"info":return"info";default:return""}};return Ot.jsxs("div",{className:"app app-with-panel "+(ge?"":"panel-collapsed"),style:{"--preset-panel-width":`${ye}px`},children:[Ot.jsxs("header",{className:"header cpe-toolbar",children:[Ot.jsx("textarea",{className:"toolbar-prompt",value:X,onChange:e=>q(e.target.value),placeholder:"Describe your scene...",rows:1}),Ot.jsx("select",{className:"toolbar-model",value:p,onChange:e=>m(e.target.value),disabled:he,children:ue.length>0?Ot.jsx(Ot.Fragment,{children:["General","Image","Video"].map(e=>{const t=ue.filter(t=>t.category===e);return 0===t.length?null:Ot.jsx("optgroup",{label:` ${e} Models `,children:t.map(e=>Ot.jsx("option",{value:e.id,children:e.name},e.id))},e)})}):Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("optgroup",{label:" General Models ",children:pg.target_model.filter(e=>"generic"===e).map(e=>Ot.jsx("option",{value:e,children:mg[e]||e},e))}),Ot.jsx("optgroup",{label:" Image Models ",children:pg.target_model.filter(e=>["midjourney","flux.1","flux.1_pro","flux_kontext","flux_krea","dall-e_3","gpt-image","ideogram_2.0","leonardo_ai","sdxl","stable_diffusion_3","z-image_turbo","qwen_image"].includes(e)).map(e=>Ot.jsx("option",{value:e,children:mg[e]||e},e))}),Ot.jsx("optgroup",{label:" Video Models ",children:pg.target_model.filter(e=>["sora","sora_2","veo_2","veo_3","runway_gen-3","runway_gen-4","kling_1.6","pika_2.0","luma_dream_machine","ltx_2","cogvideox","hunyuan","wan_2.1","wan_2.2","minimax_video","qwen_vl"].includes(e)).map(e=>Ot.jsx("option",{value:e,children:mg[e]||e},e))})]})}),Ot.jsx("button",{className:"toolbar-btn primary",onClick:Ne,disabled:C,children:C?"Generating...":"Generate"}),Ot.jsx("button",{className:"toolbar-btn",onClick:Le,disabled:ne||!X.trim(),children:ne?"Enhancing...":"Enhance with AI"}),Ot.jsx("button",{className:"toolbar-settings",onClick:()=>B(!0),children:Ot.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ot.jsx("circle",{cx:"12",cy:"12",r:"3"}),Ot.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]}),Ot.jsx(ug,{isOpen:z,onClose:()=>B(!1)}),me&&fe&&Ot.jsx("div",{style:{margin:"0.75rem 1.25rem",padding:"0.6rem 0.8rem",borderRadius:"6px",backgroundColor:"rgba(245, 158, 11, 0.12)",color:"var(--text-primary)",border:"1px solid rgba(245, 158, 11, 0.4)",fontSize:"0.85rem"},children:"Motion settings are ignored for image models. Switch to a video model or set movement to Static."}),Ot.jsxs("div",{className:"output-panel",children:[Ot.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[Ot.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["Prompt Generation",Ot.jsx("span",{title:"This panel generates AI prompts from your cinematography settings. Use 'Generate' for a simple prompt based on settings, or 'Enhance with AI' to have an LLM create a more detailed, professional prompt.",style:{cursor:"help",fontSize:"0.75rem",color:"var(--text-muted)",backgroundColor:"var(--bg-light)",borderRadius:"50%",width:"18px",height:"18px",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"?"})]}),Ot.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[R&&Ot.jsx("span",{className:"status-badge validating",children:"validating..."}),l&&!R&&Ot.jsx("span",{className:`status-badge ${l.status}`,children:l.status})]})]}),l&&l.messages.length>0&&Ot.jsx("div",{className:"validation-messages",style:{marginBottom:"0.75rem"},children:l.messages.map((e,t)=>Ot.jsxs("div",{className:`validation-message ${Ie(e.severity)}`,children:[Ot.jsxs("strong",{children:[e.rule_id,":"]})," ",e.message]},t))}),Ot.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[Ot.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[Ot.jsxs("label",{style:{display:"block",fontSize:"0.75rem",color:"var(--text-muted)"},title:"Basic prompt generated from your cinematography settings.",children:["Simple Prompt ",Ot.jsx("span",{style:{cursor:"help"},children:"(?)"})]}),Ot.jsx("textarea",{readOnly:!0,value:u||'Click "Generate" to create a prompt from your settings...',style:{width:"100%",minHeight:"150px",padding:"0.75rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-medium)",color:u?"var(--text-primary)":"var(--text-muted)",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",flex:1}}),Ot.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[Ot.jsx("button",{className:"secondary",onClick:Re,disabled:!u,title:"Copy simple prompt to clipboard",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--border-medium)",backgroundColor:"var(--bg-elevated)",color:"var(--text-secondary)",cursor:u?"pointer":"not-allowed",transition:"all 0.15s ease"},children:"Copy Simple Prompt"}),Ot.jsx("button",{className:"secondary",onClick:()=>M(u),disabled:!u,title:"Send this prompt to the Storyboard panel",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--accent-primary)",backgroundColor:"var(--accent-primary)",color:"white",cursor:u?"pointer":"not-allowed",transition:"all 0.15s ease",opacity:u?1:.5},children:" Send to Storyboard"})]})]}),Ot.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[Ot.jsxs("label",{style:{display:"block",fontSize:"0.75rem",color:"var(--text-muted)"},title:"Your prompt enhanced by AI with professional cinematography language.",children:["AI-Enhanced Prompt ",Ot.jsx("span",{style:{cursor:"help"},children:"(?)"})]}),Ot.jsx("textarea",{readOnly:!0,value:oe||'Click "Enhance with AI" to generate an enhanced prompt...',style:{width:"100%",minHeight:"150px",padding:"0.75rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-medium)",color:oe?"var(--text-primary)":"var(--text-muted)",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",flex:1}}),Ot.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[Ot.jsx("button",{className:"secondary",onClick:()=>navigator.clipboard.writeText(oe),disabled:!oe,title:"Copy enhanced prompt to clipboard",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--border-medium)",backgroundColor:"var(--bg-elevated)",color:"var(--text-secondary)",cursor:oe?"pointer":"not-allowed",transition:"all 0.15s ease"},children:"Copy Enhanced Prompt"}),Ot.jsx("button",{className:"secondary",onClick:()=>M(oe),disabled:!oe,title:"Send this prompt to the Storyboard panel",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--accent-primary)",backgroundColor:"var(--accent-primary)",color:"white",cursor:oe?"pointer":"not-allowed",transition:"all 0.15s ease",opacity:oe?1:.5},children:" Send to Storyboard"})]})]})]}),Ot.jsxs("div",{style:{marginBottom:"1rem"},children:[Ot.jsx("label",{style:{display:"block",fontSize:"0.75rem",color:"var(--text-muted)",marginBottom:"0.25rem"},children:"Negative Prompt"}),Ot.jsx("textarea",{readOnly:!0,value:d||"Generated negative prompt will appear here...",style:{width:"100%",minHeight:"50px",padding:"0.75rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-medium)",color:d?"var(--text-primary)":"var(--text-muted)",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box"}})]}),le.length>0&&Ot.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.75rem",padding:"0.5rem",backgroundColor:"rgba(245, 158, 11, 0.12)",borderRadius:"4px",border:"1px solid rgba(245, 158, 11, 0.35)"},children:[Ot.jsx("strong",{children:"Note:"}),Ot.jsx("ul",{style:{margin:"0.35rem 0 0 1rem"},children:le.map((e,t)=>Ot.jsx("li",{children:e},t))})]}),ie&&Ot.jsx("p",{style:{fontSize:"0.8rem",color:"var(--error)",marginBottom:"0.75rem",padding:"0.5rem",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"4px"},children:ie}),0===ee.length&&Ot.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"0.75rem",textAlign:"center",padding:"0.5rem",backgroundColor:"var(--bg-medium)",borderRadius:"4px"},children:"Click the gear icon to configure an AI provider for prompt enhancement"})]}),Ot.jsxs("div",{className:"mode-toggle",children:[Ot.jsx("button",{className:"live_action"===e?"active":"",onClick:()=>t("live_action"),children:"Live-Action Cinema"}),Ot.jsx("button",{className:"animation"===e?"active":"",onClick:()=>t("animation"),children:"Animation"})]}),Ot.jsxs("div",{className:`preset-panel ${ge?"open":"collapsed"} ${we?"resizing":""}`,style:{width:ge?ye:40},ref:Me,onMouseDown:Pe,children:[Ot.jsx("div",{className:"panel-resize-handle",onMouseDown:ke,onPointerDown:ke}),Ot.jsx("button",{className:"panel-collapse-toggle",onClick:()=>ve(!ge),title:ge?"Collapse panel":"Expand panel",children:Ot.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:Ot.jsx("path",{d:"M10 4L6 8L10 12"})})}),Ot.jsxs("div",{className:"panel-header",children:[Ot.jsx("h2",{children:"live_action"===e?"Film Presets":"Animation Presets"}),(f||g)&&Ot.jsx("button",{className:"clear-preset-btn",onClick:S,children:"Clear"})]}),Ot.jsxs("div",{className:"panel-tabs",children:[Ot.jsx("button",{className:"browser"===xe?"active":"",onClick:()=>be("browser"),children:"Browser"}),Ot.jsx("button",{className:"info"===xe?"active":"",onClick:()=>be("info"),children:"Info"})]}),Ot.jsxs("div",{className:"panel-tab-content",children:["browser"===xe&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("div",{className:"preset-search",children:Ot.jsx("input",{type:"text",placeholder:`Search ${"live_action"===e?"film":"animation"} presets...`,value:I,onChange:e=>j(e.target.value)})}),Ot.jsx("div",{className:"preset-list",children:k?Ot.jsx("div",{className:"loading",children:"Loading presets..."}):"live_action"===e?v.filter(e=>!I||e.name.toLowerCase().includes(I.toLowerCase())||e.era.toLowerCase().includes(I.toLowerCase())).map(e=>Ot.jsxs("button",{className:"preset-item "+((null==f?void 0:f.id)===e.id?"selected":""),onClick:()=>Ae(e.id),disabled:A,children:[Xv(e.id)&&Ot.jsx("div",{className:"preset-item-thumbnail",children:Ot.jsx("img",{src:Xv(e.id),alt:"",onError:e=>{e.target.parentElement.style.display="none"}})}),Ot.jsxs("div",{className:"preset-item-info",children:[Ot.jsx("span",{className:"preset-item-name",children:e.name}),Ot.jsxs("span",{className:"preset-item-meta",children:[e.year,"  ",e.era]})]})]},e.id)):y.filter(e=>!I||e.name.toLowerCase().includes(I.toLowerCase())||e.domain.toLowerCase().includes(I.toLowerCase())).map(e=>Ot.jsxs("button",{className:"preset-item "+((null==g?void 0:g.id)===e.id?"selected":""),onClick:()=>Ae(e.id),disabled:A,children:[Xv(e.id)&&Ot.jsx("div",{className:"preset-item-thumbnail",children:Ot.jsx("img",{src:Xv(e.id),alt:"",onError:e=>{e.target.parentElement.style.display="none"}})}),Ot.jsxs("div",{className:"preset-item-info",children:[Ot.jsx("span",{className:"preset-item-name",children:e.name}),Ot.jsxs("span",{className:"preset-item-meta",children:[e.domain,"  ",e.medium]})]})]},e.id))})]}),"info"===xe&&Ot.jsx(Ot.Fragment,{children:"live_action"===e&&f?Ot.jsxs("div",{className:"active-preset",children:[Ot.jsxs("div",{className:"active-preset-content",children:[Ot.jsxs("div",{className:"preset-info",children:[Ot.jsx("div",{className:"preset-name",children:f.name}),Ot.jsxs("div",{className:"preset-meta",children:[f.year,"  ",f.era]}),f.disallowed_moods.length>0&&Ot.jsxs("div",{className:"preset-constraints",children:[Ot.jsx("span",{className:"constraint-label",children:"Disallowed moods:"}),Ot.jsx("span",{className:"constraint-values",children:f.disallowed_moods.join(", ")})]})]}),Xv(f.id)&&Ot.jsx("div",{className:"preset-image-preview",children:Ot.jsx("img",{src:Xv(f.id),alt:`${f.name} frame`,onError:e=>{e.target.style.display="none"}})})]}),U&&Ot.jsx("div",{className:"cinematography-loading",children:"Loading cinematography details..."}),D&&Ot.jsxs("div",{className:"cinematography-details",children:[Ot.jsxs("div",{className:"cinematography-header",children:[Ot.jsx("span",{className:"cinematography-label",children:"Cinematographer"}),Ot.jsx("span",{className:"cinematography-value cinematographer-name",children:D.cinematographer})]}),Ot.jsxs("div",{className:"cinematography-grid",children:[Ot.jsxs("div",{className:"cinematography-item",children:[Ot.jsx("span",{className:"item-label",children:"Camera"}),Ot.jsx("span",{className:"item-value",children:D.camera})]}),Ot.jsxs("div",{className:"cinematography-item",children:[Ot.jsx("span",{className:"item-label",children:"Film Stock"}),Ot.jsx("span",{className:"item-value",children:D.film_stock})]}),Ot.jsxs("div",{className:"cinematography-item",children:[Ot.jsx("span",{className:"item-label",children:"Aspect Ratio"}),Ot.jsx("span",{className:"item-value",children:D.aspect_ratio})]}),Ot.jsxs("div",{className:"cinematography-item",children:[Ot.jsx("span",{className:"item-label",children:"Lenses"}),Ot.jsx("span",{className:"item-value",children:D.lens_info})]})]}),Ot.jsxs("div",{className:"cinematography-section",children:[Ot.jsx("span",{className:"section-label",children:"Lighting Signature"}),Ot.jsx("span",{className:"section-value",children:D.lighting_signature})]}),Ot.jsxs("div",{className:"cinematography-section",children:[Ot.jsx("span",{className:"section-label",children:"Color Palette"}),Ot.jsx("span",{className:"section-value",children:D.color_palette})]}),Ot.jsxs("div",{className:"cinematography-section",children:[Ot.jsx("span",{className:"section-label",children:"Notable Techniques"}),Ot.jsx("span",{className:"section-value",children:D.notable_techniques})]}),Ot.jsxs("div",{className:"cinematography-section",children:[Ot.jsx("span",{className:"section-label",children:"Movement Style"}),Ot.jsx("span",{className:"section-value",children:D.movement_style})]}),D.legacy&&Ot.jsxs("div",{className:"cinematography-section cinematography-legacy",children:[Ot.jsx("span",{className:"section-label",children:"Legacy & Influence"}),Ot.jsx("span",{className:"section-value",children:D.legacy})]})]})]}):"animation"===e&&g?Ot.jsx("div",{className:"active-preset",children:Ot.jsxs("div",{className:"active-preset-content",children:[Ot.jsxs("div",{className:"preset-info",children:[Ot.jsx("div",{className:"preset-name",children:g.name}),Ot.jsxs("div",{className:"preset-meta",children:[g.domain,"  ",g.medium]}),g.line_treatment&&Ot.jsxs("div",{className:"preset-detail",children:[Ot.jsx("span",{className:"detail-label",children:"Line Treatment:"}),Ot.jsx("span",{className:"detail-value",children:g.line_treatment.replace(/_/g," ")})]}),g.color_application&&Ot.jsxs("div",{className:"preset-detail",children:[Ot.jsx("span",{className:"detail-label",children:"Color:"}),Ot.jsx("span",{className:"detail-value",children:g.color_application.replace(/_/g," ")})]}),g.lighting_model&&Ot.jsxs("div",{className:"preset-detail",children:[Ot.jsx("span",{className:"detail-label",children:"Lighting:"}),Ot.jsx("span",{className:"detail-value",children:g.lighting_model.replace(/_/g," ")})]}),g.motion_style&&Ot.jsxs("div",{className:"preset-detail",children:[Ot.jsx("span",{className:"detail-label",children:"Motion:"}),Ot.jsx("span",{className:"detail-value",children:g.motion_style.replace(/_/g," ")})]}),g.reference_works&&g.reference_works.length>0&&Ot.jsxs("div",{className:"preset-detail",children:[Ot.jsx("span",{className:"detail-label",children:"Reference:"}),Ot.jsx("span",{className:"detail-value",children:g.reference_works.slice(0,2).join(", ")})]}),g.disallowed_motion.length>0&&Ot.jsxs("div",{className:"preset-constraints",children:[Ot.jsx("span",{className:"constraint-label",children:"Disallowed motion:"}),Ot.jsx("span",{className:"constraint-values",children:g.disallowed_motion.join(", ")})]})]}),Xv(g.id)&&Ot.jsx("div",{className:"preset-image-preview",children:Ot.jsx("img",{src:Xv(g.id),alt:`${g.name} frame`,onError:e=>{e.target.style.display="none"}})})]})}):Ot.jsx("div",{style:{textAlign:"center",color:"var(--text-muted)",padding:"2rem",fontSize:"0.85rem"},children:"Select a preset from the Browser tab to view details"})})]})]}),Ot.jsx("div",{className:"config-panel",children:"live_action"===e?Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.camera")}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:"Choose between digital cinema cameras or traditional film cameras",children:E("cpe.fields.cameraType")}),Ot.jsx("select",{value:n.camera.camera_type||"Digital",onChange:e=>{const t=e.target.value,n=("Digital"===t?pg.camera_manufacturer:pg.camera_manufacturer_film)[0];o("camera",{camera_type:t,manufacturer:n,body:(xg[n]||[])[0]||"",film_stock:"Film"===t?"Kodak_Vision3_500T_5219":"None"})},children:$("camera.camera_type",pg.camera_type.map(e=>({value:e,disabled:!1}))).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:cv,children:E("cpe.fields.manufacturer")}),Ot.jsx("select",{value:n.camera.manufacturer,onChange:e=>{const t=e.target.value,n=xg[t]||[];n.length>0?o("camera",{manufacturer:t,body:n[0]}):o("camera",{manufacturer:t})},children:$("camera.manufacturer",("Film"===n.camera.camera_type?pg.camera_manufacturer_film:pg.camera_manufacturer).map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Bg)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:uv,children:E("cpe.fields.body")}),Ot.jsx("select",{value:n.camera.body,onChange:e=>o("camera",{body:e.target.value}),children:$("camera.body",Lv(n.camera.manufacturer,n.camera.camera_type||"Digital")).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:vg[e.value]||e.value.replace(/_/g," ")},e.value))})]}),"Film"===n.camera.camera_type&&Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:"Film stock determines the visual character - color rendition, grain, and latitude",children:E("cpe.fields.filmStock")}),Ot.jsxs("select",{value:n.camera.film_stock||"",onChange:e=>o("camera",{film_stock:e.target.value}),children:[Ot.jsx("option",{value:"",children:E("cpe.placeholders.selectFilmStock")}),$("camera.film_stock",(Oe=n.camera.body,Oe.startsWith("IMAX_")?pg.film_stock_imax:"Super_Panavision_70"===Oe||"Ultra_Panavision_70"===Oe||"Mitchell_BFC_65"===Oe?pg.film_stock_65mm:pg.film_stock).map(e=>({value:e,disabled:!1}))).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))]})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:"Aspect ratio determines the frame shape - wider ratios are more cinematic",children:E("cpe.fields.aspectRatio")}),Ot.jsx("select",{value:n.camera.aspect_ratio||"1.85:1",onChange:e=>o("camera",{aspect_ratio:e.target.value}),children:$("camera.aspect_ratio",Hv(n.camera.body).map(e=>({value:e,disabled:!1}))).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.lens")}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:dv,children:E("cpe.fields.manufacturer")}),Ot.jsx("select",{value:n.lens.manufacturer,onChange:e=>{const t=e.target.value,n=Og[t]||[];n.length>0?o("lens",{manufacturer:t,family:n[0]}):o("lens",{manufacturer:t})},children:$("lens.manufacturer",pg.lens_manufacturer.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Hg)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:hv,children:["Lens Family",zg(n.camera.body)&&Ot.jsxs("span",{className:"field-hint",children:["(",zg(n.camera.body),")"]})]}),Ot.jsx("select",{value:n.lens.family,onChange:e=>o("lens",{family:e.target.value}),children:$("lens.family",zv(n.camera.body,n.lens.manufacturer)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:yg[e.value]||e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:pv,children:["Focal Length (mm)",n.lens.family&&Ot.jsxs("span",{className:"field-hint",children:["(available for ",yg[n.lens.family]||n.lens.family.replace(/_/g," "),")"]})]}),Ot.jsx("select",{value:n.lens.focal_length_mm,onChange:e=>o("lens",{focal_length_mm:parseInt(e.target.value,10)}),children:$("lens.focal_length_mm",Bv(n.lens.family)).map(e=>Ot.jsxs("option",{value:e.value,title:qv(e),disabled:e.disabled,children:[e.value,"mm"]},e.value))})]}),Ot.jsx("div",{className:"field",children:Ot.jsxs("label",{title:mv,children:[Ot.jsx("input",{type:"checkbox",checked:n.lens.is_anamorphic,onChange:e=>{if(e.target.checked){const e={Panavision:"Panavision_C_Series",Kowa:"Kowa_Anamorphic",Vintage:"Vintage_Anamorphic"},t=n.lens.manufacturer;e[t]?o("lens",{is_anamorphic:!0,family:e[t]}):o("lens",{is_anamorphic:!0,manufacturer:"Panavision",family:"Panavision_C_Series"})}else{const e=n.lens.manufacturer,t=Og[e]||[],r=t.find(e=>!e.toLowerCase().includes("anamorphic"))||t[0]||"ARRI_Signature_Prime";o("lens",{is_anamorphic:!1,family:r})}}})," ","Anamorphic"]})})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.movement")}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:fv,children:["Equipment","Heavy"===_g[n.camera.body]&&Ot.jsx("span",{className:"field-hint",children:"(limited by camera weight)"}),"Dolly_Zoom"===n.movement.movement_type&&Ot.jsx("span",{className:"field-hint",children:"(Dolly Zoom requires Dolly/Slider)"})]}),Ot.jsx("select",{value:n.movement.equipment,onChange:e=>{const t=e.target.value,r=wg[t]||pg.movement_type;if("Static"===t)return void o("movement",{equipment:"Static",movement_type:"Static",timing:"Static"});const i=r.includes(n.movement.movement_type);o("movement",i?{equipment:t}:{equipment:t,movement_type:r[0]||"Static"})},children:$("movement.equipment",Iv(n.camera.body,n.movement.movement_type)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:gv,children:["Movement Type ",Ot.jsx("span",{className:"field-hint",children:"(filtered by equipment)"})]}),Ot.jsx("select",{value:n.movement.movement_type,onChange:e=>{const t=e.target.value,r=Mg[t];r&&!r.includes(n.movement.timing)?o("movement",{movement_type:t,timing:"Moderate"}):o("movement",{movement_type:t})},children:$("movement.movement_type",jv(n.movement.equipment)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:vv,children:["Timing","Dolly_Zoom"===n.movement.movement_type&&Ot.jsx("span",{className:"field-hint",children:"(Dolly Zoom requires slower timing)"})]}),Ot.jsx("select",{value:n.movement.timing,onChange:e=>o("movement",{timing:e.target.value}),children:$("movement.timing",Uv(n.movement.movement_type)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.lighting")}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:yv,children:E("cpe.fields.timeOfDay")}),Ot.jsx("select",{value:n.lighting.time_of_day,onChange:e=>{const t=e.target.value,r=Eg[t],i=n.lighting.source,a=Tg[t],s=n.lighting.style,l={time_of_day:t};r&&!r.includes(i)&&(l.source=r[0]),a&&!a.includes(s)&&(l.style=a[0]),o("lighting",l)},children:pg.time_of_day.map(e=>{var t;return Ot.jsx("option",{value:e,title:(null==(t=Xg)?void 0:t[e])||"",children:e.replace(/_/g," ")},e)})})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:_v,children:["Source",Ot.jsx("span",{className:"field-hint",children:f?f.year<2002?"(filtered by time + preset + era)":f.disallowed_sources.length>0?"(filtered by time + preset)":"(filtered by time)":"(filtered by time)"})]}),Ot.jsx("select",{value:n.lighting.source,onChange:e=>o("lighting",{source:e.target.value}),children:$("lighting.source",Dv(n.lighting.time_of_day,(null==f?void 0:f.disallowed_sources)||[],null==f?void 0:f.year,null==f?void 0:f.name)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:xv,children:["Style ",Ot.jsx("span",{className:"field-hint",children:"(filtered by time & mood)"})]}),Ot.jsx("select",{value:n.lighting.style,onChange:e=>o("lighting",{style:e.target.value}),children:$("lighting.style",Ov(n.lighting.time_of_day,n.visual_grammar.mood)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.visualGrammar")}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:bv,children:["Shot Size",Rg(n.lens.focal_length_mm,n.visual_grammar.shot_size)&&Ot.jsxs("span",{className:"field-hint warning",children:["(",Rg(n.lens.focal_length_mm,n.visual_grammar.shot_size),")"]})]}),Ot.jsx("select",{value:n.visual_grammar.shot_size,onChange:e=>o("visual_grammar",{shot_size:e.target.value}),children:pg.shot_size.map(e=>{var t;return Ot.jsx("option",{value:e,title:(null==(t=Yg)?void 0:t[e])||"",children:gg[e]||e},e)})})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:wv,children:E("cpe.fields.composition")}),Ot.jsx("select",{value:n.visual_grammar.composition,onChange:e=>o("visual_grammar",{composition:e.target.value}),children:$("visual_grammar.composition",pg.composition.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Zg)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:Sv,children:["Mood",f&&f.disallowed_moods.length>0&&Ot.jsx("span",{className:"field-hint",children:"(filtered by preset)"})]}),Ot.jsx("select",{value:n.visual_grammar.mood,onChange:e=>{var t;const r=e.target.value,i=kg[r];if(null==i?void 0:i.disallowed.includes(n.lighting.style)){const e=pg.lighting_style.filter(e=>!i.disallowed.includes(e)),n=(null==(t=i.preferred)?void 0:t.find(t=>e.includes(t)))||e[0]||"High_Key";o("visual_grammar",{mood:r}),o("lighting",{style:n})}else o("visual_grammar",{mood:r})},children:$("visual_grammar.mood",(je=(null==f?void 0:f.disallowed_moods)||[],De=null==f?void 0:f.name,pg.mood.map(e=>{var t;const n=null==(t=Jg)?void 0:t[e];return je.includes(e)?{value:e,disabled:!0,reason:` "${e}" conflicts with ${De||"preset"}'s visual languagewould create tonal dissonance.`,description:n}:{value:e,disabled:!1,description:n}}))).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Mv,children:E("cpe.fields.colorTone")}),Ot.jsx("select",{value:n.visual_grammar.color_tone,onChange:e=>o("visual_grammar",{color_tone:e.target.value}),children:pg.color_tone.map(e=>{var t;return Ot.jsx("option",{value:e,title:(null==(t=Qg)?void 0:t[e])||"",children:e.replace(/_/g," ")},e)})})]})]})]}):Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.style")}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Ev,children:E("cpe.fields.medium")}),Ot.jsx("select",{value:r.medium,onChange:e=>s("medium",e.target.value),children:$("medium",pg.animation_medium.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=tv)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Cv,children:E("cpe.fields.styleDomain")}),Ot.jsx("select",{value:r.style_domain,onChange:e=>{var t,n,i,a;const o=e.target.value,l=Pg[o],c={};if(null==(t=null==l?void 0:l.disallowed_colors)?void 0:t.includes(r.rendering.color_application)){const e=pg.color_application.filter(e=>{var t;return!(null==(t=l.disallowed_colors)?void 0:t.includes(e))});c.rendering={...r.rendering,color_application:e[0]||"Monochrome_Ink"}}if((null==(n=null==l?void 0:l.disallowed_motion)?void 0:n.includes(r.motion.motion_style))&&(c.motion={...r.motion,motion_style:"None"}),(null==(i=null==l?void 0:l.disallowed_cameras)?void 0:i.includes(r.motion.virtual_camera))&&(c.motion={...c.motion||r.motion,virtual_camera:"Locked"}),(null==l?void 0:l.required_lighting)&&!l.required_lighting.includes(r.rendering.lighting_model))c.rendering={...c.rendering||r.rendering,lighting_model:l.required_lighting[0]};else if(null==(a=null==l?void 0:l.disallowed_lighting)?void 0:a.includes(r.rendering.lighting_model)){const e=pg.lighting_model.filter(e=>{var t;return!(null==(t=l.disallowed_lighting)?void 0:t.includes(e))});c.rendering={...c.rendering||r.rendering,lighting_model:e[0]||"Cel_Shaded"}}s("style_domain",o),c.rendering&&s("rendering",c.rendering),c.motion&&s("motion",c.motion)},children:$("style_domain",pg.style_domain.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=nv)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.rendering")}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Tv,children:E("cpe.fields.lineTreatment")}),Ot.jsx("select",{value:r.rendering.line_treatment,onChange:e=>s("rendering",{line_treatment:e.target.value}),children:$("rendering.line_treatment",pg.line_treatment.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=rv)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:kv,children:[E("cpe.fields.colorApplication")," ","Manga"===r.style_domain&&Ot.jsx("span",{className:"field-hint",children:E("cpe.hints.mangaMonochromeOnly")})]}),Ot.jsx("select",{value:r.rendering.color_application,onChange:e=>s("rendering",{color_application:e.target.value}),children:$("rendering.color_application",Vv(r.style_domain)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:Pv,children:["Lighting Model","Manga"===r.style_domain&&Ot.jsx("span",{className:"field-hint",children:"(Manga: Graphic only)"}),"ThreeD"===r.style_domain&&Ot.jsx("span",{className:"field-hint",children:"(3D: No Flat lighting)"})]}),Ot.jsx("select",{value:r.rendering.lighting_model,onChange:e=>s("rendering",{lighting_model:e.target.value}),children:$("rendering.lighting_model",$v(r.style_domain)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Av,children:E("cpe.fields.surfaceDetail")}),Ot.jsx("select",{value:r.rendering.surface_detail,onChange:e=>s("rendering",{surface_detail:e.target.value}),children:$("rendering.surface_detail",pg.surface_detail.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=ov)?void 0:t[e]}})).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.motion")}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:Nv,children:["Motion Style ",("Manga"===r.style_domain||"Illustration"===r.style_domain)&&Ot.jsx("span",{className:"field-hint",children:"(static only)"})]}),Ot.jsx("select",{value:r.motion.motion_style,onChange:e=>s("motion",{motion_style:e.target.value}),children:$("motion.motion_style",Wv(r.style_domain)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value},e.value))})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsxs("label",{title:Rv,children:["Virtual Camera",Ot.jsxs("span",{className:"field-hint",children:["(filtered by domain/medium","None"===r.motion.motion_style?"/motion":"",")"]})]}),Ot.jsx("select",{value:r.motion.virtual_camera,onChange:e=>s("motion",{virtual_camera:e.target.value}),children:$("motion.virtual_camera",Gv(r.style_domain,r.medium,r.motion.motion_style)).map(e=>Ot.jsx("option",{value:e.value,title:qv(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]})]}),Ot.jsxs("div",{className:"section",children:[Ot.jsx("h2",{children:E("cpe.sections.visualGrammar")}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:bv,children:E("cpe.fields.shotSize")}),Ot.jsx("select",{value:r.visual_grammar.shot_size,onChange:e=>s("visual_grammar",{shot_size:e.target.value}),children:pg.shot_size.map(e=>{var t;return Ot.jsx("option",{value:e,title:(null==(t=Yg)?void 0:t[e])||"",children:gg[e]||e},e)})})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Sv,children:E("cpe.fields.mood")}),Ot.jsx("select",{value:r.visual_grammar.mood,onChange:e=>s("visual_grammar",{mood:e.target.value}),children:Fv((null==g?void 0:g.mood)||[],null==g?void 0:g.name).map(e=>{var t;return Ot.jsxs("option",{value:e.value,title:qv(e),children:[e.value,(null==(t=null==g?void 0:g.mood)?void 0:t.includes(e.value))?" ":""]},e.value)})})]}),Ot.jsxs("div",{className:"field",children:[Ot.jsx("label",{title:Mv,children:E("cpe.fields.colorTone")}),Ot.jsx("select",{value:r.visual_grammar.color_tone,onChange:e=>s("visual_grammar",{color_tone:e.target.value}),children:pg.color_tone.map(e=>{var t;return Ot.jsx("option",{value:e,title:(null==(t=Qg)?void 0:t[e])||"",children:e.replace(/_/g," ")},e)})})]})]})]})})]});var je,De,Oe}const Jv=[{label:"Free",ratio:null},{label:"1:1",ratio:1},{label:"4:3",ratio:4/3},{label:"16:9",ratio:16/9},{label:"2.35:1",ratio:2.35},{label:"9:16",ratio:9/16},{label:"3:4",ratio:3/4}];function Qv({imageData:e,mode:t,initialMask:n,initialCrop:r,initialPaint:i,onSave:a,onCancel:o}){const{t:s}=yf(),[l,c]=kt.useState(t),[u,d]=kt.useState(null),[h,p]=kt.useState({x:0,y:0,width:0,height:0}),[m,f]=kt.useState(!1),[g,v]=kt.useState({x:0,y:0}),[y,_]=kt.useState(!1),[x,b]=kt.useState(!1),[w,S]=kt.useState(null),[M,E]=kt.useState({x:0,y:0}),[C,T]=kt.useState({x:0,y:0,width:0,height:0}),[k,P]=kt.useState(!1),[A,N]=kt.useState(20),[R,L]=kt.useState(.8),[I,j]=kt.useState("add"),[D,O]=kt.useState(!1),[U,F]=kt.useState("#ff0000"),[z,B]=kt.useState(15),[H,V]=kt.useState("paint"),[G,W]=kt.useState(null),$=kt.useRef(null),X=kt.useRef(null),q=kt.useRef(null),K=kt.useRef(null),Y=kt.useRef(null),Z=kt.useRef(null),J=kt.useRef(null),[Q,ee]=kt.useState({width:0,height:0}),[te,ne]=kt.useState(1),re=kt.useCallback(()=>{const e=q.current;if(!e)return;const t=$.current;if(!t)return;const a=t.clientWidth-40,o=t.clientHeight-40,s=e.naturalWidth/e.naturalHeight;let l,c;s>a/o?(l=a,c=a/s):(c=o,l=o*s),ee({width:l,height:c});const u=l/e.naturalWidth;ne(u),p(r?{x:r.x*l,y:r.y*c,width:r.width*l,height:r.height*c}:{x:0,y:0,width:l,height:c});const d=K.current;if(d){d.width=e.naturalWidth,d.height=e.naturalHeight;const t=d.getContext("2d");if(t&&(t.fillStyle="black",t.fillRect(0,0,d.width,d.height),n)){const e=new Image;e.onload=()=>{t.drawImage(e,0,0,d.width,d.height);const n=Y.current;if(n){const e=n.getContext("2d");if(e){const r=t.getImageData(0,0,d.width,d.height),i=e.createImageData(n.width,n.height);for(let e=0;e<n.height;e++)for(let t=0;t<n.width;t++){const a=Math.floor(t/u),o=4*(Math.floor(e/u)*d.width+a),s=4*(e*n.width+t),l=r.data[o];l>0&&(i.data[s]=255,i.data[s+1]=50,i.data[s+2]=50,i.data[s+3]=Math.floor(.8*l))}e.putImageData(i,0,0)}}},e.src=n}}const h=Y.current;h&&(h.width=l,h.height=c);const m=Z.current;if(m){m.width=e.naturalWidth,m.height=e.naturalHeight;const t=m.getContext("2d");if(t&&(t.clearRect(0,0,m.width,m.height),i)){const e=new Image;e.onload=()=>{t.drawImage(e,0,0,m.width,m.height);const n=J.current;if(n){const t=n.getContext("2d");t&&(t.clearRect(0,0,n.width,n.height),t.drawImage(e,0,0,n.width,n.height))}},e.src=i}}const f=J.current;f&&(f.width=l,f.height=c)},[n,r,i]),ie=kt.useCallback(e=>{const t=X.current;if(!t)return{x:0,y:0};const n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},[]),ae=kt.useCallback(e=>{e.preventDefault();const t=ie(e),n=t.x>=h.x-10&&t.x<=h.x+10&&t.y>=h.y-10&&t.y<=h.y+10,r=t.x>=h.x+h.width-10&&t.x<=h.x+h.width+10&&t.y>=h.y-10&&t.y<=h.y+10,i=t.x>=h.x-10&&t.x<=h.x+10&&t.y>=h.y+h.height-10&&t.y<=h.y+h.height+10,a=t.x>=h.x+h.width-10&&t.x<=h.x+h.width+10&&t.y>=h.y+h.height-10&&t.y<=h.y+h.height+10;n?(b(!0),S("tl"),T(h),v(t)):r?(b(!0),S("tr"),T(h),v(t)):i?(b(!0),S("bl"),T(h),v(t)):a?(b(!0),S("br"),T(h),v(t)):t.x>=h.x&&t.x<=h.x+h.width&&t.y>=h.y&&t.y<=h.y+h.height&&h.width>10?(_(!0),E(t),T(h)):(f(!0),v(t),p({x:t.x,y:t.y,width:0,height:0}))},[h,ie]),oe=kt.useCallback(e=>{const t=ie(e);if(m){let e=t.x-g.x,n=t.y-g.y;if(null!==u){const t=Math.abs(e),r=Math.abs(n);t/u>r?n=n>0?t/u:-t/u:e=e>0?r*u:-r*u}p({x:e<0?g.x+e:g.x,y:n<0?g.y+n:g.y,width:Math.abs(e),height:Math.abs(n)})}else if(y){const e=t.x-M.x,n=t.y-M.y;let r=Math.max(0,Math.min(C.x+e,Q.width-C.width)),i=Math.max(0,Math.min(C.y+n,Q.height-C.height));p({x:r,y:i,width:C.width,height:C.height})}else if(x&&w){let e=C.x,n=C.y,r=C.width,i=C.height;switch(w){case"br":r=t.x-C.x,i=t.y-C.y;break;case"tr":r=t.x-C.x,i=C.y+C.height-t.y,n=t.y;break;case"bl":r=C.x+C.width-t.x,i=t.y-C.y,e=t.x;break;case"tl":r=C.x+C.width-t.x,i=C.y+C.height-t.y,e=t.x,n=t.y}null!==u&&("br"===w||"tl"===w?(i=r/u,"tl"===w&&(n=C.y+C.height-i)):(i=r/u,"tr"===w&&(n=C.y+C.height-i))),r>10&&i>10&&(e=Math.max(0,Math.min(e,Q.width-10)),n=Math.max(0,Math.min(n,Q.height-10)),r=Math.min(r,Q.width-e),i=Math.min(i,Q.height-n),p({x:e,y:n,width:r,height:i}))}},[m,y,x,w,g,M,C,u,Q,ie]),se=kt.useCallback(()=>{f(!1),_(!1),b(!1),S(null)},[]),le=kt.useCallback(e=>{const t=Y.current;if(!t)return null;const n=t.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;return{x:r/te,y:i/te}},[te]),ce=kt.useCallback(e=>{const t=le(e);if(!t)return;const n=Y.current,r=K.current;if(!n||!r)return;const i=n.getContext("2d"),a=r.getContext("2d");if(!i||!a)return;const o=t.x*te,s=t.y*te,l=A;"add"===I?(i.beginPath(),i.arc(o,s,l/2,0,2*Math.PI),i.fillStyle=`rgba(255, 50, 50, ${R})`,i.fill(),a.beginPath(),a.arc(t.x,t.y,A/te/2,0,2*Math.PI),a.fillStyle="white",a.fill()):(i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(o,s,l/2,0,2*Math.PI),i.fill(),i.globalCompositeOperation="source-over",a.beginPath(),a.arc(t.x,t.y,A/te/2,0,2*Math.PI),a.fillStyle="black",a.fill())},[le,A,R,I,te]),ue=kt.useCallback(e=>{e.preventDefault(),P(!0),ce(e)},[ce]),de=kt.useCallback(e=>{k&&ce(e)},[k,ce]),he=kt.useCallback(()=>{P(!1)},[]),pe=kt.useCallback(e=>{const t=J.current;if(!t)return null;const n=t.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;return{x:r/te,y:i/te}},[te]),me=kt.useCallback((e,t)=>{const n=Z.current,r=J.current;if(!n||!r)return;const i=n.getContext("2d"),a=r.getContext("2d");if(!i||!a)return;const o=z/te;if("paint"===H){i.lineCap="round",i.lineJoin="round",i.lineWidth=o,i.strokeStyle=U,i.fillStyle=U,e?(i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke()):(i.beginPath(),i.arc(t.x,t.y,o/2,0,2*Math.PI),i.fill()),a.lineCap="round",a.lineJoin="round",a.lineWidth=z,a.strokeStyle=U,a.fillStyle=U;const n=e?{x:e.x*te,y:e.y*te}:null,r={x:t.x*te,y:t.y*te};n?(a.beginPath(),a.moveTo(n.x,n.y),a.lineTo(r.x,r.y),a.stroke()):(a.beginPath(),a.arc(r.x,r.y,z/2,0,2*Math.PI),a.fill())}else{i.globalCompositeOperation="destination-out",i.lineCap="round",i.lineJoin="round",i.lineWidth=o,e?(i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.stroke()):(i.beginPath(),i.arc(t.x,t.y,o/2,0,2*Math.PI),i.fill()),i.globalCompositeOperation="source-over",a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineJoin="round",a.lineWidth=z;const n=e?{x:e.x*te,y:e.y*te}:null,r={x:t.x*te,y:t.y*te};n?(a.beginPath(),a.moveTo(n.x,n.y),a.lineTo(r.x,r.y),a.stroke()):(a.beginPath(),a.arc(r.x,r.y,z/2,0,2*Math.PI),a.fill()),a.globalCompositeOperation="source-over"}},[z,H,U,te]),fe=kt.useCallback(e=>{e.preventDefault();const t=pe(e);t&&(O(!0),W(t),me(null,t))},[pe,me]),ge=kt.useCallback(e=>{if(!D)return;const t=pe(e);t&&(me(G,t),W(t))},[D,pe,G,me]),ve=kt.useCallback(()=>{O(!1),W(null)},[]),ye=kt.useCallback(()=>{const e=Z.current,t=J.current;if(!e||!t)return;const n=e.getContext("2d"),r=t.getContext("2d");n&&r&&(n.clearRect(0,0,e.width,e.height),r.clearRect(0,0,t.width,t.height))},[]),_e=kt.useCallback(()=>Math.abs(h.x)<2&&Math.abs(h.y)<2&&Math.abs(h.width-Q.width)<2&&Math.abs(h.height-Q.height)<2,[h,Q]),xe=kt.useCallback(()=>{const e=q.current,t=K.current,n=Z.current;if(!e)return console.error("[CropMaskEditor] No image ref"),void o();const r=!_e(),i=!!t&&function(e){const t=e.getContext("2d");if(!t)return!1;const n=t.getImageData(0,0,e.width,e.height).data;for(let r=0;r<n.length;r+=4)if(n[r]>0)return!0;return!1}(t),s=!!n&&function(e){const t=e.getContext("2d");if(!t)return!1;const n=t.getImageData(0,0,e.width,e.height).data;for(let r=3;r<n.length;r+=4)if(n[r]>0)return!0;return!1}(n);if(console.log("[CropMaskEditor] handleSave - hasPaint:",s,"hasMask:",i,"hasCrop:",r),console.log("[CropMaskEditor] handleSave - cropRect:",h),console.log("[CropMaskEditor] handleSave - imageSize:",Q),!r&&!i&&!s)return console.log("[CropMaskEditor] No changes detected, closing without saving"),void a(null,null,null,null);const l=r?{x:h.x/Q.width,y:h.y/Q.height,width:h.width/Q.width,height:h.height/Q.height}:null,c=h.x/te,u=h.y/te,d=h.width/te,p=h.height/te,m=document.createElement("canvas");m.width=e.naturalWidth,m.height=e.naturalHeight;const f=m.getContext("2d");if(!f)return console.error("[CropMaskEditor] Failed to create base canvas context"),void o();f.drawImage(e,0,0),s&&n&&(console.log("[CropMaskEditor] Applying paint layer"),f.drawImage(n,0,0));const g=s&&n?n.toDataURL("image/png"):null;if(i&&t){console.log("[CropMaskEditor] Applying mask as alpha channel");const e=f.getImageData(0,0,m.width,m.height),n=e.data,r=t.getContext("2d");if(!r)return console.error("[CropMaskEditor] Failed to get mask context"),void o();const i=r.getImageData(0,0,t.width,t.height).data;for(let t=0;t<n.length;t+=4){const e=i[t];n[t+3]=e}f.putImageData(e,0,0)}const v=i&&t?t.toDataURL("image/png"):null;let y;if(r){console.log("[CropMaskEditor] Applying crop");const t=document.createElement("canvas");t.width=d,t.height=p;const n=t.getContext("2d");if(!n)return console.error("[CropMaskEditor] Failed to create cropped canvas context"),void o();n.drawImage(m,Math.max(0,c),Math.max(0,u),Math.min(d,e.naturalWidth-c),Math.min(p,e.naturalHeight-u),0,0,t.width,t.height),y=t.toDataURL("image/png")}else y=m.toDataURL("image/png");console.log("[CropMaskEditor] Result length:",y.length),a(y,v,l,g)},[h,Q,te,_e,a,o]),be=kt.useCallback(()=>{const e=K.current,t=Y.current;if(!e||!t)return;const n=e.getContext("2d"),r=t.getContext("2d");n&&r&&(n.fillStyle="black",n.fillRect(0,0,e.width,e.height),r.clearRect(0,0,t.width,t.height))},[]),we=kt.useCallback(e=>{if(d(e),h.width>0&&h.height>0&&null!==e){const t=h.width/h.height,n=h.x+h.width/2,r=h.y+h.height/2;let i=h.width,a=h.height;t>e?a=i/e:i=a*e,i=Math.min(i,Q.width),a=Math.min(a,Q.height);let o=n-i/2,s=r-a/2;o=Math.max(0,Math.min(o,Q.width-i)),s=Math.max(0,Math.min(s,Q.height-a)),p({x:o,y:s,width:i,height:a})}},[h,Q]),Se=kt.useCallback(()=>{p({x:0,y:0,width:Q.width,height:Q.height}),d(null)},[Q]);return Ot.jsx("div",{className:"crop-mask-editor-overlay",children:Ot.jsxs("div",{className:"crop-mask-editor-modal",children:[Ot.jsxs("div",{className:"crop-mask-editor-header",children:[Ot.jsx("h3",{children:s("crop"===l?"storyboard.cropMaskEditor.cropImage":"mask"===l?"storyboard.cropMaskEditor.editMask":"storyboard.cropMaskEditor.paintOnImage")}),Ot.jsxs("div",{className:"mode-toggle",children:[Ot.jsxs("button",{className:"crop"===l?"active":"",onClick:()=>c("crop"),children:[" ",s("storyboard.cropMaskEditor.tabCrop")]}),Ot.jsxs("button",{className:"mask"===l?"active":"",onClick:()=>c("mask"),children:[" ",s("storyboard.cropMaskEditor.tabMask")]}),Ot.jsxs("button",{className:"paint"===l?"active":"",onClick:()=>c("paint"),children:[" ",s("storyboard.cropMaskEditor.tabPaint")]})]}),Ot.jsx("button",{className:"close-btn",onClick:o,children:""})]}),Ot.jsxs("div",{className:"crop-mask-editor-toolbar",children:["crop"===l&&Ot.jsxs("div",{className:"crop-toolbar",children:[Ot.jsx("span",{children:s("storyboard.cropMaskEditor.aspectRatio")}),Ot.jsx("div",{className:"aspect-presets",children:Jv.map(e=>Ot.jsx("button",{className:u===e.ratio?"active":"",onClick:()=>we(e.ratio),children:e.label},e.label))}),Ot.jsxs("button",{className:"reset-crop-btn",onClick:Se,title:s("storyboard.cropMaskEditor.resetCropTitle"),children:[" ",s("storyboard.cropMaskEditor.reset")]})]}),"mask"===l&&Ot.jsxs("div",{className:"mask-toolbar",children:[Ot.jsxs("div",{className:"brush-controls",children:[Ot.jsxs("label",{children:[s("storyboard.cropMaskEditor.size"),Ot.jsx("input",{type:"range",min:"5",max:"100",value:A,onChange:e=>N(Number(e.target.value))}),Ot.jsxs("span",{children:[A,"px"]})]}),Ot.jsxs("label",{children:[s("storyboard.cropMaskEditor.opacity"),Ot.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:R,onChange:e=>L(Number(e.target.value))}),Ot.jsxs("span",{children:[Math.round(100*R),"%"]})]})]}),Ot.jsxs("div",{className:"brush-modes",children:[Ot.jsxs("button",{className:"add"===I?"active":"",onClick:()=>j("add"),children:[" ",s("storyboard.cropMaskEditor.add")]}),Ot.jsxs("button",{className:"erase"===I?"active":"",onClick:()=>j("erase"),children:[" ",s("storyboard.cropMaskEditor.erase")]}),Ot.jsxs("button",{onClick:be,children:[" ",s("storyboard.cropMaskEditor.clear")]})]})]}),"paint"===l&&Ot.jsxs("div",{className:"paint-toolbar",children:[Ot.jsxs("div",{className:"brush-controls",children:[Ot.jsxs("label",{children:[s("storyboard.cropMaskEditor.size"),Ot.jsx("input",{type:"range",min:"1",max:"100",value:z,onChange:e=>B(Number(e.target.value))}),Ot.jsxs("span",{children:[z,"px"]})]}),Ot.jsxs("label",{className:"color-picker-label",children:[s("storyboard.cropMaskEditor.color"),Ot.jsx("input",{type:"color",value:U,onChange:e=>F(e.target.value),className:"color-picker"}),Ot.jsx("span",{className:"color-preview",style:{backgroundColor:U}})]})]}),Ot.jsxs("div",{className:"brush-modes",children:[Ot.jsxs("button",{className:"paint"===H?"active":"",onClick:()=>V("paint"),children:[" ",s("storyboard.cropMaskEditor.tabPaint")]}),Ot.jsxs("button",{className:"erase"===H?"active":"",onClick:()=>V("erase"),children:[" ",s("storyboard.cropMaskEditor.erase")]}),Ot.jsxs("button",{onClick:ye,children:[" ",s("storyboard.cropMaskEditor.clear")]})]})]})]}),Ot.jsxs("div",{className:"crop-mask-editor-canvas",ref:$,children:[Ot.jsxs("div",{ref:X,className:"image-wrapper",style:{width:Q.width,height:Q.height,position:"relative"},children:[Ot.jsx("img",{ref:q,src:e,alt:"Source",onLoad:re,style:{width:"100%",height:"100%",display:"block"}}),Ot.jsx("canvas",{ref:Y,className:"mask-display-canvas",style:{display:"mask"===l?"block":"none",position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"mask"===l?"auto":"none"},onMouseDown:ue,onMouseMove:de,onMouseUp:he,onMouseLeave:he}),Ot.jsx("canvas",{ref:J,className:"paint-display-canvas",style:{display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"paint"===l?"auto":"none"},onMouseDown:fe,onMouseMove:ge,onMouseUp:ve,onMouseLeave:ve}),"crop"===l&&Ot.jsxs("div",{className:"crop-overlay",onMouseDown:ae,onMouseMove:oe,onMouseUp:se,onMouseLeave:se,children:[Ot.jsx("div",{className:"crop-darken",style:{clipPath:`polygon(\n                    0 0, 100% 0, 100% 100%, 0 100%,\n                    0 ${h.y}px,\n                    ${h.x}px ${h.y}px,\n                    ${h.x}px ${h.y+h.height}px,\n                    ${h.x+h.width}px ${h.y+h.height}px,\n                    ${h.x+h.width}px ${h.y}px,\n                    ${h.x}px ${h.y}px,\n                    0 ${h.y}px\n                  )`}}),Ot.jsx("div",{className:"crop-rect",style:{left:h.x,top:h.y,width:h.width,height:h.height},children:Ot.jsxs("div",{className:"crop-handles",children:[Ot.jsx("div",{className:"crop-handle tl"}),Ot.jsx("div",{className:"crop-handle tr"}),Ot.jsx("div",{className:"crop-handle bl"}),Ot.jsx("div",{className:"crop-handle br"})]})})]})]}),Ot.jsx("canvas",{ref:K,className:"mask-canvas",style:{display:"none"}}),Ot.jsx("canvas",{ref:Z,className:"paint-canvas",style:{display:"none"}})]}),Ot.jsxs("div",{className:"crop-mask-editor-footer",children:[Ot.jsx("div",{className:"crop-info",children:"crop"===l&&h.width>0&&Ot.jsxs("span",{children:[Math.round(h.width/te),"  ",Math.round(h.height/te)," px"]})}),Ot.jsxs("div",{className:"action-buttons",children:[Ot.jsx("button",{className:"cancel-btn",onClick:o,children:s("storyboard.cropMaskEditor.cancel")}),Ot.jsx("button",{className:"save-btn",onClick:xe,children:s("crop"===l?"storyboard.cropMaskEditor.applyCrop":"mask"===l?"storyboard.cropMaskEditor.saveMask":"storyboard.cropMaskEditor.applyChanges")})]})]})]})})}function ey({originalImage:e,cropRect:t,displayMask:n}){const r=kt.useRef(null),[i,a]=kt.useState(null);return kt.useEffect(()=>{if(!t)return void a(e);const n=new Image;n.onload=()=>{const e=t.x*n.naturalWidth,r=t.y*n.naturalHeight,i=t.width*n.naturalWidth,o=t.height*n.naturalHeight,s=document.createElement("canvas");s.width=i,s.height=o;const l=s.getContext("2d");l&&(l.drawImage(n,e,r,i,o,0,0,i,o),a(s.toDataURL("image/png")))},n.src=e},[e,t]),Ot.jsxs("div",{ref:r,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[i&&Ot.jsx("img",{src:i,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"contain"}}),n&&Ot.jsx(ty,{maskData:n})]})}function ty({maskData:e}){const t=kt.useRef(null);return kt.useEffect(()=>{const n=t.current;if(!n)return;const r=n.getContext("2d");if(!r)return;const i=new Image;i.onload=()=>{n.width=i.width,n.height=i.height,r.drawImage(i,0,0);const e=r.getImageData(0,0,n.width,n.height).data,t=r.createImageData(n.width,n.height);for(let n=0;n<e.length;n+=4){const r=e[n];r>10?(t.data[n]=255,t.data[n+1]=50,t.data[n+2]=50,t.data[n+3]=Math.floor(.6*r)):(t.data[n]=0,t.data[n+1]=0,t.data[n+2]=0,t.data[n+3]=0)}r.clearRect(0,0,n.width,n.height),r.putImageData(t,0,0)},i.src=e},[e]),Ot.jsx("canvas",{ref:t,className:"mask-overlay"})}function ny({name:e,displayName:t,value:n,onChange:r,onBrowse:i,disabled:a=!1,acceptType:o="image",isBypassed:s=!1,onBypassChange:l,comfyUrl:c}){const{t:u}=yf(),[d,h]=kt.useState(!1),[p,m]=kt.useState(!1),[f,g]=kt.useState(null),v=kt.useRef(null),y=kt.useCallback(()=>{switch(o){case"image":default:return"image/*";case"video":return"video/*";case"any":return"image/*,video/*"}},[o]),_=kt.useCallback(e=>{const t=e.type.startsWith("image/"),n=e.type.startsWith("video/");switch(o){case"image":default:return t;case"video":return n;case"any":return t||n}},[o]),x=kt.useCallback(e=>{console.log("[DropZone] DragEnter fired"),e.preventDefault(),e.stopPropagation(),a||(h(!0),m(!0))},[a]),b=kt.useCallback(e=>{console.log("[DropZone] DragLeave fired"),e.preventDefault(),e.stopPropagation(),m(!1),h(!1)},[]),w=kt.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),S=kt.useCallback(t=>{if(!_(t))return;const n=t.type.startsWith("video/");g(n?"video":"image"),L(null),j(null),O(null),F(null),B(null);const i=new FileReader;i.onload=t=>{var n;(null==(n=t.target)?void 0:n.result)&&r(e,t.target.result)},i.readAsDataURL(t)},[_,e,r]),M=kt.useCallback(async t=>{if(console.log("[DropZone] Drop fired!"),t.preventDefault(),t.stopPropagation(),h(!1),m(!1),a)return void console.log("[DropZone] Drop ignored - disabled");console.log("[DropZone] Drop data types:",t.dataTransfer.types),console.log("[DropZone] Drop text data:",t.dataTransfer.getData("text/plain").substring(0,100));const n=t.dataTransfer.files;if(n.length>0)return void S(n[0]);const i=t.dataTransfer.getData("text/plain");if(i){L(null),j(null),O(null),F(null),B(null),g("image");try{const t=JSON.parse(i),n="";if(t.url&&"string"==typeof t.url){console.log("[DropZone] Fetching image from URL:",t.url.substring(0,80));try{const n=await fetch(t.url);if(n.ok){const t=await n.blob();console.log("[DropZone] Got blob via direct fetch, size:",t.size);const i=new FileReader;return i.onload=()=>{console.log("[DropZone] FileReader loaded, calling onChange"),r(e,i.result)},i.onerror=e=>{console.error("[DropZone] FileReader error:",e)},void i.readAsDataURL(t)}}catch(o){console.log("[DropZone] Direct fetch failed (likely CORS), trying CPE proxy...");try{const i=await fetch(`${n}/api/fetch-image?url=${encodeURIComponent(t.url)}`),a=await i.json();if(a.success&&a.dataUrl)return console.log("[DropZone] Successfully fetched via CPE proxy"),void r(e,a.dataUrl);console.warn("[DropZone] CPE proxy failed:",a.message)}catch(s){console.warn("[DropZone] CPE proxy error:",s)}}}if(t.filePath&&"string"==typeof t.filePath){console.log("[DropZone] Trying CPE backend for filePath:",t.filePath);const i=await fetch(`${n}/api/read-image?path=${encodeURIComponent(t.filePath)}`),a=await i.json();if(a.success&&a.dataUrl)return void r(e,a.dataUrl)}}catch(l){console.warn("[DropZone] Error parsing/handling dropped data:",l)}i.startsWith("data:")&&r(e,i)}},[a,e,r,S]),E=kt.useCallback(e=>{const t=e.target.files;t&&t.length>0&&S(t[0])},[S]),C=kt.useCallback(()=>{var e;i?i():null==(e=v.current)||e.click()},[i]),T=kt.useCallback(()=>{r(e,null),g(null),L(null),j(null),O(null),F(null),B(null)},[e,r]),[k,P]=kt.useState(!1),[A,N]=kt.useState("crop"),[R,L]=kt.useState(null),[I,j]=kt.useState(null),[D,O]=kt.useState(null),[U,F]=kt.useState(null),[z,B]=kt.useState(null),H=kt.useCallback(()=>{console.log("[ImageDropZone] handleCropClick called, value:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] originalImage exists:",!!R),n&&!R&&(console.log("[ImageDropZone] Storing original image"),L(n)),N("crop"),P(!0)},[n,R]),V=kt.useCallback(()=>{console.log("[ImageDropZone] handleMaskClick called, value:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] originalImage exists:",!!R),n&&!R&&(console.log("[ImageDropZone] Storing original image"),L(n)),N("mask"),P(!0)},[n,R]),G=kt.useCallback(()=>{console.log("[ImageDropZone] handlePaintClick called, value:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] originalImage exists:",!!R),n&&!R&&(console.log("[ImageDropZone] Storing original image"),L(n)),N("paint"),P(!0)},[n,R]),W=kt.useCallback((e,t,n)=>new Promise(r=>{if(!t)return void r(e);const i=new Image;i.onload=()=>{const n=new Image;n.onload=()=>{const a=t.x*i.naturalWidth,o=t.y*i.naturalHeight,s=t.width*i.naturalWidth,l=t.height*i.naturalHeight,c=document.createElement("canvas");c.width=s,c.height=l;const u=c.getContext("2d");u?(u.drawImage(n,a,o,s,l,0,0,s,l),r(c.toDataURL("image/png"))):r(e)},n.src=e},i.src=n}),[]),$=kt.useCallback(async(t,n,i,a)=>{if(console.log("[ImageDropZone] handleCropMaskSave called"),console.log("[ImageDropZone] processedImage:",t?t.substring(0,50)+"...":"null"),console.log("[ImageDropZone] rawMaskData:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] rawPaintData:",a?a.substring(0,50)+"...":"null"),console.log("[ImageDropZone] newCropRect:",i),!(t||n||i||a))return console.log("[ImageDropZone] No changes detected, closing dialog"),void P(!1);if(void 0!==i&&F(i),void 0!==n)if(j(n),n&&R){const e=await W(n,i,R);B(e)}else B(n);void 0!==a&&O(a),t&&(console.log("[ImageDropZone] Calling onChange with processed image"),r(e,t)),P(!1)},[e,r,R,W]),X=kt.useCallback(()=>{P(!1)},[]),q=(null==n?void 0:n.startsWith("data:video"))?"video":f||"image",K=(()=>{switch(o){case"video":return{icon:"",text:u(d?"storyboard.mediaInput.dropVideoHere":"storyboard.mediaInput.dragVideoOrBrowse")};case"any":return{icon:"",text:u(d?"storyboard.mediaInput.dropMediaHere":"storyboard.mediaInput.dragImageVideoOrBrowse")};default:return{icon:"",text:u(d?"storyboard.mediaInput.dropImageHere":"storyboard.mediaInput.dragImageFromCanvasOrBrowse")}}})();return Ot.jsxs("div",{className:"image-drop-zone-container "+(s?"bypassed":""),children:[Ot.jsxs("div",{className:"image-drop-zone-header",children:[Ot.jsx("label",{className:"image-drop-zone-label",children:t}),l&&Ot.jsxs("label",{className:"bypass-toggle",title:u(s?"storyboard.mediaInput.enableThisInput":"storyboard.mediaInput.bypassThisInput"),children:[Ot.jsx("input",{type:"checkbox",checked:s,onChange:e=>l(e.target.checked)}),Ot.jsx("span",{className:"bypass-label",children:u(s?"storyboard.mediaInput.bypassed":"storyboard.mediaInput.active")})]})]}),s?Ot.jsx("div",{className:"image-drop-zone bypassed-placeholder",children:Ot.jsxs("div",{className:"bypassed-content",children:[Ot.jsx("div",{className:"bypassed-icon",children:""}),Ot.jsx("div",{className:"bypassed-text",children:u("storyboard.mediaInput.inputBypassed")}),Ot.jsx("div",{className:"bypassed-hint",children:u("storyboard.mediaInput.inputSkipped")})]})}):Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("div",{className:`image-drop-zone ${p?"drag-over":""} ${n?"has-image":""} ${a?"disabled":""}`,onDragEnter:x,onDragLeave:b,onDragOver:w,onDrop:M,children:n?Ot.jsxs("div",{className:"image-preview",children:["video"===q?Ot.jsx("video",{src:n,controls:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"contain"}}):Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("img",{src:n,alt:t,style:{opacity:I?0:1}}),I&&R&&Ot.jsx(ey,{originalImage:R,cropRect:U,displayMask:z})]}),Ot.jsxs("div",{className:"image-preview-actions",children:[Ot.jsx("button",{className:"image-action-btn crop-btn",onClick:H,disabled:a||"video"===q,title:u("storyboard.mediaInput.cropImage"),children:""}),Ot.jsx("button",{className:"image-action-btn mask-btn",onClick:V,disabled:a||"video"===q,title:u("storyboard.mediaInput.addMask"),children:""}),Ot.jsx("button",{className:"image-action-btn paint-btn",onClick:G,disabled:a||"video"===q,title:u("storyboard.mediaInput.paintOnImage"),children:""}),Ot.jsx("button",{className:"image-action-btn clear-btn",onClick:T,disabled:a,title:u("storyboard.mediaInput.removeMedia"),children:""})]})]}):Ot.jsxs("div",{className:"drop-placeholder",children:[Ot.jsx("div",{className:"drop-icon",children:K.icon}),Ot.jsx("div",{className:"drop-text",children:K.text}),Ot.jsx("div",{className:"drop-actions",children:Ot.jsx("button",{className:"browse-btn",onClick:C,disabled:a,children:u("storyboard.mediaInput.browse")})})]})}),Ot.jsx("input",{ref:v,type:"file",accept:y(),onChange:E,style:{display:"none"}})]}),k&&n&&Ot.jsx(Qv,{imageData:R||n,mode:A,initialMask:I,initialCrop:U,initialPaint:D,onSave:$,onCancel:X})]})}const ry=["front","front-right quarter","right side","back-right quarter","back","back-left quarter","left side","front-left quarter"],iy=["low-angle","eye-level","elevated","high-angle"],ay=["close-up","medium","wide"];function oy(e){return`<sks> ${e.direction} view ${e.height} shot ${e.size} shot`}function sy(e){return`${e.direction.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")} ${e.height.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("-")} ${e.size.charAt(0).toUpperCase()+e.size.slice(1)}`}const ly=function(){const e=[];for(const t of ry)for(const n of iy)for(const r of ay){const i=`${t.replace(/\s+/g,"-")}_${n}_${r}`,a=oy({direction:t,height:n,size:r}),o=sy({direction:t,height:n,size:r});e.push({id:i,direction:t,height:n,size:r,prompt:a,displayName:o})}return e}();function cy(e){const t=e.match(/^<sks>\s+([\w\s-]+?)\s+view\s+([\w-]+?)\s+shot\s+([\w-]+?)\s+shot/i);if(!t)return null;const[,n,r,i]=t,a=function(e){const t=e.replace(/-/g," ").replace(/\s+/g," ").trim(),n=ry.find(e=>{const n=e.toLowerCase();return t===n});return n||null}(n.toLowerCase().trim()),o=function(e){const t=iy.find(t=>t.toLowerCase()===e);return t||null}(r.toLowerCase().trim()),s=function(e){const t=ay.find(t=>t.toLowerCase()===e);return t||null}(i.toLowerCase().trim());return a&&o&&s?function(e,t,n){return ly.find(r=>r.direction===e&&r.height===t&&r.size===n)}(a,o,s)??null:null}function uy(e){return e.replace(/^<sks>\s+[\w\s-]+?\s+view\s+[\w-]+?\s+shot\s+[\w-]+?\s+shot\s*/i,"").trim()}
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const dy="162",hy=0,py=1,my=2,fy=0,gy=1,vy=2,yy=3,_y=0,xy=1,by=2,wy=100,Sy=101,My=102,Ey=200,Cy=201,Ty=202,ky=203,Py=204,Ay=205,Ny=206,Ry=207,Ly=208,Iy=209,jy=210,Dy=211,Oy=212,Uy=213,Fy=214,zy=301,By=302,Hy=306,Vy=1e3,Gy=1001,Wy=1002,$y=1003,Xy=1004,qy=1005,Ky=1006,Yy=1007,Zy=1008,Jy=1009,Qy=1012,e_=1013,t_=1014,n_=1015,r_=1016,i_=1020,a_=1023,o_=1026,s_=1027,l_=33776,c_=33777,u_=33778,d_=33779,h_=36492,p_="",m_="srgb",f_="srgb-linear",g_="display-p3",v_="display-p3-linear",y_="linear",__="srgb",x_="rec709",b_="p3",w_=7680,S_=512,M_=513,E_=514,C_=515,T_=516,k_=517,P_=518,A_=519,N_="300 es",R_=1035,L_=2e3,I_=2001;class j_{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const D_=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],O_=Math.PI/180,U_=180/Math.PI;function F_(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(D_[255&e]+D_[e>>8&255]+D_[e>>16&255]+D_[e>>24&255]+"-"+D_[255&t]+D_[t>>8&255]+"-"+D_[t>>16&15|64]+D_[t>>24&255]+"-"+D_[63&n|128]+D_[n>>8&255]+"-"+D_[n>>16&255]+D_[n>>24&255]+D_[255&r]+D_[r>>8&255]+D_[r>>16&255]+D_[r>>24&255]).toLowerCase()}function z_(e,t,n){return Math.max(t,Math.min(n,e))}function B_(e,t,n){return(1-n)*e+n*t}function H_(e){return!(e&e-1)&&0!==e}function V_(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function G_(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function W_(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const $_=O_;class X_{constructor(e=0,t=0){X_.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(z_(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class q_{constructor(e,t,n,r,i,a,o,s,l){q_.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,l)}set(e,t,n,r,i,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],m=r[0],f=r[3],g=r[6],v=r[1],y=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=a*m+o*v+s*x,i[3]=a*f+o*y+s*b,i[6]=a*g+o*_+s*w,i[1]=l*m+c*v+u*x,i[4]=l*f+c*y+u*b,i[7]=l*g+c*_+u*w,i[2]=d*m+h*v+p*x,i[5]=d*f+h*y+p*b,i[8]=d*g+h*_+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,d=o*s-c*i,h=l*i-a*s,p=t*u+n*d+r*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=u*m,e[1]=(r*l-c*n)*m,e[2]=(o*n-r*a)*m,e[3]=d*m,e[4]=(c*t-r*s)*m,e[5]=(r*i-o*t)*m,e[6]=h*m,e[7]=(n*s-l*t)*m,e[8]=(a*t-n*i)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){const s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(K_.makeScale(e,t)),this}rotate(e){return this.premultiply(K_.makeRotation(-e)),this}translate(e,t){return this.premultiply(K_.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const K_=new q_;function Y_(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function Z_(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function J_(){const e=Z_("canvas");return e.style.display="block",e}const Q_={};const ex=(new q_).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),tx=(new q_).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),nx={[f_]:{transfer:y_,primaries:x_,toReference:e=>e,fromReference:e=>e},[m_]:{transfer:__,primaries:x_,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[v_]:{transfer:y_,primaries:b_,toReference:e=>e.applyMatrix3(tx),fromReference:e=>e.applyMatrix3(ex)},[g_]:{transfer:__,primaries:b_,toReference:e=>e.convertSRGBToLinear().applyMatrix3(tx),fromReference:e=>e.applyMatrix3(ex).convertLinearToSRGB()}},rx=new Set([f_,v_]),ix={enabled:!0,_workingColorSpace:f_,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!rx.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=nx[t].toReference;return(0,nx[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return nx[e].primaries},getTransfer:function(e){return e===p_?y_:nx[e].transfer}};function ax(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ox(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let sx;class lx{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===sx&&(sx=Z_("canvas")),sx.width=e.width,sx.height=e.height;const n=sx.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=sx}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Z_("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*ax(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ax(t[e]/255)):t[e]=ax(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let cx=0;class ux{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:cx++}),this.uuid=F_(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(dx(r[t].image)):e.push(dx(r[t]))}else e=dx(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function dx(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?lx.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let hx=0;class px extends j_{constructor(e=px.DEFAULT_IMAGE,t=px.DEFAULT_MAPPING,n=1001,r=1001,i=1006,a=1008,o=1023,s=1009,l=px.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hx++}),this.uuid=F_(),this.name="",this.source=new ux(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new X_(0,0),this.repeat=new X_(1,1),this.center=new X_(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new q_,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Vy:e.x=e.x-Math.floor(e.x);break;case Gy:e.x=e.x<0?0:1;break;case Wy:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Vy:e.y=e.y-Math.floor(e.y);break;case Gy:e.y=e.y<0?0:1;break;case Wy:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}px.DEFAULT_IMAGE=null,px.DEFAULT_MAPPING=300,px.DEFAULT_ANISOTROPY=1;class mx{constructor(e=0,t=0,n=0,r=1){mx.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],d=s[1],h=s[5],p=s[9],m=s[2],f=s[6],g=s[10];if(Math.abs(c-d)<a&&Math.abs(u-m)<a&&Math.abs(p-f)<a){if(Math.abs(c+d)<o&&Math.abs(u+m)<o&&Math.abs(p+f)<o&&Math.abs(l+h+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(h+1)/2,v=(g+1)/2,y=(c+d)/4,_=(u+m)/4,x=(p+f)/4;return e>s&&e>v?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=_/n):s>v?s<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=y/r,i=x/r):v<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=_/i,r=x/i),this.set(n,r,i,t),this}let v=Math.sqrt((f-p)*(f-p)+(u-m)*(u-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(u-m)/v,this.z=(d-c)/v,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fx extends j_{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new mx(0,0,e,t),this.scissorTest=!1,this.viewport=new mx(0,0,e,t);const r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ky,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},n);const i=new px(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=i.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,r=e.textures.length;n<r;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ux(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class gx extends fx{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class vx extends px{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=$y,this.minFilter=$y,this.wrapR=Gy,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class yx extends px{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=$y,this.minFilter=$y,this.wrapR=Gy,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _x{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const d=i[a+0],h=i[a+1],p=i[a+2],m=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=m);if(u!==m||s!==d||l!==h||c!==p){let e=1-o;const t=s*d+l*h+c*p+u*m,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,o=Math.sin(o*a)/i}const i=o*n;if(s=s*e+d*i,l=l*e+h*i,c=c*e+p*i,u=u*e+m*i,e===1-o){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const o=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[a],d=i[a+1],h=i[a+2],p=i[a+3];return e[t]=o*p+c*u+s*h-l*d,e[t+1]=s*p+c*d+l*u-o*h,e[t+2]=l*p+c*h+o*d-s*u,e[t+3]=c*p-o*u-s*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),d=s(n/2),h=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+o+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(z_(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+r*l-i*s,this._y=r*c+a*s+i*o-n*l,this._z=i*c+a*l+n*s-r*o,this._w=a*c-n*o-r*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*u+this._w*d,this._x=n*u+this._x*d,this._y=r*u+this._y*d,this._z=i*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class xx{constructor(e=0,t=0,n=0){xx.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(wx.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(wx.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=2*(a*r-o*n),c=2*(o*t-i*r),u=2*(i*n-a*t);return this.x=t+s*l+a*u-o*c,this.y=n+s*c+o*l-i*u,this.z=r+s*u+i*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return bx.copy(this).projectOnVector(e),this.sub(bx)}reflect(e){return this.sub(bx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(z_(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const bx=new xx,wx=new _x;class Sx{constructor(e=new xx(1/0,1/0,1/0),t=new xx(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Ex.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Ex.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ex.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Ex):Ex.fromBufferAttribute(r,t),Ex.applyMatrix4(e.matrixWorld),this.expandByPoint(Ex);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Cx.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Cx.copy(n.boundingBox)),Cx.applyMatrix4(e.matrixWorld),this.union(Cx)}const r=e.children;for(let i=0,a=r.length;i<a;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ex),Ex.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Lx),Ix.subVectors(this.max,Lx),Tx.subVectors(e.a,Lx),kx.subVectors(e.b,Lx),Px.subVectors(e.c,Lx),Ax.subVectors(kx,Tx),Nx.subVectors(Px,kx),Rx.subVectors(Tx,Px);let t=[0,-Ax.z,Ax.y,0,-Nx.z,Nx.y,0,-Rx.z,Rx.y,Ax.z,0,-Ax.x,Nx.z,0,-Nx.x,Rx.z,0,-Rx.x,-Ax.y,Ax.x,0,-Nx.y,Nx.x,0,-Rx.y,Rx.x,0];return!!Ox(t,Tx,kx,Px,Ix)&&(t=[1,0,0,0,1,0,0,0,1],!!Ox(t,Tx,kx,Px,Ix)&&(jx.crossVectors(Ax,Nx),t=[jx.x,jx.y,jx.z],Ox(t,Tx,kx,Px,Ix)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ex).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Ex).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Mx[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Mx[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Mx[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Mx[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Mx[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Mx[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Mx[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Mx[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Mx)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Mx=[new xx,new xx,new xx,new xx,new xx,new xx,new xx,new xx],Ex=new xx,Cx=new Sx,Tx=new xx,kx=new xx,Px=new xx,Ax=new xx,Nx=new xx,Rx=new xx,Lx=new xx,Ix=new xx,jx=new xx,Dx=new xx;function Ox(e,t,n,r,i){for(let a=0,o=e.length-3;a<=o;a+=3){Dx.fromArray(e,a);const o=i.x*Math.abs(Dx.x)+i.y*Math.abs(Dx.y)+i.z*Math.abs(Dx.z),s=t.dot(Dx),l=n.dot(Dx),c=r.dot(Dx);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const Ux=new Sx,Fx=new xx,zx=new xx;class Bx{constructor(e=new xx,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ux.setFromPoints(e).getCenter(n);let r=0;for(let i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Fx.subVectors(e,this.center);const t=Fx.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Fx,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(zx.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Fx.copy(e.center).add(zx)),this.expandByPoint(Fx.copy(e.center).sub(zx))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Hx=new xx,Vx=new xx,Gx=new xx,Wx=new xx,$x=new xx,Xx=new xx,qx=new xx;class Kx{constructor(e=new xx,t=new xx(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Hx)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Hx.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Hx.copy(this.origin).addScaledVector(this.direction,t),Hx.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Vx.copy(e).add(t).multiplyScalar(.5),Gx.copy(t).sub(e).normalize(),Wx.copy(this.origin).sub(Vx);const i=.5*e.distanceTo(t),a=-this.direction.dot(Gx),o=Wx.dot(this.direction),s=-Wx.dot(Gx),l=Wx.lengthSq(),c=Math.abs(1-a*a);let u,d,h,p;if(c>0)if(u=a*s-o,d=a*o-s,p=i*c,u>=0)if(d>=-p)if(d<=p){const e=1/c;u*=e,d*=e,h=u*(u+a*d+2*o)+d*(a*u+d+2*s)+l}else d=i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d=-i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d<=-p?(u=Math.max(0,-(-a*i+o)),d=u>0?-i:Math.min(Math.max(-i,-s),i),h=-u*u+d*(d+2*s)+l):d<=p?(u=0,d=Math.min(Math.max(-i,-s),i),h=d*(d+2*s)+l):(u=Math.max(0,-(a*i+o)),d=u>0?i:Math.min(Math.max(-i,-s),i),h=-u*u+d*(d+2*s)+l);else d=a>0?-i:i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(Vx).addScaledVector(Gx,d),h}intersectSphere(e,t){Hx.subVectors(e.center,this.origin);const n=Hx.dot(this.direction),r=Hx.dot(Hx)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),c>=0?(i=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(i=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(o=(e.min.z-d.z)*u,s=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,s=(e.min.z-d.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Hx)}intersectTriangle(e,t,n,r,i){$x.subVectors(t,e),Xx.subVectors(n,e),qx.crossVectors($x,Xx);let a,o=this.direction.dot(qx);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Wx.subVectors(this.origin,e);const s=a*this.direction.dot(Xx.crossVectors(Wx,Xx));if(s<0)return null;const l=a*this.direction.dot($x.cross(Wx));if(l<0)return null;if(s+l>o)return null;const c=-a*Wx.dot(qx);return c<0?null:this.at(c/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Yx{constructor(e,t,n,r,i,a,o,s,l,c,u,d,h,p,m,f){Yx.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,l,c,u,d,h,p,m,f)}set(e,t,n,r,i,a,o,s,l,c,u,d,h,p,m,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Yx).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Zx.setFromMatrixColumn(e,0).length(),i=1/Zx.setFromMatrixColumn(e,1).length(),a=1/Zx.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-o*s,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e+i*o,t[4]=r*o-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e-i*o,t[4]=-a*u,t[8]=r+n*o,t[1]=n+r*o,t[5]=a*c,t[9]=i-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=s*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=o*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Qx,e,eb)}lookAt(e,t,n){const r=this.elements;return rb.subVectors(e,t),0===rb.lengthSq()&&(rb.z=1),rb.normalize(),tb.crossVectors(n,rb),0===tb.lengthSq()&&(1===Math.abs(n.z)?rb.x+=1e-4:rb.z+=1e-4,rb.normalize(),tb.crossVectors(n,rb)),tb.normalize(),nb.crossVectors(rb,tb),r[0]=tb.x,r[4]=nb.x,r[8]=rb.x,r[1]=tb.y,r[5]=nb.y,r[9]=rb.y,r[2]=tb.z,r[6]=nb.z,r[10]=rb.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],m=n[6],f=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],M=r[12],E=r[1],C=r[5],T=r[9],k=r[13],P=r[2],A=r[6],N=r[10],R=r[14],L=r[3],I=r[7],j=r[11],D=r[15];return i[0]=a*b+o*E+s*P+l*L,i[4]=a*w+o*C+s*A+l*I,i[8]=a*S+o*T+s*N+l*j,i[12]=a*M+o*k+s*R+l*D,i[1]=c*b+u*E+d*P+h*L,i[5]=c*w+u*C+d*A+h*I,i[9]=c*S+u*T+d*N+h*j,i[13]=c*M+u*k+d*R+h*D,i[2]=p*b+m*E+f*P+g*L,i[6]=p*w+m*C+f*A+g*I,i[10]=p*S+m*T+f*N+g*j,i[14]=p*M+m*k+f*R+g*D,i[3]=v*b+y*E+_*P+x*L,i[7]=v*w+y*C+_*A+x*I,i[11]=v*S+y*T+_*N+x*j,i[15]=v*M+y*k+_*R+x*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+i*s*u-r*l*u-i*o*d+n*l*d+r*o*h-n*s*h)+e[7]*(+t*s*h-t*l*d+i*a*d-r*a*h+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*h-i*a*u+n*a*h+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*d+r*a*u-n*a*d+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],m=e[13],f=e[14],g=e[15],v=u*f*l-m*d*l+m*s*h-o*f*h-u*s*g+o*d*g,y=p*d*l-c*f*l-p*s*h+a*f*h+c*s*g-a*d*g,_=c*m*l-p*u*l+p*o*h-a*m*h-c*o*g+a*u*g,x=p*u*s-c*m*s-p*o*d+a*m*d+c*o*f-a*u*f,b=t*v+n*y+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=v*w,e[1]=(m*d*i-u*f*i-m*r*h+n*f*h+u*r*g-n*d*g)*w,e[2]=(o*f*i-m*s*i+m*r*l-n*f*l-o*r*g+n*s*g)*w,e[3]=(u*s*i-o*d*i-u*r*l+n*d*l+o*r*h-n*s*h)*w,e[4]=y*w,e[5]=(c*f*i-p*d*i+p*r*h-t*f*h-c*r*g+t*d*g)*w,e[6]=(p*s*i-a*f*i-p*r*l+t*f*l+a*r*g-t*s*g)*w,e[7]=(a*d*i-c*s*i+c*r*l-t*d*l-a*r*h+t*s*h)*w,e[8]=_*w,e[9]=(p*u*i-c*m*i-p*n*h+t*m*h+c*n*g-t*u*g)*w,e[10]=(a*m*i-p*o*i+p*n*l-t*m*l-a*n*g+t*o*g)*w,e[11]=(c*o*i-a*u*i-c*n*l+t*u*l+a*n*h-t*o*h)*w,e[12]=x*w,e[13]=(c*m*r-p*u*r+p*n*d-t*m*d-c*n*f+t*u*f)*w,e[14]=(p*o*r-a*m*r-p*n*s+t*m*s+a*n*f-t*o*f)*w,e[15]=(a*u*r-c*o*r+c*n*s-t*u*s-a*n*d+t*o*d)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+n,c*s-r*a,0,l*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,d=i*l,h=i*c,p=i*u,m=a*c,f=a*u,g=o*u,v=s*l,y=s*c,_=s*u,x=n.x,b=n.y,w=n.z;return r[0]=(1-(m+g))*x,r[1]=(h+_)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(h-_)*b,r[5]=(1-(d+g))*b,r[6]=(f+v)*b,r[7]=0,r[8]=(p+y)*w,r[9]=(f-v)*w,r[10]=(1-(d+m))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Zx.set(r[0],r[1],r[2]).length();const a=Zx.set(r[4],r[5],r[6]).length(),o=Zx.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Jx.copy(this);const s=1/i,l=1/a,c=1/o;return Jx.elements[0]*=s,Jx.elements[1]*=s,Jx.elements[2]*=s,Jx.elements[4]*=l,Jx.elements[5]*=l,Jx.elements[6]*=l,Jx.elements[8]*=c,Jx.elements[9]*=c,Jx.elements[10]*=c,t.setFromRotationMatrix(Jx),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a,o=2e3){const s=this.elements,l=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),d=(n+r)/(n-r);let h,p;if(o===L_)h=-(a+i)/(a-i),p=-2*a*i/(a-i);else{if(o!==I_)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);h=-a/(a-i),p=-a*i/(a-i)}return s[0]=l,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=c,s[9]=d,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,a,o=2e3){const s=this.elements,l=1/(t-e),c=1/(n-r),u=1/(a-i),d=(t+e)*l,h=(n+r)*c;let p,m;if(o===L_)p=(a+i)*u,m=-2*u;else{if(o!==I_)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*u,m=-1*u}return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-d,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=m,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Zx=new xx,Jx=new Yx,Qx=new xx(0,0,0),eb=new xx(1,1,1),tb=new xx,nb=new xx,rb=new xx,ib=new Yx,ab=new _x;class ob{constructor(e=0,t=0,n=0,r=ob.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],l=r[5],c=r[9],u=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(z_(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-z_(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(z_(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-z_(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(z_(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-z_(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ib.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ib,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ab.setFromEuler(this),this.setFromQuaternion(ab,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ob.DEFAULT_ORDER="XYZ";class sb{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let lb=0;const cb=new xx,ub=new _x,db=new Yx,hb=new xx,pb=new xx,mb=new xx,fb=new _x,gb=new xx(1,0,0),vb=new xx(0,1,0),yb=new xx(0,0,1),_b={type:"added"},xb={type:"removed"},bb={type:"childadded",child:null},wb={type:"childremoved",child:null};class Sb extends j_{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:lb++}),this.uuid=F_(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sb.DEFAULT_UP.clone();const e=new xx,t=new ob,n=new _x,r=new xx(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Yx},normalMatrix:{value:new q_}}),this.matrix=new Yx,this.matrixWorld=new Yx,this.matrixAutoUpdate=Sb.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Sb.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new sb,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ub.setFromAxisAngle(e,t),this.quaternion.multiply(ub),this}rotateOnWorldAxis(e,t){return ub.setFromAxisAngle(e,t),this.quaternion.premultiply(ub),this}rotateX(e){return this.rotateOnAxis(gb,e)}rotateY(e){return this.rotateOnAxis(vb,e)}rotateZ(e){return this.rotateOnAxis(yb,e)}translateOnAxis(e,t){return cb.copy(e).applyQuaternion(this.quaternion),this.position.add(cb.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gb,e)}translateY(e){return this.translateOnAxis(vb,e)}translateZ(e){return this.translateOnAxis(yb,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(db.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?hb.copy(e):hb.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),pb.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?db.lookAt(pb,hb,this.up):db.lookAt(hb,pb,this.up),this.quaternion.setFromRotationMatrix(db),r&&(db.extractRotation(r.matrixWorld),ub.setFromRotationMatrix(db),this.quaternion.premultiply(ub.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_b),bb.child=e,this.dispatchEvent(bb),bb.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(xb),wb.child=e,this.dispatchEvent(wb),wb.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),db.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),db.multiply(e.parent.matrixWorld)),e.applyMatrix4(db),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(pb,e,mb),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(pb,fb,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Sb.DEFAULT_UP=new xx(0,1,0),Sb.DEFAULT_MATRIX_AUTO_UPDATE=!0,Sb.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Mb=new xx,Eb=new xx,Cb=new xx,Tb=new xx,kb=new xx,Pb=new xx,Ab=new xx,Nb=new xx,Rb=new xx,Lb=new xx;class Ib{constructor(e=new xx,t=new xx,n=new xx){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Mb.subVectors(e,t),r.cross(Mb);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Mb.subVectors(r,t),Eb.subVectors(n,t),Cb.subVectors(e,t);const a=Mb.dot(Mb),o=Mb.dot(Eb),s=Mb.dot(Cb),l=Eb.dot(Eb),c=Eb.dot(Cb),u=a*l-o*o;if(0===u)return i.set(0,0,0),null;const d=1/u,h=(l*s-o*c)*d,p=(a*c-o*s)*d;return i.set(1-h-p,p,h)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,Tb)&&(Tb.x>=0&&Tb.y>=0&&Tb.x+Tb.y<=1)}static getInterpolation(e,t,n,r,i,a,o,s){return null===this.getBarycoord(e,t,n,r,Tb)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(i,Tb.x),s.addScaledVector(a,Tb.y),s.addScaledVector(o,Tb.z),s)}static isFrontFacing(e,t,n,r){return Mb.subVectors(n,t),Eb.subVectors(e,t),Mb.cross(Eb).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Mb.subVectors(this.c,this.b),Eb.subVectors(this.a,this.b),.5*Mb.cross(Eb).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ib.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ib.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return Ib.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Ib.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ib.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,o;kb.subVectors(r,n),Pb.subVectors(i,n),Nb.subVectors(e,n);const s=kb.dot(Nb),l=Pb.dot(Nb);if(s<=0&&l<=0)return t.copy(n);Rb.subVectors(e,r);const c=kb.dot(Rb),u=Pb.dot(Rb);if(c>=0&&u<=c)return t.copy(r);const d=s*u-c*l;if(d<=0&&s>=0&&c<=0)return a=s/(s-c),t.copy(n).addScaledVector(kb,a);Lb.subVectors(e,i);const h=kb.dot(Lb),p=Pb.dot(Lb);if(p>=0&&h<=p)return t.copy(i);const m=h*l-s*p;if(m<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(Pb,o);const f=c*p-h*u;if(f<=0&&u-c>=0&&h-p>=0)return Ab.subVectors(i,r),o=(u-c)/(u-c+(h-p)),t.copy(r).addScaledVector(Ab,o);const g=1/(f+m+d);return a=m*g,o=d*g,t.copy(n).addScaledVector(kb,a).addScaledVector(Pb,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const jb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Db={h:0,s:0,l:0},Ob={h:0,s:0,l:0};function Ub(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Fb{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=m_){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ix.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=ix.workingColorSpace){return this.r=e,this.g=t,this.b=n,ix.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=ix.workingColorSpace){var i;if(e=(e%(i=1)+i)%i,t=z_(t,0,1),n=z_(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ub(i,r,e+1/3),this.g=Ub(i,r,e),this.b=Ub(i,r,e-1/3)}return ix.toWorkingColorSpace(this,r),this}setStyle(e,t=m_){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=m_){const n=jb[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ax(e.r),this.g=ax(e.g),this.b=ax(e.b),this}copyLinearToSRGB(e){return this.r=ox(e.r),this.g=ox(e.g),this.b=ox(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=m_){return ix.fromWorkingColorSpace(zb.copy(this),e),65536*Math.round(z_(255*zb.r,0,255))+256*Math.round(z_(255*zb.g,0,255))+Math.round(z_(255*zb.b,0,255))}getHexString(e=m_){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ix.workingColorSpace){ix.fromWorkingColorSpace(zb.copy(this),t);const n=zb.r,r=zb.g,i=zb.b,a=Math.max(n,r,i),o=Math.min(n,r,i);let s,l;const c=(o+a)/2;if(o===a)s=0,l=0;else{const e=a-o;switch(l=c<=.5?e/(a+o):e/(2-a-o),a){case n:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-n)/e+2;break;case i:s=(n-r)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e,t=ix.workingColorSpace){return ix.fromWorkingColorSpace(zb.copy(this),t),e.r=zb.r,e.g=zb.g,e.b=zb.b,e}getStyle(e=m_){ix.fromWorkingColorSpace(zb.copy(this),e);const t=zb.r,n=zb.g,r=zb.b;return e!==m_?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(Db),this.setHSL(Db.h+e,Db.s+t,Db.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Db),e.getHSL(Ob);const n=B_(Db.h,Ob.h,t),r=B_(Db.s,Ob.s,t),i=B_(Db.l,Ob.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const zb=new Fb;Fb.NAMES=jb;let Bb=0;class Hb extends j_{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Bb++}),this.uuid=F_(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=wy,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Fb(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=w_,this.stencilZFail=w_,this.stencilZPass=w_,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==wy&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==w_&&(n.stencilFail=this.stencilFail),this.stencilZFail!==w_&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==w_&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Vb extends Hb{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Fb(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ob,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Gb=new xx,Wb=new X_;class $b{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=n_,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){var e;return(e="THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead.")in Q_||(Q_[e]=!0,console.warn(e)),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Wb.fromBufferAttribute(this,t),Wb.applyMatrix3(e),this.setXY(t,Wb.x,Wb.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Gb.fromBufferAttribute(this,t),Gb.applyMatrix3(e),this.setXYZ(t,Gb.x,Gb.y,Gb.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Gb.fromBufferAttribute(this,t),Gb.applyMatrix4(e),this.setXYZ(t,Gb.x,Gb.y,Gb.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Gb.fromBufferAttribute(this,t),Gb.applyNormalMatrix(e),this.setXYZ(t,Gb.x,Gb.y,Gb.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Gb.fromBufferAttribute(this,t),Gb.transformDirection(e),this.setXYZ(t,Gb.x,Gb.y,Gb.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=G_(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=W_(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=G_(t,this.array)),t}setX(e,t){return this.normalized&&(t=W_(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=G_(t,this.array)),t}setY(e,t){return this.normalized&&(t=W_(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=G_(t,this.array)),t}setZ(e,t){return this.normalized&&(t=W_(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=G_(t,this.array)),t}setW(e,t){return this.normalized&&(t=W_(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=W_(t,this.array),n=W_(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=W_(t,this.array),n=W_(n,this.array),r=W_(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=W_(t,this.array),n=W_(n,this.array),r=W_(r,this.array),i=W_(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class Xb extends $b{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class qb extends $b{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Kb extends $b{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Yb=0;const Zb=new Yx,Jb=new Sb,Qb=new xx,ew=new Sx,tw=new Sx,nw=new xx;class rw extends j_{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Yb++}),this.uuid=F_(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Y_(e)?qb:Xb)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new q_).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Zb.makeRotationFromQuaternion(e),this.applyMatrix4(Zb),this}rotateX(e){return Zb.makeRotationX(e),this.applyMatrix4(Zb),this}rotateY(e){return Zb.makeRotationY(e),this.applyMatrix4(Zb),this}rotateZ(e){return Zb.makeRotationZ(e),this.applyMatrix4(Zb),this}translate(e,t,n){return Zb.makeTranslation(e,t,n),this.applyMatrix4(Zb),this}scale(e,t,n){return Zb.makeScale(e,t,n),this.applyMatrix4(Zb),this}lookAt(e){return Jb.lookAt(e),Jb.updateMatrix(),this.applyMatrix4(Jb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qb).negate(),this.translate(Qb.x,Qb.y,Qb.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Kb(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Sx);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new xx(-1/0,-1/0,-1/0),new xx(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];ew.setFromBufferAttribute(e),this.morphTargetsRelative?(nw.addVectors(this.boundingBox.min,ew.min),this.boundingBox.expandByPoint(nw),nw.addVectors(this.boundingBox.max,ew.max),this.boundingBox.expandByPoint(nw)):(this.boundingBox.expandByPoint(ew.min),this.boundingBox.expandByPoint(ew.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Bx);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new xx,1/0);if(e){const n=this.boundingSphere.center;if(ew.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const n=t[e];tw.setFromBufferAttribute(n),this.morphTargetsRelative?(nw.addVectors(ew.min,tw.min),ew.expandByPoint(nw),nw.addVectors(ew.max,tw.max),ew.expandByPoint(nw)):(ew.expandByPoint(tw.min),ew.expandByPoint(tw.max))}ew.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)nw.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(nw));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)nw.fromBufferAttribute(a,t),o&&(Qb.fromBufferAttribute(e,t),nw.add(Qb)),r=Math.max(r,n.distanceToSquared(nw))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new $b(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let S=0;S<n.count;S++)o[S]=new xx,s[S]=new xx;const l=new xx,c=new xx,u=new xx,d=new X_,h=new X_,p=new X_,m=new xx,f=new xx;function g(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),d.fromBufferAttribute(i,e),h.fromBufferAttribute(i,t),p.fromBufferAttribute(i,r),c.sub(l),u.sub(l),h.sub(d),p.sub(d);const a=1/(h.x*p.y-p.x*h.y);isFinite(a)&&(m.copy(c).multiplyScalar(p.y).addScaledVector(u,-h.y).multiplyScalar(a),f.copy(u).multiplyScalar(h.x).addScaledVector(c,-p.x).multiplyScalar(a),o[e].add(m),o[t].add(m),o[r].add(m),s[e].add(f),s[t].add(f),s[r].add(f))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let S=0,M=v.length;S<M;++S){const t=v[S],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)g(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const y=new xx,_=new xx,x=new xx,b=new xx;function w(e){x.fromBufferAttribute(r,e),b.copy(x);const t=o[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),_.crossVectors(b,t);const n=_.dot(s[e])<0?-1:1;a.setXYZW(e,y.x,y.y,y.z,n)}for(let S=0,M=v.length;S<M;++S){const t=v[S],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)w(e.getX(r+0)),w(e.getX(r+1)),w(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new $b(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new xx,i=new xx,a=new xx,o=new xx,s=new xx,l=new xx,c=new xx,u=new xx;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,m),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,h),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),o.add(c),s.add(c),l.add(c),n.setXYZ(h,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)nw.fromBufferAttribute(e,t),nw.normalize(),e.setXYZ(t,nw.x,nw.y,nw.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let o=0,s=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*r;for(let e=0;e<r;e++)a[s++]=n[o++]}return new $b(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new rw,n=this.index.array,r=this.attributes;for(const o in r){const i=e(r[o],n);t.setAttribute(o,i)}const i=this.morphAttributes;for(const o in i){const r=[],a=i[o];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let i=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];n.push(i.toJSON(e.data))}n.length>0&&(r[s]=n,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const l in r){const e=r[l];this.setAttribute(l,e.clone(t))}const i=e.morphAttributes;for(const l in i){const e=[],n=i[l];for(let r=0,i=n.length;r<i;r++)e.push(n[r].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const iw=new Yx,aw=new Kx,ow=new Bx,sw=new xx,lw=new xx,cw=new xx,uw=new xx,dw=new xx,hw=new xx,pw=new X_,mw=new X_,fw=new X_,gw=new xx,vw=new xx,yw=new xx,_w=new xx,xw=new xx;class bw extends Sb{constructor(e=new rw,t=new Vb){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(i&&o){hw.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],s=i[n];0!==r&&(dw.fromBufferAttribute(s,e),a?hw.addScaledVector(dw,r):hw.addScaledVector(dw.sub(t),r))}t.add(hw)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),ow.copy(n.boundingSphere),ow.applyMatrix4(i),aw.copy(e.ray).recast(e.near),!1===ow.containsPoint(aw.origin)){if(null===aw.intersectSphere(ow,sw))return;if(aw.origin.distanceToSquared(sw)>(e.far-e.near)**2)return}iw.copy(i).invert(),aw.copy(e.ray).applyMatrix4(iw),null!==n.boundingBox&&!1===aw.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,aw)}}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,o=i.index,s=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,d=i.groups,h=i.drawRange;if(null!==o)if(Array.isArray(a))for(let p=0,m=d.length;p<m;p++){const i=d[p],s=a[i.materialIndex];for(let a=Math.max(i.start,h.start),d=Math.min(o.count,Math.min(i.start+i.count,h.start+h.count));a<d;a+=3){r=ww(this,s,e,n,l,c,u,o.getX(a),o.getX(a+1),o.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,h.start),s=Math.min(o.count,h.start+h.count);i<s;i+=3){r=ww(this,a,e,n,l,c,u,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==s)if(Array.isArray(a))for(let p=0,m=d.length;p<m;p++){const i=d[p],o=a[i.materialIndex];for(let a=Math.max(i.start,h.start),d=Math.min(s.count,Math.min(i.start+i.count,h.start+h.count));a<d;a+=3){r=ww(this,o,e,n,l,c,u,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,h.start),o=Math.min(s.count,h.start+h.count);i<o;i+=3){r=ww(this,a,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}}function ww(e,t,n,r,i,a,o,s,l,c){e.getVertexPosition(s,lw),e.getVertexPosition(l,cw),e.getVertexPosition(c,uw);const u=function(e,t,n,r,i,a,o,s){let l;if(l=1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,0===t.side,s),null===l)return null;xw.copy(s),xw.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(xw);return c<n.near||c>n.far?null:{distance:c,point:xw.clone(),object:e}}(e,t,n,r,lw,cw,uw,_w);if(u){i&&(pw.fromBufferAttribute(i,s),mw.fromBufferAttribute(i,l),fw.fromBufferAttribute(i,c),u.uv=Ib.getInterpolation(_w,lw,cw,uw,pw,mw,fw,new X_)),a&&(pw.fromBufferAttribute(a,s),mw.fromBufferAttribute(a,l),fw.fromBufferAttribute(a,c),u.uv1=Ib.getInterpolation(_w,lw,cw,uw,pw,mw,fw,new X_)),o&&(gw.fromBufferAttribute(o,s),vw.fromBufferAttribute(o,l),yw.fromBufferAttribute(o,c),u.normal=Ib.getInterpolation(_w,lw,cw,uw,gw,vw,yw,new xx),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a:s,b:l,c:c,normal:new xx,materialIndex:0};Ib.getNormal(lw,cw,uw,e.normal),u.face=e}return u}class Sw extends rw{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const o=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const s=[],l=[],c=[],u=[];let d=0,h=0;function p(e,t,n,r,i,a,p,m,f,g,v){const y=a/f,_=p/g,x=a/2,b=p/2,w=m/2,S=f+1,M=g+1;let E=0,C=0;const T=new xx;for(let o=0;o<M;o++){const a=o*_-b;for(let s=0;s<S;s++){const d=s*y-x;T[e]=d*r,T[t]=a*i,T[n]=w,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=m>0?1:-1,c.push(T.x,T.y,T.z),u.push(s/f),u.push(1-o/g),E+=1}}for(let o=0;o<g;o++)for(let e=0;e<f;e++){const t=d+e+S*o,n=d+e+S*(o+1),r=d+(e+1)+S*(o+1),i=d+(e+1)+S*o;s.push(t,n,i),s.push(n,r,i),C+=6}o.addGroup(h,C,v),h+=C,d+=E}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new Kb(l,3)),this.setAttribute("normal",new Kb(c,3)),this.setAttribute("uv",new Kb(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sw(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Mw(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Ew(e){const t={};for(let n=0;n<e.length;n++){const r=Mw(e[n]);for(const e in r)t[e]=r[e]}return t}function Cw(e){return null===e.getRenderTarget()?e.outputColorSpace:ix.workingColorSpace}const Tw={clone:Mw,merge:Ew};class kw extends Hb{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Mw(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Pw extends Sb{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yx,this.projectionMatrix=new Yx,this.projectionMatrixInverse=new Yx,this.coordinateSystem=L_}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Aw=new xx,Nw=new X_,Rw=new X_;class Lw extends Pw{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*U_*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*O_*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*U_*Math.atan(Math.tan(.5*O_*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Aw.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Aw.x,Aw.y).multiplyScalar(-e/Aw.z),Aw.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Aw.x,Aw.y).multiplyScalar(-e/Aw.z)}getViewSize(e,t){return this.getViewBounds(e,Nw,Rw),t.subVectors(Rw,Nw)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*O_*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Iw=-90;class jw extends Sb{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Lw(Iw,1,e,t);r.layers=this.layers,this.add(r);const i=new Lw(Iw,1,e,t);i.layers=this.layers,this.add(i);const a=new Lw(Iw,1,e,t);a.layers=this.layers,this.add(a);const o=new Lw(Iw,1,e,t);o.layers=this.layers,this.add(o);const s=new Lw(Iw,1,e,t);s.layers=this.layers,this.add(s);const l=new Lw(Iw,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,o,s]=t;for(const l of t)this.remove(l);if(e===L_)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==I_)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,o,s,l,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,o),e.setRenderTarget(n,3,r),e.render(t,s),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,d,h),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Dw extends px{constructor(e,t,n,r,i,a,o,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:zy,n,r,i,a,o,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ow extends gx{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new Dw(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Ky}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Sw(5,5,5),i=new kw({name:"CubemapFromEquirect",uniforms:Mw(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const a=new bw(r,i),o=t.minFilter;t.minFilter===Zy&&(t.minFilter=Ky);return new jw(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}const Uw=new xx,Fw=new xx,zw=new q_;class Bw{constructor(e=new xx(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Uw.subVectors(n,t).cross(Fw.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Uw),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||zw.getNormalMatrix(e),r=this.coplanarPoint(Uw).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Hw=new Bx,Vw=new xx;class Gw{constructor(e=new Bw,t=new Bw,n=new Bw,r=new Bw,i=new Bw,a=new Bw){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],d=r[7],h=r[8],p=r[9],m=r[10],f=r[11],g=r[12],v=r[13],y=r[14],_=r[15];if(n[0].setComponents(s-i,d-l,f-h,_-g).normalize(),n[1].setComponents(s+i,d+l,f+h,_+g).normalize(),n[2].setComponents(s+a,d+c,f+p,_+v).normalize(),n[3].setComponents(s-a,d-c,f-p,_-v).normalize(),n[4].setComponents(s-o,d-u,f-m,_-y).normalize(),t===L_)n[5].setComponents(s+o,d+u,f+m,_+y).normalize();else{if(t!==I_)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,u,m,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Hw.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Hw.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Hw)}intersectsSprite(e){return Hw.center.set(0,0,0),Hw.radius=.7071067811865476,Hw.applyMatrix4(e.matrixWorld),this.intersectsSphere(Hw)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Vw.x=r.normal.x>0?e.max.x:e.min.x,Vw.y=r.normal.y>0?e.max.y:e.min.y,Vw.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Vw)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ww(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function $w(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=r.get(t);if(void 0===a)r.set(t,function(t,r){const i=t.array,a=t.usage,o=i.byteLength,s=e.createBuffer();let l;if(e.bindBuffer(r,s),e.bufferData(r,i,a),t.onUploadCallback(),i instanceof Float32Array)l=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=e.HALF_FLOAT}else l=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=e.SHORT;else if(i instanceof Uint32Array)l=e.UNSIGNED_INT;else if(i instanceof Int32Array)l=e.INT;else if(i instanceof Int8Array)l=e.BYTE;else if(i instanceof Uint8Array)l=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);l=e.UNSIGNED_BYTE}return{buffer:s,type:l,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:o}}(t,i));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,r,i){const a=r.array,o=r._updateRange,s=r.updateRanges;if(e.bindBuffer(i,t),-1===o.count&&0===s.length&&e.bufferSubData(i,0,a),0!==s.length){for(let t=0,r=s.length;t<r;t++){const r=s[t];n?e.bufferSubData(i,r.start*a.BYTES_PER_ELEMENT,a,r.start,r.count):e.bufferSubData(i,r.start*a.BYTES_PER_ELEMENT,a.subarray(r.start,r.start+r.count))}r.clearUpdateRanges()}-1!==o.count&&(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}(a.buffer,t,i),a.version=t.version}}}}class Xw extends rw{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),l=o+1,c=s+1,u=e/o,d=t/s,h=[],p=[],m=[],f=[];for(let g=0;g<c;g++){const e=g*d-a;for(let t=0;t<l;t++){const n=t*u-i;p.push(n,-e,0),m.push(0,0,1),f.push(t/o),f.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+l*g,n=e+l*(g+1),r=e+1+l*(g+1),i=e+1+l*g;h.push(t,n,i),h.push(n,r,i)}this.setIndex(h),this.setAttribute("position",new Kb(p,3)),this.setAttribute("normal",new Kb(m,3)),this.setAttribute("uv",new Kb(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xw(e.width,e.height,e.widthSegments,e.heightSegments)}}const qw={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tfloat startCompression = 0.8 - 0.04;\n\tfloat desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min(color.r, min(color.g, color.b));\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max(color.r, max(color.g, color.b));\n\tif (peak < startCompression) return color;\n\tfloat d = 1. - startCompression;\n\tfloat newPeak = 1. - d * d / (peak + d - startCompression);\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);\n\treturn mix(color, vec3(1, 1, 1), g);\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Kw={common:{diffuse:{value:new Fb(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new q_},alphaMap:{value:null},alphaMapTransform:{value:new q_},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new q_}},envmap:{envMap:{value:null},envMapRotation:{value:new q_},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new q_}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new q_}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new q_},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new q_},normalScale:{value:new X_(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new q_},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new q_}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new q_}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new q_}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Fb(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Fb(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new q_},alphaTest:{value:0},uvTransform:{value:new q_}},sprite:{diffuse:{value:new Fb(16777215)},opacity:{value:1},center:{value:new X_(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new q_},alphaMap:{value:null},alphaMapTransform:{value:new q_},alphaTest:{value:0}}},Yw={basic:{uniforms:Ew([Kw.common,Kw.specularmap,Kw.envmap,Kw.aomap,Kw.lightmap,Kw.fog]),vertexShader:qw.meshbasic_vert,fragmentShader:qw.meshbasic_frag},lambert:{uniforms:Ew([Kw.common,Kw.specularmap,Kw.envmap,Kw.aomap,Kw.lightmap,Kw.emissivemap,Kw.bumpmap,Kw.normalmap,Kw.displacementmap,Kw.fog,Kw.lights,{emissive:{value:new Fb(0)}}]),vertexShader:qw.meshlambert_vert,fragmentShader:qw.meshlambert_frag},phong:{uniforms:Ew([Kw.common,Kw.specularmap,Kw.envmap,Kw.aomap,Kw.lightmap,Kw.emissivemap,Kw.bumpmap,Kw.normalmap,Kw.displacementmap,Kw.fog,Kw.lights,{emissive:{value:new Fb(0)},specular:{value:new Fb(1118481)},shininess:{value:30}}]),vertexShader:qw.meshphong_vert,fragmentShader:qw.meshphong_frag},standard:{uniforms:Ew([Kw.common,Kw.envmap,Kw.aomap,Kw.lightmap,Kw.emissivemap,Kw.bumpmap,Kw.normalmap,Kw.displacementmap,Kw.roughnessmap,Kw.metalnessmap,Kw.fog,Kw.lights,{emissive:{value:new Fb(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qw.meshphysical_vert,fragmentShader:qw.meshphysical_frag},toon:{uniforms:Ew([Kw.common,Kw.aomap,Kw.lightmap,Kw.emissivemap,Kw.bumpmap,Kw.normalmap,Kw.displacementmap,Kw.gradientmap,Kw.fog,Kw.lights,{emissive:{value:new Fb(0)}}]),vertexShader:qw.meshtoon_vert,fragmentShader:qw.meshtoon_frag},matcap:{uniforms:Ew([Kw.common,Kw.bumpmap,Kw.normalmap,Kw.displacementmap,Kw.fog,{matcap:{value:null}}]),vertexShader:qw.meshmatcap_vert,fragmentShader:qw.meshmatcap_frag},points:{uniforms:Ew([Kw.points,Kw.fog]),vertexShader:qw.points_vert,fragmentShader:qw.points_frag},dashed:{uniforms:Ew([Kw.common,Kw.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qw.linedashed_vert,fragmentShader:qw.linedashed_frag},depth:{uniforms:Ew([Kw.common,Kw.displacementmap]),vertexShader:qw.depth_vert,fragmentShader:qw.depth_frag},normal:{uniforms:Ew([Kw.common,Kw.bumpmap,Kw.normalmap,Kw.displacementmap,{opacity:{value:1}}]),vertexShader:qw.meshnormal_vert,fragmentShader:qw.meshnormal_frag},sprite:{uniforms:Ew([Kw.sprite,Kw.fog]),vertexShader:qw.sprite_vert,fragmentShader:qw.sprite_frag},background:{uniforms:{uvTransform:{value:new q_},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qw.background_vert,fragmentShader:qw.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new q_}},vertexShader:qw.backgroundCube_vert,fragmentShader:qw.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qw.cube_vert,fragmentShader:qw.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qw.equirect_vert,fragmentShader:qw.equirect_frag},distanceRGBA:{uniforms:Ew([Kw.common,Kw.displacementmap,{referencePosition:{value:new xx},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qw.distanceRGBA_vert,fragmentShader:qw.distanceRGBA_frag},shadow:{uniforms:Ew([Kw.lights,Kw.fog,{color:{value:new Fb(0)},opacity:{value:1}}]),vertexShader:qw.shadow_vert,fragmentShader:qw.shadow_frag}};Yw.physical={uniforms:Ew([Yw.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new q_},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new q_},clearcoatNormalScale:{value:new X_(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new q_},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new q_},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new q_},sheen:{value:0},sheenColor:{value:new Fb(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new q_},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new q_},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new q_},transmissionSamplerSize:{value:new X_},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new q_},attenuationDistance:{value:0},attenuationColor:{value:new Fb(0)},specularColor:{value:new Fb(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new q_},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new q_},anisotropyVector:{value:new X_},anisotropyMap:{value:null},anisotropyMapTransform:{value:new q_}}]),vertexShader:qw.meshphysical_vert,fragmentShader:qw.meshphysical_frag};const Zw={r:0,b:0,g:0},Jw=new ob,Qw=new Yx;function eS(e,t,n,r,i,a,o){const s=new Fb(0);let l,c,u=!0===a?0:1,d=null,h=0,p=null;function m(t,n){t.getRGB(Zw,Cw(e)),r.buffers.color.setClear(Zw.r,Zw.g,Zw.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),u=t,m(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(s,u)},render:function(a,f){let g=!1,v=!0===f.isScene?f.background:null;if(v&&v.isTexture){v=(f.backgroundBlurriness>0?n:t).get(v)}null===v?m(s,u):v&&v.isColor&&(m(v,1),g=!0);const y=e.xr.getEnvironmentBlendMode();"additive"===y?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===y&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===Hy)?(void 0===c&&(c=new bw(new Sw(1,1,1),new kw({name:"BackgroundCubeMaterial",uniforms:Mw(Yw.backgroundCube.uniforms),vertexShader:Yw.backgroundCube.vertexShader,fragmentShader:Yw.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),Jw.copy(f.backgroundRotation),Jw.x*=-1,Jw.y*=-1,Jw.z*=-1,v.isCubeTexture&&!1===v.isRenderTargetTexture&&(Jw.y*=-1,Jw.z*=-1),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Qw.makeRotationFromEuler(Jw)),c.material.toneMapped=ix.getTransfer(v.colorSpace)!==__,d===v&&h===v.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=v,h=v.version,p=e.toneMapping),c.layers.enableAll(),a.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new bw(new Xw(2,2),new kw({name:"BackgroundMaterial",uniforms:Mw(Yw.background.uniforms),vertexShader:Yw.background.vertexShader,fragmentShader:Yw.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,l.material.toneMapped=ix.getTransfer(v.colorSpace)!==__,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),d===v&&h===v.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=v,h=v.version,p=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function tS(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},l=p(null);let c=l,u=!1;function d(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],r=[];for(let a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function m(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){g(e,0)}function g(n,i){const a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;if(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i}}function v(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,r,i,a,o,s){!0===s?e.vertexAttribIPointer(t,n,r,a,o):e.vertexAttribPointer(t,n,r,i,a,o)}function _(){x(),u=!0,c!==l&&(c=l,d(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,_,x){let b=!1;if(o){const t=function(t,n,i){const o=!0===i.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];void 0===u&&(u=p(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[o]=u);return u}(_,h,l);c!==t&&(c=t,d(c.object)),b=function(e,t,n,r){const i=c.attributes,a=t.attributes;let o=0;const s=n.getAttributes();for(const l in s){if(s[l].location>=0){const t=i[l];let n=a[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return c.attributesNum!==o||c.index!==r}(i,_,h,x),b&&function(e,t,n,r){const i={},a=t.attributes;let o=0;const s=n.getAttributes();for(const l in s){if(s[l].location>=0){let t=a[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),i[l]=n,o++}}c.attributes=i,c.attributesNum=o,c.index=r}(i,_,h,x)}else{const e=!0===l.wireframe;c.geometry===_.id&&c.program===h.id&&c.wireframe===e||(c.geometry=_.id,c.program=h.id,c.wireframe=e,b=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(b||u)&&(u=!1,function(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;m();const l=s.attributes,c=o.getAttributes(),u=a.defaultAttributeValues;for(const t in c){const a=c[t];if(a.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&i.instanceMatrix&&(o=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(o=i.instanceColor)),void 0!==o){const t=o.normalized,l=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,d=c.type,h=c.bytesPerElement,p=!0===r.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||o.gpuType===e_);if(o.isInterleavedBufferAttribute){const n=o.data,r=n.stride,c=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<a.locationSize;e++)f(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,r*h,(c+l/a.locationSize*e)*h,p)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,o.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<a.locationSize;e++)f(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,l*h,l/a.locationSize*e*h,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(a.location,n);break;case 3:e.vertexAttrib3fv(a.location,n);break;case 4:e.vertexAttrib4fv(a.location,n);break;default:e.vertexAttrib1fv(a.location,n)}}}}v()}(i,l,h,_),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:_,resetDefaultState:x,dispose:function(){_();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const n in t){const e=t[n];for(const t in e)h(e[t].object),delete e[t];delete t[n]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:v}}function nS(e,t,n,r){const i=r.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,o,s){if(0===s)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,r,o,s),n.update(o,a,s)},this.renderMultiDraw=function(e,r,i){if(0===i)return;const o=t.get("WEBGL_multi_draw");if(null===o)for(let t=0;t<i;t++)this.render(e[t],r[t]);else{o.multiDrawArraysWEBGL(a,e,0,r,0,i);let t=0;for(let e=0;e<i;e++)t+=r[e];n.update(t,a,1)}}}function rS(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==n.precision?n.precision:"highp";const s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,_=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function iS(e){const t=this;let n=null,r=0,i=!1,a=!1;const o=new Bw,s=new q_,l={value:null,needsUpdate:!1};function c(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=r;n!==a;++n,l+=4)o.copy(e[n]).applyMatrix4(i,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,s,u){const d=o.clippingPlanes,h=o.clipIntersection,p=o.clipShadows,m=e.get(o);if(!i||null===d||0===d.length||a&&!p)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=a?0:r,t=4*e;let i=m.clippingState||null;l.value=i,i=c(d,s,t,u);for(let r=0;r!==t;++r)i[r]=n[r];m.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function aS(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=zy:304===t&&(e.mapping=By),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(303===a||304===a){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const a=i.image;if(a&&a.height>0){const o=new Ow(a.height);return o.fromEquirectangularTexture(e,i),t.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class oS extends Pw{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const sS=[.125,.215,.35,.446,.526,.582],lS=20,cS=new oS,uS=new Fb;let dS=null,hS=0,pS=0;const mS=(1+Math.sqrt(5))/2,fS=1/mS,gS=[new xx(1,1,1),new xx(-1,1,1),new xx(1,1,-1),new xx(-1,1,-1),new xx(0,mS,fS),new xx(0,mS,-fS),new xx(fS,0,mS),new xx(-fS,0,mS),new xx(mS,fS,0),new xx(-mS,fS,0)];class vS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){dS=this._renderer.getRenderTarget(),hS=this._renderer.getActiveCubeFace(),pS=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=bS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=xS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(dS,hS,pS),e.scissorTest=!1,_S(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===zy||e.mapping===By?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),dS=this._renderer.getRenderTarget(),hS=this._renderer.getActiveCubeFace(),pS=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ky,minFilter:Ky,generateMipmaps:!1,type:r_,format:a_,colorSpace:f_,depthBuffer:!1},r=yS(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=yS(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+sS.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);n.push(a);let s=1/a;o>e-4?s=sS[o-e+4-1]:0===o&&(s=0),r.push(s);const l=1/(a-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,m=3,f=2,g=1,v=new Float32Array(m*p*h),y=new Float32Array(f*p*h),_=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,m*p*e),y.set(d,f*p*e);const i=[e,e,e,e,e,e];_.set(i,g*p*e)}const x=new rw;x.setAttribute("position",new $b(v,m)),x.setAttribute("uv",new $b(y,f)),x.setAttribute("faceIndex",new $b(_,g)),t.push(x),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(lS),i=new xx(0,1,0),a=new kw({name:"SphericalGaussianBlur",defines:{n:lS,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:wS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return a}(r,e,t)}return r}_compileMaterial(e){const t=new bw(this._lodPlanes[0],e);this._renderer.compile(t,cS)}_sceneToCubeUV(e,t,n,r){const i=new Lw(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.toneMapping;s.getClearColor(uS),s.toneMapping=0,s.autoClear=!1;const u=new Vb({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new bw(new Sw,u);let h=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,h=!0):(u.color.copy(uS),h=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(i.up.set(0,a[m],0),i.lookAt(o[m],0,0)):1===t?(i.up.set(0,0,a[m]),i.lookAt(0,o[m],0)):(i.up.set(0,a[m],0),i.lookAt(0,0,o[m]));const n=this._cubeSize;_S(r,t*n,m>2?n:0,n,n),s.setRenderTarget(r),h&&s.render(d,i),s.render(e,i)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===zy||e.mapping===By;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=bS()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=xS());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new bw(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const o=this._cubeSize;_S(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,cS)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=gS[(r-1)%gS.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new bw(this._lodPlanes[r],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,p=i/h,m=isFinite(i)?1+Math.floor(3*p):lS;m>lS&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let _=0;_<lS;++_){const e=_/p,t=Math.exp(-e*e/2);f.push(t),0===_?g+=t:_<m&&(g+=2*t)}for(let _=0;_<f.length;_++)f[_]=f[_]/g;u.envMap.value=e.texture,u.samples.value=m,u.weights.value=f,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=h,u.mipInt.value=v-n;const y=this._sizeLods[r];_S(t,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(c,cS)}}function yS(e,t,n){const r=new gx(e,t,n);return r.texture.mapping=Hy,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function _S(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function xS(){return new kw({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:wS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function bS(){return new kw({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:wS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function wS(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function SS(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,o=303===a||304===a,s=a===zy||a===By;if(o||s){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new vS(e)),r=o?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),r.texture}if(t.has(i))return t.get(i).texture;{const a=i.image;if(o&&a&&a.height>0||s&&a&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(a)){null===n&&(n=new vS(e));const a=o?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,a),i.addEventListener("dispose",r),a.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function MS(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?(n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance")):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ES(e,t,n,r){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);for(const n in s.morphAttributes){const e=s.morphAttributes[n];for(let n=0,r=e.length;n<r;n++)t.remove(e[n])}s.removeEventListener("dispose",o),delete i[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const s=new(Y_(n)?qb:Xb)(n,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const a in r)t.update(r[a],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const a in i){const n=i[a];for(let r=0,i=n.length;r<i;r++)t.update(n[r],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function CS(e,t,n,r){const i=r.isWebGL2;let a,o,s;this.setMode=function(e){a=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,o,t*s),n.update(r,a,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,d;if(i)u=e,d="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](a,l,o,r*s,c),n.update(l,a,c)},this.renderMultiDraw=function(e,r,i){if(0===i)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<i;t++)this.render(e[t]/s,r[t]);else{l.multiDrawElementsWEBGL(a,r,0,o,e,0,i);let t=0;for(let e=0;e<i;e++)t+=r[e];n.update(t,a,1)}}}function TS(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function kS(e,t){return e[0]-t[0]}function PS(e,t){return Math.abs(t[1])-Math.abs(e[1])}function AS(e,t,n){const r={},i=new Float32Array(8),a=new WeakMap,o=new mx,s=[];for(let l=0;l<8;l++)s[l]=[l,0];return{update:function(l,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const r=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,i=void 0!==r?r.length:0;let s=a.get(c);if(void 0===s||s.count!==i){let e=function(){v.dispose(),a.delete(c),c.removeEventListener("dispose",e)};void 0!==s&&s.texture.dispose();const n=void 0!==c.morphAttributes.position,r=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,u=c.morphAttributes.position||[],d=c.morphAttributes.normal||[],h=c.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===r&&(p=2),!0===l&&(p=3);let m=c.attributes.position.count*p,f=1;m>t.maxTextureSize&&(f=Math.ceil(m/t.maxTextureSize),m=t.maxTextureSize);const g=new Float32Array(m*f*4*i),v=new vx(g,m,f,i);v.type=n_,v.needsUpdate=!0;const y=4*p;for(let t=0;t<i;t++){const e=u[t],i=d[t],a=h[t],s=m*f*4*t;for(let t=0;t<e.count;t++){const c=t*y;!0===n&&(o.fromBufferAttribute(e,t),g[s+c+0]=o.x,g[s+c+1]=o.y,g[s+c+2]=o.z,g[s+c+3]=0),!0===r&&(o.fromBufferAttribute(i,t),g[s+c+4]=o.x,g[s+c+5]=o.y,g[s+c+6]=o.z,g[s+c+7]=0),!0===l&&(o.fromBufferAttribute(a,t),g[s+c+8]=o.x,g[s+c+9]=o.y,g[s+c+10]=o.z,g[s+c+11]=4===a.itemSize?o.w:1)}}s={count:i,texture:v,size:new X_(m,f)},a.set(c,s),c.addEventListener("dispose",e)}if(!0===l.isInstancedMesh&&null!==l.morphTexture)u.getUniforms().setValue(e,"morphTexture",l.morphTexture,n);else{let t=0;for(let e=0;e<d.length;e++)t+=d[e];const n=c.morphTargetsRelative?1:1-t;u.getUniforms().setValue(e,"morphTargetBaseInfluence",n),u.getUniforms().setValue(e,"morphTargetInfluences",d)}u.getUniforms().setValue(e,"morphTargetsTexture",s.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",s.size)}else{const t=void 0===d?0:d.length;let n=r[c.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];r[c.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=d[e]}n.sort(PS);for(let e=0;e<8;e++)e<t&&n[e][1]?(s[e][0]=n[e][0],s[e][1]=n[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(kS);const a=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=s[e],n=t[0],r=t[1];n!==Number.MAX_SAFE_INTEGER&&r?(a&&c.getAttribute("morphTarget"+e)!==a[n]&&c.setAttribute("morphTarget"+e,a[n]),o&&c.getAttribute("morphNormal"+e)!==o[n]&&c.setAttribute("morphNormal"+e,o[n]),i[e]=r,l+=r):(a&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),i[e]=0)}const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",h),u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function NS(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const s=r.render.frame,l=o.geometry,c=t.get(o,l);if(i.get(c)!==s&&(t.update(c),i.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),i.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),i.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;i.get(e)!==s&&(e.update(),i.set(e,s))}return c},dispose:function(){i=new WeakMap}}}class RS extends px{constructor(e,t,n,r,i,a,o,s,l,c){if((c=void 0!==c?c:o_)!==o_&&c!==s_)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===o_&&(n=t_),void 0===n&&c===s_&&(n=i_),super(null,r,i,a,o,s,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:$y,this.minFilter=void 0!==s?s:$y,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const LS=new px,IS=new RS(1,1);IS.compareFunction=515;const jS=new vx,DS=new yx,OS=new Dw,US=[],FS=[],zS=new Float32Array(16),BS=new Float32Array(9),HS=new Float32Array(4);function VS(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=US[i];if(void 0===a&&(a=new Float32Array(i),US[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function GS(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function WS(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function $S(e,t){let n=FS[t];void 0===n&&(n=new Int32Array(t),FS[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function XS(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function qS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(GS(n,t))return;e.uniform2fv(this.addr,t),WS(n,t)}}function KS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(GS(n,t))return;e.uniform3fv(this.addr,t),WS(n,t)}}function YS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(GS(n,t))return;e.uniform4fv(this.addr,t),WS(n,t)}}function ZS(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(GS(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),WS(n,t)}else{if(GS(n,r))return;HS.set(r),e.uniformMatrix2fv(this.addr,!1,HS),WS(n,r)}}function JS(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(GS(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),WS(n,t)}else{if(GS(n,r))return;BS.set(r),e.uniformMatrix3fv(this.addr,!1,BS),WS(n,r)}}function QS(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(GS(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),WS(n,t)}else{if(GS(n,r))return;zS.set(r),e.uniformMatrix4fv(this.addr,!1,zS),WS(n,r)}}function eM(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function tM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(GS(n,t))return;e.uniform2iv(this.addr,t),WS(n,t)}}function nM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(GS(n,t))return;e.uniform3iv(this.addr,t),WS(n,t)}}function rM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(GS(n,t))return;e.uniform4iv(this.addr,t),WS(n,t)}}function iM(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function aM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(GS(n,t))return;e.uniform2uiv(this.addr,t),WS(n,t)}}function oM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(GS(n,t))return;e.uniform3uiv(this.addr,t),WS(n,t)}}function sM(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(GS(n,t))return;e.uniform4uiv(this.addr,t),WS(n,t)}}function lM(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i);const a=this.type===e.SAMPLER_2D_SHADOW?IS:LS;n.setTexture2D(t||a,i)}function cM(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||DS,i)}function uM(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||OS,i)}function dM(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||jS,i)}function hM(e,t){e.uniform1fv(this.addr,t)}function pM(e,t){const n=VS(t,this.size,2);e.uniform2fv(this.addr,n)}function mM(e,t){const n=VS(t,this.size,3);e.uniform3fv(this.addr,n)}function fM(e,t){const n=VS(t,this.size,4);e.uniform4fv(this.addr,n)}function gM(e,t){const n=VS(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function vM(e,t){const n=VS(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function yM(e,t){const n=VS(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function _M(e,t){e.uniform1iv(this.addr,t)}function xM(e,t){e.uniform2iv(this.addr,t)}function bM(e,t){e.uniform3iv(this.addr,t)}function wM(e,t){e.uniform4iv(this.addr,t)}function SM(e,t){e.uniform1uiv(this.addr,t)}function MM(e,t){e.uniform2uiv(this.addr,t)}function EM(e,t){e.uniform3uiv(this.addr,t)}function CM(e,t){e.uniform4uiv(this.addr,t)}function TM(e,t,n){const r=this.cache,i=t.length,a=$S(n,i);GS(r,a)||(e.uniform1iv(this.addr,a),WS(r,a));for(let o=0;o!==i;++o)n.setTexture2D(t[o]||LS,a[o])}function kM(e,t,n){const r=this.cache,i=t.length,a=$S(n,i);GS(r,a)||(e.uniform1iv(this.addr,a),WS(r,a));for(let o=0;o!==i;++o)n.setTexture3D(t[o]||DS,a[o])}function PM(e,t,n){const r=this.cache,i=t.length,a=$S(n,i);GS(r,a)||(e.uniform1iv(this.addr,a),WS(r,a));for(let o=0;o!==i;++o)n.setTextureCube(t[o]||OS,a[o])}function AM(e,t,n){const r=this.cache,i=t.length,a=$S(n,i);GS(r,a)||(e.uniform1iv(this.addr,a),WS(r,a));for(let o=0;o!==i;++o)n.setTexture2DArray(t[o]||jS,a[o])}class NM{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return XS;case 35664:return qS;case 35665:return KS;case 35666:return YS;case 35674:return ZS;case 35675:return JS;case 35676:return QS;case 5124:case 35670:return eM;case 35667:case 35671:return tM;case 35668:case 35672:return nM;case 35669:case 35673:return rM;case 5125:return iM;case 36294:return aM;case 36295:return oM;case 36296:return sM;case 35678:case 36198:case 36298:case 36306:case 35682:return lM;case 35679:case 36299:case 36307:return cM;case 35680:case 36300:case 36308:case 36293:return uM;case 36289:case 36303:case 36311:case 36292:return dM}}(t.type)}}class RM{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return hM;case 35664:return pM;case 35665:return mM;case 35666:return fM;case 35674:return gM;case 35675:return vM;case 35676:return yM;case 5124:case 35670:return _M;case 35667:case 35671:return xM;case 35668:case 35672:return bM;case 35669:case 35673:return wM;case 5125:return SM;case 36294:return MM;case 36295:return EM;case 36296:return CM;case 35678:case 36198:case 36298:case 36306:case 35682:return TM;case 35679:case 36299:case 36307:return kM;case 35680:case 36300:case 36308:case 36293:return PM;case 36289:case 36303:case 36311:case 36292:return AM}}(t.type)}}class LM{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const IM=/(\w+)(\])?(\[|\.)?/g;function jM(e,t){e.seq.push(t),e.map[t.id]=t}function DM(e,t,n){const r=e.name,i=r.length;for(IM.lastIndex=0;;){const a=IM.exec(r),o=IM.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===i){jM(n,void 0===c?new NM(s,e,t):new RM(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new LM(s),jM(n,e)),n=e}}}class OM{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);DM(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function UM(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let FM=0;function zM(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push(`${e===t?">":" "} ${e}: ${n[o]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function BM(e,t){const n=function(e){const t=ix.getPrimaries(ix.workingColorSpace),n=ix.getPrimaries(e);let r;switch(t===n?r="":t===b_&&n===x_?r="LinearDisplayP3ToLinearSRGB":t===x_&&n===b_&&(r="LinearSRGBToLinearDisplayP3"),e){case f_:case v_:return[r,"LinearTransferOETF"];case m_:case g_:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function HM(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function VM(e){return""!==e}function GM(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function WM(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const $M=/^[ \t]*#include +<([\w\d./]+)>/gm;function XM(e){return e.replace($M,KM)}const qM=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function KM(e,t){let n=qw[t];if(void 0===n){const e=qM.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=qw[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return XM(n)}const YM=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ZM(e){return e.replace(YM,JM)}function JM(e,t,n,r){let i="";for(let a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function QM(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\t`;return e.isWebGL2&&(t+=`precision ${e.precision} sampler3D;\n\t\tprecision ${e.precision} sampler2DArray;\n\t\tprecision ${e.precision} sampler2DShadow;\n\t\tprecision ${e.precision} samplerCubeShadow;\n\t\tprecision ${e.precision} sampler2DArrayShadow;\n\t\tprecision ${e.precision} isampler2D;\n\t\tprecision ${e.precision} isampler3D;\n\t\tprecision ${e.precision} isamplerCube;\n\t\tprecision ${e.precision} isampler2DArray;\n\t\tprecision ${e.precision} usampler2D;\n\t\tprecision ${e.precision} usampler3D;\n\t\tprecision ${e.precision} usamplerCube;\n\t\tprecision ${e.precision} usampler2DArray;\n\t\t`),"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function eE(e,t,n,r){const i=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case zy:case By:t="ENVMAP_TYPE_CUBE";break;case Hy:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===By&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||e.alphaToCoverage||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(VM).join("\n")}(n),m=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(VM).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),g=i.createProgram();let v,y,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(VM).join("\n"),v.length>0&&(v+="\n"),y=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(VM).join("\n"),y.length>0&&(y+="\n")):(v=[QM(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(VM).join("\n"),y=[p,QM(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?qw.tonemapping_pars_fragment:"",0!==n.toneMapping?HM("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",qw.colorspace_pars_fragment,BM("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(VM).join("\n")),o=XM(o),o=GM(o,n),o=WM(o,n),s=XM(s),s=GM(s,n),s=WM(s,n),o=ZM(o),s=ZM(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",v=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,y=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===N_?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===N_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const x=_+v+o,b=_+y+s,w=UM(i,i.VERTEX_SHADER,x),S=UM(i,i.FRAGMENT_SHADER,b);function M(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(g).trim(),r=i.getShaderInfoLog(w).trim(),a=i.getShaderInfoLog(S).trim();let o=!0,s=!0;if(!1===i.getProgramParameter(g,i.LINK_STATUS))if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,g,w,S);else{const e=zM(i,w,"vertex"),r=zM(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==a||(s=!1);s&&(t.diagnostics={runnable:o,programLog:n,vertexShader:{log:r,prefix:v},fragmentShader:{log:a,prefix:y}})}i.deleteShader(w),i.deleteShader(S),E=new OM(i,g),C=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(i,g)}let E,C;i.attachShader(g,w),i.attachShader(g,S),void 0!==n.index0AttributeName?i.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g),this.getUniforms=function(){return void 0===E&&M(this),E},this.getAttributes=function(){return void 0===C&&M(this),C};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=i.getProgramParameter(g,37297)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=FM++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=S,this}let tE=0;class nE{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new rE(e),t.set(e,n)),n}}class rE{constructor(e){this.id=tE++,this.code=e,this.usedTimes=0}}function iE(e,t,n,r,i,a,o){const s=new sb,l=new nE,c=new Set,u=[],d=i.isWebGL2,h=i.logarithmicDepthBuffer,p=i.vertexTextures;let m=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,s,u,v,y){const _=v.fog,x=y.geometry,b=a.isMeshStandardMaterial?v.environment:null,w=(a.isMeshStandardMaterial?n:t).get(a.envMap||b),S=w&&w.mapping===Hy?w.image.height:null,M=f[a.type];null!==a.precision&&(m=i.getMaxPrecision(a.precision),m!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",m,"instead."));const E=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,C=void 0!==E?E.length:0;let T,k,P,A,N=0;if(void 0!==x.morphAttributes.position&&(N=1),void 0!==x.morphAttributes.normal&&(N=2),void 0!==x.morphAttributes.color&&(N=3),M){const e=Yw[M];T=e.vertexShader,k=e.fragmentShader}else T=a.vertexShader,k=a.fragmentShader,l.update(a),P=l.getVertexShaderID(a),A=l.getFragmentShaderID(a);const R=e.getRenderTarget(),L=!0===y.isInstancedMesh,I=!0===y.isBatchedMesh,j=!!a.map,D=!!a.matcap,O=!!w,U=!!a.aoMap,F=!!a.lightMap,z=!!a.bumpMap,B=!!a.normalMap,H=!!a.displacementMap,V=!!a.emissiveMap,G=!!a.metalnessMap,W=!!a.roughnessMap,$=a.anisotropy>0,X=a.clearcoat>0,q=a.iridescence>0,K=a.sheen>0,Y=a.transmission>0,Z=$&&!!a.anisotropyMap,J=X&&!!a.clearcoatMap,Q=X&&!!a.clearcoatNormalMap,ee=X&&!!a.clearcoatRoughnessMap,te=q&&!!a.iridescenceMap,ne=q&&!!a.iridescenceThicknessMap,re=K&&!!a.sheenColorMap,ie=K&&!!a.sheenRoughnessMap,ae=!!a.specularMap,oe=!!a.specularColorMap,se=!!a.specularIntensityMap,le=Y&&!!a.transmissionMap,ce=Y&&!!a.thicknessMap,ue=!!a.gradientMap,de=!!a.alphaMap,he=a.alphaTest>0,pe=!!a.alphaHash,me=!!a.extensions;let fe=0;a.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(fe=e.toneMapping));const ge={isWebGL2:d,shaderID:M,shaderType:a.type,shaderName:a.name,vertexShader:T,fragmentShader:k,defines:a.defines,customVertexShaderID:P,customFragmentShaderID:A,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:m,batching:I,instancing:L,instancingColor:L&&null!==y.instanceColor,instancingMorph:L&&null!==y.morphTexture,supportsVertexTextures:p,outputColorSpace:null===R?e.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:f_,alphaToCoverage:!!a.alphaToCoverage,map:j,matcap:D,envMap:O,envMapMode:O&&w.mapping,envMapCubeUVHeight:S,aoMap:U,lightMap:F,bumpMap:z,normalMap:B,displacementMap:p&&H,emissiveMap:V,normalMapObjectSpace:B&&1===a.normalMapType,normalMapTangentSpace:B&&0===a.normalMapType,metalnessMap:G,roughnessMap:W,anisotropy:$,anisotropyMap:Z,clearcoat:X,clearcoatMap:J,clearcoatNormalMap:Q,clearcoatRoughnessMap:ee,iridescence:q,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:K,sheenColorMap:re,sheenRoughnessMap:ie,specularMap:ae,specularColorMap:oe,specularIntensityMap:se,transmission:Y,transmissionMap:le,thicknessMap:ce,gradientMap:ue,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:de,alphaTest:he,alphaHash:pe,combine:a.combine,mapUv:j&&g(a.map.channel),aoMapUv:U&&g(a.aoMap.channel),lightMapUv:F&&g(a.lightMap.channel),bumpMapUv:z&&g(a.bumpMap.channel),normalMapUv:B&&g(a.normalMap.channel),displacementMapUv:H&&g(a.displacementMap.channel),emissiveMapUv:V&&g(a.emissiveMap.channel),metalnessMapUv:G&&g(a.metalnessMap.channel),roughnessMapUv:W&&g(a.roughnessMap.channel),anisotropyMapUv:Z&&g(a.anisotropyMap.channel),clearcoatMapUv:J&&g(a.clearcoatMap.channel),clearcoatNormalMapUv:Q&&g(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&g(a.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&g(a.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&g(a.iridescenceThicknessMap.channel),sheenColorMapUv:re&&g(a.sheenColorMap.channel),sheenRoughnessMapUv:ie&&g(a.sheenRoughnessMap.channel),specularMapUv:ae&&g(a.specularMap.channel),specularColorMapUv:oe&&g(a.specularColorMap.channel),specularIntensityMapUv:se&&g(a.specularIntensityMap.channel),transmissionMapUv:le&&g(a.transmissionMap.channel),thicknessMapUv:ce&&g(a.thicknessMap.channel),alphaMapUv:de&&g(a.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(B||$),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!x.attributes.uv&&(j||de),fog:!!_,useFog:!0===a.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:C,morphTextureStride:N,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:fe,useLegacyLights:e._useLegacyLights,decodeVideoTexture:j&&!0===a.map.isVideoTexture&&ix.getTransfer(a.map.colorSpace)===__,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:me&&!0===a.extensions.derivatives,extensionFragDepth:me&&!0===a.extensions.fragDepth,extensionDrawBuffers:me&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:me&&!0===a.extensions.shaderTextureLOD,extensionClipCullDistance:me&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:me&&!0===a.extensions.multiDraw&&r.has("WEBGL_multi_draw"),rendererExtensionFragDepth:d||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ge.vertexUv1s=c.has(1),ge.vertexUv2s=c.has(2),ge.vertexUv3s=c.has(3),c.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.instancingMorph&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.normalMapObjectSpace&&s.enable(7);t.normalMapTangentSpace&&s.enable(8);t.clearcoat&&s.enable(9);t.iridescence&&s.enable(10);t.alphaTest&&s.enable(11);t.vertexColors&&s.enable(12);t.vertexAlphas&&s.enable(13);t.vertexUv1s&&s.enable(14);t.vertexUv2s&&s.enable(15);t.vertexUv3s&&s.enable(16);t.vertexTangents&&s.enable(17);t.anisotropy&&s.enable(18);t.alphaHash&&s.enable(19);t.batching&&s.enable(20);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);t.decodeVideoTexture&&s.enable(19);t.alphaToCoverage&&s.enable(20);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=Yw[t];n=Tw.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,i=u.length;e<i;e++){const t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new eE(e,n,t,a),u.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function aE(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function oE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function sE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function lE(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,o,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?r.push(u):!0===o.transparent?i.push(u):n.push(u)},unshift:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?r.unshift(u):!0===o.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||oE),r.length>1&&r.sort(t||sE),i.length>1&&i.sort(t||sE)}}}function cE(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new lE,e.set(t,[i])):n>=r.length?(i=new lE,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function uE(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new xx,color:new Fb};break;case"SpotLight":n={position:new xx,direction:new xx,color:new Fb,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new xx,color:new Fb,distance:0,decay:0};break;case"HemisphereLight":n={direction:new xx,skyColor:new Fb,groundColor:new Fb};break;case"RectAreaLight":n={color:new Fb,position:new xx,halfWidth:new xx,halfHeight:new xx}}return e[t.id]=n,n}}}let dE=0;function hE(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function pE(e,t){const n=new uE,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new X_};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new X_,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)i.probe.push(new xx);const a=new xx,o=new Yx,s=new Yx;return{setup:function(a,o){let s=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let u=0,d=0,h=0,p=0,m=0,f=0,g=0,v=0,y=0,_=0,x=0;a.sort(hE);const b=!0===o?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],o=t.color,w=t.intensity,S=t.distance,M=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=o.r*w*b,l+=o.g*w*b,c+=o.b*w*b;else if(t.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],w);x++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=M,i.directionalShadowMatrix[u]=t.shadow.matrix,f++}i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(w*b),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[h]=e;const a=t.shadow;if(t.map&&(i.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&_++),i.spotLightMatrix[h]=a.matrix,t.castShadow){const e=r.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,i.spotShadow[h]=e,i.spotShadowMap[h]=M,v++}h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[d]=n,i.pointShadowMap[d]=M,i.pointShadowMatrix[d]=t.shadow.matrix,g++}i.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(w*b),e.groundColor.copy(t.groundColor).multiplyScalar(w*b),i.hemi[m]=e,m++}}p>0&&(t.isWebGL2?!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Kw.LTC_FLOAT_1,i.rectAreaLTC2=Kw.LTC_FLOAT_2):(i.rectAreaLTC1=Kw.LTC_HALF_1,i.rectAreaLTC2=Kw.LTC_HALF_2):!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Kw.LTC_FLOAT_1,i.rectAreaLTC2=Kw.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Kw.LTC_HALF_1,i.rectAreaLTC2=Kw.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=l,i.ambient[2]=c;const w=i.hash;w.directionalLength===u&&w.pointLength===d&&w.spotLength===h&&w.rectAreaLength===p&&w.hemiLength===m&&w.numDirectionalShadows===f&&w.numPointShadows===g&&w.numSpotShadows===v&&w.numSpotMaps===y&&w.numLightProbes===x||(i.directional.length=u,i.spot.length=h,i.rectArea.length=p,i.point.length=d,i.hemi.length=m,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=v+y-_,i.spotLightMap.length=y,i.numSpotLightShadowsWithMaps=_,i.numLightProbes=x,w.directionalLength=u,w.pointLength=d,w.spotLength=h,w.rectAreaLength=p,w.hemiLength=m,w.numDirectionalShadows=f,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,w.numLightProbes=x,i.version=dE++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let h=0,p=e.length;h<p;h++){const t=e[h];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),s.identity(),o.copy(t.matrixWorld),o.premultiply(d),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),r++}else if(t.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),u++}}},state:i}}function mE(e,t){const n=new pE(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function fE(e,t){let n=new WeakMap;return{get:function(r,i=0){const a=n.get(r);let o;return void 0===a?(o=new mE(e,t),n.set(r,[o])):i>=a.length?(o=new mE(e,t),a.push(o)):o=a[i],o},dispose:function(){n=new WeakMap}}}class gE extends Hb{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class vE extends Hb{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function yE(e,t,n){let r=new Gw;const i=new X_,a=new X_,o=new mx,s=new gE({depthPacking:3201}),l=new vE,c={},u=n.maxTextureSize,d={[_y]:1,[xy]:0,[by]:2},h=new kw({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new X_},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const m=new rw;m.setAttribute("position",new $b(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new bw(m,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function y(n,r){const a=t.update(f);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new gx(i.x,i.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,h,f,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,p,f,null)}function _(t,n,r,i){let a=null;const o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===r.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=a.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",b)),a=i}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=r}return a}function x(n,i,a,o,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],d=l[u.materialIndex];if(d&&d.visible){const t=_(n,d,o,s);n.onBeforeShadow(e,n,i,a,r,t,u),e.renderBufferDirect(a,null,r,t,n,u),n.onAfterShadow(e,n,i,a,r,t,u)}}}else if(l.visible){const t=_(n,l,o,s);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],i,a,o,s)}function b(e){e.target.removeEventListener("dispose",b);for(const t in c){const n=c[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=3!==v&&3===this.type,m=3===v&&3!==this.type;for(let f=0,g=t.length;f<g;f++){const l=t[f],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);const d=c.getFrameExtents();if(i.multiply(d),a.copy(c.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/d.x),i.x=a.x*d.x,c.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/d.y),i.y=a.y*d.y,c.mapSize.y=a.y)),null===c.map||!0===p||!0===m){const e=3!==this.type?{minFilter:$y,magFilter:$y}:{};null!==c.map&&c.map.dispose(),c.map=new gx(i.x,i.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),h.viewport(o),c.updateMatrices(l,e),r=c.getFrustum(),x(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&y(c,s),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function _E(e,t,n){const r=n.isWebGL2;const i=new function(){let t=!1;const n=new mx;let r=null;const i=new mx(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?H(e.DEPTH_TEST):V(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},o=new function(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){t||(n?H(e.STENCIL_TEST):V(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}},s=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],p=null,m=!1,f=null,g=null,v=null,y=null,_=null,x=null,b=null,w=new Fb(0,0,0),S=0,M=!1,E=null,C=null,T=null,k=null,P=null;const A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,R=0;const L=e.getParameter(e.VERSION);-1!==L.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(L)[1]),N=R>=1):-1!==L.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),N=R>=2);let I=null,j={};const D=e.getParameter(e.SCISSOR_BOX),O=e.getParameter(e.VIEWPORT),U=(new mx).fromArray(D),F=(new mx).fromArray(O);function z(t,n,i,a){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let l=0;l<i;l++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+l,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const B={};function H(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function V(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}B[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),B[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(B[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),B[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),H(e.DEPTH_TEST),a.setFunc(3),X(!1),q(1),H(e.CULL_FACE),$(0);const G={[wy]:e.FUNC_ADD,[Sy]:e.FUNC_SUBTRACT,[My]:e.FUNC_REVERSE_SUBTRACT};if(r)G[103]=e.MIN,G[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(G[103]=e.MIN_EXT,G[104]=e.MAX_EXT)}const W={[Ey]:e.ZERO,[Cy]:e.ONE,[Ty]:e.SRC_COLOR,[Py]:e.SRC_ALPHA,[jy]:e.SRC_ALPHA_SATURATE,[Ly]:e.DST_COLOR,[Ny]:e.DST_ALPHA,[ky]:e.ONE_MINUS_SRC_COLOR,[Ay]:e.ONE_MINUS_SRC_ALPHA,[Iy]:e.ONE_MINUS_DST_COLOR,[Ry]:e.ONE_MINUS_DST_ALPHA,[Dy]:e.CONSTANT_COLOR,[Oy]:e.ONE_MINUS_CONSTANT_COLOR,[Uy]:e.CONSTANT_ALPHA,[Fy]:e.ONE_MINUS_CONSTANT_ALPHA};function $(t,n,r,i,a,o,s,l,c,u){if(0!==t){if(!1===m&&(H(e.BLEND),m=!0),5===t)a=a||n,o=o||r,s=s||i,n===g&&a===_||(e.blendEquationSeparate(G[n],G[a]),g=n,_=a),r===v&&i===y&&o===x&&s===b||(e.blendFuncSeparate(W[r],W[i],W[o],W[s]),v=r,y=i,x=o,b=s),!1!==l.equals(w)&&c===S||(e.blendColor(l.r,l.g,l.b,c),w.copy(l),S=c),f=t,M=!1;else if(t!==f||u!==M){if(g===wy&&_===wy||(e.blendEquation(e.FUNC_ADD),g=wy,_=wy),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,b=null,w.set(0,0,0),S=0,f=t,M=u}}else!0===m&&(V(e.BLEND),m=!1)}function X(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function q(t){0!==t?(H(e.CULL_FACE),t!==C&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):V(e.CULL_FACE),C=t}function K(t,n,r){t?(H(e.POLYGON_OFFSET_FILL),k===n&&P===r||(e.polygonOffset(n,r),k=n,P=r)):V(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:a,stencil:o},enable:H,disable:V,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,i){let a=h,o=!1;if(r){a=d.get(i),void 0===a&&(a=[],d.set(i,a));const t=r.textures;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)a[n]=e.COLOR_ATTACHMENT0+n;a.length=t.length,o=!0}}else a[0]!==e.BACK&&(a[0]=e.BACK,o=!0);if(o)if(n.isWebGL2)e.drawBuffers(a);else{if(!0!==t.has("WEBGL_draw_buffers"))throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension");t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a)}},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:$,setMaterial:function(t,n){2===t.side?V(e.CULL_FACE):H(e.CULL_FACE);let r=1===t.side;n&&(r=!r),X(r),1===t.blending&&!1===t.transparent?$(0):$(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),i.setMask(t.colorWrite);const s=t.stencilWrite;o.setTest(s),s&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),K(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(e.SAMPLE_ALPHA_TO_COVERAGE):V(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:X,setCullFace:q,setLineWidth:function(t){t!==T&&(N&&e.lineWidth(t),T=t)},setPolygonOffset:K,setScissorTest:function(t){t?H(e.SCISSOR_TEST):V(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),I!==t&&(e.activeTexture(t),I=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===I?e.TEXTURE0+A-1:I);let i=j[r];void 0===i&&(i={type:void 0,texture:void 0},j[r]=i),i.type===t&&i.texture===n||(I!==r&&(e.activeTexture(r),I=r),e.bindTexture(t,n||B[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=j[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let r=l.get(n);void 0===r&&(r=new WeakMap,l.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=l.get(n).get(t);s.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),s.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},I=null,j={},u={},d=new WeakMap,h=[],p=null,m=!1,f=null,g=null,v=null,y=null,_=null,x=null,b=null,w=new Fb(0,0,0),S=0,M=!1,E=null,C=null,T=null,k=null,P=null,U.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),i.reset(),a.reset(),o.reset()}}}function xE(e,t,n,r,i,a,o){const s=i.isWebGL2,l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new X_,d=new WeakMap;let h;const p=new WeakMap;let m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(B){}function f(e,t){return m?new OffscreenCanvas(e,t):Z_("canvas")}function g(e,t,n,r){let i=1;const a=z(e);if((a.width>r||a.height>r)&&(i=r/Math.max(a.width,a.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const r=t?V_:Math.floor,o=r(i*a.width),s=r(i*a.height);void 0===h&&(h=f(o,s));const l=n?f(o,s):h;l.width=o,l.height=s;return l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),e}return e}function v(e){const t=z(e);return H_(t.width)&&H_(t.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==$y&&e.minFilter!==Ky}function _(t){e.generateMipmap(t)}function x(n,r,i,a,o=!1){if(!1===s)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;if(r===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.R8UI),i===e.UNSIGNED_SHORT&&(l=e.R16UI),i===e.UNSIGNED_INT&&(l=e.R32UI),i===e.BYTE&&(l=e.R8I),i===e.SHORT&&(l=e.R16I),i===e.INT&&(l=e.R32I)),r===e.RG&&(i===e.FLOAT&&(l=e.RG32F),i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.RG8UI),i===e.UNSIGNED_SHORT&&(l=e.RG16UI),i===e.UNSIGNED_INT&&(l=e.RG32UI),i===e.BYTE&&(l=e.RG8I),i===e.SHORT&&(l=e.RG16I),i===e.INT&&(l=e.RG32I)),r===e.RGBA){const t=o?y_:ix.getTransfer(a);i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=t===__?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function b(e,t,n){return!0===y(e,n)||e.isFramebufferTexture&&e.minFilter!==$y&&e.minFilter!==Ky?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(t){return t===$y||1004===t||t===qy?e.NEAREST:e.LINEAR}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=p.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&E(e),0===Object.keys(i).length&&p.delete(n)}r.remove(e)}(t),t.isVideoTexture&&d.delete(t)}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=r.get(t);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let a=0,s=i.length;a<s;a++){const t=r.get(i[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(i[a])}r.remove(t)}(n)}function E(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete p.get(i)[n.__cacheKey],o.memory.textures--}let C=0;function T(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void L(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const k={[Vy]:e.REPEAT,[Gy]:e.CLAMP_TO_EDGE,[Wy]:e.MIRRORED_REPEAT},P={[$y]:e.NEAREST,[Xy]:e.NEAREST_MIPMAP_NEAREST,[qy]:e.NEAREST_MIPMAP_LINEAR,[Ky]:e.LINEAR,[Yy]:e.LINEAR_MIPMAP_NEAREST,[Zy]:e.LINEAR_MIPMAP_LINEAR},A={[S_]:e.NEVER,[A_]:e.ALWAYS,[M_]:e.LESS,[C_]:e.LEQUAL,[E_]:e.EQUAL,[P_]:e.GEQUAL,[T_]:e.GREATER,[k_]:e.NOTEQUAL};function N(n,a,o){if(a.type!==n_||!1!==t.has("OES_texture_float_linear")||a.magFilter!==Ky&&a.magFilter!==Yy&&a.magFilter!==qy&&a.magFilter!==Zy&&a.minFilter!==Ky&&a.minFilter!==Yy&&a.minFilter!==qy&&a.minFilter!==Zy||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),o?(e.texParameteri(n,e.TEXTURE_WRAP_S,k[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,k[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,k[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,P[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,P[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===Gy&&a.wrapT===Gy||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,w(a.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,w(a.minFilter)),a.minFilter!==$y&&a.minFilter!==Ky&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,A[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===$y)return;if(a.minFilter!==qy&&a.minFilter!==Zy)return;if(a.type===n_&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===r_&&!1===t.has("OES_texture_half_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){const o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function R(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const i=n.source;let a=p.get(i);void 0===a&&(a={},p.set(i,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&E(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function L(t,o,l){let c=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(c=e.TEXTURE_3D);const u=R(t,o),d=o.source;n.bindTexture(c,t.__webglTexture,e.TEXTURE0+l);const h=r.get(d);if(d.version!==h.__version||!0===u){n.activeTexture(e.TEXTURE0+l);const t=ix.getPrimaries(ix.workingColorSpace),r=o.colorSpace===p_?null:ix.getPrimaries(o.colorSpace),p=o.colorSpace===p_||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const m=function(e){return!s&&(e.wrapS!==Gy||e.wrapT!==Gy||e.minFilter!==$y&&e.minFilter!==Ky)}(o)&&!1===v(o.image);let f=g(o.image,m,!1,i.maxTextureSize);f=F(o,f);const w=v(f)||s,S=a.convert(o.format,o.colorSpace);let M,E=a.convert(o.type),C=x(o.internalFormat,S,E,o.colorSpace,o.isVideoTexture);N(c,o,w);const T=o.mipmaps,k=s&&!0!==o.isVideoTexture&&36196!==C,P=void 0===h.__version||!0===u,A=d.dataReady,R=b(o,f,w);if(o.isDepthTexture)C=e.DEPTH_COMPONENT,s?C=o.type===n_?e.DEPTH_COMPONENT32F:o.type===t_?e.DEPTH_COMPONENT24:o.type===i_?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:o.type===n_&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),o.format===o_&&C===e.DEPTH_COMPONENT&&o.type!==Qy&&o.type!==t_&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),o.type=t_,E=a.convert(o.type)),o.format===s_&&C===e.DEPTH_COMPONENT&&(C=e.DEPTH_STENCIL,o.type!==i_&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),o.type=i_,E=a.convert(o.type))),P&&(k?n.texStorage2D(e.TEXTURE_2D,1,C,f.width,f.height):n.texImage2D(e.TEXTURE_2D,0,C,f.width,f.height,0,S,E,null));else if(o.isDataTexture)if(T.length>0&&w){k&&P&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,r=T.length;t<r;t++)M=T[t],k?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,S,E,M.data):n.texImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,S,E,M.data);o.generateMipmaps=!1}else k?(P&&n.texStorage2D(e.TEXTURE_2D,R,C,f.width,f.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f.width,f.height,S,E,f.data)):n.texImage2D(e.TEXTURE_2D,0,C,f.width,f.height,0,S,E,f.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){k&&P&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,T[0].width,T[0].height,f.depth);for(let t=0,r=T.length;t<r;t++)M=T[t],o.format!==a_?null!==S?k?A&&n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,M.width,M.height,f.depth,S,M.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,C,M.width,M.height,f.depth,0,M.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,M.width,M.height,f.depth,S,E,M.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,C,M.width,M.height,f.depth,0,S,E,M.data)}else{k&&P&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,r=T.length;t<r;t++)M=T[t],o.format!==a_?null!==S?k?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,S,M.data):n.compressedTexImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,S,E,M.data):n.texImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,S,E,M.data)}else if(o.isDataArrayTexture)k?(P&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,f.width,f.height,f.depth),A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,f.width,f.height,f.depth,S,E,f.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,C,f.width,f.height,f.depth,0,S,E,f.data);else if(o.isData3DTexture)k?(P&&n.texStorage3D(e.TEXTURE_3D,R,C,f.width,f.height,f.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,f.width,f.height,f.depth,S,E,f.data)):n.texImage3D(e.TEXTURE_3D,0,C,f.width,f.height,f.depth,0,S,E,f.data);else if(o.isFramebufferTexture){if(P)if(k)n.texStorage2D(e.TEXTURE_2D,R,C,f.width,f.height);else{let t=f.width,r=f.height;for(let i=0;i<R;i++)n.texImage2D(e.TEXTURE_2D,i,C,t,r,0,S,E,null),t>>=1,r>>=1}}else if(T.length>0&&w){if(k&&P){const t=z(T[0]);n.texStorage2D(e.TEXTURE_2D,R,C,t.width,t.height)}for(let t=0,r=T.length;t<r;t++)M=T[t],k?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S,E,M):n.texImage2D(e.TEXTURE_2D,t,C,S,E,M);o.generateMipmaps=!1}else if(k){if(P){const t=z(f);n.texStorage2D(e.TEXTURE_2D,R,C,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,S,E,f)}else n.texImage2D(e.TEXTURE_2D,0,C,S,E,f);y(o,w)&&_(c),h.__version=d.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function I(t,i,o,s,c,u){const d=a.convert(o.format,o.colorSpace),h=a.convert(o.type),p=x(o.internalFormat,d,h,o.colorSpace);if(!r.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,r,i.depth,0,d,h,null):n.texImage2D(c,u,p,t,r,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,c,r.get(o).__webglTexture,0,O(i)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,c,r.get(o).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function j(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=!0===s?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(r||U(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===n_?i=e.DEPTH_COMPONENT32F:t.type===t_&&(i=e.DEPTH_COMPONENT24));const r=O(n);U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=O(n);r&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const o=t[i],s=a.convert(o.format,o.colorSpace),c=a.convert(o.type),u=x(o.internalFormat,s,c,o.colorSpace),d=O(n);r&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,u,n.width,n.height):U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const a=r.get(i.depthTexture).__webglTexture,o=O(i);if(i.depthTexture.format===o_)U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(i.depthTexture.format!==s_)throw new Error("Unknown depthTexture format");U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),j(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),j(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(e){return Math.min(i.maxSamples,e.samples)}function U(e){const n=r.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function F(e,n){const r=e.colorSpace,i=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===R_||r!==f_&&r!==p_&&(ix.getTransfer(r)===__?!1===s?!0===t.has("EXT_sRGB")&&i===a_?(e.format=R_,e.minFilter=Ky,e.generateMipmaps=!1):n=lx.sRGBToLinear(n):i===a_&&a===Jy||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}function z(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=C;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=T,this.setTexture2DArray=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?L(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?L(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,o){const l=r.get(t);t.version>0&&l.__version!==t.version?function(t,o,l){if(6!==o.image.length)return;const c=R(t,o),u=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+l);const d=r.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+l);const t=ix.getPrimaries(ix.workingColorSpace),r=o.colorSpace===p_?null:ix.getPrimaries(o.colorSpace),h=o.colorSpace===p_||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const p=o.isCompressedTexture||o.image[0].isCompressedTexture,m=o.image[0]&&o.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=p||m?m?o.image[e].image:o.image[e]:g(o.image[e],!1,!0,i.maxCubemapSize),f[e]=F(o,f[e]);const w=f[0],S=v(w)||s,M=a.convert(o.format,o.colorSpace),E=a.convert(o.type),C=x(o.internalFormat,M,E,o.colorSpace),T=s&&!0!==o.isVideoTexture,k=void 0===d.__version||!0===c,P=u.dataReady;let A,R=b(o,w,S);if(N(e.TEXTURE_CUBE_MAP,o,S),p){T&&k&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,w.width,w.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let r=0;r<A.length;r++){const i=A[r];o.format!==a_?null!==M?T?P&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,M,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,C,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,M,E,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,C,i.width,i.height,0,M,E,i.data)}}}else{if(A=o.mipmaps,T&&k){A.length>0&&R++;const t=z(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,t.width,t.height)}for(let t=0;t<6;t++)if(m){T?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,M,E,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,f[t].width,f[t].height,0,M,E,f[t].data);for(let r=0;r<A.length;r++){const i=A[r].image[t].image;T?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,M,E,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,C,i.width,i.height,0,M,E,i.data)}}else{T?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,M,E,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,M,E,f[t]);for(let r=0;r<A.length;r++){const i=A[r];T?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,M,E,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,C,M,E,i.image[t])}}}y(o,S)&&_(e.TEXTURE_CUBE_MAP),d.__version=u.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(l,t,o):n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&I(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&D(t)},this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",M);const d=t.textures,h=!0===t.isWebGLCubeRenderTarget,p=d.length>1,m=v(t)||s;if(p||(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(s&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(s&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(p)if(i.drawBuffers)for(let t=0,n=d.length;t<n;t++){const n=r.get(d[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===U(t)){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<d.length;n++){const r=d[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const i=a.convert(r.format,r.colorSpace),o=a.convert(r.type),s=x(r.internalFormat,i,o,r.colorSpace,!0===t.isXRRenderTarget),l=O(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,l,s,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),j(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),N(e.TEXTURE_CUBE_MAP,l,m);for(let n=0;n<6;n++)if(s&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)I(c.__webglFramebuffer[n][r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else I(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);y(l,m)&&_(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(p){for(let i=0,a=d.length;i<a;i++){const a=d[i],o=r.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),N(e.TEXTURE_2D,a,m),I(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),y(a,m)&&_(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(r,u.__webglTexture),N(r,l,m),s&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)I(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,r,n);else I(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,r,0);y(l,m)&&_(r),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(t){const i=v(t)||s,a=t.textures;for(let o=0,s=a.length;o<s;o++){const s=a[o];if(y(s,i)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(s).__webglTexture;n.bindTexture(i,a),_(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===U(t)){const i=t.textures,a=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const l=[],u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,d=r.get(t),h=i.length>1;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,d.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglFramebuffer);for(let n=0;n<i.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(u);const p=void 0!==d.__ignoreDepthValues&&d.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d.__webglColorRenderbuffer[n]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[u]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[u])),h){const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),c&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,d.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=I,this.useMultisampledRTT=U}function bE(e,t,n){const r=n.isWebGL2;return{convert:function(n,i=""){let a;const o=ix.getTransfer(i);if(n===Jy)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===Qy)return e.UNSIGNED_SHORT;if(n===e_)return e.INT;if(n===t_)return e.UNSIGNED_INT;if(n===n_)return e.FLOAT;if(n===r_)return r?e.HALF_FLOAT:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===a_)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===o_)return e.DEPTH_COMPONENT;if(n===s_)return e.DEPTH_STENCIL;if(n===R_)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===l_||n===c_||n===u_||n===d_)if(o===__){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(n===l_)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===c_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===u_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===d_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(n===l_)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===c_)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===u_)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===d_)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===n)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===n)return o===__?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return o===__?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===h_||36494===n||36495===n){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(n===h_)return o===__?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(n===h_)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===i_?r?e.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class wE extends Lw{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class SE extends Sb{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ME={type:"move"};class EE{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new SE,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new SE,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new xx,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new xx),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new SE,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new xx,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new xx),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),r=this._getHandJoint(l,a);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(ME)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new SE;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class CE{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const r=new px;e.properties.get(r).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}render(e,t){if(null!==this.texture){if(null===this.mesh){const e=t.cameras[0].viewport,n=new kw({extensions:{fragDepth:!0},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new bw(new Xw(20,20),n)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class TE extends j_{constructor(e,t){super();const n=this;let r=null,i=1,a=null,o="local-floor",s=1,l=null,c=null,u=null,d=null,h=null,p=null;const m=new CE,f=t.getContextAttributes();let g=null,v=null;const y=[],_=[],x=new X_;let b=null;const w=new Lw;w.layers.enable(1),w.viewport=new mx;const S=new Lw;S.layers.enable(2),S.viewport=new mx;const M=[w,S],E=new wE;E.layers.enable(1),E.layers.enable(2);let C=null,T=null;function k(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function P(){r.removeEventListener("select",k),r.removeEventListener("selectstart",k),r.removeEventListener("selectend",k),r.removeEventListener("squeeze",k),r.removeEventListener("squeezestart",k),r.removeEventListener("squeezeend",k),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",A);for(let e=0;e<y.length;e++){const t=_[e];null!==t&&(_[e]=null,y[e].disconnect(t))}C=null,T=null,m.reset(),e.setRenderTarget(g),h=null,d=null,u=null,r=null,v=null,j.stop(),n.isPresenting=!1,e.setPixelRatio(b),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function A(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=_.indexOf(n);r>=0&&(_[r]=null,y[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=_.indexOf(n);if(-1===r){for(let e=0;e<y.length;e++){if(e>=_.length){_.push(n),r=e;break}if(null===_[e]){_[e]=n,r=e;break}}if(-1===r)break}const i=y[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new EE,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new EE,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new EE,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",k),r.addEventListener("selectstart",k),r.addEventListener("selectend",k),r.addEventListener("squeeze",k),r.addEventListener("squeezestart",k),r.addEventListener("squeezeend",k),r.addEventListener("end",P),r.addEventListener("inputsourceschange",A),!0!==f.xrCompatible&&await t.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(x),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),v=new gx(h.framebufferWidth,h.framebufferHeight,{format:a_,type:Jy,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,a=null,o=null;f.depth&&(o=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?s_:o_,a=f.stencil?i_:t_);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:i};u=new XRWebGLBinding(r,t),d=u.createProjectionLayer(s),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new gx(d.textureWidth,d.textureHeight,{format:a_,type:Jy,depthTexture:new RS(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0});e.properties.get(v).__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await r.requestReferenceSpace(o),j.setContext(r),j.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const N=new xx,R=new xx;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;null!==m.texture&&(e.near=m.depthNear,e.far=m.depthFar),E.near=S.near=w.near=e.near,E.far=S.far=w.far=e.far,C===E.near&&T===E.far||(r.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,T=E.far,w.near=C,w.far=T,S.near=C,S.far=T,w.updateProjectionMatrix(),S.updateProjectionMatrix(),e.updateProjectionMatrix());const t=e.parent,n=E.cameras;L(E,t);for(let r=0;r<n.length;r++)L(n[r],t);2===n.length?function(e,t,n){N.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const r=N.distanceTo(R),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(a[8]+1)/a[0],h=o*u,p=o*d,m=r/(-u+d),f=m*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+m,v=s+m,y=h-f,_=p+(r-f),x=l*s/v*g,b=c*s/v*g;e.projectionMatrix.makePerspective(y,_,x,b,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*U_*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,t)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==d||null!==h)return s},this.setFoveation=function(e){s=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture};let I=null;const j=new Ww;j.setAnimationLoop(function(t,i){if(c=i.getViewerPose(l||a),p=i,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(v,h.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let a=null;if(null!==h)a=h.getViewport(i);else{const t=u.getViewSubImage(d,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(v,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let o=M[r];void 0===o&&(o=new Lw,o.layers.enable(r),o.viewport=new mx,M[r]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===r&&(E.matrix.copy(o.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(o)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")){const n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&m.init(e,n,r.renderState)}}for(let e=0;e<y.length;e++){const t=_[e],n=y[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}m.render(e,E),I&&I(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null}),this.setAnimationLoop=function(e){I=e},this.dispose=function(){}}}const kE=new ob,PE=new Yx;function AE(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,1===i.side&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),r.normalScale.value.copy(i.normalScale),1===i.side&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const a=t.get(i),o=a.envMap,s=a.envMapRotation;if(o&&(r.envMap.value=o,kE.copy(s),kE.x*=-1,kE.y*=-1,kE.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&(kE.y*=-1,kE.z*=-1),r.envMapRotation.value.setFromMatrix4(PE.makeRotationFromEuler(kE)),r.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio),i.lightMap){r.lightMap.value=i.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Cw(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,o,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform));e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform));const i=t.get(r).envMap;i&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,s)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function NE(e,t,n,r){let i={},a={},o=[];const s=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n,r){const i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const e=r[a];if("number"==typeof i||"boolean"==typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,d){let h=i[n.id];void 0===h&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let a=0,o=t.length;a<o;a++){const e=Array.isArray(t[a])?t[a]:[t[a]];for(let t=0,i=e.length;t<i;t++){const i=e[t],a=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=a.length;e<t;e++){const t=c(a[e]),o=n%r;0!==o&&r-o<t.boundary&&(n+=r-o),i.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,n+=t.storage}}}const i=n%r;i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=h,n.addEventListener("dispose",u));const p=d.program;r.updateUBOMapping(n,p);const m=t.render.frame;a[n.id]!==m&&(!function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,o=r.length;i<o;i++){const t=Array.isArray(r[i])?r[i]:[r[i]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===l(r,i,n,a)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let a=0;a<n.length;a++){const o=n[a],s=c(o);"number"==typeof o||"boolean"==typeof o?(r.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+i,r.__data)):o.isMatrix3?(r.__data[0]=o.elements[0],r.__data[1]=o.elements[1],r.__data[2]=o.elements[2],r.__data[3]=0,r.__data[4]=o.elements[3],r.__data[5]=o.elements[4],r.__data[6]=o.elements[5],r.__data[7]=0,r.__data[8]=o.elements[6],r.__data[9]=o.elements[7],r.__data[10]=o.elements[8],r.__data[11]=0):(o.toArray(r.__data,i),i+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=m)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}class RE{constructor(e={}){const{canvas:t=J_(),context:n=null,depth:r=!0,stencil:i=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:a;const h=new Uint32Array(4),p=new Int32Array(4);let m=null,f=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=m_,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let _=!1,x=0,b=0,w=null,S=-1,M=null;const E=new mx,C=new mx;let T=null;const k=new Fb(0);let P=0,A=t.width,N=t.height,R=1,L=null,I=null;const j=new mx(0,0,A,N),D=new mx(0,0,A,N);let O=!1;const U=new Gw;let F=!1,z=!1,B=null;const H=new Yx,V=new X_,G=new xx,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return null===w?R:1}let X,q,K,Y,Z,J,Q,ee,te,ne,re,ie,ae,oe,se,le,ce,ue,de,he,pe,me,fe,ge,ve=n;function ye(e,n){for(let r=0;r<e.length;r++){const i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{const e={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${dy}`),t.addEventListener("webglcontextlost",be,!1),t.addEventListener("webglcontextrestored",we,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ve){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&ve instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Oe){throw console.error("THREE.WebGLRenderer: "+Oe.message),Oe}function _e(){X=new MS(ve),q=new rS(ve,X,e),X.init(q),me=new bE(ve,X,q),K=new _E(ve,X,q),Y=new TS(ve),Z=new aE,J=new xE(ve,X,K,Z,q,me,Y),Q=new aS(y),ee=new SS(y),te=new $w(ve,q),fe=new tS(ve,X,te,q),ne=new ES(ve,te,Y,fe),re=new NS(ve,ne,te,Y),de=new AS(ve,q,J),le=new iS(Z),ie=new iE(y,Q,ee,X,q,fe,le),ae=new AE(y,Z),oe=new cE,se=new fE(X,q),ue=new eS(y,Q,ee,K,re,d,s),ce=new yE(y,re,q),ge=new NE(ve,Y,q,K),he=new nS(ve,X,Y,q),pe=new CS(ve,X,Y,q),Y.programs=ie.programs,y.capabilities=q,y.extensions=X,y.properties=Z,y.renderLists=oe,y.shadowMap=ce,y.state=K,y.info=Y}_e();const xe=new TE(y,ve);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const e=Y.autoReset,t=ce.enabled,n=ce.autoUpdate,r=ce.needsUpdate,i=ce.type;_e(),Y.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=r,ce.type=i}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){const t=e.target;t.removeEventListener("dispose",Me),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){ie.releaseProgram(e)}),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ie(e,t,n),e.side=0,e.needsUpdate=!0,Ie(e,t,n),e.side=2):Ie(e,t,n)}this.xr=xe,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=X.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=X.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(A,N,!1))},this.getSize=function(e){return e.set(A,N)},this.setSize=function(e,n,r=!0){xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(A=e,N=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(A*R,N*R).floor()},this.setDrawingBufferSize=function(e,n,r){A=e,N=n,R=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(j)},this.setViewport=function(e,t,n,r){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,r),K.viewport(E.copy(j).multiplyScalar(R).round())},this.getScissor=function(e){return e.copy(D)},this.setScissor=function(e,t,n,r){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,r),K.scissor(C.copy(D).multiplyScalar(R).round())},this.getScissorTest=function(){return O},this.setScissorTest=function(e){K.setScissorTest(O=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==w){const t=w.texture.format;e=1033===t||1031===t||1029===t}if(e){const e=w.texture.type,t=e===Jy||e===t_||e===Qy||e===i_||1017===e||1018===e,n=ue.getClearColor(),r=ue.getClearAlpha(),i=n.r,a=n.g,o=n.b;t?(h[0]=i,h[1]=a,h[2]=o,h[3]=r,ve.clearBufferuiv(ve.COLOR,0,h)):(p[0]=i,p[1]=a,p[2]=o,p[3]=r,ve.clearBufferiv(ve.COLOR,0,p))}else r|=ve.COLOR_BUFFER_BIT}t&&(r|=ve.DEPTH_BUFFER_BIT),n&&(r|=ve.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ve.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",be,!1),t.removeEventListener("webglcontextrestored",we,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),oe.dispose(),se.dispose(),Z.dispose(),Q.dispose(),ee.dispose(),re.dispose(),fe.dispose(),ge.dispose(),ie.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",Te),xe.removeEventListener("sessionend",ke),B&&(B.dispose(),B=null),Pe.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=W);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=W);J.resetTextureUnits();const a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:f_,l=(r.isMeshStandardMaterial?ee:Q).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let m=0;r.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(m=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,_=Z.get(r),x=f.state.lights;if(!0===F&&(!0===z||e!==M)){const t=e===M&&r.id===S;le.setState(r,e,t)}let b=!1;r.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputColorSpace!==s||i.isBatchedMesh&&!1===_.batching?b=!0:i.isBatchedMesh||!0!==_.batching?i.isInstancedMesh&&!1===_.instancing?b=!0:i.isInstancedMesh||!0!==_.instancing?i.isSkinnedMesh&&!1===_.skinning?b=!0:i.isSkinnedMesh||!0!==_.skinning?i.isInstancedMesh&&!0===_.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===_.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===_.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===_.instancingMorph&&null!==i.morphTexture||_.envMap!==l||!0===r.fog&&_.fog!==a?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===le.numPlanes&&_.numIntersection===le.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==d||_.morphNormals!==h||_.morphColors!==p||_.toneMapping!==m||!0===q.isWebGL2&&_.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,_.__version=r.version);let E=_.currentProgram;!0===b&&(E=Ie(r,t,i));let C=!1,T=!1,k=!1;const P=E.getUniforms(),A=_.uniforms;K.useProgram(E.program)&&(C=!0,T=!0,k=!0);r.id!==S&&(S=r.id,T=!0);if(C||M!==e){P.setValue(ve,"projectionMatrix",e.projectionMatrix),P.setValue(ve,"viewMatrix",e.matrixWorldInverse);const t=P.map.cameraPosition;void 0!==t&&t.setValue(ve,G.setFromMatrixPosition(e.matrixWorld)),q.logarithmicDepthBuffer&&P.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&P.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,T=!0,k=!0)}if(i.isSkinnedMesh){P.setOptional(ve,i,"bindMatrix"),P.setOptional(ve,i,"bindMatrixInverse");const e=i.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),P.setValue(ve,"boneTexture",e.boneTexture,J)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}i.isBatchedMesh&&(P.setOptional(ve,i,"batchingTexture"),P.setValue(ve,"batchingTexture",i._matricesTexture,J));const L=n.morphAttributes;(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===q.isWebGL2)&&de.update(i,n,E);(T||_.receiveShadow!==i.receiveShadow)&&(_.receiveShadow=i.receiveShadow,P.setValue(ve,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(A.envMap.value=l,A.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);T&&(P.setValue(ve,"toneMappingExposure",y.toneMappingExposure),_.needsLights&&(j=k,(I=A).ambientLightColor.needsUpdate=j,I.lightProbe.needsUpdate=j,I.directionalLights.needsUpdate=j,I.directionalLightShadows.needsUpdate=j,I.pointLights.needsUpdate=j,I.pointLightShadows.needsUpdate=j,I.spotLights.needsUpdate=j,I.spotLightShadows.needsUpdate=j,I.rectAreaLights.needsUpdate=j,I.hemisphereLights.needsUpdate=j),a&&!0===r.fog&&ae.refreshFogUniforms(A,a),ae.refreshMaterialUniforms(A,r,R,N,B),OM.upload(ve,je(_),A,J));var I,j;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(OM.upload(ve,je(_),A,J),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&P.setValue(ve,"center",i.center);if(P.setValue(ve,"modelViewMatrix",i.modelViewMatrix),P.setValue(ve,"normalMatrix",i.normalMatrix),P.setValue(ve,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(q.isWebGL2){const n=e[t];ge.update(n,E),ge.bind(n,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,n,r,i);K.setMaterial(r,o);let l=n.index,c=1;if(!0===r.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,p=(u.start+u.count)*c;null!==a&&(h=Math.max(h,a.start*c),p=Math.min(p,(a.start+a.count)*c)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):null!=d&&(h=Math.max(h,0),p=Math.min(p,d.count));const m=p-h;if(m<0||m===1/0)return;let g;fe.setup(i,r,s,n,l);let v=he;if(null!==l&&(g=te.get(l),v=pe,v.setIndex(g)),i.isMesh)!0===r.wireframe?(K.setLineWidth(r.wireframeLinewidth*$()),v.setMode(ve.LINES)):v.setMode(ve.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),K.setLineWidth(e*$()),i.isLineSegments?v.setMode(ve.LINES):i.isLineLoop?v.setMode(ve.LINE_LOOP):v.setMode(ve.LINE_STRIP)}else i.isPoints?v.setMode(ve.POINTS):i.isSprite&&v.setMode(ve.TRIANGLES);if(i.isBatchedMesh)v.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else if(i.isInstancedMesh)v.renderInstances(h,m,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(h,m,t)}else v.render(h,m)},this.compile=function(e,t,n=null){null===n&&(n=e),f=se.get(n),f.init(),v.push(f),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))}),f.setupLights(y._useLegacyLights);const r=new Set;return e.traverse(function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];Ee(a,n,e),r.add(a)}else Ee(t,n,e),r.add(t)}),v.pop(),f=null,r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){Z.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==X.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ce=null;function Te(){Pe.stop()}function ke(){Pe.start()}const Pe=new Ww;function Ae(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=re.update(e),i=e.material;i.visible&&m.push(e,t,i,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=re.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=i[o.materialIndex];s&&s.visible&&m.push(e,t,s,n,G.z,o)}}else i.visible&&m.push(e,t,i,n,G.z,null)}const i=e.children;for(let a=0,o=i.length;a<o;a++)Ae(i[a],t,n,r)}function Ne(e,t,n,r){const i=e.opaque,a=e.transmissive,o=e.transparent;f.setupLightsView(n),!0===F&&le.setGlobalState(y.clippingPlanes,n),a.length>0&&function(e,t,n,r){const i=!0===n.isScene?n.overrideMaterial:null;if(null!==i)return;const a=q.isWebGL2;null===B&&(B=new gx(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")?r_:Jy,minFilter:Zy,samples:a?4:0}));y.getDrawingBufferSize(V),a?B.setSize(V.x,V.y):B.setSize(V_(V.x),V_(V.y));const o=y.getRenderTarget();y.setRenderTarget(B),y.getClearColor(k),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5);y.clear();const s=y.toneMapping;y.toneMapping=0,Re(e,n,r),J.updateMultisampleRenderTarget(B),J.updateRenderTargetMipmap(B);let l=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c],i=e.object,a=e.geometry,o=e.material,s=e.group;if(2===o.side&&i.layers.test(r.layers)){const e=o.side;o.side=1,o.needsUpdate=!0,Le(i,n,r,a,o,s),o.side=e,o.needsUpdate=!0,l=!0}}!0===l&&(J.updateMultisampleRenderTarget(B),J.updateRenderTargetMipmap(B));y.setRenderTarget(o),y.setClearColor(k,P),y.toneMapping=s}(i,a,t,n),r&&K.viewport(E.copy(r)),i.length>0&&Re(i,t,n),a.length>0&&Re(a,t,n),o.length>0&&Re(o,t,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Re(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=a.object,s=a.geometry,l=null===r?a.material:r,c=a.group;o.layers.test(n.layers)&&Le(o,t,n,s,l,c)}}function Le(e,t,n,r,i,a){e.onBeforeRender(y,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(y,t,n,r,e,a),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=2):y.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(y,t,n,r,i,a)}function Ie(e,t,n){!0!==t.isScene&&(t=W);const r=Z.get(e),i=f.state.lights,a=f.state.shadowsArray,o=i.state.version,s=ie.getParameters(e,i.state,a,t,n),l=ie.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:Q).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Me),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return De(e,s),u}else s.uniforms=ie.getUniforms(e),e.onBuild(n,s,y),e.onBeforeCompile(s,y),u=ie.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;const d=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),De(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotLightMatrix.value=i.state.spotLightMatrix,d.spotLightMap.value=i.state.spotLightMap,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function je(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=OM.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function De(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Pe.setAnimationLoop(function(e){Ce&&Ce(e)}),"undefined"!=typeof self&&Pe.setContext(self),this.setAnimationLoop=function(e){Ce=e,xe.setAnimationLoop(e),null===e?Pe.stop():Pe.start()},xe.addEventListener("sessionstart",Te),xe.addEventListener("sessionend",ke),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),f=se.get(e,v.length),f.init(),v.push(f),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(H),z=this.localClippingEnabled,F=le.init(this.clippingPlanes,z),m=oe.get(e,g.length),m.init(),g.push(m),Ae(e,t,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(L,I),this.info.render.frame++,!0===F&&le.beginShadows();const n=f.state.shadowsArray;if(ce.render(n,e,t),!0===F&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),!1!==xe.enabled&&!1!==xe.isPresenting&&!1!==xe.hasDepthSensing()||ue.render(m,e),f.setupLights(y._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];Ne(m,e,r,r.viewport)}}else Ne(m,e,t);null!==w&&(J.updateMultisampleRenderTarget(w),J.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),fe.resetDefaultState(),S=-1,M=null,v.pop(),f=v.length>0?v[v.length-1]:null,g.pop(),m=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const r=Z.get(e);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){w=e,x=t,b=n;let r=!0,i=null,a=!1,o=!1;if(e){const s=Z.get(e);void 0!==s.__useDefaultFramebuffer?(K.bindFramebuffer(ve.FRAMEBUFFER,null),r=!1):void 0===s.__webglFramebuffer?J.setupRenderTarget(e):s.__hasExternalTextures&&J.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],a=!0):i=q.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),C.copy(e.scissor),T=e.scissorTest}else E.copy(j).multiplyScalar(R).floor(),C.copy(D).multiplyScalar(R).floor(),T=O;if(K.bindFramebuffer(ve.FRAMEBUFFER,i)&&q.drawBuffers&&r&&K.drawBuffers(e,i),K.viewport(E),K.scissor(C),K.setScissorTest(T),a){const r=Z.get(e.texture);ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(o){const r=Z.get(e.texture),i=t||0;ve.framebufferTextureLayer(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){K.bindFramebuffer(ve.FRAMEBUFFER,s);try{const o=e.texture,s=o.format,l=o.type;if(s!==a_&&me.convert(s)!==ve.getParameter(ve.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===r_&&(X.has("EXT_color_buffer_half_float")||q.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(l===Jy||me.convert(l)===ve.getParameter(ve.IMPLEMENTATION_COLOR_READ_TYPE)||l===n_&&(q.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ve.readPixels(t,n,r,i,me.convert(s),me.convert(l),a)}finally{const e=null!==w?Z.get(w).__webglFramebuffer:null;K.bindFramebuffer(ve.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);J.setTexture2D(t,0),ve.copyTexSubImage2D(ve.TEXTURE_2D,n,0,0,e.x,e.y,i,a),K.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,a=t.image.height,o=me.convert(n.format),s=me.convert(n.type);J.setTexture2D(n,0),ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,n.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ve.texSubImage2D(ve.TEXTURE_2D,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(ve.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ve.texSubImage2D(ve.TEXTURE_2D,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&ve.generateMipmap(ve.TEXTURE_2D),K.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=Math.round(e.max.x-e.min.x),o=Math.round(e.max.y-e.min.y),s=e.max.z-e.min.z+1,l=me.convert(r.format),c=me.convert(r.type);let u;if(r.isData3DTexture)J.setTexture3D(r,0),u=ve.TEXTURE_3D;else{if(!r.isDataArrayTexture&&!r.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(r,0),u=ve.TEXTURE_2D_ARRAY}ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,r.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,r.unpackAlignment);const d=ve.getParameter(ve.UNPACK_ROW_LENGTH),h=ve.getParameter(ve.UNPACK_IMAGE_HEIGHT),p=ve.getParameter(ve.UNPACK_SKIP_PIXELS),m=ve.getParameter(ve.UNPACK_SKIP_ROWS),f=ve.getParameter(ve.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[i]:n.image;ve.pixelStorei(ve.UNPACK_ROW_LENGTH,g.width),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,g.height),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,e.min.x),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,e.min.y),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?ve.texSubImage3D(u,i,t.x,t.y,t.z,a,o,s,l,c,g.data):r.isCompressedArrayTexture?ve.compressedTexSubImage3D(u,i,t.x,t.y,t.z,a,o,s,l,g.data):ve.texSubImage3D(u,i,t.x,t.y,t.z,a,o,s,l,c,g),ve.pixelStorei(ve.UNPACK_ROW_LENGTH,d),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,h),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,p),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,m),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,f),0===i&&r.generateMipmaps&&ve.generateMipmap(u),K.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){x=0,b=0,w=null,K.reset(),fe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return L_}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===g_?"display-p3":"srgb",t.unpackColorSpace=ix.workingColorSpace===v_?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends RE{}).prototype.isWebGL1Renderer=!0;class LE extends Sb{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ob,this.environmentRotation=new ob,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class IE extends Hb{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Fb(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const jE=new xx,DE=new xx,OE=new Yx,UE=new Kx,FE=new Bx;class zE extends Sb{constructor(e=new rw,t=new IE){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)jE.fromBufferAttribute(t,e-1),DE.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=jE.distanceTo(DE);e.setAttribute("lineDistance",new Kb(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),FE.copy(n.boundingSphere),FE.applyMatrix4(r),FE.radius+=i,!1===e.ray.intersectsSphere(FE))return;OE.copy(r).invert(),UE.copy(e.ray).applyMatrix4(OE);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new xx,c=new xx,u=new xx,d=new xx,h=this.isLineSegments?2:1,p=n.index,m=n.attributes.position;if(null!==p){for(let n=Math.max(0,a.start),r=Math.min(p.count,a.start+a.count)-1;n<r;n+=h){const r=p.getX(n),i=p.getX(n+1);l.fromBufferAttribute(m,r),c.fromBufferAttribute(m,i);if(UE.distanceSqToSegment(l,c,d,u)>s)continue;d.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(d);a<e.near||a>e.far||t.push({distance:a,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,a.start),r=Math.min(m.count,a.start+a.count)-1;n<r;n+=h){l.fromBufferAttribute(m,n),c.fromBufferAttribute(m,n+1);if(UE.distanceSqToSegment(l,c,d,u)>s)continue;d.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(d);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const BE=new xx,HE=new xx;class VE extends zE{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)BE.fromBufferAttribute(t,e),HE.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+BE.distanceTo(HE);e.setAttribute("lineDistance",new Kb(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class GE extends rw{constructor(e=.5,t=1,n=32,r=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n);const o=[],s=[],l=[],c=[];let u=e;const d=(t-e)/(r=Math.max(1,r)),h=new xx,p=new X_;for(let m=0;m<=r;m++){for(let e=0;e<=n;e++){const r=i+e/n*a;h.x=u*Math.cos(r),h.y=u*Math.sin(r),s.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,c.push(p.x,p.y)}u+=d}for(let m=0;m<r;m++){const e=m*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,a=r+n+1,s=r+n+2,l=r+1;o.push(i,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new Kb(s,3)),this.setAttribute("normal",new Kb(l,3)),this.setAttribute("uv",new Kb(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new GE(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class WE extends rw{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new xx,d=new xx,h=[],p=[],m=[],f=[];for(let g=0;g<=n;g++){const h=[],v=g/n;let y=0;0===g&&0===a?y=.5/t:g===n&&s===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(r+s*i)*Math.sin(a+v*o),u.y=e*Math.cos(a+v*o),u.z=e*Math.sin(r+s*i)*Math.sin(a+v*o),p.push(u.x,u.y,u.z),d.copy(u).normalize(),m.push(d.x,d.y,d.z),f.push(s+y,1-v),h.push(l++)}c.push(h)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],r=c[g][e],i=c[g+1][e],o=c[g+1][e+1];(0!==g||a>0)&&h.push(t,r,o),(g!==n-1||s<Math.PI)&&h.push(r,i,o)}this.setIndex(h),this.setAttribute("position",new Kb(p,3)),this.setAttribute("normal",new Kb(m,3)),this.setAttribute("uv",new Kb(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new WE(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class $E extends Hb{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Fb(16777215),this.specular=new Fb(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fb(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X_(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ob,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class XE extends Sb{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Fb(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const qE=new Yx,KE=new xx,YE=new xx;class ZE{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new X_(512,512),this.map=null,this.mapPass=null,this.matrix=new Yx,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Gw,this._frameExtents=new X_(1,1),this._viewportCount=1,this._viewports=[new mx(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;KE.setFromMatrixPosition(e.matrixWorld),t.position.copy(KE),YE.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(YE),t.updateMatrixWorld(),qE.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qE),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(qE)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class JE extends ZE{constructor(){super(new oS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class QE extends XE{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sb.DEFAULT_UP),this.updateMatrix(),this.target=new Sb,this.shadow=new JE}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class eC extends XE{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const tC=new Yx;class nC{constructor(e,t,n=0,r=1/0){this.ray=new Kx(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new sb,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return tC.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(tC),this}intersectObject(e,t=!0,n=[]){return iC(e,this,n,t),n.sort(rC),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)iC(e[r],this,n,t);return n.sort(rC),n}}function rC(e,t){return e.distance-t.distance}function iC(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)iC(r[e],t,n,!0)}}class aC{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(z_(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class oC extends VE{constructor(e=10,t=10,n=4473924,r=8947848){n=new Fb(n),r=new Fb(r);const i=t/2,a=e/t,o=e/2,s=[],l=[];for(let u=0,d=0,h=-o;u<=t;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);const e=u===i?n:r;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new rw;c.setAttribute("position",new Kb(s,3)),c.setAttribute("color",new Kb(l,3));super(c,new IE({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dy}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=dy);const sC={type:"change"},lC={type:"start"},cC={type:"end"},uC=new Kx,dC=new Bw,hC=Math.cos(70*$_);class pC extends j_{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new xx,this.cursor=new xx,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:hy,MIDDLE:py,RIGHT:my},this.touches={ONE:fy,TWO:vy},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",K),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",K),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(sC),n.update(),i=r.NONE},this.update=function(){const t=new xx,u=(new _x).setFromUnitVectors(e.up,new xx(0,1,0)),d=u.clone().invert(),h=new xx,p=new _x,m=new xx,f=2*Math.PI;return function(g=null){const v=n.object.position;t.copy(v).sub(n.target),t.applyQuaternion(u),o.setFromVector3(t),n.autoRotate&&i===r.NONE&&C(function(e){return null!==e?2*Math.PI/60*n.autoRotateSpeed*e:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(o.theta+=s.theta*n.dampingFactor,o.phi+=s.phi*n.dampingFactor):(o.theta+=s.theta,o.phi+=s.phi);let y=n.minAzimuthAngle,w=n.maxAzimuthAngle;isFinite(y)&&isFinite(w)&&(y<-Math.PI?y+=f:y>Math.PI&&(y-=f),w<-Math.PI?w+=f:w>Math.PI&&(w-=f),o.theta=y<=w?Math.max(y,Math.min(w,o.theta)):o.theta>(y+w)/2?Math.max(y,o.theta):Math.min(w,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let S=!1;if(n.zoomToCursor&&b||n.object.isOrthographicCamera)o.radius=I(o.radius);else{const e=o.radius;o.radius=I(o.radius*l),S=e!=o.radius}if(t.setFromSpherical(o),t.applyQuaternion(d),v.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(s.theta*=1-n.dampingFactor,s.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(s.set(0,0,0),c.set(0,0,0)),n.zoomToCursor&&b){let r=null;if(n.object.isPerspectiveCamera){const e=t.length();r=I(e*l);const i=e-r;n.object.position.addScaledVector(_,i),n.object.updateMatrixWorld(),S=!!i}else if(n.object.isOrthographicCamera){const e=new xx(x.x,x.y,0);e.unproject(n.object);const i=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),S=i!==n.object.zoom;const a=new xx(x.x,x.y,0);a.unproject(n.object),n.object.position.sub(a).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(uC.origin.copy(n.object.position),uC.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(uC.direction))<hC?e.lookAt(n.target):(dC.setFromNormalAndCoplanarPoint(n.object.up,n.target),uC.intersectPlane(dC,n.target))))}else if(n.object.isOrthographicCamera){const e=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),e!==n.object.zoom&&(n.object.updateProjectionMatrix(),S=!0)}return l=1,b=!1,!!(S||h.distanceToSquared(n.object.position)>a||8*(1-p.dot(n.object.quaternion))>a||m.distanceToSquared(n.target)>a)&&(n.dispatchEvent(sC),h.copy(n.object.position),p.copy(n.object.quaternion),m.copy(n.target),!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Z),n.domElement.removeEventListener("pointerdown",V),n.domElement.removeEventListener("pointercancel",W),n.domElement.removeEventListener("wheel",$),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",W);n.domElement.getRootNode().removeEventListener("keydown",X,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",K),n._domElementKeyEvents=null)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=r.NONE;const a=1e-6,o=new aC,s=new aC;let l=1;const c=new xx,u=new X_,d=new X_,h=new X_,p=new X_,m=new X_,f=new X_,g=new X_,v=new X_,y=new X_,_=new xx,x=new X_;let b=!1;const w=[],S={};let M=!1;function E(e){const t=Math.abs(.01*e);return Math.pow(.95,n.zoomSpeed*t)}function C(e){s.theta-=e}function T(e){s.phi-=e}const k=function(){const e=new xx;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),c.add(e)}}(),P=function(){const e=new xx;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),A=function(){const e=new xx;return function(t,r){const i=n.domElement;if(n.object.isPerspectiveCamera){const a=n.object.position;e.copy(a).sub(n.target);let o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),k(2*t*o/i.clientHeight,n.object.matrix),P(2*r*o/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(k(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),P(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function N(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(e,t){if(!n.zoomToCursor)return;b=!0;const r=n.domElement.getBoundingClientRect(),i=e-r.left,a=t-r.top,o=r.width,s=r.height;x.x=i/o*2-1,x.y=-a/s*2+1,_.set(x.x,x.y,1).unproject(n.object).sub(n.object.position).normalize()}function I(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function j(e){u.set(e.clientX,e.clientY)}function D(e){p.set(e.clientX,e.clientY)}function O(e){if(1===w.length)u.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);u.set(n,r)}}function U(e){if(1===w.length)p.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}}function F(e){const t=Q(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);g.set(0,i)}function z(e){if(1==w.length)d.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);d.set(n,r)}h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*h.x/t.clientHeight),T(2*Math.PI*h.y/t.clientHeight),u.copy(d)}function B(e){if(1===w.length)m.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}f.subVectors(m,p).multiplyScalar(n.panSpeed),A(f.x,f.y),p.copy(m)}function H(e){const t=Q(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);v.set(0,a),y.set(0,Math.pow(v.y/g.y,n.zoomSpeed)),N(y.y),g.copy(v);L(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}function V(e){!1!==n.enabled&&(0===w.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",G),n.domElement.addEventListener("pointerup",W)),function(e){for(let t=0;t<w.length;t++)if(w[t]==e.pointerId)return!0;return!1}(e)||(function(e){w.push(e.pointerId)}(e),"touch"===e.pointerType?Y(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case py:if(!1===n.enableZoom)return;!function(e){L(e.clientX,e.clientX),g.set(e.clientX,e.clientY)}(e),i=r.DOLLY;break;case hy:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;D(e),i=r.PAN}else{if(!1===n.enableRotate)return;j(e),i=r.ROTATE}break;case my:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;j(e),i=r.ROTATE}else{if(!1===n.enablePan)return;D(e),i=r.PAN}break;default:i=r.NONE}i!==r.NONE&&n.dispatchEvent(lC)}(e)))}function G(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),i){case r.TOUCH_ROTATE:if(!1===n.enableRotate)return;z(e),n.update();break;case r.TOUCH_PAN:if(!1===n.enablePan)return;B(e),n.update();break;case r.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&H(e),n.enablePan&&B(e)}(e),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&H(e),n.enableRotate&&z(e)}(e),n.update();break;default:i=r.NONE}}(e):function(e){switch(i){case r.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*h.x/t.clientHeight),T(2*Math.PI*h.y/t.clientHeight),u.copy(d),n.update()}(e);break;case r.DOLLY:if(!1===n.enableZoom)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,g),y.y>0?N(E(y.y)):y.y<0&&R(E(y.y)),g.copy(v),n.update()}(e);break;case r.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY),f.subVectors(m,p).multiplyScalar(n.panSpeed),A(f.x,f.y),p.copy(m),n.update()}(e)}}(e))}function W(e){switch(function(e){delete S[e.pointerId];for(let t=0;t<w.length;t++)if(w[t]==e.pointerId)return void w.splice(t,1)}(e),w.length){case 0:n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",W),n.dispatchEvent(cC),i=r.NONE;break;case 1:const t=w[0],a=S[t];Y({pointerId:t,pageX:a.x,pageY:a.y})}}function $(e){!1!==n.enabled&&!1!==n.enableZoom&&i===r.NONE&&(e.preventDefault(),n.dispatchEvent(lC),function(e){L(e.clientX,e.clientY),e.deltaY<0?R(E(e.deltaY)):e.deltaY>0&&N(E(e.deltaY)),n.update()}(function(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}e.ctrlKey&&!M&&(n.deltaY*=10);return n}(e)),n.dispatchEvent(cC))}function X(e){if("Control"===e.key){M=!0;n.domElement.getRootNode().addEventListener("keyup",q,{passive:!0,capture:!0})}}function q(e){if("Control"===e.key){M=!1;n.domElement.getRootNode().removeEventListener("keyup",q,{passive:!0,capture:!0})}}function K(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?T(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?T(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?C(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?C(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function Y(e){switch(J(e),w.length){case 1:switch(n.touches.ONE){case fy:if(!1===n.enableRotate)return;O(e),i=r.TOUCH_ROTATE;break;case gy:if(!1===n.enablePan)return;U(e),i=r.TOUCH_PAN;break;default:i=r.NONE}break;case 2:switch(n.touches.TWO){case vy:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&F(e),n.enablePan&&U(e)}(e),i=r.TOUCH_DOLLY_PAN;break;case yy:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&F(e),n.enableRotate&&O(e)}(e),i=r.TOUCH_DOLLY_ROTATE;break;default:i=r.NONE}break;default:i=r.NONE}i!==r.NONE&&n.dispatchEvent(lC)}function Z(e){!1!==n.enabled&&e.preventDefault()}function J(e){let t=S[e.pointerId];void 0===t&&(t=new X_,S[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){const t=e.pointerId===w[0]?w[1]:w[0];return S[t]}n.domElement.addEventListener("contextmenu",Z),n.domElement.addEventListener("pointerdown",V),n.domElement.addEventListener("pointercancel",W),n.domElement.addEventListener("wheel",$,{passive:!1});n.domElement.getRootNode().addEventListener("keydown",X,{passive:!0,capture:!0}),this.update()}}function mC({isOpen:e,onClose:t,onSelect:n,currentAngle:r}){const i=kt.useRef(null),a=kt.useRef(null),o=kt.useRef(null),s=kt.useRef(null),l=kt.useRef(null),c=kt.useRef(null),u=kt.useRef(new Map),d=kt.useRef(new nC),h=kt.useRef(new X_),p=kt.useRef(0),m=kt.useRef(!1),[f,g]=kt.useState(r),[v,y]=kt.useState(null),[_,x]=kt.useState({directions:ry.map(()=>!0),heights:iy.map(()=>!0),sizes:ay.map(()=>!0)});kt.useEffect(()=>{if(!e||!i.current||m.current)return;const t=i.current,n=a.current;if(!n)return;console.log("Initializing Three.js scene...");const r=new LE;r.background=new Fb(1710618),o.current=r;const d=new Lw(45,n.clientWidth/n.clientHeight,.1,1e3);d.position.set(0,3,6),s.current=d;const h=new RE({canvas:t,antialias:!0,alpha:!0});h.setSize(n.clientWidth,n.clientHeight),h.setPixelRatio(Math.min(window.devicePixelRatio,2)),l.current=h;const f=new pC(d,h.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=3,f.maxDistance=10,f.target.set(0,1.5,0),f.enablePan=!1,c.current=f;const g=new eC(16777215,.6);r.add(g);const v=new QE(16777215,.8);v.position.set(5,10,7),r.add(v);const y=new oC(10,10,4473924,2236962);y.position.y=0,r.add(y);const _=new WE(.15,16,16),x=new Vb({color:16777215}),b=new bw(_,x);b.position.set(0,1,0),r.add(b);[.3,1,1.7,2.4].forEach(e=>{const t=new GE(3.5,3.6,64),n=new Vb({color:4473924,side:2,transparent:!0,opacity:.3}),i=new bw(t,n);i.rotation.x=-Math.PI/2,i.position.y=e,r.add(i)}),console.log("Creating markers for",ly.length,"angles"),ly.forEach(e=>{const[t,n,i]=function(e){const t=ry.indexOf(e.direction),n=iy.indexOf(e.height),r=ay.indexOf(e.size),i=t/ry.length*Math.PI*2,a=[2,2.5,3][r],o=[.3,1,1.7,2.4][n];return[Math.sin(i)*a,o,Math.cos(i)*a]}(e),a=function(e){const t=ry.indexOf(e);if(0===t)return 65280;if(4===t)return 16711680;const n=t/ry.length;return Math.floor(255*n)<<16|Math.floor(255*(1-n))<<8}(e.direction),o=new WE(.1,16,16),s=new $E({color:a,emissive:a,emissiveIntensity:.3}),l=new bw(o,s);l.position.set(t,n,i),l.userData={angle:e},r.add(l),u.current.set(e.id,l)}),console.log("Created",u.current.size,"markers");const w=()=>{n&&d&&h&&(d.aspect=n.clientWidth/n.clientHeight,d.updateProjectionMatrix(),h.setSize(n.clientWidth,n.clientHeight))};window.addEventListener("resize",w),m.current=!0;const S=()=>{p.current=requestAnimationFrame(S),f.update(),h.render(r,d)};return S(),console.log("Three.js scene initialized successfully"),()=>{console.log("Cleaning up Three.js scene..."),window.removeEventListener("resize",w),cancelAnimationFrame(p.current),f.dispose(),h.dispose(),u.current.forEach(e=>{e.geometry.dispose(),e.material.dispose()}),u.current.clear(),m.current=!1,o.current=null,s.current=null,l.current=null,c.current=null}},[e]),kt.useEffect(()=>{m.current&&ly.forEach(e=>{const t=u.current.get(e.id);if(t){const n=_.directions[ry.indexOf(e.direction)],r=_.heights[iy.indexOf(e.height)],i=_.sizes[ay.indexOf(e.size)];t.visible=n&&r&&i}})},[_]),kt.useEffect(()=>{if(m.current&&(u.current.forEach(e=>{e.material.emissiveIntensity=.3,e.scale.set(1,1,1)}),f)){const e=u.current.get(f.id);if(e){e.material.emissiveIntensity=1,e.scale.set(1.5,1.5,1.5)}}},[f]);const b=kt.useCallback(e=>{if(!(i.current&&s.current&&o.current&&m.current))return void console.log("Canvas click ignored - not initialized");const t=i.current.getBoundingClientRect();h.current.x=(e.clientX-t.left)/t.width*2-1,h.current.y=-(e.clientY-t.top)/t.height*2+1,console.log("Click at:",h.current.x,h.current.y),d.current.setFromCamera(h.current,s.current);const n=[];u.current.forEach(e=>{e.visible&&n.push(e)}),console.log("Checking",n.length,"visible markers");const r=d.current.intersectObjects(n);if(console.log("Intersections:",r.length),r.length>0){const e=r[0].object.userData.angle;console.log("Selected angle:",e.displayName),g(e)}},[]),w=kt.useCallback(e=>{if(!(i.current&&s.current&&o.current&&m.current))return;const t=i.current.getBoundingClientRect();h.current.x=(e.clientX-t.left)/t.width*2-1,h.current.y=-(e.clientY-t.top)/t.height*2+1,d.current.setFromCamera(h.current,s.current);const n=[];u.current.forEach(e=>{e.visible&&n.push(e)});const r=d.current.intersectObjects(n);if(r.length>0){const e=r[0].object.userData.angle;y(e),i.current.style.cursor="pointer"}else y(null),i.current.style.cursor="default"},[]),S=kt.useCallback((e,t,n)=>{x(r=>({...r,[e]:r[e].map((e,r)=>r===t?n:e)}))},[]),M=kt.useCallback((e,t)=>{x(n=>({...n,[e]:n[e].map(()=>t)}))},[]),E=kt.useCallback(()=>{f&&n(f),t()},[f,n,t]);return kt.useEffect(()=>{e&&g(r)},[e,r]),e?Ot.jsx("div",{className:"camera-angle-overlay",onClick:t,children:Ot.jsxs("div",{className:"camera-angle-modal",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("header",{className:"camera-angle-header",children:[Ot.jsx("h2",{children:"Select Camera Angle"}),Ot.jsx("button",{className:"camera-angle-close",onClick:t,children:""})]}),Ot.jsxs("div",{className:"camera-angle-content",children:[Ot.jsxs("aside",{className:"camera-angle-filters",children:[Ot.jsxs("div",{className:"filter-group",children:[Ot.jsxs("div",{className:"filter-group-header",children:[Ot.jsx("label",{children:"View Direction"}),Ot.jsx("button",{className:"filter-toggle-all",onClick:()=>M("directions",!_.directions.every(Boolean)),children:_.directions.every(Boolean)?"None":"All"})]}),Ot.jsx("div",{className:"filter-checkboxes",children:ry.map((e,t)=>Ot.jsxs("label",{className:"filter-checkbox",children:[Ot.jsx("input",{type:"checkbox",checked:_.directions[t],onChange:e=>S("directions",t,e.target.checked)}),Ot.jsx("span",{className:"checkbox-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),Ot.jsxs("div",{className:"filter-group",children:[Ot.jsxs("div",{className:"filter-group-header",children:[Ot.jsx("label",{children:"Height"}),Ot.jsx("button",{className:"filter-toggle-all",onClick:()=>M("heights",!_.heights.every(Boolean)),children:_.heights.every(Boolean)?"None":"All"})]}),Ot.jsx("div",{className:"filter-checkboxes",children:iy.map((e,t)=>Ot.jsxs("label",{className:"filter-checkbox",children:[Ot.jsx("input",{type:"checkbox",checked:_.heights[t],onChange:e=>S("heights",t,e.target.checked)}),Ot.jsx("span",{className:"checkbox-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),Ot.jsxs("div",{className:"filter-group",children:[Ot.jsxs("div",{className:"filter-group-header",children:[Ot.jsx("label",{children:"Shot Size"}),Ot.jsx("button",{className:"filter-toggle-all",onClick:()=>M("sizes",!_.sizes.every(Boolean)),children:_.sizes.every(Boolean)?"None":"All"})]}),Ot.jsx("div",{className:"filter-checkboxes",children:ay.map((e,t)=>Ot.jsxs("label",{className:"filter-checkbox",children:[Ot.jsx("input",{type:"checkbox",checked:_.sizes[t],onChange:e=>S("sizes",t,e.target.checked)}),Ot.jsx("span",{className:"checkbox-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]})]}),Ot.jsxs("div",{className:"camera-angle-canvas-container",ref:a,children:[Ot.jsx("canvas",{ref:i,onClick:b,onMouseMove:w}),v&&Ot.jsx("div",{className:"camera-angle-tooltip",children:v.displayName})]})]}),Ot.jsxs("footer",{className:"camera-angle-footer",children:[Ot.jsx("div",{className:"camera-angle-selected",children:f?Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("span",{className:"selected-label",children:"Selected:"}),Ot.jsx("span",{className:"selected-value",children:f.displayName}),Ot.jsx("code",{className:"selected-prompt",children:f.prompt})]}):Ot.jsx("span",{className:"selected-empty",children:"No angle selected"})}),Ot.jsxs("div",{className:"camera-angle-actions",children:[Ot.jsx("button",{className:"camera-angle-btn secondary",onClick:t,children:"Cancel"}),Ot.jsx("button",{className:"camera-angle-btn primary",onClick:E,disabled:!f,children:"Apply Angle"})]})]})]})}):null}function fC({parameter:e,value:t,onChange:n,disabled:r}){const[i,a]=kt.useState(t??e.default);kt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=kt.useCallback(t=>{const r=parseInt(t.target.value);a(r),n(e.name,r)},[e.name,n]),s=kt.useCallback(t=>{const r=parseInt(t.target.value)||0;a(r),n(e.name,r)},[e.name,n]),l=e.constraints||{};return Ot.jsxs("div",{className:"parameter-widget integer-widget",children:[Ot.jsx("label",{className:"parameter-label",children:e.display_name}),Ot.jsxs("div",{className:"parameter-control",children:[Ot.jsx("input",{type:"range",className:"parameter-slider",min:l.min??0,max:l.max??100,step:l.step??1,value:i,onChange:o,disabled:r}),Ot.jsx("input",{type:"number",className:"parameter-input",min:l.min??0,max:l.max??100,step:l.step??1,value:i,onChange:s,disabled:r})]}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description})]})}function gC({parameter:e,value:t,onChange:n,disabled:r}){const[i,a]=kt.useState(t??e.default);kt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=kt.useCallback(t=>{const r=parseFloat(t.target.value);a(r),n(e.name,r)},[e.name,n]),s=kt.useCallback(t=>{const r=parseFloat(t.target.value)||0;a(r),n(e.name,r)},[e.name,n]),l=e.constraints||{};return Ot.jsxs("div",{className:"parameter-widget float-widget",children:[Ot.jsx("label",{className:"parameter-label",children:e.display_name}),Ot.jsxs("div",{className:"parameter-control",children:[Ot.jsx("input",{type:"range",className:"parameter-slider",min:l.min??0,max:l.max??1,step:l.step??.01,value:i,onChange:o,disabled:r}),Ot.jsx("input",{type:"number",className:"parameter-input",min:l.min??0,max:l.max??1,step:l.step??.01,value:i,onChange:s,disabled:r})]}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description})]})}function vC({parameter:e,value:t,onChange:n,disabled:r}){const{t:i}=yf(),[a,o]=kt.useState(t??e.default);kt.useEffect(()=>{o(t??e.default)},[t,e.default]);const s=kt.useCallback(t=>{const r=parseInt(t.target.value)||-1;o(r),n(e.name,r)},[e.name,n]),l=kt.useCallback(()=>{const t=Math.floor(2147483647*Math.random());o(t),n(e.name,t)},[e.name,n]);return Ot.jsxs("div",{className:"parameter-widget seed-widget",children:[Ot.jsx("label",{className:"parameter-label",children:e.display_name}),Ot.jsxs("div",{className:"parameter-control seed-control",children:[Ot.jsx("input",{type:"number",className:"parameter-input seed-input",value:a,onChange:s,disabled:r}),Ot.jsx("button",{className:"seed-randomize-btn",onClick:l,disabled:r,title:i("storyboard.parameters.randomizeSeed"),children:""})]}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description})]})}function yC({parameter:e,value:t,onChange:n,disabled:r}){var i;const[a,o]=kt.useState(t??e.default);kt.useEffect(()=>{o(t??e.default)},[t,e.default]);const s=kt.useCallback(t=>{const r=t.target.value;o(r),n(e.name,r)},[e.name,n]),l=(null==(i=e.constraints)?void 0:i.options)||[];return Ot.jsxs("div",{className:"parameter-widget enum-widget",children:[Ot.jsx("label",{className:"parameter-label",children:e.display_name}),Ot.jsx("select",{className:"parameter-select",value:a,onChange:s,disabled:r,children:l.map(e=>Ot.jsx("option",{value:e,children:e},e))}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description})]})}function _C({parameter:e,value:t,onChange:n,disabled:r}){const[i,a]=kt.useState(t??e.default);kt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=kt.useCallback(t=>{const r=t.target.checked;a(r),n(e.name,r)},[e.name,n]);return Ot.jsxs("div",{className:"parameter-widget boolean-widget",children:[Ot.jsxs("label",{className:"parameter-label boolean-label",children:[Ot.jsx("input",{type:"checkbox",className:"parameter-checkbox",checked:i,onChange:o,disabled:r}),Ot.jsx("span",{children:e.display_name})]}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description})]})}function xC({parameter:e,value:t,onChange:n,disabled:r,onEnhance:i,cameraAngle:a,onCameraAngleChange:o}){const{t:s}=yf(),{cpePromptForStoryboard:l,setCpePromptForStoryboard:c}=zf(),u="string"==typeof t?t:t?String(t):"",[d,h]=kt.useState(u??e.default??""),[p,m]=kt.useState(!1),[f,g]=kt.useState(!1);kt.useEffect(()=>{const n="string"==typeof t?t:t?String(t):"";h(n??e.default??"")},[t,e.default]);const v=kt.useCallback(t=>{const r=t.target.value;h(r),n(e.name,r)},[e.name,n]),y=kt.useCallback(()=>{l&&(h(l),n(e.name,l),c(null))},[l,e.name,n,c]),_=kt.useCallback(async()=>{if(i&&d.trim()&&!p){m(!0);try{const t=await i(d);h(t),n(e.name,t)}catch(t){console.error("Failed to enhance prompt:",t)}finally{m(!1)}}},[d,i,p,e.name,n]),x=kt.useCallback(t=>{const r=uy(d),i=`${t.prompt} ${r}`.trim();h(i),n(e.name,i),null==o||o(t)},[d,e.name,n,o]),b=kt.useCallback(()=>{const t=uy(d);h(t),n(e.name,t),null==o||o(null)},[d,e.name,n,o]);kt.useEffect(()=>{const e=cy(d);(null==e?void 0:e.id)!==(null==a?void 0:a.id)&&(null==o||o(e))},[d,null==a?void 0:a.id,o]);const w=e.name.includes("negative"),S=w?"prompt-textarea negative":"prompt-textarea positive",M=i&&!w;return Ot.jsxs("div",{className:"parameter-widget prompt-widget",children:[a&&!w&&Ot.jsxs("div",{className:"camera-angle-badge",children:[Ot.jsx("span",{className:"badge-icon",children:""}),Ot.jsx("span",{className:"badge-text",children:a.displayName}),Ot.jsx("button",{className:"badge-clear",onClick:b,title:s("storyboard.parameters.clearAngle"),disabled:r,children:""})]}),Ot.jsxs("div",{className:"prompt-header",children:[Ot.jsx("label",{className:"parameter-label",children:e.display_name}),Ot.jsxs("div",{className:"prompt-toolbar",children:[!w&&l&&Ot.jsx("button",{className:"cpe-paste-btn",onClick:y,disabled:r,title:s("storyboard.parameters.pasteFromCpe"),children:""}),!w&&Ot.jsx("button",{className:"angle-selector-btn "+(a?"has-angle":""),onClick:()=>g(!0),disabled:r,title:s("storyboard.parameters.selectCameraAngle"),children:""}),M&&Ot.jsx("button",{className:"ai-enhance-btn "+(p?"enhancing":""),onClick:_,disabled:r||p||!d.trim(),title:s(p?"storyboard.parameters.enhancingPrompt":"storyboard.parameters.enhanceWithAi"),children:p?"...":""})]})]}),Ot.jsx("textarea",{className:S,value:d,onChange:v,disabled:r,rows:4,placeholder:s(w?"storyboard.parameters.promptPlaceholderNegative":"storyboard.parameters.promptPlaceholderPositive")}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description}),!w&&Ot.jsx(mC,{isOpen:f,onClose:()=>g(!1),onSelect:x,currentAngle:a??null})]})}function bC({parameter:e,value:t,onChange:n,disabled:r,comfyUrl:i}){const a=kt.useCallback((t,r)=>{n(e.name,r)},[e.name,n]),o="__BYPASSED__"===t,s=kt.useCallback(t=>{n(e.name,t?"__BYPASSED__":null)},[e.name,n]);return Ot.jsx(ny,{name:e.name,displayName:e.display_name,value:o?null:t,onChange:a,disabled:r,acceptType:"image",isBypassed:o,onBypassChange:s,comfyUrl:i})}function wC({parameter:e,value:t,onChange:n,disabled:r,comfyUrl:i}){const a=kt.useCallback((t,r)=>{n(e.name,r)},[e.name,n]),o="__BYPASSED__"===t,s=kt.useCallback(t=>{n(e.name,t?"__BYPASSED__":null)},[e.name,n]);return Ot.jsx(ny,{name:e.name,displayName:e.display_name,value:o?null:t,onChange:a,disabled:r,acceptType:"video",isBypassed:o,onBypassChange:s,comfyUrl:i})}function SC({parameter:e,value:t,onChange:n,disabled:r,comfyUrl:i}){const a=kt.useCallback((t,r)=>{n(e.name,r)},[e.name,n]),o="__BYPASSED__"===t,s=kt.useCallback(t=>{n(e.name,t?"__BYPASSED__":null)},[e.name,n]);return Ot.jsx(ny,{name:e.name,displayName:e.display_name,value:o?null:t,onChange:a,disabled:r,acceptType:"any",isBypassed:o,onBypassChange:s,comfyUrl:i})}function MC({parameter:e,value:t,onChange:n,disabled:r,availableLoras:i=[],onBypassChange:a,isBypassed:o=!1}){var s;const{t:l}=yf(),c="object"==typeof t&&null!==t,[u,d]=kt.useState(c?t.lora_name:(null==(s=e.constraints)?void 0:s.lora_name)||""),[h,p]=kt.useState(c?t.strength:"number"==typeof t?t:e.default??1),[m,f]=kt.useState(c?t.bypassed??o:o);kt.useEffect(()=>{"object"==typeof t&&null!==t?(d(t.lora_name||""),p(t.strength??1),f(t.bypassed??!1)):"number"==typeof t&&p(t)},[t]),kt.useEffect(()=>{f(o)},[o]);const g=kt.useCallback(r=>{const i=r.target.value;d(i),c?n(e.name,{...t,lora_name:i}):n(e.name+"_lora_name",i)},[e.name,n,t,c]),v=kt.useCallback(r=>{const i=parseFloat(r.target.value);p(i),n(e.name,c?{...t,strength:i}:i)},[e.name,n,t,c]),y=kt.useCallback(()=>{const r=!m;f(r),a&&a(e.name,r),c&&n(e.name,{...t,bypassed:r})},[m,e.name,n,a,t,c]),_=e.constraints||{},x=e=>{if(!e)return"";return(e.split(/[/\\]/).pop()||e).replace(/\.safetensors$|\.ckpt$/i,"")};return Ot.jsxs("div",{className:"parameter-widget lora-widget "+(m?"bypassed":""),children:[Ot.jsxs("div",{className:"lora-header",children:[Ot.jsx("label",{className:"parameter-label",children:e.display_name}),Ot.jsx("button",{className:"bypass-toggle "+(m?"bypassed":"active"),onClick:y,disabled:r,title:l(m?"storyboard.parameters.lora.enable":"storyboard.parameters.lora.bypass"),children:m?` ${l("storyboard.parameters.lora.bypassed")}`:` ${l("storyboard.parameters.lora.active")}`})]}),!m&&Ot.jsxs("div",{className:"lora-controls",children:[i.length>0&&Ot.jsx("div",{className:"lora-dropdown-container",children:Ot.jsxs("select",{className:"parameter-select lora-select",value:u,onChange:g,disabled:r,children:[Ot.jsx("option",{value:"",children:l("storyboard.parameters.lora.selectPlaceholder")}),i.map(e=>Ot.jsx("option",{value:e,children:x(e)},e))]})}),Ot.jsxs("div",{className:"lora-strength-container",children:[Ot.jsx("label",{className:"strength-label",children:l("storyboard.parameters.lora.strength")}),Ot.jsxs("div",{className:"parameter-control",children:[Ot.jsx("input",{type:"range",className:"parameter-slider",min:_.min??-2,max:_.max??2,step:_.step??.01,value:h,onChange:v,disabled:r}),Ot.jsx("input",{type:"number",className:"parameter-input",min:_.min??-2,max:_.max??2,step:_.step??.01,value:h,onChange:v,disabled:r})]})]})]}),m&&Ot.jsxs("div",{className:"lora-bypassed-placeholder",children:[Ot.jsx("span",{className:"bypassed-icon",children:""}),Ot.jsx("span",{className:"bypassed-text",children:l("storyboard.parameters.lora.bypassedHint")})]}),e.description&&Ot.jsx("span",{className:"parameter-description",children:e.description})]})}function EC({parameter:e,value:t,onChange:n,disabled:r,onEnhancePrompt:i,cameraAngle:a,onCameraAngleChange:o,comfyUrl:s}){var l,c;switch(e.type){case"integer":return Ot.jsx(fC,{parameter:e,value:t,onChange:n,disabled:r});case"float":return Ot.jsx(gC,{parameter:e,value:t,onChange:n,disabled:r});case"seed":return Ot.jsx(vC,{parameter:e,value:t,onChange:n,disabled:r});case"enum":return Ot.jsx(yC,{parameter:e,value:t,onChange:n,disabled:r});case"boolean":return Ot.jsx(_C,{parameter:e,value:t,onChange:n,disabled:r});case"prompt":return Ot.jsx(xC,{parameter:e,value:t,onChange:n,disabled:r,onEnhance:i,cameraAngle:a,onCameraAngleChange:t=>null==o?void 0:o(e.name,t)});case"image":case"image_list":return Ot.jsx(bC,{parameter:e,value:t,onChange:n,disabled:r,comfyUrl:s});case"video":case"video_list":return Ot.jsx(wC,{parameter:e,value:t,onChange:n,disabled:r,comfyUrl:s});case"media":return Ot.jsx(SC,{parameter:e,value:t,onChange:n,disabled:r,comfyUrl:s});case"lora":return Ot.jsx(MC,{parameter:e,value:t,onChange:n,disabled:r,availableLoras:(null==(l=e.constraints)?void 0:l.availableLoras)||[],isBypassed:(null==(c=e.constraints)?void 0:c.bypassed)||!1});default:return Ot.jsx(xC,{parameter:e,value:t,onChange:n,disabled:r,onEnhance:i})}}function CC({parameters:e,values:t,onChange:n,disabled:r,onEnhancePrompt:i,cameraAngles:a,onCameraAngleChange:o,comfyUrl:s}){const{t:l}=yf();return 0===e.length?Ot.jsx("div",{className:"parameter-panel empty",children:Ot.jsx("p",{children:l("storyboard.parameters.empty")})}):Ot.jsxs("div",{className:"parameter-panel",children:[Ot.jsx("div",{className:"parameter-panel-title",children:l("storyboard.parameters.title")}),Ot.jsx("div",{className:"parameter-list",children:e.map(e=>Ot.jsx(EC,{parameter:e,value:t[e.name],onChange:n,disabled:r,onEnhancePrompt:i,cameraAngle:(null==a?void 0:a[e.name])??null,onCameraAngleChange:o,comfyUrl:s},e.name))})]})}const TC=new class{constructor(){je(this,"cache",null),je(this,"cacheTimestamp",0),je(this,"cacheTTL",3e5),je(this,"fetchPromise",null)}async fetchDefinitions(e){const t=Date.now();if(this.cache&&t-this.cacheTimestamp<this.cacheTTL)return this.cache;if(this.fetchPromise)return this.fetchPromise;this.fetchPromise=this._doFetch(e);try{return this.cache=await this.fetchPromise,this.cacheTimestamp=t,this.cache}finally{this.fetchPromise=null}}async _doFetch(e){const t=e.replace(/\/ws$/,"").replace(/\/$/,""),n=await fetch(`${t}/object_info`);if(!n.ok)throw new Error(`Failed to fetch object_info: ${n.statusText}`);const r=await n.json();return console.log(`[NodeDefinitions] Loaded ${Object.keys(r).length} node definitions`),r}getNodeDefinition(e){return this.cache&&this.cache[e]||null}getEnumOptions(e,t){var n,r;const i=this.getNodeDefinition(e);if(!i)return null;if(null==(n=i.input.required)?void 0:n[t]){const e=i.input.required[t];return this._extractEnumOptions(e)}if(null==(r=i.input.optional)?void 0:r[t]){const e=i.input.optional[t];return this._extractEnumOptions(e)}return null}_extractEnumOptions(e){if(Array.isArray(e)){const[t]=e;if(Array.isArray(t))return t}return null}getInputDefinition(e,t){const n=this.getNodeDefinition(e);if(!n)return null;const r=e=>{if(!(null==e?void 0:e[t]))return null;const n=e[t];if(Array.isArray(n)){const[e,t]=n;return Array.isArray(e)?{type:"enum",isEnum:!0,options:e,default:(null==t?void 0:t.default)??e[0]}:{type:e,isEnum:!1,min:null==t?void 0:t.min,max:null==t?void 0:t.max,step:null==t?void 0:t.step,default:null==t?void 0:t.default}}return{type:String(n),isEnum:!1}};return r(n.input.required)||r(n.input.optional)}isLoaded(){return null!==this.cache}async getLoras(e){return await this.fetchDefinitions(e),this.getEnumOptions("LoraLoader","lora_name")||[]}clearCache(){this.cache=null,this.cacheTimestamp=0}},kC={seed:"seed",steps:"integer",cfg:"float",denoise:"float",strength:"float",noise_seed:"seed",text:"prompt",prompt:"prompt",positive:"prompt",negative:"prompt",width:"integer",height:"integer",batch_size:"integer",sampler_name:"enum",scheduler:"enum"},PC={sampler_name:["euler","euler_cfg_pp","euler_ancestral","euler_ancestral_cfg_pp","heun","heunpp2","dpm_2","dpm_2_ancestral","lms","dpm_fast","dpm_adaptive","dpmpp_2s_ancestral","dpmpp_sde","dpmpp_2m","ddpm","lcm","ipndm","ddim","uni_pc"],scheduler:["normal","karras","exponential","sgm_uniform","simple"]};function AC({workflow:e,parsedWorkflow:t,initialConfig:n,comfyUrl:r,onSave:i,onCancel:a}){const{t:o}=yf(),[s,l]=kt.useState([]),[c,u]=kt.useState(null),[d,h]=kt.useState("exposed"),[p,m]=kt.useState(""),[f,g]=kt.useState(!1),[v,y]=kt.useState(null),_=kt.useRef(null),[x,b]=kt.useState(!1),[w,S]=kt.useState([]);kt.useEffect(()=>{r&&!x&&(TC.fetchDefinitions(r).then(()=>{b(!0),console.log("[WorkflowEditor] Node definitions loaded")}).catch(e=>{console.error("[WorkflowEditor] Failed to load node definitions:",e)}),TC.getLoras(r).then(e=>{S(e),console.log(`[WorkflowEditor] Loaded ${e.length} available LoRAs`)}).catch(e=>{console.error("[WorkflowEditor] Failed to load LoRAs:",e)}))},[r,x]),kt.useEffect(()=>{if(n&&n.length>0){const e=[...n].sort((e,t)=>e.order-t.order);l(e)}else if(t){const e=[];t.parameters.forEach((t,n)=>{e.push({name:t.name,display_name:t.display_name,node_id:t.node_id,input_name:t.input_name,type:t.type,default:t.default,description:t.description,constraints:t.constraints,order:n,exposed:!0,category:"parameter",auto_detected:!0,user_modified:!1})}),t.image_inputs.forEach((n,r)=>{e.push({name:n.name,display_name:n.display_name,node_id:n.node_id,input_name:n.input_name,type:"image",default:"",description:n.description,order:t.parameters.length+r,exposed:!0,category:"image_input",auto_detected:!0,user_modified:!1})}),t.loras.forEach((n,r)=>{e.push({name:n.name,display_name:n.display_name,node_id:n.node_id,input_name:"strength_model",type:"lora",default:n.default_strength,description:`LoRA: ${n.display_name}`,constraints:{min:-10,max:10,step:.01,availableLoras:w,lora_name:n.lora_name||"",bypassed:!1},order:t.parameters.length+t.image_inputs.length+r,exposed:!0,category:"lora",auto_detected:!0,user_modified:!1})}),l(e)}},[t,n,w]),kt.useEffect(()=>{w.length>0&&s.length>0&&l(e=>e.map(e=>"lora"===e.category?{...e,constraints:{...e.constraints,availableLoras:w}}:e))},[w]),kt.useEffect(()=>{if(f&&s.length>0){const t=setTimeout(()=>{const t=e?JSON.stringify(e).slice(0,50):"unknown";localStorage.setItem(`workflow_config_${t}`,JSON.stringify(s)),console.log("Auto-saved workflow configuration")},1e3);return()=>clearTimeout(t)}},[s,f,e]);const M=kt.useCallback(()=>{var t;if(!e)return[];const n=[];for(const[r,i]of Object.entries(e)){if("meta"===r||"object"!=typeof i||null===i)continue;const e=i,a=[];if(e.inputs)for(const[t,n]of Object.entries(e.inputs)){if(Array.isArray(n))continue;const e=s.some(e=>e.node_id===r&&e.input_name===t&&e.exposed);a.push({name:t,value:n,type:typeof n,exposed:e})}a.length>0&&n.push({id:r,class_type:e.class_type||"Unknown",title:(null==(t=e._meta)?void 0:t.title)||e.class_type||`Node ${r}`,inputs:a})}return n},[e,s]),E=kt.useCallback((t,n,r)=>{let i=function(e,t){const n=e.toLowerCase();return kC[n]?kC[n]:"boolean"==typeof t?"boolean":"number"==typeof t?Number.isInteger(t)?"integer":"float":"string"==typeof t&&(n.includes("prompt")||n.includes("text"))?"prompt":"string"}(n,r),a=function(e){switch(e){case"integer":return{min:0,max:100,step:1};case"float":return{min:0,max:1,step:.01};case"seed":return{min:-1,max:2147483647,step:1};case"enum":return{options:[]};default:return}}(i)||{};const o=null==e?void 0:e[t];if(null==o?void 0:o.class_type){const e=TC.getInputDefinition(o.class_type,n);(null==e?void 0:e.isEnum)&&e.options&&(i="enum",a={options:e.options},console.log(`[WorkflowEditor] Detected enum from node definitions: ${o.class_type}.${n}`,e.options))}"enum"===i&&!a.options&&PC[n.toLowerCase()]&&(a.options=PC[n.toLowerCase()]);const c={name:`${n}_${t}`,display_name:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),node_id:t,input_name:n,type:i,default:r,description:`Parameter ${n} from node ${t}`,constraints:a,order:s.length,exposed:!0,category:"parameter",auto_detected:!1,user_modified:!0};l(e=>[...e,c]),g(!0)},[s.length]),C=kt.useCallback((e,t)=>{l(n=>{const r=[...n];return r[e]={...r[e],...t,user_modified:!0},r}),g(!0)},[]),T=kt.useCallback(e=>{l(t=>t.filter((t,n)=>n!==e)),g(!0),c&&s[e]===c&&u(null)},[s,c]),k=kt.useCallback((e,t)=>{y(t),_.current=t,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},[]),P=kt.useCallback(()=>{_.current=null,y(null)},[]),A=kt.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation();const n=_.current;null!==n&&n!==t&&(l(e=>{const r=[...e],i=r[n];return r.splice(n,1),r.splice(t,0,i),r.forEach((e,t)=>{e.order=t}),r}),_.current=t,y(t),g(!0))},[]),N=kt.useCallback((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),R=kt.useCallback(e=>{e.preventDefault(),_.current=null,y(null)},[]),L=s.filter(e=>{const t=e.name.toLowerCase().includes(p.toLowerCase())||e.display_name.toLowerCase().includes(p.toLowerCase())||e.node_id.toLowerCase().includes(p.toLowerCase());return"exposed"===d?e.exposed&&t:t}),I=kt.useCallback(()=>{const e=[...s].sort((e,t)=>e.order-t.order);i(e)},[s,i]),j=M();return e?Ot.jsxs("div",{className:"workflow-editor",children:[Ot.jsxs("div",{className:"editor-header",children:[Ot.jsx("h2",{children:o("storyboard.workflowEditor.title")}),Ot.jsxs("div",{className:"editor-actions",children:[Ot.jsx("button",{className:"editor-btn secondary",onClick:a,children:o("storyboard.workflowEditor.cancel")}),Ot.jsx("button",{className:"editor-btn primary",onClick:I,children:o("storyboard.workflowEditor.saveConfiguration")})]})]}),Ot.jsxs("div",{className:"editor-tabs",children:[Ot.jsx("button",{className:"editor-tab "+("exposed"===d?"active":""),onClick:()=>h("exposed"),children:o("storyboard.workflowEditor.tabExposed",{count:s.filter(e=>e.exposed).length})}),Ot.jsx("button",{className:"editor-tab "+("all"===d?"active":""),onClick:()=>h("all"),children:o("storyboard.workflowEditor.tabAllNodes")})]}),Ot.jsx("div",{className:"editor-search",children:Ot.jsx("input",{type:"text",placeholder:o("storyboard.workflowEditor.searchPlaceholder"),value:p,onChange:e=>m(e.target.value)})}),Ot.jsxs("div",{className:"editor-content",children:["exposed"===d&&Ot.jsx("div",{className:"parameters-list",children:0===L.length?Ot.jsx("p",{className:"empty-message",children:o("storyboard.workflowEditor.noExposed")}):L.map((t,n)=>Ot.jsx(NC,{config:t,workflow:e,isSelected:c===t,onSelect:()=>u(t),onUpdate:e=>C(n,e),onRemove:()=>T(n),onDragStart:e=>k(e,n),onDragOver:e=>N(e,n),onDragEnter:e=>A(e,n),onDrop:R,onDragEnd:P,isDragging:v===n},`${t.node_id}-${t.input_name}`))}),"all"===d&&Ot.jsx("div",{className:"nodes-list",children:j.map(e=>Ot.jsx(RC,{node:e,onAddParameter:(t,n)=>E(e.id,t,n)},e.id))})]}),f&&Ot.jsx("div",{className:"editor-status",children:o("storyboard.workflowEditor.unsaved")})]}):Ot.jsx("div",{className:"workflow-editor",children:Ot.jsxs("div",{className:"editor-empty",children:[Ot.jsx("p",{children:o("storyboard.workflowEditor.noWorkflow")}),Ot.jsx("button",{className:"editor-btn",onClick:a,children:o("storyboard.workflowEditor.close")})]})})}function NC({config:e,workflow:t,isSelected:n,onSelect:r,onUpdate:i,onRemove:a,onDragStart:o,onDragOver:s,onDragEnter:l,onDrop:c,onDragEnd:u,isDragging:d}){var h,p,m,f,g;const{t:v}=yf(),[y,_]=kt.useState(!1);return Ot.jsxs("div",{className:`parameter-config-card ${n?"selected":""} ${e.auto_detected?"auto":"manual"} ${d?"dragging":""}`,onClick:r,onDragOver:s,onDragEnter:l,onDrop:c,children:[Ot.jsxs("div",{className:"config-header",children:[Ot.jsx("div",{className:"config-order",children:Ot.jsx("div",{className:"drag-handle",title:v("storyboard.workflowEditor.dragToReorder"),draggable:"true",onDragStart:e=>{e.stopPropagation(),o(e)},onDragEnd:e=>{e.stopPropagation(),u()},onClick:e=>e.stopPropagation(),children:""})}),Ot.jsxs("div",{className:"config-info",children:[Ot.jsx("input",{type:"text",className:"config-name",value:e.display_name,onChange:e=>i({display_name:e.target.value}),onClick:e=>e.stopPropagation(),placeholder:v("storyboard.workflowEditor.displayNamePlaceholder")}),Ot.jsxs("span",{className:"config-meta",children:[e.node_id,"  ",e.input_name," (",e.type,")"]})]}),Ot.jsxs("div",{className:"config-actions",children:[Ot.jsx("button",{className:"config-toggle",onClick:e=>{e.stopPropagation(),_(!y)},children:y?"":""}),Ot.jsx("button",{className:"config-remove",onClick:e=>{e.stopPropagation(),a()},title:v("storyboard.workflowEditor.removeParameter"),children:""})]})]}),y&&Ot.jsxs("div",{className:"config-details",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.internalNameLabel")}),Ot.jsx("input",{type:"text",value:e.name,onChange:e=>i({name:e.target.value}),placeholder:v("storyboard.workflowEditor.internalNamePlaceholder")})]}),Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:"Type:"}),Ot.jsxs("select",{value:e.type,onChange:e=>i({type:e.target.value}),children:[Ot.jsx("option",{value:"integer",children:"Integer"}),Ot.jsx("option",{value:"float",children:"Float"}),Ot.jsx("option",{value:"seed",children:"Seed"}),Ot.jsx("option",{value:"boolean",children:"Boolean"}),Ot.jsx("option",{value:"enum",children:"Enum"}),Ot.jsx("option",{value:"prompt",children:"Prompt"}),Ot.jsx("option",{value:"string",children:"String"})]})]}),Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.defaultValueLabel")}),Ot.jsx("input",{type:"text",value:String(e.default),onChange:t=>{let n=t.target.value;"integer"===e.type||"seed"===e.type?n=parseInt(n)||0:"float"===e.type?n=parseFloat(n)||0:"boolean"===e.type&&(n="true"===n),i({default:n})}})]}),Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.descriptionLabel")}),Ot.jsx("input",{type:"text",value:e.description,onChange:e=>i({description:e.target.value}),placeholder:v("storyboard.workflowEditor.parameterDescriptionPlaceholder")})]}),("integer"===e.type||"float"===e.type||"seed"===e.type)&&Ot.jsxs("div",{className:"config-constraints",children:[Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.min")}),Ot.jsx("input",{type:"number",value:(null==(h=e.constraints)?void 0:h.min)??0,onChange:t=>i({constraints:{...e.constraints,min:parseFloat(t.target.value)}})})]}),Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.max")}),Ot.jsx("input",{type:"number",value:(null==(p=e.constraints)?void 0:p.max)??100,onChange:t=>i({constraints:{...e.constraints,max:parseFloat(t.target.value)}})})]}),Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.step")}),Ot.jsx("input",{type:"number",value:(null==(m=e.constraints)?void 0:m.step)??1,onChange:t=>i({constraints:{...e.constraints,step:parseFloat(t.target.value)}})})]})]}),"enum"===e.type&&Ot.jsxs("div",{className:"config-row",children:[Ot.jsx("label",{children:v("storyboard.workflowEditor.optionsCommaSeparated")}),Ot.jsxs("div",{className:"enum-options-row",children:[Ot.jsx("input",{type:"text",value:(null==(g=null==(f=e.constraints)?void 0:f.options)?void 0:g.join(", "))||"",onChange:t=>i({constraints:{...e.constraints,options:t.target.value.split(",").map(e=>e.trim()).filter(Boolean)}}),placeholder:v("storyboard.workflowEditor.enumOptionsPlaceholder")}),Ot.jsxs("button",{type:"button",className:"fetch-options-btn",onClick:()=>{if(!t)return;const n=t[e.node_id];if(null==n?void 0:n.class_type){const t=TC.getEnumOptions(n.class_type,e.input_name);t&&t.length>0?i({constraints:{...e.constraints,options:t}}):alert(v("storyboard.workflowEditor.noEnumOptionsFound",{classType:n.class_type,inputName:e.input_name}))}},title:v("storyboard.workflowEditor.fetchOptionsTitle"),children:[" ",v("storyboard.workflowEditor.fetchOptions")]})]})]}),Ot.jsxs("div",{className:"config-flags",children:[Ot.jsxs("label",{className:"flag",children:[Ot.jsx("input",{type:"checkbox",checked:e.exposed,onChange:e=>i({exposed:e.target.checked})}),v("storyboard.workflowEditor.exposedInUi")]}),Ot.jsx("span",{className:"config-source",children:e.auto_detected?` ${v("storyboard.workflowEditor.autoDetected")}`:` ${v("storyboard.workflowEditor.userDefined")}`})]})]})]})}function RC({node:e,onAddParameter:t}){const[n,r]=kt.useState(!1);return Ot.jsxs("div",{className:"node-card",children:[Ot.jsxs("div",{className:"node-header",onClick:()=>r(!n),children:[Ot.jsx("span",{className:"node-toggle",children:n?"":""}),Ot.jsxs("div",{className:"node-info",children:[Ot.jsx("span",{className:"node-title",children:e.title}),Ot.jsx("span",{className:"node-type",children:e.class_type})]}),Ot.jsxs("span",{className:"node-id",children:["ID: ",e.id]})]}),n&&Ot.jsx("div",{className:"node-inputs",children:e.inputs.map(e=>Ot.jsxs("div",{className:"node-input "+(e.exposed?"exposed":""),children:[Ot.jsxs("div",{className:"input-info",children:[Ot.jsx("span",{className:"input-name",children:e.name}),Ot.jsx("span",{className:"input-type",children:e.type}),Ot.jsx("span",{className:"input-value",children:String(e.value).slice(0,50)})]}),e.exposed?Ot.jsx("span",{className:"input-added",children:" Exposed"}):Ot.jsx("button",{className:"input-add-btn",onClick:()=>t(e.name,e.value),children:"+ Expose"})]},e.name))})]})}class LC{normalizeWorkflowFormat(e){var t;if("nodes"in e&&Array.isArray(e.nodes)&&e.nodes.length>0){const n=e,r={},i=new Map;if(n.links)for(const e of n.links){const t=e[0],n=e[1],r=e[2];i.set(t,[n,r])}for(const e of n.nodes){const n=String(e.id),a=e,o=a.type||e.class_type||"",s={};if(a.inputs&&Array.isArray(a.inputs))for(const e of a.inputs)if(null!==e.link&&void 0!==e.link){const t=i.get(e.link);t&&(s[e.name]=[String(t[0]),t[1]])}r[n]={class_type:o,inputs:s,widgets_values:a.widgets_values,_meta:{title:a.title||(null==(t=a.properties)?void 0:t["Node name for S&R"])||""},mode:a.mode}}return r}return e}parseWorkflow(e){const t=this.normalizeWorkflowFormat(e),n=this._extractParameters(t),r=this._extractImageInputs(t),i=this._extractLoRAs(t),a=this._extractOutputs(t),o=this._detectCategories(t),s=this._detectNextSceneSupport(t),l=i.some(e=>"qwen-image-edit-2511-multiple-angles-lora.safetensors"===e.lora_name);return{parameters:n,image_inputs:r,loras:i,outputs:a,categories:o,has_next_scene_support:s,hasMultiAngleLora:l}}_normalizeNode(e){const t=e.class_type||e.type||"";let n=e.inputs||{};if(e.widgets_values&&Array.isArray(e.widgets_values)){const r=this._getWidgetNames(t);e.widgets_values.forEach((e,t)=>{r[t]&&(n[r[t]]=e)})}return{class_type:t,inputs:n}}_getWidgetNames(e){return{KSampler:["seed","control_after_generate","steps","cfg","sampler_name","scheduler","denoise"],KSamplerAdvanced:["add_noise","noise_seed","steps","cfg","sampler_name","scheduler","start_at_step","end_at_step","return_with_leftover_noise"],CLIPTextEncode:["text"],EmptyLatentImage:["width","height","batch_size"],EmptySD3LatentImage:["width","height","batch_size"],LoadImage:["image","upload"],LoraLoader:["lora_name","strength_model","strength_clip"],LoraLoaderModelOnly:["lora_name","strength_model"],VAELoader:["vae_name"],CLIPLoader:["clip_name","type","device"],UNETLoader:["unet_name","weight_dtype"],VAEEncode:[],VAEDecode:[],SaveImage:["filename_prefix"],PreviewImage:[],ModelSamplingAuraFlow:["shift"],ConditioningZeroOut:[],QwenImageIntegratedKSampler:["prompt","negative_prompt","mode","batch_size","image1_weight","image2_weight","seed","control_after_generate","steps","denoise","sampler_name","scheduler","scale_method","cfg","image_count","tile_vae","use_teacache","use_fp8_linear","custom_prompt","save_prefix","system_prompt"],FluxResolutionNode:["megapixels","aspect_ratio","divisor","preview","last_ratio"],ImageResizeKJv2:["width","height","upscale_method","crop","pad_color","pad_position","divisor","device"],ImageScaleToTotalPixels:["upscale_method","megapixels"],VHS_LoadVideo:["video","force_rate","custom_width","custom_height","frame_load_cap","skip_first_frames","select_every_nth","format"],OlmDragCrop:["seed","crop_left","crop_right","crop_top","crop_bottom","crop_width","crop_height","img_width","img_height","snap","aspect_ratio","lock_aspect","action","refresh","mask","color","reset"],OpenposePreprocessor:["detect_hand","detect_body","detect_face","resolution","bbox_detector"],DepthAnything_V2:[],DownloadAndLoadDepthAnythingV2Model:["model"],UnetLoaderGGUF:["unet_name"],PathchSageAttentionKJ:["attention_mode","force_fp16"],"Power Lora Loader (rgthree)":[],"LayerUtility: SaveImagePlus":["output_path","filename_prefix","timestamp","format","quality","save_metadata","custom_metadata","overwrite","preview"],"Image Comparer (rgthree)":[]}[e]||[]}_extractParameters(e){let t=[];for(const[n,r]of Object.entries(e)){if("meta"===n||"object"!=typeof r||null===r)continue;const e=r,{class_type:i,inputs:a}=this._normalizeNode(e);if("KSampler"===i&&("steps"in a&&t.push({name:"steps",display_name:"Sampling Steps",type:"integer",node_id:n,input_name:"steps",default:a.steps??20,constraints:{min:1,max:150,step:1},description:"Number of sampling steps"}),"cfg"in a&&t.push({name:"cfg",display_name:"CFG Scale",type:"float",node_id:n,input_name:"cfg",default:a.cfg??7,constraints:{min:0,max:30,step:.1},description:"Classifier-free guidance scale"}),"seed"in a&&t.push({name:"seed",display_name:"Seed",type:"seed",node_id:n,input_name:"seed",default:a.seed??-1,description:"Random seed for reproducibility"}),"denoise"in a&&t.push({name:"denoise",display_name:"Denoise Strength",type:"float",node_id:n,input_name:"denoise",default:a.denoise??1,constraints:{min:.1,max:1,step:.05},description:"Denoising strength (img2img)"})),"QwenImageIntegratedKSampler"===i){const r=e.widgets_values||[];t.push({name:"positive_prompt",display_name:"Prompt",type:"prompt",node_id:n,input_name:"positive_prompt",default:r[0]||a.positive_prompt||"",description:"Main prompt for image generation/editing"}),t.push({name:"negative_prompt",display_name:"Negative Prompt",type:"prompt",node_id:n,input_name:"negative_prompt",default:r[1]||a.negative_prompt||"",description:"What to avoid in generation"}),t.push({name:"generation_mode",display_name:"Mode",type:"enum",node_id:n,input_name:"generation_mode",default:r[2]||a.generation_mode||" image-to-image",constraints:{options:[" text-to-image"," image-to-image"," image-edit"]},description:"Generation mode"}),t.push({name:"seed",display_name:"Seed",type:"seed",node_id:n,input_name:"seed",default:r[6]||a.seed||-1,description:"Random seed"}),t.push({name:"steps",display_name:"Steps",type:"integer",node_id:n,input_name:"steps",default:r[8]||a.steps||4,constraints:{min:1,max:50,step:1},description:"Sampling steps"}),t.push({name:"denoise",display_name:"Denoise",type:"float",node_id:n,input_name:"denoise",default:r[9]||a.denoise||1,constraints:{min:0,max:1,step:.05},description:"Denoising strength"}),t.push({name:"cfg",display_name:"CFG Scale",type:"float",node_id:n,input_name:"cfg",default:r[13]||a.cfg||3,constraints:{min:1,max:20,step:.5},description:"Classifier-free guidance"})}"EmptyLatentImage"===i&&("width"in a&&t.push({name:"width",display_name:"Width",type:"integer",node_id:n,input_name:"width",default:a.width??512,constraints:{min:256,max:2048,step:64},description:"Output image width"}),"height"in a&&t.push({name:"height",display_name:"Height",type:"integer",node_id:n,input_name:"height",default:a.height??512,constraints:{min:256,max:2048,step:64},description:"Output image height"}))}return t=this._extractPromptParameters(e,t),t}_extractPromptParameters(e,t){var n;const r=[...t],i=[],a={CLIPTextEncode:"text",TextEncodeQwenImageEditPlus:"prompt",TextEncodeQwenImageEdit:"prompt",TextEncodeQwen:"prompt",CLIPTextEncodeSDXL:"text_g",PromptStyler:"text_positive",ShowText:"text",StringFunction:"text"};for(const[h,p]of Object.entries(e)){if("meta"===h||"object"!=typeof p||null===p)continue;const e=p,t=e.class_type||"",r=e.inputs||{};if(t in a){const o=a[t];if(o in r){const a=String(r[o]??""),s=(null==(n=e._meta)?void 0:n.title)||"";i.push({node_id:h,class_type:t,input_name:o,text:a,title:s,title_lower:s.toLowerCase()})}}}if(0===i.length)return r;const o=[],s=[],l=[],c=["positive","pos ","(pos)","prompt","main prompt","subject"],u=["negative","neg ","(neg)","bad","ugly","worst","low quality","avoid"],d=["ugly","blurry","bad anatomy","worst quality","low quality","normal quality","lowres","watermark","deformed","disfigured","mutation","extra limbs"];for(const h of i){const e=h.title_lower,t=h.text.toLowerCase().slice(0,200),n=c.some(t=>e.includes(t)),r=u.some(t=>e.includes(t));let i=r;n||r||(i=d.some(e=>t.includes(e))),i&&!n?s.push(h):n&&!i?o.push(h):l.push(h)}for(const h of l)if(0===o.length)o.push(h);else if(0===s.length)s.push(h);else{const e=`prompt_${h.node_id}`,t=h.title||`Prompt (Node ${h.node_id})`;r.push({name:e,display_name:t,type:"prompt",node_id:h.node_id,input_name:h.input_name,default:h.text,description:`Text prompt for ${h.class_type} node ${h.node_id}`})}for(let h=0;h<o.length;h++){const e=o[h],t=r.find(e=>"positive_prompt"===e.name);if(0!==h||t){const t=h>0?`positive_prompt_${h+1}`:`positive_prompt_${e.node_id}`,n=e.title||`Positive Prompt ${h+2}`;r.push({name:t,display_name:n,type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Additional positive prompt"})}else r.push({name:"positive_prompt",display_name:"Positive Prompt",type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Positive prompt (what to generate)"})}for(let h=0;h<s.length;h++){const e=s[h],t=r.find(e=>"negative_prompt"===e.name);if(0!==h||t){const t=h>0?`negative_prompt_${h+1}`:`negative_prompt_${e.node_id}`,n=e.title||`Negative Prompt ${h+2}`;r.push({name:t,display_name:n,type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Additional negative prompt"})}else r.push({name:"negative_prompt",display_name:"Negative Prompt",type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Negative prompt (things to avoid)"})}return r}_extractLoRAs(e){const t=[];let n=0;for(const[r,i]of Object.entries(e)){if("meta"===r||"object"!=typeof i||null===i)continue;const e=i,a=e.class_type||"";if(a.includes("LoraLoader")||"LoraLoaderModelOnly"===a){n++;const i=e.inputs||{},a=i.lora_name||"";let o;if(a){const e=a.split(/[\\/]/);o=e[e.length-1].replace(/\.[^/.]+$/,"")}else o=`LoRA ${n}`;t.push({name:`lora_${n}`,display_name:o,node_id:r,strength_inputs:{model:"strength_model",clip:"strength_clip"},default_enabled:!0,default_strength:i.strength_model??.75,required:!0,lora_name:a})}}return t}_extractImageInputs(e){const t=[];let n=0;for(const[r,i]of Object.entries(e)){if("meta"===r||"object"!=typeof i||null===i)continue;const e=i.class_type||"";"LoadImage"===e&&(n++,t.push({name:`reference_image_${n}`,display_name:`Reference Image ${n}`,node_id:r,input_name:"image",type:"image",required:!1,batch_min:1,batch_max:1,description:`Reference image for node ${r}`})),"LoadImageMask"===e&&(n++,t.push({name:`mask_image_${n}`,display_name:`Mask Image ${n}`,node_id:r,input_name:"image",type:"mask",required:!1,batch_min:1,batch_max:1,description:`Mask image for node ${r}`})),("VHS_LoadVideo"===e||"LoadVideo"===e||e.includes("LoadVideo"))&&(n++,t.push({name:`video_input_${n}`,display_name:`Video Input ${n}`,node_id:r,input_name:"video",type:"image",required:!1,batch_min:1,batch_max:1,description:`Video input for node ${r}`}))}return t}imageInputsToParameters(e){return e.map(e=>{let t="image";return e.name.includes("video")?t="video":"mask"===e.type&&(t="image"),{name:e.name,display_name:e.display_name,type:t,node_id:e.node_id,input_name:e.input_name,default:"",description:e.description,constraints:{min:e.batch_min,max:e.batch_max}}})}_extractOutputs(e){const t=[];let n=0;for(const[r,i]of Object.entries(e)){if("meta"===r||"object"!=typeof i||null===i)continue;const e=i.class_type||"";"SaveImage"!==e&&"PreviewImage"!==e||(n++,t.push({node_id:r,name:`Output ${n} (${e})`,type:"image",selected:1===n})),(e.includes("SaveVideo")||e.includes("VideoSave"))&&(n++,t.push({node_id:r,name:`Output ${n} (Video)`,type:"video",selected:1===n}))}return t}_detectCategories(e){let t=!1,n=!1,r=!1,i=!1;for(const[o,s]of Object.entries(e)){if("meta"===o||"object"!=typeof s||null===s)continue;const e=s.class_type||"";"LoadImage"===e&&(t=!0),e.includes("EmptyLatent")&&(n=!0),"KSampler"===e&&(r=!0),["VAEEncodeForInpaint","InpaintModelConditioning","Inpaint"].includes(e)&&(i=!0)}const a=[];return t&&!n&&a.push("editing"),t&&n&&a.push("img2img"),n&&r&&a.push("generation"),i&&(a.includes("img2img")||a.push("img2img")),0===a.length&&a.push("generation"),a}_detectNextSceneSupport(e){for(const[t,n]of Object.entries(e)){if("meta"===t||"object"!=typeof n||null===n)continue;const e=n.class_type||"";if(e.includes("VAEEncode")||"LoadImage"===e)return!0}return!1}buildWorkflow(e,t,n,r,i){const a=this.normalizeWorkflowFormat(e),o=JSON.parse(JSON.stringify(a)),s=this.parseWorkflow(e),l=[...s.parameters];if(i)for(const d of i){if(!d.exposed)continue;l.some(e=>e.node_id===d.node_id&&e.input_name===d.input_name)||l.push({name:d.name,display_name:d.name,description:"",type:"enum",node_id:d.node_id,input_name:d.input_name,default:null})}console.log("[buildWorkflow] Applying parameters:",t),console.log("[buildWorkflow] Available params:",l.map(e=>({name:e.name,node_id:e.node_id,input_name:e.input_name})));for(const[d,h]of Object.entries(t)){let e=l.find(e=>e.name===d);if(e||(e=l.find(e=>d===`${e.name}_${e.node_id}`)),e||(e=l.find(e=>d===`${e.input_name}_${e.node_id}`)),e){console.log(`[buildWorkflow] Matched param "${d}" to node ${e.node_id}.${e.input_name}`);const t=o[e.node_id];if(t){if(t.widgets_values&&Array.isArray(t.widgets_values)){const n=this._getWidgetIndex(t.class_type||"",e.input_name);n>=0&&(t.widgets_values[n]=h)}t.inputs||(t.inputs={}),t.inputs[e.input_name]=h}}else console.log(`[buildWorkflow] No match for param "${d}"`)}console.log("[buildWorkflow] === APPLYING IMAGE INPUTS ==="),console.log("[buildWorkflow] imageInputs received:",Object.entries(n).map(([e,t])=>`${e}=${t}`)),console.log("[buildWorkflow] parsed.image_inputs:",s.image_inputs.map(e=>({name:e.name,node_id:e.node_id,input_name:e.input_name})));for(const[d,h]of Object.entries(n)){const e=s.image_inputs.find(e=>e.name===d);if(e){const t=o[e.node_id];if(console.log(`[buildWorkflow] Processing image input "${d}" -> node ${e.node_id}.${e.input_name}, path=${h}, node exists=${!!t}`),t){if("__BYPASSED__"===h){console.log(`[buildWorkflow] !!! BYPASSING image input node ${e.node_id} (${d}, class_type=${t.class_type}) !!!`),t.mode=4;continue}t.inputs||(t.inputs={}),t.inputs[e.input_name]=h,t.widgets_values&&Array.isArray(t.widgets_values)&&(t.widgets_values[0]=h)}}}console.log(`[buildWorkflow] Processing ${s.loras.length} LoRAs, loraValues has ${Object.keys(r).length} entries`);for(const d of s.loras){const e=o[d.node_id];if(!e){console.warn(`[buildWorkflow] LoRA node ${d.node_id} not found in workflow`);continue}const t=r[d.name];if(t){!0===t.bypassed||!1===t.enabled?(console.log(`[buildWorkflow] Bypassing LoRA node ${d.node_id} (${d.name})`),e.mode=4):e.inputs&&(e.inputs[d.strength_inputs.model]=t.strength,e.inputs[d.strength_inputs.clip]=t.strength,t.lora_name&&(e.inputs.lora_name=t.lora_name),console.log(`[buildWorkflow] Applied LoRA ${d.name} (node ${d.node_id}): strength=${t.strength}`))}else console.log(`[buildWorkflow] Using defaults for LoRA ${d.name} (node ${d.node_id}) - not in UI params`),4===e.mode&&delete e.mode,e.inputs&&d.strength_inputs.model in e.inputs&&console.log(`[buildWorkflow] Keeping original strength: ${e.inputs[d.strength_inputs.model]}`)}const c={},u=new Set;console.log("[buildWorkflow] === BYPASS ANALYSIS START ==="),console.log("[buildWorkflow] All nodes in workflow:",Object.keys(o).filter(e=>"meta"!==e&&"version"!==e));for(const[d,h]of Object.entries(o)){if("meta"===d||"version"===d)continue;const e=h;4===e.mode&&(u.add(d),console.log(`[buildWorkflow] Node ${d} (${e.class_type}) is BYPASSED (mode=4)`))}console.log(`[buildWorkflow] Total bypassed nodes: ${u.size}`,Array.from(u));for(const[d,h]of Object.entries(o)){if("meta"===d||"version"===d)continue;const e=h;if(e.class_type){if(this._isUiOnlyNode(e.class_type)){console.log(`[buildWorkflow] Skipping UI-only node ${d} (${e.class_type})`);continue}if(4===e.mode){console.log(`[buildWorkflow] Skipping bypassed node ${d} (${e.class_type})`);continue}const t={...e.inputs||{}};if(e.widgets_values&&Array.isArray(e.widgets_values)){const n=this._getWidgetNames(e.class_type);e.widgets_values.forEach((e,r)=>{n[r]&&void 0!==e&&(n[r]in t||(t[n[r]]=e))})}c[d]={class_type:e.class_type,inputs:t},e._meta&&(c[d]._meta=e._meta)}}if(u.size>0){const e=new Map;for(const[s,l]of Object.entries(o))if(u.has(s)){const t=l;t.inputs&&e.set(s,{...t.inputs})}console.log("[buildWorkflow] Bypassed node inputs map:",Object.fromEntries(e));const t=(n,r)=>{if(console.log(`[findUpstreamSource] Checking node ${n} (output ${r}), bypassed=${u.has(n)}`),!u.has(n))return console.log(`[findUpstreamSource] Node ${n} is NOT bypassed, returning as source`),[n,r];const i=e.get(n);if(console.log(`[findUpstreamSource] Node ${n} is bypassed, inputs:`,i),!i)return null;const a=0===r?"model":"clip",o=i[a];if(console.log(`[findUpstreamSource] Looking for upstream via input "${a}":`,o),Array.isArray(o)&&o.length>=2){const e=String(o[0]),n=Number(o[1]);return console.log(`[findUpstreamSource] Following to upstream ${e}:${n}`),t(e,n)}return console.log(`[findUpstreamSource] No upstream found for node ${n}`),null};console.log("[buildWorkflow] === PROCESSING INPUT REFERENCES ==="),console.log("[buildWorkflow] API Workflow nodes:",Object.keys(c));const n=new Set,r=(e,t)=>{if(!e)return!1;return!("image"!==t||!["LoadImage","ImageScale","ImageScaleToTotalPixels","ImageResize","ImageResizeKJv2","ImageCrop","VAEEncode","DWPose","OpenposePreprocessor","CannyEdgePreprocessor","LineartPreprocessor","DepthAnything","InstantIDFaceAnalysis","ReActorFaceSwap","IPAdapter","ControlNetLoader"].some(t=>null==e?void 0:e.includes(t)))||!("pixels"!==t||!(null==e?void 0:e.includes("VAEEncode")))};for(const[o,s]of Object.entries(c)){const e=s;if(e.inputs){const i=[],a=[];for(const[s,l]of Object.entries(e.inputs))if(Array.isArray(l)&&l.length>=2){const c=String(l[0]),d=Number(l[1]);if(console.log(`[buildWorkflow] Node ${o} input "${s}" references [${c}, ${d}], bypassed=${u.has(c)}`),u.has(c)){console.log(`[buildWorkflow] Attempting to rewire through bypassed node ${c}`);const l=t(c,d);l?(console.log(`[buildWorkflow]  Rewiring input "${s}" from bypassed node ${c} to upstream ${l[0]}:${l[1]}`),i.push({name:s,value:l})):r(e.class_type,s)?(console.log(`[buildWorkflow]  Node ${o} (${e.class_type}) loses required input "${s}" - will remove entire node`),n.add(o)):(console.log(`[buildWorkflow]  Removing optional input "${s}" from node ${o}`),a.push(s))}}if(!n.has(o)){for(const t of i)e.inputs[t.name]=t.value;for(const t of a)delete e.inputs[t]}}}let i=0;const a=10;for(;n.size>0&&i<a;){i++,console.log(`[buildWorkflow] Removal iteration ${i}: removing ${Array.from(n)}`);for(const t of n)c[t]&&(delete c[t],console.log(`[buildWorkflow] Removed node ${t}`));const e=new Set;for(const[t,i]of Object.entries(c)){const a=i;if(a.inputs)for(const[i,o]of Object.entries(a.inputs))if(Array.isArray(o)&&o.length>=2){const s=String(o[0]);!n.has(s)&&c[s]||(console.log(`[buildWorkflow] Node ${t} loses input "${i}" (referenced ${s} was removed)`),delete a.inputs[i],r(a.class_type,i)&&(console.log(`[buildWorkflow] Node ${t} (${a.class_type}) lost required input "${i}" - will remove`),e.add(t)))}}n.clear();for(const t of e)n.add(t)}i>=a&&console.warn("[buildWorkflow] Warning: Hit max iterations for cascading removal"),console.log(`[buildWorkflow] Cascading removal completed after ${i} iterations`),console.log("[buildWorkflow] === BYPASS ANALYSIS END ===")}return c[76]&&console.log("[buildWorkflow] FINAL STATE: Node 76:",c[76].inputs),c[81]&&console.log("[buildWorkflow] FINAL STATE: Node 81:",c[81].inputs),c[120]&&console.log("[buildWorkflow] FINAL STATE: Node 120:",c[120].inputs),c[122]&&console.log("[buildWorkflow] FINAL STATE: Node 122:",c[122].inputs),c}_isUiOnlyNode(e){if(["Note","MarkdownNote","PrimitiveNode","Reroute","GroupNode","ttN pipeLoader","ShowText|pysssss","ShowAnything"].includes(e))return!0;return[/^Note$/i,/Note$/,/^Comment/i,/^Sticky/i].some(t=>t.test(e))}_getWidgetIndex(e,t){if("QwenImageIntegratedKSampler"===e){return{prompt:0,negative_prompt:1,mode:2,batch_size:3,image1_weight:4,image2_weight:5,seed:6,control_after_generate:7,steps:8,denoise:9,sampler_name:10,scheduler:11,scale_method:12,cfg:13}[t]??-1}return-1}}let IC=null;function jC(){return IC||(IC=new LC),IC}function DC({message:e,type:t="error",onClose:n,duration:r=5e3}){const[i,a]=kt.useState(!0),[o,s]=kt.useState(100);kt.useEffect(()=>{if(r>0){const e=Date.now(),t=setInterval(()=>{const i=Date.now()-e,o=Math.max(0,100-i/r*100);s(o),i>=r&&(clearInterval(t),a(!1),null==n||n())},50);return()=>clearInterval(t)}},[r]);return i?Ot.jsxs("div",{className:`error-notification ${t}`,children:[Ot.jsxs("div",{className:"error-content",children:[Ot.jsxs("span",{className:"error-icon",children:["error"===t&&"","warning"===t&&"","info"===t&&""]}),Ot.jsx("span",{className:"error-message",children:e}),Ot.jsx("button",{className:"error-close",onClick:()=>{a(!1),null==n||n()},children:""})]}),Ot.jsx("div",{className:"error-progress",children:Ot.jsx("div",{className:"error-progress-bar",style:{width:`${o}%`}})})]}):null}let OC=0;const UC=new Map;function FC(e,t){const n=`${e}:${t}`,r=Date.now(),i=UC.get(n);for(const[a,o]of UC.entries())r-o>1e4&&UC.delete(a);return!(i&&r-i<1e3)&&(UC.set(n,r),!0)}function zC({notifications:e,onRemove:t}){return Ot.jsx("div",{className:"error-notification-container",children:e.map(e=>Ot.jsx(DC,{message:e.message,type:e.type,onClose:()=>t(e.id)},e.id))})}class BC{constructor(e,t="storyboard-ui"){je(this,"ws",null),je(this,"url"),je(this,"baseUrl"),je(this,"clientId"),je(this,"pendingPrompts",new Map),je(this,"reconnectTimeout",null),je(this,"statusCallback",null),je(this,"kayToolMetricsCallback",null),je(this,"isConnected",!1),je(this,"kayToolMonitorStarted",!1),je(this,"reconnectAttempts",0),je(this,"maxReconnectAttempts",20),je(this,"minReconnectDelay",1e3),je(this,"maxReconnectDelay",3e4),je(this,"isIntentionallyClosed",!1),this.baseUrl=e,this.url=e.replace(/^http/,"ws")+"/ws?clientId="+t,this.clientId=t}connect(){return new Promise((e,t)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN)e();else{this.cancelReconnect(),this.isIntentionallyClosed=!1;try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("[ComfyUI WS] Connected"),this.isConnected=!0,this.reconnectAttempts=0,e()},this.ws.onclose=e=>{console.log(`[ComfyUI WS] Disconnected (code: ${e.code}, reason: ${e.reason||"none"})`),this.isConnected=!1,this.isIntentionallyClosed||this.scheduleReconnect()},this.ws.onerror=e=>{console.error("[ComfyUI WS] Error:",e),this.isConnected=!1,t(e)},this.ws.onmessage=e=>{if(!(e.data instanceof Blob))try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("[ComfyUI WS] Failed to parse message:",t)}}}catch(n){t(n)}}})}disconnect(){this.isIntentionallyClosed=!0,this.cancelReconnect(),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1,this.reconnectAttempts=0}cancelReconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}calculateReconnectDelay(){const e=Math.min(this.maxReconnectDelay,this.minReconnectDelay*Math.pow(2,this.reconnectAttempts)),t=.25*Math.random()*e;return Math.floor(e+t)}scheduleReconnect(){if(this.reconnectTimeout)return;if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.warn(`[ComfyUI WS] Max reconnect attempts (${this.maxReconnectAttempts}) reached. Giving up.`);const e=this.calculateReconnectDelay();this.reconnectAttempts++,console.log(`[ComfyUI WS] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimeout=window.setTimeout(()=>{this.reconnectTimeout=null,this.connect().catch(e=>{console.error("[ComfyUI WS] Reconnection failed:",e)})},e)}resetReconnectAttempts(){this.reconnectAttempts=0,this.isIntentionallyClosed=!1}handleMessage(e){const{type:t,data:n}=e;switch(this.statusCallback&&!this.isMonitoringEvent(t)&&this.statusCallback({type:t,data:n}),t){case"progress":this.handleProgress(n);break;case"executing":this.handleExecuting(n);break;case"executed":this.handleExecuted(n);break;case"execution_error":this.handleError(n);break;case"execution_start":case"execution_cached":case"status":case"crystools.monitor":case"kikostats.monitor":break;case"kaytool.resources":this.kayToolMetricsCallback&&n&&this.kayToolMetricsCallback(n);break;default:this.isMonitoringEvent(t)||console.log("[ComfyUI WS] Unknown message type:",t)}}isMonitoringEvent(e){return e.includes(".monitor")||e.includes("crystools")||e.includes("kikostats")||"kaytool.resources"===e}handleProgress(e){const{value:t,max:n,prompt_id:r,node:i}=e;console.log("[ComfyUI WS] Progress:",r,t,"/",n,"node:",i),console.log("[ComfyUI WS] Pending prompts:",Array.from(this.pendingPrompts.keys()));const a=this.pendingPrompts.get(r);a?a.onProgress({value:t,max:n,promptId:r,nodeId:i}):console.warn("[ComfyUI WS] No pending prompt found for:",r)}handleExecuting(e){const{prompt_id:t,node:n}=e;if(console.log("[ComfyUI WS] Executing:",t,"node:",n),console.log("[ComfyUI WS] Pending prompts:",Array.from(this.pendingPrompts.keys())),null===n){console.log("[ComfyUI WS] Execution complete for:",t);const e=this.pendingPrompts.get(t);e?(console.log("[ComfyUI WS] Calling onCompleted callback"),e.onCompleted(t,null),this.pendingPrompts.delete(t)):console.warn("[ComfyUI WS] No pending prompt found for completion:",t)}else console.log("[ComfyUI WS] Executing node:",n,"for prompt:",t)}handleExecuted(e){const{prompt_id:t,output:n,node:r}=e;console.log("[ComfyUI WS] Executed node:",r,"for prompt:",t,"output:",n)}handleError(e){const{prompt_id:t,exception_message:n,exception_type:r}=e,i=this.pendingPrompts.get(t);i&&(i.onError(t,`${r}: ${n}`),this.pendingPrompts.delete(t))}trackPrompt(e,t,n,r,i){console.log("[ComfyUI WS] Tracking prompt:",e,"for panel:",t,"clientId:",this.clientId),this.pendingPrompts.set(e,{promptId:e,panelId:t,onProgress:n,onCompleted:r,onError:i}),console.log("[ComfyUI WS] Pending prompts after add:",Array.from(this.pendingPrompts.keys()))}untrackPrompt(e){this.pendingPrompts.delete(e)}async cancelGeneration(){try{const e=await fetch(`${this.baseUrl}/interrupt`,{method:"POST"});return e.ok?(console.log("[ComfyUI WS] Generation interrupted"),!0):(console.error("[ComfyUI WS] Failed to interrupt:",e.statusText),!1)}catch(e){return console.error("[ComfyUI WS] Error interrupting generation:",e),!1}}onStatus(e){this.statusCallback=e}onKayToolMetrics(e){this.kayToolMetricsCallback=e,e&&!this.kayToolMonitorStarted&&this.startKayToolMonitor()}async startKayToolMonitor(){if(!this.kayToolMonitorStarted)try{const e=await fetch(`${this.baseUrl}/kaytool/start_monitor`,{method:"POST",headers:{"Content-Type":"application/json"}});e.ok?(this.kayToolMonitorStarted=!0,console.log("[KayTool] Monitor started")):console.warn("[KayTool] Failed to start monitor:",e.status)}catch(e){console.warn("[KayTool] Monitor not available:",e)}}async stopKayToolMonitor(){if(this.kayToolMonitorStarted)try{await fetch(`${this.baseUrl}/kaytool/stop_monitor`,{method:"POST",headers:{"Content-Type":"application/json"}}),this.kayToolMonitorStarted=!1,console.log("[KayTool] Monitor stopped")}catch(e){}}get connected(){var e;return this.isConnected&&(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN}getClientId(){return this.clientId}}const HC=new Map;function VC(e,t){const n=`${e}:${t||"storyboard-ui"}`;return HC.has(n)||HC.set(n,new BC(e,t)),HC.get(n)}const GC=new class{constructor(){je(this,"nodes",new Map),je(this,"listeners",new Set),je(this,"pollingInterval",null),je(this,"nodeWebSockets",new Map),je(this,"removedNodeIds",new Set)}async fetchBackendsFromAPI(e){try{const t=await fetch(`${e}/api/backends`);if(!t.ok)return void console.error("[Orchestrator] Failed to fetch backends:",t.status);const n=await t.json();for(const e of n.backends||[]){if(this.removedNodeIds.has(e.id)){console.log(`[Orchestrator] Skipping removed node: ${e.id}`);continue}const t=e.online?"busy"===e.status?"busy":"online":"offline",n={id:e.id,name:e.name,url:`http://${e.host}:${e.port}`,status:t,gpuName:e.gpu_name||"Unknown",vramTotal:e.gpu_memory_total||0,vramUsed:e.gpu_memory_used||0,gpuUsage:e.gpu_utilization||0,gpuTemp:e.gpu_temperature||0,cpuUsage:e.cpu_utilization||0,ramUsed:e.ram_used||0,ramTotal:e.ram_total||0,lastSeen:e.last_seen?new Date(e.last_seen):new Date,priority:this.nodes.size};this.nodes.set(n.id,n),e.online&&this.connectNodeWebSocket(n)}this.notifyListeners(),this.saveToStorage(),console.log(`[Orchestrator] Loaded ${this.nodes.size} backends from API`)}catch(t){console.error("[Orchestrator] Error fetching backends:",t)}}addNode(e,t,n){const r=n||`node_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this.removedNodeIds.has(r)&&(this.removedNodeIds.delete(r),console.log(`[Orchestrator] Re-adding previously removed node: ${r}`));const i={id:r,name:t,url:e,status:"offline",gpuName:"Unknown",vramTotal:0,vramUsed:0,gpuUsage:0,gpuTemp:0,cpuUsage:0,ramUsed:0,ramTotal:0,lastSeen:new Date,priority:this.nodes.size};return this.nodes.set(r,i),this.notifyListeners(),this.pollNode(i),i}removeNode(e){const t=this.nodes.delete(e);return t&&(this.removedNodeIds.add(e),this.saveToStorage(),this.notifyListeners()),t}getNodes(){return Array.from(this.nodes.values())}getAvailableNodes(){return this.getNodes().filter(e=>"online"===e.status||"busy"===e.status).sort((e,t)=>e.priority-t.priority)}getBestNode(){const e=this.getAvailableNodes();return 0===e.length?null:e.filter(e=>"online"===e.status).sort((e,t)=>t.vramTotal-t.vramUsed-(e.vramTotal-e.vramUsed))[0]||e[0]}setNodePriority(e,t){const n=this.nodes.get(e);n&&(n.priority=t,this.notifyListeners())}parseGpuName(e){if(!e)return"Unknown GPU";let t=e.replace(/^cuda:\d+\s+/,"");return t=t.replace(/:\w+Alloc\w*$/,""),t.trim()||"Unknown GPU"}async pollNode(e){var t;try{const n=await fetch(`${e.url}/system_stats`,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(5e3)});if(n.ok){const r=null==(t=(await n.json()).devices)?void 0:t[0];r&&(e.gpuName=this.parseGpuName(r.name||"Unknown GPU"),e.vramTotal=Math.round((r.vram_total||0)/1024/1024),e.vramUsed=Math.round(r.vram_total-r.vram_free||0)/1024/1024,void 0!==r.vram_free&&(e.vramUsed=Math.round((r.vram_total-r.vram_free)/1024/1024))),e.status="online",e.lastSeen=new Date,this.connectNodeWebSocket(e)}else e.status="error"}catch(n){e.status="offline",this.disconnectNodeWebSocket(e.id)}this.nodes.set(e.id,e),this.notifyListeners()}async connectNodeWebSocket(e){if(!this.nodeWebSockets.has(e.id))try{const t=VC(e.url,`orchestrator-${e.id}`);await t.connect(),t.onKayToolMetrics(t=>{this.updateNodeFromKayTool(e.id,t)}),this.nodeWebSockets.set(e.id,t),console.log(`[Orchestrator] WebSocket connected to ${e.name} for KayTool metrics`)}catch(t){console.warn(`[Orchestrator] Failed to connect WebSocket to ${e.name}:`,t)}}disconnectNodeWebSocket(e){const t=this.nodeWebSockets.get(e);t&&(t.stopKayToolMonitor(),t.disconnect(),this.nodeWebSockets.delete(e))}updateNodeFromKayTool(e,t){const n=this.nodes.get(e);if(n){if(n.cpuUsage=t.cpu_percent||0,n.ramTotal=t.ram_total||0,n.ramUsed=t.ram_used||0,t.gpu&&t.gpu.length>0){const e=t.gpu[0];n.gpuName=e.name||n.gpuName,n.gpuUsage=e.load||0,n.gpuTemp=e.temperature||0,n.vramUsed=1024*(e.memory_used||0),n.vramTotal=1024*(e.memory_total||0)}n.lastSeen=new Date,this.nodes.set(e,n),this.notifyListeners()}}startPolling(e=5e3){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=window.setInterval(()=>{this.nodes.forEach(e=>{this.pollNode(e)})},e)}stopPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}subscribe(e){return this.listeners.add(e),e(this.getNodes()),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getNodes();this.listeners.forEach(t=>t(e))}saveToStorage(){const e=Array.from(this.nodes.values()).map(e=>({id:e.id,name:e.name,url:e.url,priority:e.priority}));localStorage.setItem("orchestrator_nodes",JSON.stringify(e)),localStorage.setItem("orchestrator_removed_nodes",JSON.stringify(Array.from(this.removedNodeIds)))}loadFromStorage(){const e=localStorage.getItem("orchestrator_removed_nodes");if(e)try{const t=JSON.parse(e);this.removedNodeIds=new Set(t),console.log(`[Orchestrator] Loaded ${this.removedNodeIds.size} removed node IDs from storage`)}catch(n){console.error("Failed to load removed node IDs from storage:",n)}const t=localStorage.getItem("orchestrator_nodes");if(t)try{JSON.parse(t).forEach(e=>{if(this.removedNodeIds.has(e.id))return void console.log(`[Orchestrator] Skipping removed node during load: ${e.id}`);const t=this.nodes.get(e.id);if(t)return void(void 0!==e.priority&&(t.priority=e.priority));const n={id:e.id,name:e.name,url:e.url,status:"offline",gpuName:"Unknown",vramTotal:0,vramUsed:0,gpuUsage:0,gpuTemp:0,cpuUsage:0,ramUsed:0,ramTotal:0,lastSeen:new Date,priority:e.priority??this.nodes.size};this.nodes.set(e.id,n),this.pollNode(n)}),this.notifyListeners()}catch(n){console.error("Failed to load nodes from storage:",n)}}clearAllNodes(){this.nodes.clear(),this.notifyListeners(),localStorage.removeItem("orchestrator_nodes")}async restartBackend(e,t={}){const n=this.nodes.get(e);if(!n)return{success:!1,message:`Backend ${e} not found`};try{if(console.log(`[Orchestrator] Restarting ComfyUI backend ${e} at ${n.url}`),!1!==t.interrupt_jobs)try{const t=await fetch(`${n.url}/interrupt`,{method:"POST"});t.ok?console.log(`[Orchestrator] Interrupted jobs on ${e}`):console.warn(`[Orchestrator] Interrupt failed for ${e}: ${t.status}`)}catch(r){console.warn(`[Orchestrator] Failed to interrupt ${e}:`,r)}if(!1!==t.free_memory)try{const t=await fetch(`${n.url}/free`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({unload_models:!0,free_memory:!0})});t.ok?console.log(`[Orchestrator] Freed memory on ${e}`):console.warn(`[Orchestrator] Free memory failed for ${e}: ${t.status}`)}catch(r){console.warn(`[Orchestrator] Failed to free memory on ${e}:`,r)}try{const t=await fetch(`${n.url}/system_stats`,{method:"GET"});return t.ok?(console.log(`[Orchestrator] Backend ${e} health check passed`),{success:!0,message:"ComfyUI backend restarted successfully. Jobs interrupted, memory freed."}):{success:!1,message:`Health check failed with status ${t.status}`}}catch(r){return{success:!1,message:`Health check failed: ${r instanceof Error?r.message:"Unknown error"}`}}}catch(i){return console.error(`[Orchestrator] Error restarting backend ${e}:`,i),{success:!1,message:i instanceof Error?i.message:"Unknown error occurred"}}}async restartAllBackends(){const e=this.getNodes(),t=[];for(const n of e)if("online"===n.status||"busy"===n.status){const e=await this.restartBackend(n.id);t.push({backendId:n.id,success:e.success,message:e.message})}return t}async cancelAllGenerations(){const e=this.getNodes(),t=[];for(const r of e)if("busy"===r.status)try{console.log(`[Orchestrator] Cancelling generation on ${r.id} at ${r.url}`);const e=await fetch(`${r.url}/interrupt`,{method:"POST"});e.ok?t.push({backendId:r.id,success:!0,message:"Generation cancelled"}):t.push({backendId:r.id,success:!1,message:`Failed to cancel: HTTP ${e.status}`})}catch(n){t.push({backendId:r.id,success:!1,message:n instanceof Error?n.message:"Unknown error"})}return t}};function WC(){const[e,t]=kt.useState([]);return kt.useEffect(()=>GC.subscribe(t),[]),e}
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $C=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),XC=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)};
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var qC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KC=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1},YC=kt.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:a,iconNode:o,...s},l)=>kt.createElement("svg",{ref:l,...qC,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:$C("lucide",i),...!a&&!KC(s)&&{"aria-hidden":"true"},...s},[...o.map(([e,t])=>kt.createElement(e,t)),...Array.isArray(a)?a:[a]])),ZC=(e,t)=>{const n=kt.forwardRef(({className:n,...r},i)=>{return kt.createElement(YC,{ref:i,iconNode:t,className:$C(`lucide-${a=XC(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...r});var a});return n.displayName=XC(e),n},JC=ZC("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),QC=ZC("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),eT=ZC("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),tT=ZC("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),nT=ZC("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),rT=ZC("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),iT=ZC("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),aT=ZC("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),oT=ZC("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),sT=ZC("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),lT=ZC("crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),cT=ZC("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),uT=ZC("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),dT=ZC("file-plus",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]),hT=ZC("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),pT=ZC("folder-input",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]),mT=ZC("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),fT=ZC("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),gT=ZC("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),vT=ZC("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),yT=ZC("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),_T=ZC("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),xT=ZC("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),bT=ZC("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),wT=ZC("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ST=ZC("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),MT=ZC("maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),ET=ZC("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),CT=ZC("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),TT=ZC("octagon-x",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),kT=ZC("panel-right-close",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),PT=ZC("panel-right",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),AT=ZC("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),NT=ZC("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),RT=ZC("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),LT=ZC("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),IT=ZC("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),jT=ZC("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),DT=ZC("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),OT=ZC("save-all",[["path",{d:"M10 2v3a1 1 0 0 0 1 1h5",key:"1xspal"}],["path",{d:"M18 18v-6a1 1 0 0 0-1-1h-6a1 1 0 0 0-1 1v6",key:"1ra60u"}],["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"M8 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9.172a2 2 0 0 1 1.414.586l2.828 2.828A2 2 0 0 1 22 6.828V16a2 2 0 0 1-2.01 2z",key:"1yve0x"}]]),UT=ZC("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),FT=ZC("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),zT=ZC("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),BT=ZC("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),HT=ZC("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),VT=ZC("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),GT=ZC("tags",[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]]),WT=ZC("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),$T=ZC("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),XT=ZC("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),qT=ZC("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),KT=ZC("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),YT=ZC("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function ZT({onClose:e,onRestartNodes:t}){const{t:n}=yf(),r=WC(),[i,a]=kt.useState(""),[o,s]=kt.useState(""),[l,c]=kt.useState(!1),[u,d]=kt.useState(new Set),[h,p]=kt.useState(!1),m=e=>e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`,f=e=>{switch(e){case"online":return"#4dff6d";case"busy":return"#ffcc00";case"error":return"#ff4444";default:return"#666"}};return Ot.jsx("div",{className:"node-manager-overlay",children:Ot.jsxs("div",{className:"node-manager-modal",children:[Ot.jsxs("div",{className:"node-manager-header",children:[Ot.jsx("h2",{children:n("storyboard.nodes.title")}),Ot.jsxs("div",{className:"header-actions",children:[u.size>0&&Ot.jsxs("button",{className:"restart-selected-btn",onClick:async()=>{if(0!==u.size){p(!0);try{if(t)await t(Array.from(u));else for(const e of u)await GC.restartBackend(e);d(new Set)}catch(e){console.error("Failed to restart nodes:",e)}finally{p(!1)}}else alert(n("storyboard.nodes.selectAtLeastOne"))},disabled:h,title:n("storyboard.nodes.restartSelectedTitle",{count:u.size}),children:[Ot.jsx(jT,{size:16,className:h?"spinning":""}),Ot.jsx("span",{children:h?n("storyboard.nodes.restarting"):n("storyboard.nodes.restart",{count:u.size})})]}),Ot.jsx("button",{className:"close-btn",onClick:e,children:""})]})]}),Ot.jsxs("div",{className:"node-manager-content",children:[Ot.jsxs("div",{className:"add-node-form",children:[Ot.jsx("input",{type:"text",placeholder:n("storyboard.nodes.nodeNamePlaceholder"),value:o,onChange:e=>s(e.target.value)}),Ot.jsx("input",{type:"text",placeholder:n("storyboard.nodes.nodeUrlPlaceholder"),value:i,onChange:e=>a(e.target.value)}),Ot.jsx("button",{onClick:()=>{i&&o&&(GC.addNode(i,o),GC.saveToStorage(),a(""),s(""))},disabled:!i||!o,children:n("storyboard.nodes.addNode")})]}),Ot.jsx("div",{className:"polling-control",children:Ot.jsx("button",{className:"polling-btn "+(l?"active":""),onClick:()=>{l?GC.stopPolling():(GC.startPolling(5e3),r.forEach(e=>GC.pollNode(e))),c(!l)},children:l?` ${n("storyboard.nodes.stopMonitoring")}`:` ${n("storyboard.nodes.startMonitoring")}`})}),Ot.jsxs("div",{className:"node-list",children:[r.length>0&&Ot.jsx("div",{className:"select-all-row",children:Ot.jsxs("label",{className:"checkbox-label",children:[Ot.jsx("input",{type:"checkbox",checked:u.size===r.length&&r.length>0,onChange:()=>{u.size===r.length?d(new Set):d(new Set(r.map(e=>e.id)))}}),Ot.jsx("span",{children:n("storyboard.nodes.selectAll",{selected:u.size,total:r.length})})]})}),0===r.length?Ot.jsx("p",{className:"no-nodes",children:n("storyboard.nodes.noNodes")}):r.map(e=>Ot.jsxs("div",{className:"node-card "+(u.has(e.id)?"selected":""),children:[Ot.jsxs("div",{className:"node-header",children:[Ot.jsxs("div",{className:"node-info",children:[Ot.jsx("label",{className:"checkbox-label node-checkbox",children:Ot.jsx("input",{type:"checkbox",checked:u.has(e.id),onChange:()=>(e=>{const t=new Set(u);t.has(e)?t.delete(e):t.add(e),d(t)})(e.id)})}),Ot.jsx("span",{className:"node-name",children:e.name}),Ot.jsxs("span",{className:"node-status",style:{color:f(e.status)},children:[" ",e.status.toUpperCase()]})]}),Ot.jsx("button",{className:"remove-btn",onClick:()=>{return t=e.id,GC.removeNode(t),void GC.saveToStorage();var t},children:n("storyboard.nodes.remove")})]}),Ot.jsx("div",{className:"node-url",children:e.url}),"offline"!==e.status&&"Unknown"!==e.gpuName&&Ot.jsxs("div",{className:"node-stats",children:[Ot.jsxs("div",{className:"stat-row",children:[Ot.jsx("span",{className:"stat-label",children:n("storyboard.nodes.gpu")}),Ot.jsx("span",{className:"stat-value",children:e.gpuName})]}),Ot.jsxs("div",{className:"stat-row",children:[Ot.jsx("span",{className:"stat-label",children:n("storyboard.nodes.vram")}),Ot.jsxs("span",{className:"stat-value",children:[m(e.vramUsed)," / ",m(e.vramTotal)," ",Ot.jsxs("span",{className:"vram-percent",children:["(",e.vramTotal>0?Math.round(e.vramUsed/e.vramTotal*100):0,"%)"]})]})]}),Ot.jsxs("div",{className:"stat-row",children:[Ot.jsx("span",{className:"stat-label",children:n("storyboard.nodes.gpuUsage")}),Ot.jsxs("span",{className:"stat-value",children:[e.gpuUsage,"%"]})]}),Ot.jsx("div",{className:"vram-bar",children:Ot.jsx("div",{className:"vram-fill",style:{width:(e.vramTotal>0?e.vramUsed/e.vramTotal*100:0)+"%"}})})]})]},e.id))]})]})]})})}function JT({onProjectSettings:e,onSaveProject:t,onSaveProjectAs:n,onLoadProject:r,onManageNodes:i,onNewProject:a,onRestartNodes:o,onCancelGenerations:s,onPrintStoryboard:l,nodeCount:c,projectName:u,isSaving:d,isLoading:h,isRestarting:p,isGenerating:m}){const[f,g]=kt.useState(!1),v=kt.useRef(null),{t:y}=yf();kt.useEffect(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),kt.useEffect(()=>{const e=e=>{"Escape"===e.key&&g(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);const _=navigator.platform.toUpperCase().indexOf("MAC")>=0?"":"Ctrl";return Ot.jsxs("div",{className:"main-menu",ref:v,children:[Ot.jsxs("button",{className:"main-menu-trigger "+(f?"active":""),onClick:()=>g(!f),children:[Ot.jsx(ET,{size:18}),Ot.jsx("span",{className:"project-name",children:u||y("storyboard.project.untitled")}),Ot.jsx(QC,{size:14,className:"chevron "+(f?"rotated":"")})]}),f&&Ot.jsxs("div",{className:"main-menu-dropdown",children:[Ot.jsxs("div",{className:"menu-section",children:[Ot.jsx("div",{className:"menu-section-title",children:y("storyboard.menu.project")}),Ot.jsxs("button",{className:"menu-item",onClick:()=>{a(),g(!1)},children:[Ot.jsx(dT,{size:16}),Ot.jsx("span",{children:y("storyboard.menu.newProject")}),Ot.jsxs("span",{className:"menu-shortcut",children:[_,"+N"]})]}),Ot.jsxs("button",{className:"menu-item",onClick:()=>{r(),g(!1)},disabled:h,children:[Ot.jsx(pT,{size:16}),Ot.jsx("span",{children:y(h?"storyboard.menu.loading":"storyboard.menu.loadProject")}),Ot.jsxs("span",{className:"menu-shortcut",children:[_,"+O"]})]}),Ot.jsxs("button",{className:"menu-item",onClick:()=>{t(),g(!1)},disabled:d,children:[Ot.jsx(UT,{size:16}),Ot.jsx("span",{children:y(d?"storyboard.menu.saving":"storyboard.menu.saveProject")}),Ot.jsxs("span",{className:"menu-shortcut",children:[_,"+S"]})]}),n&&Ot.jsxs("button",{className:"menu-item",onClick:()=>{n(),g(!1)},disabled:d,children:[Ot.jsx(OT,{size:16}),Ot.jsx("span",{children:y("storyboard.menu.saveAs")}),Ot.jsxs("span",{className:"menu-shortcut",children:[_,"++S"]})]}),Ot.jsxs("button",{className:"menu-item",onClick:()=>{e(),g(!1)},children:[Ot.jsx(zT,{size:16}),Ot.jsx("span",{children:y("storyboard.menu.projectSettings")}),Ot.jsxs("span",{className:"menu-shortcut",children:[_,"+,"]})]}),l&&Ot.jsxs("button",{className:"menu-item",onClick:()=>{l(),g(!1)},children:[Ot.jsx(IT,{size:16}),Ot.jsx("span",{children:y("storyboard.menu.printStoryboard")}),Ot.jsxs("span",{className:"menu-shortcut",children:[_,"+P"]})]})]}),Ot.jsx("div",{className:"menu-divider"}),Ot.jsxs("div",{className:"menu-section",children:[Ot.jsx("div",{className:"menu-section-title",children:y("storyboard.menu.system")}),Ot.jsxs("button",{className:"menu-item",onClick:()=>{i(),g(!1)},children:[Ot.jsx(FT,{size:16}),Ot.jsx("span",{children:y("storyboard.menu.manageNodes")}),Ot.jsx("span",{className:"menu-badge",children:c})]}),o&&Ot.jsxs("button",{className:"menu-item",onClick:()=>{o(),g(!1)},disabled:p||0===c,title:y(0===c?"storyboard.menu.noNodesToRestart":"storyboard.menu.restartNodesTitle"),children:[Ot.jsx(jT,{size:16,className:p?"spinning":""}),Ot.jsx("span",{children:y(p?"storyboard.menu.restarting":"storyboard.menu.restartNodes")})]}),s&&Ot.jsxs("button",{className:"menu-item cancel-btn",onClick:()=>{s(),g(!1)},disabled:!m,title:y(m?"storyboard.menu.cancelAllTitle":"storyboard.menu.cancelDisabledTitle"),children:[Ot.jsx(TT,{size:16}),Ot.jsx("span",{children:y("storyboard.menu.cancelAllGenerations")})]})]})]})]})}function QT({options:e,onChange:t,placeholder:n,title:r}){const{t:i}=yf(),[a,o]=kt.useState(!1),s=kt.useRef(null),l=n??i("common.selectOptionsPlaceholder"),c=e.filter(e=>e.selected).length,u=c===e.length,d=0===c;kt.useEffect(()=>{const e=e=>{s.current&&!s.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return Ot.jsxs("div",{className:"multiselect-dropdown",ref:s,children:[r&&Ot.jsx("div",{className:"multiselect-title",children:r}),Ot.jsxs("button",{className:"multiselect-trigger "+(a?"open":""),onClick:()=>o(!a),type:"button",children:[Ot.jsx("span",{className:"multiselect-label",children:(()=>{if(d)return l;if(u)return i("common.allWithCount",{count:e.length});if(1===c){const t=e.find(e=>e.selected);return(null==t?void 0:t.label)||i("common.oneSelected")}return i("common.selectedWithCount",{count:c})})()}),Ot.jsx(QC,{size:14,className:"chevron "+(a?"rotated":"")})]}),a&&Ot.jsxs("div",{className:"multiselect-menu",children:[Ot.jsxs("div",{className:"multiselect-actions",children:[Ot.jsx("button",{className:"action-btn",onClick:()=>{t(e.map(e=>e.id))},disabled:u,children:i("common.selectAll")}),Ot.jsx("button",{className:"action-btn",onClick:()=>{t([])},disabled:d,children:i("common.clear")})]}),Ot.jsx("div",{className:"multiselect-divider"}),Ot.jsx("div",{className:"multiselect-options",children:e.map(n=>Ot.jsxs("button",{className:"multiselect-option "+(n.selected?"selected":""),onClick:()=>(n=>{const r=e.map(e=>e.id===n?{...e,selected:!e.selected}:e).filter(e=>e.selected).map(e=>e.id);t(r)})(n.id),children:[Ot.jsx("span",{className:"option-check",children:n.selected&&Ot.jsx(JC,{size:14})}),Ot.jsx("span",{className:"option-label",children:n.label})]},n.id))})]})]})}function ek({selectedBackendIds:e,onSelectionChange:t,maxSelections:n=10,disabled:r=!1,className:i=""}){const a=WC(),[o,s]=kt.useState(()=>"true"===localStorage.getItem("multiNodeSelector_collapsed"));kt.useEffect(()=>{localStorage.setItem("multiNodeSelector_collapsed",o.toString())},[o]);const l=[...a.filter(e=>"online"===e.status||"busy"===e.status)].sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:e.name.localeCompare(t.name)),c=e=>{switch(e.status){case"online":return Ot.jsx(LT,{className:"status-icon online",size:10});case"busy":return Ot.jsx(wT,{className:"status-icon busy",size:10});case"error":return Ot.jsx(rT,{className:"status-icon error",size:10});default:return Ot.jsx(LT,{className:"status-icon offline",size:10})}},u=e=>e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`,d=e.length>1,h=e.length>=n,p=l.length>0&&e.length===l.length;return Ot.jsxs("div",{className:`multi-node-selector ${i} ${o?"collapsed":""}`,children:[Ot.jsxs("div",{className:"selector-header",children:[Ot.jsxs("div",{className:"selector-label",children:[Ot.jsx(sT,{size:14}),Ot.jsx("span",{children:"Target Nodes"}),Ot.jsxs("span",{className:"selection-count",children:["(",e.length,"/",l.length,")"]})]}),Ot.jsxs("div",{className:"selector-actions",children:[!o&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsxs("button",{type:"button",className:"action-btn select-all",onClick:()=>{r||t(l.slice(0,n).map(e=>e.id))},disabled:r||p||0===l.length,title:"Select all available nodes",children:[Ot.jsx(JC,{size:12}),"All"]}),Ot.jsxs("button",{type:"button",className:"action-btn clear-all",onClick:()=>{r||t([])},disabled:r||0===e.length,title:"Clear all selections",children:[Ot.jsx(XT,{size:12}),"Clear"]})]}),Ot.jsx("button",{type:"button",className:"action-btn collapse-toggle",onClick:()=>s(!o),title:o?"Expand node selector":"Collapse node selector",children:o?Ot.jsx(QC,{size:12}):Ot.jsx(nT,{size:12})})]})]}),!o&&Ot.jsx("div",{className:"node-chips-container",children:0===l.length?Ot.jsxs("div",{className:"no-nodes-message",children:[Ot.jsx(rT,{size:16}),Ot.jsx("span",{children:"No render nodes available"}),Ot.jsx("span",{className:"hint",children:"Add nodes in the Node Manager to enable parallel generation"})]}):Ot.jsx("div",{className:"node-chips",children:l.map(i=>{const a=e.includes(i.id),o=(e=>{switch(e.status){case"online":return"online";case"busy":return"busy";case"error":return"error";default:return"offline"}})(i);return Ot.jsxs("button",{type:"button",className:`node-chip ${a?"selected":""} ${o} ${r?"disabled":""}`,onClick:()=>{return a=i.id,void(r||(e.includes(a)?t(e.filter(e=>e!==a)):e.length<n&&t([...e,a])));var a},disabled:r||!a&&h,title:`${i.name} - ${i.gpuName} - ${u(i.vramTotal)} VRAM`,children:[c(i),Ot.jsx("span",{className:"node-name",children:i.name}),a&&Ot.jsx("span",{className:"selection-indicator",children:Ot.jsx(JC,{size:10})}),i.vramTotal>0&&Ot.jsx("span",{className:"vram-badge",children:u(i.vramTotal)})]},i.id)})})}),!o&&d&&Ot.jsxs("div",{className:"parallel-hint",children:[Ot.jsx(qT,{size:12}),Ot.jsxs("span",{children:[Ot.jsx("strong",{children:e.length})," parallel generations with unique seeds"]})]}),!o&&h&&Ot.jsxs("div",{className:"max-selection-warning",children:[Ot.jsx(rT,{size:10}),Ot.jsxs("span",{children:["Maximum ",n," nodes can be selected"]})]})]})}const tk=({isOpen:e,onClose:t,workflows:n,onUpdateWorkflow:r})=>{const{t:i}=yf(),[a,o]=kt.useState(null),[s,l]=kt.useState([]),[c,u]=kt.useState(""),d={"Image Generation":"imageGeneration","Text to Image":"textToImage","Image to Image":"imageToImage",InPainting:"inPainting","Image Editing":"imageEditing",Upscaling:"upscaling","Video Generation":"videoGeneration"},h=e=>i(`storyboard.workflowCategories.categories.${d[e]}`,{defaultValue:e}),p=kt.useCallback(e=>{o(e),l(e.categories||[])},[]),m=kt.useCallback(e=>{l(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),f=kt.useCallback(()=>{a&&r({...a,categories:s})},[a,s,r]),g=n.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase())),v=e=>({"Image Generation":"#3d8b6e","Text to Image":"#4a7aa8","Image to Image":"#8b5a7a",InPainting:"#9b7a4a","Image Editing":"#7a6a9a",Upscaling:"#8a8a4a","Video Generation":"#9a5a5a"}[e]||"#6a7a8a");return e?Ot.jsx("div",{className:"workflow-categories-modal-overlay",onClick:t,children:Ot.jsxs("div",{className:"workflow-categories-modal",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"modal-header",children:[Ot.jsxs("h2",{children:[Ot.jsx(GT,{size:20})," ",i("storyboard.workflowCategories.title")]}),Ot.jsx("button",{className:"close-btn",onClick:t,children:Ot.jsx(XT,{size:20})})]}),Ot.jsxs("div",{className:"modal-content",children:[Ot.jsxs("div",{className:"workflows-list-section",children:[Ot.jsx("div",{className:"search-box",children:Ot.jsx("input",{type:"text",placeholder:i("storyboard.workflowCategories.searchPlaceholder"),value:c,onChange:e=>u(e.target.value)})}),Ot.jsx("div",{className:"workflows-list",children:g.map(e=>{var t,n;return Ot.jsxs("div",{className:"workflow-item "+((null==a?void 0:a.id)===e.id?"selected":""),onClick:()=>p(e),children:[Ot.jsxs("div",{className:"workflow-info",children:[Ot.jsx("div",{className:"workflow-name",children:e.name}),Ot.jsx("div",{className:"workflow-description",children:e.description})]}),Ot.jsxs("div",{className:"workflow-categories-preview",children:[null==(t=e.categories)?void 0:t.map(e=>Ot.jsx("span",{className:"category-tag",style:{backgroundColor:v(e)},children:h(e)},e)),!(null==(n=e.categories)?void 0:n.length)&&Ot.jsx("span",{className:"no-categories",children:i("storyboard.workflowCategories.noCategories")})]})]},e.id)})})]}),Ot.jsx("div",{className:"categories-section",children:a?Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("h3",{children:i("storyboard.workflowCategories.assignTitle",{name:a.name})}),Ot.jsx("p",{className:"help-text",children:i("storyboard.workflowCategories.help")}),Ot.jsx("div",{className:"categories-grid",children:SL.map(e=>Ot.jsxs("button",{className:"category-btn "+(s.includes(e)?"selected":""),onClick:()=>m(e),style:{borderColor:v(e),backgroundColor:s.includes(e)?`${v(e)}20`:"transparent"},children:[Ot.jsx("span",{className:"category-indicator",style:{backgroundColor:v(e)}}),Ot.jsx("span",{className:"category-name",children:h(e)}),s.includes(e)&&Ot.jsx(JC,{size:16,className:"check-icon"})]},e))}),Ot.jsxs("div",{className:"selected-categories-summary",children:[Ot.jsx("h4",{children:i("storyboard.workflowCategories.selectedTitle")}),Ot.jsxs("div",{className:"selected-tags",children:[s.map(e=>Ot.jsx("span",{className:"selected-tag",style:{backgroundColor:v(e)},children:h(e)},e)),!s.length&&Ot.jsx("span",{className:"no-selection",children:i("storyboard.workflowCategories.noneSelected")})]})]}),Ot.jsxs("div",{className:"modal-actions",children:[Ot.jsx("button",{className:"save-btn",onClick:f,children:i("storyboard.workflowCategories.save")}),Ot.jsx("button",{className:"cancel-btn",onClick:()=>o(null),children:i("storyboard.workflowCategories.cancel")})]})]}):Ot.jsxs("div",{className:"no-selection-message",children:[Ot.jsx(GT,{size:48}),Ot.jsx("p",{children:i("storyboard.workflowCategories.selectWorkflowHint")})]})})]})]})}):null};function nk(){return"undefined"!=typeof window?`${window.location.protocol}//${window.location.hostname}:9820`:"http://localhost:9820"}const rk={name:"Untitled Project",path:"",namingTemplate:"{project}_Panel{panel}_{version}",autoSave:!1,orchestratorUrl:nk(),created:new Date,lastModified:new Date};const ik=new class{constructor(){je(this,"currentProject",{...rk}),je(this,"storageKey","storyboard_project_settings"),this.loadFromStorage()}normalizePath(e){return e.replace(/\\/g,"/")}getProject(){return{...this.currentProject}}setProject(e){this.currentProject={...this.currentProject,...e,lastModified:new Date},this.saveToStorage(),this.syncProjectWithBackend()}async syncProjectWithBackend(){const e=this.currentProject.orchestratorUrl;if(e)try{const t=await fetch(`${e}/api/project`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:{name:this.currentProject.name,path:this.normalizePath(this.currentProject.path),naming_template:this.currentProject.namingTemplate,orchestrator_url:this.currentProject.orchestratorUrl,auto_save:this.currentProject.autoSave}})});t.ok?console.log("[ProjectManager] Project synced with backend"):console.warn("[ProjectManager] Failed to sync project with backend:",t.status)}catch(t){console.warn("[ProjectManager] Error syncing project:",t)}}resetProject(){this.currentProject={...rk,created:new Date,lastModified:new Date},this.saveToStorage()}generateFilename(e,t,n){const r=new Date,i=(e,t=2)=>e.toString().padStart(t,"0"),a={"{project}":this.sanitizeFilename(this.currentProject.name),"{panel}":i(e),"{version}":`v${i(t,3)}`,"{timestamp}":`${r.getFullYear()}${i(r.getMonth()+1)}${i(r.getDate())}_${i(r.getHours())}${i(r.getMinutes())}${i(r.getSeconds())}`,"{date}":`${r.getFullYear()}${i(r.getMonth()+1)}${i(r.getDate())}`,"{time}":`${i(r.getHours())}${i(r.getMinutes())}${i(r.getSeconds())}`,"{seed}":(n.seed??0).toString(),"{workflow}":this.sanitizeFilename(n.workflowName??"unknown")};let o=this.currentProject.namingTemplate;for(const[s,l]of Object.entries(a))o=o.split(s).join(l);return o=(null==n?void 0:n.nodeName)?o.replace("{node}",n.nodeName.replace(/[^a-zA-Z0-9-_]/g,"_")):o.replace("_{node}","").replace("{node}_","").replace("{node}",""),o}async validateProjectPath(e,t){if(!e||""===e.trim())return{valid:!1,exists:!1,message:"Path is required"};try{const n=await fetch(`${t}/api/browse-folders?path=${encodeURIComponent(e)}`);if(!n.ok)return{valid:!1,exists:!1,message:"Path does not exist"};const r=await n.json();return!1===r.success?{valid:!1,exists:!1,message:r.error||"Path does not exist"}:{valid:!0,exists:!0,message:"Path is valid"}}catch(n){return{valid:!1,exists:!1,message:`Cannot validate path: ${n}`}}}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").substring(0,50)}splitTemplateParts(){const e=this.currentProject.namingTemplate,t=e.replace(/\\/g,"/");if(t.includes("/")){const e=t.lastIndexOf("/");return{folder:t.substring(0,e),filename:t.substring(e+1)}}return{folder:null,filename:e}}resolvePanelFolder(e,t){const n=this.sanitizeFilename(e),r=this.normalizePath(this.currentProject.path),{folder:i}=this.splitTemplateParts();if(i){const e={"{project}":this.sanitizeFilename(this.currentProject.name),"{panel}":n,"{workflow}":this.sanitizeFilename((null==t?void 0:t.workflowName)??"unknown")};let a=i;for(const[t,n]of Object.entries(e))a=a.split(t).join(n);return`${r}/${a}`}return`${r}/${n}`}generateFilenameForPanel(e,t,n){const r=new Date,i=(e,t=2)=>e.toString().padStart(t,"0"),a=this.sanitizeFilename(e),o={"{project}":this.sanitizeFilename(this.currentProject.name),"{panel}":a,"{version}":`v${i(t,3)}`,"{timestamp}":`${r.getFullYear()}${i(r.getMonth()+1)}${i(r.getDate())}_${i(r.getHours())}${i(r.getMinutes())}${i(r.getSeconds())}`,"{date}":`${r.getFullYear()}${i(r.getMonth()+1)}${i(r.getDate())}`,"{time}":`${i(r.getHours())}${i(r.getMinutes())}${i(r.getSeconds())}`,"{seed}":(n.seed??0).toString(),"{workflow}":this.sanitizeFilename(n.workflowName??"unknown")},{filename:s}=this.splitTemplateParts();let l=s;for(const[c,u]of Object.entries(o))l=l.split(c).join(u);return l=(null==n?void 0:n.nodeName)?l.replace("{node}",n.nodeName.replace(/[^a-zA-Z0-9-_]/g,"_")):l.replace("_{node}","").replace("{node}_","").replace("{node}",""),l}createHistoryEntry(e,t,n,r,i,a,o,s){const l=this.extractSeed(o),c=this.extractPromptSummary(o),u={timestamp:new Date,workflowId:r,workflowName:i,seed:l,promptSummary:c,parameters:{...o},workflow:{...a},sourceUrl:e,version:n,generationTime:s};return{id:`${t}_${n}_${Date.now()}`,url:e,metadata:u}}extractSeed(e){const t=["seed","noise_seed","Seed","random_seed"];for(const n of t){if("number"==typeof e[n])return e[n];for(const[t,r]of Object.entries(e))if(t.startsWith(n)&&"number"==typeof r)return r}return-1}extractPromptSummary(e){const t=["positive_prompt","prompt","text","positive"];for(const n of t){if("string"==typeof e[n])return e[n];for(const[t,r]of Object.entries(e))if(t.startsWith(n)&&"string"==typeof r)return r}return""}async saveToProjectFolder(e,t,n,r,i){const a=this.currentProject.orchestratorUrl;if(!this.currentProject.path)return{success:!1,error:"No project folder configured. Set a folder path in Project Settings."};if(!a)return{success:!1,error:"No Orchestrator URL configured. Set it in Project Settings."};const o=i?this.resolvePanelFolder(i):this.currentProject.path,s=(i?this.generateFilenameForPanel(i,n,r):this.generateFilename(t,n,r))+".png";try{const t=await fetch(`${a}/api/save-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_url:e,folder_path:this.normalizePath(o),filename:s})});if(!t.ok){const e=await t.text();return console.error(`[ProjectManager] Orchestrator error: ${t.status} - ${e}`),{success:!1,error:`Orchestrator error: ${t.status}`}}const n=await t.json();return n.success?(console.log(`[ProjectManager] Saved to: ${n.saved_path}`),{success:!0,savedPath:n.saved_path}):(console.error(`[ProjectManager] Save failed: ${n.message}`),{success:!1,error:n.message})}catch(l){return console.error("[ProjectManager] Error saving to project folder:",l),{success:!1,error:`Network error: ${String(l)}`}}}async checkOrchestratorHealth(){const e=this.currentProject.orchestratorUrl;if(!e)return{online:!1,error:"No Orchestrator URL configured"};try{const t=await fetch(`${e}/api/health`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(t.ok){const e=await t.json();return{online:"healthy"===e.status||"degraded"===e.status}}return{online:!1,error:`HTTP ${t.status}`}}catch(t){return{online:!1,error:String(t)}}}async downloadImage(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to download image: ${t.statusText}`);return t.blob()}async saveImageToProject(e,t,n,r){return{filename:this.generateFilename(t,n,r)+".png",blob:await this.downloadImage(e)}}triggerDownload(e,t){const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}generateMetadataJson(e){return JSON.stringify({...e.metadata,timestamp:e.metadata.timestamp instanceof Date?e.metadata.timestamp.toISOString():e.metadata.timestamp},null,2)}saveToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify({...this.currentProject,created:this.currentProject.created instanceof Date?this.currentProject.created.toISOString():this.currentProject.created,lastModified:this.currentProject.lastModified instanceof Date?this.currentProject.lastModified.toISOString():this.currentProject.lastModified}))}catch(e){console.error("[ProjectManager] Failed to save to storage:",e)}}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.currentProject={...rk,...t,created:new Date(t.created),lastModified:new Date(t.lastModified)}}}catch(e){console.error("[ProjectManager] Failed to load from storage:",e)}}async scanExistingVersions(){const e=this.currentProject.orchestratorUrl,t=this.currentProject.path;if(console.log(`[ProjectManager] scanExistingVersions - orchestrator: ${e}, folder: ${t}, pattern: ${this.currentProject.namingTemplate}`),!e||!t)return console.log("[ProjectManager] scanExistingVersions - skipping (no orchestrator or folder)"),{success:!0,panelVersions:{}};try{const n={folder_path:t,pattern:this.currentProject.namingTemplate};console.log("[ProjectManager] scanExistingVersions - request:",JSON.stringify(n));const r=await fetch(`${e}/api/scan-versions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)return console.error(`[ProjectManager] scanExistingVersions - HTTP error: ${r.status}`),{success:!1,panelVersions:{},error:`HTTP ${r.status}`};const i=await r.json();console.log("[ProjectManager] scanExistingVersions - response:",JSON.stringify(i)),i.message&&i.message.includes(" DEBUG_CODE_RUNNING ")&&(console.log("%c DEBUG CODE IS RUNNING! ","background: #ff0000; color: #ffffff; font-size: 20px; font-weight: bold; padding: 10px;"),console.log("%cThis means server.py dummy code executed successfully!","background: #00aa00; color: #ffffff; font-size: 16px; padding: 5px;"),console.log("Message from server:",i.message));const a={};if(i.panel_versions)for(const[e,t]of Object.entries(i.panel_versions))a[e]="string"==typeof t?parseInt(t,10):t;return{success:i.success,panelVersions:a,error:i.message}}catch(n){return console.error("[ProjectManager] Failed to scan versions:",n),{success:!1,panelVersions:{},error:String(n)}}}async getNextVersion(e,t=[]){var n;const r=await this.scanExistingVersions(),i=this.sanitizeFilename(e),a=r.panelVersions[i]||0;let o=0;for(const l of t)(null==(n=l.metadata)?void 0:n.version)&&l.metadata.version>o&&(o=l.metadata.version);const s=Math.max(a,o)+1;return console.log(`[ProjectManager] getNextVersion for "${e}": filesystem=${a}, history=${o}, next=${s}`),s}async saveProjectState(e,t,n,r){const i=this.currentProject.orchestratorUrl,a=this.currentProject.path;if(!i)return{success:!1,error:"No Orchestrator URL configured"};if(!a)return{success:!1,error:"No project folder configured"};try{const t=e.map(e=>{var t,n;const r=e;console.log("[ProjectManager] Saving panel:",{id:r.id,name:r.name,notes:r.notes,hasImageHistory:Array.isArray(r.imageHistory)?r.imageHistory.length:0});const i=r.imageHistory,a={};if(i&&Array.isArray(i))for(const o of i)void 0!==(null==(t=o.metadata)?void 0:t.rating)&&(null==(n=o.metadata)?void 0:n.savedPath)&&(a[o.metadata.savedPath]=o.metadata.rating,console.log("[ProjectManager] Saving rating:",o.metadata.savedPath,o.metadata.rating));return{id:r.id,x:r.x,y:r.y,width:r.width,height:r.height,name:r.name,notes:r.notes,workflowId:r.workflowId,parameterValues:r.parameterValues,nodeId:r.nodeId,imageRatings:a}});console.log("[ProjectManager] Sanitized panels:",JSON.stringify(t,null,2));const o=await fetch(`${i}/api/save-project`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_path:a,filename:`${this.sanitizeFilename(this.currentProject.name)}_project.json`,state:{project_settings:{...this.currentProject,created:this.currentProject.created instanceof Date?this.currentProject.created.toISOString():this.currentProject.created,lastModified:(new Date).toISOString()},panels:t,parameter_values:n||null,selected_workflow_id:(null==r?void 0:r.selectedWorkflowId)||null,render_nodes:(null==r?void 0:r.renderNodes)||null,comfy_url:(null==r?void 0:r.comfyUrl)||null,deleted_images:(null==r?void 0:r.deletedImages)||[],saved_at:(new Date).toISOString()}})});if(!o.ok)return{success:!1,error:`HTTP ${o.status}`};const s=await o.json();return{success:s.success,savedPath:s.saved_path,error:s.message}}catch(o){return console.error("[ProjectManager] Failed to save project:",o),{success:!1,error:String(o)}}}async loadProjectState(e){const t=this.currentProject.orchestratorUrl;if(!t)return{success:!1,error:"No Orchestrator URL configured"};try{const n=await fetch(`${t}/api/load-project`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:e})});if(!n.ok)return{success:!1,error:`HTTP ${n.status}`};const r=await n.json();if(r.success&&r.state){const e=r.state.project_settings;return this.currentProject={...rk,...e,created:new Date(e.created),lastModified:new Date(e.lastModified)},this.saveToStorage(),{success:!0,state:r.state}}return{success:!1,error:r.message}}catch(n){return console.error("[ProjectManager] Failed to load project:",n),{success:!1,error:String(n)}}}async listProjects(e){const t=this.currentProject.orchestratorUrl,n=e||this.currentProject.path;if(!t||!n)return{success:!0,projects:[]};try{const e=await fetch(`${t}/api/list-projects?folder_path=${encodeURIComponent(n)}`,{method:"GET"});if(!e.ok)return{success:!1,projects:[],error:`HTTP ${e.status}`};const r=await e.json();return{success:r.success,projects:r.projects||[],error:r.message}}catch(r){return console.error("[ProjectManager] Failed to list projects:",r),{success:!1,projects:[],error:String(r)}}}async scanProjectImages(e){const t=this.currentProject.orchestratorUrl;if(!t)return{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:[],error:"No Orchestrator URL configured"};try{const e=this.currentProject.path.replace(/\\/g,"/"),n=this.currentProject.namingTemplate.replace(/\\/g,"/");console.log("[ProjectManager] scanProjectImages - original path:",this.currentProject.path),console.log("[ProjectManager] scanProjectImages - normalized path:",e),console.log("[ProjectManager] scanProjectImages - normalized pattern:",n);const r={folder_path:e,naming_pattern:n,project_name:this.currentProject.name};console.log("[ProjectManager] scanProjectImages - request:",JSON.stringify(r));const i=await fetch(`${t}/api/scan-project-images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)return{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:[],error:`HTTP ${i.status}`};const a=await i.json();if(!a.success)return{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:a.skipped_files||[],error:a.message};const o=new Map;let s=0;for(const t of a.images)o.has(t.panel_number)||o.set(t.panel_number,[]),o.get(t.panel_number).push(t),s=Math.max(s,t.panel_number);return o.forEach(e=>{e.sort((e,t)=>e.version-t.version)}),{success:!0,imagesByPanel:o,maxPanelNumber:s,skippedFiles:a.skipped_files||[]}}catch(n){return console.error("[ProjectManager] Failed to scan project images:",n),{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:[],error:String(n)}}}async scanProjectPanels(){const e=this.currentProject.orchestratorUrl;if(!e)return{success:!1,panels:[],error:"No Orchestrator URL configured"};if(!this.currentProject.path)return{success:!1,panels:[],error:"No project path configured"};try{const t=this.normalizePath(this.currentProject.path);console.log("[ProjectManager] scanProjectPanels - path:",t);const n=await fetch(`${e}/api/scan-project-panels`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_path:t})});if(!n.ok)return{success:!1,panels:[],error:`HTTP ${n.status}`};const r=await n.json();return console.log("[ProjectManager] scanProjectPanels - result:",r),r.success?{success:!0,panels:r.panels}:{success:!1,panels:[],error:r.message}}catch(t){return console.error("[ProjectManager] Failed to scan project panels:",t),{success:!1,panels:[],error:String(t)}}}async deleteImage(e){const t=this.currentProject.orchestratorUrl||nk();console.log("[ProjectManager] deleteImage called with path:",e),console.log("[ProjectManager] Using orchestratorUrl:",t);try{const n=await fetch(`${t}/api/delete-image`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_path:e})}),r=await n.json();return console.log("[ProjectManager] Delete API response:",r),{success:r.success,deletedFiles:r.deleted_files||[],error:r.message}}catch(n){return console.error("[ProjectManager] Failed to delete image:",n),{success:!1,deletedFiles:[],error:String(n)}}}};function ak({node:e,level:t,selectedPath:n,expandedPaths:r,onSelectFolder:i,onExpandFolder:a,onCollapseFolder:o,emptyLabel:s}){const l=e.path===n,c=r.has(e.path);return Ot.jsxs("div",{className:"tree-node-wrapper",children:[Ot.jsxs("div",{className:"tree-node "+(l?"selected":""),style:{paddingLeft:12*t+8+"px"},onClick:()=>{i(e.path)},children:["folder"===e.type&&Ot.jsx("button",{className:"tree-expand-btn",onClick:t=>{t.stopPropagation(),c?o(e.path):a(e.path)},disabled:e.isLoading,children:e.isLoading?Ot.jsx(wT,{size:14,className:"tree-loading-icon"}):c?Ot.jsx(QC,{size:14}):Ot.jsx(tT,{size:14})}),"drive"===e.type&&Ot.jsx("span",{className:"tree-spacer"}),"drive"===e.type?Ot.jsx(yT,{size:16,className:"tree-icon drive"}):c?Ot.jsx(mT,{size:16,className:"tree-icon folder-open"}):Ot.jsx(gT,{size:16,className:"tree-icon folder"}),Ot.jsx("span",{className:"tree-label",children:e.name})]}),c&&e.children&&e.children.length>0&&Ot.jsx("div",{className:"tree-children",children:e.children.map(e=>Ot.jsx(ak,{node:e,level:t+1,selectedPath:n,expandedPaths:r,onSelectFolder:i,onExpandFolder:a,onCollapseFolder:o,emptyLabel:s},e.path))}),c&&e.children&&0===e.children.length&&!e.isLoading&&Ot.jsx("div",{className:"tree-empty-children",style:{paddingLeft:12*(t+1)+32+"px"},children:s})]})}function ok({nodes:e,selectedPath:t,expandedPaths:n,onSelectFolder:r,onExpandFolder:i,onCollapseFolder:a}){const{t:o}=yf(),s=o("storyboard.fileBrowser.tree.empty");return Ot.jsxs("div",{className:"drive-tree-view",children:[Ot.jsx("div",{className:"tree-header",children:Ot.jsx("span",{children:o("storyboard.fileBrowser.tree.quickAccess")})}),Ot.jsx("div",{className:"tree-content",children:0===e.length?Ot.jsx("div",{className:"tree-empty",children:o("storyboard.fileBrowser.tree.noDrives")}):e.map(e=>Ot.jsx(ak,{node:e,level:0,selectedPath:t,expandedPaths:n,onSelectFolder:r,onExpandFolder:i,onCollapseFolder:a,emptyLabel:s},e.path))})]})}function sk({items:e,selectedItem:t,onSelectItem:n,onOpenItem:r,isLoading:i}){const{t:a,i18n:o}=yf(),s=e=>{const t=new Date(e),n=(new Date).getTime()-t.getTime(),r=Math.floor(n/864e5);if(0===r){const e=Math.floor(n/36e5);if(0===e){const e=Math.floor(n/6e4);return e<=1?a("storyboard.fileBrowser.contents.justNow"):a("storyboard.fileBrowser.contents.minutesAgo",{count:e})}return a("storyboard.fileBrowser.contents.hoursAgo",{count:e})}if(1===r)return a("storyboard.fileBrowser.contents.yesterday");if(r<7)return a("storyboard.fileBrowser.contents.daysAgo",{count:r});if(r<30)return a("storyboard.fileBrowser.contents.weeksAgo",{count:Math.floor(r/7)});const i="zh-CN"===(o.resolvedLanguage||o.language)?"zh-CN":void 0;return t.toLocaleDateString(i)},l=e=>{n(e)},c=e=>{r(e)},u=e=>{switch(e.type){case"drive":return Ot.jsx(yT,{size:24,className:"item-icon drive"});case"folder":return Ot.jsx(gT,{size:24,className:"item-icon folder"});case"project":return Ot.jsx(hT,{size:24,className:"item-icon project"});default:return Ot.jsx(gT,{size:24,className:"item-icon"})}},d=[...e].sort((e,t)=>{const n={drive:0,folder:1,project:2},r=n[e.type]-n[t.type];return 0!==r?r:e.name.localeCompare(t.name)}),h=d.filter(e=>"drive"===e.type||"folder"===e.type),p=d.filter(e=>"project"===e.type);return i?Ot.jsx("div",{className:"folder-contents-view loading",children:Ot.jsxs("div",{className:"contents-loading",children:[Ot.jsx("div",{className:"loading-spinner"}),Ot.jsx("span",{children:a("storyboard.fileBrowser.contents.loading")})]})}):0===d.length?Ot.jsx("div",{className:"folder-contents-view empty",children:Ot.jsxs("div",{className:"contents-empty",children:[Ot.jsx(gT,{size:48,className:"empty-icon"}),Ot.jsx("span",{children:a("storyboard.fileBrowser.contents.empty")})]})}):Ot.jsxs("div",{className:"folder-contents-view",children:[h.length>0&&Ot.jsxs("div",{className:"contents-section",children:[Ot.jsxs("div",{className:"section-header",children:[Ot.jsx(gT,{size:14}),Ot.jsx("span",{children:a("storyboard.fileBrowser.contents.folders",{count:h.length})})]}),Ot.jsx("div",{className:"items-grid",children:h.map(e=>Ot.jsxs("div",{className:`content-item ${(null==t?void 0:t.path)===e.path?"selected":""} ${e.type}`,onClick:()=>l(e),onDoubleClick:()=>c(e),title:e.name,children:[u(e),Ot.jsx("span",{className:"item-name",children:e.name})]},e.path))})]}),p.length>0&&Ot.jsxs("div",{className:"contents-section",children:[Ot.jsxs("div",{className:"section-header",children:[Ot.jsx(hT,{size:14}),Ot.jsx("span",{children:a("storyboard.fileBrowser.contents.projects",{count:p.length})})]}),Ot.jsx("div",{className:"items-grid",children:p.map(e=>Ot.jsxs("div",{className:`content-item ${(null==t?void 0:t.path)===e.path?"selected":""} ${e.type}`,onClick:()=>l(e),onDoubleClick:()=>c(e),title:e.name,children:[u(e),Ot.jsxs("div",{className:"item-details",children:[Ot.jsx("span",{className:"item-name",children:e.name}),e.metadata&&Ot.jsxs("div",{className:"item-meta",children:[Ot.jsxs("span",{className:"meta-item",children:[Ot.jsx(oT,{size:12}),s(e.metadata.savedAt)]}),Ot.jsxs("span",{className:"meta-item",children:[Ot.jsx(bT,{size:12}),a("storyboard.fileBrowser.contents.panels",{count:e.metadata.panelCount})]})]})]})]},e.path))})]})]})}function lk({path:e,onNavigate:t,onRefresh:n,isLoading:r}){const{t:i}=yf(),[a,o]=kt.useState(!1),[s,l]=kt.useState(e),c=kt.useRef(null);kt.useEffect(()=>{a||l(e)},[e,a]),kt.useEffect(()=>{a&&c.current&&(c.current.focus(),c.current.select())},[a]);const u=kt.useCallback(e=>{if(!e)return[{name:i("storyboard.fileBrowser.breadcrumb.computer"),path:""}];const t=e.replace(/\\/g,"/").split("/").filter(Boolean),n=[];let r="";if(t.length>0&&t[0].includes(":")){n.push({name:t[0],path:t[0]+(t[0].endsWith(":")?"\\":"")}),r=t[0]+(t[0].endsWith(":")?"\\":"");for(let e=1;e<t.length;e++)r+=(r.endsWith("\\")?"":"\\")+t[e],n.push({name:t[e],path:r})}else{n.push({name:i("storyboard.fileBrowser.breadcrumb.computer"),path:""});for(const e of t)r+=(r?"/":"")+e,n.push({name:e,path:r})}return n},[i])(e),d=()=>{const e=s.trim();t(e||""),o(!1)};return Ot.jsxs("div",{className:"breadcrumb-bar",children:[Ot.jsx("button",{className:"breadcrumb-home-btn",onClick:()=>{t("")},title:i("storyboard.fileBrowser.breadcrumb.goToComputer"),children:Ot.jsx(_T,{size:14})}),a?Ot.jsx("div",{className:"breadcrumb-edit-container",children:Ot.jsx("input",{ref:c,type:"text",className:"breadcrumb-input",value:s,onChange:e=>l(e.target.value),onKeyDown:t=>{"Enter"===t.key?d():"Escape"===t.key&&(l(e),o(!1))},onBlur:d,placeholder:i("storyboard.fileBrowser.breadcrumb.enterPath")})}):Ot.jsx("div",{className:"breadcrumb-segments",onClick:()=>{o(!0)},title:i("storyboard.fileBrowser.breadcrumb.clickToEdit"),children:u.map((e,n)=>Ot.jsxs("div",{className:"breadcrumb-segment-wrapper",children:[n>0&&Ot.jsx(tT,{size:14,className:"breadcrumb-separator"}),Ot.jsx("button",{className:"breadcrumb-segment "+(n===u.length-1?"current":""),onClick:n=>{var r;n.stopPropagation(),r=e.path,t(r)},disabled:n===u.length-1,children:e.name})]},e.path))}),Ot.jsx("button",{className:"breadcrumb-refresh-btn",onClick:n,disabled:r,title:i("storyboard.fileBrowser.breadcrumb.refresh"),children:Ot.jsx(jT,{size:14,className:r?"spinning":""})})]})}function ck({isOpen:e,onClose:t,mode:n,orchestratorUrl:r,initialPath:i="",projectName:a="",title:o,onOpenProject:s,onSaveProject:l,onSelectFolder:c}){var u,d,h,p;const{t:m}=yf(),{state:f,navigateTo:g,selectItem:v,expandTreeNode:y,collapseTreeNode:_,refresh:x,goToParent:b}=function(e,t="",n=!0){const[r,i]=kt.useState({currentPath:t,selectedItem:null,treeNodes:[],folderContents:[],isLoading:!1,error:null,expandedPaths:new Set}),a=kt.useRef(new Map),o=kt.useCallback(async(t,n=!0)=>{if(n&&a.current.has(t))return{items:a.current.get(t),parent:null};try{const n=await fetch(`${e}/api/browse-folders?path=${encodeURIComponent(t)}`,{method:"GET"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=await n.json();if(!i.success)throw new Error(i.error||"Failed to browse folder");const o=[...(i.items??i.folders??[]).map(e=>({...e,type:e.type}))];if(i.current)try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),r=await fetch(`${e}/api/list-projects?folder_path=${encodeURIComponent(i.current)}`,{method:"GET",signal:t.signal});if(clearTimeout(n),r.ok){const e=await r.json();if(e.success&&e.projects){const t=e.projects.map(e=>({name:e.name,path:e.path,type:"project",metadata:{name:e.name,savedAt:e.saved_at,panelCount:e.panel_count}}));o.push(...t)}}}catch(r){console.warn("[useFileBrowser] Failed to fetch projects:",r)}return a.current.set(t,o),{items:o,parent:i.parent}}catch(k){throw console.error("[useFileBrowser] Failed to fetch folder contents:",k),k}},[e]),s=kt.useCallback(async t=>{try{const n=await fetch(`${e}/api/browse-folders?path=${encodeURIComponent(t)}`,{method:"GET"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const r=await n.json();if(!r.success)throw new Error(r.error||"Failed to browse folder");return(r.items??r.folders??[]).filter(e=>"folder"===e.type).map(e=>({id:e.path,name:e.name,path:e.path,type:"folder",children:void 0,isLoading:!1,isExpanded:!1}))}catch(k){return console.error("[useFileBrowser] Failed to fetch tree children:",k),[]}},[e]),l=kt.useCallback(async e=>{i(e=>({...e,isLoading:!0,error:null}));try{const{items:t}=await o(e);i(n=>({...n,currentPath:e,folderContents:t,isLoading:!1,selectedItem:null}))}catch(t){i(e=>({...e,isLoading:!1,error:t instanceof Error?t.message:"Failed to navigate"}))}},[o]),c=kt.useCallback(e=>{i(t=>({...t,selectedItem:e}))},[]),u=kt.useCallback(async e=>{i(t=>{const n=new Set(t.expandedPaths);return n.add(e),{...t,expandedPaths:n}});const t=(e,n)=>{for(const r of e){if(r.path===n)return r;if(r.children){const e=t(r.children,n);if(e)return e}}return null},n=t(r.treeNodes,e);if(n&&n.children&&n.children.length>0)i(t=>{const n=t=>t.map(t=>t.path===e?{...t,isExpanded:!0}:t.children?{...t,children:n(t.children)}:t);return{...t,treeNodes:n(t.treeNodes)}});else{i(t=>{const n=t=>t.map(t=>t.path===e?{...t,isLoading:!0}:t.children?{...t,children:n(t.children)}:t);return{...t,treeNodes:n(t.treeNodes)}});try{const t=await s(e);i(n=>{const r=n=>n.map(n=>n.path===e?{...n,children:t,isLoading:!1,isExpanded:!0}:n.children?{...n,children:r(n.children)}:n);return{...n,treeNodes:r(n.treeNodes)}})}catch(a){i(t=>{const n=t=>t.map(t=>t.path===e?{...t,isLoading:!1}:t.children?{...t,children:n(t.children)}:t);return{...t,treeNodes:n(t.treeNodes)}})}}},[r.treeNodes,s]),d=kt.useCallback(e=>{i(t=>{const n=new Set(t.expandedPaths);n.delete(e);const r=t=>t.map(t=>t.path===e?{...t,isExpanded:!1}:t.children?{...t,children:r(t.children)}:t);return{...t,expandedPaths:n,treeNodes:r(t.treeNodes)}})},[]),h=kt.useCallback(async()=>{a.current.delete(r.currentPath),await l(r.currentPath)},[r.currentPath,l]),p=kt.useCallback(async()=>{try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),i=await fetch(`${e}/api/browse-folders?path=${encodeURIComponent(r.currentPath)}`,{method:"GET",signal:t.signal});if(clearTimeout(n),!i.ok)throw new Error(`HTTP ${i.status}`);const a=await i.json();a.success&&a.parent&&await l(a.parent)}catch(t){console.error("[useFileBrowser] Failed to go to parent:",t)}},[r.currentPath,e,l]),m=kt.useCallback(async()=>{await l("")},[l]);return kt.useEffect(()=>{n&&(a.current.clear(),i({currentPath:t,selectedItem:null,treeNodes:[],folderContents:[],isLoading:!0,error:null,expandedPaths:new Set}),(async()=>{try{const n=await fetch(`${e}/api/browse-folders?path=`,{method:"GET"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const r=await n.json();if(r.success){const e=r.items??r.folders??[],n=e.filter(e=>"drive"===e.type).map(e=>({id:e.path,name:e.name,path:e.path,type:"drive",children:void 0,isLoading:!1,isExpanded:!1}));i(t=>({...t,isLoading:!1,treeNodes:n,folderContents:e.map(e=>({...e,type:e.type}))})),t&&await l(t)}else i(e=>({...e,isLoading:!1,error:r.error||"Failed to load drives"}))}catch(n){i(e=>({...e,isLoading:!1,error:n instanceof Error?n.message:"Failed to load drives"}))}})())},[e,n,t,l]),{state:r,navigateTo:l,selectItem:c,expandTreeNode:u,collapseTreeNode:d,refresh:h,goToParent:p,goToRoot:m}}(r,i,e),[w,S]=kt.useState(a),[M,E]=kt.useState(!1),[C,T]=kt.useState(""),[k,P]=kt.useState(null);kt.useEffect(()=>{a&&S(a)},[a]),kt.useEffect(()=>{P(null)},[f.currentPath]),kt.useEffect(()=>{if(!e)return;const r=e=>{var r;if("Escape"===e.key)return e.preventDefault(),void t();if("Enter"===e.key)return e.preventDefault(),void(("select-folder"===n&&f.currentPath||"open"===n&&"project"===(null==(r=f.selectedItem)?void 0:r.type)||"save"===n&&w.trim())&&L());if("Backspace"===e.key&&!e.shiftKey){"INPUT"!==e.target.tagName&&(e.preventDefault(),b())}};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[e,n,f.selectedItem,w,t,b]);const A=kt.useCallback(async e=>{await g(e)},[g]),N=kt.useCallback(e=>{if(v(e),"save"===n&&"project"===e.type){const t=e.name.replace(/_project\.json$/i,"");S(t)}},[v,n]),R=kt.useCallback(e=>{"folder"===e.type||"drive"===e.type?g(e.path):"project"===e.type&&"open"===n&&s(e.path)},[g,s,n]),L=()=>{var e,r,i,a;if("select-folder"===n){const n="folder"===(null==(e=f.selectedItem)?void 0:e.type)||"drive"===(null==(r=f.selectedItem)?void 0:r.type)?f.selectedItem.path:f.currentPath;if(!n)return void P(m("storyboard.fileBrowser.pleaseSelectFolder"));c&&c(n),t()}else if("open"===n)"project"===(null==(i=f.selectedItem)?void 0:i.type)?s(f.selectedItem.path):"folder"===(null==(a=f.selectedItem)?void 0:a.type)?g(f.selectedItem.path):P(m("storyboard.fileBrowser.pleaseSelectProject"));else if("save"===n){if(!w.trim())return void P(m("storyboard.fileBrowser.pleaseEnterProjectName"));if(!f.currentPath)return void P(m("storyboard.fileBrowser.pleaseSelectSaveFolder"));l&&l(f.currentPath,w.trim())}},I=async()=>{if(C.trim())try{const e=await fetch(`${r}/api/create-folder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_path:f.currentPath,folder_name:C.trim()})});if(e.ok){const t=await e.json();t.success?(E(!1),T(""),await x(),t.folder_path&&await g(t.folder_path)):P(t.message||m("storyboard.fileBrowser.failedToCreateFolder"))}else P(m("storyboard.fileBrowser.failedToCreateFolder"))}catch(e){P(m("storyboard.fileBrowser.errorCreatingFolder",{error:String(e)}))}};return e?Ot.jsx("div",{className:"file-browser-overlay",onClick:t,children:Ot.jsxs("div",{className:"file-browser-dialog",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"file-browser-header",children:[Ot.jsx("div",{className:"file-browser-title",children:"select-folder"===n?Ot.jsxs(Ot.Fragment,{children:[Ot.jsx(mT,{size:18}),Ot.jsx("span",{children:o||m("storyboard.fileBrowser.selectFolder")})]}):"open"===n?Ot.jsxs(Ot.Fragment,{children:[Ot.jsx(mT,{size:18}),Ot.jsx("span",{children:o||m("storyboard.fileBrowser.loadProject")})]}):Ot.jsxs(Ot.Fragment,{children:[Ot.jsx(UT,{size:18}),Ot.jsx("span",{children:o||m("storyboard.fileBrowser.saveProjectAs")})]})}),Ot.jsx("button",{className:"close-btn",onClick:t,children:Ot.jsx(XT,{size:18})})]}),Ot.jsxs("div",{className:"file-browser-body",children:[Ot.jsx("div",{className:"file-browser-left-pane",children:Ot.jsx(ok,{nodes:f.treeNodes,selectedPath:f.currentPath,expandedPaths:f.expandedPaths,onSelectFolder:A,onExpandFolder:y,onCollapseFolder:_})}),Ot.jsxs("div",{className:"file-browser-right-pane",children:[Ot.jsx(lk,{path:f.currentPath,onNavigate:g,onRefresh:x,isLoading:f.isLoading}),Ot.jsx(sk,{items:f.folderContents,selectedItem:f.selectedItem,onSelectItem:N,onOpenItem:R,isLoading:f.isLoading}),k&&Ot.jsxs("div",{className:"file-browser-error",children:[Ot.jsx(rT,{size:16}),Ot.jsx("span",{children:k})]}),"save"===n&&Ot.jsxs("div",{className:"file-browser-save-input",children:[Ot.jsx("label",{children:m("storyboard.fileBrowser.projectNameLabel")}),Ot.jsx("input",{type:"text",value:w,onChange:e=>S(e.target.value),placeholder:m("storyboard.fileBrowser.projectNamePlaceholder"),onKeyDown:e=>{"Enter"===e.key&&L()},autoFocus:!0})]}),M&&Ot.jsxs("div",{className:"file-browser-new-folder",children:[Ot.jsx("input",{type:"text",value:C,onChange:e=>T(e.target.value),placeholder:m("storyboard.fileBrowser.newFolderNamePlaceholder"),onKeyDown:e=>{"Enter"===e.key?I():"Escape"===e.key&&(E(!1),T(""))},autoFocus:!0}),Ot.jsx("button",{onClick:I,children:m("storyboard.fileBrowser.create")}),Ot.jsx("button",{onClick:()=>{E(!1),T("")},children:m("storyboard.fileBrowser.cancel")})]})]})]}),Ot.jsxs("div",{className:"file-browser-footer",children:[Ot.jsxs("button",{className:"new-folder-btn",onClick:()=>E(!0),disabled:M||!f.currentPath,children:[Ot.jsx(fT,{size:16}),Ot.jsx("span",{children:m("storyboard.fileBrowser.newFolder")})]}),"select-folder"===n&&f.currentPath&&Ot.jsxs("div",{className:"file-browser-selected-path",title:"folder"===(null==(u=f.selectedItem)?void 0:u.type)||"drive"===(null==(d=f.selectedItem)?void 0:d.type)?f.selectedItem.path:f.currentPath,children:[Ot.jsx("span",{className:"selected-path-label",children:m("storyboard.fileBrowser.selected")}),Ot.jsx("span",{className:"selected-path-value",children:"folder"===(null==(h=f.selectedItem)?void 0:h.type)||"drive"===(null==(p=f.selectedItem)?void 0:p.type)?f.selectedItem.path:f.currentPath})]}),Ot.jsxs("div",{className:"file-browser-actions",children:[Ot.jsx("button",{className:"cancel-btn",onClick:t,children:m("storyboard.fileBrowser.cancel")}),Ot.jsx("button",{className:"primary-btn",onClick:L,disabled:(()=>{var e,t,r,i;if("select-folder"===n){return!("folder"===(null==(e=f.selectedItem)?void 0:e.type)||"drive"===(null==(t=f.selectedItem)?void 0:t.type)||!!f.currentPath)}return"open"===n?"project"!==(null==(r=f.selectedItem)?void 0:r.type)&&"folder"!==(null==(i=f.selectedItem)?void 0:i.type):!w.trim()||!f.currentPath})(),children:"select-folder"===n?m("storyboard.fileBrowser.selectFolder"):"open"===n?"project"===(null==(j=f.selectedItem)?void 0:j.type)?m("storyboard.fileBrowser.openProject"):m("storyboard.fileBrowser.selectFolder"):m("storyboard.fileBrowser.save")})]})]})]})}):null;var j}function uk({isOpen:e,onClose:t,settings:n,onSave:r}){const{t:i}=yf(),[a,o]=kt.useState(n.name),[s,l]=kt.useState(n.path),[c,u]=kt.useState(n.namingTemplate),[d,h]=kt.useState(n.autoSave),[p,m]=kt.useState(n.orchestratorUrl||nk()),[f,g]=kt.useState("checking"),[v,y]=kt.useState(!1),[_,x]=kt.useState(null),[b,w]=kt.useState(!1);if(kt.useEffect(()=>{e&&(o(n.name),l(n.path),u(n.namingTemplate),h(n.autoSave),m(n.orchestratorUrl||nk()))},[e,n]),kt.useEffect(()=>{if(!e||!p)return;g("checking");const t=new AbortController;return fetch(`${p}/api/health`,{signal:t.signal}).then(e=>e.ok?g("online"):g("offline")).catch(()=>g("offline")),()=>t.abort()},[e,p]),!e)return null;const S=async()=>{if(!s||!p)return;w(!0);const e=await ik.validateProjectPath(s,p);x(e),w(!1)};return Ot.jsxs("div",{className:"modal-overlay",onClick:t,children:[Ot.jsxs("div",{className:"project-settings-modal",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"modal-header",children:[Ot.jsx("h2",{children:i("storyboard.projectSettings.title")}),Ot.jsx("button",{className:"close-btn",onClick:t,children:""})]}),Ot.jsxs("div",{className:"modal-body",children:[Ot.jsxs("div",{className:"form-group",children:[Ot.jsx("label",{htmlFor:"project-name",children:i("storyboard.projectSettings.projectName")}),Ot.jsx("input",{id:"project-name",type:"text",value:a,onChange:e=>o(e.target.value),placeholder:i("storyboard.projectSettings.projectNamePlaceholder")})]}),Ot.jsxs("div",{className:"form-group",children:[Ot.jsx("label",{htmlFor:"project-path",children:i("storyboard.projectSettings.outputPath")}),Ot.jsxs("div",{className:"input-with-button",children:[Ot.jsx("input",{id:"project-path",type:"text",value:s,onChange:e=>{l(e.target.value),x(null)},onBlur:S,placeholder:i("storyboard.projectSettings.outputPathPlaceholder")}),Ot.jsx("button",{type:"button",className:"browse-btn",onClick:()=>y(!0),disabled:"online"!==f,title:i("online"!==f?"storyboard.projectSettings.browseRequiresOnline":"storyboard.projectSettings.browseFolders"),children:Ot.jsx(mT,{size:16})}),Ot.jsx("button",{type:"button",className:"validate-btn",onClick:S,disabled:!s||!p||b,title:i("storyboard.projectSettings.validatePathTitle"),children:b?"...":i("storyboard.projectSettings.validate")})]}),_&&Ot.jsxs("div",{className:"path-validation-indicator "+(_.valid?"valid":"invalid"),children:[_.valid?Ot.jsx(iT,{size:14}):Ot.jsx(aT,{size:14}),Ot.jsx("span",{children:_.message})]}),Ot.jsx("small",{className:"help-text",children:i("storyboard.projectSettings.outputPathHelp")})]}),Ot.jsxs("div",{className:"form-group",children:[Ot.jsxs("label",{htmlFor:"orchestrator-url",children:[i("storyboard.projectSettings.orchestratorUrl"),Ot.jsx("span",{className:`status-indicator ${f}`,children:"checking"===f?"...":"online"===f?` ${i("storyboard.projectSettings.statusOnline")}`:` ${i("storyboard.projectSettings.statusOffline")}`})]}),Ot.jsx("input",{id:"orchestrator-url",type:"text",value:p,onChange:e=>m(e.target.value),placeholder:i("storyboard.projectSettings.orchestratorUrlPlaceholder")}),Ot.jsx("small",{className:"help-text",children:i("storyboard.projectSettings.orchestratorUrlHelp")})]}),Ot.jsxs("div",{className:"form-group",children:[Ot.jsx("label",{htmlFor:"naming-template",children:i("storyboard.projectSettings.namingTemplate")}),Ot.jsx("input",{id:"naming-template",type:"text",value:c,onChange:e=>u(e.target.value),placeholder:i("storyboard.projectSettings.namingTemplatePlaceholder")}),Ot.jsxs("small",{className:"help-text",children:[i("storyboard.projectSettings.availableTokens")," ","{project}",", ","{panel}",", ","{version}",", ","{timestamp}",", ","{date}",", ","{time}",", ","{seed}",", ","{workflow}",Ot.jsx("br",{}),Ot.jsx("span",{children:i("storyboard.projectSettings.panelTokenExplanation")})]}),Ot.jsxs("div",{className:"preview",children:[Ot.jsx("strong",{children:i("storyboard.projectSettings.preview")})," ",(()=>{const e=new Date,t=(e,t=2)=>e.toString().padStart(t,"0"),n={"{project}":a.replace(/[<>:"/\\|?*\s]/g,"_").substring(0,50),"{panel}":"Panel_01","{version}":"v001","{timestamp}":`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}_${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`,"{date}":`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}`,"{time}":`${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`,"{seed}":"12345678","{workflow}":"MyWorkflow"};let r=c;for(const[i,a]of Object.entries(n))r=r.split(i).join(a);return r+".png"})()]})]}),Ot.jsxs("div",{className:"form-group checkbox-group",children:[Ot.jsxs("label",{children:[Ot.jsx("input",{type:"checkbox",checked:d,onChange:e=>h(e.target.checked)}),i("storyboard.projectSettings.autoSave")]}),Ot.jsx("small",{className:"help-text",children:i("storyboard.projectSettings.autoSaveHelp")})]}),Ot.jsxs("div",{className:"template-examples",children:[Ot.jsx("h4",{children:i("storyboard.projectSettings.commonTemplates")}),Ot.jsxs("div",{className:"template-list",children:[Ot.jsxs("button",{type:"button",className:"template-btn",onClick:()=>u("{project}_{panel}_{version}"),children:[i("storyboard.projectSettings.templatePanelBased")," ","{project}_{panel}_{version}",Ot.jsxs("small",{children:[i("storyboard.projectSettings.templatePanelBasedResult")," Eliot_Panel_01_v001.png"]})]}),Ot.jsxs("button",{type:"button",className:"template-btn",onClick:()=>u("{panel}\\{project}_{panel}_{version}"),children:[i("storyboard.projectSettings.templatePerPanelFolders")," ","{panel}\\{project}_{panel}_{version}",Ot.jsxs("small",{children:[i("storyboard.projectSettings.templatePerPanelFoldersResult")," Panel_01\\Eliot_Panel_01_v001.png"]})]}),Ot.jsxs("button",{type:"button",className:"template-btn",onClick:()=>u("{project}_SHOT{panel}_{version}"),children:[i("storyboard.projectSettings.templateShotBased")," ","{project}_SHOT{panel}_{version}",Ot.jsxs("small",{children:[i("storyboard.projectSettings.templatePanelBasedResult")," Eliot_SHOTPanel_01_v001.png"]})]}),Ot.jsxs("button",{type:"button",className:"template-btn",onClick:()=>u("{project}_{panel}_{timestamp}"),children:[i("storyboard.projectSettings.templateTimestamped")," ","{project}_{panel}_{timestamp}",Ot.jsxs("small",{children:[i("storyboard.projectSettings.templatePanelBasedResult")," Eliot_Panel_01_20250206_143022.png"]})]}),Ot.jsxs("button",{type:"button",className:"template-btn",onClick:()=>u("{workflow}_{seed}_{version}"),children:[i("storyboard.projectSettings.templateSeedBased")," ","{workflow}_{seed}_{version}",Ot.jsxs("small",{children:[i("storyboard.projectSettings.templatePanelBasedResult")," MyWorkflow_12345678_v001.png"]})]})]})]})]}),Ot.jsxs("div",{className:"modal-footer",children:[Ot.jsx("button",{className:"btn-secondary",onClick:t,children:i("storyboard.projectSettings.cancel")}),Ot.jsx("button",{className:"btn-primary",onClick:()=>{r({name:a,path:s,namingTemplate:c,autoSave:d,orchestratorUrl:p}),t()},children:i("storyboard.projectSettings.save")})]})]}),Ot.jsx(ck,{isOpen:v,onClose:()=>y(!1),mode:"select-folder",orchestratorUrl:p,initialPath:s,title:i("storyboard.projectSettings.selectOutputFolder"),onOpenProject:()=>{},onSelectFolder:e=>{l(e),y(!1)}})]})}function dk({isOpen:e,onClose:t,onSelect:n,orchestratorUrl:r,initialPath:i="",title:a="Select Folder"}){const[o,s]=kt.useState(i),[l,c]=kt.useState([]),[u,d]=kt.useState(null),[h,p]=kt.useState(!1),[m,f]=kt.useState(null),[g,v]=kt.useState(""),[y,_]=kt.useState(!1),x=kt.useCallback(async e=>{if(r){p(!0),f(null);try{const t=await fetch(`${r}/api/browse-folders?path=${encodeURIComponent(e)}`,{method:"GET"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();n.success?(s(n.current||""),c(n.items||[]),d(n.parent)):f(n.error||"Failed to load folder")}catch(t){f(`Failed to connect: ${t}`)}finally{p(!1)}}else f("Orchestrator URL not configured")},[r]);kt.useEffect(()=>{e&&x(i)},[e,i,x]);const b=async()=>{if(g.trim())try{const e=await fetch(`${r}/api/create-folder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_path:o||"C:/",folder_name:g.trim()})}),t=await e.json();if(!t.success)return void f(t.message);_(!1),v("");const n=t.created_path.replace(/\//g,"\\");s(n),await x(n)}catch(e){f(`Failed to create folder: ${e}`)}};return e?Ot.jsx("div",{className:"folder-browser-overlay",onClick:t,children:Ot.jsxs("div",{className:"folder-browser-modal",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"folder-browser-header",children:[Ot.jsx("h3",{children:a}),Ot.jsx("button",{className:"close-btn",onClick:t,children:Ot.jsx(XT,{size:18})})]}),Ot.jsxs("div",{className:"folder-browser-toolbar",children:[Ot.jsx("button",{onClick:()=>u&&x(u),disabled:!u||h,title:"Go to parent folder",children:Ot.jsx(eT,{size:18})}),Ot.jsx("input",{type:"text",value:o,onChange:e=>s(e.target.value),onKeyDown:e=>"Enter"===e.key&&x(o),placeholder:"Enter path..."}),Ot.jsx("button",{onClick:()=>x(o),disabled:h,title:"Refresh",children:Ot.jsx(jT,{size:18,className:h?"spinning":""})})]}),Ot.jsxs("div",{className:"folder-browser-content",children:[m&&Ot.jsx("div",{className:"folder-error",children:m}),h?Ot.jsx("div",{className:"folder-loading",children:"Loading..."}):Ot.jsxs("div",{className:"folder-list",children:[0===l.length&&!m&&Ot.jsx("div",{className:"folder-empty",children:"No folders found"}),l.map(e=>Ot.jsxs("div",{className:"folder-item",onDoubleClick:()=>x(e.path),children:["drive"===e.type?Ot.jsx(yT,{size:18}):Ot.jsx(gT,{size:18}),Ot.jsx("span",{children:e.name})]},e.path))]})]}),y&&Ot.jsxs("div",{className:"new-folder-input",children:[Ot.jsx("input",{type:"text",value:g,onChange:e=>v(e.target.value),placeholder:"New folder name...",onKeyDown:e=>"Enter"===e.key&&b(),autoFocus:!0}),Ot.jsx("button",{onClick:b,children:"Create"}),Ot.jsx("button",{onClick:()=>_(!1),children:"Cancel"})]}),Ot.jsxs("div",{className:"folder-browser-footer",children:[Ot.jsxs("div",{className:"folder-path-display",children:[Ot.jsx(mT,{size:16}),Ot.jsx("span",{children:o||"No folder selected"})]}),Ot.jsxs("div",{className:"folder-actions",children:[Ot.jsx("button",{className:"new-folder-btn",onClick:()=>_(!0),disabled:!o,children:"New Folder"}),Ot.jsx("button",{className:"cancel-btn",onClick:t,children:"Cancel"}),Ot.jsxs("button",{className:"select-btn",onClick:()=>{o&&(n(o),t())},disabled:!o,children:[Ot.jsx(JC,{size:16}),"Select"]})]})]})]})}):null}function hk({isOpen:e,filename:t,onConfirm:n,onCancel:r,onSuppressForSession:i}){const{t:a}=yf(),[o,s]=kt.useState(!1);return e?Ot.jsx("div",{className:"modal-overlay delete-confirm-overlay",children:Ot.jsxs("div",{className:"delete-confirm-dialog",children:[Ot.jsx("h3",{children:a("storyboard.deleteConfirm.title")}),Ot.jsx("p",{children:a("storyboard.deleteConfirm.prompt")}),Ot.jsx("p",{className:"delete-filename",children:t}),Ot.jsx("p",{className:"delete-warning",children:a("storyboard.deleteConfirm.warning")}),Ot.jsxs("label",{className:"dont-ask-checkbox",children:[Ot.jsx("input",{type:"checkbox",checked:o,onChange:e=>s(e.target.checked)}),Ot.jsx("span",{children:a("storyboard.deleteConfirm.dontAskAgain")})]}),Ot.jsxs("div",{className:"dialog-actions",children:[Ot.jsx("button",{className:"cancel-btn",onClick:r,children:a("storyboard.deleteConfirm.cancel")}),Ot.jsx("button",{className:"delete-btn",onClick:()=>{o&&i(),n()},children:a("storyboard.deleteConfirm.delete")})]})]})}):null}function pk(){}function mk(){}const fk=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,gk=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,vk={};function yk(e,t){return(vk.jsx?gk:fk).test(e)}const _k=/[ \t\n\f\r]/g;function xk(e){return""===e.replace(_k,"")}class bk{constructor(e,t,n){this.normal=t,this.property=e,n&&(this.space=n)}}function wk(e,t){const n={},r={};for(const i of e)Object.assign(n,i.property),Object.assign(r,i.normal);return new bk(n,r,t)}function Sk(e){return e.toLowerCase()}bk.prototype.normal={},bk.prototype.property={},bk.prototype.space=void 0;class Mk{constructor(e,t){this.attribute=t,this.property=e}}Mk.prototype.attribute="",Mk.prototype.booleanish=!1,Mk.prototype.boolean=!1,Mk.prototype.commaOrSpaceSeparated=!1,Mk.prototype.commaSeparated=!1,Mk.prototype.defined=!1,Mk.prototype.mustUseProperty=!1,Mk.prototype.number=!1,Mk.prototype.overloadedBoolean=!1,Mk.prototype.property="",Mk.prototype.spaceSeparated=!1,Mk.prototype.space=void 0;let Ek=0;const Ck=Lk(),Tk=Lk(),kk=Lk(),Pk=Lk(),Ak=Lk(),Nk=Lk(),Rk=Lk();function Lk(){return 2**++Ek}const Ik=Object.freeze(Object.defineProperty({__proto__:null,boolean:Ck,booleanish:Tk,commaOrSpaceSeparated:Rk,commaSeparated:Nk,number:Pk,overloadedBoolean:kk,spaceSeparated:Ak},Symbol.toStringTag,{value:"Module"})),jk=Object.keys(Ik);class Dk extends Mk{constructor(e,t,n,r){let i=-1;if(super(e,t),Ok(this,"space",r),"number"==typeof n)for(;++i<jk.length;){const e=jk[i];Ok(this,jk[i],(n&Ik[e])===Ik[e])}}}function Ok(e,t,n){n&&(e[t]=n)}function Uk(e){const t={},n={};for(const[r,i]of Object.entries(e.properties)){const a=new Dk(r,e.transform(e.attributes||{},r),i,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),t[r]=a,n[Sk(r)]=r,n[Sk(a.attribute)]=r}return new bk(t,n,e.space)}Dk.prototype.defined=!0;const Fk=Uk({properties:{ariaActiveDescendant:null,ariaAtomic:Tk,ariaAutoComplete:null,ariaBusy:Tk,ariaChecked:Tk,ariaColCount:Pk,ariaColIndex:Pk,ariaColSpan:Pk,ariaControls:Ak,ariaCurrent:null,ariaDescribedBy:Ak,ariaDetails:null,ariaDisabled:Tk,ariaDropEffect:Ak,ariaErrorMessage:null,ariaExpanded:Tk,ariaFlowTo:Ak,ariaGrabbed:Tk,ariaHasPopup:null,ariaHidden:Tk,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ak,ariaLevel:Pk,ariaLive:null,ariaModal:Tk,ariaMultiLine:Tk,ariaMultiSelectable:Tk,ariaOrientation:null,ariaOwns:Ak,ariaPlaceholder:null,ariaPosInSet:Pk,ariaPressed:Tk,ariaReadOnly:Tk,ariaRelevant:null,ariaRequired:Tk,ariaRoleDescription:Ak,ariaRowCount:Pk,ariaRowIndex:Pk,ariaRowSpan:Pk,ariaSelected:Tk,ariaSetSize:Pk,ariaSort:null,ariaValueMax:Pk,ariaValueMin:Pk,ariaValueNow:Pk,ariaValueText:null,role:null},transform:(e,t)=>"role"===t?t:"aria-"+t.slice(4).toLowerCase()});function zk(e,t){return t in e?e[t]:t}function Bk(e,t){return zk(e,t.toLowerCase())}const Hk=Uk({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Nk,acceptCharset:Ak,accessKey:Ak,action:null,allow:null,allowFullScreen:Ck,allowPaymentRequest:Ck,allowUserMedia:Ck,alt:null,as:null,async:Ck,autoCapitalize:null,autoComplete:Ak,autoFocus:Ck,autoPlay:Ck,blocking:Ak,capture:null,charSet:null,checked:Ck,cite:null,className:Ak,cols:Pk,colSpan:null,content:null,contentEditable:Tk,controls:Ck,controlsList:Ak,coords:Pk|Nk,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Ck,defer:Ck,dir:null,dirName:null,disabled:Ck,download:kk,draggable:Tk,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Ck,formTarget:null,headers:Ak,height:Pk,hidden:kk,high:Pk,href:null,hrefLang:null,htmlFor:Ak,httpEquiv:Ak,id:null,imageSizes:null,imageSrcSet:null,inert:Ck,inputMode:null,integrity:null,is:null,isMap:Ck,itemId:null,itemProp:Ak,itemRef:Ak,itemScope:Ck,itemType:Ak,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Ck,low:Pk,manifest:null,max:null,maxLength:Pk,media:null,method:null,min:null,minLength:Pk,multiple:Ck,muted:Ck,name:null,nonce:null,noModule:Ck,noValidate:Ck,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Ck,optimum:Pk,pattern:null,ping:Ak,placeholder:null,playsInline:Ck,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Ck,referrerPolicy:null,rel:Ak,required:Ck,reversed:Ck,rows:Pk,rowSpan:Pk,sandbox:Ak,scope:null,scoped:Ck,seamless:Ck,selected:Ck,shadowRootClonable:Ck,shadowRootDelegatesFocus:Ck,shadowRootMode:null,shape:null,size:Pk,sizes:null,slot:null,span:Pk,spellCheck:Tk,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Pk,step:null,style:null,tabIndex:Pk,target:null,title:null,translate:null,type:null,typeMustMatch:Ck,useMap:null,value:Tk,width:Pk,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ak,axis:null,background:null,bgColor:null,border:Pk,borderColor:null,bottomMargin:Pk,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Ck,declare:Ck,event:null,face:null,frame:null,frameBorder:null,hSpace:Pk,leftMargin:Pk,link:null,longDesc:null,lowSrc:null,marginHeight:Pk,marginWidth:Pk,noResize:Ck,noHref:Ck,noShade:Ck,noWrap:Ck,object:null,profile:null,prompt:null,rev:null,rightMargin:Pk,rules:null,scheme:null,scrolling:Tk,standby:null,summary:null,text:null,topMargin:Pk,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Pk,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Ck,disableRemotePlayback:Ck,prefix:null,property:null,results:Pk,security:null,unselectable:null},space:"html",transform:Bk}),Vk=Uk({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Rk,accentHeight:Pk,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Pk,amplitude:Pk,arabicForm:null,ascent:Pk,attributeName:null,attributeType:null,azimuth:Pk,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Pk,by:null,calcMode:null,capHeight:Pk,className:Ak,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Pk,diffuseConstant:Pk,direction:null,display:null,dur:null,divisor:Pk,dominantBaseline:null,download:Ck,dx:null,dy:null,edgeMode:null,editable:null,elevation:Pk,enableBackground:null,end:null,event:null,exponent:Pk,externalResourcesRequired:null,fill:null,fillOpacity:Pk,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Nk,g2:Nk,glyphName:Nk,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Pk,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Pk,horizOriginX:Pk,horizOriginY:Pk,id:null,ideographic:Pk,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Pk,k:Pk,k1:Pk,k2:Pk,k3:Pk,k4:Pk,kernelMatrix:Rk,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Pk,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Pk,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Pk,overlineThickness:Pk,paintOrder:null,panose1:null,path:null,pathLength:Pk,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ak,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Pk,pointsAtY:Pk,pointsAtZ:Pk,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Rk,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Rk,rev:Rk,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Rk,requiredFeatures:Rk,requiredFonts:Rk,requiredFormats:Rk,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Pk,specularExponent:Pk,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Pk,strikethroughThickness:Pk,string:null,stroke:null,strokeDashArray:Rk,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Pk,strokeOpacity:Pk,strokeWidth:null,style:null,surfaceScale:Pk,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Rk,tabIndex:Pk,tableValues:null,target:null,targetX:Pk,targetY:Pk,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Rk,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Pk,underlineThickness:Pk,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Pk,values:null,vAlphabetic:Pk,vMathematical:Pk,vectorEffect:null,vHanging:Pk,vIdeographic:Pk,version:null,vertAdvY:Pk,vertOriginX:Pk,vertOriginY:Pk,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Pk,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:zk}),Gk=Uk({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform:(e,t)=>"xlink:"+t.slice(5).toLowerCase()}),Wk=Uk({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Bk}),$k=Uk({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform:(e,t)=>"xml:"+t.slice(3).toLowerCase()}),Xk={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},qk=/[A-Z]/g,Kk=/-[a-z]/g,Yk=/^data[-\w.:]+$/i;function Zk(e){return"-"+e.toLowerCase()}function Jk(e){return e.charAt(1).toUpperCase()}const Qk=wk([Fk,Hk,Gk,Wk,$k],"html"),eP=wk([Fk,Vk,Gk,Wk,$k],"svg");var tP={},nP=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,rP=/\n/g,iP=/^\s*/,aP=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,oP=/^:\s*/,sP=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,lP=/^[;\s]*/,cP=/^\s+|\s+$/g,uP="";function dP(e){return e?e.replace(cP,uP):uP}var hP=function(e,t){if("string"!=typeof e)throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var n=1,r=1;function i(e){var t=e.match(rP);t&&(n+=t.length);var i=e.lastIndexOf("\n");r=~i?e.length-i:r+e.length}function a(){var e={line:n,column:r};return function(t){return t.position=new o(e),c(),t}}function o(e){this.start=e,this.end={line:n,column:r},this.source=t.source}function s(i){var a=new Error(t.source+":"+n+":"+r+": "+i);if(a.reason=i,a.filename=t.source,a.line=n,a.column=r,a.source=e,!t.silent)throw a}function l(t){var n=t.exec(e);if(n){var r=n[0];return i(r),e=e.slice(r.length),n}}function c(){l(iP)}function u(e){var t;for(e=e||[];t=d();)!1!==t&&e.push(t);return e}function d(){var t=a();if("/"==e.charAt(0)&&"*"==e.charAt(1)){for(var n=2;uP!=e.charAt(n)&&("*"!=e.charAt(n)||"/"!=e.charAt(n+1));)++n;if(n+=2,uP===e.charAt(n-1))return s("End of comment missing");var o=e.slice(2,n-2);return r+=2,i(o),e=e.slice(n),r+=2,t({type:"comment",comment:o})}}function h(){var e=a(),t=l(aP);if(t){if(d(),!l(oP))return s("property missing ':'");var n=l(sP),r=e({type:"declaration",property:dP(t[0].replace(nP,uP)),value:n?dP(n[0].replace(nP,uP)):uP});return l(lP),r}}return o.prototype.content=e,c(),function(){var e,t=[];for(u(t);e=h();)!1!==e&&(t.push(e),u(t));return t}()},pP=He&&He.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(tP,"__esModule",{value:!0}),tP.default=function(e,t){let n=null;if(!e||"string"!=typeof e)return n;const r=(0,mP.default)(e),i="function"==typeof t;return r.forEach(e=>{if("declaration"!==e.type)return;const{property:r,value:a}=e;i?t(r,a,e):a&&(n=n||{},n[r]=a)}),n};const mP=pP(hP);var fP={};Object.defineProperty(fP,"__esModule",{value:!0}),fP.camelCase=void 0;var gP=/^--[a-zA-Z0-9_-]+$/,vP=/-([a-z])/g,yP=/^[^-]+$/,_P=/^-(webkit|moz|ms|o|khtml)-/,xP=/^-(ms)-/,bP=function(e,t){return t.toUpperCase()},wP=function(e,t){return"".concat(t,"-")};fP.camelCase=function(e,t){return void 0===t&&(t={}),function(e){return!e||yP.test(e)||gP.test(e)}(e)?e:(e=e.toLowerCase(),(e=t.reactCompat?e.replace(xP,wP):e.replace(_P,wP)).replace(vP,bP))};var SP=(He&&He.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(tP),MP=fP;function EP(e,t){var n={};return e&&"string"==typeof e?((0,SP.default)(e,function(e,r){e&&r&&(n[(0,MP.camelCase)(e,t)]=r)}),n):n}EP.default=EP;const CP=Ve(EP),TP=PP("end"),kP=PP("start");function PP(e){return function(t){const n=t&&t.position&&t.position[e]||{};if("number"==typeof n.line&&n.line>0&&"number"==typeof n.column&&n.column>0)return{line:n.line,column:n.column,offset:"number"==typeof n.offset&&n.offset>-1?n.offset:void 0}}}function AP(e){return e&&"object"==typeof e?"position"in e||"type"in e?RP(e.position):"start"in e||"end"in e?RP(e):"line"in e||"column"in e?NP(e):"":""}function NP(e){return LP(e&&e.line)+":"+LP(e&&e.column)}function RP(e){return NP(e&&e.start)+"-"+NP(e&&e.end)}function LP(e){return e&&"number"==typeof e?e:1}class IP extends Error{constructor(e,t,n){super(),"string"==typeof t&&(n=t,t=void 0);let r="",i={},a=!1;if(t&&(i="line"in t&&"column"in t||"start"in t&&"end"in t?{place:t}:"type"in t?{ancestors:[t],place:t.position}:{...t}),"string"==typeof e?r=e:!i.cause&&e&&(a=!0,r=e.message,i.cause=e),!i.ruleId&&!i.source&&"string"==typeof n){const e=n.indexOf(":");-1===e?i.ruleId=n:(i.source=n.slice(0,e),i.ruleId=n.slice(e+1))}if(!i.place&&i.ancestors&&i.ancestors){const e=i.ancestors[i.ancestors.length-1];e&&(i.place=e.position)}const o=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=o?o.line:void 0,this.name=AP(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=a&&i.cause&&"string"==typeof i.cause.stack?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}IP.prototype.file="",IP.prototype.name="",IP.prototype.reason="",IP.prototype.message="",IP.prototype.stack="",IP.prototype.column=void 0,IP.prototype.line=void 0,IP.prototype.ancestors=void 0,IP.prototype.cause=void 0,IP.prototype.fatal=void 0,IP.prototype.place=void 0,IP.prototype.ruleId=void 0,IP.prototype.source=void 0;const jP={}.hasOwnProperty,DP=new Map,OP=/[A-Z]/g,UP=new Set(["table","tbody","thead","tfoot","tr"]),FP=new Set(["td","th"]),zP="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function BP(e,t){if(!t||void 0===t.Fragment)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let r;if(t.development){if("function"!=typeof t.jsxDEV)throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=function(e,t){return n;function n(n,r,i,a){const o=Array.isArray(i.children),s=kP(n);return t(r,i,a,o,{columnNumber:s?s.column-1:void 0,fileName:e,lineNumber:s?s.line:void 0},void 0)}}(n,t.jsxDEV)}else{if("function"!=typeof t.jsx)throw new TypeError("Expected `jsx` in production options");if("function"!=typeof t.jsxs)throw new TypeError("Expected `jsxs` in production options");r=function(e,t,n){return r;function r(e,r,i,a){const o=Array.isArray(i.children)?n:t;return a?o(r,i,a):o(r,i)}}(0,t.jsx,t.jsxs)}const i={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:!1!==t.passKeys,passNode:t.passNode||!1,schema:"svg"===t.space?eP:Qk,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==t.tableCellAlignToStyle},a=HP(i,e,void 0);return a&&"string"!=typeof a?a:i.create(e,i.Fragment,{children:a||void 0},void 0)}function HP(e,t,n){return"element"===t.type?function(e,t,n){const r=e.schema;let i=r;"svg"===t.tagName.toLowerCase()&&"html"===r.space&&(i=eP,e.schema=i);e.ancestors.push(t);const a=XP(e,t.tagName,!1),o=function(e,t){const n={};let r,i;for(i in t.properties)if("children"!==i&&jP.call(t.properties,i)){const a=$P(e,i,t.properties[i]);if(a){const[i,o]=a;e.tableCellAlignToStyle&&"align"===i&&"string"==typeof o&&FP.has(t.tagName)?r=o:n[i]=o}}if(r){(n.style||(n.style={}))["css"===e.stylePropertyNameCase?"text-align":"textAlign"]=r}return n}(e,t);let s=WP(e,t);UP.has(t.tagName)&&(s=s.filter(function(e){return"string"!=typeof e||!("object"==typeof(t=e)?"text"===t.type&&xk(t.value):xk(t));var t}));return VP(e,o,a,t),GP(o,s),e.ancestors.pop(),e.schema=r,e.create(t,a,o,n)}(e,t,n):"mdxFlowExpression"===t.type||"mdxTextExpression"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater){const n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}qP(e,t.position)}(e,t):"mdxJsxFlowElement"===t.type||"mdxJsxTextElement"===t.type?function(e,t,n){const r=e.schema;let i=r;"svg"===t.name&&"html"===r.space&&(i=eP,e.schema=i);e.ancestors.push(t);const a=null===t.name?e.Fragment:XP(e,t.name,!0),o=function(e,t){const n={};for(const r of t.attributes)if("mdxJsxExpressionAttribute"===r.type)if(r.data&&r.data.estree&&e.evaluater){const t=r.data.estree.body[0];pk(t.type);const i=t.expression;pk(i.type);const a=i.properties[0];pk(a.type),Object.assign(n,e.evaluater.evaluateExpression(a.argument))}else qP(e,t.position);else{const i=r.name;let a;if(r.value&&"object"==typeof r.value)if(r.value.data&&r.value.data.estree&&e.evaluater){const t=r.value.data.estree.body[0];pk(t.type),a=e.evaluater.evaluateExpression(t.expression)}else qP(e,t.position);else a=null===r.value||r.value;n[i]=a}return n}(e,t),s=WP(e,t);return VP(e,o,a,t),GP(o,s),e.ancestors.pop(),e.schema=r,e.create(t,a,o,n)}(e,t,n):"mdxjsEsm"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);qP(e,t.position)}(e,t):"root"===t.type?function(e,t,n){const r={};return GP(r,WP(e,t)),e.create(t,e.Fragment,r,n)}(e,t,n):"text"===t.type?function(e,t){return t.value}(0,t):void 0}function VP(e,t,n,r){"string"!=typeof n&&n!==e.Fragment&&e.passNode&&(t.node=r)}function GP(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function WP(e,t){const n=[];let r=-1;const i=e.passKeys?new Map:DP;for(;++r<t.children.length;){const a=t.children[r];let o;if(e.passKeys){const e="element"===a.type?a.tagName:"mdxJsxFlowElement"===a.type||"mdxJsxTextElement"===a.type?a.name:void 0;if(e){const t=i.get(e)||0;o=e+"-"+t,i.set(e,t+1)}}const s=HP(e,a,o);void 0!==s&&n.push(s)}return n}function $P(e,t,n){const r=function(e,t){const n=Sk(t);let r=t,i=Mk;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&"data"===n.slice(0,4)&&Yk.test(t)){if("-"===t.charAt(4)){const e=t.slice(5).replace(Kk,Jk);r="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{const e=t.slice(4);if(!Kk.test(e)){let n=e.replace(qk,Zk);"-"!==n.charAt(0)&&(n="-"+n),t="data"+n}}i=Dk}return new i(r,t)}(e.schema,t);if(!(null==n||"number"==typeof n&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?function(e){const t={};return(""===e[e.length-1]?[...e,""]:e).join((t.padRight?" ":"")+","+(!1===t.padLeft?"":" ")).trim()}(n):n.join(" ").trim()),"style"===r.property){let t="object"==typeof n?n:function(e,t){try{return CP(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const t=n,r=new IP("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:t,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw r.file=e.filePath||void 0,r.url=zP+"#cannot-parse-style-attribute",r}}(e,String(n));return"css"===e.stylePropertyNameCase&&(t=function(e){const t={};let n;for(n in e)jP.call(e,n)&&(t[KP(n)]=e[n]);return t}(t)),["style",t]}return["react"===e.elementAttributeNameCase&&r.space?Xk[r.property]||r.property:r.attribute,n]}}function XP(e,t,n){let r;if(n)if(t.includes(".")){const e=t.split(".");let n,i=-1;for(;++i<e.length;){const t=yk(e[i])?{type:"Identifier",name:e[i]}:{type:"Literal",value:e[i]};n=n?{type:"MemberExpression",object:n,property:t,computed:Boolean(i&&"Literal"===t.type),optional:!1}:t}r=n}else r=yk(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};else r={type:"Literal",value:t};if("Literal"===r.type){const t=r.value;return jP.call(e.components,t)?e.components[t]:t}if(e.evaluater)return e.evaluater.evaluateExpression(r);qP(e)}function qP(e,t){const n=new IP("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=zP+"#cannot-handle-mdx-estrees-without-createevaluater",n}function KP(e){let t=e.replace(OP,YP);return"ms-"===t.slice(0,3)&&(t="-"+t),t}function YP(e){return"-"+e.toLowerCase()}const ZP={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},JP={};function QP(e,t,n){if(function(e){return Boolean(e&&"object"==typeof e)}(e)){if("value"in e)return"html"!==e.type||n?e.value:"";if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return eA(e.children,t,n)}return Array.isArray(e)?eA(e,t,n):""}function eA(e,t,n){const r=[];let i=-1;for(;++i<e.length;)r[i]=QP(e[i],t,n);return r.join("")}const tA=document.createElement("i");function nA(e){const t="&"+e+";";tA.innerHTML=t;const n=tA.textContent;return(59!==n.charCodeAt(n.length-1)||"semi"===e)&&(n!==t&&n)}function rA(e,t,n,r){const i=e.length;let a,o=0;if(t=t<0?-t>i?0:i+t:t>i?i:t,n=n>0?n:0,r.length<1e4)a=Array.from(r),a.unshift(t,n),e.splice(...a);else for(n&&e.splice(t,n);o<r.length;)a=r.slice(o,o+1e4),a.unshift(t,0),e.splice(...a),o+=1e4,t+=1e4}function iA(e,t){return e.length>0?(rA(e,e.length,0,t),e):t}const aA={}.hasOwnProperty;function oA(e,t){let n;for(n in t){const r=(aA.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n];let a;if(i)for(a in i){aA.call(r,a)||(r[a]=[]);const e=i[a];sA(r[a],Array.isArray(e)?e:e?[e]:[])}}}function sA(e,t){let n=-1;const r=[];for(;++n<t.length;)("after"===t[n].add?e:r).push(t[n]);rA(e,0,0,r)}function lA(e,t){const n=Number.parseInt(e,t);return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||!(65535&~n)||65534==(65535&n)||n>1114111?"":String.fromCodePoint(n)}function cA(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const uA=wA(/[A-Za-z]/),dA=wA(/[\dA-Za-z]/),hA=wA(/[#-'*+\--9=?A-Z^-~]/);function pA(e){return null!==e&&(e<32||127===e)}const mA=wA(/\d/),fA=wA(/[\dA-Fa-f]/),gA=wA(/[!-/:-@[-`{-~]/);function vA(e){return null!==e&&e<-2}function yA(e){return null!==e&&(e<0||32===e)}function _A(e){return-2===e||-1===e||32===e}const xA=wA(new RegExp("\\p{P}|\\p{S}","u")),bA=wA(/\s/);function wA(e){return function(t){return null!==t&&t>-1&&e.test(String.fromCharCode(t))}}function SA(e){const t=[];let n=-1,r=0,i=0;for(;++n<e.length;){const a=e.charCodeAt(n);let o="";if(37===a&&dA(e.charCodeAt(n+1))&&dA(e.charCodeAt(n+2)))i=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(o=String.fromCharCode(a));else if(a>55295&&a<57344){const t=e.charCodeAt(n+1);a<56320&&t>56319&&t<57344?(o=String.fromCharCode(a,t),i=1):o=""}else o=String.fromCharCode(a);o&&(t.push(e.slice(r,n),encodeURIComponent(o)),r=n+i+1,o=""),i&&(n+=i,i=0)}return t.join("")+e.slice(r)}function MA(e,t,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let a=0;return function(r){if(_A(r))return e.enter(n),o(r);return t(r)};function o(r){return _A(r)&&a++<i?(e.consume(r),o):(e.exit(n),t(r))}}const EA={tokenize:function(e){const t=e.attempt(this.parser.constructs.contentInitial,function(n){if(null===n)return void e.consume(n);return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),MA(e,t,"linePrefix")},function(t){return e.enter("paragraph"),r(t)});let n;return t;function r(t){const r=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=r),n=r,i(t)}function i(t){return null===t?(e.exit("chunkText"),e.exit("paragraph"),void e.consume(t)):vA(t)?(e.consume(t),e.exit("chunkText"),r):(e.consume(t),i)}}};const CA={tokenize:function(e){const t=this,n=[];let r,i,a,o=0;return s;function s(r){if(o<n.length){const i=n[o];return t.containerState=i[1],e.attempt(i[0].continuation,l,c)(r)}return c(r)}function l(e){if(o++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,r&&y();const n=t.events.length;let i,a=n;for(;a--;)if("exit"===t.events[a][0]&&"chunkFlow"===t.events[a][1].type){i=t.events[a][1].end;break}v(o);let s=n;for(;s<t.events.length;)t.events[s][1].end={...i},s++;return rA(t.events,a+1,0,t.events.slice(n)),t.events.length=s,c(e)}return s(e)}function c(i){if(o===n.length){if(!r)return h(i);if(r.currentConstruct&&r.currentConstruct.concrete)return m(i);t.interrupt=Boolean(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(TA,u,d)(i)}function u(e){return r&&y(),v(o),h(e)}function d(e){return t.parser.lazy[t.now().line]=o!==n.length,a=t.now().offset,m(e)}function h(n){return t.containerState={},e.attempt(TA,p,m)(n)}function p(e){return o++,n.push([t.currentConstruct,t.containerState]),h(e)}function m(n){return null===n?(r&&y(),v(0),void e.consume(n)):(r=r||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:i}),f(n))}function f(n){return null===n?(g(e.exit("chunkFlow"),!0),v(0),void e.consume(n)):vA(n)?(e.consume(n),g(e.exit("chunkFlow")),o=0,t.interrupt=void 0,s):(e.consume(n),f)}function g(e,n){const s=t.sliceStream(e);if(n&&s.push(null),e.previous=i,i&&(i.next=e),i=e,r.defineSkip(e.start),r.write(s),t.parser.lazy[e.start.line]){let e=r.events.length;for(;e--;)if(r.events[e][1].start.offset<a&&(!r.events[e][1].end||r.events[e][1].end.offset>a))return;const n=t.events.length;let i,s,l=n;for(;l--;)if("exit"===t.events[l][0]&&"chunkFlow"===t.events[l][1].type){if(i){s=t.events[l][1].end;break}i=!0}for(v(o),e=n;e<t.events.length;)t.events[e][1].end={...s},e++;rA(t.events,l+1,0,t.events.slice(n)),t.events.length=e}}function v(r){let i=n.length;for(;i-- >r;){const r=n[i];t.containerState=r[1],r[0].exit.call(t,e)}n.length=r}function y(){r.write([null]),i=void 0,r=void 0,t.containerState._closeFlow=void 0}}},TA={tokenize:function(e,t,n){return MA(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}};function kA(e){return null===e||yA(e)||bA(e)?1:xA(e)?2:void 0}function PA(e,t,n){const r=[];let i=-1;for(;++i<e.length;){const a=e[i].resolveAll;a&&!r.includes(a)&&(t=a(t,n),r.push(a))}return t}const AA={name:"attention",resolveAll:function(e,t){let n,r,i,a,o,s,l,c,u=-1;for(;++u<e.length;)if("enter"===e[u][0]&&"attentionSequence"===e[u][1].type&&e[u][1]._close)for(n=u;n--;)if("exit"===e[n][0]&&"attentionSequence"===e[n][1].type&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[u][1]).charCodeAt(0)){if((e[n][1]._close||e[u][1]._open)&&(e[u][1].end.offset-e[u][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[u][1].end.offset-e[u][1].start.offset)%3))continue;s=e[n][1].end.offset-e[n][1].start.offset>1&&e[u][1].end.offset-e[u][1].start.offset>1?2:1;const d={...e[n][1].end},h={...e[u][1].start};NA(d,-s),NA(h,s),a={type:s>1?"strongSequence":"emphasisSequence",start:d,end:{...e[n][1].end}},o={type:s>1?"strongSequence":"emphasisSequence",start:{...e[u][1].start},end:h},i={type:s>1?"strongText":"emphasisText",start:{...e[n][1].end},end:{...e[u][1].start}},r={type:s>1?"strong":"emphasis",start:{...a.start},end:{...o.end}},e[n][1].end={...a.start},e[u][1].start={...o.end},l=[],e[n][1].end.offset-e[n][1].start.offset&&(l=iA(l,[["enter",e[n][1],t],["exit",e[n][1],t]])),l=iA(l,[["enter",r,t],["enter",a,t],["exit",a,t],["enter",i,t]]),l=iA(l,PA(t.parser.constructs.insideSpan.null,e.slice(n+1,u),t)),l=iA(l,[["exit",i,t],["enter",o,t],["exit",o,t],["exit",r,t]]),e[u][1].end.offset-e[u][1].start.offset?(c=2,l=iA(l,[["enter",e[u][1],t],["exit",e[u][1],t]])):c=0,rA(e,n-1,u-n+3,l),u=n+l.length-c-2;break}u=-1;for(;++u<e.length;)"attentionSequence"===e[u][1].type&&(e[u][1].type="data");return e},tokenize:function(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=kA(r);let a;return function(t){return a=t,e.enter("attentionSequence"),o(t)};function o(s){if(s===a)return e.consume(s),o;const l=e.exit("attentionSequence"),c=kA(s),u=!c||2===c&&i||n.includes(s),d=!i||2===i&&c||n.includes(r);return l._open=Boolean(42===a?u:u&&(i||!d)),l._close=Boolean(42===a?d:d&&(c||!u)),t(s)}}};function NA(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const RA={name:"autolink",tokenize:function(e,t,n){let r=0;return function(t){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(t),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i};function i(t){return uA(t)?(e.consume(t),a):64===t?n(t):l(t)}function a(e){return 43===e||45===e||46===e||dA(e)?(r=1,o(e)):l(e)}function o(t){return 58===t?(e.consume(t),r=0,s):(43===t||45===t||46===t||dA(t))&&r++<32?(e.consume(t),o):(r=0,l(t))}function s(r){return 62===r?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(r),e.exit("autolinkMarker"),e.exit("autolink"),t):null===r||32===r||60===r||pA(r)?n(r):(e.consume(r),s)}function l(t){return 64===t?(e.consume(t),c):hA(t)?(e.consume(t),l):n(t)}function c(e){return dA(e)?u(e):n(e)}function u(n){return 46===n?(e.consume(n),r=0,c):62===n?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(n),e.exit("autolinkMarker"),e.exit("autolink"),t):d(n)}function d(t){if((45===t||dA(t))&&r++<63){const n=45===t?d:u;return e.consume(t),n}return n(t)}}};const LA={partial:!0,tokenize:function(e,t,n){return function(t){return _A(t)?MA(e,r,"linePrefix")(t):r(t)};function r(e){return null===e||vA(e)?t(e):n(e)}}};const IA={continuation:{tokenize:function(e,t,n){const r=this;return function(t){if(_A(t))return MA(e,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t);return i(t)};function i(r){return e.attempt(IA,t,n)(r)}}},exit:function(e){e.exit("blockQuote")},name:"blockQuote",tokenize:function(e,t,n){const r=this;return function(t){if(62===t){const n=r.containerState;return n.open||(e.enter("blockQuote",{_container:!0}),n.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(t),e.exit("blockQuoteMarker"),i}return n(t)};function i(n){return _A(n)?(e.enter("blockQuotePrefixWhitespace"),e.consume(n),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(n))}}};const jA={name:"characterEscape",tokenize:function(e,t,n){return function(t){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(t),e.exit("escapeMarker"),r};function r(r){return gA(r)?(e.enter("characterEscapeValue"),e.consume(r),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(r)}}};const DA={name:"characterReference",tokenize:function(e,t,n){const r=this;let i,a,o=0;return function(t){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(t),e.exit("characterReferenceMarker"),s};function s(t){return 35===t?(e.enter("characterReferenceMarkerNumeric"),e.consume(t),e.exit("characterReferenceMarkerNumeric"),l):(e.enter("characterReferenceValue"),i=31,a=dA,c(t))}function l(t){return 88===t||120===t?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(t),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,a=fA,c):(e.enter("characterReferenceValue"),i=7,a=mA,c(t))}function c(s){if(59===s&&o){const i=e.exit("characterReferenceValue");return a!==dA||nA(r.sliceSerialize(i))?(e.enter("characterReferenceMarker"),e.consume(s),e.exit("characterReferenceMarker"),e.exit("characterReference"),t):n(s)}return a(s)&&o++<i?(e.consume(s),c):n(s)}}};const OA={partial:!0,tokenize:function(e,t,n){const r=this;return function(t){if(null===t)return n(t);return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i};function i(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}},UA={concrete:!0,name:"codeFenced",tokenize:function(e,t,n){const r=this,i={partial:!0,tokenize:function(e,t,n){let i=0;return o;function o(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),l}function l(t){return e.enter("codeFencedFence"),_A(t)?MA(e,c,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):c(t)}function c(t){return t===a?(e.enter("codeFencedFenceSequence"),u(t)):n(t)}function u(t){return t===a?(i++,e.consume(t),u):i>=s?(e.exit("codeFencedFenceSequence"),_A(t)?MA(e,d,"whitespace")(t):d(t)):n(t)}function d(r){return null===r||vA(r)?(e.exit("codeFencedFence"),t(r)):n(r)}}};let a,o=0,s=0;return function(t){return function(t){const n=r.events[r.events.length-1];return o=n&&"linePrefix"===n[1].type?n[2].sliceSerialize(n[1],!0).length:0,a=t,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),l(t)}(t)};function l(t){return t===a?(s++,e.consume(t),l):s<3?n(t):(e.exit("codeFencedFenceSequence"),_A(t)?MA(e,c,"whitespace")(t):c(t))}function c(n){return null===n||vA(n)?(e.exit("codeFencedFence"),r.interrupt?t(n):e.check(OA,p,y)(n)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),u(n))}function u(t){return null===t||vA(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),c(t)):_A(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),MA(e,d,"whitespace")(t)):96===t&&t===a?n(t):(e.consume(t),u)}function d(t){return null===t||vA(t)?c(t):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),h(t))}function h(t){return null===t||vA(t)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),c(t)):96===t&&t===a?n(t):(e.consume(t),h)}function p(t){return e.attempt(i,y,m)(t)}function m(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),f}function f(t){return o>0&&_A(t)?MA(e,g,"linePrefix",o+1)(t):g(t)}function g(t){return null===t||vA(t)?e.check(OA,p,y)(t):(e.enter("codeFlowValue"),v(t))}function v(t){return null===t||vA(t)?(e.exit("codeFlowValue"),g(t)):(e.consume(t),v)}function y(n){return e.exit("codeFenced"),t(n)}}};const FA={name:"codeIndented",tokenize:function(e,t,n){const r=this;return function(t){return e.enter("codeIndented"),MA(e,i,"linePrefix",5)(t)};function i(e){const t=r.events[r.events.length-1];return t&&"linePrefix"===t[1].type&&t[2].sliceSerialize(t[1],!0).length>=4?a(e):n(e)}function a(t){return null===t?s(t):vA(t)?e.attempt(zA,a,s)(t):(e.enter("codeFlowValue"),o(t))}function o(t){return null===t||vA(t)?(e.exit("codeFlowValue"),a(t)):(e.consume(t),o)}function s(n){return e.exit("codeIndented"),t(n)}}},zA={partial:!0,tokenize:function(e,t,n){const r=this;return i;function i(t){return r.parser.lazy[r.now().line]?n(t):vA(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i):MA(e,a,"linePrefix",5)(t)}function a(e){const a=r.events[r.events.length-1];return a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(e):vA(e)?i(e):n(e)}}};const BA={name:"codeText",previous:function(e){return 96!==e||"characterEscape"===this.events[this.events.length-1][1].type},resolve:function(e){let t,n,r=e.length-4,i=3;if(!("lineEnding"!==e[i][1].type&&"space"!==e[i][1].type||"lineEnding"!==e[r][1].type&&"space"!==e[r][1].type))for(t=i;++t<r;)if("codeTextData"===e[t][1].type){e[i][1].type="codeTextPadding",e[r][1].type="codeTextPadding",i+=2,r-=2;break}t=i-1,r++;for(;++t<=r;)void 0===n?t!==r&&"lineEnding"!==e[t][1].type&&(n=t):t!==r&&"lineEnding"!==e[t][1].type||(e[n][1].type="codeTextData",t!==n+2&&(e[n][1].end=e[t-1][1].end,e.splice(n+2,t-n-2),r-=t-n-2,t=n+2),n=void 0);return e},tokenize:function(e,t,n){let r,i,a=0;return function(t){return e.enter("codeText"),e.enter("codeTextSequence"),o(t)};function o(t){return 96===t?(e.consume(t),a++,o):(e.exit("codeTextSequence"),s(t))}function s(t){return null===t?n(t):32===t?(e.enter("space"),e.consume(t),e.exit("space"),s):96===t?(i=e.enter("codeTextSequence"),r=0,c(t)):vA(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),s):(e.enter("codeTextData"),l(t))}function l(t){return null===t||32===t||96===t||vA(t)?(e.exit("codeTextData"),s(t)):(e.consume(t),l)}function c(n){return 96===n?(e.consume(n),r++,c):r===a?(e.exit("codeTextSequence"),e.exit("codeText"),t(n)):(i.type="codeTextData",l(n))}}};class HA{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const n=null==t?Number.POSITIVE_INFINITY:t;return n<this.left.length?this.left.slice(e,n):e>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(e,t,n){const r=t||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return n&&VA(this.left,n),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),VA(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),VA(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&0===this.right.length||e<0&&0===this.left.length))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);VA(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);VA(this.left,t.reverse())}}}function VA(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function GA(e){const t={};let n,r,i,a,o,s,l,c=-1;const u=new HA(e);for(;++c<u.length;){for(;c in t;)c=t[c];if(n=u.get(c),c&&"chunkFlow"===n[1].type&&"listItemPrefix"===u.get(c-1)[1].type&&(s=n[1]._tokenizer.events,i=0,i<s.length&&"lineEndingBlank"===s[i][1].type&&(i+=2),i<s.length&&"content"===s[i][1].type))for(;++i<s.length&&"content"!==s[i][1].type;)"chunkText"===s[i][1].type&&(s[i][1]._isInFirstContentOfListItem=!0,i++);if("enter"===n[0])n[1].contentType&&(Object.assign(t,WA(u,c)),c=t[c],l=!0);else if(n[1]._container){for(i=c,r=void 0;i--;)if(a=u.get(i),"lineEnding"===a[1].type||"lineEndingBlank"===a[1].type)"enter"===a[0]&&(r&&(u.get(r)[1].type="lineEndingBlank"),a[1].type="lineEnding",r=i);else if("linePrefix"!==a[1].type&&"listItemIndent"!==a[1].type)break;r&&(n[1].end={...u.get(r)[1].start},o=u.slice(r,c),o.unshift(n),u.splice(r,c-r+1,o))}}return rA(e,0,Number.POSITIVE_INFINITY,u.slice(0)),!l}function WA(e,t){const n=e.get(t)[1],r=e.get(t)[2];let i=t-1;const a=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const s=o.events,l=[],c={};let u,d,h=-1,p=n,m=0,f=0;const g=[f];for(;p;){for(;e.get(++i)[1]!==p;);a.push(i),p._tokenizer||(u=r.sliceStream(p),p.next||u.push(null),d&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=n;++h<s.length;)"exit"===s[h][0]&&"enter"===s[h-1][0]&&s[h][1].type===s[h-1][1].type&&s[h][1].start.line!==s[h][1].end.line&&(f=h+1,g.push(f),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),h=g.length;h--;){const t=s.slice(g[h],g[h+1]),n=a.pop();l.push([n,n+t.length-1]),e.splice(n,2,t)}for(l.reverse(),h=-1;++h<l.length;)c[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return c}const $A={resolve:function(e){return GA(e),e},tokenize:function(e,t){let n;return function(t){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),r(t)};function r(t){return null===t?i(t):vA(t)?e.check(XA,a,i)(t):(e.consume(t),r)}function i(n){return e.exit("chunkContent"),e.exit("content"),t(n)}function a(t){return e.consume(t),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}},XA={partial:!0,tokenize:function(e,t,n){const r=this;return function(t){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),MA(e,i,"linePrefix")};function i(i){if(null===i||vA(i))return n(i);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(i):e.interrupt(r.parser.constructs.flow,n,t)(i)}}};function qA(e,t,n,r,i,a,o,s,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return function(t){if(60===t)return e.enter(r),e.enter(i),e.enter(a),e.consume(t),e.exit(a),d;if(null===t||32===t||41===t||pA(t))return n(t);return e.enter(r),e.enter(o),e.enter(s),e.enter("chunkString",{contentType:"string"}),m(t)};function d(n){return 62===n?(e.enter(a),e.consume(n),e.exit(a),e.exit(i),e.exit(r),t):(e.enter(s),e.enter("chunkString",{contentType:"string"}),h(n))}function h(t){return 62===t?(e.exit("chunkString"),e.exit(s),d(t)):null===t||60===t||vA(t)?n(t):(e.consume(t),92===t?p:h)}function p(t){return 60===t||62===t||92===t?(e.consume(t),h):h(t)}function m(i){return u||null!==i&&41!==i&&!yA(i)?u<c&&40===i?(e.consume(i),u++,m):41===i?(e.consume(i),u--,m):null===i||32===i||40===i||pA(i)?n(i):(e.consume(i),92===i?f:m):(e.exit("chunkString"),e.exit(s),e.exit(o),e.exit(r),t(i))}function f(t){return 40===t||41===t||92===t?(e.consume(t),m):m(t)}}function KA(e,t,n,r,i,a){const o=this;let s,l=0;return function(t){return e.enter(r),e.enter(i),e.consume(t),e.exit(i),e.enter(a),c};function c(d){return l>999||null===d||91===d||93===d&&!s||94===d&&!l&&"_hiddenFootnoteSupport"in o.parser.constructs?n(d):93===d?(e.exit(a),e.enter(i),e.consume(d),e.exit(i),e.exit(r),t):vA(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),u(d))}function u(t){return null===t||91===t||93===t||vA(t)||l++>999?(e.exit("chunkString"),c(t)):(e.consume(t),s||(s=!_A(t)),92===t?d:u)}function d(t){return 91===t||92===t||93===t?(e.consume(t),l++,u):u(t)}}function YA(e,t,n,r,i,a){let o;return function(t){if(34===t||39===t||40===t)return e.enter(r),e.enter(i),e.consume(t),e.exit(i),o=40===t?41:t,s;return n(t)};function s(n){return n===o?(e.enter(i),e.consume(n),e.exit(i),e.exit(r),t):(e.enter(a),l(n))}function l(t){return t===o?(e.exit(a),s(o)):null===t?n(t):vA(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),MA(e,l,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(t))}function c(t){return t===o||null===t||vA(t)?(e.exit("chunkString"),l(t)):(e.consume(t),92===t?u:c)}function u(t){return t===o||92===t?(e.consume(t),c):c(t)}}function ZA(e,t){let n;return function r(i){if(vA(i))return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),n=!0,r;if(_A(i))return MA(e,r,n?"linePrefix":"lineSuffix")(i);return t(i)}}const JA={name:"definition",tokenize:function(e,t,n){const r=this;let i;return function(t){return e.enter("definition"),function(t){return KA.call(r,e,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(t)}(t)};function a(t){return i=cA(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),o):n(t)}function o(t){return yA(t)?ZA(e,s)(t):s(t)}function s(t){return qA(e,l,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(t)}function l(t){return e.attempt(QA,c,c)(t)}function c(t){return _A(t)?MA(e,u,"whitespace")(t):u(t)}function u(a){return null===a||vA(a)?(e.exit("definition"),r.parser.defined.push(i),t(a)):n(a)}}},QA={partial:!0,tokenize:function(e,t,n){return function(t){return yA(t)?ZA(e,r)(t):n(t)};function r(t){return YA(e,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(t)}function i(t){return _A(t)?MA(e,a,"whitespace")(t):a(t)}function a(e){return null===e||vA(e)?t(e):n(e)}}};const eN={name:"hardBreakEscape",tokenize:function(e,t,n){return function(t){return e.enter("hardBreakEscape"),e.consume(t),r};function r(r){return vA(r)?(e.exit("hardBreakEscape"),t(r)):n(r)}}};const tN={name:"headingAtx",resolve:function(e,t){let n,r,i=e.length-2,a=3;"whitespace"===e[a][1].type&&(a+=2);i-2>a&&"whitespace"===e[i][1].type&&(i-=2);"atxHeadingSequence"===e[i][1].type&&(a===i-1||i-4>a&&"whitespace"===e[i-2][1].type)&&(i-=a+1===i?2:4);i>a&&(n={type:"atxHeadingText",start:e[a][1].start,end:e[i][1].end},r={type:"chunkText",start:e[a][1].start,end:e[i][1].end,contentType:"text"},rA(e,a,i-a+1,[["enter",n,t],["enter",r,t],["exit",r,t],["exit",n,t]]));return e},tokenize:function(e,t,n){let r=0;return function(t){return e.enter("atxHeading"),function(t){return e.enter("atxHeadingSequence"),i(t)}(t)};function i(t){return 35===t&&r++<6?(e.consume(t),i):null===t||yA(t)?(e.exit("atxHeadingSequence"),a(t)):n(t)}function a(n){return 35===n?(e.enter("atxHeadingSequence"),o(n)):null===n||vA(n)?(e.exit("atxHeading"),t(n)):_A(n)?MA(e,a,"whitespace")(n):(e.enter("atxHeadingText"),s(n))}function o(t){return 35===t?(e.consume(t),o):(e.exit("atxHeadingSequence"),a(t))}function s(t){return null===t||35===t||yA(t)?(e.exit("atxHeadingText"),a(t)):(e.consume(t),s)}}};const nN=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],rN=["pre","script","style","textarea"],iN={concrete:!0,name:"htmlFlow",resolveTo:function(e){let t=e.length;for(;t--&&("enter"!==e[t][0]||"htmlFlow"!==e[t][1].type););t>1&&"linePrefix"===e[t-2][1].type&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2));return e},tokenize:function(e,t,n){const r=this;let i,a,o,s,l;return function(t){return function(t){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(t),c}(t)};function c(s){return 33===s?(e.consume(s),u):47===s?(e.consume(s),a=!0,p):63===s?(e.consume(s),i=3,r.interrupt?t:I):uA(s)?(e.consume(s),o=String.fromCharCode(s),m):n(s)}function u(a){return 45===a?(e.consume(a),i=2,d):91===a?(e.consume(a),i=5,s=0,h):uA(a)?(e.consume(a),i=4,r.interrupt?t:I):n(a)}function d(i){return 45===i?(e.consume(i),r.interrupt?t:I):n(i)}function h(i){const a="CDATA[";return i===a.charCodeAt(s++)?(e.consume(i),6===s?r.interrupt?t:C:h):n(i)}function p(t){return uA(t)?(e.consume(t),o=String.fromCharCode(t),m):n(t)}function m(s){if(null===s||47===s||62===s||yA(s)){const l=47===s,c=o.toLowerCase();return l||a||!rN.includes(c)?nN.includes(o.toLowerCase())?(i=6,l?(e.consume(s),f):r.interrupt?t(s):C(s)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(s):a?g(s):v(s)):(i=1,r.interrupt?t(s):C(s))}return 45===s||dA(s)?(e.consume(s),o+=String.fromCharCode(s),m):n(s)}function f(i){return 62===i?(e.consume(i),r.interrupt?t:C):n(i)}function g(t){return _A(t)?(e.consume(t),g):M(t)}function v(t){return 47===t?(e.consume(t),M):58===t||95===t||uA(t)?(e.consume(t),y):_A(t)?(e.consume(t),v):M(t)}function y(t){return 45===t||46===t||58===t||95===t||dA(t)?(e.consume(t),y):_(t)}function _(t){return 61===t?(e.consume(t),x):_A(t)?(e.consume(t),_):v(t)}function x(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),l=t,b):_A(t)?(e.consume(t),x):w(t)}function b(t){return t===l?(e.consume(t),l=null,S):null===t||vA(t)?n(t):(e.consume(t),b)}function w(t){return null===t||34===t||39===t||47===t||60===t||61===t||62===t||96===t||yA(t)?_(t):(e.consume(t),w)}function S(e){return 47===e||62===e||_A(e)?v(e):n(e)}function M(t){return 62===t?(e.consume(t),E):n(t)}function E(t){return null===t||vA(t)?C(t):_A(t)?(e.consume(t),E):n(t)}function C(t){return 45===t&&2===i?(e.consume(t),A):60===t&&1===i?(e.consume(t),N):62===t&&4===i?(e.consume(t),j):63===t&&3===i?(e.consume(t),I):93===t&&5===i?(e.consume(t),L):!vA(t)||6!==i&&7!==i?null===t||vA(t)?(e.exit("htmlFlowData"),T(t)):(e.consume(t),C):(e.exit("htmlFlowData"),e.check(aN,D,T)(t))}function T(t){return e.check(oN,k,D)(t)}function k(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),P}function P(t){return null===t||vA(t)?T(t):(e.enter("htmlFlowData"),C(t))}function A(t){return 45===t?(e.consume(t),I):C(t)}function N(t){return 47===t?(e.consume(t),o="",R):C(t)}function R(t){if(62===t){const n=o.toLowerCase();return rN.includes(n)?(e.consume(t),j):C(t)}return uA(t)&&o.length<8?(e.consume(t),o+=String.fromCharCode(t),R):C(t)}function L(t){return 93===t?(e.consume(t),I):C(t)}function I(t){return 62===t?(e.consume(t),j):45===t&&2===i?(e.consume(t),I):C(t)}function j(t){return null===t||vA(t)?(e.exit("htmlFlowData"),D(t)):(e.consume(t),j)}function D(n){return e.exit("htmlFlow"),t(n)}}},aN={partial:!0,tokenize:function(e,t,n){return function(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),e.attempt(LA,t,n)}}},oN={partial:!0,tokenize:function(e,t,n){const r=this;return function(t){if(vA(t))return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i;return n(t)};function i(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}};const sN={name:"htmlText",tokenize:function(e,t,n){const r=this;let i,a,o;return function(t){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(t),s};function s(t){return 33===t?(e.consume(t),l):47===t?(e.consume(t),x):63===t?(e.consume(t),y):uA(t)?(e.consume(t),S):n(t)}function l(t){return 45===t?(e.consume(t),c):91===t?(e.consume(t),a=0,p):uA(t)?(e.consume(t),v):n(t)}function c(t){return 45===t?(e.consume(t),h):n(t)}function u(t){return null===t?n(t):45===t?(e.consume(t),d):vA(t)?(o=u,R(t)):(e.consume(t),u)}function d(t){return 45===t?(e.consume(t),h):u(t)}function h(e){return 62===e?N(e):45===e?d(e):u(e)}function p(t){const r="CDATA[";return t===r.charCodeAt(a++)?(e.consume(t),6===a?m:p):n(t)}function m(t){return null===t?n(t):93===t?(e.consume(t),f):vA(t)?(o=m,R(t)):(e.consume(t),m)}function f(t){return 93===t?(e.consume(t),g):m(t)}function g(t){return 62===t?N(t):93===t?(e.consume(t),g):m(t)}function v(t){return null===t||62===t?N(t):vA(t)?(o=v,R(t)):(e.consume(t),v)}function y(t){return null===t?n(t):63===t?(e.consume(t),_):vA(t)?(o=y,R(t)):(e.consume(t),y)}function _(e){return 62===e?N(e):y(e)}function x(t){return uA(t)?(e.consume(t),b):n(t)}function b(t){return 45===t||dA(t)?(e.consume(t),b):w(t)}function w(t){return vA(t)?(o=w,R(t)):_A(t)?(e.consume(t),w):N(t)}function S(t){return 45===t||dA(t)?(e.consume(t),S):47===t||62===t||yA(t)?M(t):n(t)}function M(t){return 47===t?(e.consume(t),N):58===t||95===t||uA(t)?(e.consume(t),E):vA(t)?(o=M,R(t)):_A(t)?(e.consume(t),M):N(t)}function E(t){return 45===t||46===t||58===t||95===t||dA(t)?(e.consume(t),E):C(t)}function C(t){return 61===t?(e.consume(t),T):vA(t)?(o=C,R(t)):_A(t)?(e.consume(t),C):M(t)}function T(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),i=t,k):vA(t)?(o=T,R(t)):_A(t)?(e.consume(t),T):(e.consume(t),P)}function k(t){return t===i?(e.consume(t),i=void 0,A):null===t?n(t):vA(t)?(o=k,R(t)):(e.consume(t),k)}function P(t){return null===t||34===t||39===t||60===t||61===t||96===t?n(t):47===t||62===t||yA(t)?M(t):(e.consume(t),P)}function A(e){return 47===e||62===e||yA(e)?M(e):n(e)}function N(r){return 62===r?(e.consume(r),e.exit("htmlTextData"),e.exit("htmlText"),t):n(r)}function R(t){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),L}function L(t){return _A(t)?MA(e,I,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):I(t)}function I(t){return e.enter("htmlTextData"),o(t)}}};const lN={name:"labelEnd",resolveAll:function(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),"labelImage"===r.type||"labelLink"===r.type||"labelEnd"===r.type){const e="labelImage"===r.type?4:2;r.type="data",t+=e}}e.length!==n.length&&rA(e,0,e.length,n);return e},resolveTo:function(e,t){let n,r,i,a,o=e.length,s=0;for(;o--;)if(n=e[o][1],r){if("link"===n.type||"labelLink"===n.type&&n._inactive)break;"enter"===e[o][0]&&"labelLink"===n.type&&(n._inactive=!0)}else if(i){if("enter"===e[o][0]&&("labelImage"===n.type||"labelLink"===n.type)&&!n._balanced&&(r=o,"labelLink"!==n.type)){s=2;break}}else"labelEnd"===n.type&&(i=o);const l={type:"labelLink"===e[r][1].type?"link":"image",start:{...e[r][1].start},end:{...e[e.length-1][1].end}},c={type:"label",start:{...e[r][1].start},end:{...e[i][1].end}},u={type:"labelText",start:{...e[r+s+2][1].end},end:{...e[i-2][1].start}};return a=[["enter",l,t],["enter",c,t]],a=iA(a,e.slice(r+1,r+s+3)),a=iA(a,[["enter",u,t]]),a=iA(a,PA(t.parser.constructs.insideSpan.null,e.slice(r+s+4,i-3),t)),a=iA(a,[["exit",u,t],e[i-2],e[i-1],["exit",c,t]]),a=iA(a,e.slice(i+1)),a=iA(a,[["exit",l,t]]),rA(e,r,e.length,a),e},tokenize:function(e,t,n){const r=this;let i,a,o=r.events.length;for(;o--;)if(("labelImage"===r.events[o][1].type||"labelLink"===r.events[o][1].type)&&!r.events[o][1]._balanced){i=r.events[o][1];break}return function(t){if(!i)return n(t);if(i._inactive)return u(t);return a=r.parser.defined.includes(cA(r.sliceSerialize({start:i.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelEnd"),s};function s(t){return 40===t?e.attempt(cN,c,a?c:u)(t):91===t?e.attempt(uN,c,a?l:u)(t):a?c(t):u(t)}function l(t){return e.attempt(dN,c,u)(t)}function c(e){return t(e)}function u(e){return i._balanced=!0,n(e)}}},cN={tokenize:function(e,t,n){return function(t){return e.enter("resource"),e.enter("resourceMarker"),e.consume(t),e.exit("resourceMarker"),r};function r(t){return yA(t)?ZA(e,i)(t):i(t)}function i(t){return 41===t?c(t):qA(e,a,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(t)}function a(t){return yA(t)?ZA(e,s)(t):c(t)}function o(e){return n(e)}function s(t){return 34===t||39===t||40===t?YA(e,l,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(t):c(t)}function l(t){return yA(t)?ZA(e,c)(t):c(t)}function c(r){return 41===r?(e.enter("resourceMarker"),e.consume(r),e.exit("resourceMarker"),e.exit("resource"),t):n(r)}}},uN={tokenize:function(e,t,n){const r=this;return function(t){return KA.call(r,e,i,a,"reference","referenceMarker","referenceString")(t)};function i(e){return r.parser.defined.includes(cA(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function a(e){return n(e)}}},dN={tokenize:function(e,t,n){return function(t){return e.enter("reference"),e.enter("referenceMarker"),e.consume(t),e.exit("referenceMarker"),r};function r(r){return 93===r?(e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),e.exit("reference"),t):n(r)}}};const hN={name:"labelStartImage",resolveAll:lN.resolveAll,tokenize:function(e,t,n){const r=this;return function(t){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(t),e.exit("labelImageMarker"),i};function i(t){return 91===t?(e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelImage"),a):n(t)}function a(e){return 94===e&&"_hiddenFootnoteSupport"in r.parser.constructs?n(e):t(e)}}};const pN={name:"labelStartLink",resolveAll:lN.resolveAll,tokenize:function(e,t,n){const r=this;return function(t){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelLink"),i};function i(e){return 94===e&&"_hiddenFootnoteSupport"in r.parser.constructs?n(e):t(e)}}};const mN={name:"lineEnding",tokenize:function(e,t){return function(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),MA(e,t,"linePrefix")}}};const fN={name:"thematicBreak",tokenize:function(e,t,n){let r,i=0;return function(t){return e.enter("thematicBreak"),function(e){return r=e,a(e)}(t)};function a(a){return a===r?(e.enter("thematicBreakSequence"),o(a)):i>=3&&(null===a||vA(a))?(e.exit("thematicBreak"),t(a)):n(a)}function o(t){return t===r?(e.consume(t),i++,o):(e.exit("thematicBreakSequence"),_A(t)?MA(e,a,"whitespace")(t):a(t))}}};const gN={continuation:{tokenize:function(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(LA,function(n){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,MA(e,t,"listItemIndent",r.containerState.size+1)(n)},function(n){if(r.containerState.furtherBlankLines||!_A(n))return r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,i(n);return r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(yN,t,i)(n)});function i(i){return r.containerState._closeFlow=!0,r.interrupt=void 0,MA(e,e.attempt(gN,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(i)}}},exit:function(e){e.exit(this.containerState.type)},name:"list",tokenize:function(e,t,n){const r=this,i=r.events[r.events.length-1];let a=i&&"linePrefix"===i[1].type?i[2].sliceSerialize(i[1],!0).length:0,o=0;return function(t){const i=r.containerState.type||(42===t||43===t||45===t?"listUnordered":"listOrdered");if("listUnordered"===i?!r.containerState.marker||t===r.containerState.marker:mA(t)){if(r.containerState.type||(r.containerState.type=i,e.enter(i,{_container:!0})),"listUnordered"===i)return e.enter("listItemPrefix"),42===t||45===t?e.check(fN,n,l)(t):l(t);if(!r.interrupt||49===t)return e.enter("listItemPrefix"),e.enter("listItemValue"),s(t)}return n(t)};function s(t){return mA(t)&&++o<10?(e.consume(t),s):(!r.interrupt||o<2)&&(r.containerState.marker?t===r.containerState.marker:41===t||46===t)?(e.exit("listItemValue"),l(t)):n(t)}function l(t){return e.enter("listItemMarker"),e.consume(t),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||t,e.check(LA,r.interrupt?n:c,e.attempt(vN,d,u))}function c(e){return r.containerState.initialBlankLine=!0,a++,d(e)}function u(t){return _A(t)?(e.enter("listItemPrefixWhitespace"),e.consume(t),e.exit("listItemPrefixWhitespace"),d):n(t)}function d(n){return r.containerState.size=a+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(n)}}},vN={partial:!0,tokenize:function(e,t,n){const r=this;return MA(e,function(e){const i=r.events[r.events.length-1];return!_A(e)&&i&&"listItemPrefixWhitespace"===i[1].type?t(e):n(e)},"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5)}},yN={partial:!0,tokenize:function(e,t,n){const r=this;return MA(e,function(e){const i=r.events[r.events.length-1];return i&&"listItemIndent"===i[1].type&&i[2].sliceSerialize(i[1],!0).length===r.containerState.size?t(e):n(e)},"listItemIndent",r.containerState.size+1)}};const _N={name:"setextUnderline",resolveTo:function(e,t){let n,r,i,a=e.length;for(;a--;)if("enter"===e[a][0]){if("content"===e[a][1].type){n=a;break}"paragraph"===e[a][1].type&&(r=a)}else"content"===e[a][1].type&&e.splice(a,1),i||"definition"!==e[a][1].type||(i=a);const o={type:"setextHeading",start:{...e[n][1].start},end:{...e[e.length-1][1].end}};e[r][1].type="setextHeadingText",i?(e.splice(r,0,["enter",o,t]),e.splice(i+1,0,["exit",e[n][1],t]),e[n][1].end={...e[i][1].end}):e[n][1]=o;return e.push(["exit",o,t]),e},tokenize:function(e,t,n){const r=this;let i;return function(t){let o,s=r.events.length;for(;s--;)if("lineEnding"!==r.events[s][1].type&&"linePrefix"!==r.events[s][1].type&&"content"!==r.events[s][1].type){o="paragraph"===r.events[s][1].type;break}if(!r.parser.lazy[r.now().line]&&(r.interrupt||o))return e.enter("setextHeadingLine"),i=t,function(t){return e.enter("setextHeadingLineSequence"),a(t)}(t);return n(t)};function a(t){return t===i?(e.consume(t),a):(e.exit("setextHeadingLineSequence"),_A(t)?MA(e,o,"lineSuffix")(t):o(t))}function o(r){return null===r||vA(r)?(e.exit("setextHeadingLine"),t(r)):n(r)}}};const xN={tokenize:function(e){const t=this,n=e.attempt(LA,function(r){if(null===r)return void e.consume(r);return e.enter("lineEndingBlank"),e.consume(r),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n},e.attempt(this.parser.constructs.flowInitial,r,MA(e,e.attempt(this.parser.constructs.flow,r,e.attempt($A,r)),"linePrefix")));return n;function r(r){if(null!==r)return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),t.currentConstruct=void 0,n;e.consume(r)}}};const bN={resolveAll:EN()},wN=MN("string"),SN=MN("text");function MN(e){return{resolveAll:EN("text"===e?CN:void 0),tokenize:function(t){const n=this,r=this.parser.constructs[e],i=t.attempt(r,a,o);return a;function a(e){return l(e)?i(e):o(e)}function o(e){if(null!==e)return t.enter("data"),t.consume(e),s;t.consume(e)}function s(e){return l(e)?(t.exit("data"),i(e)):(t.consume(e),s)}function l(e){if(null===e)return!0;const t=r[e];let i=-1;if(t)for(;++i<t.length;){const e=t[i];if(!e.previous||e.previous.call(n,n.previous))return!0}return!1}}}}function EN(e){return function(t,n){let r,i=-1;for(;++i<=t.length;)void 0===r?t[i]&&"data"===t[i][1].type&&(r=i,i++):t[i]&&"data"===t[i][1].type||(i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),i=r+2),r=void 0);return e?e(t,n):t}}function CN(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||"lineEnding"===e[n][1].type)&&"data"===e[n-1][1].type){const r=e[n-1][1],i=t.sliceStream(r);let a,o=i.length,s=-1,l=0;for(;o--;){const e=i[o];if("string"==typeof e){for(s=e.length;32===e.charCodeAt(s-1);)l++,s--;if(s)break;s=-1}else if(-2===e)a=!0,l++;else if(-1!==e){o++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(l=0),l){const i={type:n===e.length||a||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:o?s:r.start._bufferIndex+s,_index:r.start._index+o,line:r.end.line,column:r.end.column-l,offset:r.end.offset-l},end:{...r.end}};r.end={...i.start},r.start.offset===r.end.offset?Object.assign(r,i):(e.splice(n,0,["enter",i,t],["exit",i,t]),n+=2)}n++}return e}const TN={42:gN,43:gN,45:gN,48:gN,49:gN,50:gN,51:gN,52:gN,53:gN,54:gN,55:gN,56:gN,57:gN,62:IA},kN={91:JA},PN={[-2]:FA,[-1]:FA,32:FA},AN={35:tN,42:fN,45:[_N,fN],60:iN,61:_N,95:fN,96:UA,126:UA},NN={38:DA,92:jA},RN={[-5]:mN,[-4]:mN,[-3]:mN,33:hN,38:DA,42:AA,60:[RA,sN],91:pN,92:[eN,jA],93:lN,95:AA,96:BA},LN={null:[AA,bN]},IN=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:kN,disable:{null:[]},document:TN,flow:AN,flowInitial:PN,insideSpan:LN,string:NN,text:RN},Symbol.toStringTag,{value:"Module"}));function jN(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},a=[];let o=[],s=[];const l={attempt:g(function(e,t){v(e,t.from)}),check:g(f),consume:function(e){vA(e)?(r.line++,r.column=1,r.offset+=-3===e?2:1,y()):-1!==e&&(r.column++,r.offset++);r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++));c.previous=e},enter:function(e,t){const n=t||{};return n.type=e,n.start=h(),c.events.push(["enter",n,c]),s.push(n),n},exit:function(e){const t=s.pop();return t.end=h(),c.events.push(["exit",t,c]),t},interrupt:g(f,{interrupt:!0})},c={code:null,containerState:{},defineSkip:function(e){i[e.line]=e.column,y()},events:[],now:h,parser:e,previous:null,sliceSerialize:function(e,t){return function(e,t){let n=-1;const r=[];let i;for(;++n<e.length;){const a=e[n];let o;if("string"==typeof a)o=a;else switch(a){case-5:o="\r";break;case-4:o="\n";break;case-3:o="\r\n";break;case-2:o=t?" ":"\t";break;case-1:if(!t&&i)continue;o=" ";break;default:o=String.fromCharCode(a)}i=-2===a,r.push(o)}return r.join("")}(d(e),t)},sliceStream:d,write:function(e){if(o=iA(o,e),p(),null!==o[o.length-1])return[];return v(t,0),c.events=PA(a,c.events,c),c.events}};let u=t.tokenize.call(c,l);return t.resolveAll&&a.push(t),c;function d(e){return function(e,t){const n=t.start._index,r=t.start._bufferIndex,i=t.end._index,a=t.end._bufferIndex;let o;if(n===i)o=[e[n].slice(r,a)];else{if(o=e.slice(n,i),r>-1){const e=o[0];"string"==typeof e?o[0]=e.slice(r):o.shift()}a>0&&o.push(e[i].slice(0,a))}return o}(o,e)}function h(){const{_bufferIndex:e,_index:t,line:n,column:i,offset:a}=r;return{_bufferIndex:e,_index:t,line:n,column:i,offset:a}}function p(){let e;for(;r._index<o.length;){const t=o[r._index];if("string"==typeof t)for(e=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===e&&r._bufferIndex<t.length;)m(t.charCodeAt(r._bufferIndex));else m(t)}}function m(e){u=u(e)}function f(e,t){t.restore()}function g(e,t){return function(n,i,a){let o,u,d,p;return Array.isArray(n)?m(n):"tokenize"in n?m([n]):function(e){return t;function t(t){const n=null!==t&&e[t],r=null!==t&&e.null;return m([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(t)}}(n);function m(e){return o=e,u=0,0===e.length?a:f(e[u])}function f(e){return function(n){p=function(){const e=h(),t=c.previous,n=c.currentConstruct,i=c.events.length,a=Array.from(s);return{from:i,restore:o};function o(){r=e,c.previous=t,c.currentConstruct=n,c.events.length=i,s=a,y()}}(),d=e,e.partial||(c.currentConstruct=e);if(e.name&&c.parser.constructs.disable.null.includes(e.name))return v();return e.tokenize.call(t?Object.assign(Object.create(c),t):c,l,g,v)(n)}}function g(t){return e(d,p),i}function v(e){return p.restore(),++u<o.length?f(o[u]):a}}}function v(e,t){e.resolveAll&&!a.includes(e)&&a.push(e),e.resolve&&rA(c.events,t,c.events.length-t,e.resolve(c.events.slice(t),c)),e.resolveTo&&(c.events=e.resolveTo(c.events,c))}function y(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function DN(e){const t={constructs:function(e){const t={};let n=-1;for(;++n<e.length;)oA(t,e[n]);return t}([IN,...(e||{}).extensions||[]]),content:n(EA),defined:[],document:n(CA),flow:n(xN),lazy:{},string:n(wN),text:n(SN)};return t;function n(e){return function(n){return jN(t,e,n)}}}const ON=/[\0\t\n\r]/g;const UN=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function FN(e,t,n){if(t)return t;if(35===n.charCodeAt(0)){const e=n.charCodeAt(1),t=120===e||88===e;return lA(n.slice(t?2:1),t?16:10)}return nA(n)||e}const zN={}.hasOwnProperty;function BN(e,t,n){return"string"!=typeof t&&(n=t,t=void 0),function(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(te),autolinkProtocol:E,autolinkEmail:E,atxHeading:a(Z),blockQuote:a($),characterEscape:E,characterReference:E,codeFenced:a(X),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:a(X,o),codeText:a(q,o),codeTextData:E,data:E,codeFlowValue:E,definition:a(K),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:a(Y),hardBreakEscape:a(J),hardBreakTrailing:a(J),htmlFlow:a(Q,o),htmlFlowData:E,htmlText:a(Q,o),htmlTextData:E,image:a(ee),label:o,link:a(te),listItem:a(re),listItemValue:h,listOrdered:a(ne,d),listUnordered:a(ne),paragraph:a(ie),reference:F,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:a(Z),strong:a(ae),thematicBreak:a(se)},exit:{atxHeading:l(),atxHeadingSequence:b,autolink:l(),autolinkEmail:W,autolinkProtocol:G,blockQuote:l(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:B,characterReferenceMarkerNumeric:B,characterReferenceValue:H,characterReference:V,codeFenced:l(g),codeFencedFence:f,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:C,codeIndented:l(v),codeText:l(N),codeTextData:C,data:C,definition:l(),definitionDestinationString:x,definitionLabelString:y,definitionTitleString:_,emphasis:l(),hardBreakEscape:l(k),hardBreakTrailing:l(k),htmlFlow:l(P),htmlFlowData:C,htmlText:l(A),htmlTextData:C,image:l(L),label:j,labelText:I,lineEnding:T,link:l(R),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:z,resourceDestinationString:D,resourceTitleString:O,resource:U,setextHeading:l(M),setextHeadingLineSequence:S,setextHeadingText:w,strong:l(),thematicBreak:l()}};VN(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(e){let r={type:"root",children:[]};const a={stack:[r],tokenStack:[],config:t,enter:s,exit:c,buffer:o,resume:u,data:n},l=[];let d=-1;for(;++d<e.length;)if("listOrdered"===e[d][1].type||"listUnordered"===e[d][1].type)if("enter"===e[d][0])l.push(d);else{d=i(e,l.pop(),d)}for(d=-1;++d<e.length;){const n=t[e[d][0]];zN.call(n,e[d][1].type)&&n[e[d][1].type].call(Object.assign({sliceSerialize:e[d][2].sliceSerialize},a),e[d][1])}if(a.tokenStack.length>0){const e=a.tokenStack[a.tokenStack.length-1];(e[1]||WN).call(a,void 0,e[0])}for(r.position={start:HN(e.length>0?e[0][1].start:{line:1,column:1,offset:0}),end:HN(e.length>0?e[e.length-2][1].end:{line:1,column:1,offset:0})},d=-1;++d<t.transforms.length;)r=t.transforms[d](r)||r;return r}function i(e,t,n){let r,i,a,o,s=t-1,l=-1,c=!1;for(;++s<=n;){const t=e[s];switch(t[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===t[0]?l++:l--,o=void 0;break;case"lineEndingBlank":"enter"===t[0]&&(!r||o||l||a||(a=s),o=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:o=void 0}if(!l&&"enter"===t[0]&&"listItemPrefix"===t[1].type||-1===l&&"exit"===t[0]&&("listUnordered"===t[1].type||"listOrdered"===t[1].type)){if(r){let o=s;for(i=void 0;o--;){const t=e[o];if("lineEnding"===t[1].type||"lineEndingBlank"===t[1].type){if("exit"===t[0])continue;i&&(e[i][1].type="lineEndingBlank",c=!0),t[1].type="lineEnding",i=o}else if("linePrefix"!==t[1].type&&"blockQuotePrefix"!==t[1].type&&"blockQuotePrefixWhitespace"!==t[1].type&&"blockQuoteMarker"!==t[1].type&&"listItemIndent"!==t[1].type)break}a&&(!i||a<i)&&(r._spread=!0),r.end=Object.assign({},i?e[i][1].start:t[1].end),e.splice(i||s,0,["exit",r,t[2]]),s++,n++}if("listItemPrefix"===t[1].type){const i={type:"listItem",_spread:!1,start:Object.assign({},t[1].start),end:void 0};r=i,e.splice(s,0,["enter",i,t[2]]),s++,n++,a=void 0,o=!0}}}return e[t][1]._spread=c,n}function a(e,t){return n;function n(n){s.call(this,e(n),n),t&&t.call(this,n)}}function o(){this.stack.push({type:"fragment",children:[]})}function s(e,t,n){this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n||void 0]),e.position={start:HN(t.start),end:void 0}}function l(e){return t;function t(t){e&&e.call(this,t),c.call(this,t)}}function c(e,t){const n=this.stack.pop(),r=this.tokenStack.pop();if(!r)throw new Error("Cannot close `"+e.type+"` ("+AP({start:e.start,end:e.end})+"): its not open");if(r[0].type!==e.type)if(t)t.call(this,e,r[0]);else{(r[1]||WN).call(this,e,r[0])}n.position.end=HN(e.end)}function u(){return function(e){return QP(e,"boolean"!=typeof JP.includeImageAlt||JP.includeImageAlt,"boolean"!=typeof JP.includeHtml||JP.includeHtml)}(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function h(e){if(this.data.expectingFirstListItemValue){this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(e),10),this.data.expectingFirstListItemValue=void 0}}function p(){const e=this.resume();this.stack[this.stack.length-1].lang=e}function m(){const e=this.resume();this.stack[this.stack.length-1].meta=e}function f(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function v(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/(\r?\n|\r)$/g,"")}function y(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=cA(this.sliceSerialize(e)).toLowerCase()}function _(){const e=this.resume();this.stack[this.stack.length-1].title=e}function x(){const e=this.resume();this.stack[this.stack.length-1].url=e}function b(e){const t=this.stack[this.stack.length-1];if(!t.depth){const n=this.sliceSerialize(e).length;t.depth=n}}function w(){this.data.setextHeadingSlurpLineEnding=!0}function S(e){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(e).codePointAt(0)?1:2}function M(){this.data.setextHeadingSlurpLineEnding=void 0}function E(e){const t=this.stack[this.stack.length-1].children;let n=t[t.length-1];n&&"text"===n.type||(n=oe(),n.position={start:HN(e.start),end:void 0},t.push(n)),this.stack.push(n)}function C(e){const t=this.stack.pop();t.value+=this.sliceSerialize(e),t.position.end=HN(e.end)}function T(e){const n=this.stack[this.stack.length-1];if(this.data.atHardBreak){return n.children[n.children.length-1].position.end=HN(e.end),void(this.data.atHardBreak=void 0)}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(n.type)&&(E.call(this,e),C.call(this,e))}function k(){this.data.atHardBreak=!0}function P(){const e=this.resume();this.stack[this.stack.length-1].value=e}function A(){const e=this.resume();this.stack[this.stack.length-1].value=e}function N(){const e=this.resume();this.stack[this.stack.length-1].value=e}function R(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function L(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function I(e){const t=this.sliceSerialize(e),n=this.stack[this.stack.length-2];n.label=function(e){return e.replace(UN,FN)}(t),n.identifier=cA(t).toLowerCase()}function j(){const e=this.stack[this.stack.length-1],t=this.resume(),n=this.stack[this.stack.length-1];if(this.data.inReference=!0,"link"===n.type){const t=e.children;n.children=t}else n.alt=t}function D(){const e=this.resume();this.stack[this.stack.length-1].url=e}function O(){const e=this.resume();this.stack[this.stack.length-1].title=e}function U(){this.data.inReference=void 0}function F(){this.data.referenceType="collapsed"}function z(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=cA(this.sliceSerialize(e)).toLowerCase(),this.data.referenceType="full"}function B(e){this.data.characterReferenceType=e.type}function H(e){const t=this.sliceSerialize(e),n=this.data.characterReferenceType;let r;if(n)r=lA(t,"characterReferenceMarkerNumeric"===n?10:16),this.data.characterReferenceType=void 0;else{r=nA(t)}this.stack[this.stack.length-1].value+=r}function V(e){this.stack.pop().position.end=HN(e.end)}function G(e){C.call(this,e);this.stack[this.stack.length-1].url=this.sliceSerialize(e)}function W(e){C.call(this,e);this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(e)}function $(){return{type:"blockquote",children:[]}}function X(){return{type:"code",lang:null,meta:null,value:""}}function q(){return{type:"inlineCode",value:""}}function K(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Y(){return{type:"emphasis",children:[]}}function Z(){return{type:"heading",depth:0,children:[]}}function J(){return{type:"break"}}function Q(){return{type:"html",value:""}}function ee(){return{type:"image",title:null,url:"",alt:null}}function te(){return{type:"link",title:null,url:"",children:[]}}function ne(e){return{type:"list",ordered:"listOrdered"===e.type,start:null,spread:e._spread,children:[]}}function re(e){return{type:"listItem",spread:e._spread,checked:null,children:[]}}function ie(){return{type:"paragraph",children:[]}}function ae(){return{type:"strong",children:[]}}function oe(){return{type:"text",value:""}}function se(){return{type:"thematicBreak"}}}(n)(function(e){for(;!GA(e););return e}(DN(n).document().write(function(){let e,t=1,n="",r=!0;return function(i,a,o){const s=[];let l,c,u,d,h;for(i=n+("string"==typeof i?i.toString():new TextDecoder(a||void 0).decode(i)),u=0,n="",r&&(65279===i.charCodeAt(0)&&u++,r=void 0);u<i.length;){if(ON.lastIndex=u,l=ON.exec(i),d=l&&void 0!==l.index?l.index:i.length,h=i.charCodeAt(d),!l){n=i.slice(u);break}if(10===h&&u===d&&e)s.push(-3),e=void 0;else switch(e&&(s.push(-5),e=void 0),u<d&&(s.push(i.slice(u,d)),t+=d-u),h){case 0:s.push(65533),t++;break;case 9:for(c=4*Math.ceil(t/4),s.push(-2);t++<c;)s.push(-1);break;case 10:s.push(-4),t=1;break;default:e=!0,t=1}u=d+1}return o&&(e&&s.push(-5),n&&s.push(n),s.push(null)),s}}()(e,t,!0))))}function HN(e){return{line:e.line,column:e.column,offset:e.offset}}function VN(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?VN(e,r):GN(e,r)}}function GN(e,t){let n;for(n in t)if(zN.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function WN(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+AP({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+AP({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+AP({start:t.start,end:t.end})+") is still open")}function $N(e){const t=this;t.parser=function(n){return BN(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function XN(e,t){const n=t.referenceType;let r="]";if("collapsed"===n?r+="[]":"full"===n&&(r+="["+(t.label||t.identifier)+"]"),"imageReference"===t.type)return[{type:"text",value:"!["+t.alt+r}];const i=e.all(t),a=i[0];a&&"text"===a.type?a.value="["+a.value:i.unshift({type:"text",value:"["});const o=i[i.length-1];return o&&"text"===o.type?o.value+=r:i.push({type:"text",value:r}),i}function qN(e){const t=e.spread;return null==t?e.children.length>1:t}function KN(e){const t=String(e),n=/\r?\n|\r/g;let r=n.exec(t),i=0;const a=[];for(;r;)a.push(YN(t.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(t);return a.push(YN(t.slice(i),i>0,!1)),a.join("")}function YN(e,t,n){let r=0,i=e.length;if(t){let t=e.codePointAt(r);for(;9===t||32===t;)r++,t=e.codePointAt(r)}if(n){let t=e.codePointAt(i-1);for(;9===t||32===t;)i--,t=e.codePointAt(i-1)}return i>r?e.slice(r,i):""}const ZN={blockquote:function(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)},break:function(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:"\n"}]},code:function(e,t){const n=t.value?t.value+"\n":"",r={},i=t.lang?t.lang.split(/\s+/):[];i.length>0&&(r.className=["language-"+i[0]]);let a={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return t.meta&&(a.data={meta:t.meta}),e.patch(t,a),a=e.applyData(t,a),a={type:"element",tagName:"pre",properties:{},children:[a]},e.patch(t,a),a},delete:function(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},emphasis:function(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},footnoteReference:function(e,t){const n="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),i=SA(r.toLowerCase()),a=e.footnoteOrder.indexOf(r);let o,s=e.footnoteCounts.get(r);void 0===s?(s=0,e.footnoteOrder.push(r),o=e.footnoteOrder.length):o=a+1,s+=1,e.footnoteCounts.set(r,s);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};e.patch(t,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,c),e.applyData(t,c)},heading:function(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},html:function(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}},imageReference:function(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return XN(e,t);const i={src:SA(r.url||""),alt:t.alt};null!==r.title&&void 0!==r.title&&(i.title=r.title);const a={type:"element",tagName:"img",properties:i,children:[]};return e.patch(t,a),e.applyData(t,a)},image:function(e,t){const n={src:SA(t.url)};null!==t.alt&&void 0!==t.alt&&(n.alt=t.alt),null!==t.title&&void 0!==t.title&&(n.title=t.title);const r={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)},inlineCode:function(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)},linkReference:function(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return XN(e,t);const i={href:SA(r.url||"")};null!==r.title&&void 0!==r.title&&(i.title=r.title);const a={type:"element",tagName:"a",properties:i,children:e.all(t)};return e.patch(t,a),e.applyData(t,a)},link:function(e,t){const n={href:SA(t.url)};null!==t.title&&void 0!==t.title&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)},listItem:function(e,t,n){const r=e.all(t),i=n?function(e){let t=!1;if("list"===e.type){t=e.spread||!1;const n=e.children;let r=-1;for(;!t&&++r<n.length;)t=qN(n[r])}return t}(n):qN(t),a={},o=[];if("boolean"==typeof t.checked){const e=r[0];let n;e&&"element"===e.type&&"p"===e.tagName?n=e:(n={type:"element",tagName:"p",properties:{},children:[]},r.unshift(n)),n.children.length>0&&n.children.unshift({type:"text",value:" "}),n.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let s=-1;for(;++s<r.length;){const e=r[s];(i||0!==s||"element"!==e.type||"p"!==e.tagName)&&o.push({type:"text",value:"\n"}),"element"!==e.type||"p"!==e.tagName||i?o.push(e):o.push(...e.children)}const l=r[r.length-1];l&&(i||"element"!==l.type||"p"!==l.tagName)&&o.push({type:"text",value:"\n"});const c={type:"element",tagName:"li",properties:a,children:o};return e.patch(t,c),e.applyData(t,c)},list:function(e,t){const n={},r=e.all(t);let i=-1;for("number"==typeof t.start&&1!==t.start&&(n.start=t.start);++i<r.length;){const e=r[i];if("element"===e.type&&"li"===e.tagName&&e.properties&&Array.isArray(e.properties.className)&&e.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const a={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)};return e.patch(t,a),e.applyData(t,a)},paragraph:function(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},root:function(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)},strong:function(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},table:function(e,t){const n=e.all(t),r=n.shift(),i=[];if(r){const n={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],n),i.push(n)}if(n.length>0){const r={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},a=kP(t.children[1]),o=TP(t.children[t.children.length-1]);a&&o&&(r.position={start:a,end:o}),i.push(r)}const a={type:"element",tagName:"table",properties:{},children:e.wrap(i,!0)};return e.patch(t,a),e.applyData(t,a)},tableCell:function(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},tableRow:function(e,t,n){const r=n?n.children:void 0,i=0===(r?r.indexOf(t):1)?"th":"td",a=n&&"table"===n.type?n.align:void 0,o=a?a.length:t.children.length;let s=-1;const l=[];for(;++s<o;){const n=t.children[s],r={},o=a?a[s]:void 0;o&&(r.align=o);let c={type:"element",tagName:i,properties:r,children:[]};n&&(c.children=e.all(n),e.patch(n,c),c=e.applyData(n,c)),l.push(c)}const c={type:"element",tagName:"tr",properties:{},children:e.wrap(l,!0)};return e.patch(t,c),e.applyData(t,c)},text:function(e,t){const n={type:"text",value:KN(String(t.value))};return e.patch(t,n),e.applyData(t,n)},thematicBreak:function(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)},toml:JN,yaml:JN,definition:JN,footnoteDefinition:JN};function JN(){}const QN="object"==typeof self?self:globalThis,eR=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),r=i=>{if(e.has(i))return e.get(i);const[a,o]=t[i];switch(a){case 0:case-1:return n(o,i);case 1:{const e=n([],i);for(const t of o)e.push(r(t));return e}case 2:{const e=n({},i);for(const[t,n]of o)e[r(t)]=r(n);return e}case 3:return n(new Date(o),i);case 4:{const{source:e,flags:t}=o;return n(new RegExp(e,t),i)}case 5:{const e=n(new Map,i);for(const[t,n]of o)e.set(r(t),r(n));return e}case 6:{const e=n(new Set,i);for(const t of o)e.add(r(t));return e}case 7:{const{name:e,message:t}=o;return n(new QN[e](t),i)}case 8:return n(BigInt(o),i);case"BigInt":return n(Object(BigInt(o)),i);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:e}=new Uint8Array(o);return n(new DataView(e),o)}}return n(new QN[a](o),i)};return r})(new Map,e)(0),tR="",{toString:nR}={},{keys:rR}=Object,iR=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=nR.call(e).slice(8,-1);switch(n){case"Array":return[1,tR];case"Object":return[2,tR];case"Date":return[3,tR];case"RegExp":return[4,tR];case"Map":return[5,tR];case"Set":return[6,tR];case"DataView":return[1,n]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},aR=([e,t])=>0===e&&("function"===t||"symbol"===t),oR=(e,{json:t,lossy:n}={})=>{const r=[];return((e,t,n,r)=>{const i=(e,t)=>{const i=r.push(e)-1;return n.set(t,i),i},a=r=>{if(n.has(r))return n.get(r);let[o,s]=iR(r);switch(o){case 0:{let t=r;switch(s){case"bigint":o=8,t=r.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+s);t=null;break;case"undefined":return i([-1],r)}return i([o,t],r)}case 1:{if(s){let e=r;return"DataView"===s?e=new Uint8Array(r.buffer):"ArrayBuffer"===s&&(e=new Uint8Array(r)),i([s,[...e]],r)}const e=[],t=i([o,e],r);for(const n of r)e.push(a(n));return t}case 2:{if(s)switch(s){case"BigInt":return i([s,r.toString()],r);case"Boolean":case"Number":case"String":return i([s,r.valueOf()],r)}if(t&&"toJSON"in r)return a(r.toJSON());const n=[],l=i([o,n],r);for(const t of rR(r))!e&&aR(iR(r[t]))||n.push([a(t),a(r[t])]);return l}case 3:return i([o,r.toISOString()],r);case 4:{const{source:e,flags:t}=r;return i([o,{source:e,flags:t}],r)}case 5:{const t=[],n=i([o,t],r);for(const[i,o]of r)(e||!aR(iR(i))&&!aR(iR(o)))&&t.push([a(i),a(o)]);return n}case 6:{const t=[],n=i([o,t],r);for(const i of r)!e&&aR(iR(i))||t.push(a(i));return n}}const{message:l}=r;return i([o,{name:s,message:l}],r)};return a})(!(t||n),!!t,new Map,r)(e),r},sR="function"==typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?eR(oR(e,t)):structuredClone(e):(e,t)=>eR(oR(e,t));function lR(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function cR(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}const uR=function(e){if(null==e)return hR;if("function"==typeof e)return dR(e);if("object"==typeof e)return Array.isArray(e)?function(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=uR(e[n]);return dR(r);function r(...e){let n=-1;for(;++n<t.length;)if(t[n].apply(this,e))return!0;return!1}}(e):function(e){const t=e;return dR(n);function n(n){const r=n;let i;for(i in e)if(r[i]!==t[i])return!1;return!0}}(e);if("string"==typeof e)return function(e){return dR(t);function t(t){return t&&t.type===e}}(e);throw new Error("Expected function, string, or object as test")};function dR(e){return function(t,n,r){return Boolean(function(e){return null!==e&&"object"==typeof e&&"type"in e}(t)&&e.call(this,t,"number"==typeof n?n:void 0,r||void 0))}}function hR(){return!0}const pR=[],mR=!0,fR=!1;function gR(e,t,n,r){let i;"function"==typeof t&&"function"!=typeof n?(r=n,n=t):i=t;const a=uR(i),o=r?-1:1;!function e(i,s,l){const c=i&&"object"==typeof i?i:{};if("string"==typeof c.type){const e="string"==typeof c.tagName?c.tagName:"string"==typeof c.name?c.name:void 0;Object.defineProperty(u,"name",{value:"node ("+i.type+(e?"<"+e+">":"")+")"})}return u;function u(){let c,u,d,h=pR;if((!t||a(i,s,l[l.length-1]||void 0))&&(h=function(e){if(Array.isArray(e))return e;if("number"==typeof e)return[mR,e];return null==e?pR:[e]}(n(i,l)),h[0]===fR))return h;if("children"in i&&i.children){const t=i;if(t.children&&"skip"!==h[0])for(u=(r?t.children.length:-1)+o,d=l.concat(t);u>-1&&u<t.children.length;){const n=t.children[u];if(c=e(n,u,d)(),c[0]===fR)return c;u="number"==typeof c[1]?c[1]:u+o}}return h}}(e,void 0,[])()}function vR(e,t,n,r){let i,a,o;"function"==typeof t&&"function"!=typeof n?(a=void 0,o=t,i=n):(a=t,o=n,i=r),gR(e,a,function(e,t){const n=t[t.length-1],r=n?n.children.indexOf(e):void 0;return o(e,r,n)},i)}const yR={}.hasOwnProperty,_R={};function xR(e,t){e.position&&(t.position=function(e){const t=kP(e),n=TP(e);if(t&&n)return{start:t,end:n}}(e))}function bR(e,t){let n=t;if(e&&e.data){const t=e.data.hName,r=e.data.hChildren,i=e.data.hProperties;if("string"==typeof t)if("element"===n.type)n.tagName=t;else{n={type:"element",tagName:t,properties:{},children:"children"in n?n.children:[n]}}"element"===n.type&&i&&Object.assign(n.properties,sR(i)),"children"in n&&n.children&&null!=r&&(n.children=r)}return n}function wR(e,t){const n=t.data||{},r=!("value"in t)||yR.call(n,"hProperties")||yR.call(n,"hChildren")?{type:"element",tagName:"div",properties:{},children:e.all(t)}:{type:"text",value:t.value};return e.patch(t,r),e.applyData(t,r)}function SR(e,t){const n=[];let r=-1;for(t&&n.push({type:"text",value:"\n"});++r<e.length;)r&&n.push({type:"text",value:"\n"}),n.push(e[r]);return t&&e.length>0&&n.push({type:"text",value:"\n"}),n}function MR(e){let t=0,n=e.charCodeAt(t);for(;9===n||32===n;)t++,n=e.charCodeAt(t);return e.slice(t)}function ER(e,t){const n=function(e,t){const n=t||_R,r=new Map,i=new Map,a=new Map,o={...ZN,...n.handlers},s={all:function(e){const t=[];if("children"in e){const n=e.children;let r=-1;for(;++r<n.length;){const i=s.one(n[r],e);if(i){if(r&&"break"===n[r-1].type&&(Array.isArray(i)||"text"!==i.type||(i.value=MR(i.value)),!Array.isArray(i)&&"element"===i.type)){const e=i.children[0];e&&"text"===e.type&&(e.value=MR(e.value))}Array.isArray(i)?t.push(...i):t.push(i)}}}return t},applyData:bR,definitionById:r,footnoteById:i,footnoteCounts:a,footnoteOrder:[],handlers:o,one:function(e,t){const n=e.type,r=s.handlers[n];if(yR.call(s.handlers,n)&&r)return r(s,e,t);if(s.options.passThrough&&s.options.passThrough.includes(n)){if("children"in e){const{children:t,...n}=e,r=sR(n);return r.children=s.all(e),r}return sR(e)}return(s.options.unknownHandler||wR)(s,e,t)},options:n,patch:xR,wrap:SR};return vR(e,function(e){if("definition"===e.type||"footnoteDefinition"===e.type){const t="definition"===e.type?r:i,n=String(e.identifier).toUpperCase();t.has(n)||t.set(n,e)}}),s}(e,t),r=n.one(e,void 0),i=function(e){const t="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||lR,r=e.options.footnoteBackLabel||cR,i=e.options.footnoteLabel||"Footnotes",a=e.options.footnoteLabelTagName||"h2",o=e.options.footnoteLabelProperties||{className:["sr-only"]},s=[];let l=-1;for(;++l<e.footnoteOrder.length;){const i=e.footnoteById.get(e.footnoteOrder[l]);if(!i)continue;const a=e.all(i),o=String(i.identifier).toUpperCase(),c=SA(o.toLowerCase());let u=0;const d=[],h=e.footnoteCounts.get(o);for(;void 0!==h&&++u<=h;){d.length>0&&d.push({type:"text",value:" "});let e="string"==typeof n?n:n(l,u);"string"==typeof e&&(e={type:"text",value:e}),d.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+c+(u>1?"-"+u:""),dataFootnoteBackref:"",ariaLabel:"string"==typeof r?r:r(l,u),className:["data-footnote-backref"]},children:Array.isArray(e)?e:[e]})}const p=a[a.length-1];if(p&&"element"===p.type&&"p"===p.tagName){const e=p.children[p.children.length-1];e&&"text"===e.type?e.value+=" ":p.children.push({type:"text",value:" "}),p.children.push(...d)}else a.push(...d);const m={type:"element",tagName:"li",properties:{id:t+"fn-"+c},children:e.wrap(a,!0)};e.patch(i,m),s.push(m)}if(0!==s.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...sR(o),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:e.wrap(s,!0)},{type:"text",value:"\n"}]}}(n),a=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&a.children.push({type:"text",value:"\n"},i),a}function CR(e,t){return e&&"run"in e?async function(n,r){const i=ER(n,{file:r,...t});await e.run(i,r)}:function(n,r){return ER(n,{file:r,...e||t})}}function TR(e){if(e)throw e}var kR=Object.prototype.hasOwnProperty,PR=Object.prototype.toString,AR=Object.defineProperty,NR=Object.getOwnPropertyDescriptor,RR=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===PR.call(e)},LR=function(e){if(!e||"[object Object]"!==PR.call(e))return!1;var t,n=kR.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&kR.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;for(t in e);return void 0===t||kR.call(e,t)},IR=function(e,t){AR&&"__proto__"===t.name?AR(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},jR=function(e,t){if("__proto__"===t){if(!kR.call(e,t))return;if(NR)return NR(e,t).value}return e[t]};const DR=Ve(function e(){var t,n,r,i,a,o,s=arguments[0],l=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},l=2),(null==s||"object"!=typeof s&&"function"!=typeof s)&&(s={});l<c;++l)if(null!=(t=arguments[l]))for(n in t)r=jR(s,n),s!==(i=jR(t,n))&&(u&&i&&(LR(i)||(a=RR(i)))?(a?(a=!1,o=r&&RR(r)?r:[]):o=r&&LR(r)?r:{},IR(s,{name:n,newValue:e(u,o,i)})):void 0!==i&&IR(s,{name:n,newValue:i}));return s});function OR(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}function UR(){const e=[],t={run:function(...t){let n=-1;const r=t.pop();if("function"!=typeof r)throw new TypeError("Expected function as last argument, not "+r);!function i(a,...o){const s=e[++n];let l=-1;if(a)r(a);else{for(;++l<t.length;)null!==o[l]&&void 0!==o[l]||(o[l]=t[l]);t=o,s?function(e,t){let n;return r;function r(...t){const r=e.length>t.length;let s;r&&t.push(i);try{s=e.apply(this,t)}catch(a){if(r&&n)throw a;return i(a)}r||(s&&s.then&&"function"==typeof s.then?s.then(o,i):s instanceof Error?i(s):o(s))}function i(e,...r){n||(n=!0,t(e,...r))}function o(e){i(null,e)}}(s,i)(...o):r(null,...o)}}(null,...t)},use:function(n){if("function"!=typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n);return e.push(n),t}};return t}const FR={basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');zR(e);let n,r=0,i=-1,a=e.length;if(void 0===t||0===t.length||t.length>e.length){for(;a--;)if(47===e.codePointAt(a)){if(n){r=a+1;break}}else i<0&&(n=!0,i=a+1);return i<0?"":e.slice(r,i)}if(t===e)return"";let o=-1,s=t.length-1;for(;a--;)if(47===e.codePointAt(a)){if(n){r=a+1;break}}else o<0&&(n=!0,o=a+1),s>-1&&(e.codePointAt(a)===t.codePointAt(s--)?s<0&&(i=a):(s=-1,i=o));r===i?i=o:i<0&&(i=e.length);return e.slice(r,i)},dirname:function(e){if(zR(e),0===e.length)return".";let t,n=-1,r=e.length;for(;--r;)if(47===e.codePointAt(r)){if(t){n=r;break}}else t||(t=!0);return n<0?47===e.codePointAt(0)?"/":".":1===n&&47===e.codePointAt(0)?"//":e.slice(0,n)},extname:function(e){zR(e);let t,n=e.length,r=-1,i=0,a=-1,o=0;for(;n--;){const s=e.codePointAt(n);if(47!==s)r<0&&(t=!0,r=n+1),46===s?a<0?a=n:1!==o&&(o=1):a>-1&&(o=-1);else if(t){i=n+1;break}}if(a<0||r<0||0===o||1===o&&a===r-1&&a===i+1)return"";return e.slice(a,r)},join:function(...e){let t,n=-1;for(;++n<e.length;)zR(e[n]),e[n]&&(t=void 0===t?e[n]:t+"/"+e[n]);return void 0===t?".":function(e){zR(e);const t=47===e.codePointAt(0);let n=function(e,t){let n,r,i="",a=0,o=-1,s=0,l=-1;for(;++l<=e.length;){if(l<e.length)n=e.codePointAt(l);else{if(47===n)break;n=47}if(47===n){if(o===l-1||1===s);else if(o!==l-1&&2===s){if(i.length<2||2!==a||46!==i.codePointAt(i.length-1)||46!==i.codePointAt(i.length-2))if(i.length>2){if(r=i.lastIndexOf("/"),r!==i.length-1){r<0?(i="",a=0):(i=i.slice(0,r),a=i.length-1-i.lastIndexOf("/")),o=l,s=0;continue}}else if(i.length>0){i="",a=0,o=l,s=0;continue}t&&(i=i.length>0?i+"/..":"..",a=2)}else i.length>0?i+="/"+e.slice(o+1,l):i=e.slice(o+1,l),a=l-o-1;o=l,s=0}else 46===n&&s>-1?s++:s=-1}return i}(e,!t);0!==n.length||t||(n=".");n.length>0&&47===e.codePointAt(e.length-1)&&(n+="/");return t?"/"+n:n}(t)},sep:"/"};function zR(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const BR={cwd:function(){return"/"}};function HR(e){return Boolean(null!==e&&"object"==typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}function VR(e){if("string"==typeof e)e=new URL(e);else if(!HR(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if("file:"!==e.protocol){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return function(e){if(""!==e.hostname){const e=new TypeError('File URL host must be "localhost" or empty on darwin');throw e.code="ERR_INVALID_FILE_URL_HOST",e}const t=e.pathname;let n=-1;for(;++n<t.length;)if(37===t.codePointAt(n)&&50===t.codePointAt(n+1)){const e=t.codePointAt(n+2);if(70===e||102===e){const e=new TypeError("File URL path must not include encoded / characters");throw e.code="ERR_INVALID_FILE_URL_PATH",e}}return decodeURIComponent(t)}(e)}const GR=["history","path","basename","stem","extname","dirname"];class WR{constructor(e){let t;t=e?HR(e)?{path:e}:"string"==typeof e||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)?{value:e}:e:{},this.cwd="cwd"in t?"":BR.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n,r=-1;for(;++r<GR.length;){const e=GR[r];e in t&&void 0!==t[e]&&null!==t[e]&&(this[e]="history"===e?[...t[e]]:t[e])}for(n in t)GR.includes(n)||(this[n]=t[n])}get basename(){return"string"==typeof this.path?FR.basename(this.path):void 0}set basename(e){XR(e,"basename"),$R(e,"basename"),this.path=FR.join(this.dirname||"",e)}get dirname(){return"string"==typeof this.path?FR.dirname(this.path):void 0}set dirname(e){qR(this.basename,"dirname"),this.path=FR.join(e||"",this.basename)}get extname(){return"string"==typeof this.path?FR.extname(this.path):void 0}set extname(e){if($R(e,"extname"),qR(this.dirname,"extname"),e){if(46!==e.codePointAt(0))throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=FR.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){HR(e)&&(e=VR(e)),XR(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return"string"==typeof this.path?FR.basename(this.path,this.extname):void 0}set stem(e){XR(e,"stem"),$R(e,"stem"),this.path=FR.join(this.dirname||"",e+(this.extname||""))}fail(e,t,n){const r=this.message(e,t,n);throw r.fatal=!0,r}info(e,t,n){const r=this.message(e,t,n);return r.fatal=void 0,r}message(e,t,n){const r=new IP(e,t,n);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){if(void 0===this.value)return"";if("string"==typeof this.value)return this.value;return new TextDecoder(e||void 0).decode(this.value)}}function $R(e,t){if(e&&e.includes(FR.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+FR.sep+"`")}function XR(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function qR(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}const KR=function(e){const t=this.constructor.prototype,n=t[e],r=function(){return n.apply(r,arguments)};return Object.setPrototypeOf(r,t),r},YR={}.hasOwnProperty;class ZR extends KR{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=UR()}copy(){const e=new ZR;let t=-1;for(;++t<this.attachers.length;){const n=this.attachers[t];e.use(...n)}return e.data(DR(!0,{},this.namespace)),e}data(e,t){return"string"==typeof e?2===arguments.length?(tL("data",this.frozen),this.namespace[e]=t,this):YR.call(this.namespace,e)&&this.namespace[e]||void 0:e?(tL("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...n]=this.attachers[this.freezeIndex];if(!1===n[0])continue;!0===n[0]&&(n[0]=void 0);const r=t.call(e,...n);"function"==typeof r&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=iL(e),n=this.parser||this.Parser;return QR("parse",n),n(String(t),t)}process(e,t){const n=this;return this.freeze(),QR("process",this.parser||this.Parser),eL("process",this.compiler||this.Compiler),t?r(void 0,t):new Promise(r);function r(r,i){const a=iL(e),o=n.parse(a);function s(e,n){e||!n?i(e):r?r(n):t(void 0,n)}n.run(o,a,function(e,t,r){if(e||!t||!r)return s(e);const i=t,a=n.stringify(i,r);var o;"string"==typeof(o=a)||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(o)?r.value=a:r.result=a,s(e,r)})}}processSync(e){let t,n=!1;return this.freeze(),QR("processSync",this.parser||this.Parser),eL("processSync",this.compiler||this.Compiler),this.process(e,function(e,r){n=!0,TR(e),t=r}),rL("processSync","process",n),t}run(e,t,n){nL(e),this.freeze();const r=this.transformers;return n||"function"!=typeof t||(n=t,t=void 0),n?i(void 0,n):new Promise(i);function i(i,a){const o=iL(t);r.run(e,o,function(t,r,o){const s=r||e;t?a(t):i?i(s):n(void 0,s,o)})}}runSync(e,t){let n,r=!1;return this.run(e,t,function(e,t){TR(e),n=t,r=!0}),rL("runSync","run",r),n}stringify(e,t){this.freeze();const n=iL(t),r=this.compiler||this.Compiler;return eL("stringify",r),nL(e),r(e,n)}use(e,...t){const n=this.attachers,r=this.namespace;if(tL("use",this.frozen),null==e);else if("function"==typeof e)s(e,t);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");Array.isArray(e)?o(e):a(e)}return this;function i(e){if("function"==typeof e)s(e,[]);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");if(Array.isArray(e)){const[t,...n]=e;s(t,n)}else a(e)}}function a(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(e.plugins),e.settings&&(r.settings=DR(!0,r.settings,e.settings))}function o(e){let t=-1;if(null==e);else{if(!Array.isArray(e))throw new TypeError("Expected a list of plugins, not `"+e+"`");for(;++t<e.length;){i(e[t])}}}function s(e,t){let r=-1,i=-1;for(;++r<n.length;)if(n[r][0]===e){i=r;break}if(-1===i)n.push([e,...t]);else if(t.length>0){let[r,...a]=t;const o=n[i][1];OR(o)&&OR(r)&&(r=DR(!0,o,r)),n[i]=[e,r,...a]}}}}const JR=(new ZR).freeze();function QR(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `parser`")}function eL(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `compiler`")}function tL(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function nL(e){if(!OR(e)||"string"!=typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function rL(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function iL(e){return function(e){return Boolean(e&&"object"==typeof e&&"message"in e&&"messages"in e)}(e)?e:new WR(e)}const aL=[],oL={allowDangerousHtml:!0},sL=/^(https?|ircs?|mailto|xmpp)$/i,lL=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function cL(e){const t=function(e){const t=e.rehypePlugins||aL,n=e.remarkPlugins||aL,r=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...oL}:oL,i=JR().use($N).use(n).use(CR,r).use(t);return i}(e),n=function(e){const t=e.children||"",n=new WR;"string"==typeof t&&(n.value=t);return n}(e);return function(e,t){const n=t.allowedElements,r=t.allowElement,i=t.components,a=t.disallowedElements,o=t.skipHtml,s=t.unwrapDisallowed,l=t.urlTransform||uL;for(const u of lL)Object.hasOwn(t,u.from)&&mk((u.from,u.to&&u.to,u.id));return vR(e,c),BP(e,{Fragment:Ot.Fragment,components:i,ignoreInvalidStyle:!0,jsx:Ot.jsx,jsxs:Ot.jsxs,passKeys:!0,passNode:!0});function c(e,t,i){if("raw"===e.type&&i&&"number"==typeof t)return o?i.children.splice(t,1):i.children[t]={type:"text",value:e.value},t;if("element"===e.type){let t;for(t in ZP)if(Object.hasOwn(ZP,t)&&Object.hasOwn(e.properties,t)){const n=e.properties[t],r=ZP[t];(null===r||r.includes(e.tagName))&&(e.properties[t]=l(String(n||""),t,e))}}if("element"===e.type){let o=n?!n.includes(e.tagName):!!a&&a.includes(e.tagName);if(!o&&r&&"number"==typeof t&&(o=!r(e,t,i)),o&&i&&"number"==typeof t)return s&&e.children?i.children.splice(t,1,...e.children):i.children.splice(t,1),t}}}(t.runSync(t.parse(n),n),e)}function uL(e){const t=e.indexOf(":"),n=e.indexOf("?"),r=e.indexOf("#"),i=e.indexOf("/");return-1===t||-1!==i&&t>i||-1!==n&&t>n||-1!==r&&t>r||sL.test(e.slice(0,t))?e:""}function dL({notes:e,onNotesChange:t}){const{t:n}=yf(),[r,i]=kt.useState(!1),[a,o]=kt.useState(e),s=kt.useRef(null),l=kt.useRef(null);kt.useEffect(()=>{o(e)},[e]),kt.useEffect(()=>{r&&s.current&&s.current.focus()},[r]);const c=kt.useCallback(e=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t(e)},300)},[t]),u=e.trim().length>0;return Ot.jsxs("div",{className:"panel-notes-footer",children:[Ot.jsxs("div",{className:"panel-notes-header",children:[Ot.jsxs("div",{className:"panel-notes-title",children:[Ot.jsx(CT,{size:12}),Ot.jsx("span",{children:n("storyboard.notes.title")}),u&&Ot.jsx("span",{className:"notes-indicator",children:""})]}),Ot.jsx("button",{className:"panel-notes-toggle",onClick:()=>{i(!r),r&&(l.current&&clearTimeout(l.current),t(a))},title:n(r?"storyboard.notes.viewMode":"storyboard.notes.editMode"),children:r?Ot.jsx(uT,{size:12}):Ot.jsx(AT,{size:12})})]}),r?Ot.jsx("textarea",{ref:s,className:"panel-notes-textarea",value:a,onChange:e=>{const t=e.target.value;o(t),c(t)},placeholder:n("storyboard.notes.placeholder"),rows:3}):Ot.jsx("div",{className:"panel-notes-view",children:u?Ot.jsx(cL,{components:{p:({children:e})=>Ot.jsx("p",{className:"markdown-paragraph",children:e}),strong:({children:e})=>Ot.jsx("strong",{className:"markdown-bold",children:e}),em:({children:e})=>Ot.jsx("em",{className:"markdown-italic",children:e}),code:({children:e})=>Ot.jsx("code",{className:"markdown-code",children:e}),ul:({children:e})=>Ot.jsx("ul",{className:"markdown-list",children:e}),ol:({children:e})=>Ot.jsx("ol",{className:"markdown-list",children:e}),li:({children:e})=>Ot.jsx("li",{className:"markdown-list-item",children:e})},children:e}):Ot.jsx("span",{className:"panel-notes-placeholder",children:n("storyboard.notes.empty")})})]})}function hL({panelId:e,name:t,locked:n,selected:r=!1,onNameChange:i,onRemove:a,onMouseDown:o,dragHandleListeners:s={}}){const[l,c]=kt.useState(!1),[u,d]=kt.useState(t),h=kt.useRef(null),{t:p}=yf();kt.useEffect(()=>{l&&h.current&&(h.current.focus(),h.current.select())},[l]),kt.useEffect(()=>{d(t)},[t]);const m=()=>{const e=function(e){return e.replace(/[<>:"\/\\|?*]/g,"_").replace(/\.\./g,"_").replace(/^\s+|\s+$/g,"").substring(0,30)}(u);e&&e!==t&&i(e),c(!1),d(e||t)};return Ot.jsxs("div",{className:"panel-header "+(r?"selected":""),onMouseDown:o,children:[Ot.jsx("div",{className:"panel-drag-handle",title:p("storyboard.panel.dragToMove"),...s,children:Ot.jsx(vT,{size:16})}),Ot.jsxs("div",{className:"panel-name-container",children:[l?Ot.jsx("input",{ref:h,type:"text",className:"panel-name-input",value:u,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key?m():"Escape"===e.key&&(d(t),c(!1))},onBlur:()=>{m()},placeholder:`Panel_${String(e).padStart(2,"0")}`,maxLength:30}):Ot.jsx("span",{className:"panel-name "+(n?"locked":"editable"),onDoubleClick:()=>{n||c(!0)},title:p(n?"storyboard.panel.lockedTitle":"storyboard.panel.renameTitle"),children:t}),n&&Ot.jsx(ST,{size:12,className:"panel-lock-icon"})]}),Ot.jsx("div",{className:"panel-header-actions",children:Ot.jsx("button",{className:"panel-remove-btn",onClick:e=>{e.stopPropagation(),a()},title:p("storyboard.panel.removeTitle"),children:Ot.jsx(XT,{size:14})})})]})}function pL({rating:e,onRatingChange:t,maxStars:n=5,size:r=14}){const[i,a]=kt.useState(0);return Ot.jsx("div",{className:"star-rating",children:Array.from({length:n},(n,o)=>{const s=o+1,l=s<=(i||e);return Ot.jsx("button",{className:"star-btn "+(l?"filled":"empty"),onClick:()=>{var n;t((n=s)===e?0:n)},onMouseEnter:()=>a(s),onMouseLeave:()=>a(0),title:`${s} star${1!==s?"s":""}`,type:"button",children:Ot.jsx(VT,{size:r,fill:l?"currentColor":"none",strokeWidth:2})},s)})})}function mL({isOpen:e,onClose:t,projectName:n,selectedPanelId:r,panels:i}){const{t:a,i18n:o}=yf(),s=n||a("storyboard.project.untitled"),[l,c]=kt.useState(3),[u,d]=kt.useState("all"),[h,p]=kt.useState(new Set),[m,f]=kt.useState("a4"),[g,v]=kt.useState("landscape"),y=kt.useRef(null),[_,x]=kt.useState("");kt.useEffect(()=>{if(e){const e=new Set(i.filter(e=>e.image).map(e=>e.id));p(e),r?(d("selected"),p(new Set([r]))):d("all")}},[e,i,r]);const b="all"===u?i.filter(e=>e.image):i.filter(e=>e.image&&h.has(e.id)),w=i.filter(e=>e.image),S=kt.useCallback(e=>{p(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},[]),M=kt.useCallback(()=>{p(new Set(i.filter(e=>e.image).map(e=>e.id)))},[i]),E=kt.useCallback(()=>{p(new Set)},[]),C=kt.useCallback(()=>{const e=Math.floor(100/l),t=l<=2?11:9,n="zh-CN"===(o.resolvedLanguage||o.language)?"zh-CN":void 0,r=a("storyboard.print.subtitle",{count:b.length,date:(new Date).toLocaleDateString(n)}),i=a("storyboard.print.documentTitle",{projectName:s}),c="a4"===m?"landscape"===g?"size: A4 landscape;":"size: A4 portrait;":"landscape"===g?"size: letter landscape;":"size: letter portrait;",u=b.map(t=>{const n=t.name||a("storyboard.panel.defaultLabel",{id:t.id}),r=t.rating&&t.rating>0?`<span class="cell-rating">${"".repeat(t.rating)}${"".repeat(5-t.rating)}</span>`:"",i=t.notes&&t.notes.trim()?`<div class="cell-notes">${fL(t.notes)}</div>`:"",o=t.imageHistory&&t.imageHistory.length>0?t.imageHistory[0]:null;let s="";if(o){const e=[];null!=o.metadata.version&&e.push(`v${o.metadata.version}`),o.metadata.generationTime&&e.push(`${o.metadata.generationTime.toFixed(1)}s`),o.metadata.workflowName&&e.push(fL(o.metadata.workflowName)),e.length>0&&(s=`<div class="cell-meta">${e.join("  ")}</div>`)}return`\n        <div class="cell" style="width:${e}%">\n          <div class="cell-inner">\n            <div class="cell-header">\n              <span class="cell-label">${fL(n)}</span>\n              ${r}\n            </div>\n            <img src="${t.image}" />\n            ${s}\n            ${i}\n          </div>\n        </div>`}).join("\n");return`<!DOCTYPE html>\n<html>\n<head>\n<meta charset="utf-8"/>\n<title>${fL(i)}</title>\n<style>\n  @page { ${c} margin: 10mm; }\n  * { box-sizing: border-box; margin: 0; padding: 0; }\n  body {\n    font-family: 'Segoe UI', 'Inter', Arial, sans-serif;\n    background: #fff;\n    color: #1a1a1a;\n    -webkit-print-color-adjust: exact;\n    print-color-adjust: exact;\n  }\n  .header {\n    text-align: center;\n    padding: 8px 0 6px;\n    border-bottom: 2px solid #222;\n    margin-bottom: 8px;\n  }\n  .header h1 { font-size: 18px; font-weight: 600; }\n  .header .subtitle { font-size: 10px; color: #888; margin-top: 2px; }\n  .grid {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0;\n  }\n  .cell {\n    padding: 4px;\n    break-inside: avoid;\n  }\n  .cell-inner {\n    border: 1px solid #d0d0d0;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fafafa;\n  }\n  .cell-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 3px 6px;\n    background: #222;\n    color: #fff;\n  }\n  .cell-label {\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n  .cell-rating {\n    font-size: 10px;\n    color: #e0b967;\n  }\n  .cell-inner img {\n    display: block;\n    width: 100%;\n    height: auto;\n    object-fit: contain;\n  }\n  .cell-meta {\n    padding: 2px 6px;\n    font-size: 8px;\n    color: #888;\n    background: #f0f0f0;\n    border-top: 1px solid #e0e0e0;\n  }\n  .cell-notes {\n    padding: 4px 6px;\n    font-size: ${t}px;\n    line-height: 1.35;\n    color: #333;\n    background: #f4f4f4;\n    border-top: 1px solid #e0e0e0;\n    white-space: pre-wrap;\n    word-break: break-word;\n  }\n  @media print {\n    body { background: #fff; }\n    .header { page-break-after: avoid; }\n    .cell { break-inside: avoid; }\n  }\n</style>\n</head>\n<body>\n  <div class="header">\n    <h1>${fL(s)}</h1>\n    <div class="subtitle">${fL(r)}</div>\n  </div>\n  <div class="grid">\n    ${u}\n  </div>\n</body>\n</html>`},[l,s,o.language,o.resolvedLanguage,g,m,b,a]);kt.useEffect(()=>{e&&x(C())},[e,C]),kt.useEffect(()=>{const e=y.current;if(!e||!_)return;const t=e.contentDocument;t&&(t.open(),t.write(_),t.close())},[_]);const T=kt.useCallback(()=>{const e=y.current;(null==e?void 0:e.contentWindow)&&(e.contentWindow.focus(),e.contentWindow.print())},[]);return e?Ot.jsx("div",{className:"print-dialog-overlay",onClick:t,children:Ot.jsxs("div",{className:"print-dialog",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"print-dialog-header",children:[Ot.jsxs("h2",{children:[Ot.jsx(IT,{size:18}),a("storyboard.print.title")]}),Ot.jsx("button",{className:"close-btn",onClick:t,children:Ot.jsx(XT,{size:18})})]}),Ot.jsxs("div",{className:"print-toolbar",children:[Ot.jsxs("div",{className:"print-toolbar-group",children:[Ot.jsx("span",{className:"toolbar-label",children:a("storyboard.print.grid")}),[1,2,3,4].map(e=>Ot.jsx("button",{className:"grid-btn "+(l===e?"active":""),onClick:()=>c(e),children:a("storyboard.print.columns",{count:e})},e))]}),Ot.jsxs("div",{className:"print-toolbar-group",children:[Ot.jsx("span",{className:"toolbar-label",children:a("storyboard.print.page")}),Ot.jsxs("select",{className:"page-select",value:m,onChange:e=>f(e.target.value),children:[Ot.jsx("option",{value:"a4",children:a("storyboard.print.pageA4")}),Ot.jsx("option",{value:"letter",children:a("storyboard.print.pageLetter")})]}),Ot.jsxs("select",{className:"page-select",value:g,onChange:e=>v(e.target.value),children:[Ot.jsx("option",{value:"landscape",children:a("storyboard.print.orientationLandscape")}),Ot.jsx("option",{value:"portrait",children:a("storyboard.print.orientationPortrait")})]})]}),Ot.jsxs("div",{className:"print-toolbar-group",children:[Ot.jsx("span",{className:"toolbar-label",children:a("storyboard.print.panels")}),Ot.jsxs("button",{className:"mode-btn "+("all"===u?"active":""),onClick:()=>d("all"),children:[a("storyboard.print.all")," (",w.length,")"]}),Ot.jsxs("button",{className:"mode-btn "+("selected"===u?"active":""),onClick:()=>d("selected"),children:[a("storyboard.print.selected")," (",h.size,")"]})]}),Ot.jsxs("button",{className:"print-action-btn",onClick:T,disabled:0===b.length,children:[Ot.jsx(IT,{size:16})," ",a("storyboard.print.print")]})]}),"selected"===u&&Ot.jsxs("div",{className:"print-panel-selector",children:[Ot.jsxs("div",{className:"selector-actions",children:[Ot.jsx("button",{onClick:M,className:"selector-action-btn",children:a("storyboard.print.selectAll")}),Ot.jsx("button",{onClick:E,className:"selector-action-btn",children:a("storyboard.print.deselectAll")})]}),Ot.jsx("div",{className:"panel-chips",children:w.map(e=>Ot.jsxs("button",{className:"panel-chip "+(h.has(e.id)?"selected":""),onClick:()=>S(e.id),children:[h.has(e.id)?Ot.jsx(BT,{size:14}):Ot.jsx(HT,{size:14}),Ot.jsx("span",{className:"chip-thumb",children:e.image&&Ot.jsx("img",{src:e.image,alt:""})}),Ot.jsx("span",{children:e.name||a("storyboard.panel.defaultLabel",{id:e.id})})]},e.id))})]}),Ot.jsx("div",{className:"print-preview-container",children:0===b.length?Ot.jsxs("div",{className:"print-empty",children:[Ot.jsx("p",{children:a("storyboard.print.emptyTitle")}),Ot.jsx("p",{className:"hint",children:a("storyboard.print.emptyHint")})]}):Ot.jsx("iframe",{ref:y,className:"print-preview-iframe",title:a("storyboard.print.previewTitle")})})]})}):null}function fL(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const gL=new class{constructor(){je(this,"baseUrl","/api/workflows")}async loadAll(){const e=await fetch(this.baseUrl);if(!e.ok)throw new Error(`Failed to load workflows: HTTP ${e.status}`);return e.json()}async save(e){const t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`Failed to save workflow: HTTP ${t.status}`)}return t.json()}async saveAll(e){const t=await fetch(`${this.baseUrl}/bulk`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflows:e})});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`Failed to bulk save workflows: HTTP ${t.status}`)}return t.json()}async update(e,t){const n=await fetch(`${this.baseUrl}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.detail||`Failed to update workflow: HTTP ${n.status}`)}return n.json()}async delete(e){const t=await fetch(`${this.baseUrl}/${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`Failed to delete workflow: HTTP ${t.status}`)}return t.json()}async getStorageInfo(){const e=await fetch(`${this.baseUrl}/storage-info`);if(!e.ok)throw new Error(`Failed to get storage info: HTTP ${e.status}`);return e.json()}};function vL(e,t){if(e)return e.length<=t?e:e.substring(0,t-3)+"..."}function yL(e,t=.1,n=5){return Math.max(t,Math.min(n,e))}function _L(e){if(!e)return;const t="string"==typeof e?new Date(e):e;return isNaN(t.getTime())?void 0:t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function xL(e){if(e.includes("\\")||e.includes("/"))return e.split(/[\\\/]/).pop()||"";const t=e.match(/path=([^&]+)/);return t?decodeURIComponent(t[1]).split(/[\\\/]/).pop()||"":e}function bL(e,t){return 320*((e-1)%3)}function wL(e,t){return 320*Math.floor((e-1)/3)}const SL=["Image Generation","Text to Image","Image to Image","InPainting","Image Editing","Upscaling","Video Generation"],ML={text2img:"Text to Image",img2img:"Image to Image",inpainting:"InPainting",editing:"Image Editing",upscale:"Upscaling",video:"Video Generation"};function EL(){var e,t,n,r,i,a,o,s,l,c,u;const{showError:d,showWarning:h,showInfo:p,notifications:m,removeNotification:f}=function(){const[e,t]=kt.useState([]),n=kt.useRef(new Set);return{showError:kt.useCallback(e=>{if(!FC("error",e))return"";OC+=1;const n=`${Date.now()}-${OC}`;return t(t=>[...t,{id:n,message:e,type:"error"}]),n},[]),showWarning:kt.useCallback(e=>{if(!FC("warning",e))return"";OC+=1;const n=`${Date.now()}-${OC}`;return t(t=>[...t,{id:n,message:e,type:"warning"}]),n},[]),showInfo:kt.useCallback(e=>{if(!FC("info",e))return"";OC+=1;const n=`${Date.now()}-${OC}`;return t(t=>[...t,{id:n,message:e,type:"info"}]),n},[]),notifications:e,removeNotification:kt.useCallback(e=>{n.current.delete(e),t(t=>t.filter(t=>t.id!==e))},[])}}(),[g,v]=kt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).activeTab??"image-generation"}catch{}return"image-generation"}),[y,_]=kt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).activeSubTab??"text2img"}catch{}return"text2img"}),[x,b]=kt.useState(null),[w,S]=kt.useState(()=>[{id:1,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:0,y:0,width:300,height:300},{id:2,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:320,y:0,width:300,height:300},{id:3,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:640,y:0,width:300,height:300},{id:4,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:0,y:320,width:300,height:300},{id:5,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:320,y:320,width:300,height:300},{id:6,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:640,y:320,width:300,height:300}]),[M,E]=kt.useState(null),[C,T]=kt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).canvasZoom??1}catch{}return 1}),[k,P]=kt.useState({x:0,y:0}),[A,N]=kt.useState(!1),[R,L]=kt.useState({x:0,y:0}),[I,j]=kt.useState(null),[D,O]=kt.useState({x:0,y:0,width:0,height:0}),[U,F]=kt.useState(null),[z,B]=kt.useState({x:0,y:0,panelX:0,panelY:0,selectedPanelPositions:new Map}),[H,V]=kt.useState(!1),[G,W]=kt.useState({x:0,y:0}),[$,X]=kt.useState({x:0,y:0}),[q,K]=kt.useState([]),[,Y]=kt.useState(null),[Z,J]=kt.useState(!1),[Q,ee]=kt.useState(!1),[te,ne]=kt.useState(""),re=kt.useRef(null),ie=kt.useRef(!1),ae=kt.useRef(new Map),[oe,se]=kt.useState([]),le=kt.useRef(!1),[ce,ue]=kt.useState(null),[de,he]=kt.useState(!1),[pe,me]=kt.useState(null),[fe,ge]=kt.useState(!1),[ve,ye]=kt.useState(!1),[_e,xe]=kt.useState(!1),[be,we]=kt.useState(null),[Se,Me]=kt.useState(""),[Ee,Ce]=kt.useState({}),[Te,ke]=kt.useState({}),[Pe,Ae]=kt.useState(""),[Ne,Re]=kt.useState(!1),[Le,Ie]=kt.useState(!1),[je,De]=kt.useState(null),[Oe,Ue]=kt.useState(null),[Fe,ze]=kt.useState(1),[Be,He]=kt.useState({x:0,y:0}),[Ve,Ge]=kt.useState(!1),[We,$e]=kt.useState(null),[Xe,qe]=kt.useState(50),Ke=kt.useRef(null),[Ye,Ze]=kt.useState({visible:!1,x:0,y:0,panelId:null}),[Je,Qe]=kt.useState(()=>!function(e=768){return window.innerWidth<e}(768)),[et,tt]=kt.useState(!1),[nt,rt]=kt.useState(),[it,at]=kt.useState(),[ot,st]=kt.useState(null),[lt,ct]=kt.useState(!1),[ut,dt]=kt.useState("actual"),ht=kt.useRef(null),[pt,mt]=kt.useState(`${window.location.protocol}//${window.location.hostname}:8188`),[ft,gt]=kt.useState("disconnected"),[vt,yt]=kt.useState(null),[_t,xt]=kt.useState([]),[bt,wt]=kt.useState("ALL"),[St,Mt]=kt.useState(!0),[Et,Ct]=kt.useState(!1),Tt=kt.useRef(null),[Pt,At]=kt.useState(!1),[Nt,Rt]=kt.useState(!1),Lt=WC(),It=kt.useRef(null),jt=kt.useRef(new Set),Dt=kt.useRef(new Set),Ut=kt.useRef(new Map),Ft=kt.useRef(new Set),zt=kt.useRef(0),Bt=kt.useRef(Ee),Ht=kt.useRef(M);Bt.current=Ee,Ht.current=M;const Vt=kt.useCallback((e,t)=>{t.preventDefault(),t.stopPropagation();const n=w.find(t=>t.id===e);n&&(j(e),O({x:t.clientX,y:t.clientY,width:n.width,height:n.height}))},[w]),Gt=kt.useCallback(e=>{if(null===I)return;const t=e.clientX-D.x,n=e.clientY-D.y,r=Math.max(200,D.width+t),i=Math.max(200,D.height+n);S(e=>e.map(e=>e.id===I?{...e,width:r,height:i}:e))},[I,D]),Wt=kt.useCallback(()=>{j(null),O({x:0,y:0,width:0,height:0})},[]);kt.useEffect(()=>{if(null!==I)return window.addEventListener("mousemove",Gt),window.addEventListener("mouseup",Wt),()=>{window.removeEventListener("mousemove",Gt),window.removeEventListener("mouseup",Wt)}},[I,Gt,Wt]);const $t=kt.useCallback(e=>{S(t=>t.map(t=>t.id===e?{...t,selected:!t.selected}:t))},[]),Xt=kt.useCallback((e,t)=>{const n=t.target;if("BUTTON"===n.tagName||"INPUT"===n.tagName||n.closest("button"))return;if(t.ctrlKey||t.metaKey||t.shiftKey)return t.preventDefault(),t.stopPropagation(),void $t(e);t.preventDefault(),t.stopPropagation();const r=w.find(t=>t.id===e);if(!r)return;F(e);const i=new Map;r.selected&&w.filter(e=>e.selected).forEach(e=>{i.set(e.id,{x:e.x,y:e.y})}),B({x:t.clientX,y:t.clientY,panelX:r.x,panelY:r.y,selectedPanelPositions:i}),S(t=>t.map(t=>t.id===e?{...t,zIndex:100}:t))},[w,$t]),qt=kt.useCallback(e=>{if(null===U)return;const t=(e.clientX-z.x)/C,n=(e.clientY-z.y)/C,r=z.panelX+t,i=z.panelY+n,a=z.selectedPanelPositions.size>1;S(e=>e.map(e=>{if(e.id===U)return{...e,x:r,y:i};if(a&&e.selected&&e.id!==U){const r=z.selectedPanelPositions.get(e.id);if(r)return{...e,x:r.x+t,y:r.y+n}}return e}))},[U,z,C]),Kt=kt.useCallback(()=>{null!==U&&S(e=>e.map(e=>e.id===U?{...e,zIndex:void 0}:e)),F(null),B({x:0,y:0,panelX:0,panelY:0,selectedPanelPositions:new Map})},[U]);kt.useEffect(()=>{if(null!==U)return window.addEventListener("mousemove",qt),window.addEventListener("mouseup",Kt),()=>{window.removeEventListener("mousemove",qt),window.removeEventListener("mouseup",Kt)}},[U,qt,Kt]);const Yt=kt.useCallback(e=>{const t=w.find(t=>t.id===e);if(!t)return;if(t.imageHistory.length>0)Y({open:!0,title:"Remove Panel",message:`Remove "${t.name||`Panel_${String(e).padStart(2,"0")}`}"?\n\nThis panel has ${t.imageHistory.length} generated image(s). This action cannot be undone.`,onConfirm:()=>{if(S(t=>t.filter(t=>t.id!==e)),M===e){const t=w.filter(t=>t.id!==e);E(t.length>0?t[0].id:null)}Y(null)},onCancel:()=>Y(null)});else if(S(t=>t.filter(t=>t.id!==e)),M===e){const t=w.filter(t=>t.id!==e);E(t.length>0?t[0].id:null)}},[w,M]),Zt=kt.useCallback(e=>{const t=w.filter(e=>e.selected);if(t.length<2)return;let n;switch(e){case"left":n=Math.min(...t.map(e=>e.x));break;case"right":n=Math.max(...t.map(e=>e.x+e.width));break;case"top":n=Math.min(...t.map(e=>e.y));break;case"bottom":n=Math.max(...t.map(e=>e.y+e.height))}S(t=>t.map(t=>{if(!t.selected)return t;switch(e){case"left":return{...t,x:n};case"right":return{...t,x:n-t.width};case"top":return{...t,y:n};case"bottom":return{...t,y:n-t.height};default:return t}}))},[w]),Jt=kt.useCallback(e=>{const t=w.filter(e=>e.selected);if(t.length<3)return;const n=[...t].sort((t,n)=>"horizontal"===e?t.x-n.x:t.y-n.y),r=n[0],i=n[n.length-1];let a,o;"horizontal"===e?(a=i.x+i.width-r.x,o=n.reduce((e,t)=>e+t.width,0)):(a=i.y+i.height-r.y,o=n.reduce((e,t)=>e+t.height,0));const s=(a-o)/(n.length-1);S(t=>{let i="horizontal"===e?r.x:r.y;const a=new Map;return n.forEach((t,r)=>{if(0===r)i+="horizontal"===e?t.width:t.height;else if(r===n.length-1);else{const n=i+s;a.set(t.id,{x:"horizontal"===e?n:t.x,y:"vertical"===e?n:t.y}),i=n+("horizontal"===e?t.width:t.height)}}),t.map(e=>{if(!e.selected)return e;const t=a.get(e.id);return t?{...e,...t}:e})})},[w]),Qt=kt.useCallback(async e=>{var t;e.preventDefault(),e.stopPropagation();const n=e.dataTransfer.items;if(n)for(let r=0;r<n.length;r++){const e=n[r];if("file"===e.kind){const n=null==(t=e.webkitGetAsEntry)?void 0:t.call(e);if(null==n?void 0:n.isDirectory){const e=n.name;ne(e),ee(!0);break}}}},[]),en=kt.useCallback((e,t)=>{const n={id:String(++zt.current),timestamp:new Date,tag:e,message:t};xt(e=>[...e.slice(-499),n])},[]),[tn,nn]=kt.useState([]),[rn,an]=kt.useState(!1),[on,sn]=function(){const[e,t]=kt.useState(ik.getProject());return[e,kt.useCallback(e=>{ik.setProject(e),t(ik.getProject())},[])]}(),[ln,cn]=kt.useState(new Set),[un,dn]=kt.useState(!1),[hn,pn]=kt.useState({progress:0,currentFile:""}),[mn,fn]=kt.useState(null),[gn,vn]=kt.useState(!1),[yn,_n]=kt.useState(new Set),[xn,bn]=kt.useState(!1);kt.useEffect(()=>{const e=e=>{"Shift"===e.key&&J(!0)},t=e=>{"Shift"===e.key&&(J(!1),K([]))};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),kt.useEffect(()=>{on.orchestratorUrl&&(GC.fetchBackendsFromAPI(on.orchestratorUrl),GC.startPolling(5e3),setTimeout(()=>{GC.getNodes().forEach(e=>GC.pollNode(e))},100))},[on.orchestratorUrl]),kt.useEffect(()=>{(async()=>{if(!on.orchestratorUrl)return _n(new Set),void bn(!1);const e=[{path:"/api/health",method:"GET"},{path:"/api/scan-project-images",method:"POST",body:JSON.stringify({folder_path:"",naming_pattern:"",project_name:""})},{path:"/api/serve-image",method:"GET"},{path:"/api/delete-image",method:"DELETE",body:JSON.stringify({file_path:""})}],t=new Set;for(const n of e)try{const e=await fetch(`${on.orchestratorUrl}${n.path}`,{method:n.method,headers:n.body?{"Content-Type":"application/json"}:void 0,body:n.body,signal:AbortSignal.timeout(5e3)});404!==e.status&&405!==e.status&&t.add(n.path)}catch{}_n(t),bn(!0),t.has("/api/scan-project-images")||h("Orchestrator server is running but project scanning endpoints are not available. Please update the Orchestrator server to the latest version for full functionality.")})()},[on.orchestratorUrl]);const[wn,Sn]=kt.useState(null),[Mn,En]=kt.useState(!1),[Cn,Tn]=kt.useState([]),[kn,Pn]=kt.useState(""),[An,Nn]=kt.useState(!1),[Rn,Ln]=kt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).leftPanelWidth??250}catch{}return 250}),[In,jn]=kt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).rightPanelWidth??200}catch{}return 200}),[Dn,On]=kt.useState(!1),[Un,Fn]=kt.useState(!1);kt.useEffect(()=>{const e=e=>{if(Dn){const t=Math.max(150,Math.min(500,e.clientX));Ln(t)}if(Un){const t=Math.max(150,Math.min(400,window.innerWidth-e.clientX));jn(t)}},t=()=>{On(!1),Fn(!1),document.body.style.cursor="",document.body.style.userSelect=""};return(Dn||Un)&&(document.body.style.cursor="col-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[Dn,Un]),kt.useEffect(()=>{const e=()=>{x&&b(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[x]),kt.useEffect(()=>{St&&Tt.current&&Tt.current.scrollIntoView({behavior:"smooth"})},[_t,St]),kt.useEffect(()=>{(async()=>{try{const t=await gL.loadAll();if(t.workflows&&t.workflows.length>0)se(t.workflows),ce||ue(t.workflows[0].id),console.log(`[Workflows] Loaded ${t.count} workflows from ${t.storage_path}`);else{const t=localStorage.getItem("storyboard_workflows");if(t)try{const e=JSON.parse(t);Array.isArray(e)&&e.length>0&&(console.log(`[Workflows] Migrating ${e.length} workflows from localStorage to backend...`),se(e),ce||ue(e[0].id),await gL.saveAll(e),localStorage.removeItem("storyboard_workflows"),console.log("[Workflows] Migration complete  localStorage cleared"))}catch(e){console.error("[Workflows] Failed to migrate from localStorage:",e)}}}catch(t){console.error("[Workflows] Failed to load from backend, falling back to localStorage:",t);const n=localStorage.getItem("storyboard_workflows");if(n)try{const e=JSON.parse(n);se(e),e.length>0&&!ce&&ue(e[0].id)}catch(e){console.error("[Workflows] localStorage fallback also failed:",e)}}le.current=!0})(),GC.loadFromStorage()},[]),kt.useEffect(()=>{if(!le.current)return;const e=setTimeout(()=>{gL.saveAll(oe).catch(e=>{console.error("[Workflows] Failed to save to backend:",e)})},500);return()=>clearTimeout(e)},[oe]),kt.useEffect(()=>{Le&&Ke.current&&Ke.current.focus()},[Le]),kt.useEffect(()=>{const e={leftPanelWidth:Rn,rightPanelWidth:In,canvasZoom:C,activeTab:g,activeSubTab:y};localStorage.setItem("storyboard-ui-state",JSON.stringify(e))},[Rn,In,C,g,y]),kt.useEffect(()=>{if(ie.current)return ie.current=!1,void console.log("[Effect] Skipping parameter reset (skipParameterReset was true)");const e=oe.find(e=>e.id===ce);if(e){console.log("[Effect] Workflow change detected, resetting parameters to defaults for workflow:",ce);const t={},n=Bt.current;e.config.forEach(e=>{if(e.exposed){("image_input"===e.category||"prompt"===e.name||"prompt"===e.input_name)&&void 0!==n[e.name]?t[e.name]=n[e.name]:t[e.name]=e.default}}),Bt.current=t,Ce(t)}},[ce]),kt.useEffect(()=>{var e;if(!Oe||!Le)return void st(null);const t=w.find(e=>e.id===Oe),n=null==t?void 0:t.imageHistory[(null==t?void 0:t.historyIndex)??0];if(!n)return void st(null);if((null==(e=n.metadata)?void 0:e.promptSummary)&&n.metadata.promptSummary.length>0)return void st(null);if(!n.url.includes("/api/serve-image"))return void st(null);const r=new URLSearchParams(n.url.split("?")[1]).get("path");if(!r)return void st(null);(async()=>{ct(!0);try{const e=ik.getProject().orchestratorUrl||nk(),t=await fetch(`${e}/api/png-metadata?path=${encodeURIComponent(r)}`);if(t.ok){const e=await t.json();e.success?st({prompt:e.prompt,workflow:e.workflow,parameters:e.parameters}):(console.warn("[PNG Metadata] Failed to extract:",e.error),st(null))}else console.warn("[PNG Metadata] Request failed:",t.status),st(null)}catch(e){console.error("[PNG Metadata] Error:",e),st(null)}finally{ct(!1)}})()},[Oe,Le,w]),kt.useEffect(()=>{if(!je||!Le)return rt(void 0),void at(void 0);(async()=>{try{const e=await fetch(je);if(e.ok){const t=await e.blob();at(t.size);const n=URL.createObjectURL(t),r=new Image;r.onload=()=>{rt({width:r.naturalWidth,height:r.naturalHeight}),URL.revokeObjectURL(n)},r.onerror=()=>{rt(void 0),URL.revokeObjectURL(n)},r.src=n}else at(void 0),rt(void 0)}catch{at(void 0),rt(void 0)}})()},[je,Le]);const zn=kt.useCallback(()=>{Ie(!1),ze(1),He({x:0,y:0}),Ge(!1),$e(null),tt(!1),dt("actual")},[]),Bn=kt.useCallback(e=>{if(!Oe)return;const t=w.find(e=>e.id===Oe);if(!t||t.imageHistory.length<=1)return;const n=Math.max(0,Math.min(t.imageHistory.length-1,t.historyIndex+e));if(n===t.historyIndex)return;const r=t.imageHistory[n];r&&(S(e=>e.map(e=>e.id===Oe?{...e,historyIndex:n,image:r.url}:e)),De(r.url),dt("actual"),He({x:0,y:0}))},[Oe,w]),Hn=kt.useCallback(()=>{dt("custom"),ze(e=>yL(1.25*e))},[]),Vn=kt.useCallback(()=>{dt("custom"),ze(e=>yL(e/1.25))},[]),Gn=kt.useCallback(()=>{if(dt("fit"),He({x:0,y:0}),nt&&ht.current){const e=ht.current,t=function(e,t,n,r,i=20){const a=(n-2*i)/e,o=(r-2*i)/t;return Math.min(a,o,1)}(nt.width,nt.height,e.clientWidth,e.clientHeight,Je?40:20);ze(t)}else ze(.8)},[nt,Je]),Wn=kt.useCallback(()=>{dt("actual"),ze(1),He({x:0,y:0})},[]),$n=kt.useCallback(()=>{if(!Oe)return;const e=w.find(e=>e.id===Oe);!e||e.imageHistory.length<=1||Ge(t=>{var n;const r=!t;return r&&e.historyIndex>0&&$e((null==(n=e.imageHistory[e.historyIndex-1])?void 0:n.url)||null),r})},[Oe,w]);kt.useEffect(()=>{if(!Ye.visible)return;const e=()=>Ze(e=>({...e,visible:!1})),t=e=>{"Escape"===e.key&&Ze(e=>({...e,visible:!1}))};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}},[Ye.visible]);const Xn=kt.useCallback(async e=>{var t;const n=w.find(t=>t.id===e);if(!n)return;const r=n.imageHistory[n.historyIndex],i=null==(t=null==r?void 0:r.metadata)?void 0:t.savedPath;if(i)try{const e="",t=await fetch(`${e}/api/open-explorer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:i})}),n=await t.json();n.success||d(n.message||"Failed to open explorer")}catch(a){d(`Failed to open explorer: ${a}`)}else d("Image has no saved path. Save the image first.")},[w,d]),qn=kt.useCallback(e=>{se(t=>t.map(t=>t.id===e.id?e:t)),en("info",`Updated categories for workflow: ${e.name}`)},[en]),Kn=kt.useCallback(()=>{const e={workflows:oe,exportedAt:(new Date).toISOString(),version:"1.0"},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`workflows_export_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),en("info",`Exported ${oe.length} workflows`)},[oe,en]),Yn=kt.useCallback(async e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){try{const e=await n.text(),t=JSON.parse(e);if(t.workflows&&Array.isArray(t.workflows)){const e=t.workflows.map((e,t)=>({...e,id:`imported_${Date.now()}_${t}`,name:e.name||`Imported Workflow ${t+1}`}));se(t=>[...t,...e]),en("info",`Successfully imported ${e.length} workflows from export file`),p(`Imported ${e.length} workflows`)}else{if(!t.nodes&&!Object.values(t).some(e=>e&&e.class_type))throw new Error("Invalid file format: not a bulk export or ComfyUI workflow");{const e=t;"nodes"in e&&Array.isArray(e.nodes)&&(h('This workflow is in Graph format. For best results, export from ComfyUI using "Save (API Format)" or "Export API". Graph format may have widget mapping issues.'),en("warning","Imported graph-format workflow - API format recommended"));const r=jC().parseWorkflow(e),i={id:`workflow_${Date.now()}`,name:n.name.replace(".json",""),description:"Imported from ComfyUI",category:g,subCategory:y,workflow:e,parsed:r,config:[]};i.config=r.parameters.map((e,t)=>({name:e.name,display_name:e.display_name,node_id:e.node_id,input_name:e.input_name,type:e.type,default:e.default,description:e.description,constraints:e.constraints,order:t,exposed:!0,category:"parameter",auto_detected:!0,user_modified:!1})),r.image_inputs.forEach((e,t)=>{i.config.push({name:e.name,display_name:e.display_name,node_id:e.node_id,input_name:e.input_name,type:"image",default:"",description:e.description,order:r.parameters.length+t,exposed:!0,category:"image_input",auto_detected:!0,user_modified:!1})}),se(e=>[...e,i]),ue(i.id),me(i),he(!0),en("info",`Imported single workflow: ${i.name}`),p(`Successfully imported workflow: ${i.name}`)}}}catch(r){console.error("Failed to import:",r),d("Failed to import: "+r.message)}e.target.value=""}},[oe,se,en,p,d,g,y,ue,me,he]),Zn=kt.useCallback(()=>{S(e=>{const t=Math.max(...e.map(e=>e.id),0)+1,n=e.length,r=Math.floor(n/3),i=n%3;return[...e,{id:t,name:`Panel_${String(t).padStart(2,"0")}`,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:320*i,y:320*r,width:300,height:300}]})},[]),Jn=kt.useCallback(e=>{if(1===e.button||0===e.button&&e.altKey)N(!0),L({x:e.clientX-k.x,y:e.clientY-k.y}),e.preventDefault();else if(0===e.button&&!e.ctrlKey&&!e.metaKey){const t=e.target;if(t.classList.contains("storyboard-canvas")||t.classList.contains("canvas-transform-container")){V(!0);const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left-k.x)/C,r=(e.clientY-t.top-k.y)/C;W({x:n,y:r}),X({x:n,y:r}),e.preventDefault()}}},[k,C]),Qn=kt.useCallback(e=>{if(H){const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left-k.x)/C,r=(e.clientY-t.top-k.y)/C;X({x:n,y:r})}},[H,k,C]),er=kt.useCallback(()=>{if(H){const e=Math.min(G.x,$.x),t=Math.max(G.x,$.x),n=Math.min(G.y,$.y),r=Math.max(G.y,$.y);if(t-e<5&&r-n<5)return S(e=>e.map(e=>({...e,selected:!1}))),void V(!1);S(i=>i.map(i=>{const a=i.x+i.width,o=i.y+i.height,s=!(a<e||i.x>t||o<n||i.y>r);return{...i,selected:s}})),V(!1)}},[H,G,$]),tr=kt.useCallback(e=>{A&&P({x:e.clientX-R.x,y:e.clientY-R.y})},[A,R]),nr=kt.useCallback(()=>{N(!1)},[]),rr=kt.useCallback(e=>{e.preventDefault();const t=re.current;if(!t)return;const n=t.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,a=(r-k.x)/C,o=(i-k.y)/C,s=e.deltaY>0?.9:1.1,l=Math.max(.1,Math.min(5,C*s)),c=r-a*l,u=i-o*l;T(l),P({x:c,y:u})},[C,k]);kt.useEffect(()=>{const e=re.current;if(e)return e.addEventListener("wheel",rr,{passive:!1}),()=>{e.removeEventListener("wheel",rr)}},[rr]);const ir=kt.useCallback(async(e,t)=>{var n;const r=w.find(t=>t.id===e),i=Bt.current,a=ce||(null==r?void 0:r.workflowId),o=oe.find(e=>e.id===a);if(r&&o)if(0!==t.length)try{en("comfyui",`Starting parallel generation on ${t.length} nodes for panel ${e}...`);const h=i,m=jC(),f={...h},g={};console.log("[Parallel] Processing parameter values:",Object.keys(h));for(const[e,n]of Object.entries(h))if("__BYPASSED__"!==n){if("string"==typeof n&&n.includes("/view?"))try{const r=new URL(n),i=r.searchParams.get("filename"),a=r.searchParams.get("subfolder")||"",o=r.searchParams.get("type")||"output";if(i){if("output"===o){console.log(`[Parallel] Image from output folder: ${i}, re-uploading to ALL nodes' input folders`),en("info",`Re-uploading ${i} from output to input folder on all ${t.length} nodes`);const r=Lt.filter(e=>t.includes(e.id)&&"online"===e.status);if(0===r.length){const e="Cannot re-upload image: no online render nodes";return en("error",e),void d(e)}try{const t=await fetch(n);if(t.ok){const n=await t.blob(),a=`storyboard_${Date.now()}_${i}`,o=new File([n],a,{type:n.type||"image/png"}),s=r.map(async e=>{const t=new FormData;t.append("image",o),t.append("overwrite","true");const n=await fetch(`${e.url}/upload/image`,{method:"POST",body:t});if(!n.ok)throw new Error(`Upload to ${e.id} failed with status ${n.status}`);return await n.json()}),l=(await Promise.all(s))[0].name;console.log(`[Parallel] Re-uploaded to ${r.length} nodes as ${l}`),en("info",`Re-uploaded to ${r.length} nodes as ${l}`),f[e]=l,g[e]=l;continue}en("warning","Image download failed, using original path")}catch(s){console.warn("[Parallel] Re-upload failed:",s),en("warning",`Re-upload failed: ${s}`)}const o=a?`${a}/${i}`:i;f[e]=o,g[e]=o;continue}{const t=a?`${a}/${i}`:i;en("info",`Using image path: ${t}`),f[e]=t,g[e]=t;continue}}}catch(l){console.warn("[Parallel] Failed to process ComfyUI URL:",n,l)}if("string"==typeof n&&n.startsWith("data:image")){console.log(`[Parallel] Image parameter ${e} has data URL, uploading to ALL nodes`),en("info",`Uploading data URL image for ${e} to all ${t.length} nodes`);const r=Lt.filter(e=>t.includes(e.id)&&"online"===e.status);if(0===r.length){const e="Cannot upload data URL image: no online render nodes";return en("error",e),void d(e)}try{const t=n.match(/^data:(image\/[^;]+);base64,(.+)$/);if(!t)throw new Error("Invalid data URL format");const i=t[1],a=t[2],o=atob(a),s=new Array(o.length);for(let e=0;e<o.length;e++)s[e]=o.charCodeAt(e);const l=new Uint8Array(s),c=new Blob([l],{type:i}),u=i.split("/")[1]||"png",d=`parallel_data_${Date.now()}_${e}.${u}`,h=new File([c],d,{type:i}),p=r.map(async e=>{const t=new FormData;t.append("image",h),t.append("overwrite","true");const n=await fetch(`${e.url}/upload/image`,{method:"POST",body:t});if(!n.ok)throw new Error(`Upload to ${e.id} failed with status ${n.status}`);return await n.json()}),m=(await Promise.all(p))[0].name;console.log(`[Parallel] Uploaded data URL to ${r.length} nodes as ${m}`),en("info",`Uploaded data URL to ${r.length} nodes as ${m}`),f[e]=m,g[e]=m;continue}catch(s){const t=`Failed to upload data URL for ${e}: ${s}`;return console.error("[Parallel] Upload error:",s),en("error",t),void d(t)}}}else en("info",`Image input ${e} is bypassed`),g[e]="__BYPASSED__",delete f[e];if(Ne&&Pe.trim())for(const e of Object.keys(f))(e.toLowerCase().includes("prompt")||"text"===e||"positive"===e)&&(f[e]=Pe);const v=m.parseWorkflow(o.workflow),y={},_={},x=new Set(v.loras.map(e=>e.name));for(const[e,t]of Object.entries(f))x.has(e)?"object"==typeof t&&null!==t?y[e]={strength:t.strength??1,bypassed:t.bypassed??!1,lora_name:t.lora_name,enabled:!t.bypassed}:"number"==typeof t&&(y[e]={strength:t,enabled:!0}):_[e]=t;const b=m.buildWorkflow(o.workflow,_,g,y,o.config);console.log("[Parallel] Base workflow built:",JSON.stringify(b,null,2)),en("info",`Base workflow nodes: ${Object.keys(b).length}`);const w=(e,t)=>{var n,r;for(const i of Object.keys(e)){const a=e[i];((null==(n=a.class_type)?void 0:n.includes("Sampler"))||(null==(r=a.class_type)?void 0:r.includes("KSampler")))&&(a.inputs&&"seed"in a.inputs&&(a.inputs.seed=t),a.inputs&&"noise_seed"in a.inputs&&(a.inputs.noise_seed=t)),"RandomNoise"===a.class_type&&a.inputs&&"noise_seed"in a.inputs&&(a.inputs.noise_seed=t)}},M=[],E=t.map(e=>{const t=Lt.find(t=>t.id===e);return{nodeId:e,nodeName:(null==t?void 0:t.name)||e,promptId:"",seed:0,progress:0,status:"pending"}}),C=(null==(n=null==r?void 0:r.imageHistory)?void 0:n.length)||0;Ut.current.set(e,C+1),S(t=>t.map(t=>t.id===e?{...t,status:"generating",progress:0,parameterValues:{...h},workflowId:a||void 0,parallelJobs:E}:t)),ae.current.set(e,Date.now()),jt.current.delete(String(e)),Dt.current.clear();for(let n=0;n<t.length;n++){const r=t[n],i=Lt.find(e=>e.id===r);if(!i||"online"!==i.status){en("warning",`Skipping offline node: ${(null==i?void 0:i.name)||r}`),S(t=>t.map(t=>t.id===e&&t.parallelJobs?{...t,parallelJobs:t.parallelJobs.map(e=>e.nodeId===r?{...e,status:"error"}:e)}:t));continue}const a=JSON.parse(JSON.stringify(b)),o=Math.floor(2147483647*Math.random());w(a,o),console.log(`[Parallel] Submitting to node ${i.name} with seed ${o}`),en("comfyui",`Submitting variation ${n+1}/${t.length} to ${i.name} (seed: ${o})`);try{const t=`storyboard-parallel-${e}-${n}-${Date.now()}`,s=VC(i.url,t);try{await s.connect()}catch(c){en("warning",`WebSocket to ${i.name} failed, will use polling`)}const u=await fetch(`${i.url}/prompt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:a,client_id:t})});if(!u.ok){let e=`HTTP ${u.status}`;try{const t=await u.json();console.error("ComfyUI error response:",t),t.error&&(e="string"==typeof t.error?t.error:JSON.stringify(t.error))}catch(l){}throw new Error(e)}const d=await u.json();en("comfyui",`Queued on ${i.name}: ${d.prompt_id}`),S(t=>t.map(t=>t.id===e&&t.parallelJobs?{...t,parallelJobs:t.parallelJobs.map(e=>e.nodeId===r?{...e,promptId:d.prompt_id,seed:o,status:"running"}:e)}:t)),M.push({nodeId:r,nodeName:i.name,promptId:d.prompt_id,seed:o}),s.connected?cr(d.prompt_id,e,r,i.url,s):ur(d.prompt_id,e,r,i.url)}catch(u){const t=`Failed to submit to ${i.name}: ${u}`;en("error",t),d(t),S(t=>t.map(t=>t.id===e&&t.parallelJobs?{...t,parallelJobs:t.parallelJobs.map(e=>e.nodeId===r?{...e,status:"error"}:e)}:t))}}if(0===M.length)return d("Failed to submit to any nodes"),void S(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t));p(`Started parallel generation on ${M.length} node(s)`)}catch(u){const t=`Parallel generation failed: ${u.message||String(u)}`;en("error",t),d(t),S(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t))}else d("No render nodes selected for parallel generation");else d("Panel or workflow not found")},[w,oe,ce,Ee,Ne,Pe,Lt,en,d,p,M]),ar=kt.useCallback(async e=>{var t,n;if(tn.length>1)return void(await ir(e,tn));const r=w.find(t=>t.id===e);let i="",a="";if(1===tn.length){const e=Lt.find(e=>e.id===tn[0]);e&&"online"===e.status&&(i=e.url,a=e.name)}if(!i&&(null==r?void 0:r.nodeId)){const e=Lt.find(e=>e.id===r.nodeId);e&&"online"===e.status&&(i=e.url,a=e.name)}if(!i){const e=Lt.filter(e=>"online"===e.status);if(e.length>0){const t=e[0];i=t.url,a=t.name}}if(!i&&pt&&"connected"===ft&&(i=pt,a="Direct Connection"),!i){const e="No render nodes available. Add nodes in Manage Nodes or connect via URL.";return en("error",e),void d(e)}try{if(!(await fetch(`${i}/system_stats`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)throw new Error(`Node ${a} is not responding`)}catch(_){const e=`Cannot connect to ${a}: ${_}`;return en("error",e),void d(e)}const o=Bt.current,s=ce||(null==r?void 0:r.workflowId),l=oe.find(e=>e.id===s);if(!l)return void en("warning","No workflow selected");const c=o;S(t=>t.map(t=>t.id===e?{...t,status:"generating",progress:0,parameterValues:{...c},workflowId:s||void 0,parallelJobs:void 0}:t)),ae.current.set(e,Date.now()),en("comfyui",`Starting generation for panel ${e} on ${a}...`),console.log("[Generation] ==== GENERATION START ===="),console.log("[Generation] Panel ID:",e),console.log("[Generation] Using parameters from UI ref (always)"),console.log("[Generation] paramsToUse:",JSON.stringify(c,null,2)),console.log("[Generation] Seed:",c.seed),console.log("[Generation] Prompt preview:",(null==(t=c.positive_prompt)?void 0:t.substring(0,50))||(null==(n=c.prompt)?void 0:n.substring(0,50)));const u={...c},h={};console.log("[Generation] Processing parameter values for panel:",e,Object.keys(c));for(const[w,E]of Object.entries(c))if("__BYPASSED__"!==E){if("string"==typeof E&&E.includes("/view?"))try{const e=new URL(E),t=e.searchParams.get("filename"),n=e.searchParams.get("subfolder")||"",r=e.searchParams.get("type")||"output";if(t){if("output"===r){console.log(`[Generation] Downloading ${t} from output to re-upload to input`),en("info",`Downloading ${t} from output folder for re-upload`);const e=await fetch(E);if(e.ok){const n=await e.blob(),r=`storyboard_${Date.now()}_${t}`,a=new File([n],r,{type:n.type||"image/png"}),o=new FormData;o.append("image",a),o.append("overwrite","true");const s=await fetch(`${i}/upload/image`,{method:"POST",body:o});if(s.ok){const e=await s.json();console.log(`[Generation] Re-uploaded ${t} as ${e.name}`),en("info",`Re-uploaded ${t} as ${e.name}`),u[w]=e.name,h[w]=e.name;continue}console.error("[Generation] Failed to upload image:",await s.text()),en("error",`Failed to upload image ${t}: HTTP ${s.status}`)}else console.error("[Generation] Failed to download image from view URL"),en("error",`Failed to download image ${t} from output folder`);const r=n?`${n}/${t}`:t;console.log(`[Generation] Falling back to original path: ${r}`),en("warning",`Re-upload failed, falling back to: ${r}`),u[w]=r,h[w]=r;continue}{const e=n?`${n}/${t}`:t;en("info",`Using image path from ComfyUI URL: ${e}`),console.log(`[Generation] ${w} using image path: ${e}`),u[w]=e,h[w]=e;continue}}}catch(x){console.warn("[Generation] Failed to process ComfyUI URL:",E,x)}if("string"==typeof E&&E.startsWith("data:image")){console.log(`[Generation] ${w} is a data:image URL, uploading...`);try{en("info",`Uploading image for parameter: ${w}`);const e=await fetch(E),t=await e.blob(),n=`storyboard_${Date.now()}_${w}.png`,r=new File([t],n,{type:t.type}),a=new FormData;a.append("image",r),a.append("overwrite","true");const o=await fetch(`${i}/upload/image`,{method:"POST",body:a});if(!o.ok)throw new Error(`Upload failed: HTTP ${o.status}`);const s=(await o.json()).name;en("info",`Image uploaded as: ${s}`),console.log(`[Generation] ${w} uploaded as: ${s}`),u[w]=s,h[w]=s}catch(b){const t=`Failed to upload image ${w}: ${b}`;return en("error",t),d(t),void S(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t))}}else console.log(`[Generation] ${w} is not an image (type: ${typeof E}, startsWith data:image: ${"string"==typeof E?E.startsWith("data:image"):"N/A"})`)}else en("info",`Image input ${w} is bypassed, will skip in workflow`),console.log(`[Generation] ${w} is BYPASSED`),h[w]="__BYPASSED__",delete u[w];if(console.log("[Generation] Final imageInputs:",h),console.log("[Generation] Final processedParams keys:",Object.keys(u)),Ne&&Pe.trim())for(const d of Object.keys(u))(d.toLowerCase().includes("prompt")||"text"===d||"positive"===d)&&(u[d]=Pe,en("info",`Applied global prompt override to: ${d}`));const p=jC(),m=p.parseWorkflow(l.workflow),f={},g={},v=new Set(m.loras.map(e=>e.name));for(const[d,w]of Object.entries(u))v.has(d)?"object"==typeof w&&null!==w?f[d]={strength:w.strength??1,bypassed:w.bypassed??!1,lora_name:w.lora_name,enabled:!w.bypassed}:"number"==typeof w&&(f[d]={strength:w,enabled:!0}):g[d]=w;console.log("Parameters being applied:",g),console.log("LoRA values being applied:",f),console.log("Parsed workflow parameters:",m.parameters),console.log("Custom param configs:",l.config);const y=p.buildWorkflow(l.workflow,g,h,f,l.config);console.log("Workflow being sent to ComfyUI:",JSON.stringify(y,null,2)),en("info",`Workflow nodes: ${Object.keys(y).length}`);try{const t=`storyboard-panel-${e}-${Date.now()}`,n=VC(i,t);try{await n.connect()}catch(M){en("warning",`WebSocket to ${i} failed, will use polling`)}const r=await fetch(`${i}/prompt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:y,client_id:t})});if(!r.ok){let e=`HTTP ${r.status}`;try{const t=await r.json();console.error("ComfyUI error response:",t),t.error&&(e="string"==typeof t.error?t.error:JSON.stringify(t.error)),t.node_errors&&(console.error("Node errors:",t.node_errors),e+=` | Node errors: ${JSON.stringify(t.node_errors)}`)}catch(x){}throw new Error(e)}const o=await r.json();en("comfyui",`Queued prompt: ${o.prompt_id} on ${a}`),n.connected?sr(o.prompt_id,e,i,n):(en("warning","WebSocket not connected, falling back to polling"),or(o.prompt_id,e,i))}catch(_){const t=`Failed to queue generation: ${_}`;en("error",t),d(t),S(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t))}},[ft,oe,ce,Ee,pt,en,d,w,Lt,M]),or=kt.useCallback(async(e,t,n)=>{const r=`${t}-${e}`;Ft.current.forEach(e=>{e.startsWith(`${t}-`)&&Ft.current.delete(e)}),Ft.current.add(r);let i=0;const a=async()=>{var o;if(Ft.current.has(r)){if(i>=600)return en("error",`Generation timeout for panel ${t}`),S(e=>e.map(e=>e.id===t?{...e,status:"error",progress:0}:e)),void Ft.current.delete(r);i++;try{const s=await fetch(`${n}/history/${e}`);if(s.ok){const i=await s.json();if(i[e]){const a=i[e].outputs,o=[];for(const e in a){const t=a[e];if(t.images&&t.images.length>0)for(const e of t.images){const t=`${n}/view?filename=${encodeURIComponent(e.filename)}&subfolder=${encodeURIComponent(e.subfolder||"")}&type=${e.type||"output"}`;o.push(t)}}if(o.length>0){en("comfyui",`Generation complete for panel ${t} (polling): ${o.length} image(s)`),Ft.current.delete(r);const e=ik.getProject();if(e.autoSave&&e.path){en("info",`Auto-saving ${o.length} image(s) to ${e.path}...`);const n=ae.current.get(t),r=n?(Date.now()-n)/1e3:void 0;(async()=>{try{const e=await new Promise(e=>{S(n=>{const r=n.find(e=>e.id===t);return e((null==r?void 0:r.name)||`Panel_${String(t).padStart(2,"0")}`),n})}),n=await ik.getNextVersion(e,[]);en("info",`Starting from version ${n}`);for(let i=0;i<o.length;i++){const a=o[i],s=n+i,l=await new Promise(e=>{S(n=>{const r=n.find(e=>e.id===t);return e((null==r?void 0:r.workflowId)||""),n})}),c=await new Promise(e=>{S(n=>{const r=n.find(e=>e.id===t);return e((null==r?void 0:r.parameterValues)||{}),n})}),u=ik.createHistoryEntry(a,t,s,l,l||"Unknown",{},c,r);en("info",`Saving v${s} from URL: ${a}`);const d=await ik.saveToProjectFolder(a,t,s,u.metadata,e);d.success?(en("info",`Saved: ${d.savedPath}`),S(e=>e.map(e=>{if(e.id!==t)return e;const n=e.imageHistory.map(e=>e.url!==a||e.metadata.savedPath?e:{...e,metadata:{...e.metadata,savedPath:d.savedPath}});return{...e,imageHistory:n}}))):en("error",`Auto-save failed for v${s}: ${d.error}`)}}catch(e){en("error",`Auto-save exception: ${e}`)}})()}else e.autoSave&&!e.path?en("warning","Auto-save enabled but no project folder configured"):e.autoSave||en("info","Auto-save is disabled. Enable it in Project Settings to save images automatically.");const n=ae.current.get(t),i=n?(Date.now()-n)/1e3:void 0;return ae.current.delete(t),void S(e=>{var n;const r=e.find(e=>e.id===t),a=(null==(n=null==r?void 0:r.imageHistory)?void 0:n.length)||0,s=o.map((e,n)=>ik.createHistoryEntry(e,t,a+n+1,(null==r?void 0:r.workflowId)||"","Unknown",{},(null==r?void 0:r.parameterValues)||{},i));return e.map(e=>{if(e.id!==t)return e;const n=[...e.imageHistory,...s];return{...e,status:"complete",progress:100,image:o[o.length-1],images:o,currentImageIndex:0,imageHistory:n,historyIndex:n.length-1}})})}}}const l=await fetch(`${n}/queue`);if(l.ok){const n=await l.json();(null==(o=n.queue_running)?void 0:o.find(t=>t[1]===e))&&S(e=>e.map(e=>e.id===t?{...e,progress:Math.min(i/100*100,90)}:e))}Ft.current.has(r)&&setTimeout(a,1e3)}catch(s){en("error",`Error polling for result: ${s}`),Ft.current.has(r)&&setTimeout(a,1e3)}}};a()},[en]),sr=kt.useCallback((e,t,n,r)=>{const i=r||It.current;i?i.trackPrompt(e,t,e=>{const n=Math.round(e.value/e.max*100);en("info",`Progress: ${n}% (${e.value}/${e.max})`),S(e=>e.map(e=>e.id===t?{...e,progress:n}:e))},async(r,i)=>{var a;en("comfyui",`Generation complete for panel ${t}`);const o=ik.getProject(),s=w.find(e=>e.id===t);if((null==s?void 0:s.parallelJobs)&&s.parallelJobs.length>0)en("comfyui","Skipping single-node save - panel has parallel jobs, handled by parallel tracker");else{try{const r=await fetch(`${n}/history/${e}`);if(r.ok){const i=(await r.json())[e];if(null==i?void 0:i.outputs){const e=(null==(a=null==mr?void 0:mr.parsed.outputs)?void 0:a.filter(e=>e.selected).map(e=>e.node_id))||[],r=0===e.length,s=[],l={};for(const t of Object.keys(i.outputs)){if(!r&&!e.includes(t)){en("comfyui",`Skipping node ${t} (not selected)`);continue}const a=i.outputs[t];if(a.images&&a.images.length>0){const e=a.images.map(e=>`${n}/view?filename=${encodeURIComponent(e.filename)}&subfolder=${encodeURIComponent(e.subfolder||"")}&type=${e.type||"output"}`);s.push(...e),l[t]=e,en("comfyui",`Node ${t} produced ${e.length} image(s)`)}}if(s.length>0){if(en("comfyui",`Total: ${s.length} images from ${Object.keys(l).length} output node(s)`),o.autoSave&&o.path){en("info",`Auto-saving ${s.length} image(s) to ${o.path}...`);const e=ae.current.get(t),n=e?(Date.now()-e)/1e3:void 0,r=[...w];(async()=>{try{const e=r.find(e=>e.id===t),i=(null==e?void 0:e.imageHistory)||[],a=(null==e?void 0:e.name)||`Panel_${String(t).padStart(2,"0")}`,o=await ik.getNextVersion(a,i);en("info",`Starting from version ${o}`);for(let r=0;r<s.length;r++){const e=s[r],i=o+r,l=ik.createHistoryEntry(e,t,i,ce||"",(null==mr?void 0:mr.name)||"Unknown",(null==mr?void 0:mr.workflow)||{},Ee,n);en("info",`Saving v${i} from URL: ${e}`);const c=await ik.saveToProjectFolder(e,t,i,l.metadata,a);c.success?(en("info",`Saved: ${c.savedPath}`),S(n=>n.map(n=>{if(n.id!==t)return n;const r=n.imageHistory.map(t=>t.url!==e||t.metadata.savedPath?t:{...t,metadata:{...t.metadata,savedPath:c.savedPath}});return{...n,imageHistory:r}}))):en("error",`Auto-save failed for v${i}: ${c.error}`)}}catch(e){en("error",`Auto-save exception: ${e}`)}})()}else o.autoSave&&!o.path?en("warning","Auto-save enabled but no project folder configured"):o.autoSave||en("info","Auto-save is disabled. Enable it in Project Settings to save images automatically.");const e=ae.current.get(t),n=e?(Date.now()-e)/1e3:void 0;return ae.current.delete(t),console.log("[Generation] Panel",t,"took",null==n?void 0:n.toFixed(1),"seconds"),void S(e=>{var r;const i=e.find(e=>e.id===t),a=(null==(r=null==i?void 0:i.imageHistory)?void 0:r.length)||0,o=s.map((e,r)=>ik.createHistoryEntry(e,t,a+r+1,(null==i?void 0:i.workflowId)||ce||"",(null==mr?void 0:mr.name)||"Unknown",(null==mr?void 0:mr.workflow)||{},(null==i?void 0:i.parameterValues)||Ee,n));return e.map(e=>{if(e.id!==t)return e;const n=[...e.imageHistory,...o];return{...e,status:"complete",progress:100,image:s[s.length-1],images:s,currentImageIndex:0,imageHistory:n,historyIndex:n.length-1}})})}}}}catch(l){en("error",`Error fetching result: ${l}`)}S(e=>e.map(e=>e.id===t?{...e,status:"error",progress:0}:e))}},(e,n)=>{const r=`Generation failed: ${n}`;en("error",r),d(r),S(e=>e.map(e=>e.id===t?{...e,status:"error",progress:0}:e))}):or(e,t,n)},[en,d,or,w]),lr=kt.useCallback(async(e,t)=>{const n=w.find(t=>t.id===e);if(!n||!t.resultUrl)return;const r=`${e}-${t.nodeId}-${t.seed}`;if(Dt.current.has(r))console.log(`[Parallel] Job ${r} already saved, skipping duplicate`);else{Dt.current.add(r),console.log(`[Parallel] Saving individual result from ${t.nodeName}`),en("info",`Saving result from ${t.nodeName}...`);try{const r=oe.find(e=>e.id===(n.workflowId||ce)),i=ae.current.get(e),a=i?(Date.now()-i)/1e3:void 0,o={...n.parameterValues||Ee,seed:t.seed},s=n.imageHistory||[],l=(null==n?void 0:n.name)||`Panel_${String(e).padStart(2,"0")}`,c=await ik.getNextVersion(l,s),u=ik.createHistoryEntry(t.resultUrl,e,c,n.workflowId||ce||"",(null==r?void 0:r.name)||"Unknown",(null==r?void 0:r.workflow)||{},o,a);u.metadata.nodeName=t.nodeName,S(n=>n.map(n=>{var r;if(n.id!==e)return n;const i=[...n.imageHistory||[],u],a=(null==(r=n.parallelJobs)?void 0:r.map(e=>e.nodeId===t.nodeId?{...e,status:"complete",progress:100}:e))||[],o=a.every(e=>"complete"===e.status||"error"===e.status||"cancelled"===e.status),s=a.some(e=>"error"===e.status);return{...n,image:u.url,imageHistory:i,historyIndex:i.length-1,parallelJobs:a,status:o?s?"error":"complete":"generating"}})),en("info",` Result from ${t.nodeName} saved to history (v${c})`);const d=ik.getProject();if(d.autoSave&&d.path){en("info",`Auto-saving ${t.nodeName} result to folder...`);const n=await ik.saveToProjectFolder(t.resultUrl,e,c,u.metadata,l);n.success?(en("info",` Saved: ${n.savedPath}`),S(t=>t.map(t=>{if(t.id!==e)return t;const r=t.imageHistory.map(e=>e.id===u.id?{...e,metadata:{...e.metadata,savedPath:n.savedPath}}:e);return{...t,imageHistory:r}}))):en("error",` Save failed for ${t.nodeName}: ${n.error}`)}else d.autoSave&&!d.path&&en("warning","Auto-save enabled but no project folder configured")}catch(i){console.error(`[Parallel] Failed to save result from ${t.nodeName}:`,i),en("error",`Failed to save result from ${t.nodeName}: ${i}`)}}},[w,oe,ce,Ee,en,ik]),cr=kt.useCallback((e,t,n,r,i)=>{i.trackPrompt(e,t,e=>{const r=Math.round(e.value/e.max*100);S(e=>e.map(e=>{if(e.id!==t||!e.parallelJobs)return e;const i=e.parallelJobs.map(e=>e.nodeId===n?{...e,progress:r}:e),a=Math.round(i.reduce((e,t)=>e+t.progress,0)/i.length);return{...e,parallelJobs:i,progress:a}}))},async(i,a)=>{en("comfyui",`Parallel job complete on node ${n} for panel ${t}`);try{const i=await fetch(`${r}/history/${e}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const a=(await i.json())[e];if(null==a?void 0:a.outputs){let e;for(const t of Object.keys(a.outputs)){const n=a.outputs[t];if(n.images&&n.images.length>0){const t=n.images[0];e=`${r}/view?filename=${encodeURIComponent(t.filename)}&subfolder=${encodeURIComponent(t.subfolder||"")}&type=${t.type||"output"}`;break}}e&&S(r=>r.map(r=>{if(r.id!==t||!r.parallelJobs)return r;const i=r.parallelJobs.map(t=>t.nodeId===n?{...t,status:"complete",progress:100,resultUrl:e}:t),a=i.find(e=>e.nodeId===n);a&&a.resultUrl&&setTimeout(()=>{lr(t,{nodeId:a.nodeId,nodeName:a.nodeName,resultUrl:a.resultUrl,seed:a.seed})},0);if(i.every(e=>"complete"===e.status||"error"===e.status||"cancelled"===e.status)){const e=i.filter(e=>"complete"===e.status).length;return en("info",`All parallel jobs finished! ${e} successful, ${i.length-e} failed`),{...r,parallelJobs:i,status:e>0?"complete":"error",batchSaveTriggered:!0}}return{...r,parallelJobs:i}}))}}catch(o){en("error",`Error fetching parallel result: ${o}`),S(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"error"}:e)}:e))}},(e,r)=>{en("error",`Parallel job failed on node ${n}: ${r}`),S(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"error"}:e)}:e))})},[en,lr]),ur=kt.useCallback(async(e,t,n,r)=>{let i=0;const a=async()=>{var o;if(i>=600)return en("error",`Parallel job timeout on node ${n}`),void S(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"error"}:e)}:e));i++;try{const s=await fetch(`${r}/history/${e}`);if(s.ok){const i=await s.json();if(null==(o=i[e])?void 0:o.outputs){let a;for(const t of Object.keys(i[e].outputs)){const n=i[e].outputs[t];if(n.images&&n.images.length>0){const e=n.images[0];a=`${r}/view?filename=${encodeURIComponent(e.filename)}&subfolder=${encodeURIComponent(e.subfolder||"")}&type=${e.type||"output"}`;break}}if(a)return void S(e=>e.map(e=>{if(e.id!==t||!e.parallelJobs)return e;const r=e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"complete",progress:100,resultUrl:a}:e),i=r.find(e=>e.nodeId===n);i&&i.resultUrl&&setTimeout(()=>{lr(t,{nodeId:i.nodeId,nodeName:i.nodeName,resultUrl:i.resultUrl,seed:i.seed})},0);if(r.every(e=>"complete"===e.status||"error"===e.status||"cancelled"===e.status)){const t=r.filter(e=>"complete"===e.status).length;return en("info",`All parallel jobs finished! ${t} successful, ${r.length-t} failed`),{...e,parallelJobs:r,status:t>0?"complete":"error",batchSaveTriggered:!0}}return{...e,parallelJobs:r}}))}}const l=Math.min(i/100*100,90);S(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,progress:l}:e)}:e)),setTimeout(a,1e3)}catch(s){en("error",`Error polling parallel result: ${s}`),setTimeout(a,1e3)}};a()},[en,lr]),dr=kt.useCallback((e,t)=>{console.log("[handleParameterChange] Called with:",e,"=","string"==typeof t?t.substring(0,50):t);const n={...Bt.current,[e]:t};Bt.current=n,console.log("[handleParameterChange] Updated ref BEFORE setter, keys:",Object.keys(n)),Ce(n),M&&S(e=>e.map(e=>e.id===M?{...e,parameterValues:n}:e))},[M]),hr=kt.useCallback((e,t)=>{ke(n=>({...n,[e]:t}))},[]),pr=kt.useCallback(async e=>{const t=og();if(!t)throw new Error("No LLM provider configured. Please configure in Settings.");const{provider:n,model:r}=t,i=hg().find(e=>e.providerId===n);if(!i)throw new Error("Selected provider not found. Please configure in Settings.");try{const t=await Hf.enhancePrompt({userPrompt:e.trim(),llmProvider:n,llmModel:r,targetModel:"flux",projectType:"live_action",config:{},credentials:{apiKey:i.credentials.apiKey,endpoint:i.credentials.endpoint,oauthToken:i.credentials.oauthToken}});if(t.success)return p("Prompt enhanced successfully"),t.enhanced_prompt;throw new Error(t.error||"Enhancement failed")}catch(a){const e=a instanceof Error?a.message:"Failed to enhance prompt";throw d(e),a}},[p,d]),mr=oe.find(e=>e.id===ce),fr=(null==mr?void 0:mr.config.filter(e=>e.exposed))||[],gr=async()=>{const e=await ik.saveProjectState(w,void 0,Ee,{selectedWorkflowId:ce||void 0,renderNodes:Lt,comfyUrl:pt,cameraAngles:Te});e.success?p(`Project saved to ${e.savedPath}`):d(`Failed to save project: ${e.error}`)},vr=()=>{Sn("save")},yr=()=>{Sn("open")},_r=(e,t)=>{var n;const r=w.find(t=>t.id===e);if(!r)return;const i=r.imageHistory.find(e=>e.id===t);if(!i)return console.error("[Delete] Entry not found:",t),void d("Cannot delete: image entry not found");const a=(null==(n=null==i?void 0:i.metadata)?void 0:n.savedPath)?xL(i.metadata.savedPath):xL(i.url)||"image";gn?xr(e,t):fn({isOpen:!0,panelId:e,entryId:t,filename:a})},xr=async(e,t)=>{var n;const r=w.find(t=>t.id===e);if(!r)return;const i=r.imageHistory.findIndex(e=>e.id===t);if(-1===i)return console.error("[Delete] Entry not found:",t),void d("Cannot delete: image entry not found");const a=r.imageHistory[i],o=null==(n=null==a?void 0:a.metadata)?void 0:n.savedPath;let s=!0;if(o){console.log("[Delete] Attempting to delete:",o);const e=await ik.deleteImage(o);console.log("[Delete] Result:",e),e.success?(cn(e=>new Set([...e,o])),p(`Deleted: ${xL(o)}`)):(console.error("[Delete] Failed:",e.error),d(`Delete failed: ${e.error||"Unknown error"}`),s=!1)}else console.warn("[Delete] No savedPath in entry metadata - removing from UI only:",null==a?void 0:a.metadata);s&&S(n=>n.map(n=>{var r;if(n.id!==e)return n;const i=n.imageHistory.findIndex(e=>e.id===t);if(-1===i)return n;const a=[...n.imageHistory];a.splice(i,1);let o=n.historyIndex;return i<=n.historyIndex&&(o=Math.max(0,n.historyIndex-1)),0===a.length&&(o=-1),{...n,imageHistory:a,historyIndex:o,image:a.length>0?null==(r=a[o])?void 0:r.url:null,status:a.length>0?"complete":"empty"}}))},br=async()=>{const e=Lt.some(e=>"busy"===e.status),t=w.some(e=>"generating"===e.status);if(e||t){p("Cancelling all running generations...");try{const e=(await GC.cancelAllGenerations()).filter(e=>e.success).length;e>0?p(`Cancelled ${e} generation(s)`):d("Failed to cancel generations"),S(e=>e.map(e=>"generating"===e.status?{...e,status:"error",error:"Cancelled by user"}:e))}catch(n){d(`Error cancelling generations: ${n instanceof Error?n.message:"Unknown error"}`),console.error("[Cancel] Error:",n)}}else p("No generations are currently running")},wr=kt.useCallback(async()=>{if(w.some(e=>e.image||e.images.length>0||""!==e.notes.trim())){window.confirm("You have unsaved work. Would you like to save before creating a new project?\n\nClick OK to save first, or Cancel to discard changes.")&&await gr()}const e=Array.from({length:6},(e,t)=>({id:t+1,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,x:t%3*320,y:320*Math.floor(t/3),width:300,height:300,status:"empty",progress:0,notes:"",nodeId:void 0,workflowId:void 0,parameterValues:void 0,prompt:"",seed:-1}));S(e),Ce({}),Bt.current={},ue(null);const t={name:"Untitled Project",path:"",namingTemplate:"{project}_Panel{panel}_{version}",autoSave:!0,orchestratorUrl:on.orchestratorUrl,created:new Date,lastModified:new Date};sn(t),ik.setProject(t),an(!0)},[w,gr,on.orchestratorUrl]);return kt.useEffect(()=>{const e=e=>{const t=e.target;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&"SELECT"!==t.tagName)return!e.ctrlKey&&!e.metaKey||!e.shiftKey||"S"!==e.key&&"s"!==e.key?(e.ctrlKey||e.metaKey)&&"n"===e.key?(e.preventDefault(),void wr()):!e.ctrlKey&&!e.metaKey||e.shiftKey||"s"!==e.key?(e.ctrlKey||e.metaKey)&&"o"===e.key?(e.preventDefault(),void yr()):(e.ctrlKey||e.metaKey)&&","===e.key?(e.preventDefault(),void an(!0)):(e.ctrlKey||e.metaKey)&&"p"===e.key?(e.preventDefault(),void xe(!0)):void 0:(e.preventDefault(),void gr()):(e.preventDefault(),void vr())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[wr,gr,vr,yr]),Ot.jsxs("div",{className:"storyboard-ui",children:[un&&Ot.jsx("div",{className:"loading-overlay",children:Ot.jsxs("div",{className:"loading-modal",children:[Ot.jsx("h3",{children:"Loading Project..."}),Ot.jsx("div",{className:"progress-bar",children:Ot.jsx("div",{className:"progress-fill",style:{width:`${hn.progress}%`}})}),Ot.jsxs("p",{className:"progress-text",children:[Math.round(hn.progress),"%"]}),Ot.jsx("p",{className:"current-file",children:hn.currentFile})]})}),Ot.jsxs("div",{className:"storyboard-top-bar",children:[Ot.jsx(JT,{projectName:on.name||"Untitled Project",nodeCount:Lt.length,onProjectSettings:()=>an(!0),onSaveProject:gr,onSaveProjectAs:vr,onLoadProject:yr,onNewProject:wr,onManageNodes:()=>At(!0),onRestartNodes:async()=>{if(0!==Lt.length){Rt(!0),p("Restarting all ComfyUI backends...");try{const e=await GC.restartAllBackends(),t=e.filter(e=>e.success).length,n=e.length-t;0===n?p(`Successfully restarted ${t} backend(s)`):0===t?d(`Failed to restart all ${n} backend(s). Check the console for details.`):p(`Restarted ${t} backend(s), ${n} failed. Check the console for details.`),e.forEach(e=>{e.success?console.log(`[Restart] ${e.backendId}: ${e.message}`):console.error(`[Restart] ${e.backendId}: ${e.message}`)})}catch(e){d(`Error restarting nodes: ${e instanceof Error?e.message:"Unknown error"}`),console.error("[Restart] Error:",e)}finally{Rt(!1)}}else d("No render nodes available to restart.")},onCancelGenerations:br,onPrintStoryboard:()=>xe(!0),isRestarting:Nt,isGenerating:w.some(e=>"generating"===e.status)||Lt.some(e=>"busy"===e.status)}),Ot.jsx("div",{className:"workflow-dropdown-bar",children:Ot.jsxs("select",{value:ce||"",onChange:e=>ue(e.target.value),className:"workflow-select",children:[Ot.jsx("option",{value:"",children:"Select workflow..."}),oe.filter(e=>{var t;const n=e.category===g&&e.subCategory===y,r=ML[y],i=r&&(null==(t=e.categories)?void 0:t.includes(r));return n||i}).map(e=>Ot.jsx("option",{value:e.id,children:e.name},e.id))]})}),Ot.jsxs("div",{className:"storyboard-tabs",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"tab-with-dropdown",children:[Ot.jsxs("button",{className:"storyboard-tab "+("image-generation"===g?"active":""),onClick:()=>b("image-generation"===x?null:"image-generation"),children:["Image Generation ",Ot.jsx(QC,{size:14,style:{marginLeft:4,opacity:.7}})]}),"image-generation"===x&&Ot.jsxs("div",{className:"tab-dropdown",children:[Ot.jsx("button",{className:"text2img"===y?"active":"",onClick:()=>{v("image-generation"),_("text2img"),b(null)},children:"Text to Image"}),Ot.jsx("button",{className:"img2img"===y?"active":"",onClick:()=>{v("image-generation"),_("img2img"),b(null)},children:"Image to Image"}),Ot.jsx("button",{className:"inpainting"===y?"active":"",onClick:()=>{v("image-generation"),_("inpainting"),b(null)},children:"Inpainting"})]})]}),Ot.jsx("button",{className:"storyboard-tab "+("image-editing"===g?"active":""),onClick:()=>{v("image-editing"),_("editing"),b(null)},children:"Image Editing"}),Ot.jsx("button",{className:"storyboard-tab "+("upscaling"===g?"active":""),onClick:()=>{v("upscaling"),_("upscale"),b(null)},children:"Upscaling"}),Ot.jsxs("div",{className:"tab-with-dropdown",children:[Ot.jsxs("button",{className:"storyboard-tab "+("video-generation"===g?"active":""),onClick:()=>b("video-generation"===x?null:"video-generation"),children:["Video Generation ",Ot.jsx(QC,{size:14,style:{marginLeft:4,opacity:.7}})]}),"video-generation"===x&&Ot.jsxs("div",{className:"tab-dropdown",children:[Ot.jsx("button",{className:"img2vid"===y?"active":"",onClick:()=>{v("video-generation"),_("img2vid"),b(null)},children:"Image to Video"}),Ot.jsx("button",{className:"txt2vid"===y?"active":"",onClick:()=>{v("video-generation"),_("txt2vid"),b(null)},children:"Text to Video"}),Ot.jsx("button",{className:"fflf"===y?"active":"",onClick:()=>{v("video-generation"),_("fflf"),b(null)},children:"FFLF"})]})]})]})]}),Ot.jsxs("div",{className:"storyboard-main",children:[Ot.jsxs("aside",{className:"storyboard-sidebar",style:{width:Rn},children:[Ot.jsx("div",{className:"sidebar-section",children:Ot.jsxs("div",{className:"sidebar-section-header",children:[Ot.jsx("span",{className:"sidebar-section-title",children:"Workflow"}),Ot.jsxs("div",{className:"workflow-icon-buttons",children:[Ot.jsx("button",{className:"icon-btn",onClick:()=>{const e=oe.find(e=>e.id===ce);e&&(me(e),he(!0))},disabled:!mr,title:"Edit workflow parameters",children:Ot.jsx(NT,{size:14})}),Ot.jsx("button",{className:"icon-btn rename",onClick:()=>{const e=oe.find(e=>e.id===ce);e&&(we(e),Me(e.name),ye(!0))},disabled:!mr,title:"Rename workflow",children:Ot.jsx(AT,{size:14})}),Ot.jsx("button",{className:"icon-btn delete",onClick:()=>{if(ce&&confirm("Are you sure you want to delete this workflow?")){const e=oe.find(e=>e.id===ce);se(e=>e.filter(e=>e.id!==ce)),ue(null),e&&en("info",`Deleted workflow: ${e.name}`)}},disabled:!mr,title:"Delete workflow",children:Ot.jsx(WT,{size:14})}),Ot.jsx("button",{className:"icon-btn export",onClick:Kn,disabled:0===oe.length,title:`Export all ${oe.length} workflows`,children:Ot.jsx(cT,{size:14})}),Ot.jsxs("label",{className:"icon-btn import",title:"Import workflows from JSON",children:[Ot.jsx($T,{size:14}),Ot.jsx("input",{type:"file",accept:".json",style:{display:"none"},onChange:Yn})]}),Ot.jsx("button",{className:"icon-btn categories",onClick:()=>ge(!0),disabled:0===oe.length,title:`Manage categories for ${oe.length} workflows`,children:Ot.jsx(GT,{size:14})})]})]})}),mr&&mr.parsed.outputs&&mr.parsed.outputs.length>0&&Ot.jsxs("div",{className:"sidebar-section",children:[Ot.jsx("div",{className:"sidebar-section-title",children:"Output Nodes"}),Ot.jsx(QT,{options:mr.parsed.outputs.map(e=>({id:e.node_id,label:e.name,selected:e.selected})),onChange:e=>{const t=mr.parsed.outputs.map(t=>({...t,selected:e.includes(t.node_id)}));se(e=>e.map(e=>e.id===mr.id?{...e,parsed:{...e.parsed,outputs:t}}:e))},placeholder:"Select output nodes..."})]}),mr&&Ot.jsxs("div",{className:"sidebar-section parameters-section",children:[Ot.jsxs("div",{className:"global-prompt-section",children:[Ot.jsx("div",{className:"global-prompt-header",children:Ot.jsxs("label",{className:"checkbox-label",children:[Ot.jsx("input",{type:"checkbox",checked:Ne,onChange:e=>Re(e.target.checked)}),"Global Prompt Override"]})}),Ne&&Ot.jsx("textarea",{className:"global-prompt-input",placeholder:"Enter prompt to use for all panels...",value:Pe,onChange:e=>Ae(e.target.value),rows:3})]}),Ot.jsx(CC,{parameters:fr.map(e=>({name:e.name,display_name:e.display_name,type:"string"===e.type?"prompt":e.type,node_id:e.node_id,input_name:e.input_name,default:e.default,constraints:e.constraints,description:e.description})),values:Ee,onChange:dr,disabled:!1,onEnhancePrompt:pr,cameraAngles:Te,onCameraAngleChange:hr,comfyUrl:pt})]})]}),Ot.jsx("div",{className:"resize-handle resize-handle-left",onMouseDown:e=>{e.preventDefault(),On(!0)}}),Ot.jsxs("main",{className:"storyboard-canvas",ref:re,onMouseDown:Jn,onMouseMove:e=>{tr(e),Qn(e)},onMouseUp:()=>{nr(),er()},onMouseLeave:()=>{nr(),er()},onDragOver:e=>e.preventDefault(),onDrop:Qt,children:[Ot.jsxs("div",{className:"canvas-toolbar",children:[Ot.jsx("button",{className:"icon-btn",onClick:()=>T(e=>Math.min(5,1.2*e)),title:"Zoom In",children:Ot.jsx(KT,{size:16})}),Ot.jsx("button",{className:"icon-btn",onClick:()=>T(e=>Math.max(.1,e/1.2)),title:"Zoom Out",children:Ot.jsx(YT,{size:16})}),Ot.jsx("button",{className:"icon-btn",onClick:()=>{T(1),P({x:0,y:0})},title:"Reset View",children:Ot.jsx(DT,{size:16})}),Ot.jsxs("span",{className:"zoom-level",children:[Math.round(100*C),"%"]}),Ot.jsxs("button",{onClick:Zn,className:"add-panel-btn",title:"Add Panel",children:[Ot.jsx(RT,{size:14})," Add Panel"]}),Ot.jsxs("button",{onClick:()=>xe(!0),className:"add-panel-btn",title:"Print Storyboard",children:[Ot.jsx(IT,{size:14})," Print"]}),w.filter(e=>e.selected).length>=2&&Ot.jsxs("div",{className:"alignment-toolbar",children:[Ot.jsx("button",{className:"icon-btn",onClick:()=>Zt("left"),title:"Align Left",children:Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ot.jsx("rect",{x:"2",y:"2",width:"2",height:"12"}),Ot.jsx("rect",{x:"6",y:"4",width:"8",height:"3"}),Ot.jsx("rect",{x:"6",y:"9",width:"6",height:"3"})]})}),Ot.jsx("button",{className:"icon-btn",onClick:()=>Zt("right"),title:"Align Right",children:Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ot.jsx("rect",{x:"12",y:"2",width:"2",height:"12"}),Ot.jsx("rect",{x:"2",y:"4",width:"8",height:"3"}),Ot.jsx("rect",{x:"2",y:"9",width:"6",height:"3"})]})}),Ot.jsx("button",{className:"icon-btn",onClick:()=>Zt("top"),title:"Align Top",children:Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ot.jsx("rect",{x:"2",y:"2",width:"12",height:"2"}),Ot.jsx("rect",{x:"4",y:"6",width:"3",height:"8"}),Ot.jsx("rect",{x:"9",y:"6",width:"3",height:"6"})]})}),Ot.jsx("button",{className:"icon-btn",onClick:()=>Zt("bottom"),title:"Align Bottom",children:Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ot.jsx("rect",{x:"2",y:"12",width:"12",height:"2"}),Ot.jsx("rect",{x:"4",y:"2",width:"3",height:"8"}),Ot.jsx("rect",{x:"9",y:"2",width:"3",height:"6"})]})}),Ot.jsx("div",{className:"toolbar-separator"}),Ot.jsx("button",{className:"icon-btn",onClick:()=>Jt("horizontal"),title:"Distribute Horizontally",children:Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ot.jsx("rect",{x:"1",y:"4",width:"2",height:"8"}),Ot.jsx("rect",{x:"6",y:"4",width:"4",height:"8"}),Ot.jsx("rect",{x:"13",y:"4",width:"2",height:"8"})]})}),Ot.jsx("button",{className:"icon-btn",onClick:()=>Jt("vertical"),title:"Distribute Vertically",children:Ot.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ot.jsx("rect",{x:"4",y:"1",width:"8",height:"2"}),Ot.jsx("rect",{x:"4",y:"6",width:"8",height:"4"}),Ot.jsx("rect",{x:"4",y:"13",width:"8",height:"2"})]})})]})]}),Ot.jsxs("div",{className:"canvas-transform-container",style:{transform:`translate(${k.x}px, ${k.y}px) scale(${C})`},children:[H&&Ot.jsx("div",{className:"marquee-selection",style:{position:"absolute",left:Math.min(G.x,$.x),top:Math.min(G.y,$.y),width:Math.abs($.x-G.x),height:Math.abs($.y-G.y),backgroundColor:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.5)",pointerEvents:"none",zIndex:1e3}}),q.map((e,t)=>Ot.jsx("div",{className:"snap-guide",style:{position:"absolute",left:"vertical"===e.type?e.position:0,top:"horizontal"===e.type?e.position:0,width:"vertical"===e.type?1:"100%",height:"horizontal"===e.type?1:"100%",backgroundColor:"rgba(239, 68, 68, 0.6)",pointerEvents:"none",zIndex:999}},t)),w.map(e=>{var t,n,r,i;return Ot.jsxs("div",{className:`panel-slot ${M===e.id?"selected":""} ${e.status} ${e.selected?"multi-selected":""}`,style:{left:e.x,top:e.y,width:e.width,height:e.height,zIndex:e.zIndex||(e.selected?10:1)},onMouseDown:t=>{(t.ctrlKey||t.metaKey||t.shiftKey)&&(t.stopPropagation(),$t(e.id))},onClick:t=>{t.stopPropagation(),t.ctrlKey||t.metaKey||t.shiftKey||(E(e.id),Ht.current=e.id)},onContextMenu:t=>{t.preventDefault(),t.stopPropagation(),Ze({visible:!0,x:t.clientX,y:t.clientY,panelId:e.id})},children:[Ot.jsx(hL,{panelId:e.id,name:e.name||`Panel_${String(e.id).padStart(2,"0")}`,locked:e.locked||e.imageHistory.length>0,selected:e.selected,onNameChange:t=>{S(n=>n.map(n=>n.id===e.id?{...n,name:t}:n))},onRemove:()=>Yt(e.id),onMouseDown:t=>{"generating"!==e.status&&Xt(e.id,t)}}),Ot.jsxs("div",{className:"panel-content",children:[e.image&&Ot.jsx("div",{className:"panel-image-container",children:Ot.jsx("img",{src:e.image,alt:`Panel ${e.id}`,draggable:!0,onDragStart:t=>{var n;const r=e.imageHistory[e.historyIndex],i=null==(n=null==r?void 0:r.metadata)?void 0:n.savedPath,a=JSON.stringify({url:e.image,filePath:i||null});t.dataTransfer.setData("application/x-storyboard-image",a),t.dataTransfer.setData("text/plain",a),t.dataTransfer.effectAllowed="copy"},onClick:t=>{t.preventDefault(),t.stopPropagation(),De(e.image),Ue(e.id),dt("actual"),ze(1),He({x:0,y:0}),Ie(!0)},style:{cursor:"pointer"}})}),e.imageHistory.length>0&&e.historyIndex>=0&&(null==(n=null==(t=e.imageHistory[e.historyIndex])?void 0:t.metadata)?void 0:n.generationTime)&&Ot.jsxs("div",{className:"generation-time",children:[e.imageHistory[e.historyIndex].metadata.generationTime.toFixed(1),"s"]}),e.imageHistory.length>0&&e.historyIndex>=0&&Ot.jsx("div",{className:"image-rating",onClick:e=>e.stopPropagation(),children:Ot.jsx(pL,{rating:(null==(i=null==(r=e.imageHistory[e.historyIndex])?void 0:r.metadata)?void 0:i.rating)||0,onRatingChange:t=>{S(n=>n.map(n=>{if(n.id!==e.id)return n;const r=[...n.imageHistory];return r[n.historyIndex]&&(r[n.historyIndex]={...r[n.historyIndex],metadata:{...r[n.historyIndex].metadata,rating:t}}),{...n,imageHistory:r}}))},size:14})}),e.imageHistory.length>1&&Ot.jsxs("div",{className:"image-nav history-nav",children:[Ot.jsx("button",{onClick:t=>{t.stopPropagation(),S(t=>t.map(t=>{if(t.id!==e.id)return t;const n=Math.max(0,t.historyIndex-1),r=t.imageHistory[n];return{...t,historyIndex:n,image:(null==r?void 0:r.url)||t.image}}))},disabled:e.historyIndex<=0,title:"Previous version",children:""}),Ot.jsxs("span",{className:"history-counter",title:`Version ${e.historyIndex+1} of ${e.imageHistory.length}`,children:["v",e.historyIndex+1,"/",e.imageHistory.length]}),Ot.jsx("button",{onClick:t=>{t.stopPropagation(),S(t=>t.map(t=>{if(t.id!==e.id)return t;const n=Math.min(t.imageHistory.length-1,t.historyIndex+1),r=t.imageHistory[n];return{...t,historyIndex:n,image:(null==r?void 0:r.url)||t.image}}))},disabled:e.historyIndex>=e.imageHistory.length-1,title:"Next version",children:""}),Ot.jsx("button",{className:"restore-btn",onClick:async t=>{var n,r,i,a,o,s;t.stopPropagation();const l=e.imageHistory[e.historyIndex];if((null==(n=null==l?void 0:l.metadata)?void 0:n.parameters)&&(null==(r=null==l?void 0:l.metadata)?void 0:r.workflowId)){l.metadata.workflowId!==ce&&(ie.current=!0,ue(l.metadata.workflowId));const t=l.metadata.parameters;return Ce(t),Bt.current=t,void p(`Restored parameters from v${e.historyIndex+1}`)}const c=null==(i=null==l?void 0:l.metadata)?void 0:i.savedPath;if(c)try{const e=ik.getProject().orchestratorUrl||nk(),t=await fetch(`${e}/api/png-metadata?path=${encodeURIComponent(c)}`),n=await t.json();if(!n.success||!n.prompt)return void d("Could not read PNG metadata");const r=n.prompt;let i;const l=Object.keys(r).filter(e=>"meta"!==e&&"version"!==e);let m=0;for(const s of oe){const e=Object.keys(s.workflow).filter(e=>"meta"!==e&&"version"!==e);let t=0;for(const i of l)if(s.workflow[i]){const e=null==(a=r[i])?void 0:a.class_type,n=null==(o=s.workflow[i])?void 0:o.class_type;e&&e===n&&t++}const n=l.length>0?t/Math.max(l.length,e.length):0;n>m&&n>.5&&(m=n,i=s)}if(!i){let e=null;for(const t of Object.values(r))if("SaveImage"===t.class_type&&(null==(s=t.inputs)?void 0:s.filename_prefix)){e=t.inputs.filename_prefix;break}if(e&&(i=oe.find(t=>t.id===e),!i)){const t=e=>e.toLowerCase().replace(/[_\s-]/g,""),n=t(e);i=oe.find(e=>t(e.id).includes(n)||n.includes(t(e.id))||t(e.name||"").includes(n)||n.includes(t(e.name||"")))}}i||h("Could not find matching workflow. Extracting parameters only.");const f={},g={};if(i){for(const e of i.parsed.parameters){const t=e.node_id,n=e.input_name,i=r[t];if((null==i?void 0:i.inputs)&&n in i.inputs){const t=i.inputs[n];Array.isArray(t)||(f[e.name]=t)}}for(const e of i.parsed.image_inputs){const t=e.node_id,n=e.input_name,i=r[t];if((null==i?void 0:i.inputs)&&n in i.inputs){const t=i.inputs[n];t&&"string"==typeof t&&(g[e.name]=t)}}}if(0===Object.keys(f).length)for(const a of Object.values(r)){if(!a.inputs)continue;const e=a.class_type||"";if((e.includes("KSampler")||e.includes("Sampler"))&&(void 0!==a.inputs.seed&&(f.seed=a.inputs.seed),void 0!==a.inputs.steps&&(f.steps=a.inputs.steps),void 0!==a.inputs.cfg&&(f.cfg=a.inputs.cfg),a.inputs.sampler_name&&(f.sampler_name=a.inputs.sampler_name),a.inputs.scheduler&&(f.scheduler=a.inputs.scheduler),void 0!==a.inputs.denoise&&(f.denoise=a.inputs.denoise),a.inputs.positive_prompt&&(f.positive_prompt=a.inputs.positive_prompt),a.inputs.negative_prompt&&(f.negative_prompt=a.inputs.negative_prompt)),"CLIPTextEncode"===e&&a.inputs.text){const e=a.inputs.text;"string"==typeof e&&e.length>20&&!f.positive_prompt&&(f.positive_prompt=e)}if(e.includes("TextEncode")&&!f.positive_prompt){const e=a.inputs.prompt||a.inputs.text;"string"==typeof e&&e.length>20&&(f.positive_prompt=e)}if("LoadImage"===e&&a.inputs.image){const e=a.inputs.image;g.reference_image||(g.reference_image=e)}}let v=0;i&&i.id!==ce&&(ie.current=!0,ue(i.id),v++),Object.keys(f).length>0&&(Ce(e=>{const t={...e,...f};return Bt.current=t,t}),v+=Object.keys(f).length);const y=Object.keys(g).length;if(y>0){const e=Lt.filter(e=>"online"===e.status);if(e.length>0){const t=e[0].url.replace(/\/$/,"");for(const[e,n]of Object.entries(g))try{const r=`${t}/view?filename=${encodeURIComponent(n)}&type=input`,i=await fetch(r);if(i.ok){const t=await i.blob(),n=await new Promise(e=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(t)});f[e]=n,v++}}catch(u){console.warn(`Could not fetch image ${n}:`,u)}Object.keys(g).some(e=>f[e])&&Ce(e=>{const t={...e,...f};return Bt.current=t,t})}}if(v>0){const e=i?`workflow "${i.name||i.id}"`:"",t=`${Object.keys(f).length} parameters`;p(`Restored ${e?e+", ":""}${t}${y>0?`, ${y} images`:""}`)}else h("No parameters could be extracted from PNG")}catch(u){console.error("Failed to restore from PNG:",u),d("Failed to restore parameters")}else d("No image path available")},title:"Restore workflow and parameters from this version",children:""}),Ot.jsx("button",{className:"save-btn",onClick:async t=>{t.stopPropagation();const n=e.imageHistory[e.historyIndex];if(n)try{if(on.path){const t=e.name||`Panel_${String(e.id).padStart(2,"0")}`,r=await ik.saveToProjectFolder(n.url,e.id,n.metadata.version,n.metadata,t);r.success?p(`Saved: ${r.savedPath}`):d(`Failed to save: ${r.error}`)}else{const{filename:t,blob:r}=await ik.saveImageToProject(n.url,e.id,n.metadata.version,n.metadata);ik.triggerDownload(r,t);const i=ik.generateMetadataJson(n),a=new Blob([i],{type:"application/json"});ik.triggerDownload(a,t.replace(".png","_metadata.json")),p(`Downloaded: ${t}`)}}catch(r){d(`Failed to save: ${r}`)}},title:on.path?`Save to ${on.path}`:"Download image",children:""})]}),"generating"===e.status&&Ot.jsxs("div",{className:"panel-generating-indicator",children:[Ot.jsxs("div",{className:"progress-content",children:[Ot.jsx("div",{className:"progress-spinner"}),Ot.jsxs("div",{className:"progress-text-container",children:[Ot.jsxs("span",{className:"progress-percentage",children:[e.progress,"%"]}),Ot.jsx("div",{className:"progress-bar-container",children:Ot.jsx("div",{className:"progress-bar-fill",style:{width:`${e.progress}%`}})})]})]}),Ot.jsx("button",{className:"cancel-generation-btn",onClick:async t=>{if(t.stopPropagation(),It.current){await It.current.cancelGeneration()?(S(t=>t.map(t=>t.id===e.id?{...t,status:"empty",progress:0,parallelJobs:void 0}:t)),h("Generation cancelled")):d("Failed to cancel generation")}},title:"Cancel generation",children:""})]}),"empty"===e.status&&!e.image&&Ot.jsx("button",{className:"panel-generate-btn large",onClick:t=>{t.stopPropagation(),ar(e.id)},disabled:!mr||"connected"!==ft&&0===Lt.filter(e=>"online"===e.status).length,title:"Generate",children:""}),Ot.jsx("span",{className:"panel-index",children:e.id})]}),Ot.jsxs("div",{className:"panel-controls",children:[("empty"===e.status||"complete"===e.status||"error"===e.status)&&Ot.jsx("button",{className:"panel-generate-btn "+("empty"!==e.status?"regenerate":""),onClick:t=>{t.stopPropagation(),S(t=>t.map(t=>{if(t.id!==e.id)return t;const n=t.image&&!t.images.includes(t.image)?[...t.images,t.image]:t.images;return{...t,status:"empty",progress:0,images:n}})),ar(e.id)},disabled:!mr||"connected"!==ft&&0===Lt.filter(e=>"online"===e.status).length,title:"empty"===e.status?"Generate":"Regenerate",children:"error"===e.status?"":""}),Ot.jsxs("select",{className:"panel-node-selector",value:e.nodeId||"",onChange:t=>{const n=t.target.value||void 0;S(t=>t.map(t=>t.id===e.id?{...t,nodeId:n}:t))},onClick:e=>e.stopPropagation(),children:[Ot.jsx("option",{value:"",children:"Auto"}),Lt.map(e=>Ot.jsxs("option",{value:e.id,disabled:"offline"===e.status,children:[e.name," (",e.status,")"]},e.id))]}),e.imageHistory.length>0&&e.historyIndex>=0&&Ot.jsx("button",{className:"panel-delete-btn",onClick:t=>{t.stopPropagation();const n=e.imageHistory[e.historyIndex];n&&_r(e.id,n.id)},title:"Delete image",children:Ot.jsx(WT,{size:14})})]}),Ot.jsx(dL,{panelId:e.id,notes:e.notes||"",onNotesChange:t=>{S(n=>n.map(n=>n.id===e.id?{...n,notes:t}:n))}}),Ot.jsx("div",{className:"panel-resize-handle",title:"Drag to resize",onMouseDown:t=>Vt(e.id,t)})]},e.id)})]})]}),Ot.jsx("div",{className:"resize-handle resize-handle-right",onMouseDown:e=>{e.preventDefault(),Fn(!0)}}),Ot.jsxs("aside",{className:"stats-panel",style:{width:In},children:[Ot.jsx("div",{className:"stats-header",children:"System Stats"}),Lt.length>0&&Ot.jsx("div",{style:{padding:"8px",borderBottom:"1px solid #3d3d3d"},children:Ot.jsx(ek,{selectedBackendIds:tn,onSelectionChange:nn,disabled:!1})}),Ot.jsx("div",{className:"stats-content",children:0!==Lt.length||vt?Ot.jsxs("div",{className:"node-metrics-list",children:[Lt.map(e=>Ot.jsxs("div",{className:"node-metrics-card",children:[Ot.jsxs("div",{className:"node-metrics-header",children:[Ot.jsx("span",{className:"node-status-dot",style:{color:"online"===e.status?"#4dff6d":"busy"===e.status?"#ffcc00":"#ff4444"},children:""}),Ot.jsx("span",{className:"node-name",children:e.name})]}),(()=>{const t=w.filter(e=>"generating"===e.status&&e.parallelJobs).flatMap(e=>e.parallelJobs||[]).find(t=>t.nodeId===e.id&&("running"===t.status||"pending"===t.status));return t?Ot.jsxs("div",{className:"node-progress-container",children:[Ot.jsx("div",{className:"node-progress-bar",children:Ot.jsx("div",{className:"node-progress-fill",style:{width:`${t.progress}%`}})}),Ot.jsx("span",{className:"node-progress-text",children:"running"===t.status?`${t.progress}%`:"Queued"})]}):null})(),"online"===e.status&&Ot.jsxs("div",{className:"node-metrics-body",children:[Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"GPU"}),Ot.jsx("span",{className:"metric-value",children:e.gpuName})]}),Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"VRAM"}),Ot.jsxs("span",{className:"metric-value",children:[(e.vramUsed/1024).toFixed(1),"/",(e.vramTotal/1024).toFixed(1)," GB"]}),Ot.jsx("div",{className:"metric-bar",children:Ot.jsx("div",{className:"metric-bar-fill",style:{width:`${Math.min(100,e.vramUsed/e.vramTotal*100)}%`}})})]}),Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"GPU%"}),Ot.jsxs("span",{className:"metric-value",children:[(e.gpuUsage||0).toFixed(0),"%"]}),Ot.jsx("div",{className:"metric-bar",children:Ot.jsx("div",{className:"metric-bar-fill gpu",style:{width:`${e.gpuUsage||0}%`}})})]}),Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"Temp"}),Ot.jsxs("span",{className:"metric-value",children:[e.gpuTemp||0,"C"]})]}),Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"CPU"}),Ot.jsxs("span",{className:"metric-value",children:[(e.cpuUsage||0).toFixed(0),"%"]}),Ot.jsx("div",{className:"metric-bar",children:Ot.jsx("div",{className:"metric-bar-fill cpu",style:{width:`${e.cpuUsage||0}%`}})})]}),Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"RAM"}),Ot.jsxs("span",{className:"metric-value",children:[(e.ramUsed||0).toFixed(1),"/",(e.ramTotal||0).toFixed(1)," GB"]}),Ot.jsx("div",{className:"metric-bar",children:Ot.jsx("div",{className:"metric-bar-fill ram",style:{width:(e.ramTotal?e.ramUsed/e.ramTotal*100:0)+"%"}})})]})]}),"online"!==e.status&&Ot.jsx("div",{className:"node-metrics-offline",children:"offline"===e.status?"Offline":e.status})]},e.id)),0===Lt.length&&vt&&Ot.jsxs("div",{className:"node-metrics-card",children:[Ot.jsxs("div",{className:"node-metrics-header",children:[Ot.jsx("span",{className:"node-status-dot",style:{color:"#4dff6d"},children:""}),Ot.jsx("span",{className:"node-name",children:"Top Bar URL"})]}),Ot.jsxs("div",{className:"node-metrics-body",children:[Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"GPU"}),Ot.jsx("span",{className:"metric-value",children:(null==(n=null==(t=null==(e=vt.devices)?void 0:e[0])?void 0:t.name)?void 0:n.replace(/^cuda:\d+\s+/,"").replace(/:\w+Alloc\w*$/,""))||"Unknown"})]}),Ot.jsxs("div",{className:"metric-row",children:[Ot.jsx("span",{className:"metric-label",children:"VRAM"}),Ot.jsx("span",{className:"metric-value",children:(null==(i=null==(r=vt.devices)?void 0:r[0])?void 0:i.vram_total)?`${((vt.devices[0].vram_total-(vt.devices[0].vram_free||0))/1024/1024/1024).toFixed(1)}/${(vt.devices[0].vram_total/1024/1024/1024).toFixed(1)} GB`:"N/A"})]})]})]})]}):Ot.jsx("span",{className:"no-stats",children:"No nodes configured"})})]})]}),Et&&Ot.jsxs("div",{className:"log-panel",children:[Ot.jsxs("div",{className:"log-header",children:[Ot.jsx("span",{children:"Application Log"}),Ot.jsxs("div",{className:"log-controls",children:[Ot.jsxs("select",{value:bt,onChange:e=>wt(e.target.value),children:[Ot.jsx("option",{value:"ALL",children:"All"}),Ot.jsx("option",{value:"COMFYUI",children:"COMFYUI"}),Ot.jsx("option",{value:"ERROR",children:"Error"})]}),Ot.jsxs("label",{children:[Ot.jsx("input",{type:"checkbox",checked:St,onChange:e=>Mt(e.target.checked)}),"Auto-scroll"]}),Ot.jsx("button",{onClick:()=>Ct(!1),className:"toggle-log-btn",children:"Hide"})]})]}),Ot.jsxs("div",{className:"log-content",children:[_t.filter(e=>"ALL"===bt||e.tag.toUpperCase()===bt).map(e=>{return Ot.jsxs("div",{className:`log-entry ${e.tag}`,children:[Ot.jsxs("span",{className:"log-time",children:["[",(t=e.timestamp,t.toTimeString().split(" ")[0]),"]"]}),Ot.jsx("span",{className:"log-tag",children:e.tag}),Ot.jsx("span",{className:"log-message",children:e.message})]},e.id);var t}),Ot.jsx("div",{ref:Tt})]})]}),!Et&&Ot.jsx("button",{className:"show-log-btn",onClick:()=>Ct(!0),children:"Show Log"}),de&&pe&&Ot.jsx("div",{className:"modal-overlay",children:Ot.jsx("div",{className:"modal-content",children:Ot.jsx(AC,{workflow:pe.workflow,parsedWorkflow:pe.parsed,initialConfig:pe.config,comfyUrl:pt,onSave:e=>{ie.current=!0,se(t=>t.map(t=>t.id===pe.id?{...t,config:e}:t)),he(!1),en("info",`Updated workflow: ${pe.name}`)},onCancel:()=>he(!1)},pe.id)})}),ve&&be&&Ot.jsx("div",{className:"modal-overlay",children:Ot.jsxs("div",{className:"modal-content rename-dialog",children:[Ot.jsxs("div",{className:"modal-header",children:[Ot.jsx("h3",{children:"Rename Workflow"}),Ot.jsx("button",{className:"modal-close-btn",onClick:()=>ye(!1),children:Ot.jsx(XT,{size:20})})]}),Ot.jsx("div",{className:"modal-body",children:Ot.jsxs("label",{className:"input-label",children:["Workflow Name",Ot.jsx("input",{type:"text",value:Se,onChange:e=>Me(e.target.value),placeholder:"Enter workflow name...",className:"text-input",autoFocus:!0})]})}),Ot.jsxs("div",{className:"modal-footer",children:[Ot.jsx("button",{className:"btn-secondary",onClick:()=>ye(!1),children:"Cancel"}),Ot.jsx("button",{className:"btn-primary",onClick:()=>{Se.trim()&&be&&(se(e=>e.map(e=>e.id===be.id?{...e,name:Se.trim()}:e)),en("info",`Renamed workflow from "${be.name}" to "${Se.trim()}"`),ye(!1),we(null),Me(""))},disabled:!Se.trim(),children:"Rename"})]})]})}),Ot.jsx(tk,{isOpen:fe,onClose:()=>ge(!1),workflows:oe,onUpdateWorkflow:qn}),Ot.jsx(mL,{isOpen:_e,onClose:()=>xe(!1),panels:w,projectName:on.name||"Untitled Project",selectedPanelId:M}),Pt&&Ot.jsx(ZT,{onClose:()=>At(!1),onRestartNodes:async e=>{p(`Restarting ${e.length} selected node(s)...`);try{const t=[];for(const i of e){const e=await GC.restartBackend(i);t.push({nodeId:i,...e})}const n=t.filter(e=>e.success).length,r=t.length-n;0===r?p(`Successfully restarted ${n} node(s)`):0===n?d(`Failed to restart all ${r} node(s)`):p(`Restarted ${n} node(s), ${r} failed`)}catch(t){d(`Error restarting nodes: ${t instanceof Error?t.message:"Unknown error"}`)}}}),rn&&Ot.jsx(uk,{isOpen:rn,onClose:()=>an(!1),settings:on,onSave:sn}),Mn&&Ot.jsx("div",{className:"modal-overlay",onClick:()=>En(!1),children:Ot.jsxs("div",{className:"modal-content load-project-modal",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"modal-header",children:[Ot.jsx("h2",{children:"Load Project"}),Ot.jsx("button",{className:"close-btn",onClick:()=>En(!1),children:Ot.jsx(XT,{size:18})})]}),Ot.jsxs("div",{className:"load-project-content",children:[Ot.jsx("p",{className:"load-project-instruction",children:"Select a folder to browse for project files:"}),Ot.jsx(dk,{isOpen:!0,onClose:()=>{},onSelect:async e=>{Pn(e),Nn(!0);try{const t=await ik.listProjects(e);t.success&&t.projects.length>0?Tn(t.projects):t.success?(d("No project files found in the selected folder"),Tn([])):(d(`Failed to list projects: ${t.error}`),Tn([]))}catch(t){d(`Error loading projects: ${t}`),Tn([])}finally{Nn(!1)}},orchestratorUrl:on.orchestratorUrl,initialPath:on.path,title:"Select Folder"}),An&&Ot.jsx("div",{className:"loading-projects",children:"Loading projects..."}),Cn.length>0&&Ot.jsxs("div",{className:"available-projects",children:[Ot.jsx("h3",{children:"Select a project to load:"}),Ot.jsx("div",{className:"project-list",children:Cn.map(e=>Ot.jsxs("div",{className:"project-item",onClick:()=>(async e=>{const t=await ik.loadProjectState(e);if(t.success&&t.state){const e=t.state.panels.map(e=>{const t=e.image?"complete":"empty";return{...e,status:t,progress:e.image?100:0,parallelJobs:void 0}});S(e),t.state.parameter_values&&(Ce(t.state.parameter_values),Bt.current=t.state.parameter_values),t.state.camera_angles&&ke(t.state.camera_angles),t.state.selected_workflow_id&&ue(t.state.selected_workflow_id),t.state.comfy_url&&mt(t.state.comfy_url),sn(ik.getProject()),p(`Loaded project with ${t.state.panels.length} panels`),En(!1),Tn([])}else d(`Failed to load project: ${t.error}`)})(e.path),children:[Ot.jsx("span",{className:"project-name",children:e.name}),Ot.jsxs("span",{className:"project-meta",children:[e.panel_count," panels  ",new Date(e.saved_at).toLocaleString()]})]},e.path))})]}),kn&&!An&&0===Cn.length&&Ot.jsx("div",{className:"no-projects-found",children:"No project files found in this folder."})]}),Ot.jsx("div",{className:"modal-footer",children:Ot.jsx("button",{className:"cancel-btn",onClick:()=>En(!1),children:"Cancel"})})]})}),wn&&Ot.jsx(ck,{isOpen:!0,onClose:()=>Sn(null),mode:wn,orchestratorUrl:on.orchestratorUrl,initialPath:on.path,projectName:on.name,onOpenProject:async e=>{var t;dn(!0),pn({progress:0,currentFile:"Loading project data..."});try{const n=await ik.loadProjectState(e);if(!n.success||!n.state)return d(`Failed to load project: ${n.error}`),void dn(!1);const r=new Set(n.state.deleted_images||[]);cn(r),pn({progress:10,currentFile:"Scanning project panels..."});const i=await ik.scanProjectPanels();if(!i.success)return console.error("[Load] Failed to scan project panels:",i.error),d(`Failed to scan project: ${i.error}`),void dn(!1);pn({progress:50,currentFile:"Building panels..."});const a=ik.getProject().orchestratorUrl||nk(),o=[];let s=1;for(const e of i.panels){const i=e.images.filter(e=>!r.has(e.image_path));if(0===i.length)continue;const l=n.state.panels.find(t=>t.name===e.panel_name);console.log("[Load] Panel folder:",e.panel_name,"Saved panel found:",l?{name:l.name,notes:l.notes,imageRatings:null==l?void 0:l.imageRatings}:"NOT FOUND"),console.log("[Load] All saved panels:",n.state.panels.map(e=>e.name));const c=(null==l?void 0:l.imageRatings)||{},u=i.map((t,n)=>({id:`${e.panel_name}_v${n+1}`,url:`${a}/api/serve-image?path=${encodeURIComponent(t.image_path)}`,metadata:{timestamp:new Date(1e3*t.modified_time),workflowId:"",workflowName:"Loaded",seed:0,promptSummary:"",parameters:{},workflow:{},sourceUrl:"",savedPath:t.image_path,version:n+1,rating:c[t.image_path]}})),d=(null==l?void 0:l.id)??s;o.push({id:d,name:e.panel_name,x:(null==l?void 0:l.x)??bL(s),y:(null==l?void 0:l.y)??wL(s),width:(null==l?void 0:l.width)??300,height:(null==l?void 0:l.height)??300,notes:(null==l?void 0:l.notes)??"",workflowId:null==l?void 0:l.workflowId,parameterValues:null==l?void 0:l.parameterValues,nodeId:null==l?void 0:l.nodeId,imageHistory:u,historyIndex:u.length>0?u.length-1:-1,image:u.length>0?(null==(t=u[u.length-1])?void 0:t.url)??null:null,images:[],currentImageIndex:0,status:u.length>0?"complete":"empty",progress:u.length>0?100:0,locked:(null==l?void 0:l.locked)??!1,selected:!1}),s++}for(const e of n.state.panels){!i.panels.some(t=>t.panel_name===e.name)&&e.name&&o.push({id:e.id,name:e.name,x:e.x,y:e.y,width:e.width??300,height:e.height??300,notes:e.notes??"",workflowId:e.workflowId,parameterValues:e.parameterValues,nodeId:e.nodeId,imageHistory:[],historyIndex:-1,image:null,images:[],currentImageIndex:0,status:"empty",progress:0,locked:!1,selected:!1})}o.sort((e,t)=>e.id-t.id),S(o),n.state.parameter_values&&(Ce(n.state.parameter_values),Bt.current=n.state.parameter_values),n.state.camera_angles&&ke(n.state.camera_angles),n.state.selected_workflow_id&&ue(n.state.selected_workflow_id),n.state.comfy_url&&mt(n.state.comfy_url),sn(ik.getProject()),pn({progress:100,currentFile:"Complete!"});let l=0;o.forEach(e=>l+=e.imageHistory.length),p(`Loaded project with ${o.length} panels, ${l} images`),setTimeout(()=>{Sn(null),dn(!1)},500)}catch(n){console.error("[Load] Failed to load project:",n),d(`Failed to load project: ${String(n)}`),dn(!1)}},onSaveProject:async(e,t)=>{const n={...on,name:t,path:e};sn(n),ik.setProject(n);const r=await ik.saveProjectState(w,void 0,Ee,{selectedWorkflowId:ce||void 0,renderNodes:Lt,comfyUrl:pt,cameraAngles:Te});r.success?(p(`Project saved to ${r.savedPath}`),Sn(null)):d(`Failed to save project: ${r.error}`)}}),Q&&Ot.jsx("div",{className:"modal-overlay",onClick:()=>ee(!1),children:Ot.jsxs("div",{className:"modal-content folder-import-modal",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"modal-header",children:[Ot.jsx("h2",{children:"Import Folder"}),Ot.jsx("button",{className:"close-btn",onClick:()=>ee(!1),children:Ot.jsx(XT,{size:18})})]}),Ot.jsxs("div",{className:"modal-body",children:[Ot.jsxs("p",{className:"folder-import-instruction",children:["Select a folder to import images from ",Ot.jsx("strong",{children:te}),":"]}),Ot.jsx(dk,{isOpen:!0,onClose:()=>{},onSelect:async e=>{const t=Math.max(...w.map(e=>e.id),0)+1,n=`Panel_${String(t).padStart(2,"0")}`,r=on.orchestratorUrl||nk();try{en("info",`Scanning folder ${e} for images...`);const i=await fetch(`${r}/api/scan-folder-images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_path:e})});if(!i.ok)throw new Error(`Scan failed: ${i.status}`);const a=await i.json();if(!a.success||0===a.images.length)return en("warning",`No images found in folder: ${e}`),h("No images found in the selected folder"),ee(!1),void ne("");const o=a.images.map((e,n)=>({id:`import_${t}_${n}`,url:`${r}/api/serve-image?path=${encodeURIComponent(e.image_path)}`,metadata:{timestamp:new Date(1e3*e.modified_time),workflowId:"",workflowName:"Imported",seed:0,promptSummary:`Imported from ${e.filename}`,parameters:{},workflow:{},sourceUrl:"",savedPath:e.image_path,version:n+1}})),s=e.split(/[/\\]/).pop()||n,l=s.match(/^[a-zA-Z0-9_-]+$/)?s:n;S(e=>{var n;return[...e,{id:t,name:l,x:50+20*e.length,y:50+20*e.length,width:300,height:300,image:(null==(n=o[o.length-1])?void 0:n.url)||"",images:[],status:o.length>0?"complete":"empty",progress:o.length>0?100:0,imageHistory:o,historyIndex:o.length>0?o.length-1:-1,currentImageIndex:0,workflowId:void 0,parameterValues:{},notes:"",locked:o.length>0,selected:!1}]}),en("info",`Imported ${o.length} images into panel ${l}`),p(`Imported ${o.length} images`)}catch(i){const e=i instanceof Error?i.message:"Unknown error";en("error",`Failed to import folder: ${e}`),d(`Failed to import folder: ${e}`)}ee(!1),ne("")},orchestratorUrl:on.orchestratorUrl,initialPath:on.path,title:"Select Import Folder"})]}),Ot.jsx("div",{className:"modal-footer",children:Ot.jsx("button",{className:"cancel-btn",onClick:()=>ee(!1),children:"Cancel"})})]})}),Ot.jsx(zC,{notifications:m,onRemove:f}),Ot.jsx(hk,{isOpen:(null==mn?void 0:mn.isOpen)||!1,filename:(null==mn?void 0:mn.filename)||"",onConfirm:()=>{mn&&(xr(mn.panelId,mn.entryId),fn(null))},onCancel:()=>fn(null),onSuppressForSession:()=>vn(!0)}),Ot.jsxs("div",{className:"floating-action-container",children:[(w.some(e=>"generating"===e.status)||Lt.some(e=>"busy"===e.status))&&Ot.jsxs("button",{className:"floating-cancel-btn",onClick:br,title:"Cancel All Generations",children:[Ot.jsx(TT,{size:18}),"Cancel"]}),Ot.jsx("button",{className:"floating-generate-btn",onClick:()=>{M?ar(M):w.length>0&&ar(w[0].id)},disabled:!mr||"connected"!==ft&&0===Lt.filter(e=>"online"===e.status).length,title:"Generate (G)",children:" Generate"})]}),Ye.visible&&Ot.jsxs("div",{className:"panel-context-menu",style:{position:"fixed",top:Ye.y,left:Ye.x,zIndex:1e4},onClick:e=>e.stopPropagation(),children:[Ot.jsxs("button",{className:"context-menu-item",onClick:()=>{Ye.panelId&&Xn(Ye.panelId),Ze(e=>({...e,visible:!1}))},disabled:!Ye.panelId||!(null==(l=null==(s=null==(o=w.find(e=>e.id===Ye.panelId))?void 0:o.imageHistory[(null==(a=w.find(e=>e.id===Ye.panelId))?void 0:a.historyIndex)??0])?void 0:s.metadata)?void 0:l.savedPath),children:[Ot.jsx(mT,{size:14})," Open in Explorer"]}),Ot.jsxs("button",{className:"context-menu-item",onClick:async()=>{var e,t,n,r,i,a;if(!Ye.panelId)return;const o=w.find(e=>e.id===Ye.panelId);if(!o||0===o.imageHistory.length)return h("No image in this panel"),void Ze(e=>({...e,visible:!1}));const s=o.imageHistory[o.historyIndex];if((null==(e=null==s?void 0:s.metadata)?void 0:e.parameters)&&(null==(t=null==s?void 0:s.metadata)?void 0:t.workflowId)){s.metadata.workflowId!==ce&&(ie.current=!0,ue(s.metadata.workflowId));const e=s.metadata.parameters;return Ce(e),Bt.current=e,p(`Restored parameters from v${o.historyIndex+1}`),void Ze(e=>({...e,visible:!1}))}const l=null==(n=null==s?void 0:s.metadata)?void 0:n.savedPath;if(!l)return d("No image path available for parameter extraction"),void Ze(e=>({...e,visible:!1}));try{const e=ik.getProject().orchestratorUrl||nk(),t=await fetch(`${e}/api/png-metadata?path=${encodeURIComponent(l)}`),n=await t.json();if(!n.success||!n.prompt)return d("Could not read PNG metadata"),void Ze(e=>({...e,visible:!1}));const o=n.prompt;let s;const u=Object.keys(o).filter(e=>"meta"!==e&&"version"!==e);let m=0;for(const a of oe){const e=Object.keys(a.workflow).filter(e=>"meta"!==e&&"version"!==e);let t=0;for(const s of u)if(a.workflow[s]){const e=null==(r=o[s])?void 0:r.class_type,n=null==(i=a.workflow[s])?void 0:i.class_type;e&&e===n&&t++}const n=u.length>0?t/Math.max(u.length,e.length):0;n>m&&n>.5&&(m=n,s=a)}if(!s){let e=null;for(const t of Object.values(o))if("SaveImage"===t.class_type&&(null==(a=t.inputs)?void 0:a.filename_prefix)){e=t.inputs.filename_prefix;break}if(e&&(s=oe.find(t=>t.id===e),!s)){const t=e=>e.toLowerCase().replace(/[_\s-]/g,""),n=t(e);s=oe.find(e=>t(e.id).includes(n)||n.includes(t(e.id))||t(e.name||"").includes(n)||n.includes(t(e.name||"")))}}s||h("Could not find matching workflow. Extracting parameters only.");const f={},g={};if(s){for(const e of s.parsed.parameters){const t=e.node_id,n=e.input_name,r=o[t];if((null==r?void 0:r.inputs)&&n in r.inputs){const t=r.inputs[n];Array.isArray(t)||(f[e.name]=t)}}for(const e of s.parsed.image_inputs){const t=e.node_id,n=e.input_name,r=o[t];if((null==r?void 0:r.inputs)&&n in r.inputs){const t=r.inputs[n];t&&"string"==typeof t&&(g[e.name]=t)}}}if(0===Object.keys(f).length)for(const r of Object.values(o)){if(!r.inputs)continue;const e=r.class_type||"";if((e.includes("KSampler")||e.includes("Sampler"))&&(void 0!==r.inputs.seed&&(f.seed=r.inputs.seed),void 0!==r.inputs.steps&&(f.steps=r.inputs.steps),void 0!==r.inputs.cfg&&(f.cfg=r.inputs.cfg),r.inputs.sampler_name&&(f.sampler_name=r.inputs.sampler_name),r.inputs.scheduler&&(f.scheduler=r.inputs.scheduler),void 0!==r.inputs.denoise&&(f.denoise=r.inputs.denoise)),"CLIPTextEncode"===e&&r.inputs.text){const e=r.inputs.text;"string"==typeof e&&e.length>20&&!f.positive_prompt&&(f.positive_prompt=e)}if("LoadImage"===e&&r.inputs.image){const e=r.inputs.image;g.reference_image||(g.reference_image=e)}}let v=0;s&&s.id!==ce&&(ie.current=!0,ue(s.id),v++),Object.keys(f).length>0&&(Ce(e=>{const t={...e,...f};return Bt.current=t,t}),v+=Object.keys(f).length);const y=Object.keys(g).length;if(y>0){const e=Lt.filter(e=>"online"===e.status);if(e.length>0){const t=e[0].url.replace(/\/$/,"");for(const[e,n]of Object.entries(g))try{const r=`${t}/view?filename=${encodeURIComponent(n)}&type=input`,i=await fetch(r);if(i.ok){const t=await i.blob(),n=await new Promise(e=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(t)});f[e]=n,v++}}catch(c){console.warn(`Could not fetch image ${n}:`,c)}Object.keys(g).some(e=>f[e])&&Ce(e=>{const t={...e,...f};return Bt.current=t,t})}}if(v>0){const e=s?`workflow "${s.name||s.id}"`:"",t=`${Object.keys(f).length} parameters`;p(`Restored ${e?e+", ":""}${t}${y>0?`, ${y} images`:""}`)}else h("No parameters could be extracted from PNG")}catch(c){console.error("Failed to restore from PNG:",c),d("Failed to restore parameters")}Ze(e=>({...e,visible:!1}))},disabled:!Ye.panelId||0===(null==(c=w.find(e=>e.id===Ye.panelId))?void 0:c.imageHistory.length),children:[Ot.jsx(DT,{size:14})," Restore Parameters"]})]}),Le&&je&&Ot.jsxs("div",{ref:Ke,className:"image-viewer-overlay",onClick:zn,tabIndex:0,onKeyDown:e=>{if("Escape"===e.key)e.preventDefault(),zn();else if("ArrowLeft"===e.key){if(e.preventDefault(),Oe){const e=w.find(e=>e.id===Oe);e&&e.historyIndex>0&&Bn(-1)}}else if("ArrowRight"===e.key){if(e.preventDefault(),Oe){const e=w.find(e=>e.id===Oe);e&&e.historyIndex<e.imageHistory.length-1&&Bn(1)}}else if("Delete"===e.key&&(e.preventDefault(),Oe)){const e=w.find(e=>e.id===Oe);if(e&&e.historyIndex>=0&&e.imageHistory.length>0){const t=e.imageHistory[e.historyIndex];t&&_r(Oe,t.id)}}},children:[Ot.jsxs("div",{className:"image-viewer-toolbar",children:[Ot.jsx("div",{className:"toolbar-group",children:Oe&&(()=>{const e=w.find(e=>e.id===Oe);return e&&e.imageHistory.length>1?Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Bn(-1)},disabled:e.historyIndex<=0,title:"Previous version ()","aria-label":"Previous version",children:Ot.jsx(eT,{size:20})}),Ot.jsxs("span",{className:"viewer-version-badge",children:["v",e.historyIndex+1,"/",e.imageHistory.length]}),Ot.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Bn(1)},disabled:e.historyIndex>=e.imageHistory.length-1,title:"Next version ()","aria-label":"Next version",children:Ot.jsx(tT,{size:20})})]}):null})()}),Ot.jsxs("div",{className:"toolbar-group zoom-controls",children:[Ot.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Vn()},title:"Zoom Out (-)","aria-label":"Zoom out",children:Ot.jsx(YT,{size:20})}),Ot.jsxs("span",{className:"zoom-percentage",children:[Math.round(100*Fe),"%"]}),Ot.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Hn()},title:"Zoom In (+)","aria-label":"Zoom in",children:Ot.jsx(KT,{size:20})}),Ot.jsx("div",{className:"toolbar-separator"}),Ot.jsx("button",{className:"toolbar-btn "+("fit"===ut?"active":""),onClick:e=>{e.stopPropagation(),Gn()},title:"Fit to Screen (F)","aria-label":"Fit to screen",children:Ot.jsx(MT,{size:20})}),Ot.jsx("button",{className:"toolbar-btn "+("actual"===ut?"active":""),onClick:e=>{e.stopPropagation(),Wn()},title:"Actual Size (1)","aria-label":"Actual size",children:Ot.jsx(lT,{size:20})})]}),Ot.jsxs("div",{className:"toolbar-group",children:[Oe&&(()=>{const e=w.find(e=>e.id===Oe);return e&&e.imageHistory.length>1?Ot.jsx("button",{className:"toolbar-btn "+(Ve?"active":""),onClick:e=>{e.stopPropagation(),$n()},title:"Compare Mode (C)","aria-label":"Toggle compare mode",children:Ot.jsx(uT,{size:20})}):null})(),Ot.jsx("button",{className:"toolbar-btn "+(Je?"active":""),onClick:e=>{e.stopPropagation(),Qe(e=>!e)},title:"Toggle Metadata Panel (I)","aria-label":"Toggle metadata panel",children:Je?Ot.jsx(kT,{size:20}):Ot.jsx(PT,{size:20})}),Ot.jsx("div",{className:"toolbar-separator"}),Oe&&(()=>{const e=w.find(e=>e.id===Oe);return e&&e.historyIndex>=0&&e.imageHistory.length>0?Ot.jsx("button",{className:"toolbar-btn delete-btn",onClick:t=>{t.stopPropagation();const n=e.imageHistory[e.historyIndex];n&&_r(Oe,n.id)},title:"Delete Image (Del)","aria-label":"Delete image",children:Ot.jsx(WT,{size:20})}):null})(),Ot.jsx("button",{className:"toolbar-btn close-btn",onClick:e=>{e.stopPropagation(),zn()},title:"Close (Esc)","aria-label":"Close viewer",children:Ot.jsx(XT,{size:20})})]})]}),Ve&&Oe&&Ot.jsxs("div",{className:"image-viewer-compare-selector",onClick:e=>e.stopPropagation(),children:[Ot.jsx("span",{children:"Compare with:"}),null==(u=w.find(e=>e.id===Oe))?void 0:u.imageHistory.map((e,t)=>Ot.jsxs("button",{onClick:()=>$e(e.url),className:We===e.url?"active":"",disabled:e.url===je,children:["v",t+1]},e.id))]}),Ot.jsxs("div",{className:"image-viewer-main",children:[Ot.jsxs("div",{ref:ht,className:"image-viewer-container",style:{flex:1,display:"flex",flexDirection:"row"},onClick:e=>e.stopPropagation(),children:[Oe&&(()=>{const e=w.find(e=>e.id===Oe);return!e||e.imageHistory.length<=1?null:Ot.jsx("div",{className:"thumbnail-strip-vertical",onClick:e=>e.stopPropagation(),children:e.imageHistory.map((t,n)=>{var r;return Ot.jsxs("div",{className:"thumbnail-item "+(n===e.historyIndex?"active":""),onClick:()=>{De(t.url),S(e=>e.map(e=>{var t;return e.id===Oe?{...e,historyIndex:n,image:(null==(t=e.imageHistory[n])?void 0:t.url)||null}:e}))},children:[Ot.jsx("img",{src:t.url,alt:`Version ${n+1}`,style:{maxHeight:256,maxWidth:256,objectFit:"contain"},draggable:!1}),Ot.jsx("span",{className:"thumbnail-filename",children:(null==(r=t.metadata)?void 0:r.savedPath)?t.metadata.savedPath.split(/[\\\/]/).pop():`v${String(n+1).padStart(3,"0")}`})]},t.id)})})})(),Ot.jsxs("div",{className:"image-viewer-main-area",onWheel:e=>{e.stopPropagation();const t=e.deltaY>0?-.1:.1;dt("custom"),ze(e=>yL(e+t))},onMouseDown:e=>{if(0!==e.button||Ve)return;const t=e.clientX-Be.x,n=e.clientY-Be.y,r=e=>{He({x:e.clientX-t,y:e.clientY-n})},i=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)},children:[!Ve&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("img",{src:je,alt:"Viewer",style:{transform:`translate(${Be.x}px, ${Be.y}px) scale(${Fe})`,cursor:"grab",maxWidth:"100%",maxHeight:"calc(100% - 30px)",objectFit:"contain"},draggable:!1,onError:e=>{console.error("[ImageViewer] Failed to load image:",je),console.error("[ImageViewer] Error event:",e)},onLoad:()=>{console.log("[ImageViewer] Image loaded successfully")}}),Oe&&(()=>{var e;const t=w.find(e=>e.id===Oe),n=null==t?void 0:t.imageHistory[t.historyIndex],r=(null==(e=null==n?void 0:n.metadata)?void 0:e.savedPath)?n.metadata.savedPath.split(/[\\\/]/).pop():(null==je?void 0:je.split(/[\\\/]/).pop())||"Unknown";return Ot.jsx("div",{className:"image-viewer-filename",children:r})})()]}),Ve&&We&&Ot.jsxs("div",{className:"image-compare-container",onMouseMove:e=>{const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*100;qe(Math.max(0,Math.min(100,n)))},children:[Ot.jsx("img",{src:je,alt:"Current",className:"compare-base",draggable:!1}),Ot.jsx("div",{className:"compare-overlay",style:{clipPath:`inset(0 ${100-Xe}% 0 0)`},children:Ot.jsx("img",{src:We,alt:"Compare",draggable:!1})}),Ot.jsx("div",{className:"compare-slider",style:{left:`${Xe}%`},children:Ot.jsx("div",{className:"compare-slider-handle",children:""})})]})]})," "]})," ",Je&&Oe&&(()=>{const e=w.find(e=>e.id===Oe),t=null==e?void 0:e.imageHistory[e.historyIndex];if(!t)return null;const n=t.metadata,r=ot&&(ot.prompt||ot.workflow)?(()=>{if(!(null==ot?void 0:ot.prompt))return{seed:null,prompt:null,model:null,workflowName:null,steps:null,cfg:null,sampler:null,scheduler:null,denoise:null};const e=ot.prompt;let t=null,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;for(const[u,d]of Object.entries(e)){if(!d.inputs)continue;const e=d.class_type||"";if((e.includes("KSampler")||e.includes("Sampler"))&&(void 0!==d.inputs.seed&&null===t&&(t=d.inputs.seed),void 0!==d.inputs.steps&&null===a&&(a=d.inputs.steps),void 0!==d.inputs.cfg&&null===o&&(o=d.inputs.cfg),d.inputs.sampler_name&&!s&&(s=d.inputs.sampler_name),d.inputs.scheduler&&!l&&(l=d.inputs.scheduler),void 0!==d.inputs.denoise&&null===c&&(c=d.inputs.denoise),d.inputs.positive_prompt&&!n)){const e=d.inputs.positive_prompt;"string"==typeof e&&e.length>10&&(n=e)}if("CLIPTextEncode"===e&&d.inputs.text&&!n){const e=d.inputs.text;"string"==typeof e&&e.length>20&&(n=e)}if(e.includes("TextEncode")&&!n){const e=d.inputs.prompt||d.inputs.text;"string"==typeof e&&e.length>20&&(n=e)}"UnetLoaderGGUF"===e&&d.inputs.unet_name&&!r&&(r=d.inputs.unet_name),"UNETLoader"===e&&d.inputs.unet_name&&!r&&(r=d.inputs.unet_name),"CheckpointLoaderSimple"!==e&&"CheckpointLoader"!==e||!d.inputs.ckpt_name||r||(r=d.inputs.ckpt_name),"UpscaleModelLoader"===e&&d.inputs.model_name&&!r&&(r=d.inputs.model_name),e.includes("Loader")&&!r&&(d.inputs.unet_name?r=d.inputs.unet_name:d.inputs.ckpt_name?r=d.inputs.ckpt_name:d.inputs.model_name&&(r=d.inputs.model_name)),"SaveImage"===e&&d.inputs.filename_prefix&&!i&&(i=d.inputs.filename_prefix)}if(!i&&ot.workflow){i=ot.workflow.name||null}return{seed:t,prompt:n,model:r,workflowName:i,steps:a,cfg:o,sampler:s,scheduler:l,denoise:c}})():null,i=(e=>{if(!e)return{steps:null,cfg:null,sampler:null,scheduler:null,denoise:null,model:null};console.log("[Metadata] Entry parameters:",Object.keys(e),e);const t=t=>{for(const n of t){if(void 0!==e[n])return e[n];for(const[t,r]of Object.entries(e))if((t.startsWith(n+"_")||t===n)&&void 0!==r)return r}return null};return{steps:t(["steps"]),cfg:t(["cfg","cfg_scale","guidance_scale"]),sampler:t(["sampler_name","sampler"]),scheduler:t(["scheduler"]),denoise:t(["denoise","denoising_strength"]),model:t(["ckpt_name","unet_name","model_name","model"])}})(null==n?void 0:n.parameters),a=(null==n?void 0:n.seed)??(null==r?void 0:r.seed)??null,o=(null==n?void 0:n.promptSummary)||(null==r?void 0:r.prompt)||null,s=(null==i?void 0:i.model)||function(e){if(!e)return;const t=["model","ckpt_name","checkpoint","model_name","unet_name","clip_name","vae_name"];for(const n of t){const t=e[n];if("string"==typeof t&&t.trim()){const e=t.split(/[\\/]/);return e[e.length-1].replace(/\.(safetensors|ckpt|pt|pth|bin)$/i,"")}}for(const[n,r]of Object.entries(e))if("string"==typeof r&&r.trim())for(const e of t)if(n.toLowerCase().includes(e)){const e=r.split(/[\\/]/);return e[e.length-1].replace(/\.(safetensors|ckpt|pt|pth|bin)$/i,"")}}(null==n?void 0:n.parameters)||(null==r?void 0:r.model)||null,l=(null==n?void 0:n.workflowName)||(null==r?void 0:r.workflowName)||"Unknown",c=(null==n?void 0:n.nodeName)||null,u=(null==n?void 0:n.generationTime)||null,d=(null==n?void 0:n.timestamp)||null,h=(null==n?void 0:n.version)??(void 0!==(null==e?void 0:e.historyIndex)?e.historyIndex+1:1),p=(null==i?void 0:i.steps)??(null==r?void 0:r.steps)??null,m=(null==i?void 0:i.cfg)??(null==r?void 0:r.cfg)??null,f=(null==i?void 0:i.sampler)??(null==r?void 0:r.sampler)??null,g=(null==i?void 0:i.scheduler)??(null==r?void 0:r.scheduler)??null,v=(null==i?void 0:i.denoise)??(null==r?void 0:r.denoise)??null,y=function(e,t){if(t)return`${t.width}${t.height}`;if(!e)return;const n=e.width||e.image_width,r=e.height||e.image_height;return"number"==typeof n&&"number"==typeof r?`${n}${r}`:void 0}(null==n?void 0:n.parameters,nt),_=function(e){if(null==e||isNaN(e))return"Unknown";const t=["B","KB","MB","GB"];let n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;return`${n.toFixed(0===r?0:1)} ${t[r]}`}(it);return Ot.jsxs("div",{className:"image-viewer-metadata-panel",onClick:e=>e.stopPropagation(),children:[Ot.jsxs("div",{className:"metadata-panel-header",children:[Ot.jsx(xT,{size:16}),Ot.jsx("span",{children:"Image Info"}),lt&&Ot.jsx("span",{className:"metadata-loading",children:"Loading..."}),Ot.jsx("button",{className:"metadata-toggle-btn",onClick:()=>Qe(!1),title:"Hide metadata panel","aria-label":"Hide metadata panel",children:Ot.jsx(kT,{size:14})})]}),Ot.jsxs("div",{className:"metadata-panel-content",children:[Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Resolution"}),Ot.jsx("span",{className:"metadata-value",children:y||"Unknown"})]}),Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"File Size"}),Ot.jsx("span",{className:"metadata-value",children:_})]}),Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Workflow"}),Ot.jsx("span",{className:"metadata-value workflow-name",title:l,children:l})]}),s&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Model"}),Ot.jsx("span",{className:"metadata-value model-name",title:s,children:s})]}),Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Seed"}),Ot.jsx("span",{className:"metadata-value",children:null!==a&&-1!==a?a:"Unknown"})]}),null!==p&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Steps"}),Ot.jsx("span",{className:"metadata-value",children:p})]}),null!==m&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"CFG"}),Ot.jsx("span",{className:"metadata-value",children:m})]}),f&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Sampler"}),Ot.jsx("span",{className:"metadata-value",children:f})]}),g&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Scheduler"}),Ot.jsx("span",{className:"metadata-value",children:g})]}),null!==v&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Denoise"}),Ot.jsx("span",{className:"metadata-value",children:v})]}),c&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Render Node"}),Ot.jsx("span",{className:"metadata-value",children:c})]}),u&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Render Time"}),Ot.jsxs("span",{className:"metadata-value",children:[u.toFixed(1),"s"]})]}),d&&Ot.jsxs("div",{className:"metadata-row",children:[Ot.jsx("span",{className:"metadata-label",children:"Created"}),Ot.jsx("span",{className:"metadata-value",children:_L(d)||"Unknown"})]}),o&&Ot.jsxs("div",{className:"metadata-prompt-section",children:[Ot.jsx("div",{className:"metadata-label",children:"Prompt"}),Ot.jsx("div",{className:"metadata-prompt-text "+(et?"expanded":""),children:et?o:vL(o,150)}),o.length>150&&Ot.jsx("button",{className:"show-more-btn",onClick:()=>tt(e=>!e),children:et?"Show less":"Show more"})]}),Ot.jsxs("div",{className:"metadata-footer",children:["Version ",h,"  Panel ",Oe]})]})]})})()]})]})]})}function CL(){const[e,t]=kt.useState({status:"processing",message:"Processing authorization..."});kt.useEffect(()=>{(async()=>{const e=new URLSearchParams(window.location.search),n=e.get("code"),r=e.get("state"),i=e.get("error"),a=e.get("error_description");if(i)return t({status:"error",message:"Authorization failed",error:a||i}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:i,error_description:a},window.location.origin));if(!n)return t({status:"error",message:"Missing authorization code",error:"No authorization code received from provider"}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:"missing_code",error_description:"No authorization code received"},window.location.origin));const o=sessionStorage.getItem("oauth_state"),s=sessionStorage.getItem("oauth_provider");if(!r||r!==o)return t({status:"error",message:"Security validation failed",error:"State mismatch - possible CSRF attack. Please try again."}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:"state_mismatch",error_description:"State parameter mismatch"},window.location.origin));if(!s)return t({status:"error",message:"Session expired",error:"Provider information not found. Please try again."}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:"no_provider",error_description:"Provider session data missing"},window.location.origin));try{t({status:"processing",message:"Exchanging authorization code for tokens..."});const e=`${window.location.origin}/oauth/callback`,i=await Hf.exchangeOAuthCode(s,n,r,e);if(!i.success||!i.access_token)throw new Error("Token exchange failed - no access token received");sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_provider"),t({status:"success",message:"Authorization successful! You can close this window."}),window.opener&&(window.opener.postMessage({type:"oauth_callback",access_token:i.access_token,refresh_token:i.refresh_token,token_type:i.token_type,expires_in:i.expires_in,scope:i.scope},window.location.origin),setTimeout(()=>{window.close()},1500))}catch(l){const e=l instanceof Error?l.message:"Unknown error";t({status:"error",message:"Token exchange failed",error:e}),window.opener&&window.opener.postMessage({type:"oauth_callback",error:"token_exchange_failed",error_description:e},window.location.origin)}})()},[]);const n={fontSize:"3rem",marginBottom:"1rem"},r={fontSize:"1.25rem",fontWeight:600,marginBottom:"0.5rem"},i={fontSize:"0.9rem",color:"#a0a0a0",marginBottom:"1rem"};return Ot.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"2rem",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backgroundColor:"#1a1a2e",color:"#eaeaea"},children:[Ot.jsx("style",{children:"\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        "}),Ot.jsxs("div",{style:{backgroundColor:"#16213e",borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"100%",textAlign:"center",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"},children:["processing"===e.status&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #2a3a5e",borderTopColor:"#4a9eff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"}}),Ot.jsx("div",{style:r,children:e.message}),Ot.jsx("div",{style:i,children:"Please wait..."})]}),"success"===e.status&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("div",{style:n,children:""}),Ot.jsx("div",{style:r,children:e.message}),Ot.jsx("div",{style:i,children:"This window will close automatically."})]}),"error"===e.status&&Ot.jsxs(Ot.Fragment,{children:[Ot.jsx("div",{style:n,children:""}),Ot.jsx("div",{style:r,children:e.message}),e.error&&Ot.jsx("div",{style:{fontSize:"0.85rem",color:"#ff6b6b",backgroundColor:"rgba(255, 107, 107, 0.1)",padding:"0.75rem",borderRadius:"6px",marginTop:"1rem"},children:e.error}),Ot.jsx("button",{style:{marginTop:"1.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#4a9eff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",fontWeight:500},onClick:()=>window.close(),children:"Close Window"})]})]})]})}class TL extends kt.Component{constructor(e){super(e),je(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var n,r;console.error("ErrorBoundary caught an error:",e),console.error("Component stack:",t.componentStack),this.setState({errorInfo:t}),null==(r=(n=this.props).onError)||r.call(n,e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:Ot.jsx("div",{style:kL.container,children:Ot.jsxs("div",{style:kL.card,children:[Ot.jsx("div",{style:kL.iconContainer,children:Ot.jsx("span",{style:kL.icon,children:"!"})}),Ot.jsx("h2",{style:kL.title,children:"Something went wrong"}),Ot.jsx("p",{style:kL.message,children:"An unexpected error occurred. Please try again or refresh the page."}),this.state.error&&Ot.jsxs("details",{style:kL.details,children:[Ot.jsx("summary",{style:kL.summary,children:"Error Details"}),Ot.jsx("pre",{style:kL.errorText,children:this.state.error.toString()}),this.state.errorInfo&&Ot.jsx("pre",{style:kL.stackTrace,children:this.state.errorInfo.componentStack})]}),Ot.jsxs("div",{style:kL.buttonContainer,children:[Ot.jsx("button",{onClick:this.handleReset,style:kL.button,children:"Try Again"}),Ot.jsx("button",{onClick:()=>window.location.reload(),style:kL.secondaryButton,children:"Refresh Page"})]})]})}):this.props.children}}const kL={container:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",backgroundColor:"#0d1117",padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},card:{backgroundColor:"#161b22",borderRadius:"12px",padding:"40px",maxWidth:"500px",width:"100%",textAlign:"center",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.4)",border:"1px solid #30363d"},iconContainer:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:"rgba(248, 81, 73, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},icon:{fontSize:"32px",color:"#f85149",fontWeight:"bold"},title:{color:"#e6edf3",fontSize:"24px",fontWeight:600,marginBottom:"12px",margin:"0 0 12px 0"},message:{color:"#8b949e",fontSize:"14px",lineHeight:1.6,marginBottom:"24px",margin:"0 0 24px 0"},details:{backgroundColor:"#0d1117",borderRadius:"8px",padding:"12px",marginBottom:"24px",textAlign:"left",border:"1px solid #30363d"},summary:{color:"#8b949e",cursor:"pointer",fontSize:"13px",fontWeight:500},errorText:{color:"#f85149",fontSize:"12px",marginTop:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word",margin:"12px 0 0 0"},stackTrace:{color:"#8b949e",fontSize:"11px",marginTop:"8px",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:"200px",overflow:"auto",margin:"8px 0 0 0"},buttonContainer:{display:"flex",gap:"12px",justifyContent:"center"},button:{backgroundColor:"#238636",color:"#ffffff",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"background-color 0.2s"},secondaryButton:{backgroundColor:"#21262d",color:"#c9d1d9",border:"1px solid #30363d",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"background-color 0.2s"}},PL=window.location.pathname.includes("/oauth/callback")||window.location.search.includes("code=")||window.location.search.includes("error="),AL=[{id:"cinema",labelKey:"tabs.cinema",icon:""},{id:"storyboard",labelKey:"tabs.storyboard",icon:""}];function NL(){const[e,t]=kt.useState("cinema"),{t:n,i18n:r}=yf(),i=kt.useMemo(()=>[{code:"en",label:"English"},{code:"zh-CN",label:""}],[]);return Ot.jsxs("div",{className:"directors-console",children:[Ot.jsxs("nav",{className:"directors-console__nav",children:[Ot.jsxs("div",{className:"directors-console__logo",children:[Ot.jsx("span",{className:"logo-icon",children:""}),Ot.jsx("span",{className:"logo-text",children:n("app.title")})]}),Ot.jsx("div",{className:"directors-console__tabs",children:AL.map(r=>Ot.jsxs("button",{className:"tab-button "+(e===r.id?"active":""),onClick:()=>t(r.id),children:[Ot.jsx("span",{className:"tab-icon",children:r.icon}),Ot.jsx("span",{className:"tab-label",children:n(r.labelKey)})]},r.id))}),Ot.jsx("div",{className:"directors-console__nav-right",children:Ot.jsxs("label",{className:"language-switcher",children:[Ot.jsx("span",{className:"language-switcher__label",children:n("language.label")}),Ot.jsx("select",{className:"language-switcher__select",value:r.resolvedLanguage||r.language,onChange:e=>{r.changeLanguage(e.target.value)},children:i.map(e=>Ot.jsx("option",{value:e.code,children:e.label},e.code))})]})})]}),Ot.jsxs("main",{className:"directors-console__content",children:[Ot.jsx("div",{style:{display:"cinema"===e?"contents":"none"},children:Ot.jsx(TL,{children:Ot.jsx(Zv,{})})}),Ot.jsx("div",{style:{display:"storyboard"===e?"contents":"none"},children:Ot.jsx(TL,{children:Ot.jsx(EL,{})})})]})]})}function RL(){return PL?Ot.jsx(CL,{}):Ot.jsx(TL,{children:Ot.jsx(NL,{})})}const{slice:LL,forEach:IL}=[];const jL=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,DL={create(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*n*1e3)),r&&(i.domain=r),document.cookie=function(e,t){const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let r=`${e}=${encodeURIComponent(t)}`;if(n.maxAge>0){const e=n.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(e)}`}if(n.domain){if(!jL.test(n.domain))throw new TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!jL.test(n.path))throw new TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(r+="; Partitioned"),r}(e,t,i)},read(e){const t=`${e}=`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){let e=n[r];for(;" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var OL={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return DL.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:a}=t;n&&"undefined"!=typeof document&&DL.create(n,e,r,i,a)}},UL={name:"querystring",lookup(e){var t;let n,{lookupQuerystring:r}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&(null==(t=window.location.hash)?void 0:t.indexOf("?"))>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const i=e.substring(1).split("&");for(let t=0;t<i.length;t++){const e=i[t].indexOf("=");if(e>0){i[t].substring(0,e)===r&&(n=i[t].substring(e+1))}}}return n}},FL={name:"hash",lookup(e){var t;let n,{lookupHash:r,lookupFromHashIndex:i}=e;if("undefined"!=typeof window){const{hash:e}=window.location;if(e&&e.length>2){const a=e.substring(1);if(r){const e=a.split("&");for(let t=0;t<e.length;t++){const i=e[t].indexOf("=");if(i>0){e[t].substring(0,i)===r&&(n=e[t].substring(i+1))}}}if(n)return n;if(!n&&i>-1){const n=e.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(n))return;return null==(t=n["number"==typeof i?i:0])?void 0:t.replace("/","")}}}return n}};let zL=null;const BL=()=>{if(null!==zL)return zL;try{if(zL="undefined"!=typeof window&&null!==window.localStorage,!zL)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){zL=!1}return zL};var HL={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&BL())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:n}=t;n&&BL()&&window.localStorage.setItem(n,e)}};let VL=null;const GL=()=>{if(null!==VL)return VL;try{if(VL="undefined"!=typeof window&&null!==window.sessionStorage,!VL)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){VL=!1}return VL};var WL={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&GL())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:n}=t;n&&GL()&&window.sessionStorage.setItem(n,e)}},$L={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:n,language:r}=navigator;if(e)for(let i=0;i<e.length;i++)t.push(e[i]);n&&t.push(n),r&&t.push(r)}return t.length>0?t:void 0}},XL={name:"htmlTag",lookup(e){let t,{htmlTag:n}=e;const r=n||("undefined"!=typeof document?document.documentElement:null);return r&&"function"==typeof r.getAttribute&&(t=r.getAttribute("lang")),t}},qL={name:"path",lookup(e){var t;let{lookupFromPathIndex:n}=e;if("undefined"==typeof window)return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(r))return;return null==(t=r["number"==typeof n?n:0])?void 0:t.replace("/","")}},KL={name:"subdomain",lookup(e){var t,n;let{lookupFromSubdomainIndex:r}=e;const i="number"==typeof r?r+1:1,a="undefined"!=typeof window&&(null==(n=null==(t=window.location)?void 0:t.hostname)?void 0:n.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(a)return a[i]}};let YL=!1;try{document.cookie,YL=!0}catch(nI){}const ZL=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];YL||ZL.splice(1,1);class JL{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return IL.call(LL.call(arguments,1),t=>{if(t)for(const n in t)void 0===e[n]&&(e[n]=t[n])}),e}(t,this.options||{},{order:ZL,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(OL),this.addDetector(UL),this.addDetector(HL),this.addDetector(WL),this.addDetector($L),this.addDetector(XL),this.addDetector(qL),this.addDetector(KL),this.addDetector(FL)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach(e=>{if(this.detectors[e]){let n=this.detectors[e].lookup(this.options);n&&"string"==typeof n&&(n=[n]),n&&(t=t.concat(n))}}),t=t.filter(e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(e=>e.test(t)));var t}).map(e=>this.options.convertDetectedLanguage(e)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)}))}}JL.type="languageDetector";const QL={common:{selectAll:"Select All",clear:"Clear",allWithCount:"All ({{count}})",selectedWithCount:"{{count}} selected",oneSelected:"1 selected",selectOptionsPlaceholder:"Select options..."},app:{title:"Director's Console"},tabs:{cinema:"Cinema Prompt Engineering",storyboard:"Storyboard"},language:{label:"Language",english:"English",zhCN:"Simplified Chinese"},storyboard:{project:{untitled:"Untitled Project"},panel:{dragToMove:"Drag to move panel",dragToResize:"Drag to resize",lockedTitle:"Panel locked (has generated images)",renameTitle:"Double-click to rename",removeTitle:"Remove panel",defaultLabel:"Panel {{id}}"},notes:{title:"Notes",viewMode:"View mode",editMode:"Edit mode",placeholder:"Add notes (supports Markdown)...",empty:"Click edit to add notes..."},print:{title:"Print Storyboard",grid:"Grid:",columns:"{{count}} col",page:"Page:",pageA4:"A4",pageLetter:"Letter",orientationLandscape:"Landscape",orientationPortrait:"Portrait",panels:"Panels:",all:"All",selected:"Selected",print:"Print",selectAll:"Select All",deselectAll:"Deselect All",emptyTitle:"No panels selected for printing.",emptyHint:'Choose panels with images above, or switch to "All" mode.',previewTitle:"Print Preview",documentTitle:"{{projectName}}  Storyboard",subtitle:"{{count}} panels  {{date}}"},projectSettings:{title:"Project Settings",projectName:"Project Name",projectNamePlaceholder:"My VFX Project",outputPath:"Output Folder Path",outputPathPlaceholder:"e.g., Z:\\Projects\\MyProject\\renders",browseFolders:"Browse folders",browseRequiresOnline:"Orchestrator must be online to browse folders",validatePathTitle:"Validate path",validate:"Validate",outputPathHelp:"Full path where images will be saved. Leave empty for browser downloads.",orchestratorUrl:"Orchestrator URL",statusOnline:"(Online)",statusOffline:"(Offline)",orchestratorUrlPlaceholder:"http://localhost:9820",orchestratorUrlHelp:"URL of the Director's Console Orchestrator API (for auto-save to filesystem).",namingTemplate:"Naming Template",namingTemplatePlaceholder:"{project}_Panel{panel}_{version}",availableTokens:"Available tokens:",panelTokenExplanation:'{panel} = Full panel name (e.g., "Panel_01", "Hero_Shot", "Opening_Scene")',preview:"Preview:",autoSave:"Auto-save on generation completion",autoSaveHelp:"Automatically save images when generation completes (requires output folder).",commonTemplates:"Common Templates:",templatePanelBased:"Panel-based:",templatePanelBasedResult:"Result:",templatePerPanelFolders:"Per-panel folders:",templatePerPanelFoldersResult:"Creates",templateShotBased:"Shot-based:",templateTimestamped:"Timestamped:",templateSeedBased:"Seed-based:",cancel:"Cancel",save:"Save Settings",selectOutputFolder:"Select Output Folder"},nodes:{title:"Render Nodes",restartSelectedTitle:"Restart {{count}} selected node(s)",restarting:"Restarting...",restart:"Restart {{count}}",selectAtLeastOne:"Please select at least one node to restart",nodeNamePlaceholder:"Node Name (e.g., 5090-Node-1)",nodeUrlPlaceholder:"ComfyUI URL (e.g., http://192.168.1.100:8188)",addNode:"Add Node",stopMonitoring:"Stop Monitoring",startMonitoring:"Start Monitoring",selectAll:"Select All ({{selected}}/{{total}})",noNodes:"No render nodes configured. Add nodes to distribute rendering.",remove:"Remove",gpu:"GPU:",vram:"VRAM:",gpuUsage:"GPU Usage:"},deleteConfirm:{title:"Delete Image?",prompt:"Are you sure you want to permanently delete:",warning:"This will remove the file from disk and cannot be undone.",dontAskAgain:"Don't ask again this session",cancel:"Cancel",delete:"Delete"},workflowCategories:{title:"Manage Workflow Categories",searchPlaceholder:"Search workflows...",noCategories:"No categories",assignTitle:"Assign Categories to: {{name}}",help:"Select all categories that apply to this workflow. A workflow can have multiple categories.",selectedTitle:"Selected Categories:",noneSelected:"No categories selected",save:"Save Categories",cancel:"Cancel",selectWorkflowHint:"Select a workflow from the list to assign categories",categories:{imageGeneration:"Image Generation",textToImage:"Text to Image",imageToImage:"Image to Image",inPainting:"InPainting",imageEditing:"Image Editing",upscaling:"Upscaling",videoGeneration:"Video Generation"}},fileBrowser:{selectFolder:"Select Folder",loadProject:"Load Project",saveProjectAs:"Save Project As",selectOutputFolder:"Select Output Folder",openProject:"Open Project",save:"Save",projectNameLabel:"Project Name:",projectNamePlaceholder:"Enter project name...",newFolder:"New Folder",newFolderNamePlaceholder:"New folder name...",create:"Create",cancel:"Cancel",selected:"Selected:",pleaseSelectFolder:"Please select a folder",pleaseSelectProject:"Please select a project file to open",pleaseEnterProjectName:"Please enter a project name",pleaseSelectSaveFolder:"Please select a folder to save in",failedToCreateFolder:"Failed to create folder",errorCreatingFolder:"Error creating folder: {{error}}",breadcrumb:{computer:"Computer",goToComputer:"Go to Computer",enterPath:"Enter path...",clickToEdit:"Click to edit path",refresh:"Refresh"},tree:{quickAccess:"Quick Access",noDrives:"No drives found",empty:"(empty)"},contents:{loading:"Loading...",empty:"This folder is empty",folders:"Folders ({{count}})",projects:"Projects ({{count}})",panels:"{{count}} panels",justNow:"Just now",minutesAgo:"{{count}} minutes ago",hoursAgo:"{{count}} hours ago",yesterday:"Yesterday",daysAgo:"{{count}} days ago",weeksAgo:"{{count}} weeks ago"}},folderBrowser:{title:"Select Folder",orchestratorNotConfigured:"Orchestrator URL not configured",failedToLoadFolder:"Failed to load folder",failedToConnect:"Failed to connect: {{error}}",failedToCreateFolder:"Failed to create folder: {{error}}",goToParent:"Go to parent folder",enterPath:"Enter path...",refresh:"Refresh",loading:"Loading...",noFolders:"No folders found",newFolderNamePlaceholder:"New folder name...",create:"Create",cancel:"Cancel",noFolderSelected:"No folder selected",newFolder:"New Folder",select:"Select"},mediaInput:{dropVideoHere:"Drop video here",dragVideoOrBrowse:"Drag video or browse",dropMediaHere:"Drop media here",dragImageVideoOrBrowse:"Drag image/video or browse",dropImageHere:"Drop image here",dragImageFromCanvasOrBrowse:"Drag image from canvas or browse",browse:"Browse...",enableThisInput:"Enable this input",bypassThisInput:"Bypass this input (skip in workflow)",bypassed:"Bypassed",active:"Active",inputBypassed:"Input bypassed",inputSkipped:"This input will be skipped",cropImage:"Crop image",addMask:"Add mask",paintOnImage:"Paint on image",removeMedia:"Remove media"},parameters:{title:"Parameters",empty:"No parameters available for this template.",randomizeSeed:"Randomize seed",clearAngle:"Clear angle",pasteFromCpe:"Paste prompt from Cinema Prompt Engineering",selectCameraAngle:"Select camera angle",enhancingPrompt:"Enhancing prompt...",enhanceWithAi:"Enhance with AI",promptPlaceholderPositive:"Enter positive prompt...",promptPlaceholderNegative:"Enter negative prompt...",lora:{enable:"Enable this LoRA",bypass:"Bypass this LoRA",bypassed:"Bypassed",active:"Active",selectPlaceholder:"-- Select LoRA --",strength:"Strength",bypassedHint:"LoRA bypassed - will not be applied"}},cropMaskEditor:{cropImage:"Crop Image",editMask:"Edit Mask",paintOnImage:"Paint on Image",tabCrop:"Crop",tabMask:"Mask",tabPaint:"Paint",aspectRatio:"Aspect Ratio:",resetCropTitle:"Reset crop to full image",reset:"Reset",size:"Size:",opacity:"Opacity:",add:"Add",erase:"Erase",clear:"Clear",color:"Color:",cancel:"Cancel",applyCrop:"Apply Crop",saveMask:"Save Mask",applyChanges:"Apply Changes"},workflowEditor:{title:"Workflow Editor",noWorkflow:"No workflow loaded. Please import a workflow first.",close:"Close",cancel:"Cancel",saveConfiguration:"Save Configuration",tabExposed:"Exposed Parameters ({{count}})",tabAllNodes:"All Nodes",searchPlaceholder:"Search parameters...",noExposed:'No exposed parameters. Add parameters from the "All Nodes" tab.',unsaved:"Unsaved changes will be auto-saved",dragToReorder:"Drag to reorder",displayNamePlaceholder:"Display Name",removeParameter:"Remove parameter",internalNameLabel:"Name (internal):",internalNamePlaceholder:"snake_case_name",parameterDescriptionPlaceholder:"Parameter description",enumOptionsPlaceholder:"option1, option2, option3",fetchOptionsTitle:"Fetch options from ComfyUI",fetchOptions:"Fetch Options",defaultValueLabel:"Default Value:",descriptionLabel:"Description:",min:"Min:",max:"Max:",step:"Step:",optionsCommaSeparated:"Options (comma-separated):",noEnumOptionsFound:"No enum options found for {{classType}}.{{inputName}}.\nMake sure ComfyUI is connected.",exposedInUi:"Exposed in UI",autoDetected:"Auto-detected",userDefined:"User-defined"},menu:{project:"Project",system:"System",newProject:"New Project",loadProject:"Load Project",saveProject:"Save Project",saveAs:"Save As...",projectSettings:"Project Settings",printStoryboard:"Print Storyboard",manageNodes:"Manage Nodes",restartNodes:"Restart Nodes",cancelAllGenerations:"Cancel All Generations",loading:"Loading...",saving:"Saving...",restarting:"Restarting...",noNodesToRestart:"No nodes available to restart",restartNodesTitle:"Restart all ComfyUI backends",cancelAllTitle:"Cancel all running generations",cancelDisabledTitle:"No generations running"}},settings:{title:"AI Provider Settings",close:"Close settings",selectProvider:"Select AI Provider",selectProviderPlaceholder:"-- Select a provider --",cloudApi:"Cloud API (API Key)",localNoAuth:"Local (No Auth)",oauth:"OAuth",configuration:"Configuration",unsavedChangesConfirm:"You have unsaved changes. Discard them?",status:{disconnected:"Not connected",connecting:"Connecting...",connected:"Connected",error:"Connection failed"}},cpe:{sections:{camera:"Camera",lens:"Lens",movement:"Movement",lighting:"Lighting",visualGrammar:"Visual Grammar",style:"Style",rendering:"Rendering",motion:"Motion"},fields:{cameraType:"Camera Type",manufacturer:"Manufacturer",body:"Body",filmStock:"Film Stock",aspectRatio:"Aspect Ratio",timeOfDay:"Time of Day",lightingSource:"Source",lightingStyle:"Style",composition:"Composition",shotSize:"Shot Size",mood:"Mood",colorTone:"Color Tone",medium:"Medium",styleDomain:"Style Domain",lineTreatment:"Line Treatment",colorApplication:"Color Application",lightingModel:"Lighting Model",surfaceDetail:"Surface Detail",motionStyle:"Motion Style",virtualCamera:"Virtual Camera"},placeholders:{describeScene:"Describe your scene...",selectFilmStock:"Select Film Stock..."},hints:{limitedByCameraWeight:"(limited by camera weight)",dollyZoomRequiresEquipment:"(Dolly Zoom requires Dolly/Slider)",filteredByEquipment:"(filtered by equipment)",dollyZoomRequiresSlowerTiming:"(Dolly Zoom requires slower timing)",filteredByTimeAndMood:"(filtered by time & mood)",filteredByPreset:"(filtered by preset)",mangaMonochromeOnly:"(Manga: Monochrome only)",mangaGraphicOnly:"(Manga: Graphic only)",threeDNoFlatLighting:"(3D: No Flat lighting)",staticOnly:"(static only)"},status:{validating:"validating..."},loading:{presets:"Loading presets...",cinematography:"Loading cinematography details..."},cinematography:{cinematographer:"Cinematographer",camera:"Camera",filmStock:"Film Stock",aspectRatio:"Aspect Ratio",lenses:"Lenses",lightingSignature:"Lighting Signature",colorPalette:"Color Palette",notableTechniques:"Notable Techniques",movementStyle:"Movement Style",legacyInfluence:"Legacy & Influence",lineTreatment:"Line Treatment:",color:"Color:",lighting:"Lighting:",motion:"Motion:",reference:"Reference:",disallowedMoods:"Disallowed moods:",disallowedMotion:"Disallowed motion:"}}},eI={common:{selectAll:"",clear:"",allWithCount:"{{count}}",selectedWithCount:" {{count}} ",oneSelected:" 1 ",selectOptionsPlaceholder:"..."},app:{title:"Director's Console"},tabs:{cinema:"",storyboard:""},language:{label:"",english:"English",zhCN:""},storyboard:{project:{untitled:""},panel:{dragToMove:"",dragToResize:"",lockedTitle:"",renameTitle:"",removeTitle:"",defaultLabel:" {{id}}"},notes:{title:"",viewMode:"",editMode:"",placeholder:" Markdown...",empty:"..."},print:{title:"",grid:"",columns:"{{count}} ",page:"",pageA4:"A4",pageLetter:"Letter",orientationLandscape:"",orientationPortrait:"",panels:"",all:"",selected:"",print:"",selectAll:"",deselectAll:"",emptyTitle:"",emptyHint:' "" ',previewTitle:"",documentTitle:"{{projectName}}  ",subtitle:"{{count}}   {{date}}"},projectSettings:{title:"",projectName:"",projectNamePlaceholder:" VFX ",outputPath:"",outputPathPlaceholder:"Z:\\Projects\\MyProject\\renders",browseFolders:"",browseRequiresOnline:"Orchestrator ",validatePathTitle:"",validate:"",outputPathHelp:"",orchestratorUrl:"Orchestrator ",statusOnline:"",statusOffline:"",orchestratorUrlPlaceholder:"http://localhost:9820",orchestratorUrlHelp:"Director's Console Orchestrator API ",namingTemplate:"",namingTemplatePlaceholder:"{project}_Panel{panel}_{version}",availableTokens:"",panelTokenExplanation:'{panel} = "Panel_01""Hero_Shot""Opening_Scene"',preview:"",autoSave:"",autoSaveHelp:"",commonTemplates:"",templatePanelBased:"",templatePanelBasedResult:"",templatePerPanelFolders:"",templatePerPanelFoldersResult:"",templateShotBased:"",templateTimestamped:"",templateSeedBased:"",cancel:"",save:"",selectOutputFolder:""},nodes:{title:"",restartSelectedTitle:" {{count}} ",restarting:"...",restart:" {{count}}",selectAtLeastOne:"",nodeNamePlaceholder:"5090-Node-1",nodeUrlPlaceholder:"ComfyUI http://192.168.1.100:8188",addNode:"",stopMonitoring:"",startMonitoring:"",selectAll:"{{selected}}/{{total}}",noNodes:"",remove:"",gpu:"GPU",vram:"",gpuUsage:"GPU "},deleteConfirm:{title:"",prompt:"",warning:"",dontAskAgain:"",cancel:"",delete:""},workflowCategories:{title:"",searchPlaceholder:"...",noCategories:"",assignTitle:"{{name}}",help:"",selectedTitle:"",noneSelected:"",save:"",cancel:"",selectWorkflowHint:"",categories:{imageGeneration:"",textToImage:"",imageToImage:"",inPainting:"",imageEditing:"",upscaling:"",videoGeneration:""}},fileBrowser:{selectFolder:"",loadProject:"",saveProjectAs:"",selectOutputFolder:"",openProject:"",save:"",projectNameLabel:"",projectNamePlaceholder:"...",newFolder:"",newFolderNamePlaceholder:"...",create:"",cancel:"",selected:"",pleaseSelectFolder:"",pleaseSelectProject:"",pleaseEnterProjectName:"",pleaseSelectSaveFolder:"",failedToCreateFolder:"",errorCreatingFolder:"{{error}}",breadcrumb:{computer:"",goToComputer:"",enterPath:"...",clickToEdit:"",refresh:""},tree:{quickAccess:"",noDrives:"",empty:""},contents:{loading:"...",empty:"",folders:"{{count}}",projects:"{{count}}",panels:"{{count}} ",justNow:"",minutesAgo:"{{count}} ",hoursAgo:"{{count}} ",yesterday:"",daysAgo:"{{count}} ",weeksAgo:"{{count}} "}},mediaInput:{dropVideoHere:"",dragVideoOrBrowse:"",dropMediaHere:"",dragImageVideoOrBrowse:"/",dropImageHere:"",dragImageFromCanvasOrBrowse:"",browse:"...",enableThisInput:"",bypassThisInput:"",bypassed:"",active:"",inputBypassed:"",inputSkipped:"",cropImage:"",addMask:"",paintOnImage:"",removeMedia:""},parameters:{title:"",empty:"",randomizeSeed:"",clearAngle:"",pasteFromCpe:"",selectCameraAngle:"",enhancingPrompt:"...",enhanceWithAi:" AI ",promptPlaceholderPositive:"...",promptPlaceholderNegative:"...",lora:{enable:" LoRA",bypass:" LoRA",bypassed:"",active:"",selectPlaceholder:"--  LoRA --",strength:"",bypassedHint:"LoRA  - "}},cropMaskEditor:{cropImage:"",editMask:"",paintOnImage:"",tabCrop:"",tabMask:"",tabPaint:"",aspectRatio:"",resetCropTitle:"",reset:"",size:"",opacity:"",add:"",erase:"",clear:"",color:"",cancel:"",applyCrop:"",saveMask:"",applyChanges:""},workflowEditor:{title:"",noWorkflow:"",close:"",cancel:"",saveConfiguration:"",tabExposed:"{{count}}",tabAllNodes:"",searchPlaceholder:"...",noExposed:' "" ',unsaved:"",dragToReorder:"",displayNamePlaceholder:"",removeParameter:"",internalNameLabel:"",internalNamePlaceholder:"snake_case_name",parameterDescriptionPlaceholder:"",enumOptionsPlaceholder:"option1, option2, option3",fetchOptionsTitle:" ComfyUI ",fetchOptions:"",defaultValueLabel:"",descriptionLabel:"",min:"",max:"",step:"",optionsCommaSeparated:"",noEnumOptionsFound:" {{classType}}.{{inputName}} \n ComfyUI",exposedInUi:"",autoDetected:"",userDefined:""},menu:{project:"",system:"",newProject:"",loadProject:"",saveProject:"",saveAs:"...",projectSettings:"",printStoryboard:"",manageNodes:"",restartNodes:"",cancelAllGenerations:"",loading:"...",saving:"...",restarting:"...",noNodesToRestart:"",restartNodesTitle:" ComfyUI ",cancelAllTitle:"",cancelDisabledTitle:""}},settings:{title:"AI ",close:"",selectProvider:" AI ",selectProviderPlaceholder:"--  --",cloudApi:" API (API Key)",localNoAuth:" ()",oauth:"OAuth",configuration:"",unsavedChangesConfirm:"",status:{disconnected:"",connecting:"...",connected:"",error:""}},cpe:{sections:{camera:"",lens:"",movement:"",lighting:"",visualGrammar:"",style:"",rendering:"",motion:""},fields:{cameraType:"",manufacturer:"",body:"",filmStock:"",aspectRatio:"",timeOfDay:"",lightingSource:"",lightingStyle:"",composition:"",shotSize:"",mood:"",colorTone:"",medium:"",styleDomain:"",lineTreatment:"",colorApplication:"",lightingModel:"",surfaceDetail:"",motionStyle:"",virtualCamera:""},placeholders:{describeScene:"...",selectFilmStock:"..."},hints:{limitedByCameraWeight:"",dollyZoomRequiresEquipment:" Dolly/Slider",filteredByEquipment:"",dollyZoomRequiresSlowerTiming:"",filteredByTimeAndMood:"",filteredByPreset:"",mangaMonochromeOnly:"",mangaGraphicOnly:"/",threeDNoFlatLighting:"3D Flat ",staticOnly:""},status:{validating:"..."},loading:{presets:"...",cinematography:"..."},cinematography:{cinematographer:"",camera:"",filmStock:"",aspectRatio:"",lenses:"",lightingSignature:"",colorPalette:"",notableTechniques:"",movementStyle:"",legacyInfluence:"",lineTreatment:"",color:"",lighting:"",motion:"",reference:"",disallowedMoods:"",disallowedMotion:""}}};Vm.use(JL).use(tf).init({resources:{en:{translation:QL},"zh-CN":{translation:eI}},fallbackLng:"en",supportedLngs:["en","zh-CN"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"],lookupLocalStorage:"directors-console.language"},react:{useSuspense:!1},initImmediate:!1});const tI=new $p;Ut.createRoot(document.getElementById("root")).render(Ot.jsx(Pt.StrictMode,{children:Ot.jsx(qp,{client:tI,children:Ot.jsx(RL,{})})}));
