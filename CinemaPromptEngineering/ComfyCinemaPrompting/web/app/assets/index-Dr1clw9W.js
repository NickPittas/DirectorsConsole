var e,t,n,i,r,a,o,s,l,c,u,d,h,p,m,f,g,v,y,_,x,b,S,w,M,E,C,T,P,k,A,N,R,L,I,j,D,U,O,F,z,B,H,V,W,G,$,X,q,K,Y,Z,J,Q,ee,te,ne,ie,re,ae,oe,se,le,ce,ue,de,he,pe,me,fe,ge,ve,ye,_e,xe,be,Se,we,Me,Ee,Ce,Te,Pe,ke,Ae,Ne,Re,Le=Object.defineProperty,Ie=e=>{throw TypeError(e)},je=(e,t,n)=>((e,t,n)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),De=(e,t,n)=>t.has(e)||Ie("Cannot "+n),Ue=(e,t,n)=>(De(e,t,"read from private field"),n?n.call(e):t.get(e)),Oe=(e,t,n)=>t.has(e)?Ie("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Fe=(e,t,n,i)=>(De(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),ze=(e,t,n)=>(De(e,t,"access private method"),n),Be=(e,t,n,i)=>({set _(i){Fe(e,t,i,n)},get _(){return Ue(e,t,i)}});!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var He="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var We={exports:{}},Ge={},$e={exports:{}},Xe={},qe=Symbol.for("react.element"),Ke=Symbol.for("react.portal"),Ye=Symbol.for("react.fragment"),Ze=Symbol.for("react.strict_mode"),Je=Symbol.for("react.profiler"),Qe=Symbol.for("react.provider"),et=Symbol.for("react.context"),tt=Symbol.for("react.forward_ref"),nt=Symbol.for("react.suspense"),it=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),at=Symbol.iterator;var ot={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},st=Object.assign,lt={};function ct(e,t,n){this.props=e,this.context=t,this.refs=lt,this.updater=n||ot}function ut(){}function dt(e,t,n){this.props=e,this.context=t,this.refs=lt,this.updater=n||ot}ct.prototype.isReactComponent={},ct.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ct.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},ut.prototype=ct.prototype;var ht=dt.prototype=new ut;ht.constructor=dt,st(ht,ct.prototype),ht.isPureReactComponent=!0;var pt=Array.isArray,mt=Object.prototype.hasOwnProperty,ft={current:null},gt={key:!0,ref:!0,__self:!0,__source:!0};function vt(e,t,n){var i,r={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)mt.call(t,i)&&!gt.hasOwnProperty(i)&&(r[i]=t[i]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var l=Array(s),c=0;c<s;c++)l[c]=arguments[c+2];r.children=l}if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===r[i]&&(r[i]=s[i]);return{$$typeof:qe,type:e,key:a,ref:o,props:r,_owner:ft.current}}function yt(e){return"object"==typeof e&&null!==e&&e.$$typeof===qe}var _t=/\/+/g;function xt(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function bt(e,t,n,i,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var o=!1;if(null===e)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case qe:case Ke:o=!0}}if(o)return r=r(o=e),e=""===i?"."+xt(o,0):i,pt(r)?(n="",null!=e&&(n=e.replace(_t,"$&/")+"/"),bt(r,t,n,"",function(e){return e})):null!=r&&(yt(r)&&(r=function(e,t){return{$$typeof:qe,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(_t,"$&/")+"/")+e)),t.push(r)),1;if(o=0,i=""===i?".":i+":",pt(e))for(var s=0;s<e.length;s++){var l=i+xt(a=e[s],s);o+=bt(a,t,n,l,r)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=at&&e[at]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),s=0;!(a=e.next()).done;)o+=bt(a=a.value,t,n,l=i+xt(a,s++),r);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function St(e,t,n){if(null==e)return e;var i=[],r=0;return bt(e,i,"","",function(e){return t.call(n,e,r++)}),i}function wt(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var Mt={current:null},Et={transition:null},Ct={ReactCurrentDispatcher:Mt,ReactCurrentBatchConfig:Et,ReactCurrentOwner:ft};function Tt(){throw Error("act(...) is not supported in production builds of React.")}Xe.Children={map:St,forEach:function(e,t,n){St(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return St(e,function(){t++}),t},toArray:function(e){return St(e,function(e){return e})||[]},only:function(e){if(!yt(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Xe.Component=ct,Xe.Fragment=Ye,Xe.Profiler=Je,Xe.PureComponent=dt,Xe.StrictMode=Ze,Xe.Suspense=nt,Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ct,Xe.act=Tt,Xe.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=st({},e.props),r=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=ft.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(l in t)mt.call(t,l)&&!gt.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==s?s[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){s=Array(l);for(var c=0;c<l;c++)s[c]=arguments[c+2];i.children=s}return{$$typeof:qe,type:e.type,key:r,ref:a,props:i,_owner:o}},Xe.createContext=function(e){return(e={$$typeof:et,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:Qe,_context:e},e.Consumer=e},Xe.createElement=vt,Xe.createFactory=function(e){var t=vt.bind(null,e);return t.type=e,t},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(e){return{$$typeof:tt,render:e}},Xe.isValidElement=yt,Xe.lazy=function(e){return{$$typeof:rt,_payload:{_status:-1,_result:e},_init:wt}},Xe.memo=function(e,t){return{$$typeof:it,type:e,compare:void 0===t?null:t}},Xe.startTransition=function(e){var t=Et.transition;Et.transition={};try{e()}finally{Et.transition=t}},Xe.unstable_act=Tt,Xe.useCallback=function(e,t){return Mt.current.useCallback(e,t)},Xe.useContext=function(e){return Mt.current.useContext(e)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(e){return Mt.current.useDeferredValue(e)},Xe.useEffect=function(e,t){return Mt.current.useEffect(e,t)},Xe.useId=function(){return Mt.current.useId()},Xe.useImperativeHandle=function(e,t,n){return Mt.current.useImperativeHandle(e,t,n)},Xe.useInsertionEffect=function(e,t){return Mt.current.useInsertionEffect(e,t)},Xe.useLayoutEffect=function(e,t){return Mt.current.useLayoutEffect(e,t)},Xe.useMemo=function(e,t){return Mt.current.useMemo(e,t)},Xe.useReducer=function(e,t,n){return Mt.current.useReducer(e,t,n)},Xe.useRef=function(e){return Mt.current.useRef(e)},Xe.useState=function(e){return Mt.current.useState(e)},Xe.useSyncExternalStore=function(e,t,n){return Mt.current.useSyncExternalStore(e,t,n)},Xe.useTransition=function(){return Mt.current.useTransition()},Xe.version="18.3.1",$e.exports=Xe;var Pt=$e.exports;const kt=Ve(Pt);
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var At=Pt,Nt=Symbol.for("react.element"),Rt=Symbol.for("react.fragment"),Lt=Object.prototype.hasOwnProperty,It=At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jt={key:!0,ref:!0,__self:!0,__source:!0};function Dt(e,t,n){var i,r={},a=null,o=null;for(i in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)Lt.call(t,i)&&!jt.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:Nt,type:e,key:a,ref:o,props:r,_owner:It.current}}Ge.Fragment=Rt,Ge.jsx=Dt,Ge.jsxs=Dt,We.exports=Ge;var Ut=We.exports,Ot={},Ft={exports:{}},zt={},Bt={exports:{}},Ht={};
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,a=e[i];if(!(0<r(a,t)))break e;e[i]=t,e[n]=a,n=i}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,a=e.length,o=a>>>1;i<o;){var s=2*(i+1)-1,l=e[s],c=s+1,u=e[c];if(0>r(l,n))c<a&&0>r(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[s]=n,i=s);else{if(!(c<a&&0>r(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,h=3,p=!1,m=!1,f=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var r=n(c);null!==r;){if(null===r.callback)i(c);else{if(!(r.startTime<=e))break;i(c),r.sortIndex=r.expirationTime,t(l,r)}r=n(c)}}function x(e){if(f=!1,_(e),!m)if(null!==n(l))m=!0,R(b);else{var t=n(c);null!==t&&L(x,t.startTime-e)}}function b(t,r){m=!1,f&&(f=!1,v(E),E=-1),p=!0;var a=h;try{for(_(r),d=n(l);null!==d&&(!(d.expirationTime>r)||t&&!P());){var o=d.callback;if("function"==typeof o){d.callback=null,h=d.priorityLevel;var s=o(d.expirationTime<=r);r=e.unstable_now(),"function"==typeof s?d.callback=s:d===n(l)&&i(l),_(r)}else i(l);d=n(l)}if(null!==d)var u=!0;else{var g=n(c);null!==g&&L(x,g.startTime-r),u=!1}return u}finally{d=null,h=a,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,w=!1,M=null,E=-1,C=5,T=-1;function P(){return!(e.unstable_now()-T<C)}function k(){if(null!==M){var t=e.unstable_now();T=t;var n=!0;try{n=M(!0,t)}finally{n?S():(w=!1,M=null)}}else w=!1}if("function"==typeof y)S=function(){y(k)};else if("undefined"!=typeof MessageChannel){var A=new MessageChannel,N=A.port2;A.port1.onmessage=k,S=function(){N.postMessage(null)}}else S=function(){g(k,0)};function R(e){M=e,w||(w=!0,S())}function L(t,n){E=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,R(b))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(i,r,a){var o=e.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?o+a:o:a=o,i){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return i={id:u++,callback:r,priorityLevel:i,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(i.sortIndex=a,t(c,i),null===n(l)&&i===n(c)&&(f?(v(E),E=-1):f=!0,L(x,a-o))):(i.sortIndex=s,t(l,i),m||p||(m=!0,R(b))),i},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(Ht),Bt.exports=Ht;var Vt=Bt.exports,Wt=Pt,Gt=Vt;
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function $t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Xt=new Set,qt={};function Kt(e,t){Yt(e,t),Yt(e+"Capture",t)}function Yt(e,t){for(qt[e]=t,e=0;e<t.length;e++)Xt.add(t[e])}var Zt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Jt=Object.prototype.hasOwnProperty,Qt=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,en={},tn={};function nn(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var rn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){rn[e]=new nn(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];rn[t]=new nn(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){rn[e]=new nn(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){rn[e]=new nn(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){rn[e]=new nn(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){rn[e]=new nn(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){rn[e]=new nn(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){rn[e]=new nn(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){rn[e]=new nn(e,5,!1,e.toLowerCase(),null,!1,!1)});var an=/[\-:]([a-z])/g;function on(e){return e[1].toUpperCase()}function sn(e,t,n,i){var r=rn.hasOwnProperty(t)?rn[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!Jt.call(tn,e)||!Jt.call(en,e)&&(Qt.test(e)?tn[e]=!0:(en[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(an,on);rn[t]=new nn(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(an,on);rn[t]=new nn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(an,on);rn[t]=new nn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){rn[e]=new nn(e,1,!1,e.toLowerCase(),null,!1,!1)}),rn.xlinkHref=new nn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){rn[e]=new nn(e,1,!1,e.toLowerCase(),null,!0,!0)});var ln=Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cn=Symbol.for("react.element"),un=Symbol.for("react.portal"),dn=Symbol.for("react.fragment"),hn=Symbol.for("react.strict_mode"),pn=Symbol.for("react.profiler"),mn=Symbol.for("react.provider"),fn=Symbol.for("react.context"),gn=Symbol.for("react.forward_ref"),vn=Symbol.for("react.suspense"),yn=Symbol.for("react.suspense_list"),_n=Symbol.for("react.memo"),xn=Symbol.for("react.lazy"),bn=Symbol.for("react.offscreen"),Sn=Symbol.iterator;function wn(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Sn&&e[Sn]||e["@@iterator"])?e:null}var Mn,En=Object.assign;function Cn(e){if(void 0===Mn)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Mn=t&&t[1]||""}return"\n"+Mn+e}var Tn=!1;function Pn(e,t){if(!e||Tn)return"";Tn=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"==typeof c.stack){for(var r=c.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{Tn=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Cn(e):""}function kn(e){switch(e.tag){case 5:return Cn(e.type);case 16:return Cn("Lazy");case 13:return Cn("Suspense");case 19:return Cn("SuspenseList");case 0:case 2:case 15:return e=Pn(e.type,!1);case 11:return e=Pn(e.type.render,!1);case 1:return e=Pn(e.type,!0);default:return""}}function An(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case dn:return"Fragment";case un:return"Portal";case pn:return"Profiler";case hn:return"StrictMode";case vn:return"Suspense";case yn:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case fn:return(e.displayName||"Context")+".Consumer";case mn:return(e._context.displayName||"Context")+".Provider";case gn:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case _n:return null!==(t=e.displayName||null)?t:An(e.type)||"Memo";case xn:t=e._payload,e=e._init;try{return An(e(t))}catch(n){}}return null}function Nn(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return An(t);case 8:return t===hn?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function Rn(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Ln(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function In(e){e._valueTracker||(e._valueTracker=function(e){var t=Ln(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function jn(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=Ln(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Dn(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Un(e,t){var n=t.checked;return En({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function On(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=Rn(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Fn(e,t){null!=(t=t.checked)&&sn(e,"checked",t,!1)}function zn(e,t){Fn(e,t);var n=Rn(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?Hn(e,t.type,n):t.hasOwnProperty("defaultValue")&&Hn(e,t.type,Rn(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Bn(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Hn(e,t,n){"number"===t&&Dn(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Vn=Array.isArray;function Wn(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Rn(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function Gn(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error($t(91));return En({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function $n(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error($t(92));if(Vn(n)){if(1<n.length)throw Error($t(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Rn(n)}}function Xn(e,t){var n=Rn(t.value),i=Rn(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function qn(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function Kn(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yn(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Kn(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Zn,Jn,Qn=(Jn=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((Zn=Zn||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Zn.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return Jn(e,t)})}:Jn);function ei(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ti={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ni=["Webkit","ms","Moz","O"];function ii(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||ti.hasOwnProperty(e)&&ti[e]?(""+t).trim():t+"px"}function ri(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ii(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(ti).forEach(function(e){ni.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ti[t]=ti[e]})});var ai=En({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function oi(e,t){if(t){if(ai[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error($t(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error($t(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error($t(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error($t(62))}}function si(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var li=null;function ci(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ui=null,di=null,hi=null;function pi(e){if(e=ss(e)){if("function"!=typeof ui)throw Error($t(280));var t=e.stateNode;t&&(t=cs(t),ui(e.stateNode,e.type,t))}}function mi(e){di?hi?hi.push(e):hi=[e]:di=e}function fi(){if(di){var e=di,t=hi;if(hi=di=null,pi(e),t)for(e=0;e<t.length;e++)pi(t[e])}}function gi(e,t){return e(t)}function vi(){}var yi=!1;function _i(e,t,n){if(yi)return e(t,n);yi=!0;try{return gi(e,t,n)}finally{yi=!1,(null!==di||null!==hi)&&(vi(),fi())}}function xi(e,t){var n=e.stateNode;if(null===n)return null;var i=cs(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error($t(231,t,typeof n));return n}var bi=!1;if(Zt)try{var Si={};Object.defineProperty(Si,"passive",{get:function(){bi=!0}}),window.addEventListener("test",Si,Si),window.removeEventListener("test",Si,Si)}catch(Jn){bi=!1}function wi(e,t,n,i,r,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Mi=!1,Ei=null,Ci=!1,Ti=null,Pi={onError:function(e){Mi=!0,Ei=e}};function ki(e,t,n,i,r,a,o,s,l){Mi=!1,Ei=null,wi.apply(Pi,arguments)}function Ai(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ni(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ri(e){if(Ai(e)!==e)throw Error($t(188))}function Li(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ai(e)))throw Error($t(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Ri(r),e;if(a===i)return Ri(r),t;a=a.sibling}throw Error($t(188))}if(n.return!==i.return)n=r,i=a;else{for(var o=!1,s=r.child;s;){if(s===n){o=!0,n=r,i=a;break}if(s===i){o=!0,i=r,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,i=r;break}if(s===i){o=!0,i=a,n=r;break}s=s.sibling}if(!o)throw Error($t(189))}}if(n.alternate!==i)throw Error($t(190))}if(3!==n.tag)throw Error($t(188));return n.stateNode.current===n?e:t}(e))?Ii(e):null}function Ii(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ii(e);if(null!==t)return t;e=e.sibling}return null}var ji=Gt.unstable_scheduleCallback,Di=Gt.unstable_cancelCallback,Ui=Gt.unstable_shouldYield,Oi=Gt.unstable_requestPaint,Fi=Gt.unstable_now,zi=Gt.unstable_getCurrentPriorityLevel,Bi=Gt.unstable_ImmediatePriority,Hi=Gt.unstable_UserBlockingPriority,Vi=Gt.unstable_NormalPriority,Wi=Gt.unstable_LowPriority,Gi=Gt.unstable_IdlePriority,$i=null,Xi=null;var qi=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(Ki(e)/Yi|0)|0},Ki=Math.log,Yi=Math.LN2;var Zi=64,Ji=4194304;function Qi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function er(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=Qi(s):0!==(a&=o)&&(i=Qi(a))}else 0!==(o=n&~r)?i=Qi(o):0!==a&&(i=Qi(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&4194240&a))return t;if(4&i&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-qi(t)),i|=e[n],t&=~r;return i}function tr(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function nr(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ir(){var e=Zi;return!(4194240&(Zi<<=1))&&(Zi=64),e}function rr(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ar(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-qi(t)]=n}function or(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-qi(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var sr=0;function lr(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var cr,ur,dr,hr,pr,mr=!1,fr=[],gr=null,vr=null,yr=null,_r=new Map,xr=new Map,br=[],Sr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wr(e,t){switch(e){case"focusin":case"focusout":gr=null;break;case"dragenter":case"dragleave":vr=null;break;case"mouseover":case"mouseout":yr=null;break;case"pointerover":case"pointerout":_r.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xr.delete(t.pointerId)}}function Mr(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=ss(t))&&ur(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Er(e){var t=os(e.target);if(null!==t){var n=Ai(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ni(n)))return e.blockedOn=t,void pr(e.priority,function(){dr(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Cr(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ur(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ss(n))&&ur(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);li=i,n.target.dispatchEvent(i),li=null,t.shift()}return!0}function Tr(e,t,n){Cr(e)&&n.delete(t)}function Pr(){mr=!1,null!==gr&&Cr(gr)&&(gr=null),null!==vr&&Cr(vr)&&(vr=null),null!==yr&&Cr(yr)&&(yr=null),_r.forEach(Tr),xr.forEach(Tr)}function kr(e,t){e.blockedOn===t&&(e.blockedOn=null,mr||(mr=!0,Gt.unstable_scheduleCallback(Gt.unstable_NormalPriority,Pr)))}function Ar(e){function t(t){return kr(t,e)}if(0<fr.length){kr(fr[0],e);for(var n=1;n<fr.length;n++){var i=fr[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==gr&&kr(gr,e),null!==vr&&kr(vr,e),null!==yr&&kr(yr,e),_r.forEach(t),xr.forEach(t),n=0;n<br.length;n++)(i=br[n]).blockedOn===e&&(i.blockedOn=null);for(;0<br.length&&null===(n=br[0]).blockedOn;)Er(n),null===n.blockedOn&&br.shift()}var Nr=ln.ReactCurrentBatchConfig,Rr=!0;function Lr(e,t,n,i){var r=sr,a=Nr.transition;Nr.transition=null;try{sr=1,jr(e,t,n,i)}finally{sr=r,Nr.transition=a}}function Ir(e,t,n,i){var r=sr,a=Nr.transition;Nr.transition=null;try{sr=4,jr(e,t,n,i)}finally{sr=r,Nr.transition=a}}function jr(e,t,n,i){if(Rr){var r=Ur(e,t,n,i);if(null===r)Ro(e,t,i,Dr,n),wr(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return gr=Mr(gr,e,t,n,i,r),!0;case"dragenter":return vr=Mr(vr,e,t,n,i,r),!0;case"mouseover":return yr=Mr(yr,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return _r.set(a,Mr(_r.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,xr.set(a,Mr(xr.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(wr(e,i),4&t&&-1<Sr.indexOf(e)){for(;null!==r;){var a=ss(r);if(null!==a&&cr(a),null===(a=Ur(e,t,n,i))&&Ro(e,t,i,Dr,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Ro(e,t,i,null,n)}}var Dr=null;function Ur(e,t,n,i){if(Dr=null,null!==(e=os(e=ci(i))))if(null===(t=Ai(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ni(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Dr=e,null}function Or(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zi()){case Bi:return 1;case Hi:return 4;case Vi:case Wi:return 16;case Gi:return 536870912;default:return 16}default:return 16}}var Fr=null,zr=null,Br=null;function Hr(){if(Br)return Br;var e,t,n=zr,i=n.length,r="value"in Fr?Fr.value:Fr.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return Br=r.slice(e,1<t?1-t:void 0)}function Vr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Wr(){return!0}function Gr(){return!1}function $r(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Wr:Gr,this.isPropagationStopped=Gr,this}return En(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Wr)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Wr)},persist:function(){},isPersistent:Wr}),t}var Xr,qr,Kr,Yr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zr=$r(Yr),Jr=En({},Yr,{view:0,detail:0}),Qr=$r(Jr),ea=En({},Jr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ha,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Kr&&(Kr&&"mousemove"===e.type?(Xr=e.screenX-Kr.screenX,qr=e.screenY-Kr.screenY):qr=Xr=0,Kr=e),Xr)},movementY:function(e){return"movementY"in e?e.movementY:qr}}),ta=$r(ea),na=$r(En({},ea,{dataTransfer:0})),ia=$r(En({},Jr,{relatedTarget:0})),ra=$r(En({},Yr,{animationName:0,elapsedTime:0,pseudoElement:0})),aa=En({},Yr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),oa=$r(aa),sa=$r(En({},Yr,{data:0})),la={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ca={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ua={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function da(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ua[e])&&!!t[e]}function ha(){return da}var pa=En({},Jr,{key:function(e){if(e.key){var t=la[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Vr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ca[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ha,charCode:function(e){return"keypress"===e.type?Vr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Vr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ma=$r(pa),fa=$r(En({},ea,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),ga=$r(En({},Jr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ha})),va=$r(En({},Yr,{propertyName:0,elapsedTime:0,pseudoElement:0})),ya=En({},ea,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_a=$r(ya),xa=[9,13,27,32],ba=Zt&&"CompositionEvent"in window,Sa=null;Zt&&"documentMode"in document&&(Sa=document.documentMode);var wa=Zt&&"TextEvent"in window&&!Sa,Ma=Zt&&(!ba||Sa&&8<Sa&&11>=Sa),Ea=String.fromCharCode(32),Ca=!1;function Ta(e,t){switch(e){case"keyup":return-1!==xa.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pa(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var ka=!1;var Aa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Na(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Aa[e.type]:"textarea"===t}function Ra(e,t,n,i){mi(i),0<(t=Io(t,"onChange")).length&&(n=new Zr("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var La=null,Ia=null;function ja(e){Co(e,0)}function Da(e){if(jn(ls(e)))return e}function Ua(e,t){if("change"===e)return t}var Oa=!1;if(Zt){var Fa;if(Zt){var za="oninput"in document;if(!za){var Ba=document.createElement("div");Ba.setAttribute("oninput","return;"),za="function"==typeof Ba.oninput}Fa=za}else Fa=!1;Oa=Fa&&(!document.documentMode||9<document.documentMode)}function Ha(){La&&(La.detachEvent("onpropertychange",Va),Ia=La=null)}function Va(e){if("value"===e.propertyName&&Da(Ia)){var t=[];Ra(t,Ia,e,ci(e)),_i(ja,t)}}function Wa(e,t,n){"focusin"===e?(Ha(),Ia=n,(La=t).attachEvent("onpropertychange",Va)):"focusout"===e&&Ha()}function Ga(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Da(Ia)}function $a(e,t){if("click"===e)return Da(t)}function Xa(e,t){if("input"===e||"change"===e)return Da(t)}var qa="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Ka(e,t){if(qa(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Jt.call(t,r)||!qa(e[r],t[r]))return!1}return!0}function Ya(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Za(e,t){var n,i=Ya(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Ya(i)}}function Ja(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Ja(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Qa(){for(var e=window,t=Dn();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Dn((e=t.contentWindow).document)}return t}function eo(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function to(e){var t=Qa(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Ja(n.ownerDocument.documentElement,n)){if(null!==i&&eo(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=Za(n,a);var o=Za(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var no=Zt&&"documentMode"in document&&11>=document.documentMode,io=null,ro=null,ao=null,oo=!1;function so(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;oo||null==io||io!==Dn(i)||("selectionStart"in(i=io)&&eo(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},ao&&Ka(ao,i)||(ao=i,0<(i=Io(ro,"onSelect")).length&&(t=new Zr("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=io)))}function lo(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var co={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionend:lo("Transition","TransitionEnd")},uo={},ho={};function po(e){if(uo[e])return uo[e];if(!co[e])return e;var t,n=co[e];for(t in n)if(n.hasOwnProperty(t)&&t in ho)return uo[e]=n[t];return e}Zt&&(ho=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);var mo=po("animationend"),fo=po("animationiteration"),go=po("animationstart"),vo=po("transitionend"),yo=new Map,_o="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xo(e,t){yo.set(e,t),Kt(t,[e])}for(var bo=0;bo<_o.length;bo++){var So=_o[bo];xo(So.toLowerCase(),"on"+(So[0].toUpperCase()+So.slice(1)))}xo(mo,"onAnimationEnd"),xo(fo,"onAnimationIteration"),xo(go,"onAnimationStart"),xo("dblclick","onDoubleClick"),xo("focusin","onFocus"),xo("focusout","onBlur"),xo(vo,"onTransitionEnd"),Yt("onMouseEnter",["mouseout","mouseover"]),Yt("onMouseLeave",["mouseout","mouseover"]),Yt("onPointerEnter",["pointerout","pointerover"]),Yt("onPointerLeave",["pointerout","pointerover"]),Kt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Kt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Kt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Kt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Kt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Kt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mo=new Set("cancel close invalid load scroll toggle".split(" ").concat(wo));function Eo(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,o,s,l){if(ki.apply(this,arguments),Mi){if(!Mi)throw Error($t(198));var c=Ei;Mi=!1,Ei=null,Ci||(Ci=!0,Ti=c)}}(i,t,void 0,e),e.currentTarget=null}function Co(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break e;Eo(r,s,c),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break e;Eo(r,s,c),a=l}}}if(Ci)throw e=Ti,Ci=!1,Ti=null,e}function To(e,t){var n=t[is];void 0===n&&(n=t[is]=new Set);var i=e+"__bubble";n.has(i)||(No(t,e,2,!1),n.add(i))}function Po(e,t,n){var i=0;t&&(i|=4),No(n,e,i,t)}var ko="_reactListening"+Math.random().toString(36).slice(2);function Ao(e){if(!e[ko]){e[ko]=!0,Xt.forEach(function(t){"selectionchange"!==t&&(Mo.has(t)||Po(t,!1,e),Po(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ko]||(t[ko]=!0,Po("selectionchange",!1,t))}}function No(e,t,n,i){switch(Or(t)){case 1:var r=Lr;break;case 4:r=Ir;break;default:r=jr}n=r.bind(null,t,n,e),r=void 0,!bi||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Ro(e,t,n,i,r){var a=i;if(!(1&t||2&t||null===i))e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=os(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue e}s=s.parentNode}}i=i.return}_i(function(){var i=a,r=ci(n),o=[];e:{var s=yo.get(e);if(void 0!==s){var l=Zr,c=e;switch(e){case"keypress":if(0===Vr(n))break e;case"keydown":case"keyup":l=ma;break;case"focusin":c="focus",l=ia;break;case"focusout":c="blur",l=ia;break;case"beforeblur":case"afterblur":l=ia;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ta;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=na;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=ga;break;case mo:case fo:case go:l=ra;break;case vo:l=va;break;case"scroll":l=Qr;break;case"wheel":l=_a;break;case"copy":case"cut":case"paste":l=oa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=fa}var u=!!(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,m=i;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=xi(m,h))&&u.push(Lo(m,f,p)))),d)break;m=m.return}0<u.length&&(s=new l(s,c,null,n,r),o.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===li||!(c=n.relatedTarget||n.fromElement)||!os(c)&&!c[ns])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?os(c):null)&&(c!==(d=Ai(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=ta,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=fa,f="onPointerLeave",h="onPointerEnter",m="pointer"),d=null==l?s:ls(l),p=null==c?s:ls(c),(s=new u(f,m+"leave",l,n,r)).target=d,s.relatedTarget=p,f=null,os(r)===i&&((u=new u(h,m+"enter",c,n,r)).target=p,u.relatedTarget=d,f=u),d=f,l&&c)e:{for(h=c,m=0,p=u=l;p;p=jo(p))m++;for(p=0,f=h;f;f=jo(f))p++;for(;0<m-p;)u=jo(u),m--;for(;0<p-m;)h=jo(h),p--;for(;m--;){if(u===h||null!==h&&u===h.alternate)break e;u=jo(u),h=jo(h)}u=null}else u=null;null!==l&&Do(o,s,l,u,!1),null!==c&&null!==d&&Do(o,d,c,u,!0)}if("select"===(l=(s=i?ls(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Ua;else if(Na(s))if(Oa)g=Xa;else{g=Ga;var v=Wa}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=$a);switch(g&&(g=g(e,i))?Ra(o,g,n,r):(v&&v(e,s,i),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&Hn(s,"number",s.value)),v=i?ls(i):window,e){case"focusin":(Na(v)||"true"===v.contentEditable)&&(io=v,ro=i,ao=null);break;case"focusout":ao=ro=io=null;break;case"mousedown":oo=!0;break;case"contextmenu":case"mouseup":case"dragend":oo=!1,so(o,n,r);break;case"selectionchange":if(no)break;case"keydown":case"keyup":so(o,n,r)}var y;if(ba)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else ka?Ta(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Ma&&"ko"!==n.locale&&(ka||"onCompositionStart"!==_?"onCompositionEnd"===_&&ka&&(y=Hr()):(zr="value"in(Fr=r)?Fr.value:Fr.textContent,ka=!0)),0<(v=Io(i,_)).length&&(_=new sa(_,e,null,n,r),o.push({event:_,listeners:v}),y?_.data=y:null!==(y=Pa(n))&&(_.data=y))),(y=wa?function(e,t){switch(e){case"compositionend":return Pa(t);case"keypress":return 32!==t.which?null:(Ca=!0,Ea);case"textInput":return(e=t.data)===Ea&&Ca?null:e;default:return null}}(e,n):function(e,t){if(ka)return"compositionend"===e||!ba&&Ta(e,t)?(e=Hr(),Br=zr=Fr=null,ka=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ma&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Io(i,"onBeforeInput")).length&&(r=new sa("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y))}Co(o,t)})}function Lo(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Io(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=xi(e,n))&&i.unshift(Lo(e,a,r)),null!=(a=xi(e,t))&&i.push(Lo(e,a,r))),e=e.return}return i}function jo(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Do(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=xi(n,a))&&o.unshift(Lo(n,l,s)):r||null!=(l=xi(n,a))&&o.push(Lo(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Uo=/\r\n?/g,Oo=/\u0000|\uFFFD/g;function Fo(e){return("string"==typeof e?e:""+e).replace(Uo,"\n").replace(Oo,"")}function zo(e,t,n){if(t=Fo(t),Fo(e)!==t&&n)throw Error($t(425))}function Bo(){}var Ho=null,Vo=null;function Wo(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Go="function"==typeof setTimeout?setTimeout:void 0,$o="function"==typeof clearTimeout?clearTimeout:void 0,Xo="function"==typeof Promise?Promise:void 0,qo="function"==typeof queueMicrotask?queueMicrotask:void 0!==Xo?function(e){return Xo.resolve(null).then(e).catch(Ko)}:Go;function Ko(e){setTimeout(function(){throw e})}function Yo(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Ar(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ar(t)}function Zo(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function Jo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Qo=Math.random().toString(36).slice(2),es="__reactFiber$"+Qo,ts="__reactProps$"+Qo,ns="__reactContainer$"+Qo,is="__reactEvents$"+Qo,rs="__reactListeners$"+Qo,as="__reactHandles$"+Qo;function os(e){var t=e[es];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ns]||n[es]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Jo(e);null!==e;){if(n=e[es])return n;e=Jo(e)}return t}n=(e=n).parentNode}return null}function ss(e){return!(e=e[es]||e[ns])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ls(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error($t(33))}function cs(e){return e[ts]||null}var us=[],ds=-1;function hs(e){return{current:e}}function ps(e){0>ds||(e.current=us[ds],us[ds]=null,ds--)}function ms(e,t){ds++,us[ds]=e.current,e.current=t}var fs={},gs=hs(fs),vs=hs(!1),ys=fs;function _s(e,t){var n=e.type.contextTypes;if(!n)return fs;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function xs(e){return null!=(e=e.childContextTypes)}function bs(){ps(vs),ps(gs)}function Ss(e,t,n){if(gs.current!==fs)throw Error($t(168));ms(gs,t),ms(vs,n)}function ws(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error($t(108,Nn(e)||"Unknown",r));return En({},n,i)}function Ms(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fs,ys=gs.current,ms(gs,e),ms(vs,vs.current),!0}function Es(e,t,n){var i=e.stateNode;if(!i)throw Error($t(169));n?(e=ws(e,t,ys),i.__reactInternalMemoizedMergedChildContext=e,ps(vs),ps(gs),ms(gs,e)):ps(vs),ms(vs,n)}var Cs=null,Ts=!1,Ps=!1;function ks(e){null===Cs?Cs=[e]:Cs.push(e)}function As(){if(!Ps&&null!==Cs){Ps=!0;var e=0,t=sr;try{var n=Cs;for(sr=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Cs=null,Ts=!1}catch(r){throw null!==Cs&&(Cs=Cs.slice(e+1)),ji(Bi,As),r}finally{sr=t,Ps=!1}}return null}var Ns=[],Rs=0,Ls=null,Is=0,js=[],Ds=0,Us=null,Os=1,Fs="";function zs(e,t){Ns[Rs++]=Is,Ns[Rs++]=Ls,Ls=e,Is=t}function Bs(e,t,n){js[Ds++]=Os,js[Ds++]=Fs,js[Ds++]=Us,Us=e;var i=Os;e=Fs;var r=32-qi(i)-1;i&=~(1<<r),n+=1;var a=32-qi(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Os=1<<32-qi(t)+r|n<<r|i,Fs=a+e}else Os=1<<a|n<<r|i,Fs=e}function Hs(e){null!==e.return&&(zs(e,1),Bs(e,1,0))}function Vs(e){for(;e===Ls;)Ls=Ns[--Rs],Ns[Rs]=null,Is=Ns[--Rs],Ns[Rs]=null;for(;e===Us;)Us=js[--Ds],js[Ds]=null,Fs=js[--Ds],js[Ds]=null,Os=js[--Ds],js[Ds]=null}var Ws=null,Gs=null,$s=!1,Xs=null;function qs(e,t){var n=yh(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Ks(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,Ws=e,Gs=Zo(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,Ws=e,Gs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Us?{id:Os,overflow:Fs}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=yh(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Ws=e,Gs=null,!0);default:return!1}}function Ys(e){return!(!(1&e.mode)||128&e.flags)}function Zs(e){if($s){var t=Gs;if(t){var n=t;if(!Ks(e,t)){if(Ys(e))throw Error($t(418));t=Zo(n.nextSibling);var i=Ws;t&&Ks(e,t)?qs(i,n):(e.flags=-4097&e.flags|2,$s=!1,Ws=e)}}else{if(Ys(e))throw Error($t(418));e.flags=-4097&e.flags|2,$s=!1,Ws=e}}}function Js(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ws=e}function Qs(e){if(e!==Ws)return!1;if(!$s)return Js(e),$s=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!Wo(e.type,e.memoizedProps)),t&&(t=Gs)){if(Ys(e))throw el(),Error($t(418));for(;t;)qs(e,t),t=Zo(t.nextSibling)}if(Js(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error($t(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Gs=Zo(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Gs=null}}else Gs=Ws?Zo(e.stateNode.nextSibling):null;return!0}function el(){for(var e=Gs;e;)e=Zo(e.nextSibling)}function tl(){Gs=Ws=null,$s=!1}function nl(e){null===Xs?Xs=[e]:Xs.push(e)}var il=ln.ReactCurrentBatchConfig;function rl(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error($t(309));var i=n.stateNode}if(!i)throw Error($t(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error($t(284));if(!n._owner)throw Error($t(290,e))}return e}function al(e,t){throw e=Object.prototype.toString.call(t),Error($t(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ol(e){return(0,e._init)(e._payload)}function sl(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=xh(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function s(e,t,n,i){return null===t||6!==t.tag?((t=Mh(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var a=n.type;return a===dn?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===xn&&ol(a)===t.type)?((i=r(t,n.props)).ref=rl(e,t,n),i.return=e,i):((i=bh(n.type,n.key,n.props,null,e.mode,i)).ref=rl(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Eh(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,a){return null===t||7!==t.tag?((t=Sh(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Mh(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case cn:return(n=bh(t.type,t.key,t.props,null,e.mode,n)).ref=rl(e,null,t),n.return=e,n;case un:return(t=Eh(t,e.mode,n)).return=e,t;case xn:return d(e,(0,t._init)(t._payload),n)}if(Vn(t)||wn(t))return(t=Sh(t,e.mode,n,null)).return=e,t;al(e,t)}return null}function h(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:s(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case cn:return n.key===r?l(e,t,n,i):null;case un:return n.key===r?c(e,t,n,i):null;case xn:return h(e,t,(r=n._init)(n._payload),i)}if(Vn(n)||wn(n))return null!==r?null:u(e,t,n,i,null);al(e,n)}return null}function p(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return s(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case cn:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case un:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case xn:return p(e,t,n,(0,i._init)(i._payload),r)}if(Vn(i)||wn(i))return u(t,e=e.get(n)||null,i,r,null);al(t,i)}return null}return function s(l,c,u,m){if("object"==typeof u&&null!==u&&u.type===dn&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case cn:e:{for(var f=u.key,g=c;null!==g;){if(g.key===f){if((f=u.type)===dn){if(7===g.tag){n(l,g.sibling),(c=r(g,u.props.children)).return=l,l=c;break e}}else if(g.elementType===f||"object"==typeof f&&null!==f&&f.$$typeof===xn&&ol(f)===g.type){n(l,g.sibling),(c=r(g,u.props)).ref=rl(l,g,u),c.return=l,l=c;break e}n(l,g);break}t(l,g),g=g.sibling}u.type===dn?((c=Sh(u.props.children,l.mode,m,u.key)).return=l,l=c):((m=bh(u.type,u.key,u.props,null,l.mode,m)).ref=rl(l,c,u),m.return=l,l=m)}return o(l);case un:e:{for(g=u.key;null!==c;){if(c.key===g){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(c=r(c,u.children||[])).return=l,l=c;break e}n(l,c);break}t(l,c),c=c.sibling}(c=Eh(u,l.mode,m)).return=l,l=c}return o(l);case xn:return s(l,c,(g=u._init)(u._payload),m)}if(Vn(u))return function(r,o,s,l){for(var c=null,u=null,m=o,f=o=0,g=null;null!==m&&f<s.length;f++){m.index>f?(g=m,m=null):g=m.sibling;var v=h(r,m,s[f],l);if(null===v){null===m&&(m=g);break}e&&m&&null===v.alternate&&t(r,m),o=a(v,o,f),null===u?c=v:u.sibling=v,u=v,m=g}if(f===s.length)return n(r,m),$s&&zs(r,f),c;if(null===m){for(;f<s.length;f++)null!==(m=d(r,s[f],l))&&(o=a(m,o,f),null===u?c=m:u.sibling=m,u=m);return $s&&zs(r,f),c}for(m=i(r,m);f<s.length;f++)null!==(g=p(m,r,f,s[f],l))&&(e&&null!==g.alternate&&m.delete(null===g.key?f:g.key),o=a(g,o,f),null===u?c=g:u.sibling=g,u=g);return e&&m.forEach(function(e){return t(r,e)}),$s&&zs(r,f),c}(l,c,u,m);if(wn(u))return function(r,o,s,l){var c=wn(s);if("function"!=typeof c)throw Error($t(150));if(null==(s=c.call(s)))throw Error($t(151));for(var u=c=null,m=o,f=o=0,g=null,v=s.next();null!==m&&!v.done;f++,v=s.next()){m.index>f?(g=m,m=null):g=m.sibling;var y=h(r,m,v.value,l);if(null===y){null===m&&(m=g);break}e&&m&&null===y.alternate&&t(r,m),o=a(y,o,f),null===u?c=y:u.sibling=y,u=y,m=g}if(v.done)return n(r,m),$s&&zs(r,f),c;if(null===m){for(;!v.done;f++,v=s.next())null!==(v=d(r,v.value,l))&&(o=a(v,o,f),null===u?c=v:u.sibling=v,u=v);return $s&&zs(r,f),c}for(m=i(r,m);!v.done;f++,v=s.next())null!==(v=p(m,r,f,v.value,l))&&(e&&null!==v.alternate&&m.delete(null===v.key?f:v.key),o=a(v,o,f),null===u?c=v:u.sibling=v,u=v);return e&&m.forEach(function(e){return t(r,e)}),$s&&zs(r,f),c}(l,c,u,m);al(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(c=r(c,u)).return=l,l=c):(n(l,c),(c=Mh(u,l.mode,m)).return=l,l=c),o(l)):n(l,c)}}var ll=sl(!0),cl=sl(!1),ul=hs(null),dl=null,hl=null,pl=null;function ml(){pl=hl=dl=null}function fl(e){var t=ul.current;ps(ul),e._currentValue=t}function gl(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function vl(e,t){dl=e,pl=hl=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ou=!0),e.firstContext=null)}function yl(e){var t=e._currentValue;if(pl!==e)if(e={context:e,memoizedValue:t,next:null},null===hl){if(null===dl)throw Error($t(308));hl=e,dl.dependencies={lanes:0,firstContext:e}}else hl=hl.next=e;return t}var _l=null;function xl(e){null===_l?_l=[e]:_l.push(e)}function bl(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,xl(t)):(n.next=r.next,r.next=n),t.interleaved=n,Sl(e,i)}function Sl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var wl=!1;function Ml(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function El(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Cl(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Tl(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&fd){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Sl(e,n)}return null===(r=i.interleaved)?(t.next=t,xl(i)):(t.next=r.next,r.next=t),i.interleaved=t,Sl(e,n)}function Pl(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,or(e,n)}}function kl(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Al(e,t,n,i){var r=e.updateQueue;wl=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=r.baseState;for(o=0,u=c=l=null,s=a;;){var h=s.lane,p=s.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,f=s;switch(h=t,p=n,f.tag){case 1:if("function"==typeof(m=f.payload)){d=m.call(p,d,h);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(h="function"==typeof(m=f.payload)?m.call(p,d,h):m))break e;d=En({},d,h);break e;case 2:wl=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);wd|=o,e.lanes=o,e.memoizedState=d}}function Nl(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error($t(191,r));r.call(i)}}}var Rl={},Ll=hs(Rl),Il=hs(Rl),jl=hs(Rl);function Dl(e){if(e===Rl)throw Error($t(174));return e}function Ul(e,t){switch(ms(jl,t),ms(Il,e),ms(Ll,Rl),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Yn(null,"");break;default:t=Yn(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ps(Ll),ms(Ll,t)}function Ol(){ps(Ll),ps(Il),ps(jl)}function Fl(e){Dl(jl.current);var t=Dl(Ll.current),n=Yn(t,e.type);t!==n&&(ms(Il,e),ms(Ll,n))}function zl(e){Il.current===e&&(ps(Ll),ps(Il))}var Bl=hs(0);function Hl(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Vl=[];function Wl(){for(var e=0;e<Vl.length;e++)Vl[e]._workInProgressVersionPrimary=null;Vl.length=0}var Gl=ln.ReactCurrentDispatcher,$l=ln.ReactCurrentBatchConfig,Xl=0,ql=null,Kl=null,Yl=null,Zl=!1,Jl=!1,Ql=0,ec=0;function tc(){throw Error($t(321))}function nc(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!qa(e[n],t[n]))return!1;return!0}function ic(e,t,n,i,r,a){if(Xl=a,ql=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Gl.current=null===e||null===e.memoizedState?zc:Bc,e=n(i,r),Jl){a=0;do{if(Jl=!1,Ql=0,25<=a)throw Error($t(301));a+=1,Yl=Kl=null,t.updateQueue=null,Gl.current=Hc,e=n(i,r)}while(Jl)}if(Gl.current=Fc,t=null!==Kl&&null!==Kl.next,Xl=0,Yl=Kl=ql=null,Zl=!1,t)throw Error($t(300));return e}function rc(){var e=0!==Ql;return Ql=0,e}function ac(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Yl?ql.memoizedState=Yl=e:Yl=Yl.next=e,Yl}function oc(){if(null===Kl){var e=ql.alternate;e=null!==e?e.memoizedState:null}else e=Kl.next;var t=null===Yl?ql.memoizedState:Yl.next;if(null!==t)Yl=t,Kl=e;else{if(null===e)throw Error($t(310));e={memoizedState:(Kl=e).memoizedState,baseState:Kl.baseState,baseQueue:Kl.baseQueue,queue:Kl.queue,next:null},null===Yl?ql.memoizedState=Yl=e:Yl=Yl.next=e}return Yl}function sc(e,t){return"function"==typeof t?t(e):t}function lc(e){var t=oc(),n=t.queue;if(null===n)throw Error($t(311));n.lastRenderedReducer=e;var i=Kl,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var s=o=null,l=null,c=a;do{var u=c.lane;if((Xl&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(s=l=d,o=i):l=l.next=d,ql.lanes|=u,wd|=u}c=c.next}while(null!==c&&c!==a);null===l?o=i:l.next=s,qa(i,t.memoizedState)||(ou=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,ql.lanes|=a,wd|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function cc(e){var t=oc(),n=t.queue;if(null===n)throw Error($t(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);qa(a,t.memoizedState)||(ou=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function uc(){}function dc(e,t){var n=ql,i=oc(),r=t(),a=!qa(i.memoizedState,r);if(a&&(i.memoizedState=r,ou=!0),i=i.queue,wc(mc.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==Yl&&1&Yl.memoizedState.tag){if(n.flags|=2048,yc(9,pc.bind(null,n,i,r,t),void 0,null),null===gd)throw Error($t(349));30&Xl||hc(n,t,r)}return r}function hc(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ql.updateQueue)?(t={lastEffect:null,stores:null},ql.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function pc(e,t,n,i){t.value=n,t.getSnapshot=i,fc(t)&&gc(e)}function mc(e,t,n){return n(function(){fc(t)&&gc(e)})}function fc(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!qa(e,n)}catch(i){return!0}}function gc(e){var t=Sl(e,1);null!==t&&Vd(t,e,1,-1)}function vc(e){var t=ac();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sc,lastRenderedState:e},t.queue=e,e=e.dispatch=jc.bind(null,ql,e),[t.memoizedState,e]}function yc(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ql.updateQueue)?(t={lastEffect:null,stores:null},ql.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function _c(){return oc().memoizedState}function xc(e,t,n,i){var r=ac();ql.flags|=e,r.memoizedState=yc(1|t,n,void 0,void 0===i?null:i)}function bc(e,t,n,i){var r=oc();i=void 0===i?null:i;var a=void 0;if(null!==Kl){var o=Kl.memoizedState;if(a=o.destroy,null!==i&&nc(i,o.deps))return void(r.memoizedState=yc(t,n,a,i))}ql.flags|=e,r.memoizedState=yc(1|t,n,a,i)}function Sc(e,t){return xc(8390656,8,e,t)}function wc(e,t){return bc(2048,8,e,t)}function Mc(e,t){return bc(4,2,e,t)}function Ec(e,t){return bc(4,4,e,t)}function Cc(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Tc(e,t,n){return n=null!=n?n.concat([e]):null,bc(4,4,Cc.bind(null,t,e),n)}function Pc(){}function kc(e,t){var n=oc();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&nc(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ac(e,t){var n=oc();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&nc(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Nc(e,t,n){return 21&Xl?(qa(n,t)||(n=ir(),ql.lanes|=n,wd|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ou=!0),e.memoizedState=n)}function Rc(e,t){var n=sr;sr=0!==n&&4>n?n:4,e(!0);var i=$l.transition;$l.transition={};try{e(!1),t()}finally{sr=n,$l.transition=i}}function Lc(){return oc().memoizedState}function Ic(e,t,n){var i=Hd(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Dc(e))Uc(t,n);else if(null!==(n=bl(e,t,n,i))){Vd(n,e,i,Bd()),Oc(n,t,i)}}function jc(e,t,n){var i=Hd(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Dc(e))Uc(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,qa(s,o)){var l=t.interleaved;return null===l?(r.next=r,xl(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=bl(e,t,r,i))&&(Vd(n,e,i,r=Bd()),Oc(n,t,i))}}function Dc(e){var t=e.alternate;return e===ql||null!==t&&t===ql}function Uc(e,t){Jl=Zl=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Oc(e,t,n){if(4194240&n){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,or(e,n)}}var Fc={readContext:yl,useCallback:tc,useContext:tc,useEffect:tc,useImperativeHandle:tc,useInsertionEffect:tc,useLayoutEffect:tc,useMemo:tc,useReducer:tc,useRef:tc,useState:tc,useDebugValue:tc,useDeferredValue:tc,useTransition:tc,useMutableSource:tc,useSyncExternalStore:tc,useId:tc,unstable_isNewReconciler:!1},zc={readContext:yl,useCallback:function(e,t){return ac().memoizedState=[e,void 0===t?null:t],e},useContext:yl,useEffect:Sc,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,xc(4194308,4,Cc.bind(null,t,e),n)},useLayoutEffect:function(e,t){return xc(4194308,4,e,t)},useInsertionEffect:function(e,t){return xc(4,2,e,t)},useMemo:function(e,t){var n=ac();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ac();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ic.bind(null,ql,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ac().memoizedState=e},useState:vc,useDebugValue:Pc,useDeferredValue:function(e){return ac().memoizedState=e},useTransition:function(){var e=vc(!1),t=e[0];return e=Rc.bind(null,e[1]),ac().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ql,r=ac();if($s){if(void 0===n)throw Error($t(407));n=n()}else{if(n=t(),null===gd)throw Error($t(349));30&Xl||hc(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Sc(mc.bind(null,i,a,e),[e]),i.flags|=2048,yc(9,pc.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=ac(),t=gd.identifierPrefix;if($s){var n=Fs;t=":"+t+"R"+(n=(Os&~(1<<32-qi(Os)-1)).toString(32)+n),0<(n=Ql++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ec++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Bc={readContext:yl,useCallback:kc,useContext:yl,useEffect:wc,useImperativeHandle:Tc,useInsertionEffect:Mc,useLayoutEffect:Ec,useMemo:Ac,useReducer:lc,useRef:_c,useState:function(){return lc(sc)},useDebugValue:Pc,useDeferredValue:function(e){return Nc(oc(),Kl.memoizedState,e)},useTransition:function(){return[lc(sc)[0],oc().memoizedState]},useMutableSource:uc,useSyncExternalStore:dc,useId:Lc,unstable_isNewReconciler:!1},Hc={readContext:yl,useCallback:kc,useContext:yl,useEffect:wc,useImperativeHandle:Tc,useInsertionEffect:Mc,useLayoutEffect:Ec,useMemo:Ac,useReducer:cc,useRef:_c,useState:function(){return cc(sc)},useDebugValue:Pc,useDeferredValue:function(e){var t=oc();return null===Kl?t.memoizedState=e:Nc(t,Kl.memoizedState,e)},useTransition:function(){return[cc(sc)[0],oc().memoizedState]},useMutableSource:uc,useSyncExternalStore:dc,useId:Lc,unstable_isNewReconciler:!1};function Vc(e,t){if(e&&e.defaultProps){for(var n in t=En({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function Wc(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:En({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Gc={isMounted:function(e){return!!(e=e._reactInternals)&&Ai(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Bd(),r=Hd(e),a=Cl(i,r);a.payload=t,null!=n&&(a.callback=n),null!==(t=Tl(e,a,r))&&(Vd(t,e,r,i),Pl(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Bd(),r=Hd(e),a=Cl(i,r);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Tl(e,a,r))&&(Vd(t,e,r,i),Pl(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Bd(),i=Hd(e),r=Cl(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=Tl(e,r,i))&&(Vd(t,e,i,n),Pl(t,e,i))}};function $c(e,t,n,i,r,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!Ka(n,i)||!Ka(r,a))}function Xc(e,t,n){var i=!1,r=fs,a=t.contextType;return"object"==typeof a&&null!==a?a=yl(a):(r=xs(t)?ys:gs.current,a=(i=null!=(i=t.contextTypes))?_s(e,r):fs),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Gc,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function qc(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Gc.enqueueReplaceState(t,t.state,null)}function Kc(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Ml(e);var a=t.contextType;"object"==typeof a&&null!==a?r.context=yl(a):(a=xs(t)?ys:gs.current,r.context=_s(e,a)),r.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(Wc(e,t,a,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Gc.enqueueReplaceState(r,r.state,null),Al(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function Yc(e,t){try{var n="",i=t;do{n+=kn(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function Zc(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function Jc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Qc="function"==typeof WeakMap?WeakMap:Map;function eu(e,t,n){(n=Cl(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Nd||(Nd=!0,Rd=i),Jc(0,t)},n}function tu(e,t,n){(n=Cl(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){Jc(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){Jc(0,t),"function"!=typeof i&&(null===Ld?Ld=new Set([this]):Ld.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function nu(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Qc;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=hh.bind(null,e,t,n),t.then(e,e))}function iu(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ru(e,t,n,i,r){return 1&e.mode?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Cl(-1,1)).tag=2,Tl(n,t,1))),n.lanes|=1),e)}var au=ln.ReactCurrentOwner,ou=!1;function su(e,t,n,i){t.child=null===e?cl(t,null,n,i):ll(t,e.child,n,i)}function lu(e,t,n,i,r){n=n.render;var a=t.ref;return vl(t,r),i=ic(e,t,n,i,a,r),n=rc(),null===e||ou?($s&&n&&Hs(t),t.flags|=1,su(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Nu(e,t,r))}function cu(e,t,n,i,r){if(null===e){var a=n.type;return"function"!=typeof a||_h(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=bh(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,uu(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:Ka)(o,i)&&e.ref===t.ref)return Nu(e,t,r)}return t.flags|=1,(e=xh(a,i)).ref=t.ref,e.return=t,t.child=e}function uu(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(Ka(a,i)&&e.ref===t.ref){if(ou=!1,t.pendingProps=i=a,0===(e.lanes&r))return t.lanes=e.lanes,Nu(e,t,r);131072&e.flags&&(ou=!0)}}return pu(e,t,n,i,r)}function du(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ms(xd,_d),_d|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,ms(xd,_d),_d|=i}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ms(xd,_d),_d|=n;else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,ms(xd,_d),_d|=i;return su(e,t,r,n),t.child}function hu(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function pu(e,t,n,i,r){var a=xs(n)?ys:gs.current;return a=_s(t,a),vl(t,r),n=ic(e,t,n,i,a,r),i=rc(),null===e||ou?($s&&i&&Hs(t),t.flags|=1,su(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Nu(e,t,r))}function mu(e,t,n,i,r){if(xs(n)){var a=!0;Ms(t)}else a=!1;if(vl(t,r),null===t.stateNode)Au(e,t),Xc(t,n,i),Kc(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"==typeof c&&null!==c?c=yl(c):c=_s(t,c=xs(n)?ys:gs.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==i||l!==c)&&qc(t,o,i,c),wl=!1;var h=t.memoizedState;o.state=h,Al(t,i,o,r),l=t.memoizedState,s!==i||h!==l||vs.current||wl?("function"==typeof u&&(Wc(t,n,u,i),l=t.memoizedState),(s=wl||$c(t,n,s,i,h,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"==typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,El(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:Vc(t.type,s),o.props=c,d=t.pendingProps,h=o.context,"object"==typeof(l=n.contextType)&&null!==l?l=yl(l):l=_s(t,l=xs(n)?ys:gs.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==d||h!==l)&&qc(t,o,i,l),wl=!1,h=t.memoizedState,o.state=h,Al(t,i,o,r);var m=t.memoizedState;s!==d||h!==m||vs.current||wl?("function"==typeof p&&(Wc(t,n,p,i),m=t.memoizedState),(c=wl||$c(t,n,c,i,h,m,l)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,m,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,m,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),o.props=i,o.state=m,o.context=l,i=c):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return fu(e,t,n,i,a,r)}function fu(e,t,n,i,r,a){hu(e,t);var o=!!(128&t.flags);if(!i&&!o)return r&&Es(t,n,!1),Nu(e,t,a);i=t.stateNode,au.current=t;var s=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=ll(t,e.child,null,a),t.child=ll(t,null,s,a)):su(e,t,s,a),t.memoizedState=i.state,r&&Es(t,n,!0),t.child}function gu(e){var t=e.stateNode;t.pendingContext?Ss(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ss(0,t.context,!1),Ul(e,t.containerInfo)}function vu(e,t,n,i,r){return tl(),nl(r),t.flags|=256,su(e,t,n,i),t.child}var yu,_u,xu,bu,Su={dehydrated:null,treeContext:null,retryLane:0};function wu(e){return{baseLanes:e,cachePool:null,transitions:null}}function Mu(e,t,n){var i,r=t.pendingProps,a=Bl.current,o=!1,s=!!(128&t.flags);if((i=s)||(i=(null===e||null!==e.memoizedState)&&!!(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),ms(Bl,1&a),null===e)return Zs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,o?(r=t.mode,o=t.child,s={mode:"hidden",children:s},1&r||null===o?o=wh(s,r,0,null):(o.childLanes=0,o.pendingProps=s),e=Sh(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=wu(n),t.memoizedState=Su,e):Eu(t,s));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,o){if(n)return 256&t.flags?(t.flags&=-257,Cu(e,t,o,i=Zc(Error($t(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=wh({mode:"visible",children:i.children},r,0,null),(a=Sh(a,r,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,1&t.mode&&ll(t,e.child,null,o),t.child.memoizedState=wu(o),t.memoizedState=Su,a);if(!(1&t.mode))return Cu(e,t,o,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var s=i.dgst;return i=s,Cu(e,t,o,i=Zc(a=Error($t(419)),i,void 0))}if(s=0!==(o&e.childLanes),ou||s){if(null!==(i=gd)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Sl(e,r),Vd(i,e,r,-1))}return nh(),Cu(e,t,o,i=Zc(Error($t(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=mh.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,Gs=Zo(r.nextSibling),Ws=t,$s=!0,Xs=null,null!==e&&(js[Ds++]=Os,js[Ds++]=Fs,js[Ds++]=Us,Os=e.id,Fs=e.overflow,Us=t),t=Eu(t,i.children),t.flags|=4096,t)}(e,t,s,r,i,a,n);if(o){o=r.fallback,s=t.mode,i=(a=e.child).sibling;var l={mode:"hidden",children:r.children};return 1&s||t.child===a?(r=xh(a,l)).subtreeFlags=14680064&a.subtreeFlags:((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null),null!==i?o=xh(i,o):(o=Sh(o,s,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,s=null===(s=e.child.memoizedState)?wu(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=Su,r}return e=(o=e.child).sibling,r=xh(o,{mode:"visible",children:r.children}),!(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Eu(e,t){return(t=wh({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Cu(e,t,n,i){return null!==i&&nl(i),ll(t,e.child,null,n),(e=Eu(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Tu(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),gl(e.return,t,n)}function Pu(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function ku(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(su(e,t,i.children,n),2&(i=Bl.current))i=1&i|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Tu(e,n,t);else if(19===e.tag)Tu(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(ms(Bl,i),1&t.mode)switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Hl(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Pu(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Hl(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Pu(t,!0,n,null,a);break;case"together":Pu(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Au(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Nu(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),wd|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error($t(153));if(null!==t.child){for(n=xh(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=xh(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ru(e,t){if(!$s)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Lu(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Iu(e,t,n){var i=t.pendingProps;switch(Vs(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lu(t),null;case 1:case 17:return xs(t.type)&&bs(),Lu(t),null;case 3:return i=t.stateNode,Ol(),ps(vs),ps(gs),Wl(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Qs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==Xs&&(Xd(Xs),Xs=null))),_u(e,t),Lu(t),null;case 5:zl(t);var r=Dl(jl.current);if(n=t.type,null!==e&&null!=t.stateNode)xu(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error($t(166));return Lu(t),null}if(e=Dl(Ll.current),Qs(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[es]=t,i[ts]=a,e=!!(1&t.mode),n){case"dialog":To("cancel",i),To("close",i);break;case"iframe":case"object":case"embed":To("load",i);break;case"video":case"audio":for(r=0;r<wo.length;r++)To(wo[r],i);break;case"source":To("error",i);break;case"img":case"image":case"link":To("error",i),To("load",i);break;case"details":To("toggle",i);break;case"input":On(i,a),To("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},To("invalid",i);break;case"textarea":$n(i,a),To("invalid",i)}for(var o in oi(n,a),r=null,a)if(a.hasOwnProperty(o)){var s=a[o];"children"===o?"string"==typeof s?i.textContent!==s&&(!0!==a.suppressHydrationWarning&&zo(i.textContent,s,e),r=["children",s]):"number"==typeof s&&i.textContent!==""+s&&(!0!==a.suppressHydrationWarning&&zo(i.textContent,s,e),r=["children",""+s]):qt.hasOwnProperty(o)&&null!=s&&"onScroll"===o&&To("scroll",i)}switch(n){case"input":In(i),Bn(i,a,!0);break;case"textarea":In(i),qn(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=Bo)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{o=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=Kn(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=o.createElement(n,{is:i.is}):(e=o.createElement(n),"select"===n&&(o=e,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):e=o.createElementNS(e,n),e[es]=t,e[ts]=i,yu(e,t,!1,!1),t.stateNode=e;e:{switch(o=si(n,i),n){case"dialog":To("cancel",e),To("close",e),r=i;break;case"iframe":case"object":case"embed":To("load",e),r=i;break;case"video":case"audio":for(r=0;r<wo.length;r++)To(wo[r],e);r=i;break;case"source":To("error",e),r=i;break;case"img":case"image":case"link":To("error",e),To("load",e),r=i;break;case"details":To("toggle",e),r=i;break;case"input":On(e,i),r=Un(e,i),To("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=En({},i,{value:void 0}),To("invalid",e);break;case"textarea":$n(e,i),r=Gn(e,i),To("invalid",e)}for(a in oi(n,r),s=r)if(s.hasOwnProperty(a)){var l=s[a];"style"===a?ri(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&Qn(e,l):"children"===a?"string"==typeof l?("textarea"!==n||""!==l)&&ei(e,l):"number"==typeof l&&ei(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(qt.hasOwnProperty(a)?null!=l&&"onScroll"===a&&To("scroll",e):null!=l&&sn(e,a,l,o))}switch(n){case"input":In(e),Bn(e,i,!1);break;case"textarea":In(e),qn(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Rn(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?Wn(e,!!i.multiple,a,!1):null!=i.defaultValue&&Wn(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=Bo)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Lu(t),null;case 6:if(e&&null!=t.stateNode)bu(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error($t(166));if(n=Dl(jl.current),Dl(Ll.current),Qs(t)){if(i=t.stateNode,n=t.memoizedProps,i[es]=t,(a=i.nodeValue!==n)&&null!==(e=Ws))switch(e.tag){case 3:zo(i.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&zo(i.nodeValue,n,!!(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[es]=t,t.stateNode=i}return Lu(t),null;case 13:if(ps(Bl),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if($s&&null!==Gs&&1&t.mode&&!(128&t.flags))el(),tl(),t.flags|=98560,a=!1;else if(a=Qs(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error($t(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error($t(317));a[es]=t}else tl(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Lu(t),a=!1}else null!==Xs&&(Xd(Xs),Xs=null),a=!0;if(!a)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,1&t.mode&&(null===e||1&Bl.current?0===bd&&(bd=3):nh())),null!==t.updateQueue&&(t.flags|=4),Lu(t),null);case 4:return Ol(),_u(e,t),null===e&&Ao(t.stateNode.containerInfo),Lu(t),null;case 10:return fl(t.type._context),Lu(t),null;case 19:if(ps(Bl),null===(a=t.memoizedState))return Lu(t),null;if(i=!!(128&t.flags),null===(o=a.rendering))if(i)Ru(a,!1);else{if(0!==bd||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=Hl(e))){for(t.flags|=128,Ru(a,!1),null!==(i=o.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(o=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ms(Bl,1&Bl.current|2),t.child}e=e.sibling}null!==a.tail&&Fi()>kd&&(t.flags|=128,i=!0,Ru(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Hl(o))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ru(a,!0),null===a.tail&&"hidden"===a.tailMode&&!o.alternate&&!$s)return Lu(t),null}else 2*Fi()-a.renderingStartTime>kd&&1073741824!==n&&(t.flags|=128,i=!0,Ru(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(null!==(n=a.last)?n.sibling=o:t.child=o,a.last=o)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Fi(),t.sibling=null,n=Bl.current,ms(Bl,i?1&n|2:1&n),t):(Lu(t),null);case 22:case 23:return Jd(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&1&t.mode?!!(1073741824&_d)&&(Lu(t),6&t.subtreeFlags&&(t.flags|=8192)):Lu(t),null;case 24:case 25:return null}throw Error($t(156,t.tag))}function ju(e,t){switch(Vs(t),t.tag){case 1:return xs(t.type)&&bs(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ol(),ps(vs),ps(gs),Wl(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return zl(t),null;case 13:if(ps(Bl),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error($t(340));tl()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ps(Bl),null;case 4:return Ol(),null;case 10:return fl(t.type._context),null;case 22:case 23:return Jd(),null;default:return null}}yu=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},_u=function(){},xu=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Dl(Ll.current);var a,o=null;switch(n){case"input":r=Un(e,r),i=Un(e,i),o=[];break;case"select":r=En({},r,{value:void 0}),i=En({},i,{value:void 0}),o=[];break;case"textarea":r=Gn(e,r),i=Gn(e,i),o=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(e.onclick=Bo)}for(c in oi(n,i),n=null,r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var s=r[c];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(qt.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in i){var l=i[c];if(s=null!=r?r[c]:void 0,i.hasOwnProperty(c)&&l!==s&&(null!=l||null!=s))if("style"===c)if(s){for(a in s)!s.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&s[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,s=s?s.__html:void 0,null!=l&&s!==l&&(o=o||[]).push(c,l)):"children"===c?"string"!=typeof l&&"number"!=typeof l||(o=o||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(qt.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&To("scroll",e),o||s===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},bu=function(e,t,n,i){n!==i&&(t.flags|=4)};var Du=!1,Uu=!1,Ou="function"==typeof WeakSet?WeakSet:Set,Fu=null;function zu(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(i){dh(e,t,i)}else n.current=null}function Bu(e,t,n){try{n()}catch(i){dh(e,t,i)}}var Hu=!1;function Vu(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&Bu(t,n,a)}r=r.next}while(r!==i)}}function Wu(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function Gu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function $u(e){var t=e.alternate;null!==t&&(e.alternate=null,$u(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[es],delete t[ts],delete t[is],delete t[rs],delete t[as])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Xu(e){return 5===e.tag||3===e.tag||4===e.tag}function qu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Xu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Ku(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Bo));else if(4!==i&&null!==(e=e.child))for(Ku(e,t,n),e=e.sibling;null!==e;)Ku(e,t,n),e=e.sibling}function Yu(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(Yu(e,t,n),e=e.sibling;null!==e;)Yu(e,t,n),e=e.sibling}var Zu=null,Ju=!1;function Qu(e,t,n){for(n=n.child;null!==n;)ed(e,t,n),n=n.sibling}function ed(e,t,n){if(Xi&&"function"==typeof Xi.onCommitFiberUnmount)try{Xi.onCommitFiberUnmount($i,n)}catch(s){}switch(n.tag){case 5:Uu||zu(n,t);case 6:var i=Zu,r=Ju;Zu=null,Qu(e,t,n),Ju=r,null!==(Zu=i)&&(Ju?(e=Zu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):Zu.removeChild(n.stateNode));break;case 18:null!==Zu&&(Ju?(e=Zu,n=n.stateNode,8===e.nodeType?Yo(e.parentNode,n):1===e.nodeType&&Yo(e,n),Ar(e)):Yo(Zu,n.stateNode));break;case 4:i=Zu,r=Ju,Zu=n.stateNode.containerInfo,Ju=!0,Qu(e,t,n),Zu=i,Ju=r;break;case 0:case 11:case 14:case 15:if(!Uu&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(2&a||4&a)&&Bu(n,t,o),r=r.next}while(r!==i)}Qu(e,t,n);break;case 1:if(!Uu&&(zu(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){dh(n,t,s)}Qu(e,t,n);break;case 21:Qu(e,t,n);break;case 22:1&n.mode?(Uu=(i=Uu)||null!==n.memoizedState,Qu(e,t,n),Uu=i):Qu(e,t,n);break;default:Qu(e,t,n)}}function td(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ou),t.forEach(function(t){var i=fh.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function nd(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,o=t,s=o;e:for(;null!==s;){switch(s.tag){case 5:Zu=s.stateNode,Ju=!1;break e;case 3:case 4:Zu=s.stateNode.containerInfo,Ju=!0;break e}s=s.return}if(null===Zu)throw Error($t(160));ed(a,o,r),Zu=null,Ju=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(c){dh(r,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)id(t,e),t=t.sibling}function id(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nd(t,e),rd(e),4&i){try{Vu(3,e,e.return),Wu(3,e)}catch(f){dh(e,e.return,f)}try{Vu(5,e,e.return)}catch(f){dh(e,e.return,f)}}break;case 1:nd(t,e),rd(e),512&i&&null!==n&&zu(n,n.return);break;case 5:if(nd(t,e),rd(e),512&i&&null!==n&&zu(n,n.return),32&e.flags){var r=e.stateNode;try{ei(r,"")}catch(f){dh(e,e.return,f)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,s=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===s&&"radio"===a.type&&null!=a.name&&Fn(r,a),si(s,o);var c=si(s,a);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];"style"===u?ri(r,d):"dangerouslySetInnerHTML"===u?Qn(r,d):"children"===u?ei(r,d):sn(r,u,d,c)}switch(s){case"input":zn(r,a);break;case"textarea":Xn(r,a);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?Wn(r,!!a.multiple,p,!1):h!==!!a.multiple&&(null!=a.defaultValue?Wn(r,!!a.multiple,a.defaultValue,!0):Wn(r,!!a.multiple,a.multiple?[]:"",!1))}r[ts]=a}catch(f){dh(e,e.return,f)}}break;case 6:if(nd(t,e),rd(e),4&i){if(null===e.stateNode)throw Error($t(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(f){dh(e,e.return,f)}}break;case 3:if(nd(t,e),rd(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ar(t.containerInfo)}catch(f){dh(e,e.return,f)}break;case 4:default:nd(t,e),rd(e);break;case 13:nd(t,e),rd(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Pd=Fi())),4&i&&td(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Uu=(c=Uu)||u,nd(t,e),Uu=c):nd(t,e),rd(e),8192&i){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!u&&1&e.mode)for(Fu=e,u=e.child;null!==u;){for(d=Fu=u;null!==Fu;){switch(p=(h=Fu).child,h.tag){case 0:case 11:case 14:case 15:Vu(4,h,h.return);break;case 1:zu(h,h.return);var m=h.stateNode;if("function"==typeof m.componentWillUnmount){i=h,n=h.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(f){dh(i,n,f)}}break;case 5:zu(h,h.return);break;case 22:if(null!==h.memoizedState){ld(d);continue}}null!==p?(p.return=h,Fu=p):ld(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{r=d.stateNode,c?"function"==typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(s=d.stateNode,o=null!=(l=d.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,s.style.display=ii("display",o))}catch(f){dh(e,e.return,f)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(f){dh(e,e.return,f)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:nd(t,e),rd(e),4&i&&td(e);case 21:}}function rd(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(Xu(n)){var i=n;break e}n=n.return}throw Error($t(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(ei(r,""),i.flags&=-33),Yu(e,qu(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;Ku(e,qu(e),a);break;default:throw Error($t(161))}}catch(o){dh(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function ad(e,t,n){Fu=e,od(e)}function od(e,t,n){for(var i=!!(1&e.mode);null!==Fu;){var r=Fu,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Du;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Uu;s=Du;var c=Uu;if(Du=o,(Uu=l)&&!c)for(Fu=r;null!==Fu;)l=(o=Fu).child,22===o.tag&&null!==o.memoizedState?cd(r):null!==l?(l.return=o,Fu=l):cd(r);for(;null!==a;)Fu=a,od(a),a=a.sibling;Fu=r,Du=s,Uu=c}sd(e)}else 8772&r.subtreeFlags&&null!==a?(a.return=r,Fu=a):sd(e)}}function sd(e){for(;null!==Fu;){var t=Fu;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Uu||Wu(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Uu)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:Vc(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Nl(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Nl(t,o,n)}break;case 5:var s=t.stateNode;if(null===n&&4&t.flags){n=s;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Ar(d)}}}break;default:throw Error($t(163))}Uu||512&t.flags&&Gu(t)}catch(h){dh(t,t.return,h)}}if(t===e){Fu=null;break}if(null!==(n=t.sibling)){n.return=t.return,Fu=n;break}Fu=t.return}}function ld(e){for(;null!==Fu;){var t=Fu;if(t===e){Fu=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Fu=n;break}Fu=t.return}}function cd(e){for(;null!==Fu;){var t=Fu;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Wu(4,t)}catch(l){dh(t,n,l)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){dh(t,r,l)}}var a=t.return;try{Gu(t)}catch(l){dh(t,a,l)}break;case 5:var o=t.return;try{Gu(t)}catch(l){dh(t,o,l)}}}catch(l){dh(t,t.return,l)}if(t===e){Fu=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Fu=s;break}Fu=t.return}}var ud,dd=Math.ceil,hd=ln.ReactCurrentDispatcher,pd=ln.ReactCurrentOwner,md=ln.ReactCurrentBatchConfig,fd=0,gd=null,vd=null,yd=0,_d=0,xd=hs(0),bd=0,Sd=null,wd=0,Md=0,Ed=0,Cd=null,Td=null,Pd=0,kd=1/0,Ad=null,Nd=!1,Rd=null,Ld=null,Id=!1,jd=null,Dd=0,Ud=0,Od=null,Fd=-1,zd=0;function Bd(){return 6&fd?Fi():-1!==Fd?Fd:Fd=Fi()}function Hd(e){return 1&e.mode?2&fd&&0!==yd?yd&-yd:null!==il.transition?(0===zd&&(zd=ir()),zd):0!==(e=sr)?e:e=void 0===(e=window.event)?16:Or(e.type):1}function Vd(e,t,n,i){if(50<Ud)throw Ud=0,Od=null,Error($t(185));ar(e,n,i),2&fd&&e===gd||(e===gd&&(!(2&fd)&&(Md|=n),4===bd&&qd(e,yd)),Wd(e,i),1===n&&0===fd&&!(1&t.mode)&&(kd=Fi()+500,Ts&&As()))}function Wd(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-qi(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=tr(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=er(e,e===gd?yd:0);if(0===i)null!==n&&Di(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Di(n),1===t)0===e.tag?function(e){Ts=!0,ks(e)}(Kd.bind(null,e)):ks(Kd.bind(null,e)),qo(function(){!(6&fd)&&As()}),n=null;else{switch(lr(i)){case 1:n=Bi;break;case 4:n=Hi;break;case 16:default:n=Vi;break;case 536870912:n=Gi}n=gh(n,Gd.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Gd(e,t){if(Fd=-1,zd=0,6&fd)throw Error($t(327));var n=e.callbackNode;if(ch()&&e.callbackNode!==n)return null;var i=er(e,e===gd?yd:0);if(0===i)return null;if(30&i||0!==(i&e.expiredLanes)||t)t=ih(e,i);else{t=i;var r=fd;fd|=2;var a=th();for(gd===e&&yd===t||(Ad=null,kd=Fi()+500,Qd(e,t));;)try{ah();break}catch(s){eh(e,s)}ml(),hd.current=a,fd=r,null!==vd?t=0:(gd=null,yd=0,t=bd)}if(0!==t){if(2===t&&(0!==(r=nr(e))&&(i=r,t=$d(e,r))),1===t)throw n=Sd,Qd(e,0),qd(e,i),Wd(e,Fi()),n;if(6===t)qd(e,i);else{if(r=e.current.alternate,!(30&i||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!qa(a(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)||(t=ih(e,i),2===t&&(a=nr(e),0!==a&&(i=a,t=$d(e,a))),1!==t)))throw n=Sd,Qd(e,0),qd(e,i),Wd(e,Fi()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error($t(345));case 2:case 5:lh(e,Td,Ad);break;case 3:if(qd(e,i),(130023424&i)===i&&10<(t=Pd+500-Fi())){if(0!==er(e,0))break;if(((r=e.suspendedLanes)&i)!==i){Bd(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Go(lh.bind(null,e,Td,Ad),t);break}lh(e,Td,Ad);break;case 4:if(qd(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var o=31-qi(i);a=1<<o,(o=t[o])>r&&(r=o),i&=~a}if(i=r,10<(i=(120>(i=Fi()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*dd(i/1960))-i)){e.timeoutHandle=Go(lh.bind(null,e,Td,Ad),i);break}lh(e,Td,Ad);break;default:throw Error($t(329))}}}return Wd(e,Fi()),e.callbackNode===n?Gd.bind(null,e):null}function $d(e,t){var n=Cd;return e.current.memoizedState.isDehydrated&&(Qd(e,t).flags|=256),2!==(e=ih(e,t))&&(t=Td,Td=n,null!==t&&Xd(t)),e}function Xd(e){null===Td?Td=e:Td.push.apply(Td,e)}function qd(e,t){for(t&=~Ed,t&=~Md,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-qi(t),i=1<<n;e[n]=-1,t&=~i}}function Kd(e){if(6&fd)throw Error($t(327));ch();var t=er(e,0);if(!(1&t))return Wd(e,Fi()),null;var n=ih(e,t);if(0!==e.tag&&2===n){var i=nr(e);0!==i&&(t=i,n=$d(e,i))}if(1===n)throw n=Sd,Qd(e,0),qd(e,t),Wd(e,Fi()),n;if(6===n)throw Error($t(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,lh(e,Td,Ad),Wd(e,Fi()),null}function Yd(e,t){var n=fd;fd|=1;try{return e(t)}finally{0===(fd=n)&&(kd=Fi()+500,Ts&&As())}}function Zd(e){null!==jd&&0===jd.tag&&!(6&fd)&&ch();var t=fd;fd|=1;var n=md.transition,i=sr;try{if(md.transition=null,sr=1,e)return e()}finally{sr=i,md.transition=n,!(6&(fd=t))&&As()}}function Jd(){_d=xd.current,ps(xd)}function Qd(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,$o(n)),null!==vd)for(n=vd.return;null!==n;){var i=n;switch(Vs(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&bs();break;case 3:Ol(),ps(vs),ps(gs),Wl();break;case 5:zl(i);break;case 4:Ol();break;case 13:case 19:ps(Bl);break;case 10:fl(i.type._context);break;case 22:case 23:Jd()}n=n.return}if(gd=e,vd=e=xh(e.current,null),yd=_d=t,bd=0,Sd=null,Ed=Md=wd=0,Td=Cd=null,null!==_l){for(t=0;t<_l.length;t++)if(null!==(i=(n=_l[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}_l=null}return e}function eh(e,t){for(;;){var n=vd;try{if(ml(),Gl.current=Fc,Zl){for(var i=ql.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Zl=!1}if(Xl=0,Yl=Kl=ql=null,Jl=!1,Ql=0,pd.current=null,null===n||null===n.return){bd=1,Sd=t,vd=null;break}e:{var a=e,o=n.return,s=n,l=t;if(t=yd,s.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l,u=s,d=u.tag;if(!(1&u.mode||0!==d&&11!==d&&15!==d)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=iu(o);if(null!==p){p.flags&=-257,ru(p,o,s,0,t),1&p.mode&&nu(a,c,t),l=c;var m=(t=p).updateQueue;if(null===m){var f=new Set;f.add(l),t.updateQueue=f}else m.add(l);break e}if(!(1&t)){nu(a,c,t),nh();break e}l=Error($t(426))}else if($s&&1&s.mode){var g=iu(o);if(null!==g){!(65536&g.flags)&&(g.flags|=256),ru(g,o,s,0,t),nl(Yc(l,s));break e}}a=l=Yc(l,s),4!==bd&&(bd=2),null===Cd?Cd=[a]:Cd.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,kl(a,eu(0,l,t));break e;case 1:s=l;var v=a.type,y=a.stateNode;if(!(128&a.flags||"function"!=typeof v.getDerivedStateFromError&&(null===y||"function"!=typeof y.componentDidCatch||null!==Ld&&Ld.has(y)))){a.flags|=65536,t&=-t,a.lanes|=t,kl(a,tu(a,s,t));break e}}a=a.return}while(null!==a)}sh(n)}catch(_){t=_,vd===n&&null!==n&&(vd=n=n.return);continue}break}}function th(){var e=hd.current;return hd.current=Fc,null===e?Fc:e}function nh(){0!==bd&&3!==bd&&2!==bd||(bd=4),null===gd||!(268435455&wd)&&!(268435455&Md)||qd(gd,yd)}function ih(e,t){var n=fd;fd|=2;var i=th();for(gd===e&&yd===t||(Ad=null,Qd(e,t));;)try{rh();break}catch(r){eh(e,r)}if(ml(),fd=n,hd.current=i,null!==vd)throw Error($t(261));return gd=null,yd=0,bd}function rh(){for(;null!==vd;)oh(vd)}function ah(){for(;null!==vd&&!Ui();)oh(vd)}function oh(e){var t=ud(e.alternate,e,_d);e.memoizedProps=e.pendingProps,null===t?sh(e):vd=t,pd.current=null}function sh(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=ju(n,t)))return n.flags&=32767,void(vd=n);if(null===e)return bd=6,void(vd=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Iu(n,t,_d)))return void(vd=n);if(null!==(t=t.sibling))return void(vd=t);vd=t=e}while(null!==t);0===bd&&(bd=5)}function lh(e,t,n){var i=sr,r=md.transition;try{md.transition=null,sr=1,function(e,t,n,i){do{ch()}while(null!==jd);if(6&fd)throw Error($t(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error($t(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-qi(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,a),e===gd&&(vd=gd=null,yd=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Id||(Id=!0,gh(Vi,function(){return ch(),null})),a=!!(15990&n.flags),!!(15990&n.subtreeFlags)||a){a=md.transition,md.transition=null;var o=sr;sr=1;var s=fd;fd|=4,pd.current=null,function(e,t){if(Ho=Rr,eo(e=Qa())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(x){n=null;break e}var o=0,s=-1,l=-1,c=0,u=0,d=e,h=null;t:for(;;){for(var p;d!==n||0!==r&&3!==d.nodeType||(s=o+r),d!==a||0!==i&&3!==d.nodeType||(l=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)h=d,d=p;for(;;){if(d===e)break t;if(h===n&&++c===r&&(s=o),h===a&&++u===i&&(l=o),null!==(p=d.nextSibling))break;h=(d=h).parentNode}d=p}n=-1===s||-1===l?null:{start:s,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Vo={focusedElem:e,selectionRange:n},Rr=!1,Fu=t;null!==Fu;)if(e=(t=Fu).child,1028&t.subtreeFlags&&null!==e)e.return=t,Fu=e;else for(;null!==Fu;){t=Fu;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var f=m.memoizedProps,g=m.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?f:Vc(t.type,f),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error($t(163))}}catch(x){dh(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Fu=e;break}Fu=t.return}m=Hu,Hu=!1}(e,n),id(n,e),to(Vo),Rr=!!Ho,Vo=Ho=null,e.current=n,ad(n),Oi(),fd=s,sr=o,md.transition=a}else e.current=n;if(Id&&(Id=!1,jd=e,Dd=r),a=e.pendingLanes,0===a&&(Ld=null),function(e){if(Xi&&"function"==typeof Xi.onCommitFiberRoot)try{Xi.onCommitFiberRoot($i,e,void 0,!(128&~e.current.flags))}catch(t){}}(n.stateNode),Wd(e,Fi()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Nd)throw Nd=!1,e=Rd,Rd=null,e;!!(1&Dd)&&0!==e.tag&&ch(),a=e.pendingLanes,1&a?e===Od?Ud++:(Ud=0,Od=e):Ud=0,As()}(e,t,n,i)}finally{md.transition=r,sr=i}return null}function ch(){if(null!==jd){var e=lr(Dd),t=md.transition,n=sr;try{if(md.transition=null,sr=16>e?16:e,null===jd)var i=!1;else{if(e=jd,jd=null,Dd=0,6&fd)throw Error($t(331));var r=fd;for(fd|=4,Fu=e.current;null!==Fu;){var a=Fu,o=a.child;if(16&Fu.flags){var s=a.deletions;if(null!==s){for(var l=0;l<s.length;l++){var c=s[l];for(Fu=c;null!==Fu;){var u=Fu;switch(u.tag){case 0:case 11:case 15:Vu(8,u,a)}var d=u.child;if(null!==d)d.return=u,Fu=d;else for(;null!==Fu;){var h=(u=Fu).sibling,p=u.return;if($u(u),u===c){Fu=null;break}if(null!==h){h.return=p,Fu=h;break}Fu=p}}}var m=a.alternate;if(null!==m){var f=m.child;if(null!==f){m.child=null;do{var g=f.sibling;f.sibling=null,f=g}while(null!==f)}}Fu=a}}if(2064&a.subtreeFlags&&null!==o)o.return=a,Fu=o;else e:for(;null!==Fu;){if(2048&(a=Fu).flags)switch(a.tag){case 0:case 11:case 15:Vu(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,Fu=v;break e}Fu=a.return}}var y=e.current;for(Fu=y;null!==Fu;){var _=(o=Fu).child;if(2064&o.subtreeFlags&&null!==_)_.return=o,Fu=_;else e:for(o=y;null!==Fu;){if(2048&(s=Fu).flags)try{switch(s.tag){case 0:case 11:case 15:Wu(9,s)}}catch(b){dh(s,s.return,b)}if(s===o){Fu=null;break e}var x=s.sibling;if(null!==x){x.return=s.return,Fu=x;break e}Fu=s.return}}if(fd=r,As(),Xi&&"function"==typeof Xi.onPostCommitFiberRoot)try{Xi.onPostCommitFiberRoot($i,e)}catch(b){}i=!0}return i}finally{sr=n,md.transition=t}}return!1}function uh(e,t,n){e=Tl(e,t=eu(0,t=Yc(n,t),1),1),t=Bd(),null!==e&&(ar(e,1,t),Wd(e,t))}function dh(e,t,n){if(3===e.tag)uh(e,e,n);else for(;null!==t;){if(3===t.tag){uh(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Ld||!Ld.has(i))){t=Tl(t,e=tu(t,e=Yc(n,e),1),1),e=Bd(),null!==t&&(ar(t,1,e),Wd(t,e));break}}t=t.return}}function hh(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=Bd(),e.pingedLanes|=e.suspendedLanes&n,gd===e&&(yd&n)===n&&(4===bd||3===bd&&(130023424&yd)===yd&&500>Fi()-Pd?Qd(e,0):Ed|=n),Wd(e,t)}function ph(e,t){0===t&&(1&e.mode?(t=Ji,!(130023424&(Ji<<=1))&&(Ji=4194304)):t=1);var n=Bd();null!==(e=Sl(e,t))&&(ar(e,t,n),Wd(e,n))}function mh(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ph(e,n)}function fh(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error($t(314))}null!==i&&i.delete(t),ph(e,n)}function gh(e,t){return ji(e,t)}function vh(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yh(e,t,n,i){return new vh(e,t,n,i)}function _h(e){return!(!(e=e.prototype)||!e.isReactComponent)}function xh(e,t){var n=e.alternate;return null===n?((n=yh(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function bh(e,t,n,i,r,a){var o=2;if(i=e,"function"==typeof e)_h(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case dn:return Sh(n.children,r,a,t);case hn:o=8,r|=8;break;case pn:return(e=yh(12,n,t,2|r)).elementType=pn,e.lanes=a,e;case vn:return(e=yh(13,n,t,r)).elementType=vn,e.lanes=a,e;case yn:return(e=yh(19,n,t,r)).elementType=yn,e.lanes=a,e;case bn:return wh(n,r,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case mn:o=10;break e;case fn:o=9;break e;case gn:o=11;break e;case _n:o=14;break e;case xn:o=16,i=null;break e}throw Error($t(130,null==e?e:typeof e,""))}return(t=yh(o,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Sh(e,t,n,i){return(e=yh(7,e,i,t)).lanes=n,e}function wh(e,t,n,i){return(e=yh(22,e,i,t)).elementType=bn,e.lanes=n,e.stateNode={isHidden:!1},e}function Mh(e,t,n){return(e=yh(6,e,null,t)).lanes=n,e}function Eh(e,t,n){return(t=yh(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ch(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rr(0),this.expirationTimes=rr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rr(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Th(e,t,n,i,r,a,o,s,l){return e=new Ch(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=yh(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ml(a),e}function Ph(e){if(!e)return fs;e:{if(Ai(e=e._reactInternals)!==e||1!==e.tag)throw Error($t(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xs(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error($t(171))}if(1===e.tag){var n=e.type;if(xs(n))return ws(e,n,t)}return t}function kh(e,t,n,i,r,a,o,s,l){return(e=Th(n,i,!0,e,0,a,0,s,l)).context=Ph(null),n=e.current,(a=Cl(i=Bd(),r=Hd(n))).callback=null!=t?t:null,Tl(n,a,r),e.current.lanes=r,ar(e,r,i),Wd(e,i),e}function Ah(e,t,n,i){var r=t.current,a=Bd(),o=Hd(r);return n=Ph(n),null===t.context?t.context=n:t.pendingContext=n,(t=Cl(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Tl(r,t,o))&&(Vd(e,r,o,a),Pl(e,r,o)),o}function Nh(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Rh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Lh(e,t){Rh(e,t),(e=e.alternate)&&Rh(e,t)}ud=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||vs.current)ou=!0;else{if(0===(e.lanes&n)&&!(128&t.flags))return ou=!1,function(e,t,n){switch(t.tag){case 3:gu(t),tl();break;case 5:Fl(t);break;case 1:xs(t.type)&&Ms(t);break;case 4:Ul(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;ms(ul,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(ms(Bl,1&Bl.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Mu(e,t,n):(ms(Bl,1&Bl.current),null!==(e=Nu(e,t,n))?e.sibling:null);ms(Bl,1&Bl.current);break;case 19:if(i=0!==(n&t.childLanes),128&e.flags){if(i)return ku(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),ms(Bl,Bl.current),i)break;return null;case 22:case 23:return t.lanes=0,du(e,t,n)}return Nu(e,t,n)}(e,t,n);ou=!!(131072&e.flags)}else ou=!1,$s&&1048576&t.flags&&Bs(t,Is,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Au(e,t),e=t.pendingProps;var r=_s(t,gs.current);vl(t,n),r=ic(null,t,i,e,r,n);var a=rc();return t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xs(i)?(a=!0,Ms(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ml(t),r.updater=Gc,t.stateNode=r,r._reactInternals=t,Kc(t,i,e,n),t=fu(null,t,i,!0,a,n)):(t.tag=0,$s&&a&&Hs(t),su(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Au(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"==typeof e)return _h(e)?1:0;if(null!=e){if((e=e.$$typeof)===gn)return 11;if(e===_n)return 14}return 2}(i),e=Vc(i,e),r){case 0:t=pu(null,t,i,e,n);break e;case 1:t=mu(null,t,i,e,n);break e;case 11:t=lu(null,t,i,e,n);break e;case 14:t=cu(null,t,i,Vc(i.type,e),n);break e}throw Error($t(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,pu(e,t,i,r=t.elementType===i?r:Vc(i,r),n);case 1:return i=t.type,r=t.pendingProps,mu(e,t,i,r=t.elementType===i?r:Vc(i,r),n);case 3:e:{if(gu(t),null===e)throw Error($t(387));i=t.pendingProps,r=(a=t.memoizedState).element,El(e,t),Al(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=vu(e,t,i,n,r=Yc(Error($t(423)),t));break e}if(i!==r){t=vu(e,t,i,n,r=Yc(Error($t(424)),t));break e}for(Gs=Zo(t.stateNode.containerInfo.firstChild),Ws=t,$s=!0,Xs=null,n=cl(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(tl(),i===r){t=Nu(e,t,n);break e}su(e,t,i,n)}t=t.child}return t;case 5:return Fl(t),null===e&&Zs(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,Wo(i,r)?o=null:null!==a&&Wo(i,a)&&(t.flags|=32),hu(e,t),su(e,t,o,n),t.child;case 6:return null===e&&Zs(t),null;case 13:return Mu(e,t,n);case 4:return Ul(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ll(t,null,i,n):su(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,lu(e,t,i,r=t.elementType===i?r:Vc(i,r),n);case 7:return su(e,t,t.pendingProps,n),t.child;case 8:case 12:return su(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,ms(ul,i._currentValue),i._currentValue=o,null!==a)if(qa(a.value,o)){if(a.children===r.children&&!vs.current){t=Nu(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var s=a.dependencies;if(null!==s){o=a.child;for(var l=s.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=Cl(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var u=(c=c.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),gl(a.return,n,t),s.lanes|=n;break}l=l.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error($t(341));o.lanes|=n,null!==(s=o.alternate)&&(s.lanes|=n),gl(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}su(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,vl(t,n),i=i(r=yl(r)),t.flags|=1,su(e,t,i,n),t.child;case 14:return r=Vc(i=t.type,t.pendingProps),cu(e,t,i,r=Vc(i.type,r),n);case 15:return uu(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Vc(i,r),Au(e,t),t.tag=1,xs(i)?(e=!0,Ms(t)):e=!1,vl(t,n),Xc(t,i,r),Kc(t,i,r,n),fu(null,t,i,!0,e,n);case 19:return ku(e,t,n);case 22:return du(e,t,n)}throw Error($t(156,t.tag))};var Ih="function"==typeof reportError?reportError:function(e){console.error(e)};function jh(e){this._internalRoot=e}function Dh(e){this._internalRoot=e}function Uh(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Oh(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Fh(){}function zh(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"==typeof r){var s=r;r=function(){var e=Nh(o);s.call(e)}}Ah(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"==typeof i){var a=i;i=function(){var e=Nh(o);a.call(e)}}var o=kh(t,i,e,0,null,!1,0,"",Fh);return e._reactRootContainer=o,e[ns]=o.current,Ao(8===e.nodeType?e.parentNode:e),Zd(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var s=i;i=function(){var e=Nh(l);s.call(e)}}var l=Th(e,0,!1,null,0,!1,0,"",Fh);return e._reactRootContainer=l,e[ns]=l.current,Ao(8===e.nodeType?e.parentNode:e),Zd(function(){Ah(t,l,n,i)}),l}(n,t,e,r,i);return Nh(o)}Dh.prototype.render=jh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error($t(409));Ah(e,t,null,null)},Dh.prototype.unmount=jh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Zd(function(){Ah(null,e,null,null)}),t[ns]=null}},Dh.prototype.unstable_scheduleHydration=function(e){if(e){var t=hr();e={blockedOn:null,target:e,priority:t};for(var n=0;n<br.length&&0!==t&&t<br[n].priority;n++);br.splice(n,0,e),0===n&&Er(e)}},cr=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Qi(t.pendingLanes);0!==n&&(or(t,1|n),Wd(t,Fi()),!(6&fd)&&(kd=Fi()+500,As()))}break;case 13:Zd(function(){var t=Sl(e,1);if(null!==t){var n=Bd();Vd(t,e,1,n)}}),Lh(e,1)}},ur=function(e){if(13===e.tag){var t=Sl(e,134217728);if(null!==t)Vd(t,e,134217728,Bd());Lh(e,134217728)}},dr=function(e){if(13===e.tag){var t=Hd(e),n=Sl(e,t);if(null!==n)Vd(n,e,t,Bd());Lh(e,t)}},hr=function(){return sr},pr=function(e,t){var n=sr;try{return sr=e,t()}finally{sr=n}},ui=function(e,t,n){switch(t){case"input":if(zn(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=cs(i);if(!r)throw Error($t(90));jn(i),zn(i,r)}}}break;case"textarea":Xn(e,n);break;case"select":null!=(t=n.value)&&Wn(e,!!n.multiple,t,!1)}},gi=Yd,vi=Zd;var Bh={usingClientEntryPoint:!1,Events:[ss,ls,cs,mi,fi,Yd]},Hh={findFiberByHostInstance:os,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Vh={bundleType:Hh.bundleType,version:Hh.version,rendererPackageName:Hh.rendererPackageName,rendererConfig:Hh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ln.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Li(e))?null:e.stateNode},findFiberByHostInstance:Hh.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Wh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wh.isDisabled&&Wh.supportsFiber)try{$i=Wh.inject(Vh),Xi=Wh}catch(Jn){}}zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bh,zt.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Uh(t))throw Error($t(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:un,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},zt.createRoot=function(e,t){if(!Uh(e))throw Error($t(299));var n=!1,i="",r=Ih;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Th(e,1,!1,null,0,n,0,i,r),e[ns]=t.current,Ao(8===e.nodeType?e.parentNode:e),new jh(t)},zt.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error($t(188));throw e=Object.keys(e).join(","),Error($t(268,e))}return e=null===(e=Li(t))?null:e.stateNode},zt.flushSync=function(e){return Zd(e)},zt.hydrate=function(e,t,n){if(!Oh(t))throw Error($t(200));return zh(null,e,t,!0,n)},zt.hydrateRoot=function(e,t,n){if(!Uh(e))throw Error($t(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",o=Ih;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=kh(t,null,e,1,null!=n?n:null,r,0,a,o),e[ns]=t.current,Ao(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Dh(t)},zt.render=function(e,t,n){if(!Oh(t))throw Error($t(200));return zh(null,e,t,!1,n)},zt.unmountComponentAtNode=function(e){if(!Oh(e))throw Error($t(40));return!!e._reactRootContainer&&(Zd(function(){zh(null,null,e,!1,function(){e._reactRootContainer=null,e[ns]=null})}),!0)},zt.unstable_batchedUpdates=Yd,zt.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Oh(n))throw Error($t(200));if(null==e||void 0===e._reactInternals)throw Error($t(38));return zh(e,t,n,!1,i)},zt.version="18.3.1-next-f1338f8080-20240426",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),Ft.exports=zt;var Gh=Ft.exports;Ot.createRoot=Gh.createRoot,Ot.hydrateRoot=Gh.hydrateRoot;var $h=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xh={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},qh=new(n=class{constructor(){Oe(this,e,Xh),Oe(this,t,!1)}setTimeoutProvider(t){Fe(this,e,t)}setTimeout(t,n){return Ue(this,e).setTimeout(t,n)}clearTimeout(t){Ue(this,e).clearTimeout(t)}setInterval(t,n){return Ue(this,e).setInterval(t,n)}clearInterval(t){Ue(this,e).clearInterval(t)}},e=new WeakMap,t=new WeakMap,n);var Kh="undefined"==typeof window||"Deno"in globalThis;function Yh(){}function Zh(e){return"number"==typeof e&&e>=0&&e!==1/0}function Jh(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Qh(e,t){return"function"==typeof e?e(t):e}function ep(e,t){return"function"==typeof e?e(t):e}function tp(e,t){const{type:n="all",exact:i,fetchStatus:r,predicate:a,queryKey:o,stale:s}=e;if(o)if(i){if(t.queryHash!==ip(o,t.options))return!1}else if(!ap(t.queryKey,o))return!1;if("all"!==n){const e=t.isActive();if("active"===n&&!e)return!1;if("inactive"===n&&e)return!1}return("boolean"!=typeof s||t.isStale()===s)&&((!r||r===t.state.fetchStatus)&&!(a&&!a(t)))}function np(e,t){const{exact:n,status:i,predicate:r,mutationKey:a}=e;if(a){if(!t.options.mutationKey)return!1;if(n){if(rp(t.options.mutationKey)!==rp(a))return!1}else if(!ap(t.options.mutationKey,a))return!1}return(!i||t.state.status===i)&&!(r&&!r(t))}function ip(e,t){return((null==t?void 0:t.queryKeyHashFn)||rp)(e)}function rp(e){return JSON.stringify(e,(e,t)=>up(t)?Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{}):t)}function ap(e,t){return e===t||typeof e==typeof t&&(!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(n=>ap(e[n],t[n])))}var op=Object.prototype.hasOwnProperty;function sp(e,t,n=0){if(e===t)return e;if(n>500)return t;const i=cp(e)&&cp(t);if(!(i||up(e)&&up(t)))return t;const r=(i?e:Object.keys(e)).length,a=i?t:Object.keys(t),o=a.length,s=i?new Array(o):{};let l=0;for(let c=0;c<o;c++){const o=i?c:a[c],u=e[o],d=t[o];if(u===d){s[o]=u,(i?c<r:op.call(e,o))&&l++;continue}if(null===u||null===d||"object"!=typeof u||"object"!=typeof d){s[o]=d;continue}const h=sp(u,d,n+1);s[o]=h,h===u&&l++}return r===o&&l===r?e:s}function lp(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function cp(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function up(e){if(!dp(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!!dp(n)&&(!!n.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function dp(e){return"[object Object]"===Object.prototype.toString.call(e)}function hp(e,t,n){return"function"==typeof n.structuralSharing?n.structuralSharing(e,t):!1!==n.structuralSharing?sp(e,t):t}function pp(e,t,n=0){const i=[...e,t];return n&&i.length>n?i.slice(1):i}function mp(e,t,n=0){const i=[t,...e];return n&&i.length>n?i.slice(0,-1):i}var fp=Symbol();function gp(e,t){return!e.queryFn&&(null==t?void 0:t.initialPromise)?()=>t.initialPromise:e.queryFn&&e.queryFn!==fp?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}function vp(e,t){return"function"==typeof e?e(...t):!!e}var yp=new(o=class extends $h{constructor(){super(),Oe(this,i),Oe(this,r),Oe(this,a),Fe(this,a,e=>{if(!Kh&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){Ue(this,r)||this.setEventListener(Ue(this,a))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=Ue(this,r))||e.call(this),Fe(this,r,void 0))}setEventListener(e){var t;Fe(this,a,e),null==(t=Ue(this,r))||t.call(this),Fe(this,r,e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){Ue(this,i)!==e&&(Fe(this,i,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return"boolean"==typeof Ue(this,i)?Ue(this,i):"hidden"!==(null==(e=globalThis.document)?void 0:e.visibilityState)}},i=new WeakMap,r=new WeakMap,a=new WeakMap,o);function _p(){let e,t;const n=new Promise((n,i)=>{e=n,t=i});function i(e){Object.assign(n,e),delete n.resolve,delete n.reject}return n.status="pending",n.catch(()=>{}),n.resolve=t=>{i({status:"fulfilled",value:t}),e(t)},n.reject=e=>{i({status:"rejected",reason:e}),t(e)},n}var xp=function(e){setTimeout(e,0)};var bp=function(){let e=[],t=0,n=e=>{e()},i=e=>{e()},r=xp;const a=i=>{t?e.push(i):r(()=>{n(i)})};return{batch:a=>{let o;t++;try{o=a()}finally{t--,t||(()=>{const t=e;e=[],t.length&&r(()=>{i(()=>{t.forEach(e=>{n(e)})})})})()}return o},batchCalls:e=>(...t)=>{a(()=>{e(...t)})},schedule:a,setNotifyFunction:e=>{n=e},setBatchNotifyFunction:e=>{i=e},setScheduler:e=>{r=e}}}(),Sp=new(u=class extends $h{constructor(){super(),Oe(this,s,!0),Oe(this,l),Oe(this,c),Fe(this,c,e=>{if(!Kh&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){Ue(this,l)||this.setEventListener(Ue(this,c))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=Ue(this,l))||e.call(this),Fe(this,l,void 0))}setEventListener(e){var t;Fe(this,c,e),null==(t=Ue(this,l))||t.call(this),Fe(this,l,e(this.setOnline.bind(this)))}setOnline(e){Ue(this,s)!==e&&(Fe(this,s,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return Ue(this,s)}},s=new WeakMap,l=new WeakMap,c=new WeakMap,u);function wp(e){return Math.min(1e3*2**e,3e4)}function Mp(e){return"online"!==(e??"online")||Sp.isOnline()}var Ep=class extends Error{constructor(e){super("CancelledError"),this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent}};function Cp(e){let t,n=!1,i=0;const r=_p(),a=()=>"pending"!==r.status,o=()=>yp.isFocused()&&("always"===e.networkMode||Sp.isOnline())&&e.canRun(),s=()=>Mp(e.networkMode)&&e.canRun(),l=e=>{a()||(null==t||t(),r.resolve(e))},c=e=>{a()||(null==t||t(),r.reject(e))},u=()=>new Promise(n=>{var i;t=e=>{(a()||o())&&n(e)},null==(i=e.onPause)||i.call(e)}).then(()=>{var n;t=void 0,a()||null==(n=e.onContinue)||n.call(e)}),d=()=>{if(a())return;let t;const r=0===i?e.initialPromise:void 0;try{t=r??e.fn()}catch(s){t=Promise.reject(s)}Promise.resolve(t).then(l).catch(t=>{var r;if(a())return;const s=e.retry??(Kh?0:3),l=e.retryDelay??wp,h="function"==typeof l?l(i,t):l,p=!0===s||"number"==typeof s&&i<s||"function"==typeof s&&s(i,t);var m;!n&&p?(i++,null==(r=e.onFail)||r.call(e,i,t),(m=h,new Promise(e=>{qh.setTimeout(e,m)})).then(()=>o()?void 0:u()).then(()=>{n?c(t):d()})):c(t)})};return{promise:r,status:()=>r.status,cancel:t=>{var n;if(!a()){const i=new Ep(t);c(i),null==(n=e.onCancel)||n.call(e,i)}},continue:()=>(null==t||t(),r),cancelRetry:()=>{n=!0},continueRetry:()=>{n=!1},canStart:s,start:()=>(s()?d():u().then(d),r)}}var Tp=(h=class{constructor(){Oe(this,d)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Zh(this.gcTime)&&Fe(this,d,qh.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Kh?1/0:3e5))}clearGcTimeout(){Ue(this,d)&&(qh.clearTimeout(Ue(this,d)),Fe(this,d,void 0))}},d=new WeakMap,h),Pp=(S=class extends Tp{constructor(e){super(),Oe(this,x),Oe(this,p),Oe(this,m),Oe(this,f),Oe(this,g),Oe(this,v),Oe(this,y),Oe(this,_),Fe(this,_,!1),Fe(this,y,e.defaultOptions),this.setOptions(e.options),this.observers=[],Fe(this,g,e.client),Fe(this,f,Ue(this,g).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Fe(this,p,Np(this.options)),this.state=e.state??Ue(this,p),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null==(e=Ue(this,v))?void 0:e.promise}setOptions(e){if(this.options={...Ue(this,y),...e},this.updateGcTime(this.options.gcTime),this.state&&void 0===this.state.data){const e=Np(this.options);void 0!==e.data&&(this.setState(Ap(e.data,e.dataUpdatedAt)),Fe(this,p,e))}}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||Ue(this,f).remove(this)}setData(e,t){const n=hp(this.state.data,e,this.options);return ze(this,x,b).call(this,{data:n,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt,manual:null==t?void 0:t.manual}),n}setState(e,t){ze(this,x,b).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t,n;const i=null==(t=Ue(this,v))?void 0:t.promise;return null==(n=Ue(this,v))||n.cancel(e),i?i.then(Yh).catch(Yh):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ue(this,p))}isActive(){return this.observers.some(e=>!1!==ep(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===fp||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===Qh(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!Jh(this.state.dataUpdatedAt,e))}onFocus(){var e;const t=this.observers.find(e=>e.shouldFetchOnWindowFocus());null==t||t.refetch({cancelRefetch:!1}),null==(e=Ue(this,v))||e.continue()}onOnline(){var e;const t=this.observers.find(e=>e.shouldFetchOnReconnect());null==t||t.refetch({cancelRefetch:!1}),null==(e=Ue(this,v))||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),Ue(this,f).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(Ue(this,v)&&(Ue(this,_)?Ue(this,v).cancel({revert:!0}):Ue(this,v).cancelRetry()),this.scheduleGc()),Ue(this,f).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ze(this,x,b).call(this,{type:"invalidate"})}async fetch(e,t){var n,i,r,a,o,s,l,c,u,d,h,p;if("idle"!==this.state.fetchStatus&&"rejected"!==(null==(n=Ue(this,v))?void 0:n.status()))if(void 0!==this.state.data&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(Ue(this,v))return Ue(this,v).continueRetry(),Ue(this,v).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const y=new AbortController,S=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(Fe(this,_,!0),y.signal)})},w=()=>{const e=gp(this.options,t),n=(()=>{const e={client:Ue(this,g),queryKey:this.queryKey,meta:this.meta};return S(e),e})();return Fe(this,_,!1),this.options.persister?this.options.persister(e,n,this):e(n)},M=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:Ue(this,g),state:this.state,fetchFn:w};return S(e),e})();null==(i=this.options.behavior)||i.onFetch(M,this),Fe(this,m,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===(null==(r=M.fetchOptions)?void 0:r.meta)||ze(this,x,b).call(this,{type:"fetch",meta:null==(a=M.fetchOptions)?void 0:a.meta}),Fe(this,v,Cp({initialPromise:null==t?void 0:t.initialPromise,fn:M.fetchFn,onCancel:e=>{e instanceof Ep&&e.revert&&this.setState({...Ue(this,m),fetchStatus:"idle"}),y.abort()},onFail:(e,t)=>{ze(this,x,b).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{ze(this,x,b).call(this,{type:"pause"})},onContinue:()=>{ze(this,x,b).call(this,{type:"continue"})},retry:M.options.retry,retryDelay:M.options.retryDelay,networkMode:M.options.networkMode,canRun:()=>!0}));try{const e=await Ue(this,v).start();if(void 0===e)throw new Error(`${this.queryHash} data is undefined`);return this.setData(e),null==(s=(o=Ue(this,f).config).onSuccess)||s.call(o,e,this),null==(c=(l=Ue(this,f).config).onSettled)||c.call(l,e,this.state.error,this),e}catch(E){if(E instanceof Ep){if(E.silent)return Ue(this,v).promise;if(E.revert){if(void 0===this.state.data)throw E;return this.state.data}}throw ze(this,x,b).call(this,{type:"error",error:E}),null==(d=(u=Ue(this,f).config).onError)||d.call(u,E,this),null==(p=(h=Ue(this,f).config).onSettled)||p.call(h,this.state.data,E,this),E}finally{this.scheduleGc()}}},p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,_=new WeakMap,x=new WeakSet,b=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...kp(t.data,this.options),fetchMeta:e.meta??null};case"success":const n={...t,...Ap(e.data,e.dataUpdatedAt),dataUpdateCount:t.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Fe(this,m,e.manual?n:void 0),n;case"error":const i=e.error;return{...t,error:i,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}})(this.state),bp.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),Ue(this,f).notify({query:this,type:"updated",action:e})})},S);function kp(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Mp(t.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}function Ap(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Np(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,n=void 0!==t,i=n?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Rp=(q=class extends $h{constructor(e,t){super(),Oe(this,O),Oe(this,w),Oe(this,M),Oe(this,E),Oe(this,C),Oe(this,T),Oe(this,P),Oe(this,k),Oe(this,A),Oe(this,N),Oe(this,R),Oe(this,L),Oe(this,I),Oe(this,j),Oe(this,D),Oe(this,U,new Set),this.options=t,Fe(this,w,e),Fe(this,A,null),Fe(this,k,_p()),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(Ue(this,M).addObserver(this),Lp(Ue(this,M),this.options)?ze(this,O,F).call(this):this.updateResult(),ze(this,O,V).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ip(Ue(this,M),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ip(Ue(this,M),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ze(this,O,W).call(this),ze(this,O,G).call(this),Ue(this,M).removeObserver(this)}setOptions(e){const t=this.options,n=Ue(this,M);if(this.options=Ue(this,w).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof ep(this.options.enabled,Ue(this,M)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ze(this,O,$).call(this),Ue(this,M).setOptions(this.options),t._defaulted&&!lp(this.options,t)&&Ue(this,w).getQueryCache().notify({type:"observerOptionsUpdated",query:Ue(this,M),observer:this});const i=this.hasListeners();i&&jp(Ue(this,M),n,this.options,t)&&ze(this,O,F).call(this),this.updateResult(),!i||Ue(this,M)===n&&ep(this.options.enabled,Ue(this,M))===ep(t.enabled,Ue(this,M))&&Qh(this.options.staleTime,Ue(this,M))===Qh(t.staleTime,Ue(this,M))||ze(this,O,z).call(this);const r=ze(this,O,B).call(this);!i||Ue(this,M)===n&&ep(this.options.enabled,Ue(this,M))===ep(t.enabled,Ue(this,M))&&r===Ue(this,D)||ze(this,O,H).call(this,r)}getOptimisticResult(e){const t=Ue(this,w).getQueryCache().build(Ue(this,w),e),n=this.createResult(t,e);return function(e,t){if(!lp(e.getCurrentResult(),t))return!0;return!1}(this,n)&&(Fe(this,C,n),Fe(this,P,this.options),Fe(this,T,Ue(this,M).state)),n}getCurrentResult(){return Ue(this,C)}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),null==t||t(n),"promise"===n&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==Ue(this,k).status||Ue(this,k).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,n))})}trackProp(e){Ue(this,U).add(e)}getCurrentQuery(){return Ue(this,M)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=Ue(this,w).defaultQueryOptions(e),n=Ue(this,w).getQueryCache().build(Ue(this,w),t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return ze(this,O,F).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),Ue(this,C)))}createResult(e,t){var n;const i=Ue(this,M),r=this.options,a=Ue(this,C),o=Ue(this,T),s=Ue(this,P),l=e!==i?e.state:Ue(this,E),{state:c}=e;let u,d={...c},h=!1;if(t._optimisticResults){const n=this.hasListeners(),a=!n&&Lp(e,t),o=n&&jp(e,i,t,r);(a||o)&&(d={...d,...kp(c.data,e.options)}),"isRestoring"===t._optimisticResults&&(d.fetchStatus="idle")}let{error:p,errorUpdatedAt:m,status:f}=d;u=d.data;let g=!1;if(void 0!==t.placeholderData&&void 0===u&&"pending"===f){let e;(null==a?void 0:a.isPlaceholderData)&&t.placeholderData===(null==s?void 0:s.placeholderData)?(e=a.data,g=!0):e="function"==typeof t.placeholderData?t.placeholderData(null==(n=Ue(this,L))?void 0:n.state.data,Ue(this,L)):t.placeholderData,void 0!==e&&(f="success",u=hp(null==a?void 0:a.data,e,t),h=!0)}if(t.select&&void 0!==u&&!g)if(a&&u===(null==o?void 0:o.data)&&t.select===Ue(this,N))u=Ue(this,R);else try{Fe(this,N,t.select),u=t.select(u),u=hp(null==a?void 0:a.data,u,t),Fe(this,R,u),Fe(this,A,null)}catch(w){Fe(this,A,w)}Ue(this,A)&&(p=Ue(this,A),u=Ue(this,R),m=Date.now(),f="error");const v="fetching"===d.fetchStatus,y="pending"===f,_="error"===f,x=y&&v,b=void 0!==u,S={status:f,fetchStatus:d.fetchStatus,isPending:y,isSuccess:"success"===f,isError:_,isInitialLoading:x,isLoading:x,data:u,dataUpdatedAt:d.dataUpdatedAt,error:p,errorUpdatedAt:m,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>l.dataUpdateCount||d.errorUpdateCount>l.errorUpdateCount,isFetching:v,isRefetching:v&&!y,isLoadingError:_&&!b,isPaused:"paused"===d.fetchStatus,isPlaceholderData:h,isRefetchError:_&&b,isStale:Dp(e,t),refetch:this.refetch,promise:Ue(this,k),isEnabled:!1!==ep(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=void 0!==S.data,n="error"===S.status&&!t,r=e=>{n?e.reject(S.error):t&&e.resolve(S.data)},a=()=>{const e=Fe(this,k,S.promise=_p());r(e)},o=Ue(this,k);switch(o.status){case"pending":e.queryHash===i.queryHash&&r(o);break;case"fulfilled":(n||S.data!==o.value)&&a();break;case"rejected":n&&S.error===o.reason||a()}}return S}updateResult(){const e=Ue(this,C),t=this.createResult(Ue(this,M),this.options);if(Fe(this,T,Ue(this,M).state),Fe(this,P,this.options),void 0!==Ue(this,T).data&&Fe(this,L,Ue(this,M)),lp(t,e))return;Fe(this,C,t);ze(this,O,X).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,n="function"==typeof t?t():t;if("all"===n||!n&&!Ue(this,U).size)return!0;const i=new Set(n??Ue(this,U));return this.options.throwOnError&&i.add("error"),Object.keys(Ue(this,C)).some(t=>{const n=t;return Ue(this,C)[n]!==e[n]&&i.has(n)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ze(this,O,V).call(this)}},w=new WeakMap,M=new WeakMap,E=new WeakMap,C=new WeakMap,T=new WeakMap,P=new WeakMap,k=new WeakMap,A=new WeakMap,N=new WeakMap,R=new WeakMap,L=new WeakMap,I=new WeakMap,j=new WeakMap,D=new WeakMap,U=new WeakMap,O=new WeakSet,F=function(e){ze(this,O,$).call(this);let t=Ue(this,M).fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(Yh)),t},z=function(){ze(this,O,W).call(this);const e=Qh(this.options.staleTime,Ue(this,M));if(Kh||Ue(this,C).isStale||!Zh(e))return;const t=Jh(Ue(this,C).dataUpdatedAt,e)+1;Fe(this,I,qh.setTimeout(()=>{Ue(this,C).isStale||this.updateResult()},t))},B=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(Ue(this,M)):this.options.refetchInterval)??!1},H=function(e){ze(this,O,G).call(this),Fe(this,D,e),!Kh&&!1!==ep(this.options.enabled,Ue(this,M))&&Zh(Ue(this,D))&&0!==Ue(this,D)&&Fe(this,j,qh.setInterval(()=>{(this.options.refetchIntervalInBackground||yp.isFocused())&&ze(this,O,F).call(this)},Ue(this,D)))},V=function(){ze(this,O,z).call(this),ze(this,O,H).call(this,ze(this,O,B).call(this))},W=function(){Ue(this,I)&&(qh.clearTimeout(Ue(this,I)),Fe(this,I,void 0))},G=function(){Ue(this,j)&&(qh.clearInterval(Ue(this,j)),Fe(this,j,void 0))},$=function(){const e=Ue(this,w).getQueryCache().build(Ue(this,w),this.options);if(e===Ue(this,M))return;const t=Ue(this,M);Fe(this,M,e),Fe(this,E,e.state),this.hasListeners()&&(null==t||t.removeObserver(this),e.addObserver(this))},X=function(e){bp.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(Ue(this,C))}),Ue(this,w).getQueryCache().notify({query:Ue(this,M),type:"observerResultsUpdated"})})},q);function Lp(e,t){return function(e,t){return!1!==ep(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&Ip(e,t,t.refetchOnMount)}function Ip(e,t,n){if(!1!==ep(t.enabled,e)&&"static"!==Qh(t.staleTime,e)){const i="function"==typeof n?n(e):n;return"always"===i||!1!==i&&Dp(e,t)}return!1}function jp(e,t,n,i){return(e!==t||!1===ep(i.enabled,e))&&(!n.suspense||"error"!==e.state.status)&&Dp(e,n)}function Dp(e,t){return!1!==ep(t.enabled,e)&&e.isStaleByTime(Qh(t.staleTime,e))}function Up(e){return{onFetch:(t,n)=>{var i,r,a,o,s;const l=t.options,c=null==(a=null==(r=null==(i=t.fetchOptions)?void 0:i.meta)?void 0:r.fetchMore)?void 0:a.direction,u=(null==(o=t.state.data)?void 0:o.pages)||[],d=(null==(s=t.state.data)?void 0:s.pageParams)||[];let h={pages:[],pageParams:[]},p=0;const m=async()=>{let n=!1;const i=e=>{!function(e,t,n){let i,r=!1;Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(i??(i=t()),r||(r=!0,i.aborted?n():i.addEventListener("abort",n,{once:!0})),i)})}(e,()=>t.signal,()=>n=!0)},r=gp(t.options,t.fetchOptions),a=async(e,a,o)=>{if(n)return Promise.reject();if(null==a&&e.pages.length)return Promise.resolve(e);const s=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:a,direction:o?"backward":"forward",meta:t.options.meta};return i(e),e})(),l=await r(s),{maxPages:c}=t.options,u=o?mp:pp;return{pages:u(e.pages,l,c),pageParams:u(e.pageParams,a,c)}};if(c&&u.length){const e="backward"===c,t={pages:u,pageParams:d},n=(e?Fp:Op)(l,t);h=await a(t,n,e)}else{const t=e??u.length;do{const e=0===p?d[0]??l.initialPageParam:Op(l,h);if(p>0&&null==e)break;h=await a(h,e),p++}while(p<t)}return h};t.options.persister?t.fetchFn=()=>{var e,i;return null==(i=(e=t.options).persister)?void 0:i.call(e,m,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=m}}}function Op(e,{pages:t,pageParams:n}){const i=t.length-1;return t.length>0?e.getNextPageParam(t[i],t,n[i],n):void 0}function Fp(e,{pages:t,pageParams:n}){var i;return t.length>0?null==(i=e.getPreviousPageParam)?void 0:i.call(e,t[0],t,n[0],n):void 0}var zp=(te=class extends Tp{constructor(e){super(),Oe(this,Q),Oe(this,K),Oe(this,Y),Oe(this,Z),Oe(this,J),Fe(this,K,e.client),this.mutationId=e.mutationId,Fe(this,Z,e.mutationCache),Fe(this,Y,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){Ue(this,Y).includes(e)||(Ue(this,Y).push(e),this.clearGcTimeout(),Ue(this,Z).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Fe(this,Y,Ue(this,Y).filter(t=>t!==e)),this.scheduleGc(),Ue(this,Z).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){Ue(this,Y).length||("pending"===this.state.status?this.scheduleGc():Ue(this,Z).remove(this))}continue(){var e;return(null==(e=Ue(this,J))?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var t,n,i,r,a,o,s,l,c,u,d,h,p,m,f,g,v,y,_,x;const b=()=>{ze(this,Q,ee).call(this,{type:"continue"})},S={client:Ue(this,K),meta:this.options.meta,mutationKey:this.options.mutationKey};Fe(this,J,Cp({fn:()=>this.options.mutationFn?this.options.mutationFn(e,S):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{ze(this,Q,ee).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{ze(this,Q,ee).call(this,{type:"pause"})},onContinue:b,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ue(this,Z).canRun(this)}));const w="pending"===this.state.status,M=!Ue(this,J).canStart();try{if(w)b();else{ze(this,Q,ee).call(this,{type:"pending",variables:e,isPaused:M}),await(null==(n=(t=Ue(this,Z).config).onMutate)?void 0:n.call(t,e,this,S));const a=await(null==(r=(i=this.options).onMutate)?void 0:r.call(i,e,S));a!==this.state.context&&ze(this,Q,ee).call(this,{type:"pending",context:a,variables:e,isPaused:M})}const p=await Ue(this,J).start();return await(null==(o=(a=Ue(this,Z).config).onSuccess)?void 0:o.call(a,p,e,this.state.context,this,S)),await(null==(l=(s=this.options).onSuccess)?void 0:l.call(s,p,e,this.state.context,S)),await(null==(u=(c=Ue(this,Z).config).onSettled)?void 0:u.call(c,p,null,this.state.variables,this.state.context,this,S)),await(null==(h=(d=this.options).onSettled)?void 0:h.call(d,p,null,e,this.state.context,S)),ze(this,Q,ee).call(this,{type:"success",data:p}),p}catch(E){try{await(null==(m=(p=Ue(this,Z).config).onError)?void 0:m.call(p,E,e,this.state.context,this,S))}catch(C){Promise.reject(C)}try{await(null==(g=(f=this.options).onError)?void 0:g.call(f,E,e,this.state.context,S))}catch(C){Promise.reject(C)}try{await(null==(y=(v=Ue(this,Z).config).onSettled)?void 0:y.call(v,void 0,E,this.state.variables,this.state.context,this,S))}catch(C){Promise.reject(C)}try{await(null==(x=(_=this.options).onSettled)?void 0:x.call(_,void 0,E,e,this.state.context,S))}catch(C){Promise.reject(C)}throw ze(this,Q,ee).call(this,{type:"error",error:E}),E}finally{Ue(this,Z).runNext(this)}}},K=new WeakMap,Y=new WeakMap,Z=new WeakMap,J=new WeakMap,Q=new WeakSet,ee=function(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),bp.batch(()=>{Ue(this,Y).forEach(t=>{t.onMutationUpdate(e)}),Ue(this,Z).notify({mutation:this,type:"updated",action:e})})},te);var Bp=(ae=class extends $h{constructor(e={}){super(),Oe(this,ne),Oe(this,ie),Oe(this,re),this.config=e,Fe(this,ne,new Set),Fe(this,ie,new Map),Fe(this,re,0)}build(e,t,n){const i=new zp({client:e,mutationCache:this,mutationId:++Be(this,re)._,options:e.defaultMutationOptions(t),state:n});return this.add(i),i}add(e){Ue(this,ne).add(e);const t=Hp(e);if("string"==typeof t){const n=Ue(this,ie).get(t);n?n.push(e):Ue(this,ie).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(Ue(this,ne).delete(e)){const t=Hp(e);if("string"==typeof t){const n=Ue(this,ie).get(t);if(n)if(n.length>1){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}else n[0]===e&&Ue(this,ie).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Hp(e);if("string"==typeof t){const n=Ue(this,ie).get(t),i=null==n?void 0:n.find(e=>"pending"===e.state.status);return!i||i===e}return!0}runNext(e){var t;const n=Hp(e);if("string"==typeof n){const i=null==(t=Ue(this,ie).get(n))?void 0:t.find(t=>t!==e&&t.state.isPaused);return(null==i?void 0:i.continue())??Promise.resolve()}return Promise.resolve()}clear(){bp.batch(()=>{Ue(this,ne).forEach(e=>{this.notify({type:"removed",mutation:e})}),Ue(this,ne).clear(),Ue(this,ie).clear()})}getAll(){return Array.from(Ue(this,ne))}find(e){const t={exact:!0,...e};return this.getAll().find(e=>np(t,e))}findAll(e={}){return this.getAll().filter(t=>np(e,t))}notify(e){bp.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return bp.batch(()=>Promise.all(e.map(e=>e.continue().catch(Yh))))}},ne=new WeakMap,ie=new WeakMap,re=new WeakMap,ae);function Hp(e){var t;return null==(t=e.options.scope)?void 0:t.id}function Vp(e,t){const n=new Set(t);return e.filter(e=>!n.has(e))}var Wp=(be=class extends $h{constructor(e,t,n){super(),Oe(this,fe),Oe(this,oe),Oe(this,se),Oe(this,le),Oe(this,ce),Oe(this,ue),Oe(this,de),Oe(this,he),Oe(this,pe),Oe(this,me,[]),Fe(this,oe,e),Fe(this,ce,n),Fe(this,le,[]),Fe(this,ue,[]),Fe(this,se,[]),this.setQueries(t)}onSubscribe(){1===this.listeners.size&&Ue(this,ue).forEach(e=>{e.subscribe(t=>{ze(this,fe,_e).call(this,e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,Ue(this,ue).forEach(e=>{e.destroy()})}setQueries(e,t){Fe(this,le,e),Fe(this,ce,t),bp.batch(()=>{const e=Ue(this,ue),t=ze(this,fe,ye).call(this,Ue(this,le));t.forEach(e=>e.observer.setOptions(e.defaultedQueryOptions));const n=t.map(e=>e.observer),i=n.map(e=>e.getCurrentResult()),r=e.length!==n.length,a=n.some((t,n)=>t!==e[n]),o=r||a,s=!!o||i.some((e,t)=>{const n=Ue(this,se)[t];return!n||!lp(e,n)});(o||s)&&(o&&(Fe(this,me,t),Fe(this,ue,n)),Fe(this,se,i),this.hasListeners()&&(o&&(Vp(e,n).forEach(e=>{e.destroy()}),Vp(n,e).forEach(e=>{e.subscribe(t=>{ze(this,fe,_e).call(this,e,t)})})),ze(this,fe,xe).call(this)))})}getCurrentResult(){return Ue(this,se)}getQueries(){return Ue(this,ue).map(e=>e.getCurrentQuery())}getObservers(){return Ue(this,ue)}getOptimisticResult(e,t){const n=ze(this,fe,ye).call(this,e),i=n.map(e=>e.observer.getOptimisticResult(e.defaultedQueryOptions));return[i,e=>ze(this,fe,ve).call(this,e??i,t),()=>ze(this,fe,ge).call(this,i,n)]}},oe=new WeakMap,se=new WeakMap,le=new WeakMap,ce=new WeakMap,ue=new WeakMap,de=new WeakMap,he=new WeakMap,pe=new WeakMap,me=new WeakMap,fe=new WeakSet,ge=function(e,t){return t.map((n,i)=>{const r=e[i];return n.defaultedQueryOptions.notifyOnChangeProps?r:n.observer.trackResult(r,e=>{t.forEach(t=>{t.observer.trackProp(e)})})})},ve=function(e,t){return t?(Ue(this,de)&&Ue(this,se)===Ue(this,pe)&&t===Ue(this,he)||(Fe(this,he,t),Fe(this,pe,Ue(this,se)),Fe(this,de,sp(Ue(this,de),t(e)))),Ue(this,de)):e},ye=function(e){const t=new Map;Ue(this,ue).forEach(e=>{const n=e.options.queryHash;if(!n)return;const i=t.get(n);i?i.push(e):t.set(n,[e])});const n=[];return e.forEach(e=>{var i;const r=Ue(this,oe).defaultQueryOptions(e),a=(null==(i=t.get(r.queryHash))?void 0:i.shift())??new Rp(Ue(this,oe),r);n.push({defaultedQueryOptions:r,observer:a})}),n},_e=function(e,t){const n=Ue(this,ue).indexOf(e);-1!==n&&(Fe(this,se,function(e,t,n){const i=e.slice(0);return i[t]=n,i}(Ue(this,se),n,t)),ze(this,fe,xe).call(this))},xe=function(){var e;if(this.hasListeners()){const t=Ue(this,de),n=ze(this,fe,ge).call(this,Ue(this,se),Ue(this,me));t!==ze(this,fe,ve).call(this,n,null==(e=Ue(this,ce))?void 0:e.combine)&&bp.batch(()=>{this.listeners.forEach(e=>{e(Ue(this,se))})})}},be),Gp=(we=class extends $h{constructor(e={}){super(),Oe(this,Se),this.config=e,Fe(this,Se,new Map)}build(e,t,n){const i=t.queryKey,r=t.queryHash??ip(i,t);let a=this.get(r);return a||(a=new Pp({client:e,queryKey:i,queryHash:r,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(i)}),this.add(a)),a}add(e){Ue(this,Se).has(e.queryHash)||(Ue(this,Se).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=Ue(this,Se).get(e.queryHash);t&&(e.destroy(),t===e&&Ue(this,Se).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){bp.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return Ue(this,Se).get(e)}getAll(){return[...Ue(this,Se).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>tp(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>tp(e,t)):t}notify(e){bp.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){bp.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){bp.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Se=new WeakMap,we),$p=(Re=class{constructor(e={}){Oe(this,Me),Oe(this,Ee),Oe(this,Ce),Oe(this,Te),Oe(this,Pe),Oe(this,ke),Oe(this,Ae),Oe(this,Ne),Fe(this,Me,e.queryCache||new Gp),Fe(this,Ee,e.mutationCache||new Bp),Fe(this,Ce,e.defaultOptions||{}),Fe(this,Te,new Map),Fe(this,Pe,new Map),Fe(this,ke,0)}mount(){Be(this,ke)._++,1===Ue(this,ke)&&(Fe(this,Ae,yp.subscribe(async e=>{e&&(await this.resumePausedMutations(),Ue(this,Me).onFocus())})),Fe(this,Ne,Sp.subscribe(async e=>{e&&(await this.resumePausedMutations(),Ue(this,Me).onOnline())})))}unmount(){var e,t;Be(this,ke)._--,0===Ue(this,ke)&&(null==(e=Ue(this,Ae))||e.call(this),Fe(this,Ae,void 0),null==(t=Ue(this,Ne))||t.call(this),Fe(this,Ne,void 0))}isFetching(e){return Ue(this,Me).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Ue(this,Ee).findAll({...e,status:"pending"}).length}getQueryData(e){var t;const n=this.defaultQueryOptions({queryKey:e});return null==(t=Ue(this,Me).get(n.queryHash))?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=Ue(this,Me).build(this,t),i=n.state.data;return void 0===i?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Qh(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(i))}getQueriesData(e){return Ue(this,Me).findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,n){const i=this.defaultQueryOptions({queryKey:e}),r=Ue(this,Me).get(i.queryHash),a=function(e,t){return"function"==typeof e?e(t):e}(t,null==r?void 0:r.state.data);if(void 0!==a)return Ue(this,Me).build(this,i).setData(a,{...n,manual:!0})}setQueriesData(e,t,n){return bp.batch(()=>Ue(this,Me).findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,n)]))}getQueryState(e){var t;const n=this.defaultQueryOptions({queryKey:e});return null==(t=Ue(this,Me).get(n.queryHash))?void 0:t.state}removeQueries(e){const t=Ue(this,Me);bp.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const n=Ue(this,Me);return bp.batch(()=>(n.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},i=bp.batch(()=>Ue(this,Me).findAll(e).map(e=>e.cancel(n)));return Promise.all(i).then(Yh).catch(Yh)}invalidateQueries(e,t={}){return bp.batch(()=>(Ue(this,Me).findAll(e).forEach(e=>{e.invalidate()}),"none"===(null==e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries({...e,type:(null==e?void 0:e.refetchType)??(null==e?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},i=bp.batch(()=>Ue(this,Me).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,n);return n.throwOnError||(t=t.catch(Yh)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(i).then(Yh)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const n=Ue(this,Me).build(this,t);return n.isStaleByTime(Qh(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Yh).catch(Yh)}fetchInfiniteQuery(e){return e.behavior=Up(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Yh).catch(Yh)}ensureInfiniteQueryData(e){return e.behavior=Up(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Sp.isOnline()?Ue(this,Ee).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ue(this,Me)}getMutationCache(){return Ue(this,Ee)}getDefaultOptions(){return Ue(this,Ce)}setDefaultOptions(e){Fe(this,Ce,e)}setQueryDefaults(e,t){Ue(this,Te).set(rp(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Ue(this,Te).values()],n={};return t.forEach(t=>{ap(e,t.queryKey)&&Object.assign(n,t.defaultOptions)}),n}setMutationDefaults(e,t){Ue(this,Pe).set(rp(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Ue(this,Pe).values()],n={};return t.forEach(t=>{ap(e,t.mutationKey)&&Object.assign(n,t.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Ue(this,Ce).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=ip(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===fp&&(t.enabled=!1),t}defaultMutationOptions(e){return(null==e?void 0:e._defaulted)?e:{...Ue(this,Ce).mutations,...(null==e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Ue(this,Me).clear(),Ue(this,Ee).clear()}},Me=new WeakMap,Ee=new WeakMap,Ce=new WeakMap,Te=new WeakMap,Pe=new WeakMap,ke=new WeakMap,Ae=new WeakMap,Ne=new WeakMap,Re),Xp=Pt.createContext(void 0),qp=({client:e,children:t})=>(Pt.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),Ut.jsx(Xp.Provider,{value:e,children:t})),Kp=Pt.createContext(!1);Kp.Provider;var Yp=Pt.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),Zp=(e,t)=>(null==e?void 0:e.suspense)&&t.isPending,Jp=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function Qp({queries:e,...t},n){const i=(()=>{const e=Pt.useContext(Xp);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e})(),r=Pt.useContext(Kp),a=Pt.useContext(Yp),o=Pt.useMemo(()=>e.map(e=>{const t=i.defaultQueryOptions(e);return t._optimisticResults=r?"isRestoring":"optimistic",t}),[e,i,r]);o.forEach(e=>{(e=>{if(e.suspense){const t=1e3,n=e=>"static"===e?e:Math.max(e??t,t),i=e.staleTime;e.staleTime="function"==typeof i?(...e)=>n(i(...e)):n(i),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,t))}})(e);const t=i.getQueryCache().get(e.queryHash);((e,t,n)=>{const i=(null==n?void 0:n.state.error)&&"function"==typeof e.throwOnError?vp(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||i)&&(t.isReset()||(e.retryOnMount=!1))})(e,a,t)}),(e=>{Pt.useEffect(()=>{e.clearReset()},[e])})(a);const[s]=Pt.useState(()=>new Wp(i,o,t)),[l,c,u]=s.getOptimisticResult(o,t.combine),d=!r&&!1!==t.subscribed;Pt.useSyncExternalStore(Pt.useCallback(e=>d?s.subscribe(bp.batchCalls(e)):Yh,[s,d]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),Pt.useEffect(()=>{s.setQueries(o,t)},[o,t,s]);const h=l.some((e,t)=>Zp(o[t],e))?l.flatMap((e,t)=>{const n=o[t];if(n){const t=new Rp(i,n);if(Zp(n,e))return Jp(n,t,a);((e,t)=>e.isLoading&&e.isFetching&&!t)(e,r)&&Jp(n,t,a)}return[]}):[];if(h.length>0)throw Promise.all(h);const p=l.find((e,t)=>{const n=o[t];return n&&(({result:e,errorResetBoundary:t,throwOnError:n,query:i,suspense:r})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(r&&void 0===e.data||vp(n,[e.error,i])))({result:e,errorResetBoundary:a,throwOnError:n.throwOnError,query:i.getQueryCache().get(n.queryHash),suspense:n.suspense})});if(null==p?void 0:p.error)throw p.error;return c(u())}const em={},tm=e=>{let t;const n=new Set,i=(e,i)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=i?i:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,a={setState:i,getState:r,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!==(em?"production":void 0)&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=t=e(i,r,a);return a};var nm={exports:{}},im={},rm={exports:{}},am={},om=Pt;var sm="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},lm=om.useState,cm=om.useEffect,um=om.useLayoutEffect,dm=om.useDebugValue;function hm(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sm(e,n)}catch(i){return!0}}var pm="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=lm({inst:{value:n,getSnapshot:t}}),r=i[0].inst,a=i[1];return um(function(){r.value=n,r.getSnapshot=t,hm(r)&&a({inst:r})},[e,n,t]),cm(function(){return hm(r)&&a({inst:r}),e(function(){hm(r)&&a({inst:r})})},[e]),dm(n),n};am.useSyncExternalStore=void 0!==om.useSyncExternalStore?om.useSyncExternalStore:pm,rm.exports=am;var mm=rm.exports,fm=Pt,gm=mm;
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vm="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ym=gm.useSyncExternalStore,_m=fm.useRef,xm=fm.useEffect,bm=fm.useMemo,Sm=fm.useDebugValue;im.useSyncExternalStoreWithSelector=function(e,t,n,i,r){var a=_m(null);if(null===a.current){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=bm(function(){function e(e){if(!l){if(l=!0,a=e,e=i(e),void 0!==r&&o.hasValue){var t=o.value;if(r(t,e))return s=t}return s=e}if(t=s,vm(a,e))return t;var n=i(e);return void 0!==r&&r(t,n)?(a=e,t):(a=e,s=n)}var a,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,i,r]);var s=ym(e,a[0],a[1]);return xm(function(){o.hasValue=!0,o.value=s},[s]),Sm(s),s},nm.exports=im;const wm=Ve(nm.exports),Mm={},{useDebugValue:Em}=kt,{useSyncExternalStoreWithSelector:Cm}=wm;let Tm=!1;const Pm=e=>e;const km=e=>{"production"!==(Mm?"production":void 0)&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?tm(e):tm)(e):e,n=(e,n)=>function(e,t=Pm,n){"production"!==(Mm?"production":void 0)&&n&&!Tm&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Tm=!0);const i=Cm(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Em(i),i}(t,e,n);return Object.assign(n,t),n},Am={camera:{camera_type:"Digital",manufacturer:"ARRI",body:"Alexa_35",sensor:"Super35",weight_class:"Medium",film_stock:"None",aspect_ratio:"1.85:1"},lens:{manufacturer:"ARRI",family:"ARRI_Signature_Prime",focal_length_mm:35,is_anamorphic:!1},movement:{equipment:"Static",movement_type:"Static",timing:"Static"},lighting:{time_of_day:"Afternoon",source:"Sun",style:"Naturalistic"},visual_grammar:{shot_size:"MS",composition:"Rule_of_Thirds",mood:"Contemplative",color_tone:"Neutral_Saturated"}},Nm={medium:"2D",style_domain:"Anime",rendering:{line_treatment:"Clean",color_application:"Cel",lighting_model:"Naturalistic_Simulated",surface_detail:"Smooth"},motion:{motion_style:"Full",virtual_camera:"Digital_Pan"},visual_grammar:{shot_size:"MS",composition:"Rule_of_Thirds",mood:"Contemplative",color_tone:"Neutral_Saturated"}},Rm=(Lm=e=>({projectType:"live_action",setProjectType:t=>e({projectType:t}),liveActionConfig:Am,animationConfig:Nm,setLiveActionConfig:t=>e({liveActionConfig:t}),setAnimationConfig:t=>e({animationConfig:t}),updateLiveAction:(t,n)=>e(e=>({liveActionConfig:{...e.liveActionConfig,[t]:"object"==typeof e.liveActionConfig[t]?{...e.liveActionConfig[t],...n}:n}})),updateAnimation:(t,n)=>e(e=>({animationConfig:{...e.animationConfig,[t]:"object"==typeof e.animationConfig[t]?{...e.animationConfig[t],...n}:n}})),validationResult:null,setValidationResult:t=>e({validationResult:t}),generatedPrompt:"",negativePrompt:null,setGeneratedPrompt:(t,n=null)=>e({generatedPrompt:t,negativePrompt:n}),targetModel:"generic",setTargetModel:t=>e({targetModel:t}),selectedLiveActionPreset:null,selectedAnimationPreset:null,liveActionPresetList:[],animationPresetList:[],setSelectedLiveActionPreset:t=>e({selectedLiveActionPreset:t}),setSelectedAnimationPreset:t=>e({selectedAnimationPreset:t}),setLiveActionPresetList:t=>e({liveActionPresetList:t}),setAnimationPresetList:t=>e({animationPresetList:t}),applyLiveActionPresetConfig:(t,n)=>e({liveActionConfig:t,selectedLiveActionPreset:n,validationResult:null,generatedPrompt:"",negativePrompt:null}),applyAnimationPresetConfig:(t,n)=>e({animationConfig:t,selectedAnimationPreset:n,validationResult:null,generatedPrompt:"",negativePrompt:null}),clearPreset:()=>e({selectedLiveActionPreset:null,selectedAnimationPreset:null}),resetConfig:()=>e({liveActionConfig:Am,animationConfig:Nm,validationResult:null,generatedPrompt:"",negativePrompt:null,selectedLiveActionPreset:null,selectedAnimationPreset:null}),cpePromptForStoryboard:null,setCpePromptForStoryboard:t=>e({cpePromptForStoryboard:t})}))?km(Lm):km;var Lm;const Im=new class{async fetch(e,t){const n=await fetch(`${e}`,{...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.detail||`API error: ${n.status}`)}return n.json()}async getOptions(e,t,n){return this.fetch("/options",{method:"POST",body:JSON.stringify({project_type:e,field_path:t,current_config:n})})}async getEnumValues(e){return(await this.fetch(`/enums/${e}`)).values}async listEnums(){return this.fetch("/enums")}async validateLiveAction(e){return this.fetch("/validate",{method:"POST",body:JSON.stringify({project_type:"live_action",config:e})})}async validateAnimation(e){return this.fetch("/validate",{method:"POST",body:JSON.stringify({project_type:"animation",config:e})})}async generateLiveActionPrompt(e,t="generic"){return this.fetch("/generate-prompt",{method:"POST",body:JSON.stringify({project_type:"live_action",config:e,target_model:t})})}async generateAnimationPrompt(e,t="generic"){return this.fetch("/generate-prompt",{method:"POST",body:JSON.stringify({project_type:"animation",config:e,target_model:t})})}async getLiveActionPresets(){return this.fetch("/presets/live-action")}async getAnimationPresets(){return this.fetch("/presets/animation")}async getLiveActionPreset(e){return this.fetch(`/presets/live-action/${e}`)}async getCinematographyStyle(e){return this.fetch(`/presets/live-action/${e}/cinematography-style`)}async getAnimationPreset(e){return this.fetch(`/presets/animation/${e}`)}async applyLiveActionPreset(e,t){return this.fetch("/apply-preset/live-action",{method:"POST",body:JSON.stringify({preset_id:e,overrides:t??null})})}async applyAnimationPreset(e,t){return this.fetch("/apply-preset/animation",{method:"POST",body:JSON.stringify({preset_id:e,overrides:t??null})})}async searchPresets(e,t,n){const i=new URLSearchParams({q:e});return t&&i.append("project_type",t),n&&i.append("limit",n.toString()),this.fetch(`/presets/search?${i.toString()}`)}async getEras(){return this.fetch("/presets/eras")}async getDomains(){return this.fetch("/presets/domains")}async listProviders(){return this.fetch("/settings/providers")}async getProvider(e){return this.fetch(`/settings/providers/${e}`)}async testProviderConnection(e,t){return this.fetch(`/settings/providers/${e}/test`,{method:"POST",body:JSON.stringify({endpoint:null==t?void 0:t.endpoint,api_key:null==t?void 0:t.apiKey})})}async detectLocalProviders(){return this.fetch("/settings/providers/local/detect")}async testCustomEndpoint(e,t){return this.fetch("/settings/custom-endpoint/test",{method:"POST",body:JSON.stringify({endpoint:e,api_key:t})})}async listOAuthProviders(){return this.fetch("/settings/oauth/providers")}async initiateOAuth(e,t,n){return this.fetch(`/settings/oauth/${e}/authorize`,{method:"POST",body:JSON.stringify({client_id:n||"",redirect_uri:t})})}async exchangeOAuthCode(e,t,n,i,r,a){return this.fetch(`/settings/oauth/${e}/callback`,{method:"POST",body:JSON.stringify({code:t,state:n,client_id:r||"",client_secret:a,redirect_uri:i})})}async getOAuthFlowType(e){return this.fetch(`/settings/oauth/${e}/flow-type`)}async requestDeviceCode(e,t){return this.fetch(`/settings/oauth/${e}/device-code`,{method:"POST",body:JSON.stringify({client_id:t||null})})}async pollDeviceToken(e,t,n){return this.fetch(`/settings/oauth/${e}/device-poll`,{method:"POST",body:JSON.stringify({client_id:n||null,device_code:t})})}async startCallbackServer(e,t,n,i){return this.fetch(`/settings/oauth/${e}/start-callback-server`,{method:"POST",body:JSON.stringify({state:t,code_verifier:n||null,custom_redirect_uri:i||null})})}async pollCallbackToken(e,t){return this.fetch(`/settings/oauth/${e}/poll-token?state=${encodeURIComponent(t)}`)}async stopCallbackServer(e,t){return this.fetch(`/settings/oauth/${e}/callback-server?state=${encodeURIComponent(t)}`,{method:"DELETE"})}async getCallbackServerStatus(e,t){return this.fetch(`/settings/oauth/${e}/callback-server-status?state=${encodeURIComponent(t)}`)}async refreshOAuthToken(e){return this.fetch(`/settings/oauth/${e}/refresh`,{method:"POST"})}async enhancePrompt(e){return this.fetch("/enhance-prompt",{method:"POST",body:JSON.stringify({user_prompt:e.userPrompt,llm_provider:e.llmProvider,llm_model:e.llmModel,target_model:e.targetModel,project_type:e.projectType,config:e.config,credentials:{api_key:e.credentials.apiKey,endpoint:e.credentials.endpoint,oauth_token:e.credentials.oauthToken}})})}async fetchLlmModels(e){return this.fetch("/llm/models",{method:"POST",body:JSON.stringify({provider:e.provider,credentials:{api_key:e.credentials.apiKey,endpoint:e.credentials.endpoint,oauth_token:e.credentials.oauthToken}})})}async getTargetModels(){return this.fetch("/target-models")}async getAllCredentials(){return this.fetch("/credentials")}async getProviderCredentials(e){return this.fetch(`/credentials/${e}`)}async updateProviderCredentials(e,t){return this.fetch(`/credentials/${e}`,{method:"PUT",body:JSON.stringify({api_key:t.api_key,endpoint:t.endpoint,oauth_token:t.oauth_token,oauth_refresh_token:t.oauth_refresh_token,oauth_client_id:t.oauth_client_id,oauth_client_secret:t.oauth_client_secret})})}async deleteProviderCredentials(e){return this.fetch(`/credentials/${e}`,{method:"DELETE"})}async getSettings(){return this.fetch("/settings")}async updateSettings(e){return this.fetch("/settings",{method:"PUT",body:JSON.stringify({active_provider:e.active_provider,selected_model:e.selected_model,target_model:e.target_model})})}async importCredentials(e){return this.fetch("/credentials/import",{method:"POST",body:JSON.stringify({data:e})})}},jm="cinema-ai-provider-settings",Dm="cinema-llm-settings",Um="cinema-target-model",Om="cinema-credentials-migrated",Fm=[{id:"openai",name:"OpenAI",type:"api_key",description:"GPT-4, GPT-4V for prompt enhancement and analysis",defaultEndpoint:"https://api.openai.com/v1",docsUrl:"https://platform.openai.com/docs"},{id:"google",name:"Google AI (Gemini)",type:"api_key",description:"Gemini Pro for multimodal prompt generation",defaultEndpoint:"https://generativelanguage.googleapis.com/v1",docsUrl:"https://ai.google.dev/docs"},{id:"anthropic",name:"Anthropic",type:"api_key",description:"Claude for prompt refinement and analysis",defaultEndpoint:"https://api.anthropic.com/v1",docsUrl:"https://docs.anthropic.com"},{id:"openrouter",name:"OpenRouter",type:"api_key",description:"Aggregated access to multiple AI models",defaultEndpoint:"https://openrouter.ai/api/v1",docsUrl:"https://openrouter.ai/docs"},{id:"replicate",name:"Replicate",type:"api_key",description:"Run open-source models including Llama, Mistral",defaultEndpoint:"https://api.replicate.com/v1",docsUrl:"https://replicate.com/docs"},{id:"stability",name:"Stability AI",type:"api_key",description:"Stable LM and language models",defaultEndpoint:"https://api.stability.ai/v1",docsUrl:"https://platform.stability.ai/docs"},{id:"ollama",name:"Ollama",type:"local",description:"Local LLM server (Llama, Mistral, etc.)",defaultEndpoint:"http://localhost:11434",docsUrl:"https://ollama.ai/docs"},{id:"lmstudio",name:"LM Studio",type:"local",description:"Local LLM with OpenAI-compatible API",defaultEndpoint:"http://localhost:1234/v1",docsUrl:"https://lmstudio.ai/docs"},{id:"github_copilot",name:"GitHub Copilot",type:"oauth",description:"AI assistance via GitHub OAuth (device flow)",docsUrl:"https://docs.github.com/en/copilot"},{id:"github_models",name:"GitHub Models",type:"api_key",description:"Access GPT-4o, Claude, Llama via GitHub PAT (requires models:read permission)",docsUrl:"https://docs.github.com/en/github-models/quickstart"},{id:"antigravity",name:"Antigravity (Gemini/Claude)",type:"oauth",description:"Google OAuth for Gemini 3 Pro and Claude models via Antigravity",docsUrl:"https://github.com/NoeFabris/opencode-antigravity-auth"},{id:"openai_codex",name:"OpenAI Codex (ChatGPT Plus/Pro)",type:"oauth",description:"OAuth for GPT-5.x models with ChatGPT subscription",docsUrl:"https://help.openai.com/en/articles/11369540-using-codex-with-your-chatgpt-plan"}],zm={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"flex-end",zIndex:1e3,backdropFilter:"blur(4px)"},panel:{width:"420px",maxWidth:"100%",height:"100%",backgroundColor:"var(--bg-medium)",borderLeft:"1px solid var(--border-subtle)",display:"flex",flexDirection:"column",overflow:"hidden",animation:"slideInRight 0.2s ease-out"},header:{padding:"1.25rem 1.5rem",borderBottom:"1px solid var(--border-subtle)",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"var(--bg-dark)"},headerTitle:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)",margin:0},closeButton:{background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",padding:"0.5rem",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.15s ease"},content:{flex:1,overflowY:"auto",padding:"1.5rem"},section:{marginBottom:"1.5rem"},sectionTitle:{fontSize:"0.75rem",fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.75rem"},label:{display:"block",fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"0.5rem"},select:{width:"100%",padding:"0.65rem 0.75rem",backgroundColor:"var(--bg-dark)",border:"1px solid var(--border-subtle)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"0.9rem",outline:"none",cursor:"pointer",transition:"border-color 0.15s ease",appearance:"none",backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.75rem center"},providerInfo:{backgroundColor:"var(--bg-dark)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"1rem",marginTop:"1rem"},providerName:{fontSize:"1rem",fontWeight:500,color:"var(--text-primary)",marginBottom:"0.35rem"},providerDescription:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"1rem",lineHeight:1.4},inputGroup:{marginBottom:"0.75rem"},inputLabel:{display:"block",fontSize:"0.75rem",color:"var(--text-secondary)",marginBottom:"0.35rem"},input:{width:"100%",padding:"0.6rem 0.75rem",backgroundColor:"var(--bg-medium)",border:"1px solid var(--border-subtle)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"0.85rem",outline:"none",transition:"border-color 0.15s ease",boxSizing:"border-box"},buttonRow:{display:"flex",gap:"0.5rem",marginTop:"1rem"},button:{padding:"0.5rem 0.85rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:500,cursor:"pointer",transition:"all 0.15s ease",border:"none"},buttonPrimary:{backgroundColor:"var(--accent-primary)",color:"white"},buttonSecondary:{backgroundColor:"var(--bg-light)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)"},buttonOAuth:{backgroundColor:"var(--bg-light)",color:"var(--text-primary)",border:"1px solid var(--border-subtle)",display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",justifyContent:"center",padding:"0.65rem 1rem"},statusRow:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.75rem",padding:"0.5rem 0.75rem",backgroundColor:"var(--bg-medium)",borderRadius:"6px",fontSize:"0.8rem"},statusDot:{width:"8px",height:"8px",borderRadius:"50%",flexShrink:0},footer:{padding:"1rem 1.5rem",borderTop:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-dark)",display:"flex",justifyContent:"flex-end",gap:"0.75rem"},errorText:{fontSize:"0.75rem",color:"var(--error)",marginTop:"0.35rem"},successText:{fontSize:"0.75rem",color:"var(--success)",marginTop:"0.35rem"},docsLink:{fontSize:"0.75rem",color:"var(--accent-primary)",textDecoration:"none",display:"inline-flex",alignItems:"center",gap:"0.25rem",marginTop:"0.5rem"}};function Bm(){try{const e=localStorage.getItem(jm);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load settings from localStorage:",e)}return{activeProvider:null,providers:{}}}function Hm(){localStorage.setItem(Om,"true")}async function Vm(e,t){try{await Im.updateProviderCredentials(e,{api_key:t.apiKey,endpoint:t.endpoint,oauth_token:t.oauthToken,oauth_refresh_token:t.oauthRefreshToken,oauth_client_id:t.oauthClientId,oauth_client_secret:t.oauthClientSecret})}catch(n){throw console.error(`Failed to save credentials for ${e} to server:`,n),n}}async function Wm(){try{if("true"===localStorage.getItem(Om))return!1;const e=Bm();if(!(e.activeProvider||Object.keys(e.providers).length>0))return Hm(),!1;const t=await Im.getAllCredentials();if(t.active_provider||Object.keys(t.providers).length>0)return Hm(),!1;console.log("[Settings] Migrating credentials from localStorage to server..."),await Im.importCredentials({activeProvider:e.activeProvider||void 0,providers:e.providers});const n=qm();n&&await Im.updateSettings({selected_model:n.model});const i=Qm();return i&&await Im.updateSettings({target_model:i}),Hm(),console.log("[Settings] Migration complete!"),!0}catch(e){return console.error("Failed to migrate localStorage to server:",e),!1}}function Gm(){return Bm()}function $m(e){!function(e){try{localStorage.setItem(jm,JSON.stringify(e))}catch(t){console.error("Failed to save settings to localStorage:",t)}}(e)}function Xm(e){return{disconnected:"Not connected",connecting:"Connecting...",connected:"Connected",error:"Connection failed"}[e]}function qm(){try{const e=localStorage.getItem(Dm);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load LLM settings from localStorage:",e)}return null}function Km(e){try{localStorage.setItem(Dm,JSON.stringify(e))}catch(t){console.error("Failed to save LLM settings to localStorage:",t)}}function Ym(){return qm()}function Zm(e){Km(e),async function(e){try{await Im.updateSettings({selected_model:`${e.provider}:${e.model}`}),Km(e)}catch(t){console.error("Failed to save LLM settings to server:",t),Km(e)}}(e).catch(console.error)}function Jm(){return Ym()}function Qm(){try{return localStorage.getItem(Um)}catch(e){return console.error("Failed to load target model from localStorage:",e),null}}function ef(e){try{localStorage.setItem(Um,e)}catch(t){console.error("Failed to save target model to localStorage:",t)}}function tf(e){ef(e),async function(e){try{await Im.updateSettings({target_model:e}),ef(e)}catch(t){console.error("Failed to save target model to server:",t),ef(e)}}(e).catch(console.error)}function nf({isOpen:e,onClose:t}){const[n,i]=Pt.useState(null),[r,a]=Pt.useState({}),[o,s]=Pt.useState("disconnected"),[l,c]=Pt.useState(null),[u,d]=Pt.useState(!1),[h,p]=Pt.useState(!1),[m,f]=Pt.useState(!1),[g,v]=Pt.useState(""),[y,_]=Pt.useState(""),[x,b]=Pt.useState([]),[S,w]=Pt.useState(!1),[M,E]=Pt.useState(null),[C,T]=Pt.useState(!1),[P,k]=Pt.useState(null),[A,N]=Pt.useState(!1),R=async e=>{var t,n;const i={...e};if((null==(t=e.github_copilot)?void 0:t.oauthRefreshToken)&&(null==(n=e.github_copilot)?void 0:n.oauthToken))try{const t=e.github_copilot.oauthToken;if(t.startsWith("eyJ"))try{const e=JSON.parse(atob(t.split(".")[1])),n=e.exp?1e3*e.exp:0,r=Date.now();if(n>0&&n-r<3e5){console.log("[Settings] GitHub Copilot token expires soon, refreshing...");const e=await Im.refreshOAuthToken("github_copilot");e.success&&e.oauth_token?(console.log("[Settings] GitHub Copilot token refreshed successfully"),i.github_copilot={...i.github_copilot,oauthToken:e.oauth_token}):console.warn("[Settings] Failed to refresh GitHub Copilot token:",e.error_description)}}catch(r){console.log("[Settings] Could not decode token expiration, attempting refresh...");const e=await Im.refreshOAuthToken("github_copilot");e.success&&e.oauth_token&&(i.github_copilot={...i.github_copilot,oauthToken:e.oauth_token})}}catch(a){console.warn("[Settings] Error refreshing GitHub Copilot token:",a)}return i};Pt.useEffect(()=>{if(!e)return;let t=!0;return(async()=>{try{await Wm();let e=await async function(){try{const t=await Im.getAllCredentials(),n={};for(const i of Object.keys(t.providers))try{const e=await Im.getProviderCredentials(i);e.exists&&(n[i]={apiKey:e.api_key,endpoint:e.endpoint,oauthToken:e.oauth_token,oauthRefreshToken:e.oauth_refresh_token,oauthClientId:e.oauth_client_id,oauthClientSecret:e.oauth_client_secret})}catch(e){console.warn(`Failed to load credentials for ${i}:`,e)}return{activeProvider:t.active_provider,providers:n}}catch(t){return console.error("Failed to load settings from server:",t),Bm()}}();if(!t)return;if(e={...e,providers:await R(e.providers)},!t)return;i(e.activeProvider),a(e.providers),s("disconnected"),c(null),p(!1);const n=await async function(){try{const e=await Im.getSettings();if(e.selected_model){const t=e.selected_model.indexOf(":");return-1!==t?{provider:e.selected_model.substring(0,t),model:e.selected_model.substring(t+1)}:{provider:"",model:e.selected_model}}return null}catch(e){return console.error("Failed to load LLM settings from server:",e),qm()}}();n&&t&&(v(n.provider),_(n.model))}catch(e){if(console.error("Failed to load settings from server, falling back to localStorage:",e),!t)return;const n=Gm();i(n.activeProvider),a(n.providers),s("disconnected"),c(null),p(!1);const r=Ym();r&&(v(r.provider),_(r.model))}})(),()=>{t=!1}},[e]),Pt.useEffect(()=>{if(!g)return void b([]);const e=r[g],t=Fm.find(e=>e.id===g);if(!("api_key"===(null==t?void 0:t.type)&&(null==e?void 0:e.apiKey)||"oauth"===(null==t?void 0:t.type)&&(null==e?void 0:e.oauthToken)||"local"===(null==t?void 0:t.type)&&((null==e?void 0:e.endpoint)||(null==t?void 0:t.defaultEndpoint)))){const e=rf[g]||"Configure credentials to fetch available models.";return b([{id:"",name:` ${e}`,recommended:!1}]),void _("")}w(!0),Im.fetchLlmModels({provider:g,credentials:{apiKey:null==e?void 0:e.apiKey,endpoint:null==e?void 0:e.endpoint,oauthToken:null==e?void 0:e.oauthToken}}).then(e=>{var t;if(e.success&&e.models.length>0){if(b(e.models),!e.models.find(e=>e.id===y)){const n=e.models.find(e=>e.recommended);_((null==n?void 0:n.id)||(null==(t=e.models[0])?void 0:t.id)||"")}}else{const t=e.error||"No models available. Check your credentials or provider status.";b([{id:"",name:` ${t}`,recommended:!1}]),_("")}}).catch(e=>{const t=(null==e?void 0:e.message)||"Failed to fetch models. Check your connection and credentials.";b([{id:"",name:` ${t}`,recommended:!1}]),_("")}).finally(()=>w(!1))},[g,r]);const L=n?Fm.find(e=>e.id===n):null,I=n&&r[n]||{};Pt.useEffect(()=>{n&&"oauth"===(null==L?void 0:L.type)?Im.getOAuthFlowType(n).then(e=>{N(e.has_builtin_client||!1)}).catch(e=>{console.error("Failed to fetch OAuth flow type:",e),N(!1)}):N(!1)},[n,null==L?void 0:L.type]);const j=Pt.useCallback(e=>{i(e||null),s("disconnected"),c(null),p(!0)},[]),D=Pt.useCallback((e,t)=>{n&&(a(i=>{const r={...i,[n]:{...i[n],[e]:t||void 0}};if("oauthToken"===e||"oauthRefreshToken"===e||"oauthClientId"===e||"oauthClientSecret"===e){const t=r[n];Vm(n,t).catch(t=>{console.error(`Failed to persist ${e} to server:`,t)})}return r}),p(!0),s("disconnected"))},[n]),U=Pt.useCallback(async()=>{if(n&&L){d(!0),s("connecting"),c(null);try{const e=r[n]||{},t=await Im.testProviderConnection(n,{endpoint:e.endpoint,apiKey:e.apiKey});s(t.status),t.success||c(t.message)}catch(e){s("error"),c(e instanceof Error?e.message:"Connection test failed")}finally{d(!1)}}},[n,L,r]),O=Pt.useCallback(async()=>{if(n&&L){s("connecting"),c(null),k(null);try{const t=await Im.getOAuthFlowType(n);if("device"===t.flow_type){const e=r[n]||{},t=await Im.requestDeviceCode(n,e.oauthClientId);E({userCode:t.user_code,verificationUri:t.verification_uri,deviceCode:t.device_code,interval:t.interval,expiresIn:t.expires_in}),T(!0);const i=1e3*t.interval,a=Date.now()+1e3*t.expires_in,o=async()=>{if(Date.now()>a)return T(!1),E(null),s("error"),void c("Authorization timed out. Please try again.");try{const r=await Im.pollDeviceToken(n,t.device_code,e.oauthClientId);if(r.success&&r.access_token)T(!1),E(null),"github_copilot"===n&&r.copilot_token?(D("oauthToken",r.copilot_token),D("oauthRefreshToken",r.access_token)):(D("oauthToken",r.access_token),r.refresh_token&&D("oauthRefreshToken",r.refresh_token)),s("connected");else if(r.should_continue){const e=r.slow_down?2*i:i;setTimeout(o,e)}else T(!1),E(null),s("error"),c(r.error_description||r.error||"Authorization failed")}catch(r){T(!1),E(null),s("error"),c(r instanceof Error?r.message:"Polling failed")}};setTimeout(o,i)}else{const i=!!(null==(e=window.pywebview)?void 0:e.api);let a;a=i?`http://localhost:${8765}/oauth-callback`:`${window.location.origin}/oauth/callback`;const l=r[n]||{},u=await Im.initiateOAuth(n,a,l.oauthClientId);if(!u.authorization_url)throw new Error("Failed to get authorization URL");sessionStorage.setItem("oauth_state",u.state),sessionStorage.setItem("oauth_provider",n);if(null!=t.redirect_uri||i){const e=await Im.startCallbackServer(n,u.state,void 0,i&&!t.redirect_uri?a:void 0);if(!e.success)throw new Error(e.error_description||e.error||"Failed to start callback server");let r=null;if(i)await(async e=>{var t;const n=null==(t=window.pywebview)?void 0:t.api;if(null==n?void 0:n.open_in_browser)try{return await n.open_in_browser(e),!0}catch(r){console.error("Failed to open URL via pywebview API:",r)}const i=document.createElement("a");return i.href=e,i.target="_blank",i.rel="noopener noreferrer",document.body.appendChild(i),i.click(),document.body.removeChild(i),!0})(u.authorization_url);else if(r=window.open(u.authorization_url,"oauth-popup","width=600,height=700,scrollbars=yes"),!r)return void(window.location.href=u.authorization_url);T(!0);const o=2e3,l=Date.now()+3e5,d=async()=>{if(Date.now()>l)return T(!1),s("error"),c("Authorization timed out. Please try again."),void(await Im.stopCallbackServer(n,u.state));try{const e=await Im.pollCallbackToken(n,u.state);if(e.success&&e.access_token){if(T(!1),D("oauthToken",e.access_token),e.refresh_token&&D("oauthRefreshToken",e.refresh_token),s("connected"),r)try{r.close()}catch{}}else if(e.pending)setTimeout(d,o);else if(T(!1),s("error"),c(e.error_description||e.error||"Authorization failed"),r)try{r.close()}catch{}}catch(e){if(T(!1),s("error"),c(e instanceof Error?e.message:"Polling failed"),r)try{r.close()}catch{}}};setTimeout(d,o)}else{if(!window.open(u.authorization_url,"oauth-popup","width=600,height=700,scrollbars=yes"))throw new Error("Popup blocked. Please allow popups for this site.");const e=t=>{var n;t.origin===window.location.origin&&"oauth_callback"===(null==(n=t.data)?void 0:n.type)&&(window.removeEventListener("message",e),t.data.error?(s("error"),c(t.data.error_description||t.data.error)):t.data.access_token&&(D("oauthToken",t.data.access_token),t.data.refresh_token&&D("oauthRefreshToken",t.data.refresh_token),s("connected")))};window.addEventListener("message",e),setTimeout(()=>{window.removeEventListener("message",e),"connecting"===o&&(s("disconnected"),c("Authorization timed out or was cancelled. You can paste your access token manually below."))},12e4)}}}catch(t){s("error"),c(t instanceof Error?t.message:"OAuth initiation failed"),E(null)}var e}},[n,L,D,o]),F=Pt.useCallback(()=>{T(!1),E(null),s("disconnected"),k(null)},[]),z=Pt.useCallback(async()=>{d(!0);try{const e=await Im.detectLocalProviders();if(e.count>0){const t={...r};e.detected.forEach(({provider_id:e,endpoint:n})=>{t[e]={...t[e],endpoint:n}}),a(t),p(!0);e.detected.find(e=>e.provider_id===n)&&s("connected")}}catch(e){console.error("Auto-detect failed:",e)}finally{d(!1)}},[n,r]),B=Pt.useCallback(async()=>{try{for(const[t,n]of Object.entries(r))(n.apiKey||n.endpoint||n.oauthToken)&&await Vm(t,n);const e=g&&y?`${g}:${y}`:null;await async function(e,t){try{await Im.updateSettings({active_provider:e||void 0,selected_model:t||void 0})}catch(n){throw console.error("Failed to save settings to server:",n),n}}(n,e);$m({activeProvider:n,providers:r}),g&&y&&Zm({provider:g,model:y}),p(!1),t()}catch(e){console.error("Failed to save settings to server:",e);$m({activeProvider:n,providers:r}),g&&y&&Zm({provider:g,model:y}),p(!1),t()}},[n,r,g,y,t]),H=Pt.useCallback(()=>{if(h){if(!window.confirm("You have unsaved changes. Discard them?"))return}t()},[h,t]);return e?Ut.jsxs("div",{style:zm.overlay,onClick:e=>e.target===e.currentTarget&&H(),role:"dialog","aria-modal":"true","aria-labelledby":"settings-title",children:[Ut.jsxs("div",{style:zm.panel,children:[Ut.jsxs("header",{style:zm.header,children:[Ut.jsx("h2",{id:"settings-title",style:zm.headerTitle,children:"AI Provider Settings"}),Ut.jsx("button",{style:zm.closeButton,onClick:H,"aria-label":"Close settings",onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--bg-light)",e.currentTarget.style.color="var(--text-primary)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="var(--text-muted)"},children:Ut.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ut.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ut.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),Ut.jsxs("div",{style:zm.content,children:[Ut.jsxs("section",{style:zm.section,children:[Ut.jsx("label",{style:zm.label,htmlFor:"provider-select",children:"Select AI Provider"}),Ut.jsxs("select",{id:"provider-select",style:zm.select,value:n||"",onChange:e=>j(e.target.value),children:[Ut.jsx("option",{value:"",children:"-- Select a provider --"}),Ut.jsx("optgroup",{label:"Cloud API (API Key)",children:Fm.filter(e=>"api_key"===e.type).map(e=>Ut.jsx("option",{value:e.id,children:e.name},e.id))}),Ut.jsx("optgroup",{label:"Local (No Auth)",children:Fm.filter(e=>"local"===e.type).map(e=>Ut.jsx("option",{value:e.id,children:e.name},e.id))}),Ut.jsx("optgroup",{label:"OAuth",children:Fm.filter(e=>"oauth"===e.type).map(e=>Ut.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),L&&Ut.jsxs("section",{style:zm.section,children:[Ut.jsx("h3",{style:zm.sectionTitle,children:"Configuration"}),Ut.jsxs("div",{style:zm.providerInfo,children:[Ut.jsx("div",{style:zm.providerName,children:L.name}),Ut.jsx("p",{style:zm.providerDescription,children:L.description}),"api_key"===L.type&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("div",{style:zm.inputGroup,children:[Ut.jsx("label",{style:zm.inputLabel,htmlFor:"api-key",children:"API Key"}),Ut.jsxs("div",{style:{position:"relative"},children:[Ut.jsx("input",{id:"api-key",type:m?"text":"password",style:zm.input,placeholder:"Enter your API key",value:I.apiKey||"",onChange:e=>D("apiKey",e.target.value),autoComplete:"off"}),Ut.jsx("button",{type:"button",onClick:()=>f(!m),style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",padding:"4px",fontSize:"0.75rem"},children:m?"Hide":"Show"})]})]}),Ut.jsxs("div",{style:zm.inputGroup,children:[Ut.jsx("label",{style:zm.inputLabel,htmlFor:"endpoint",children:"Custom Endpoint (optional)"}),Ut.jsx("input",{id:"endpoint",type:"text",style:zm.input,placeholder:L.defaultEndpoint,value:I.endpoint||"",onChange:e=>D("endpoint",e.target.value)})]}),Ut.jsx("div",{style:zm.buttonRow,children:Ut.jsx("button",{style:{...zm.button,...zm.buttonSecondary,opacity:u?.6:1},onClick:U,disabled:!I.apiKey||u,children:u?"Testing...":"Test Connection"})})]}),"local"===L.type&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("div",{style:zm.inputGroup,children:[Ut.jsx("label",{style:zm.inputLabel,htmlFor:"endpoint",children:"Endpoint URL"}),Ut.jsx("input",{id:"endpoint",type:"text",style:zm.input,placeholder:L.defaultEndpoint,value:I.endpoint||L.defaultEndpoint||"",onChange:e=>D("endpoint",e.target.value)})]}),Ut.jsxs("div",{style:zm.buttonRow,children:[Ut.jsx("button",{style:{...zm.button,...zm.buttonSecondary,opacity:u?.6:1},onClick:U,disabled:u,children:u?"Testing...":"Test Connection"}),Ut.jsx("button",{style:{...zm.button,...zm.buttonSecondary,opacity:u?.6:1},onClick:z,disabled:u,children:"Auto-Detect"})]})]}),"oauth"===L.type&&Ut.jsx(Ut.Fragment,{children:I.oauthToken?Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("div",{style:zm.statusRow,children:[Ut.jsx("span",{style:{...zm.statusDot,backgroundColor:"var(--success)"}}),Ut.jsx("span",{style:{color:"var(--text-secondary)"},children:"Connected via OAuth"})]}),Ut.jsx("div",{style:zm.buttonRow,children:Ut.jsx("button",{style:{...zm.button,...zm.buttonSecondary,flex:1},onClick:()=>{D("oauthToken",""),D("oauthRefreshToken",""),s("disconnected")},children:"Disconnect"})})]}):M?Ut.jsxs("div",{style:{backgroundColor:"var(--bg-medium)",border:"1px solid var(--border-subtle)",borderRadius:"8px",padding:"1.25rem",textAlign:"center"},children:[Ut.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"0.75rem"},children:"Enter this code at the link below:"}),Ut.jsx("div",{style:{fontSize:"1.75rem",fontFamily:"monospace",fontWeight:700,color:"var(--accent-primary)",letterSpacing:"0.15em",padding:"0.75rem 1rem",backgroundColor:"var(--bg-dark)",borderRadius:"6px",marginBottom:"1rem",userSelect:"all",cursor:"pointer"},title:"Click to select",onClick:e=>{const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e.currentTarget),null==t||t.removeAllRanges(),null==t||t.addRange(n)},children:M.userCode}),Ut.jsxs("a",{href:M.verificationUri,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.6rem 1rem",backgroundColor:"var(--accent-primary)",color:"white",textDecoration:"none",borderRadius:"6px",fontSize:"0.85rem",fontWeight:500,marginBottom:"1rem"},children:[Ut.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ut.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),Ut.jsx("path",{d:"M15 3h6v6"}),Ut.jsx("path",{d:"M10 14L21 3"})]}),"Open ",M.verificationUri.replace("https://","")]}),C&&Ut.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",color:"var(--text-muted)",fontSize:"0.8rem",marginBottom:"1rem"},children:[Ut.jsx("span",{style:{width:"12px",height:"12px",border:"2px solid var(--text-muted)",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Waiting for authorization..."]}),P&&Ut.jsx("p",{style:{...zm.errorText,marginBottom:"0.75rem"},children:P}),Ut.jsx("button",{style:{...zm.button,...zm.buttonSecondary,width:"100%"},onClick:F,children:"Cancel"})]}):Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("button",{style:{...zm.button,...zm.buttonOAuth},onClick:O,disabled:C,children:["github_copilot"===n?Ut.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ut.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})}):"openai_codex"===n?Ut.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:Ut.jsx("path",{d:"M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.896zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08-4.778 2.758a.795.795 0 0 0-.392.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"})}):Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[Ut.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),Ut.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),Ut.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),Ut.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Connect with ",L.name]}),Ut.jsx("div",{style:{marginTop:"1rem"},children:Ut.jsxs("div",{style:zm.inputGroup,children:[Ut.jsx("label",{style:zm.inputLabel,htmlFor:"oauth-token",children:"Or paste access token manually"}),Ut.jsx("input",{id:"oauth-token",type:"password",style:zm.input,placeholder:"Access token",value:I.oauthToken||"",onChange:e=>D("oauthToken",e.target.value),autoComplete:"off"})]})})]})}),"disconnected"!==o&&Ut.jsxs("div",{style:zm.statusRow,children:[Ut.jsx("span",{style:{...zm.statusDot,backgroundColor:(V=o,{disconnected:"var(--text-muted)",connecting:"var(--warning)",connected:"var(--success)",error:"var(--error)"}[V])}}),Ut.jsx("span",{style:{color:"var(--text-secondary)"},children:Xm(o)})]}),l&&Ut.jsx("p",{style:zm.errorText,children:l}),"connected"===o&&Ut.jsx("p",{style:zm.successText,children:"Connection successful!"}),L.docsUrl&&Ut.jsxs("a",{href:L.docsUrl,target:"_blank",rel:"noopener noreferrer",style:zm.docsLink,children:[Ut.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ut.jsx("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),Ut.jsx("path",{d:"M15 3h6v6"}),Ut.jsx("path",{d:"M10 14L21 3"})]}),"View documentation"]})]})]}),Ut.jsxs("section",{style:zm.section,children:[Ut.jsx("h3",{style:zm.sectionTitle,children:"Default LLM Model"}),Ut.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"1rem",lineHeight:1.4},children:"Select the default provider and model for AI prompt enhancement. This persists across sessions."}),Ut.jsxs("div",{style:zm.inputGroup,children:[Ut.jsx("label",{style:zm.inputLabel,htmlFor:"llm-provider-select",children:"LLM Provider"}),Ut.jsxs("select",{id:"llm-provider-select",style:zm.select,value:g,onChange:e=>{v(e.target.value),_(""),p(!0)},children:[Ut.jsx("option",{value:"",children:"-- Select provider --"}),Fm.map(e=>{const t=r[e.id],n="api_key"===e.type&&(null==t?void 0:t.apiKey)||"oauth"===e.type&&(null==t?void 0:t.oauthToken)||"local"===e.type&&((null==t?void 0:t.endpoint)||e.defaultEndpoint);return Ut.jsxs("option",{value:e.id,disabled:!n,children:[e.name," ",n?"":"(not configured)"]},e.id)})]})]}),g&&Ut.jsxs("div",{style:zm.inputGroup,children:[Ut.jsxs("label",{style:zm.inputLabel,htmlFor:"llm-model-select",children:["Model ",S&&Ut.jsx("span",{style:{color:"var(--text-muted)"},children:"(loading...)"})]}),Ut.jsxs("select",{id:"llm-model-select",style:zm.select,value:y,onChange:e=>{_(e.target.value),p(!0)},disabled:S||0===x.length,children:[Ut.jsx("option",{value:"",children:"-- Select model --"}),x.map(e=>Ut.jsxs("option",{value:e.id,children:[e.name," ",e.recommended?"(recommended)":""]},e.id))]})]})]}),!L&&Ut.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)",fontSize:"0.9rem"},children:"Select an AI provider to configure it for prompt enhancement."})]}),Ut.jsxs("footer",{style:zm.footer,children:[Ut.jsx("button",{style:{...zm.button,...zm.buttonSecondary},onClick:H,children:"Cancel"}),Ut.jsx("button",{style:{...zm.button,...zm.buttonPrimary,opacity:h?1:.5},onClick:B,disabled:!h,children:"Save Changes"})]})]}),Ut.jsx("style",{children:"\n        @keyframes slideInRight {\n          from {\n            transform: translateX(100%);\n          }\n          to {\n            transform: translateX(0);\n          }\n        }\n        @keyframes spin {\n          from {\n            transform: rotate(0deg);\n          }\n          to {\n            transform: rotate(360deg);\n          }\n        }\n      "})]}):null;var V}const rf={openai:"Enter your OpenAI API key to fetch available models.",anthropic:"Enter your Anthropic API key to fetch available models.",google:"Enter your Google AI API key to fetch available models.",openrouter:"Enter your OpenRouter API key to fetch available models.",replicate:"Enter your Replicate API token to fetch available models.",stability:"Enter your Stability AI API key to fetch available models.",ollama:"Ensure Ollama is running locally to fetch available models.",lmstudio:"Ensure LM Studio is running locally to fetch available models.",github_copilot:"Enter your GitHub PAT with models:read permission to fetch available models.",antigravity:"Complete Google OAuth authentication to fetch available models.",openai_codex:"Complete ChatGPT OAuth authentication to fetch available models."};function af(){const e=Gm(),t=[];for(const n of Fm){const i=e.providers[n.id];("api_key"===n.type&&(null==i?void 0:i.apiKey)||"oauth"===n.type&&(null==i?void 0:i.oauthToken)||"local"===n.type&&((null==i?void 0:i.endpoint)||n.defaultEndpoint))&&t.push({providerId:n.id,providerName:n.name,providerType:n.type,credentials:i||{},models:[],isActive:e.activeProvider===n.id})}return t}const of={camera_type:["Digital","Film"],camera_manufacturer:["ARRI","RED","Sony","Canon","Blackmagic","Panasonic","DJI","Nikon"],camera_manufacturer_film:["ARRI_Film","Eclair","Panavision","Mitchell","IMAX","Vintage"],camera_body:["Alexa_35","Alexa_Mini","Alexa_Mini_LF","Alexa_LF","Alexa_65","V_Raptor","V_Raptor_X","V_Raptor_XL","Komodo_X","Monstro_8K","Venice_2","FX9","FX6","C700_FF","C500_Mark_II","C300_Mark_III","Ursa_Mini_Pro_12K","Pocket_6K","Varicam_LT","S1H","Z9","Inspire_3","Mavic_3_Cine"],camera_body_film:["Arricam_ST","Arricam_LT","ARRI_535B","ARRI_35BL","ARRI_35_III","Arriflex_35","Arriflex_35BL","Arriflex_435","Eclair_NPR","Panavision_Millennium_XL2","Panavision_Millennium","Panavision_Platinum","Panavision_Gold","Panavision_Panastar","Panavision_Panaflex","Super_Panavision_70","Ultra_Panavision_70","Panavision_XL","Mitchell_BNC","Mitchell_BNCR","Mitchell_BFC_65","IMAX_MSM_9802","IMAX_MKIV","IMAX_GT","Alexa","Alexa_XT","RED_One","UFA_Custom","Pathe_Studio"],film_stock:["Kodak_Vision3_500T_5219","Kodak_Vision3_250D_5207","Kodak_Vision3_200T_5213","Kodak_Vision3_50D_5203","Kodak_Vision2_500T_5218","Kodak_Vision2_200T_5217","Kodak_Vision_500T_5279","Kodak_Vision_320T_5277","Kodak_Double_X_5222","Kodak_Tri_X","Eastman_Double_X","Eastman_Plus_X","Eastman_5247","Eastman_5293","Eastman_5294","Eastman_5250","Eastman_5254","Technicolor","Kodachrome","Fuji_Eterna_500T","Fuji_Eterna_250D","Fuji_Eterna_250T"],film_stock_65mm:["Kodak_65mm_500T","Kodak_65mm_250D","Kodak_65mm_200T"],film_stock_imax:["IMAX_500T","IMAX_250D"],aspect_ratio:["1.33:1","1.37:1","1.66:1","1.78:1","1.85:1","2.20:1","2.35:1","2.39:1","2.76:1","1.43:1","1.90:1"],lens_manufacturer:["ARRI","Zeiss","Cooke","Panavision","Angenieux","Leica","Canon","Sony","Sigma","Fujifilm","Hawk","Hasselblad","Technovision","Bausch_Lomb","Todd_AO","Kowa","Vintage","Warner_Bros","Paramount","Pathe"],lens_family:["ARRI_Signature_Prime","ARRI_Master_Prime","ARRI_Ultra_Prime","ARRI_Prime_65","ARRI_Prime_DNA","Zeiss_Supreme_Prime","Zeiss_Master_Prime","Zeiss_CP3","Zeiss_Super_Speed","Zeiss_Standard_Speed","Zeiss_Ultra_Prime","Zeiss_Planar_f0.7","Cooke_S7","Cooke_S4","Cooke_Panchro","Cooke_Speed_Panchro","Panavision_Primo","Panavision_Primo_70","Panavision_C_Series","Panavision_E_Series","Panavision_Super_Speed","Panavision_Standard","Panavision_Ultra_Speed","Panavision_Auto_Panatar","Ultra_Panavision_Optics","Angenieux_Optimo","Leica_Summicron_C","Leica_Summilux_C","Canon_Sumire","Canon_K35","Sony_CineAlta","Sigma_Cine","Hawk_V_Lite","Hawk_V_Plus","Hasselblad_HC","Hasselblad_V","IMAX_Optics","Bausch_Lomb_Super_Baltar","Bausch_Lomb_Baltar","Todd_AO","Kowa_Anamorphic","Vintage_Spherical","Vintage_Anamorphic"],focal_length_mm:[14,18,21,24,28,32,35,40,50,65,75,85,100,135,150,200],movement_equipment:["Static","Handheld","Steadicam","Gimbal","Dolly","Crane","Jib","Technocrane","Drone"],movement_type:["Static","Pan","Tilt","Track_In","Track_Out","Arc","Crane_Up","Crane_Down","Dolly_Zoom"],movement_timing:["Static","Very_Slow","Slow","Moderate","Fast","Whip_Fast"],time_of_day:["Dawn","Morning","Midday","Afternoon","Golden_Hour","Blue_Hour","Dusk","Night"],lighting_source:["Sun","Moon","Tungsten","HMI","LED","Kino_Flo","Neon","Practical","Mixed"],lighting_style:["High_Key","Low_Key","Soft","Hard","Naturalistic","Expressionistic","Chiaroscuro"],animation_medium:["2D","3D","Hybrid","StopMotion"],style_domain:["Anime","Manga","ThreeD","Illustration"],line_treatment:["Clean","Sketchy","Bold","Thin","Variable","None"],color_application:["Cel","Gradient","Watercolor","Flat","Textured","Monochrome","Monochrome_Ink"],lighting_model:["Flat","Cel_Shaded","Soft_Shaded","Naturalistic_Simulated","Raytraced"],surface_detail:["Smooth","Textured","Detailed","Photoreal","Stylized"],motion_style:["None","Limited","Full","Exaggerated","Snappy","Fluid"],virtual_camera:["Locked","Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld","Motion_Comic"],shot_size:["EWS","WS","MWS","MS","MCU","CU","BCU","ECU","OTS","POV"],composition:["Rule_of_Thirds","Centered","Symmetrical","Asymmetrical","Negative_Space","Leading_Lines"],mood:["Cheerful","Happy","Hopeful","Whimsical","Adventurous","Romantic","Sensual","Passionate","Intimate","Melancholic","Somber","Reflective","Contemplative","Introspective","Tender","Bittersweet","Nostalgic","Surreal","Dreamlike","Hallucinatory","Transcendent","Meditative","Philosophical","Psychedelic","Gloomy","Menacing","Oppressive","Paranoid","Tense","Anxious","Claustrophobic","Brutal","Traumatic","Unsettling","Ominous","Suspenseful","Mysterious","Haunting","Bleak","Tragic","Lonely","Aggressive","Angry","Rebellious","Kinetic","Urgent","Provocative","Unhinged","Chaotic","Frantic","Intense","Noir","Hardboiled","Fatalistic","Cynical","World_Weary","Gothic","Macabre","Grotesque","Eldritch","Dread","Documentary","Realistic","Observational","Journalistic","Verite","Epic","Serene"],color_tone:["Warm_Saturated","Warm_Desaturated","Cool_Saturated","Cool_Desaturated","Neutral_Saturated","Neutral_Desaturated","Monochrome","Sepia","Teal_Orange"],target_model:["generic","midjourney","flux.1","flux.1_pro","flux_kontext","flux_krea","dall-e_3","gpt-image","ideogram_2.0","leonardo_ai","sdxl","stable_diffusion_3","z-image_turbo","qwen_image","sora","sora_2","veo_2","veo_3","runway_gen-3","runway_gen-4","kling_1.6","pika_2.0","luma_dream_machine","ltx_2","cogvideox","hunyuan","wan_2.1","wan_2.2","minimax_video","qwen_vl"]},sf={generic:"Generic",midjourney:"Midjourney","flux.1":"FLUX.1","flux.1_pro":"FLUX.1 Pro",flux_kontext:"Flux Kontext",flux_krea:"Flux Krea","dall-e_3":"DALL-E 3","gpt-image":"GPT-Image (4o)","ideogram_2.0":"Ideogram 2.0",leonardo_ai:"Leonardo AI",sdxl:"Stable Diffusion XL",stable_diffusion_3:"Stable Diffusion 3","z-image_turbo":"Z-Image Turbo",qwen_image:"Qwen-Image",sora:"Sora",sora_2:"Sora 2",veo_2:"Veo 2",veo_3:"Veo 3","runway_gen-3":"Runway Gen-3","runway_gen-4":"Runway Gen-4","kling_1.6":"Kling 1.6","pika_2.0":"Pika 2.0",luma_dream_machine:"Luma Dream Machine",ltx_2:"LTX-2",cogvideox:"CogVideoX",hunyuan:"Hunyuan Video","wan_2.1":"Wan 2.1","wan_2.2":"Wan 2.2",minimax_video:"Minimax Video",qwen_vl:"Qwen VL"},lf=new Set(["midjourney","flux.1","flux.1_pro","flux_kontext","flux_krea","dall-e_3","gpt-image","ideogram_2.0","leonardo_ai","sdxl","stable_diffusion_3","z-image_turbo","qwen_image"]),cf={EWS:"Extreme Wide Shot (EWS)",WS:"Wide Shot (WS)",MWS:"Medium Wide Shot (MWS)",MS:"Medium Shot (MS)",MCU:"Medium Close-Up (MCU)",CU:"Close-Up (CU)",BCU:"Big Close-Up (BCU)",ECU:"Extreme Close-Up (ECU)",OTS:"Over-The-Shoulder (OTS)",POV:"Point-of-View (POV)"},uf={Alexa_35:"ARRI Alexa 35",Alexa_Mini:"ARRI Alexa Mini",Alexa_Mini_LF:"ARRI Alexa Mini LF",Alexa_LF:"ARRI Alexa LF",Alexa_65:"ARRI Alexa 65",V_Raptor:"RED V-Raptor",V_Raptor_X:"RED V-Raptor X",V_Raptor_XL:"RED V-Raptor XL",Komodo_X:"RED Komodo-X",Monstro_8K:"RED Monstro 8K",Venice_2:"Sony Venice 2",FX9:"Sony FX9",FX6:"Sony FX6",C700_FF:"Canon C700 FF",C500_Mark_II:"Canon C500 Mark II",C300_Mark_III:"Canon C300 Mark III",Ursa_Mini_Pro_12K:"Blackmagic URSA Mini Pro 12K",Pocket_6K:"Blackmagic Pocket Cinema 6K",Varicam_LT:"Panasonic VariCam LT",S1H:"Panasonic S1H",Z9:"Nikon Z9",Inspire_3:"DJI Inspire 3",Mavic_3_Cine:"DJI Mavic 3 Cine",Arricam_ST:"ARRI Arricam ST",Arricam_LT:"ARRI Arricam LT",ARRI_535B:"ARRI 535B",ARRI_35BL:"ARRI 35BL",ARRI_35_III:"ARRI 35 III",Panavision_Millennium_XL2:"Panavision Millennium XL2",Panavision_Millennium:"Panavision Millennium",Panavision_Platinum:"Panavision Platinum",Panavision_Gold:"Panavision Gold",Panavision_Panastar:"Panavision Panastar",Panavision_Panaflex:"Panavision Panaflex",Super_Panavision_70:"Super Panavision 70",Ultra_Panavision_70:"Ultra Panavision 70 (MGM)",Mitchell_BNC:"Mitchell BNC",Mitchell_BNCR:"Mitchell BNCR",Mitchell_BFC_65:"Mitchell BFC 65mm",IMAX_MSM_9802:"IMAX MSM 9802",IMAX_MKIV:"IMAX MKIV",IMAX_GT:"IMAX GT"},df={ARRI_Signature_Prime:"ARRI Signature Prime",ARRI_Master_Prime:"ARRI/Zeiss Master Prime",ARRI_Ultra_Prime:"ARRI/Zeiss Ultra Prime",ARRI_Prime_65:"ARRI Prime 65 (65mm Format)",ARRI_Prime_DNA:"ARRI Prime DNA LF",Zeiss_Supreme_Prime:"Zeiss Supreme Prime",Zeiss_Master_Prime:"Zeiss Master Prime",Zeiss_CP3:"Zeiss CP.3",Cooke_S7:"Cooke S7/i Full Frame",Cooke_S4:"Cooke S4/i",Cooke_Panchro:"Cooke Panchro/i Classic",Cooke_Speed_Panchro:"Cooke Speed Panchro (Vintage)",Panavision_Primo:"Panavision Primo",Panavision_Primo_70:"Panavision Primo 70",Panavision_C_Series:"Panavision C-Series Anamorphic",Panavision_E_Series:"Panavision E-Series Anamorphic",Panavision_Super_Speed:"Panavision Super Speed (Z-Series)",Panavision_Standard:"Panavision Standard (Pre-1970)",Panavision_Ultra_Speed:"Panavision Ultra Speed",Panavision_Auto_Panatar:"Panavision Auto Panatar",Angenieux_Optimo:"Angnieux Optimo",Leica_Summicron_C:"Leica Summicron-C",Leica_Summilux_C:"Leica Summilux-C",Canon_Sumire:"Canon Sumire Prime",Sony_CineAlta:"Sony CineAlta",Sigma_Cine:"Sigma Cine",Bausch_Lomb_Super_Baltar:"Bausch & Lomb Super Baltar",Bausch_Lomb_Baltar:"Bausch & Lomb Baltar",Zeiss_Planar_f07:"Zeiss Planar f/0.7 (Kubrick)",Zeiss_Super_Speed:"Zeiss Super Speed",Zeiss_Standard_Speed:"Zeiss Standard Speed (Mk II/III)",Canon_K35:"Canon K35",Kowa_Anamorphic:"Kowa Anamorphic (Cinerama)",Todd_AO:"Todd-AO 70mm Optics",Ultra_Panavision_Optics:"Ultra Panavision 70 Optics",Vintage_Spherical:"Vintage Spherical (Generic)",Vintage_Anamorphic:"Vintage Anamorphic (Generic)",Hawk_V_Lite:"Hawk V-Lite Anamorphic",Hawk_V_Plus:"Hawk V-Plus Anamorphic",Hasselblad_HC:"Hasselblad HC (Medium Format)",Hasselblad_V:"Hasselblad V-System (Carl Zeiss)",IMAX_Optics:"IMAX Custom Optics"},hf={Alexa_35:"Medium",Alexa_Mini:"Light",Alexa_Mini_LF:"Medium",Alexa_LF:"Medium",Alexa_65:"Heavy",V_Raptor:"Light",V_Raptor_X:"Light",V_Raptor_XL:"Medium",Komodo_X:"Light",Monstro_8K:"Medium",Venice_2:"Heavy",FX9:"Heavy",FX6:"Light",C700_FF:"Heavy",C500_Mark_II:"Medium",C300_Mark_III:"Medium",Ursa_Mini_Pro_12K:"Heavy",Pocket_6K:"Light",Varicam_LT:"Medium",S1H:"Light",Z9:"Light",Inspire_3:"Light",Mavic_3_Cine:"Light",Arricam_ST:"Heavy",Arricam_LT:"Medium",ARRI_535B:"Heavy",ARRI_35BL:"Heavy",ARRI_35_III:"Medium",Panavision_Millennium_XL2:"Heavy",Panavision_Millennium:"Heavy",Panavision_Platinum:"Heavy",Panavision_Gold:"Heavy",Panavision_Panastar:"Heavy",Panavision_Panaflex:"Heavy",Super_Panavision_70:"Heavy",Ultra_Panavision_70:"Heavy",Mitchell_BNC:"Heavy",Mitchell_BNCR:"Heavy",Mitchell_BFC_65:"Heavy",IMAX_MSM_9802:"Heavy",IMAX_MKIV:"Heavy",IMAX_GT:"Heavy"},pf={ARRI:["Alexa_35","Alexa_Mini","Alexa_Mini_LF","Alexa_LF","Alexa_65"],RED:["V_Raptor","V_Raptor_X","V_Raptor_XL","Komodo_X","Monstro_8K"],Sony:["Venice_2","FX9","FX6"],Canon:["C700_FF","C500_Mark_II","C300_Mark_III"],Blackmagic:["Ursa_Mini_Pro_12K","Pocket_6K"],Panasonic:["Varicam_LT","S1H"],Nikon:["Z9"],DJI:["Inspire_3","Mavic_3_Cine"],ARRI_Film:["Arricam_ST","Arricam_LT","ARRI_535B","ARRI_35BL","ARRI_35_III","Arriflex_35","Arriflex_35BL","Arriflex_435"],Eclair:["Eclair_NPR"],Panavision:["Panavision_Millennium_XL2","Panavision_Millennium","Panavision_Platinum","Panavision_Gold","Panavision_Panastar","Panavision_Panaflex","Super_Panavision_70","Ultra_Panavision_70","Panavision_XL"],Mitchell:["Mitchell_BNC","Mitchell_BNCR","Mitchell_BFC_65"],IMAX:["IMAX_MSM_9802","IMAX_MKIV","IMAX_GT"],Vintage:["UFA_Custom","Pathe_Studio","Alexa","Alexa_XT","RED_One"]},mf=["Handheld","Gimbal","Drone"],ff={Static:["Static"],Handheld:["Static","Pan","Tilt"],Steadicam:["Static","Pan","Tilt","Track_In","Track_Out","Arc"],Gimbal:["Static","Pan","Tilt","Track_In","Track_Out","Arc"],Dolly:["Static","Track_In","Track_Out","Dolly_Zoom"],Slider:["Static","Track_In","Track_Out","Dolly_Zoom"],Crane:["Static","Crane_Up","Crane_Down","Arc"],Jib:["Static","Crane_Up","Crane_Down","Arc"],Technocrane:["Static","Pan","Tilt","Track_In","Track_Out","Crane_Up","Crane_Down","Arc"],Drone:["Static","Track_In","Track_Out","Crane_Up","Crane_Down","Arc"]},gf={Dolly_Zoom:["Dolly","Slider"]},vf={Dolly_Zoom:["Static","Very_Slow","Slow","Moderate"]},yf={Night:["Moon","Tungsten","HMI","LED","Kino_Flo","Neon","Practical","Mixed"],Blue_Hour:["Moon","Tungsten","HMI","LED","Kino_Flo","Neon","Practical","Mixed"],Midday:["Sun","HMI","LED","Kino_Flo","Practical","Mixed"]},_f={HMI:1972,Kino_Flo:1987,LED:2002},xf={Midday:["High_Key","Soft","Hard","Naturalistic"]},bf={Cheerful:{disallowed:["Low_Key"],preferred:["High_Key","Soft"]},Hopeful:{disallowed:["Low_Key"],preferred:["High_Key","Soft","Naturalistic"]},Gloomy:{disallowed:[],preferred:["Low_Key","Hard"]},Menacing:{disallowed:[],preferred:["Low_Key","Hard","Chiaroscuro"]},Noir:{disallowed:[],preferred:["Low_Key","Chiaroscuro","Hard"]},Paranoid:{disallowed:[],preferred:["Low_Key","Hard"]}},Sf={Manga:{disallowed_colors:["Cel","Gradient","Watercolor","Flat","Textured"],disallowed_cameras:["Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld"],disallowed_motion:["Limited","Full","Exaggerated","Snappy","Fluid"],required_lighting:["Flat"]},Illustration:{disallowed_motion:["Limited","Full","Exaggerated","Snappy","Fluid"],disallowed_cameras:["Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld"]},Anime:{disallowed_cameras:["Simulated_Handheld"],disallowed_lighting:["Raytraced"]},ThreeD:{disallowed_lighting:["Flat"]}},wf={"2D":["Free_3D"]},Mf={None:["Digital_Pan","Digital_Zoom","Parallax","Free_3D","Simulated_Handheld"]};function Ef(e,t){return e<=24&&["CU","BCU","ECU"].includes(t)?`Wide lens (${e}mm) on ${t} causes facial distortion`:e<=18&&["MCU"].includes(t)?`Very wide lens (${e}mm) on ${t} may cause noticeable distortion`:e>=135&&["EWS","WS"].includes(t)?`Long lens (${e}mm) on ${t} creates extreme compression`:e>=100&&"EWS"===t?`Telephoto (${e}mm) on EWS is unusual - extreme distance required`:"ECU"===t&&e<85?"ECU typically uses 85-135mm lenses for flattering perspective":"EWS"===t&&e>35?"EWS typically uses 14-24mm for maximum environmental context":null}const Cf={Alexa_35:"S35",Alexa_Mini:"S35",Alexa_Mini_LF:"LF",Alexa_LF:"LF",Alexa_65:"65mm",V_Raptor:"FF",V_Raptor_X:"FF",V_Raptor_XL:"FF",Komodo_X:"S35",Monstro_8K:"FF",Venice_2:"FF",FX9:"FF",FX6:"FF",C700_FF:"FF",C500_Mark_II:"FF",C300_Mark_III:"S35",Ursa_Mini_Pro_12K:"S35",Pocket_6K:"S35",Varicam_LT:"S35",S1H:"FF",Z9:"FF",Inspire_3:"FF",Mavic_3_Cine:"M43",Arricam_ST:"S35",Arricam_LT:"S35",ARRI_535B:"S35",ARRI_35BL:"S35",ARRI_35_III:"S35",Panavision_Millennium_XL2:"S35",Panavision_Millennium:"S35",Panavision_Platinum:"S35",Panavision_Gold:"S35",Panavision_Panastar:"S35",Panavision_Panaflex:"S35",Super_Panavision_70:"65mm",Ultra_Panavision_70:"65mm",Mitchell_BNC:"S35",Mitchell_BNCR:"S35",Mitchell_BFC_65:"65mm",IMAX_MSM_9802:"IMAX_15perf",IMAX_MKIV:"IMAX_15perf",IMAX_GT:"IMAX_15perf"},Tf={Alexa_35:"LPL",Alexa_Mini:"PL",Alexa_Mini_LF:"LPL",Alexa_LF:"LPL",Alexa_65:"XPL",V_Raptor:"RF",V_Raptor_X:"RF",V_Raptor_XL:"RF",Komodo_X:"RF",Monstro_8K:"PL",Venice_2:"PL",FX9:"E",FX6:"E",C700_FF:"PL",C500_Mark_II:"EF",C300_Mark_III:"EF",Ursa_Mini_Pro_12K:"PL",Pocket_6K:"EF",Varicam_LT:"PL",S1H:"L",Z9:"Z",Inspire_3:"DL",Mavic_3_Cine:"Fixed",Arricam_ST:"PL",Arricam_LT:"PL",ARRI_535B:"PL",ARRI_35BL:"PL",ARRI_35_III:"PL",Panavision_Millennium_XL2:"Panavision",Panavision_Millennium:"Panavision",Panavision_Platinum:"Panavision",Panavision_Gold:"Panavision",Panavision_Panastar:"Panavision",Panavision_Panaflex:"Panavision",Super_Panavision_70:"Panavision_65",Ultra_Panavision_70:"Panavision_65",Mitchell_BNC:"Mitchell_Standard",Mitchell_BNCR:"Mitchell_Standard",Mitchell_BFC_65:"Mitchell_Standard",IMAX_MSM_9802:"IMAX_Standard",IMAX_MKIV:"IMAX_Standard",IMAX_GT:"IMAX_Standard"},Pf={ARRI_Ultra_Prime:["S35"],ARRI_Master_Prime:["S35"],ARRI_Signature_Prime:["S35","FF","LF"],ARRI_Prime_65:["LF","65mm"],ARRI_Prime_DNA:["LF","65mm"],Zeiss_Master_Prime:["S35"],Zeiss_CP3:["S35","FF"],Zeiss_Supreme_Prime:["S35","FF","LF"],Cooke_S4:["S35"],Cooke_Panchro:["S35"],Cooke_Speed_Panchro:["S35"],Cooke_S7:["S35","FF","LF"],Panavision_Primo:["S35"],Panavision_C_Series:["S35"],Panavision_E_Series:["S35"],Panavision_Super_Speed:["S35"],Panavision_Standard:["S35"],Panavision_Ultra_Speed:["S35"],Panavision_Auto_Panatar:["S35"],Panavision_Primo_70:["S35","FF","LF","65mm"],Ultra_Panavision_Optics:["65mm"],Angenieux_Optimo:["S35","FF"],Leica_Summicron_C:["S35","FF"],Leica_Summilux_C:["S35","FF"],Canon_Sumire:["S35","FF"],Canon_K35:["S35"],Sony_CineAlta:["S35","FF"],Sigma_Cine:["S35","FF"],Bausch_Lomb_Super_Baltar:["S35"],Bausch_Lomb_Baltar:["S35"],Zeiss_Planar_f07:["S35"],Zeiss_Super_Speed:["S35"],Zeiss_Standard_Speed:["S35"],Kowa_Anamorphic:["S35"],Todd_AO:["65mm","IMAX_15perf"],Hasselblad_HC:["FF","LF","65mm"],Hasselblad_V:["FF","LF","65mm","IMAX_15perf"],IMAX_Optics:["IMAX_15perf","65mm","LF"]},kf={ARRI_Ultra_Prime:["PL","LPL"],ARRI_Master_Prime:["PL","LPL"],ARRI_Signature_Prime:["LPL","PL"],ARRI_Prime_65:["XPL"],ARRI_Prime_DNA:["LPL"],Zeiss_Master_Prime:["PL","LPL"],Zeiss_CP3:["PL","LPL","EF"],Zeiss_Supreme_Prime:["PL","LPL"],Cooke_S4:["PL","LPL"],Cooke_Panchro:["PL","LPL"],Cooke_S7:["PL","LPL"],Cooke_Speed_Panchro:["PL"],Angenieux_Optimo:["PL","LPL"],Leica_Summicron_C:["PL","LPL"],Leica_Summilux_C:["PL","LPL"],Canon_Sumire:["PL","EF"],Canon_K35:["PL"],Sony_CineAlta:["PL","E"],Sigma_Cine:["PL","EF","E"],Panavision_Primo:["Panavision"],Panavision_Primo_70:["Panavision","Panavision_65","XPL"],Panavision_C_Series:["Panavision"],Panavision_E_Series:["Panavision"],Panavision_Super_Speed:["Panavision"],Panavision_Standard:["Panavision"],Panavision_Ultra_Speed:["Panavision"],Panavision_Auto_Panatar:["Panavision"],Ultra_Panavision_Optics:["Panavision_65"],Bausch_Lomb_Super_Baltar:["PL","Mitchell_Standard"],Bausch_Lomb_Baltar:["PL","Mitchell_Standard"],Zeiss_Planar_f07:["PL"],Zeiss_Super_Speed:["PL"],Zeiss_Standard_Speed:["PL"],Kowa_Anamorphic:["PL","Mitchell_Standard"],Todd_AO:["Mitchell_Standard","IMAX_Standard"]},Af={ARRI:["ARRI_Signature_Prime","ARRI_Master_Prime","ARRI_Ultra_Prime","ARRI_Prime_65","ARRI_Prime_DNA"],Zeiss:["Zeiss_Supreme_Prime","Zeiss_Master_Prime","Zeiss_CP3","Zeiss_Super_Speed","Zeiss_Standard_Speed","Zeiss_Ultra_Prime","Zeiss_Planar_f0.7"],Cooke:["Cooke_S7","Cooke_S4","Cooke_Panchro","Cooke_Speed_Panchro"],Panavision:["Panavision_Primo","Panavision_Primo_70","Panavision_C_Series","Panavision_E_Series","Panavision_Super_Speed","Panavision_Standard","Panavision_Ultra_Speed","Panavision_Auto_Panatar","Ultra_Panavision_Optics"],Angenieux:["Angenieux_Optimo"],Leica:["Leica_Summicron_C","Leica_Summilux_C"],Canon:["Canon_Sumire","Canon_K35"],Sony:["Sony_CineAlta"],Sigma:["Sigma_Cine"],Fujifilm:[],Hawk:["Hawk_V_Lite","Hawk_V_Plus"],Technovision:["Vintage_Anamorphic"],Bausch_Lomb:["Bausch_Lomb_Super_Baltar","Bausch_Lomb_Baltar"],Todd_AO:["Todd_AO"],Kowa:["Kowa_Anamorphic"],Vintage:["Vintage_Spherical","Vintage_Anamorphic"],Hasselblad:["Hasselblad_HC","Hasselblad_V","IMAX_Optics"],IMAX:["IMAX_Optics","Hasselblad_V"],Warner_Bros:["Vintage_Spherical"],Paramount:["Vintage_Spherical"],Pathe:["Vintage_Spherical"]},Nf={ARRI_Signature_Prime:[12,15,18,21,25,29,35,40,47,58,75,95,125,150],ARRI_Master_Prime:[12,14,16,18,21,25,27,32,35,40,50,65,75,100,135],ARRI_Ultra_Prime:[8,10,12,14,16,20,24,28,32,40,50,65,85,100,135],ARRI_Prime_65:[24,28,35,50,80,100,150],ARRI_Prime_DNA:[18,21,25,32,35,50,65,80,100,135],Zeiss_Supreme_Prime:[15,18,21,25,29,35,50,65,85,100,135],Zeiss_Master_Prime:[12,14,16,18,21,25,27,32,35,40,50,65,75,100,135],Zeiss_CP3:[15,18,21,25,28,35,50,85,100,135],Cooke_S7:[16,18,21,25,32,40,50,65,75,100,135],Cooke_S4:[12,14,16,18,21,25,27,32,35,40,50,65,75,100,135],Cooke_Panchro:[18,21,25,32,40,50,75,100],Panavision_Primo:[14,17,21,27,35,40,50,75,100],Panavision_Primo_70:[27,35,40,50,65,80,100,125,150,200],Panavision_C_Series:[17,21,27,35,40,50,75,100],Angenieux_Optimo:[15,24,28,35,40,50,70,100,135,200,290],Leica_Summicron_C:[15,18,21,25,29,35,40,50,75,100,135],Leica_Summilux_C:[16,18,21,25,29,35,40,50,65,75,100],Canon_Sumire:[14,20,24,35,50,85,135],Sony_CineAlta:[20,24,35,50,85,100,135],Sigma_Cine:[14,20,24,28,35,40,50,85,105,135],Hasselblad_HC:[24,28,35,50,80,100,120,150,210],Hasselblad_V:[40,50,60,80,100,120,150,180,250],IMAX_Optics:[35,40,50,80,100,110,150]},Rf={Alexa_65:{required_families:["ARRI_Prime_65","ARRI_Prime_DNA","Panavision_Primo_70","Hasselblad_V"],reason:"65mm sensor requires specialized 65mm format lenses"}};function Lf(e){if(e.includes("Panavision")||e.startsWith("Super_Panavision")||e.startsWith("Ultra_Panavision"))return"Panavision cameras require Panavision lenses (closed ecosystem)";const t=Rf[e];if(null==t?void 0:t.reason)return t.reason;const n=Cf[e];return"LF"===n?"Large Format camera - S35-only lenses excluded":"65mm"===n?"65mm sensor - requires specialized 65mm format lenses":null}const If={ARRI:"German precision. Industry-leading color science, exceptional highlight handling. Alexa is the gold standard.",RED:"American high-resolution pioneer. Compact bodies, 8K capable. Popular for indie to blockbuster.",Sony:"Japanese innovation. Dual ISO, excellent low-light. Venice for cinema, FX for broadcast.",Canon:"Japanese reliability. Cinema EOS line bridges photo/video. Strong autofocus, organic color.",Blackmagic:"Australian value leader. Affordable cinema cameras with DaVinci color science.",Panasonic:"Japanese innovation. VariCam for broadcast, S-series for hybrid. Dual native ISO.",Nikon:"Japanese stills heritage. Z-mount system pushing into cinema with Z9.",DJI:"Chinese aerial pioneers. Integrated camera/gimbal drones. Aerial cinematography standard.",ARRI_Film:"German film cameras (1917-present). Arricam series for modern film, 35 III/BL for classics. Industry workhorse.",Panavision:"Hollywood exclusive. Closed ecosystem (cameras + lenses). Rental-only. Millennium XL2 is modern standard.",Mitchell:"American classic (1920s-1970s). BNC was the Hollywood standard. Quiet for sync-sound. Now vintage/specialty.",IMAX:"Canadian large-format pioneer. 65mm/70mm film for immersive exhibition. 15-perf for ultimate resolution."},jf={ARRI:"German engineering. Clean, modern, technically precise. Signature Prime and Master Prime series.",Zeiss:"Legendary optics. Clinical sharpness, minimal distortion. Supreme and Master series.",Cooke:'British warmth. The "Cooke Look"flattering skin tones, organic feel. S4 and S7 series.',Panavision:"Hollywood exclusive. Rental-only ecosystem. Primo series, anamorphic heritage.",Angenieux:"French zoom masters. Cinema-quality zooms that rival primes. Optimo series.",Leica:"German micro-contrast. Legendary still lens rendering brought to cinema. Summilux/Summicron.",Canon:"Japanese reliability. Warm, organic Sumire series for digital cinema.",Sony:"Matched to Venice cameras. CineAlta series optimized for Sony color science.",Sigma:"Japanese value. Sharp, modern cine lenses at accessible price points.",Fujifilm:"Japanese broadcast heritage. Fujinon series for cinema and broadcast.",Bausch_Lomb:"American classic. Super Baltar lenses defined Golden Age Hollywood. Warm, glowing highlights.",Todd_AO:"American large-format pioneer. 70mm optics for epic roadshow presentations.",Kowa:"Japanese anamorphic. Cinerama-era optics. Distinctive flares, vintage character."},Df={Alexa_35:"ARRI flagship S35 camera. 4.6K sensor with exceptional highlight handling and organic color science. Industry standard for narrative filmmaking.",Alexa_Mini:"Compact S35 workhorse. Same sensor as larger ALEXAs but in gimbal-friendly form factor. Versatile for documentary to blockbuster.",Alexa_Mini_LF:"Large format version of Mini. Shallower depth of field and wider field of view. Popular for cinematic drama.",Alexa_LF:"ARRI Large Format camera. Same sensor as Mini LF in traditional body. Exceptional image quality.",Alexa_65:"Ultra-large 65mm format. Requires specialized optics. Used for epic visuals (Dune, Joker). Heavyno handheld.",V_Raptor:"RED's 8K VistaVision camera. Compact, high resolution. Popular for episodic TV and indie features.",V_Raptor_X:"RED V-Raptor [X]. Enhanced sensor with improved low-light performance.",V_Raptor_XL:"Larger V-Raptor with internal ND filters and XLR audio. Studio-friendly configuration.",Komodo_X:"RED compact body. S35 6K sensor in ultra-small package. Run-and-gun and gimbal favorite.",Monstro_8K:"RED 8K sensor. Large format with exceptional resolution. High-end production standard.",Venice_2:"Sony dual ISO marvel. 8.6K full-frame. Exceptional low-light performance. Heavystudio/dolly use.",FX9:"Sony full-frame camcorder. Built-in ND, XLR. Documentary and broadcast standard.",FX6:"Compact full-frame Sony. Run-and-gun form factor with Venice color science.",Arricam_ST:"ARRI Studio model. Quiet for sync-sound. Standard size for studio work. Modern film workhorse.",Arricam_LT:"ARRI Lite model. Lighter for handheld/Steadicam. Same gate as ST, smaller body.",ARRI_535B:"ARRI 535 evolution. 4-perf with crystal sync. Last generation before digital transition.",ARRI_35BL:"ARRI Blimped. Ultra-quiet for sync-sound. 1970s-2000s television standard.",ARRI_35_III:"ARRI lightweight. Popular for documentary, news, handheld narrative. Compact and reliable.",Panavision_Millennium_XL2:"Modern Panavision standard. Ultra-quiet, anamorphic-ready. Most rented film camera 2000-2015.",Panavision_Millennium:"Original Millennium. First truly quiet Panavision. Late 1990s flagship.",Panavision_Platinum:"Panavision 1980s flagship. Used on countless blockbusters. Heavy but reliable.",Panavision_Gold:"Panavision 1970s standard. The Empire Strikes Back, Blade Runner era.",Panavision_Panastar:"High-speed Panavision. Built for slow-motion. Action sequences, sports.",Panavision_Panaflex:"Original Panaflex. First self-blimped Panavision. Revolutionary quiet operation.",Super_Panavision_70:"Spherical 65mm. Lawrence of Arabia, 2001. Epic scale without anamorphic squeeze.",Ultra_Panavision_70:"Anamorphic 65mm. Ben-Hur, The Hateful Eight. Widest theatrical ratio (2.76:1).",Mitchell_BNC:"Mitchell Blimped Newsreel Camera. Hollywood studio standard 1930s-1960s. Whisper-quiet.",Mitchell_BNCR:"Mitchell Reflex. Added through-the-lens viewing. Easier operator workflow.",Mitchell_BFC_65:"Mitchell 65mm. Used for Todd-AO, early widescreen epics. Oklahoma!, Around the World.",IMAX_MSM_9802:"IMAX standard camera. 15-perf 65mm. Used for documentaries, nature films.",IMAX_MKIV:"IMAX Mark IV. Lighter than 9802. Enabled more dynamic IMAX shooting.",IMAX_GT:"IMAX Grand Theatre. Largest format camera. IMAX Dome/OMNIMAX presentations."},Uf={Static:"Tripod-mounted. Rock-solid stability for dialogue, interviews, architectural shots. No operator fatigue.",Handheld:"Shoulder-mounted or body-braced. Organic energy, documentary feel. Limited by camera weightheavy cameras cause fatigue.",Steadicam:"Vest-mounted stabilizer. Smooth floating movement. Classic long takes (Goodfellas hallway). Requires trained operator.",Gimbal:"Electronic 3-axis stabilizer. Modern alternative to Steadicam. Weight-limited, typically under 3kg.",Dolly:"Wheeled platform on track. Precise, repeatable moves. Essential for Dolly Zoom (Vertigo effect).",Crane:"Elevated arm for sweeping vertical moves. Dramatic reveals, establishing shots. Requires setup time.",Jib:"Smaller crane arm. Crane-style moves in tighter spaces. More portable than full crane.",Technocrane:"Telescoping crane with remote head. Complex compound moves. High-end commercial/film standard.",Drone:"Aerial platform. Sweeping establishing shots, impossible angles. Weight-limited, outdoor-preferred."},Of={Static:"No camera movement. Lets blocking and performance drive energy. Theatre-derived staging.",Pan:"Horizontal rotation on tripod head. Follows action left-right. Reveals space laterally.",Tilt:"Vertical rotation on tripod head. Reveals height, follows vertical action.",Track_In:"Camera moves toward subject. Increases intimacy, reveals detail. Push-in intensifies moment.",Track_Out:"Camera moves away from subject. Reveals context, creates distance. Pull-out diminishes subject.",Arc:"Camera orbits around subject. Adds dimensionality, shows all sides. Dynamic without cutting.",Crane_Up:"Camera rises vertically. Triumphant, revelatory. Often ends establishing shots.",Crane_Down:"Camera descends. Arrival, focus narrowing. Often begins scenes with overview.",Dolly_Zoom:"Vertigo effect: dolly + opposing zoom. Disorientation, realization. Requires Dolly or Slider equipment."},Ff={Static:"No movementcamera holds position. Contemplative, observational.",Very_Slow:"Extremely deliberate pace. Meditative, hypnotic. Art cinema, contemplative sequences.",Slow:"Deliberate, meditative pace. Builds atmosphere, prolongs tension. Tarkovsky, slow cinema.",Moderate:"Natural conversational pace. Unobtrusive, standard coverage.",Fast:"Energetic, urgent movement. Action sequences, chase scenes. Can be disorienting if excessive.",Whip_Fast:"Ultra-rapid whip pans/tilts. Comedic timing, sudden reveals. Wes Anderson, Edgar Wright."},zf={Dawn:"Pre-sunrise. Cool blue ambient transitioning to warm. Quiet, hopeful, new beginnings.",Morning:"Low warm sun angle. Long shadows. Fresh energy. Soft backlight opportunities.",Midday:"Harsh overhead sun. High contrast, strong shadows. Challenging for faces. Use fill or find shade.",Afternoon:"Sun lowering. Warmer tones beginning. Most flexible natural light window.",Golden_Hour:"Magic hour near sunset. Warm, soft, directional. Cinematographer's favorite. Brief window.",Blue_Hour:"Post-sunset twilight. Cool ambient with artificial lights gaining prominence. Magical quality.",Dusk:"Transition to night. Mixed natural/artificial. Nostalgic, end-of-day feeling.",Night:"After dark. Requires artificial sources. High drama potential. No sun available."},Bf={Sun:"Natural daylight. Hard source, warm. Unavailable at night. Golden hour = soft; midday = harsh.",Moon:"Night ambience. Typically simulated with HMI + diffusion. Cool blue cast. Low level.",Tungsten:"Classic incandescent. Warm 3200K. Traditional film lighting. Softens with diffusion.",HMI:"Daylight-balanced arcs. High output, can simulate sun through windows. Available since 1972.",LED:"Modern solid-state. Variable color temperature, low power. Available widespread since ~2002.",Kino_Flo:"Fluorescent tubes designed for film. Soft, even. Available since 1987. Portrait favorite.",Neon:"Practical neon tubes. Colored accent light. Cyberpunk, noir aesthetic.",Practical:"In-frame light sourceslamps, signs, screens. Motivated light. Adds realism.",Mixed:"Multiple source types. Complex setups. Color temperature mismatches can be stylistic."},Hf={High_Key:"Bright, even lighting. Minimal shadows. Comedies, sitcoms, commercials. Upbeat mood.",Low_Key:"High contrast, deep shadows. Noir, thriller. Cannot achieve at midday without blackout.",Soft:"Diffused sources, gentle gradients. Flattering for faces. Romantic, dreamy.",Hard:"Direct sources, sharp shadows. Dramatic, edgy. Can be unflattering.",Naturalistic:"Motivated by scene logic. Windows provide light because windows exist. Subtle intervention.",Expressionistic:"Stylized beyond realism. Colored gels, unusual angles. Horror, fantasy, music video.",Chiaroscuro:"Renaissance painting style. Strong directional light, deep black shadows. Caravaggio influence."},Vf={EWS:"Extreme Wide Shot. Vast landscapes, establishing scale. Subject tiny in frame. Best with 14-24mm.",WS:"Wide Shot. Full environment context. Subject head-to-toe with surroundings.",MWS:"Medium Wide Shot. Subject with significant environment. Waist-up with room around.",MS:"Medium Shot. Waist-up framing. Dialogue standard. Balances face and gesture.",MCU:"Medium Close-Up. Chest-up framing. Emotional emphasis while showing some body language.",CU:"Close-Up. Face fills frame. Maximum emotional impact. Typically 50-100mm lens.",BCU:"Big Close-Up. Eyes to chin. Intense, intimate. Reveals micro-expressions.",ECU:"Extreme Close-Up. Single feature (eye, mouth, hand). Abstract, hyper-detailed. Best with 85-135mm.",OTS:"Over-The-Shoulder. Conversation framing with foreground shoulder. Establishes spatial relationship.",POV:"Point-of-View. Through character's eyes. Subjective experience. Often handheld."},Wf={Rule_of_Thirds:"Subject on grid intersections. Dynamic, natural-feeling. Most common technique.",Centered:"Subject dead center. Formal, confrontational. Wes Anderson, Stanley Kubrick.",Symmetrical:"Mirror-balanced frame. Order, stability, unease (context-dependent).",Asymmetrical:"Intentionally unbalanced. Tension, instability. Weight on one side.",Negative_Space:"Large empty areas. Isolation, loneliness, anticipation. Subject small in frame.",Leading_Lines:"Environmental lines draw eye to subject. Roads, hallways, architecture."},Gf={Cheerful:"Light, happy, optimistic. Requires bright lightingincompatible with Low-Key.",Happy:"Joyful, upbeat energy. High-key lighting, warm colors. Feel-good moments.",Hopeful:"Aspirational, forward-looking. Often warm tones, rising camera moves.",Whimsical:"Playful, quirky. Unusual angles, bright colors. Wes Anderson territory.",Adventurous:"Excitement and discovery. Dynamic movement, expansive framing.",Romantic:"Intimate, warm. Soft lighting, close framing. Golden hues.",Sensual:"Physical intimacy emphasized. Close framing, shallow focus, warm tones.",Passionate:"Intense emotional/physical connection. Dynamic, warm, urgent.",Intimate:"Personal, close. Quiet moments, private spaces.",Melancholic:"Sad but beautiful. Muted colors, soft light. Autumnal feel.",Somber:"Grave, serious tone. Muted palette, measured pacing.",Reflective:"Looking inward or back. Often static, natural light.",Contemplative:"Thoughtful, introspective. Slow pacing, quiet moments.",Introspective:"Internal focus. Close-ups, negative space, silence.",Tender:"Gentle emotional vulnerability. Soft light, close framing.",Bittersweet:"Joy tinged with sadness. Warm but muted. Nostalgic undertones.",Nostalgic:"Warm recollection. Often sepia or warm desaturated. Period feel.",Serene:"Peaceful, calm. Static or slow movement. Balanced composition.",Surreal:"Dream-like, illogical. Unusual angles, unexpected lighting.",Dreamlike:"Soft, ethereal. Diffusion, bloom. Often overexposed edges.",Hallucinatory:"Distorted reality. Warped visuals, unstable framing, vivid colors.",Transcendent:"Beyond ordinary experience. Ethereal light, expansive space.",Meditative:"Deeply calm, trance-like. Minimal movement, extended takes.",Philosophical:"Contemplating existence. Often static, faces in thought.",Psychedelic:"Altered consciousness. Saturated colors, distortion, disorientation.",Gloomy:"Persistent darkness. Low-key required. Minimal color.",Menacing:"Active threat present. Low angles, shadows encroaching.",Oppressive:"Suffocating pressure. Tight framing, heavy shadows, claustrophobic.",Paranoid:"Threatened from all sides. Wide angles, looking around.",Tense:"Building pressure. Tight framing, restricted movement.",Anxious:"Uncomfortable uncertainty. Handheld, tight, distorted.",Claustrophobic:"Trapped, no escape. Tight spaces, close walls, shallow depth.",Brutal:"Harsh, unforgiving violence. Hard light, stark framing.",Traumatic:"Psychological damage. Fragmented, unstable, overwhelming.",Unsettling:"Something wrong but unclear. Slightly off framing, odd timing.",Ominous:"Impending doom. Low angles, heavy shadows.",Suspenseful:"Anticipating threat. Slow reveals, sound design crucial.",Mysterious:"Intriguing unknowns. Shadows, partial reveals. Cool or neutral tones.",Haunting:"Lingering unease. Cool tones, slow drift.",Bleak:"Hopeless emptiness. Desaturated, harsh environments.",Tragic:"Profound loss. Often static, allowing weight to settle.",Lonely:"Isolation emphasized. Negative space, single subjects.",Aggressive:"Confrontational energy. Fast movement, tight angles.",Angry:"Visible rage. Tight close-ups, red accents, unstable framing.",Rebellious:"Defiant energy. Dutch angles, punk aesthetic, bold choices.",Kinetic:"Pure motion energy. Fast cuts, dynamic camera, action-driven.",Urgent:"Time-critical pressure. Fast pacing, close framing, breathless.",Provocative:"Deliberately challenging. Bold framing, direct confrontation.",Unhinged:"Lost control. Erratic movement, unpredictable framing.",Chaotic:"Disorder and confusion. Handheld, rapid cutting.",Frantic:"Desperate urgency. Fast, unstable, breathless.",Intense:"High stakes focus. Close, direct, immediate.",Noir:"Classic film noir aesthetic. High contrast, shadows, morally ambiguous.",Hardboiled:"Tough, cynical detective fiction. Urban night, practical lighting.",Fatalistic:"Inevitable doom accepted. Static, resigned framing.",Cynical:"Distrustful, world-weary. Cool tones, detached framing.",World_Weary:"Exhausted by experience. Heavy, slow, desaturated.",Gothic:"Dark romanticism. Architecture, shadows, supernatural undertones.",Macabre:"Death and decay fascination. Shadow, texture, unsettling beauty.",Grotesque:"Distorted, disturbing forms. Wide angles, harsh light.",Eldritch:"Cosmic, unknowable horror. Vast scale, alien geometry.",Dread:"Paralyzing fear of what comes. Static, inevitable approach.",Documentary:"Observational realism. Natural light, handheld, unobtrusive.",Realistic:"Naturalistic presentation. Motivated lighting, believable blocking.",Observational:"Fly-on-wall perspective. Distance, patience, non-intervention.",Journalistic:"News/reportage style. Handheld, available light, urgent.",Verite:"Cinema veritetruth of the moment. Raw, unpolished, authentic.",Epic:"Grand scale. Wide shots, sweeping movements, orchestral feel."},$f={Warm_Saturated:"Rich, vivid warm colors. Energetic, inviting. Summer, nostalgia.",Warm_Desaturated:"Muted warm tones. Period films, memory sequences. Sepia influence.",Cool_Saturated:"Vivid blues and cyans. Sci-fi, night exteriors. Electric feel.",Cool_Desaturated:"Muted blues. Noir, thriller, depression. Clinical or bleak.",Neutral_Saturated:"Balanced vivid colors. Commercials, bright films.",Neutral_Desaturated:"Muted neutral palette. Documentary, realism. Low intervention.",Monochrome:"Black and white. Classic, graphic, timeless. Bold artistic choice.",Sepia:"Brown-toned monochrome. Historical, aged, nostalgic.",Teal_Orange:"Complementary color grade. Blockbuster look. Skin pops against teal shadows."},Xf={ARRI_Signature_Prime:"Modern LF lenses. Clean with subtle character. Gentle fall-off. Current ARRI flagship.",ARRI_Master_Prime:"Ultra-sharp S35 lenses. Clinical precision. High contrast. Technical perfection.",ARRI_Ultra_Prime:"Compact S35 primes. Neutral rendering. Documentary and narrative workhorse.",ARRI_Prime_65:"65mm format lenses for Alexa 65. Cinema-scale optics. XPL mount. Used on Roma, The Revenant.",ARRI_Prime_DNA:"DNA Large Format lenses. Organic character with modern resolution. Beautiful flares. Used on Parasite.",Zeiss_Supreme_Prime:"Modern high-speed LF lenses. Smooth bokeh, gentle flares. Clean aesthetic.",Zeiss_Master_Prime:"S35 reference standard. Maximum sharpness. Minimal distortion.",Zeiss_CP3:"Compact primes. Good value, solid performance. Indie production favorite.",Cooke_S7:"Full-frame Cooke Look. Warm skin tones, gentle rolloff. Organic character.",Cooke_S4:"Classic S35 primes. The definitive Cooke Look. Slight warmth, beautiful faces.",Cooke_Panchro:"Vintage rehoused classics. Period character. Soft, romantic.",Panavision_Primo:"Hollywood standard S35. Exclusive ecosystem. Pristine but characterful.",Panavision_Primo_70:"65mm format coverage. For Alexa 65 and large format. Epic scale optics.",Panavision_C_Series:"Compact anamorphic. Squeezed 2x. Classic anamorphic flares and bokeh.",Angenieux_Optimo:"Premium zoom lenses. Rare prime-like zoom quality. Versatile focal ranges.",Leica_Summicron_C:"Cinema rehoused Leicas. Legendary Leica rendering. Subtle micro-contrast.",Leica_Summilux_C:"Fast Leica cine primes. Faster than Summicron. More bokeh potential.",Canon_Sumire:"Warm, organic primes. Intended for digital cinema. Pleasing skin tones.",Sony_CineAlta:"Matched to Venice cameras. Optimized for Sony color science.",Sigma_Cine:"High-value cine lenses. Sharp, modern. Excellent cost-performance."},qf={"2D":"Traditional flat animation. Hand-drawn or digital. Classic anime, Disney, independent animation.","3D":"Computer-generated 3D. Full dimensional lighting and camera freedom. Pixar, modern features.",Hybrid:"Mix of 2D and 3D elements. 3D backgrounds with 2D characters, or vice versa. Spider-Verse style.",StopMotion:"Physical puppets/models photographed frame-by-frame. Laika, Aardman. Tactile, handcrafted."},Kf={Anime:"Japanese animation tradition. 2D/hybrid. Expressive, stylized. Limited to full animation range.",Manga:"Japanese comic style. Static, monochrome only. High contrast ink aesthetic. No motion.",ThreeD:"3D computer animation. Dimensional lighting required. Smooth to exaggerated motion.",Illustration:"Static artwork. Single frame presentation. No motion, locked frame only."},Yf={Clean:"Smooth, uniform outlines. Professional anime standard. Digital precision.",Sketchy:"Rough, hand-drawn appearance. Artistic, unpolished charm. Indie aesthetic.",Bold:"Thick, prominent outlines. High contrast, graphic impact. Cartoon/comic style.",Thin:"Delicate, fine lines. Detailed, elegant. Illustration quality.",Variable:"Line weight varies with pressure/form. Dynamic, expressive. Traditional art feel.",None:"No outlines (lineless). Shapes defined by color only. 3D or painterly styles."},Zf={Cel:"Traditional anime cel coloring. Flat colors with hard shadows. Classic look.",Gradient:"Smooth color transitions. Softer, more dimensional than cel.",Watercolor:"Painted, textured appearance. Artistic, handcrafted feel.",Flat:"Solid colors, no shading. Graphic design influence. Bold, simple.",Textured:"Surface texture in color fills. Adds tactile quality.",Monochrome:"Single color or grayscale. Stylistic choice for color animation.",Monochrome_Ink:"Black and white ink style. Required for Manga domain."},Jf={Flat:"No dimensional shading. Graphic, 2D. Cannot use for 3D domain.",Cel_Shaded:"Hard shadow edges. Anime standard. Stylized dimensionality.",Soft_Shaded:"Smooth shadow gradients. More realistic while still stylized.",Naturalistic_Simulated:"Realistic light behavior simulated in 2D. Complex, labor-intensive.",Raytraced:"Physically accurate 3D lighting. Photorealistic. Not for anime style."},Qf={Smooth:"Clean, untextured surfaces. Classic anime look. Fast to render.",Textured:"Subtle surface variation. Adds visual interest without overwhelming.",Detailed:"Rich surface complexity. Fabric weave, skin pores, material specifics.",Photoreal:"Photorealistic surface rendering. Full material simulation. 3D only.",Stylized:"Artistic interpretation of surfaces. Hand-painted textures, illustrative."},eg={None:"Static image. No animation. Required for Manga and Illustration domains.",Limited:"Traditional anime efficiency. 8-12 fps on twos/threes. Strategic movement.",Full:"Full animation. 24 fps on ones. Disney-quality. High budget.",Exaggerated:"Beyond reality. Squash and stretch. Cartoon physics.",Snappy:"Quick, punchy timing. Modern digital animation trend.",Fluid:"Smooth, continuous motion. Graceful, flowing. High frame count."},tg={Locked:"Static frame. No camera movement. Required for Manga/Illustration.",Digital_Pan:"Horizontal digital movement across artwork. Classic anime technique.",Digital_Zoom:"Scale change on artwork. Ken Burns effect. Creates depth illusion.",Parallax:"Layered movement at different speeds. Creates depth in 2D.",Free_3D:"Full 3D camera movement. Requires 3D medium.",Simulated_Handheld:"Artificial shake/drift. Adds documentary feel. Not for anime.",Motion_Comic:"Panel-to-panel reveals. Comic book presentation style."},ng="Camera brand. ARRI, RED, and Sony dominate professional cinema. Each has unique color science and sensor technology.",ig="The specific camera model. Determines sensor size (S35, Full Frame, 65mm), resolution, weight class, and compatible lens mounts.",rg="Lens brand. Each manufacturer has a signature rendering styleCooke is warm, Zeiss is clinical, ARRI is balanced.",ag="The lens series. Different families have different optical character, coverage (S35 vs Full Frame), and focal length options.",og="Lens focal length in millimeters. Wide (14-24mm) for environments, Normal (35-50mm) for natural look, Long (85-135mm) for close-ups.",sg="Anamorphic lenses squeeze a wider field of view onto the sensor, creating the classic widescreen look with oval bokeh and horizontal flares.",lg="Physical support system. Determines what camera movements are possible. Heavy cameras restrict to Tripod/Dolly/Crane.",cg="The specific camera move. Each creates different emotional effectspush-in intensifies, pull-out reveals context.",ug="Speed of camera movement. Slow builds atmosphere, Fast adds energy. Dolly Zoom requires slower timing for effect.",dg="Scene time setting. Determines available natural light and shadows. Night eliminates Sun as a source option.",hg="Primary light source in the scene. Filtered by time of day and erano LED before 2002, no Sun at night.",pg="Overall lighting approach. High-Key is bright/even (comedy), Low-Key is dark/contrasty (noir). Some moods restrict options.",mg="How much of the subject fills the frame. Wide shots establish environment, close-ups show emotion and detail.",fg="Frame arrangement principles. Rule of Thirds is most common, Centered is formal/confrontational (Kubrick, Anderson).",gg="Emotional tone of the shot. Some presets restrict moodsBlade Runner blocks Cheerful, etc. Affects lighting compatibility.",vg="Color grading direction. Warm/Cool temperature and Saturated/Desaturated intensity. Sets the emotional palette.",yg="2D (traditional/digital flat) or 3D (computer generated). Affects available rendering and camera options.",_g="Animation tradition. Anime (Japanese 2D), Manga (static comics), 3D (Pixar-style), or Illustration (single frame art).",xg="How outlines are rendered. Anime typically uses clean dark lines, 3D may have no lines (lineless) or stylized edges.",bg="How color fills shapes. Cel = flat with hard shadows, Gradient = smooth transitions. Manga must be Monochrome_Ink.",Sg="How light/shadow is represented. Flat = no shading, Cel_Shaded = hard shadows, Raytraced = photorealistic (3D only).",wg="Texture complexity. Minimal for clean anime look, Detailed for complex surfaces. Affects rendering style.",Mg="Animation approach. Limited = efficient 12fps (anime), Full = 24fps fluid (Disney). Manga/Illustration must be None.",Eg="Camera movement in animation. 2D uses pans/zooms over artwork, 3D has free movement. Static domains require Locked.";function Cg(e,t="Digital"){const n=pf[e]||[];return("Film"===t?of.camera_body_film:of.camera_body).map(t=>{var i,r;const a=null==(i=Df)?void 0:i[t];if(n.length>0&&!n.includes(t)){const n=(null==(r=Object.entries(pf).find(([e,n])=>n.includes(t)))?void 0:r[0])||"another manufacturer";return{value:t,disabled:!0,reason:`${uf[t]||t.replace(/_/g," ")} is made by ${n}, not ${e}.`,description:a}}return{value:t,disabled:!1,description:a}})}function Tg(e,t){const n=hf[e]||"Medium",i=gf[t];return of.movement_equipment.map(r=>{var a;const o=null==(a=Uf)?void 0:a[r];return"Heavy"===n&&mf.includes(r)?{value:r,disabled:!0,reason:` ${uf[e]||e} (~${"Heavy"===n?">4kg":"3-4kg"}) exceeds ${r} weight limit. ${r} typically supports <${"Drone"===r?"3kg":"4kg"} payloads.`,description:o}:i&&!i.includes(r)?{value:r,disabled:!0,reason:` ${t} requires ${i.join(" or ")}physically impossible with ${r}.`,description:o}:{value:r,disabled:!1,description:o}})}function Pg(e){const t=ff[e]||of.movement_type;return of.movement_type.map(n=>{var i;const r=null==(i=Of)?void 0:i[n];if(!t.includes(n)){let t=` ${e} cannot perform ${n}`;return t+="Static"===e?"static mount has no movement capability.":"Handheld"===e?"handheld is limited to pan/tilt rotations.":"Crane"===e||"Jib"===e?"arm-based equipment cannot track horizontally.":"Dolly"===e?"dolly can only track (forward/back), not lift.":"Drone"===e?"drone movement is primarily aerial translation.":`physically limited by ${e} mechanics.`,{value:n,disabled:!0,reason:t,description:r}}return{value:n,disabled:!1,description:r}})}function kg(e,t,n,i){const r=yf[e],a=n?function(e){if(!e)return[];const t=[];for(const[n,i]of Object.entries(_f))e<i&&t.push(n);return t}(n):[];return of.lighting_source.map(o=>{var s;const l=null==(s=Bf)?void 0:s[o];if(r&&!r.includes(o))return"Sun"!==o||"Night"!==e&&"Blue_Hour"!==e?"Moon"===o&&"Midday"===e?{value:o,disabled:!0,reason:" Moonlight is too faint to compete with midday sunwould be invisible.",description:l}:{value:o,disabled:!0,reason:` ${o} unavailable at ${e.replace(/_/g," ")}.`,description:l}:{value:o,disabled:!0,reason:` Sun is below horizon at ${e.replace(/_/g," ")}physically impossible as primary source.`,description:l};if(t.includes(o))return{value:o,disabled:!0,reason:` ${o} conflicts with ${i||"preset"} aestheticwould break period/style consistency.`,description:l};if(a.includes(o)){return{value:o,disabled:!0,reason:` ${o} technology didn't exist in ${n}invented ${_f[o]}. Would be historically anachronistic.`,description:l}}return{value:o,disabled:!1,description:l}})}function Ag(e,t){const n=xf[e],i=t?bf[t]:null;return of.lighting_style.map(r=>{var a;const o=null==(a=Hf)?void 0:a[r];return n&&!n.includes(r)?"Low_Key"===r&&"Midday"===e?{value:r,disabled:!0,reason:" Low-Key requires controlled darknessmidday sun floods scene with ambient light. Need blackout or interior.",description:o}:{value:r,disabled:!0,reason:` ${r} not achievable at ${e.replace(/_/g," ")}.`,description:o}:t&&(null==i?void 0:i.disallowed.includes(r))?{value:r,disabled:!0,reason:` ${r.replace(/_/g," ")} creates tonal dissonance with "${t}" moodshadows and contrast undermine ${t.toLowerCase()} emotional intent.`,description:o}:{value:r,disabled:!1,description:o}})}function Ng(e){const t=vf[e];return of.movement_timing.map(n=>{var i;const r=null==(i=Ff)?void 0:i[n];return t&&!t.includes(n)?"Dolly_Zoom"===e?{value:n,disabled:!0,reason:` Dolly Zoom (Vertigo effect) at ${n.replace(/_/g," ")} speed is disorientingthe simultaneous zoom/dolly becomes unreadable. Use Slow or Moderate for the effect to register psychologically.`,description:r}:{value:n,disabled:!0,reason:` ${n.replace(/_/g," ")} is too fast for ${e.replace(/_/g," ")}.`,description:r}:{value:n,disabled:!1,description:r}})}function Rg(e,t){return of.mood.map(n=>{var i;const r=null==(i=Gf)?void 0:i[n];return e.length>0?e.includes(n)?{value:n,disabled:!1,reason:` Recommended for ${t||"this style"}aligns with the preset's visual identity.`,description:r}:{value:n,disabled:!1,reason:` Not typical for ${t||"this style"}. Recommended moods: ${e.join(", ")}.`,description:r}:{value:n,disabled:!1,description:r}})}function Lg(e,t){const n=Cf[e],i=Tf[e],r=Rf[e],a=t?Af[t]:null;return of.lens_family.map(o=>{var s,l;const c=null==(s=Xf)?void 0:s[o];if(a&&!a.includes(o)){const e=null==(l=Object.entries(Af).find(([e,t])=>t.includes(o)))?void 0:l[0];return{value:o,disabled:!0,reason:` ${df[o]||o.replace(/_/g," ")} is made by ${e}, not ${t}. Change manufacturer filter to use these lenses.`,description:c}}if((null==r?void 0:r.required_families)&&!r.required_families.includes(o))return{value:o,disabled:!0,reason:` ${uf[e]||e}'s ${n} sensor (65mm) requires specialized large-format optics. Only ${r.required_families.map(e=>df[e]||e).join(", ")} covers this format.`,description:c};const u=Pf[o];if(u){if("65mm"===n&&!u.includes("65mm"))return{value:o,disabled:!0,reason:` ${df[o]||o.replace(/_/g," ")} cannot cover 65mm sensorwould vignette severely. Designed for ${u.join("/")}.`,description:c};if("LF"===n&&!u.includes("LF")&&!u.includes("FF"))return{value:o,disabled:!0,reason:` ${df[o]||o.replace(/_/g," ")} is S35-onlywould show dark corners (vignette) on Large Format sensor.`,description:c}}const d=kf[o];if(d&&i){if(!(d.includes(i)||"LPL"===i&&d.includes("PL")||"RF"===i&&d.includes("PL")||"E"===i&&(d.includes("PL")||d.includes("E"))))return{value:o,disabled:!0,reason:` ${df[o]||o.replace(/_/g," ")} uses ${d.join("/")} mountincompatible with ${uf[e]||e}'s ${i} mount without adapter.`,description:c}}return{value:o,disabled:!1,description:c}})}function Ig(e){const t=Nf[e];return of.focal_length_mm.map(n=>{let i="";if(i=n<=18?`Ultra-wide ${n}mm. Dramatic perspective, environment emphasis. Distorts faces up close.`:n<=28?`Wide ${n}mm. Environmental context with subject. Some perspective distortion.`:n<=40?`Normal ${n}mm. Close to human vision. Versatile, neutral perspective.`:n<=65?`Standard ${n}mm. Classic portrait range begins. Flattering for faces.`:n<=100?`Portrait ${n}mm. Compressed perspective, beautiful bokeh. Intimate close-ups.`:`Telephoto ${n}mm. Strong compression, shallow depth. Surveillance, sports, intimate detail.`,t&&!t.includes(n)){const r=t.reduce((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e);return{value:String(n),disabled:!0,reason:` ${df[e]||e.replace(/_/g," ")} isn't manufactured in ${n}mm. Nearest available: ${r}mm. Lens sets have specific focal lengths.`,description:i}}return{value:String(n),disabled:!1,description:i}})}function jg(e){return e.startsWith("IMAX_")?["1.43:1","1.90:1","2.20:1"]:"Ultra_Panavision_70"===e?["2.76:1","2.39:1","2.20:1"]:"Super_Panavision_70"===e?["2.20:1","2.35:1","2.39:1"]:of.aspect_ratio}function Dg(e){const t=Sf[e];return of.color_application.map(n=>{var i,r;const a=null==(i=Zf)?void 0:i[n];return(null==(r=null==t?void 0:t.disallowed_colors)?void 0:r.includes(n))?"Manga"===e?{value:n,disabled:!0,reason:" Manga is defined by monochrome ink aestheticcolor would fundamentally change the medium.",description:a}:{value:n,disabled:!0,reason:` ${n} not available for ${e}.`,description:a}:{value:n,disabled:!1,description:a}})}function Ug(e,t,n){const i=Sf[e],r=wf[t],a=n?Mf[n]:null;return of.virtual_camera.map(n=>{var o,s;const l=null==(o=tg)?void 0:o[n];return(null==(s=null==i?void 0:i.disallowed_cameras)?void 0:s.includes(n))?"Anime"===e&&"Simulated_Handheld"===n?{value:n,disabled:!0,reason:" Anime tradition relies on deliberate, controlled framingsimulated handheld conflicts with the aesthetic.",description:l}:"Manga"===e?{value:n,disabled:!0,reason:" Manga is printed static artworkcamera movement doesn't exist in the medium.",description:l}:"Illustration"===e?{value:n,disabled:!0,reason:" Illustration is a single static imageno temporal dimension for camera movement.",description:l}:{value:n,disabled:!0,reason:` ${n} not compatible with ${e}.`,description:l}:(null==r?void 0:r.includes(n))?{value:n,disabled:!0,reason:` ${n} requires true 3D geometry${t} medium lacks the dimensional data for free camera movement.`,description:l}:(null==a?void 0:a.includes(n))?{value:n,disabled:!0,reason:' Motion Style is "None"camera movement requires animated frames to be perceptible.',description:l}:{value:n,disabled:!1,description:l}})}function Og(e){const t=Sf[e];return of.motion_style.map(n=>{var i,r;const a=null==(i=eg)?void 0:i[n];return(null==(r=null==t?void 0:t.disallowed_motion)?void 0:r.includes(n))?"Manga"===e?{value:n,disabled:!0,reason:" Manga is printed static artworkmotion exists only in reader's imagination through visual storytelling.",description:a}:"Illustration"===e?{value:n,disabled:!0,reason:" Illustration is a single frameno animation component exists.",description:a}:{value:n,disabled:!0,reason:` ${e} is staticno motion animation.`,description:a}:{value:n,disabled:!1,description:a}})}function Fg(e){const t=Sf[e];return of.lighting_model.map(n=>{var i,r;const a=null==(i=Jf)?void 0:i[n];return(null==t?void 0:t.required_lighting)&&!t.required_lighting.includes(n)?{value:n,disabled:!0,reason:` ${e} requires ${t.required_lighting.join("/")} lightingdimensional shading conflicts with the graphic ink aesthetic.`,description:a}:(null==(r=null==t?void 0:t.disallowed_lighting)?void 0:r.includes(n))?"Anime"===e&&"Raytraced"===n?{value:n,disabled:!0,reason:" Raytracing produces photorealistic lightingconflicts with anime's stylized cel-shaded aesthetic.",description:a}:"ThreeD"===e&&"Flat"===n?{value:n,disabled:!0,reason:" 3D animation requires dimensional lightingflat lighting defeats the purpose of 3D geometry.",description:a}:{value:n,disabled:!0,reason:` ${n} not compatible with ${e}.`,description:a}:{value:n,disabled:!1,description:a}})}function zg(e){const t={amelie:"amlie",an_andalusian_dog:"andalusian-dog",un_chien_andalou:"andalusian-dog",battle_of_algiers:"the-battle-of-algiers",one_flew_over_cuckoos_nest:"one-flew-over-the-cuckoos-nest",star_wars_anh:"star-wars-a-new-hope",la_la_land:null,the_social_network:null,joker:null,drive:null,solaris:"solaris",spirited_away:null,princess_mononoke:null,your_name:null,perfect_blue:null,paprika:null,toy_story:null,wall_e:null,spider_verse:"spider-verse",ratatouille:null,finding_nemo:null,arcane:"arcane",love_death_robots:null,into_the_spider_verse:"spider-verse",studio_ghibli_generic:null};if(e in t){const n=t[e];return null===n?null:`/movie-frames/${n}.jpg`}return`/movie-frames/${e.replace(/_/g,"-").toLowerCase()}.jpg`}function Bg(e){return e.disabled&&e.reason?e.description?`${e.reason}\n\n ${e.description}`:e.reason:e.description||""}const Hg=["camera.camera_type","camera.manufacturer","camera.body","camera.film_stock","camera.aspect_ratio","lens.manufacturer","lens.family","movement.equipment","movement.movement_type","movement.timing","lighting.time_of_day","lighting.source","lighting.style","visual_grammar.shot_size","visual_grammar.composition","visual_grammar.mood","visual_grammar.color_tone"],Vg=["medium","style_domain","rendering.line_treatment","rendering.color_application","rendering.lighting_model","rendering.surface_detail","motion.motion_style","motion.virtual_camera","visual_grammar.shot_size","visual_grammar.composition","visual_grammar.mood","visual_grammar.color_tone"];function Wg(){const{projectType:e,setProjectType:t,liveActionConfig:n,animationConfig:i,setLiveActionConfig:r,setAnimationConfig:a,updateLiveAction:o,updateAnimation:s,validationResult:l,setValidationResult:c,generatedPrompt:u,negativePrompt:d,setGeneratedPrompt:h,targetModel:p,setTargetModel:m,selectedLiveActionPreset:f,selectedAnimationPreset:g,liveActionPresetList:v,animationPresetList:y,setLiveActionPresetList:_,setAnimationPresetList:x,applyLiveActionPresetConfig:b,applyAnimationPresetConfig:S,clearPreset:w,setCpePromptForStoryboard:M}=Rm(),[E,C]=Pt.useState(!1),[T,P]=Pt.useState(!1),[k,A]=Pt.useState(!1),[N,R]=Pt.useState(!1),[L,I]=Pt.useState(""),[j,D]=Pt.useState(null),[U,O]=Pt.useState(!1),[F,z]=Pt.useState(!1),[B,H]=Pt.useState({type:"live_action",config:n});Pt.useEffect(()=>{const t=setTimeout(()=>{H({type:e,config:"live_action"===e?n:i})},300);return()=>clearTimeout(t)},[e,n,i]);const V=Qp({queries:("live_action"===e?Hg:Vg).map(e=>({queryKey:["options",B.type,e,B.config],queryFn:()=>Im.getOptions(B.type,e,B.config),staleTime:6e4,retry:!1}))}),W=Pt.useMemo(()=>{const e={};return V.forEach(t=>{t.data&&(e[t.data.field_path]=t.data)}),e},[V]),G=Pt.useCallback((e,t)=>{const n=W[e];if(!n)return t;const i=new Map(t.map(e=>[e.value,e])),r=new Set([...t.map(e=>e.value),...n.options,...n.disabled_options]),a=Array.from(r).sort((e,n)=>{const i=t.findIndex(t=>t.value===e),r=t.findIndex(e=>e.value===n);return-1!==i&&-1!==r?i-r:-1!==i?-1:-1!==r?1:0});return a.map(e=>{const t=i.get(e),r=n.disabled_options.includes(e),a=n.options.includes(e);let o=(null==t?void 0:t.disabled)??!1,s=null==t?void 0:t.reason;return r?(o=!0,s=n.disabled_reasons[e]||s):a&&(o=!1,s=void 0),{value:e,disabled:o,reason:s,description:null==t?void 0:t.description}})},[W]),[$,X]=Pt.useState(""),q=Pt.useRef(!1),[K,Y]=Pt.useState(()=>{const e=Jm();return(null==e?void 0:e.provider)||""}),[Z,J]=Pt.useState(()=>{const e=Jm();return(null==e?void 0:e.model)||""}),[Q,ee]=Pt.useState([]),[te,ne]=Pt.useState(!1),[ie,re]=Pt.useState(null),[ae,oe]=Pt.useState(""),[se,le]=Pt.useState([]),[ce,ue]=Pt.useState([]),[de,he]=Pt.useState(!1),pe=Pt.useMemo(()=>{const e=ce.find(e=>e.id===p);return e?"Image"===e.category:lf.has(p)},[ce,p]),me=Pt.useMemo(()=>{if("live_action"===e){const e=n.movement;return!!e&&"Static"!==e.movement_type}return!1},[e,n,i]),[fe,ge]=Pt.useState(()=>{const e=localStorage.getItem("cpe-ui-state");if(e)try{return JSON.parse(e).isPresetPanelOpen??!0}catch{}const t=localStorage.getItem("presetPanelOpen");return null===t||"true"===t}),[ve,ye]=Pt.useState(()=>{const e=localStorage.getItem("cpe-ui-state");if(e)try{return JSON.parse(e).presetPanelWidth??360}catch{}const t=localStorage.getItem("presetPanelWidth");return t?parseInt(t,10):360}),[_e,xe]=Pt.useState(()=>{const e=localStorage.getItem("cpe-ui-state");if(e)try{return JSON.parse(e).presetPanelTab??"browser"}catch{}return"browser"}),[be,Se]=Pt.useState(!1),we=Pt.useRef(null),Me=Pt.useRef(!0),Ee=Pt.useRef(null);Pt.useEffect(()=>{if(!Me.current)return Ee.current&&clearTimeout(Ee.current),Ee.current=setTimeout(async()=>{R(!0);try{const t="live_action"===e?await Im.validateLiveAction(n):await Im.validateAnimation(i);c(t)}catch(t){console.error("Validation error:",t)}finally{R(!1)}},300),()=>{Ee.current&&clearTimeout(Ee.current)};Me.current=!1},[e,n,i,c]),Pt.useEffect(()=>{const e=e=>{var n;if(!e.data||"INIT_CONFIG"!==e.data.type)return;const i=e.data.payload;if(!(null==i?void 0:i.config))return;Ce.current=!0,"live_action"===i.projectType?(t("live_action"),r(i.config)):"animation"===i.projectType&&(t("animation"),a(i.config));const o=i.userPrompt??(null==(n=i.config)?void 0:n.user_prompt)??"";void 0!==o&&(q.current=!0,X(o)),void 0!==i.prompt&&h(i.prompt||"",null),void 0!==i.enhancedPrompt&&oe(i.enhancedPrompt||"")};return window.addEventListener("message",e),window.parent&&window.parent!==window&&window.parent.postMessage({type:"READY"},"*"),()=>window.removeEventListener("message",e)},[t,r,a,h]);const Ce=Pt.useRef(!1);Pt.useEffect(()=>{const e=af();ee(e);const t=Jm();t?(Y(t.provider),J(t.model)):e.length>0&&!K&&(Y(e[0].providerId),e[0].models.length>0&&J(e[0].models[0]))},[F]),Pt.useEffect(()=>{const e=Qm();e&&m(e),he(!0),Im.getTargetModels().then(t=>{ue(t);const n=e||p;t.length>0&&!t.find(e=>e.id===n)&&m(t[0].id)}).catch(e=>{console.error("Failed to fetch target models:",e)}).finally(()=>{he(!1)})},[]),Pt.useEffect(()=>{const e={isPresetPanelOpen:fe,presetPanelWidth:ve,presetPanelTab:_e};localStorage.setItem("cpe-ui-state",JSON.stringify(e)),localStorage.setItem("presetPanelOpen",String(fe)),localStorage.setItem("presetPanelWidth",String(ve))},[fe,ve,_e]),Pt.useEffect(()=>{tf(p)},[p]);const Te=Pt.useCallback(e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;if("pointerId"in e&&t.setPointerCapture)try{t.setPointerCapture(e.pointerId)}catch{}Se(!0),document.body.classList.add("preset-panel-resizing")},[]),Pe=Pt.useCallback(e=>{if(!fe)return;const t=we.current;if(!t)return;const n=t.getBoundingClientRect();e.clientX-n.left<=12&&Te(e)},[fe,Te]);Pt.useEffect(()=>{if(!be)return;const e=e=>{e.preventDefault();const t=window.innerWidth-e.clientX,n=Math.max(280,window.innerWidth-40),i=Math.max(280,Math.min(n,t));ye(i)},t=()=>{Se(!1),document.body.classList.remove("preset-panel-resizing")};return document.addEventListener("pointermove",e),document.addEventListener("pointerup",t),document.addEventListener("pointercancel",t),document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("pointermove",e),document.removeEventListener("pointerup",t),document.removeEventListener("pointercancel",t),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.body.classList.remove("preset-panel-resizing")}},[be]),Pt.useEffect(()=>{(async()=>{P(!0);try{if("live_action"===e){const e=await Im.getLiveActionPresets();_(e.presets)}else{const e=await Im.getAnimationPresets();x(e.presets)}}catch(t){console.error("Failed to load presets:",t)}finally{P(!1)}})()},[e,_,x]);const ke=Pt.useCallback(async t=>{A(!0),D(null);try{if("live_action"===e){const e=await Im.applyLiveActionPreset(t);b(e.config,e.preset),c(e.validation),O(!0),Im.getCinematographyStyle(t).then(e=>D(e)).catch(()=>D(null)).finally(()=>O(!1))}else{const e=await Im.applyAnimationPreset(t);S(e.config,e.preset),c(e.validation)}}catch(n){console.error("Failed to apply preset:",n)}finally{A(!1)}},[e,b,S,c]),Ae=Pt.useCallback(async()=>{C(!0),le([]);try{const t="live_action"===e?await Im.generateLiveActionPrompt(n,p):await Im.generateAnimationPrompt(i,p);h(t.prompt,t.negative_prompt),c(t.validation)}catch(t){console.error("Failed to generate prompt:",t)}finally{C(!1)}},[e,n,i,p,h,c]),Ne=Pt.useCallback(()=>{navigator.clipboard.writeText(u)},[u]),Re=Pt.useCallback(async()=>{if(le([]),!$.trim())return void re("Please enter a prompt idea to enhance");if(!K||!Z)return void re("Please select an LLM provider and model. Configure providers in Settings.");const t=Q.find(e=>e.providerId===K);if(t){ne(!0),re(null);try{const r=await Im.enhancePrompt({userPrompt:$.trim(),llmProvider:K,llmModel:Z,targetModel:p,projectType:e,config:"live_action"===e?n:i,credentials:{apiKey:t.credentials.apiKey,endpoint:t.credentials.endpoint,oauthToken:t.credentials.oauthToken}});r.success?(oe(r.enhanced_prompt),le(r.warnings??[])):re(r.error||"Enhancement failed")}catch(r){console.error("Failed to enhance prompt:",r),re(r instanceof Error?r.message:"Enhancement failed"),le([])}finally{ne(!1)}}else re("Selected provider not found. Please configure in Settings.")},[$,K,Z,Q,p,e,n,i]),Le=e=>{switch(e){case"hard":return"hard";case"warning":return"warning";case"info":return"info";default:return""}};return Ut.jsxs("div",{className:"app app-with-panel "+(fe?"":"panel-collapsed"),style:{"--preset-panel-width":`${ve}px`},children:[Ut.jsxs("header",{className:"header cpe-toolbar",children:[Ut.jsx("textarea",{className:"toolbar-prompt",value:$,onChange:e=>X(e.target.value),placeholder:"Describe your scene...",rows:1}),Ut.jsx("select",{className:"toolbar-model",value:p,onChange:e=>m(e.target.value),disabled:de,children:ce.length>0?Ut.jsx(Ut.Fragment,{children:["General","Image","Video"].map(e=>{const t=ce.filter(t=>t.category===e);return 0===t.length?null:Ut.jsx("optgroup",{label:` ${e} Models `,children:t.map(e=>Ut.jsx("option",{value:e.id,children:e.name},e.id))},e)})}):Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("optgroup",{label:" General Models ",children:of.target_model.filter(e=>"generic"===e).map(e=>Ut.jsx("option",{value:e,children:sf[e]||e},e))}),Ut.jsx("optgroup",{label:" Image Models ",children:of.target_model.filter(e=>["midjourney","flux.1","flux.1_pro","flux_kontext","flux_krea","dall-e_3","gpt-image","ideogram_2.0","leonardo_ai","sdxl","stable_diffusion_3","z-image_turbo","qwen_image"].includes(e)).map(e=>Ut.jsx("option",{value:e,children:sf[e]||e},e))}),Ut.jsx("optgroup",{label:" Video Models ",children:of.target_model.filter(e=>["sora","sora_2","veo_2","veo_3","runway_gen-3","runway_gen-4","kling_1.6","pika_2.0","luma_dream_machine","ltx_2","cogvideox","hunyuan","wan_2.1","wan_2.2","minimax_video","qwen_vl"].includes(e)).map(e=>Ut.jsx("option",{value:e,children:sf[e]||e},e))})]})}),Ut.jsx("button",{className:"toolbar-btn primary",onClick:Ae,disabled:E,children:E?"Generating...":"Generate"}),Ut.jsx("button",{className:"toolbar-btn",onClick:Re,disabled:te||!$.trim(),children:te?"Enhancing...":"Enhance with AI"}),Ut.jsx("button",{className:"toolbar-settings",onClick:()=>z(!0),children:Ut.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[Ut.jsx("circle",{cx:"12",cy:"12",r:"3"}),Ut.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]}),Ut.jsx(nf,{isOpen:F,onClose:()=>z(!1)}),pe&&me&&Ut.jsx("div",{style:{margin:"0.75rem 1.25rem",padding:"0.6rem 0.8rem",borderRadius:"6px",backgroundColor:"rgba(245, 158, 11, 0.12)",color:"var(--text-primary)",border:"1px solid rgba(245, 158, 11, 0.4)",fontSize:"0.85rem"},children:"Motion settings are ignored for image models. Switch to a video model or set movement to Static."}),Ut.jsxs("div",{className:"output-panel",children:[Ut.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[Ut.jsxs("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["Prompt Generation",Ut.jsx("span",{title:"This panel generates AI prompts from your cinematography settings. Use 'Generate' for a simple prompt based on settings, or 'Enhance with AI' to have an LLM create a more detailed, professional prompt.",style:{cursor:"help",fontSize:"0.75rem",color:"var(--text-muted)",backgroundColor:"var(--bg-light)",borderRadius:"50%",width:"18px",height:"18px",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"?"})]}),Ut.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[N&&Ut.jsx("span",{className:"status-badge validating",children:"validating..."}),l&&!N&&Ut.jsx("span",{className:`status-badge ${l.status}`,children:l.status})]})]}),l&&l.messages.length>0&&Ut.jsx("div",{className:"validation-messages",style:{marginBottom:"0.75rem"},children:l.messages.map((e,t)=>Ut.jsxs("div",{className:`validation-message ${Le(e.severity)}`,children:[Ut.jsxs("strong",{children:[e.rule_id,":"]})," ",e.message]},t))}),Ut.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[Ut.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[Ut.jsxs("label",{style:{display:"block",fontSize:"0.75rem",color:"var(--text-muted)"},title:"Basic prompt generated from your cinematography settings.",children:["Simple Prompt ",Ut.jsx("span",{style:{cursor:"help"},children:"(?)"})]}),Ut.jsx("textarea",{readOnly:!0,value:u||'Click "Generate" to create a prompt from your settings...',style:{width:"100%",minHeight:"150px",padding:"0.75rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-medium)",color:u?"var(--text-primary)":"var(--text-muted)",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",flex:1}}),Ut.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[Ut.jsx("button",{className:"secondary",onClick:Ne,disabled:!u,title:"Copy simple prompt to clipboard",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--border-medium)",backgroundColor:"var(--bg-elevated)",color:"var(--text-secondary)",cursor:u?"pointer":"not-allowed",transition:"all 0.15s ease"},children:"Copy Simple Prompt"}),Ut.jsx("button",{className:"secondary",onClick:()=>M(u),disabled:!u,title:"Send this prompt to the Storyboard panel",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--accent-primary)",backgroundColor:"var(--accent-primary)",color:"white",cursor:u?"pointer":"not-allowed",transition:"all 0.15s ease",opacity:u?1:.5},children:" Send to Storyboard"})]})]}),Ut.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[Ut.jsxs("label",{style:{display:"block",fontSize:"0.75rem",color:"var(--text-muted)"},title:"Your prompt enhanced by AI with professional cinematography language.",children:["AI-Enhanced Prompt ",Ut.jsx("span",{style:{cursor:"help"},children:"(?)"})]}),Ut.jsx("textarea",{readOnly:!0,value:ae||'Click "Enhance with AI" to generate an enhanced prompt...',style:{width:"100%",minHeight:"150px",padding:"0.75rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-medium)",color:ae?"var(--text-primary)":"var(--text-muted)",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",flex:1}}),Ut.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[Ut.jsx("button",{className:"secondary",onClick:()=>navigator.clipboard.writeText(ae),disabled:!ae,title:"Copy enhanced prompt to clipboard",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--border-medium)",backgroundColor:"var(--bg-elevated)",color:"var(--text-secondary)",cursor:ae?"pointer":"not-allowed",transition:"all 0.15s ease"},children:"Copy Enhanced Prompt"}),Ut.jsx("button",{className:"secondary",onClick:()=>M(ae),disabled:!ae,title:"Send this prompt to the Storyboard panel",style:{padding:"0.5rem 1rem",fontSize:"0.8rem",fontWeight:500,borderRadius:"5px",border:"1px solid var(--accent-primary)",backgroundColor:"var(--accent-primary)",color:"white",cursor:ae?"pointer":"not-allowed",transition:"all 0.15s ease",opacity:ae?1:.5},children:" Send to Storyboard"})]})]})]}),Ut.jsxs("div",{style:{marginBottom:"1rem"},children:[Ut.jsx("label",{style:{display:"block",fontSize:"0.75rem",color:"var(--text-muted)",marginBottom:"0.25rem"},children:"Negative Prompt"}),Ut.jsx("textarea",{readOnly:!0,value:d||"Generated negative prompt will appear here...",style:{width:"100%",minHeight:"50px",padding:"0.75rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid var(--border-subtle)",backgroundColor:"var(--bg-medium)",color:d?"var(--text-primary)":"var(--text-muted)",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box"}})]}),se.length>0&&Ut.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-primary)",marginBottom:"0.75rem",padding:"0.5rem",backgroundColor:"rgba(245, 158, 11, 0.12)",borderRadius:"4px",border:"1px solid rgba(245, 158, 11, 0.35)"},children:[Ut.jsx("strong",{children:"Note:"}),Ut.jsx("ul",{style:{margin:"0.35rem 0 0 1rem"},children:se.map((e,t)=>Ut.jsx("li",{children:e},t))})]}),ie&&Ut.jsx("p",{style:{fontSize:"0.8rem",color:"var(--error)",marginBottom:"0.75rem",padding:"0.5rem",backgroundColor:"rgba(239, 68, 68, 0.1)",borderRadius:"4px"},children:ie}),0===Q.length&&Ut.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"0.75rem",textAlign:"center",padding:"0.5rem",backgroundColor:"var(--bg-medium)",borderRadius:"4px"},children:"Click the gear icon to configure an AI provider for prompt enhancement"})]}),Ut.jsxs("div",{className:"mode-toggle",children:[Ut.jsx("button",{className:"live_action"===e?"active":"",onClick:()=>t("live_action"),children:"Live-Action Cinema"}),Ut.jsx("button",{className:"animation"===e?"active":"",onClick:()=>t("animation"),children:"Animation"})]}),Ut.jsxs("div",{className:`preset-panel ${fe?"open":"collapsed"} ${be?"resizing":""}`,style:{width:fe?ve:40},ref:we,onMouseDown:Pe,children:[Ut.jsx("div",{className:"panel-resize-handle",onMouseDown:Te,onPointerDown:Te}),Ut.jsx("button",{className:"panel-collapse-toggle",onClick:()=>ge(!fe),title:fe?"Collapse panel":"Expand panel",children:Ut.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:Ut.jsx("path",{d:"M10 4L6 8L10 12"})})}),Ut.jsxs("div",{className:"panel-header",children:[Ut.jsx("h2",{children:"live_action"===e?"Film Presets":"Animation Presets"}),(f||g)&&Ut.jsx("button",{className:"clear-preset-btn",onClick:w,children:"Clear"})]}),Ut.jsxs("div",{className:"panel-tabs",children:[Ut.jsx("button",{className:"browser"===_e?"active":"",onClick:()=>xe("browser"),children:"Browser"}),Ut.jsx("button",{className:"info"===_e?"active":"",onClick:()=>xe("info"),children:"Info"})]}),Ut.jsxs("div",{className:"panel-tab-content",children:["browser"===_e&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("div",{className:"preset-search",children:Ut.jsx("input",{type:"text",placeholder:`Search ${"live_action"===e?"film":"animation"} presets...`,value:L,onChange:e=>I(e.target.value)})}),Ut.jsx("div",{className:"preset-list",children:T?Ut.jsx("div",{className:"loading",children:"Loading presets..."}):"live_action"===e?v.filter(e=>!L||e.name.toLowerCase().includes(L.toLowerCase())||e.era.toLowerCase().includes(L.toLowerCase())).map(e=>Ut.jsxs("button",{className:"preset-item "+((null==f?void 0:f.id)===e.id?"selected":""),onClick:()=>ke(e.id),disabled:k,children:[zg(e.id)&&Ut.jsx("div",{className:"preset-item-thumbnail",children:Ut.jsx("img",{src:zg(e.id),alt:"",onError:e=>{e.target.parentElement.style.display="none"}})}),Ut.jsxs("div",{className:"preset-item-info",children:[Ut.jsx("span",{className:"preset-item-name",children:e.name}),Ut.jsxs("span",{className:"preset-item-meta",children:[e.year,"  ",e.era]})]})]},e.id)):y.filter(e=>!L||e.name.toLowerCase().includes(L.toLowerCase())||e.domain.toLowerCase().includes(L.toLowerCase())).map(e=>Ut.jsxs("button",{className:"preset-item "+((null==g?void 0:g.id)===e.id?"selected":""),onClick:()=>ke(e.id),disabled:k,children:[zg(e.id)&&Ut.jsx("div",{className:"preset-item-thumbnail",children:Ut.jsx("img",{src:zg(e.id),alt:"",onError:e=>{e.target.parentElement.style.display="none"}})}),Ut.jsxs("div",{className:"preset-item-info",children:[Ut.jsx("span",{className:"preset-item-name",children:e.name}),Ut.jsxs("span",{className:"preset-item-meta",children:[e.domain,"  ",e.medium]})]})]},e.id))})]}),"info"===_e&&Ut.jsx(Ut.Fragment,{children:"live_action"===e&&f?Ut.jsxs("div",{className:"active-preset",children:[Ut.jsxs("div",{className:"active-preset-content",children:[Ut.jsxs("div",{className:"preset-info",children:[Ut.jsx("div",{className:"preset-name",children:f.name}),Ut.jsxs("div",{className:"preset-meta",children:[f.year,"  ",f.era]}),f.disallowed_moods.length>0&&Ut.jsxs("div",{className:"preset-constraints",children:[Ut.jsx("span",{className:"constraint-label",children:"Disallowed moods:"}),Ut.jsx("span",{className:"constraint-values",children:f.disallowed_moods.join(", ")})]})]}),zg(f.id)&&Ut.jsx("div",{className:"preset-image-preview",children:Ut.jsx("img",{src:zg(f.id),alt:`${f.name} frame`,onError:e=>{e.target.style.display="none"}})})]}),U&&Ut.jsx("div",{className:"cinematography-loading",children:"Loading cinematography details..."}),j&&Ut.jsxs("div",{className:"cinematography-details",children:[Ut.jsxs("div",{className:"cinematography-header",children:[Ut.jsx("span",{className:"cinematography-label",children:"Cinematographer"}),Ut.jsx("span",{className:"cinematography-value cinematographer-name",children:j.cinematographer})]}),Ut.jsxs("div",{className:"cinematography-grid",children:[Ut.jsxs("div",{className:"cinematography-item",children:[Ut.jsx("span",{className:"item-label",children:"Camera"}),Ut.jsx("span",{className:"item-value",children:j.camera})]}),Ut.jsxs("div",{className:"cinematography-item",children:[Ut.jsx("span",{className:"item-label",children:"Film Stock"}),Ut.jsx("span",{className:"item-value",children:j.film_stock})]}),Ut.jsxs("div",{className:"cinematography-item",children:[Ut.jsx("span",{className:"item-label",children:"Aspect Ratio"}),Ut.jsx("span",{className:"item-value",children:j.aspect_ratio})]}),Ut.jsxs("div",{className:"cinematography-item",children:[Ut.jsx("span",{className:"item-label",children:"Lenses"}),Ut.jsx("span",{className:"item-value",children:j.lens_info})]})]}),Ut.jsxs("div",{className:"cinematography-section",children:[Ut.jsx("span",{className:"section-label",children:"Lighting Signature"}),Ut.jsx("span",{className:"section-value",children:j.lighting_signature})]}),Ut.jsxs("div",{className:"cinematography-section",children:[Ut.jsx("span",{className:"section-label",children:"Color Palette"}),Ut.jsx("span",{className:"section-value",children:j.color_palette})]}),Ut.jsxs("div",{className:"cinematography-section",children:[Ut.jsx("span",{className:"section-label",children:"Notable Techniques"}),Ut.jsx("span",{className:"section-value",children:j.notable_techniques})]}),Ut.jsxs("div",{className:"cinematography-section",children:[Ut.jsx("span",{className:"section-label",children:"Movement Style"}),Ut.jsx("span",{className:"section-value",children:j.movement_style})]}),j.legacy&&Ut.jsxs("div",{className:"cinematography-section cinematography-legacy",children:[Ut.jsx("span",{className:"section-label",children:"Legacy & Influence"}),Ut.jsx("span",{className:"section-value",children:j.legacy})]})]})]}):"animation"===e&&g?Ut.jsx("div",{className:"active-preset",children:Ut.jsxs("div",{className:"active-preset-content",children:[Ut.jsxs("div",{className:"preset-info",children:[Ut.jsx("div",{className:"preset-name",children:g.name}),Ut.jsxs("div",{className:"preset-meta",children:[g.domain,"  ",g.medium]}),g.line_treatment&&Ut.jsxs("div",{className:"preset-detail",children:[Ut.jsx("span",{className:"detail-label",children:"Line Treatment:"}),Ut.jsx("span",{className:"detail-value",children:g.line_treatment.replace(/_/g," ")})]}),g.color_application&&Ut.jsxs("div",{className:"preset-detail",children:[Ut.jsx("span",{className:"detail-label",children:"Color:"}),Ut.jsx("span",{className:"detail-value",children:g.color_application.replace(/_/g," ")})]}),g.lighting_model&&Ut.jsxs("div",{className:"preset-detail",children:[Ut.jsx("span",{className:"detail-label",children:"Lighting:"}),Ut.jsx("span",{className:"detail-value",children:g.lighting_model.replace(/_/g," ")})]}),g.motion_style&&Ut.jsxs("div",{className:"preset-detail",children:[Ut.jsx("span",{className:"detail-label",children:"Motion:"}),Ut.jsx("span",{className:"detail-value",children:g.motion_style.replace(/_/g," ")})]}),g.reference_works&&g.reference_works.length>0&&Ut.jsxs("div",{className:"preset-detail",children:[Ut.jsx("span",{className:"detail-label",children:"Reference:"}),Ut.jsx("span",{className:"detail-value",children:g.reference_works.slice(0,2).join(", ")})]}),g.disallowed_motion.length>0&&Ut.jsxs("div",{className:"preset-constraints",children:[Ut.jsx("span",{className:"constraint-label",children:"Disallowed motion:"}),Ut.jsx("span",{className:"constraint-values",children:g.disallowed_motion.join(", ")})]})]}),zg(g.id)&&Ut.jsx("div",{className:"preset-image-preview",children:Ut.jsx("img",{src:zg(g.id),alt:`${g.name} frame`,onError:e=>{e.target.style.display="none"}})})]})}):Ut.jsx("div",{style:{textAlign:"center",color:"var(--text-muted)",padding:"2rem",fontSize:"0.85rem"},children:"Select a preset from the Browser tab to view details"})})]})]}),Ut.jsx("div",{className:"config-panel",children:"live_action"===e?Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Camera"}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:"Choose between digital cinema cameras or traditional film cameras",children:"Camera Type"}),Ut.jsx("select",{value:n.camera.camera_type||"Digital",onChange:e=>{const t=e.target.value,n=("Digital"===t?of.camera_manufacturer:of.camera_manufacturer_film)[0];o("camera",{camera_type:t,manufacturer:n,body:(pf[n]||[])[0]||"",film_stock:"Film"===t?"Kodak_Vision3_500T_5219":"None"})},children:G("camera.camera_type",of.camera_type.map(e=>({value:e,disabled:!1}))).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:ng,children:"Manufacturer"}),Ut.jsx("select",{value:n.camera.manufacturer,onChange:e=>{const t=e.target.value,n=pf[t]||[];n.length>0?o("camera",{manufacturer:t,body:n[0]}):o("camera",{manufacturer:t})},children:G("camera.manufacturer",("Film"===n.camera.camera_type?of.camera_manufacturer_film:of.camera_manufacturer).map(e=>{var t;return{value:e,disabled:!1,description:null==(t=If)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:ig,children:"Body"}),Ut.jsx("select",{value:n.camera.body,onChange:e=>o("camera",{body:e.target.value}),children:G("camera.body",Cg(n.camera.manufacturer,n.camera.camera_type||"Digital")).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:uf[e.value]||e.value.replace(/_/g," ")},e.value))})]}),"Film"===n.camera.camera_type&&Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:"Film stock determines the visual character - color rendition, grain, and latitude",children:"Film Stock"}),Ut.jsxs("select",{value:n.camera.film_stock||"",onChange:e=>o("camera",{film_stock:e.target.value}),children:[Ut.jsx("option",{value:"",children:"Select Film Stock..."}),G("camera.film_stock",(De=n.camera.body,De.startsWith("IMAX_")?of.film_stock_imax:"Super_Panavision_70"===De||"Ultra_Panavision_70"===De||"Mitchell_BFC_65"===De?of.film_stock_65mm:of.film_stock).map(e=>({value:e,disabled:!1}))).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))]})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:"Aspect ratio determines the frame shape - wider ratios are more cinematic",children:"Aspect Ratio"}),Ut.jsx("select",{value:n.camera.aspect_ratio||"1.85:1",onChange:e=>o("camera",{aspect_ratio:e.target.value}),children:G("camera.aspect_ratio",jg(n.camera.body).map(e=>({value:e,disabled:!1}))).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Lens"}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:rg,children:"Manufacturer"}),Ut.jsx("select",{value:n.lens.manufacturer,onChange:e=>{const t=e.target.value,n=Af[t]||[];n.length>0?o("lens",{manufacturer:t,family:n[0]}):o("lens",{manufacturer:t})},children:G("lens.manufacturer",of.lens_manufacturer.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=jf)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:ag,children:["Lens Family",Lf(n.camera.body)&&Ut.jsxs("span",{className:"field-hint",children:["(",Lf(n.camera.body),")"]})]}),Ut.jsx("select",{value:n.lens.family,onChange:e=>o("lens",{family:e.target.value}),children:G("lens.family",Lg(n.camera.body,n.lens.manufacturer)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:df[e.value]||e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:og,children:["Focal Length (mm)",n.lens.family&&Ut.jsxs("span",{className:"field-hint",children:["(available for ",df[n.lens.family]||n.lens.family.replace(/_/g," "),")"]})]}),Ut.jsx("select",{value:n.lens.focal_length_mm,onChange:e=>o("lens",{focal_length_mm:parseInt(e.target.value,10)}),children:G("lens.focal_length_mm",Ig(n.lens.family)).map(e=>Ut.jsxs("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:[e.value,"mm"]},e.value))})]}),Ut.jsx("div",{className:"field",children:Ut.jsxs("label",{title:sg,children:[Ut.jsx("input",{type:"checkbox",checked:n.lens.is_anamorphic,onChange:e=>{if(e.target.checked){const e={Panavision:"Panavision_C_Series",Kowa:"Kowa_Anamorphic",Vintage:"Vintage_Anamorphic"},t=n.lens.manufacturer;e[t]?o("lens",{is_anamorphic:!0,family:e[t]}):o("lens",{is_anamorphic:!0,manufacturer:"Panavision",family:"Panavision_C_Series"})}else{const e=n.lens.manufacturer,t=Af[e]||[],i=t.find(e=>!e.toLowerCase().includes("anamorphic"))||t[0]||"ARRI_Signature_Prime";o("lens",{is_anamorphic:!1,family:i})}}})," ","Anamorphic"]})})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Movement"}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:lg,children:["Equipment","Heavy"===hf[n.camera.body]&&Ut.jsx("span",{className:"field-hint",children:"(limited by camera weight)"}),"Dolly_Zoom"===n.movement.movement_type&&Ut.jsx("span",{className:"field-hint",children:"(Dolly Zoom requires Dolly/Slider)"})]}),Ut.jsx("select",{value:n.movement.equipment,onChange:e=>{const t=e.target.value,i=ff[t]||of.movement_type;if("Static"===t)return void o("movement",{equipment:"Static",movement_type:"Static",timing:"Static"});const r=i.includes(n.movement.movement_type);o("movement",r?{equipment:t}:{equipment:t,movement_type:i[0]||"Static"})},children:G("movement.equipment",Tg(n.camera.body,n.movement.movement_type)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:cg,children:["Movement Type ",Ut.jsx("span",{className:"field-hint",children:"(filtered by equipment)"})]}),Ut.jsx("select",{value:n.movement.movement_type,onChange:e=>{const t=e.target.value,i=vf[t];i&&!i.includes(n.movement.timing)?o("movement",{movement_type:t,timing:"Moderate"}):o("movement",{movement_type:t})},children:G("movement.movement_type",Pg(n.movement.equipment)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:ug,children:["Timing","Dolly_Zoom"===n.movement.movement_type&&Ut.jsx("span",{className:"field-hint",children:"(Dolly Zoom requires slower timing)"})]}),Ut.jsx("select",{value:n.movement.timing,onChange:e=>o("movement",{timing:e.target.value}),children:G("movement.timing",Ng(n.movement.movement_type)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Lighting"}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:dg,children:"Time of Day"}),Ut.jsx("select",{value:n.lighting.time_of_day,onChange:e=>{const t=e.target.value,i=yf[t],r=n.lighting.source,a=xf[t],s=n.lighting.style,l={time_of_day:t};i&&!i.includes(r)&&(l.source=i[0]),a&&!a.includes(s)&&(l.style=a[0]),o("lighting",l)},children:of.time_of_day.map(e=>{var t;return Ut.jsx("option",{value:e,title:(null==(t=zf)?void 0:t[e])||"",children:e.replace(/_/g," ")},e)})})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:hg,children:["Source",Ut.jsx("span",{className:"field-hint",children:f?f.year<2002?"(filtered by time + preset + era)":f.disallowed_sources.length>0?"(filtered by time + preset)":"(filtered by time)":"(filtered by time)"})]}),Ut.jsx("select",{value:n.lighting.source,onChange:e=>o("lighting",{source:e.target.value}),children:G("lighting.source",kg(n.lighting.time_of_day,(null==f?void 0:f.disallowed_sources)||[],null==f?void 0:f.year,null==f?void 0:f.name)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:pg,children:["Style ",Ut.jsx("span",{className:"field-hint",children:"(filtered by time & mood)"})]}),Ut.jsx("select",{value:n.lighting.style,onChange:e=>o("lighting",{style:e.target.value}),children:G("lighting.style",Ag(n.lighting.time_of_day,n.visual_grammar.mood)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Visual Grammar"}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:mg,children:["Shot Size",Ef(n.lens.focal_length_mm,n.visual_grammar.shot_size)&&Ut.jsxs("span",{className:"field-hint warning",children:["(",Ef(n.lens.focal_length_mm,n.visual_grammar.shot_size),")"]})]}),Ut.jsx("select",{value:n.visual_grammar.shot_size,onChange:e=>o("visual_grammar",{shot_size:e.target.value}),children:of.shot_size.map(e=>{var t;return Ut.jsx("option",{value:e,title:(null==(t=Vf)?void 0:t[e])||"",children:cf[e]||e},e)})})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:fg,children:"Composition"}),Ut.jsx("select",{value:n.visual_grammar.composition,onChange:e=>o("visual_grammar",{composition:e.target.value}),children:G("visual_grammar.composition",of.composition.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Wf)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:gg,children:["Mood",f&&f.disallowed_moods.length>0&&Ut.jsx("span",{className:"field-hint",children:"(filtered by preset)"})]}),Ut.jsx("select",{value:n.visual_grammar.mood,onChange:e=>{var t;const i=e.target.value,r=bf[i];if(null==r?void 0:r.disallowed.includes(n.lighting.style)){const e=of.lighting_style.filter(e=>!r.disallowed.includes(e)),n=(null==(t=r.preferred)?void 0:t.find(t=>e.includes(t)))||e[0]||"High_Key";o("visual_grammar",{mood:i}),o("lighting",{style:n})}else o("visual_grammar",{mood:i})},children:G("visual_grammar.mood",(Ie=(null==f?void 0:f.disallowed_moods)||[],je=null==f?void 0:f.name,of.mood.map(e=>{var t;const n=null==(t=Gf)?void 0:t[e];return Ie.includes(e)?{value:e,disabled:!0,reason:` "${e}" conflicts with ${je||"preset"}'s visual languagewould create tonal dissonance.`,description:n}:{value:e,disabled:!1,description:n}}))).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:vg,children:"Color Tone"}),Ut.jsx("select",{value:n.visual_grammar.color_tone,onChange:e=>o("visual_grammar",{color_tone:e.target.value}),children:of.color_tone.map(e=>{var t;return Ut.jsx("option",{value:e,title:(null==(t=$f)?void 0:t[e])||"",children:e.replace(/_/g," ")},e)})})]})]})]}):Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Style"}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:yg,children:"Medium"}),Ut.jsx("select",{value:i.medium,onChange:e=>s("medium",e.target.value),children:G("medium",of.animation_medium.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=qf)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:_g,children:"Style Domain"}),Ut.jsx("select",{value:i.style_domain,onChange:e=>{var t,n,r,a;const o=e.target.value,l=Sf[o],c={};if(null==(t=null==l?void 0:l.disallowed_colors)?void 0:t.includes(i.rendering.color_application)){const e=of.color_application.filter(e=>{var t;return!(null==(t=l.disallowed_colors)?void 0:t.includes(e))});c.rendering={...i.rendering,color_application:e[0]||"Monochrome_Ink"}}if((null==(n=null==l?void 0:l.disallowed_motion)?void 0:n.includes(i.motion.motion_style))&&(c.motion={...i.motion,motion_style:"None"}),(null==(r=null==l?void 0:l.disallowed_cameras)?void 0:r.includes(i.motion.virtual_camera))&&(c.motion={...c.motion||i.motion,virtual_camera:"Locked"}),(null==l?void 0:l.required_lighting)&&!l.required_lighting.includes(i.rendering.lighting_model))c.rendering={...c.rendering||i.rendering,lighting_model:l.required_lighting[0]};else if(null==(a=null==l?void 0:l.disallowed_lighting)?void 0:a.includes(i.rendering.lighting_model)){const e=of.lighting_model.filter(e=>{var t;return!(null==(t=l.disallowed_lighting)?void 0:t.includes(e))});c.rendering={...c.rendering||i.rendering,lighting_model:e[0]||"Cel_Shaded"}}s("style_domain",o),c.rendering&&s("rendering",c.rendering),c.motion&&s("motion",c.motion)},children:G("style_domain",of.style_domain.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Kf)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Rendering"}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:xg,children:"Line Treatment"}),Ut.jsx("select",{value:i.rendering.line_treatment,onChange:e=>s("rendering",{line_treatment:e.target.value}),children:G("rendering.line_treatment",of.line_treatment.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Yf)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:bg,children:["Color Application ","Manga"===i.style_domain&&Ut.jsx("span",{className:"field-hint",children:"(Manga: Monochrome only)"})]}),Ut.jsx("select",{value:i.rendering.color_application,onChange:e=>s("rendering",{color_application:e.target.value}),children:G("rendering.color_application",Dg(i.style_domain)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:Sg,children:["Lighting Model","Manga"===i.style_domain&&Ut.jsx("span",{className:"field-hint",children:"(Manga: Graphic only)"}),"ThreeD"===i.style_domain&&Ut.jsx("span",{className:"field-hint",children:"(3D: No Flat lighting)"})]}),Ut.jsx("select",{value:i.rendering.lighting_model,onChange:e=>s("rendering",{lighting_model:e.target.value}),children:G("rendering.lighting_model",Fg(i.style_domain)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:wg,children:"Surface Detail"}),Ut.jsx("select",{value:i.rendering.surface_detail,onChange:e=>s("rendering",{surface_detail:e.target.value}),children:G("rendering.surface_detail",of.surface_detail.map(e=>{var t;return{value:e,disabled:!1,description:null==(t=Qf)?void 0:t[e]}})).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Motion"}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:Mg,children:["Motion Style ",("Manga"===i.style_domain||"Illustration"===i.style_domain)&&Ut.jsx("span",{className:"field-hint",children:"(static only)"})]}),Ut.jsx("select",{value:i.motion.motion_style,onChange:e=>s("motion",{motion_style:e.target.value}),children:G("motion.motion_style",Og(i.style_domain)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value},e.value))})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsxs("label",{title:Eg,children:["Virtual Camera",Ut.jsxs("span",{className:"field-hint",children:["(filtered by domain/medium","None"===i.motion.motion_style?"/motion":"",")"]})]}),Ut.jsx("select",{value:i.motion.virtual_camera,onChange:e=>s("motion",{virtual_camera:e.target.value}),children:G("motion.virtual_camera",Ug(i.style_domain,i.medium,i.motion.motion_style)).map(e=>Ut.jsx("option",{value:e.value,title:Bg(e),disabled:e.disabled,children:e.value.replace(/_/g," ")},e.value))})]})]}),Ut.jsxs("div",{className:"section",children:[Ut.jsx("h2",{children:"Visual Grammar"}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:mg,children:"Shot Size"}),Ut.jsx("select",{value:i.visual_grammar.shot_size,onChange:e=>s("visual_grammar",{shot_size:e.target.value}),children:of.shot_size.map(e=>{var t;return Ut.jsx("option",{value:e,title:(null==(t=Vf)?void 0:t[e])||"",children:cf[e]||e},e)})})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:gg,children:"Mood"}),Ut.jsx("select",{value:i.visual_grammar.mood,onChange:e=>s("visual_grammar",{mood:e.target.value}),children:Rg((null==g?void 0:g.mood)||[],null==g?void 0:g.name).map(e=>{var t;return Ut.jsxs("option",{value:e.value,title:Bg(e),children:[e.value,(null==(t=null==g?void 0:g.mood)?void 0:t.includes(e.value))?" ":""]},e.value)})})]}),Ut.jsxs("div",{className:"field",children:[Ut.jsx("label",{title:vg,children:"Color Tone"}),Ut.jsx("select",{value:i.visual_grammar.color_tone,onChange:e=>s("visual_grammar",{color_tone:e.target.value}),children:of.color_tone.map(e=>{var t;return Ut.jsx("option",{value:e,title:(null==(t=$f)?void 0:t[e])||"",children:e.replace(/_/g," ")},e)})})]})]})]})})]});var Ie,je,De}const Gg=[{label:"Free",ratio:null},{label:"1:1",ratio:1},{label:"4:3",ratio:4/3},{label:"16:9",ratio:16/9},{label:"2.35:1",ratio:2.35},{label:"9:16",ratio:9/16},{label:"3:4",ratio:3/4}];function $g({imageData:e,mode:t,initialMask:n,initialCrop:i,initialPaint:r,onSave:a,onCancel:o}){const[s,l]=Pt.useState(t),[c,u]=Pt.useState(null),[d,h]=Pt.useState({x:0,y:0,width:0,height:0}),[p,m]=Pt.useState(!1),[f,g]=Pt.useState({x:0,y:0}),[v,y]=Pt.useState(!1),[_,x]=Pt.useState(!1),[b,S]=Pt.useState(null),[w,M]=Pt.useState({x:0,y:0}),[E,C]=Pt.useState({x:0,y:0,width:0,height:0}),[T,P]=Pt.useState(!1),[k,A]=Pt.useState(20),[N,R]=Pt.useState(.8),[L,I]=Pt.useState("add"),[j,D]=Pt.useState(!1),[U,O]=Pt.useState("#ff0000"),[F,z]=Pt.useState(15),[B,H]=Pt.useState("paint"),[V,W]=Pt.useState(null),G=Pt.useRef(null),$=Pt.useRef(null),X=Pt.useRef(null),q=Pt.useRef(null),K=Pt.useRef(null),Y=Pt.useRef(null),Z=Pt.useRef(null),[J,Q]=Pt.useState({width:0,height:0}),[ee,te]=Pt.useState(1),ne=Pt.useCallback(()=>{const e=X.current;if(!e)return;const t=G.current;if(!t)return;const a=t.clientWidth-40,o=t.clientHeight-40,s=e.naturalWidth/e.naturalHeight;let l,c;s>a/o?(l=a,c=a/s):(c=o,l=o*s),Q({width:l,height:c});const u=l/e.naturalWidth;te(u),h(i?{x:i.x*l,y:i.y*c,width:i.width*l,height:i.height*c}:{x:0,y:0,width:l,height:c});const d=q.current;if(d){d.width=e.naturalWidth,d.height=e.naturalHeight;const t=d.getContext("2d");if(t&&(t.fillStyle="black",t.fillRect(0,0,d.width,d.height),n)){const e=new Image;e.onload=()=>{t.drawImage(e,0,0,d.width,d.height);const n=K.current;if(n){const e=n.getContext("2d");if(e){const i=t.getImageData(0,0,d.width,d.height),r=e.createImageData(n.width,n.height);for(let e=0;e<n.height;e++)for(let t=0;t<n.width;t++){const a=Math.floor(t/u),o=4*(Math.floor(e/u)*d.width+a),s=4*(e*n.width+t),l=i.data[o];l>0&&(r.data[s]=255,r.data[s+1]=50,r.data[s+2]=50,r.data[s+3]=Math.floor(.8*l))}e.putImageData(r,0,0)}}},e.src=n}}const p=K.current;p&&(p.width=l,p.height=c);const m=Y.current;if(m){m.width=e.naturalWidth,m.height=e.naturalHeight;const t=m.getContext("2d");if(t&&(t.clearRect(0,0,m.width,m.height),r)){const e=new Image;e.onload=()=>{t.drawImage(e,0,0,m.width,m.height);const n=Z.current;if(n){const t=n.getContext("2d");t&&(t.clearRect(0,0,n.width,n.height),t.drawImage(e,0,0,n.width,n.height))}},e.src=r}}const f=Z.current;f&&(f.width=l,f.height=c)},[n,i,r]),ie=Pt.useCallback(e=>{const t=$.current;if(!t)return{x:0,y:0};const n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},[]),re=Pt.useCallback(e=>{e.preventDefault();const t=ie(e),n=t.x>=d.x-10&&t.x<=d.x+10&&t.y>=d.y-10&&t.y<=d.y+10,i=t.x>=d.x+d.width-10&&t.x<=d.x+d.width+10&&t.y>=d.y-10&&t.y<=d.y+10,r=t.x>=d.x-10&&t.x<=d.x+10&&t.y>=d.y+d.height-10&&t.y<=d.y+d.height+10,a=t.x>=d.x+d.width-10&&t.x<=d.x+d.width+10&&t.y>=d.y+d.height-10&&t.y<=d.y+d.height+10;n?(x(!0),S("tl"),C(d),g(t)):i?(x(!0),S("tr"),C(d),g(t)):r?(x(!0),S("bl"),C(d),g(t)):a?(x(!0),S("br"),C(d),g(t)):t.x>=d.x&&t.x<=d.x+d.width&&t.y>=d.y&&t.y<=d.y+d.height&&d.width>10?(y(!0),M(t),C(d)):(m(!0),g(t),h({x:t.x,y:t.y,width:0,height:0}))},[d,ie]),ae=Pt.useCallback(e=>{const t=ie(e);if(p){let e=t.x-f.x,n=t.y-f.y;if(null!==c){const t=Math.abs(e),i=Math.abs(n);t/c>i?n=n>0?t/c:-t/c:e=e>0?i*c:-i*c}h({x:e<0?f.x+e:f.x,y:n<0?f.y+n:f.y,width:Math.abs(e),height:Math.abs(n)})}else if(v){const e=t.x-w.x,n=t.y-w.y;let i=Math.max(0,Math.min(E.x+e,J.width-E.width)),r=Math.max(0,Math.min(E.y+n,J.height-E.height));h({x:i,y:r,width:E.width,height:E.height})}else if(_&&b){let e=E.x,n=E.y,i=E.width,r=E.height;switch(b){case"br":i=t.x-E.x,r=t.y-E.y;break;case"tr":i=t.x-E.x,r=E.y+E.height-t.y,n=t.y;break;case"bl":i=E.x+E.width-t.x,r=t.y-E.y,e=t.x;break;case"tl":i=E.x+E.width-t.x,r=E.y+E.height-t.y,e=t.x,n=t.y}null!==c&&("br"===b||"tl"===b?(r=i/c,"tl"===b&&(n=E.y+E.height-r)):(r=i/c,"tr"===b&&(n=E.y+E.height-r))),i>10&&r>10&&(e=Math.max(0,Math.min(e,J.width-10)),n=Math.max(0,Math.min(n,J.height-10)),i=Math.min(i,J.width-e),r=Math.min(r,J.height-n),h({x:e,y:n,width:i,height:r}))}},[p,v,_,b,f,w,E,c,J,ie]),oe=Pt.useCallback(()=>{m(!1),y(!1),x(!1),S(null)},[]),se=Pt.useCallback(e=>{const t=K.current;if(!t)return null;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;return{x:i/ee,y:r/ee}},[ee]),le=Pt.useCallback(e=>{const t=se(e);if(!t)return;const n=K.current,i=q.current;if(!n||!i)return;const r=n.getContext("2d"),a=i.getContext("2d");if(!r||!a)return;const o=t.x*ee,s=t.y*ee,l=k;"add"===L?(r.beginPath(),r.arc(o,s,l/2,0,2*Math.PI),r.fillStyle=`rgba(255, 50, 50, ${N})`,r.fill(),a.beginPath(),a.arc(t.x,t.y,k/ee/2,0,2*Math.PI),a.fillStyle="white",a.fill()):(r.globalCompositeOperation="destination-out",r.beginPath(),r.arc(o,s,l/2,0,2*Math.PI),r.fill(),r.globalCompositeOperation="source-over",a.beginPath(),a.arc(t.x,t.y,k/ee/2,0,2*Math.PI),a.fillStyle="black",a.fill())},[se,k,N,L,ee]),ce=Pt.useCallback(e=>{e.preventDefault(),P(!0),le(e)},[le]),ue=Pt.useCallback(e=>{T&&le(e)},[T,le]),de=Pt.useCallback(()=>{P(!1)},[]),he=Pt.useCallback(e=>{const t=Z.current;if(!t)return null;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;return{x:i/ee,y:r/ee}},[ee]),pe=Pt.useCallback((e,t)=>{const n=Y.current,i=Z.current;if(!n||!i)return;const r=n.getContext("2d"),a=i.getContext("2d");if(!r||!a)return;const o=F/ee;if("paint"===B){r.lineCap="round",r.lineJoin="round",r.lineWidth=o,r.strokeStyle=U,r.fillStyle=U,e?(r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(t.x,t.y),r.stroke()):(r.beginPath(),r.arc(t.x,t.y,o/2,0,2*Math.PI),r.fill()),a.lineCap="round",a.lineJoin="round",a.lineWidth=F,a.strokeStyle=U,a.fillStyle=U;const n=e?{x:e.x*ee,y:e.y*ee}:null,i={x:t.x*ee,y:t.y*ee};n?(a.beginPath(),a.moveTo(n.x,n.y),a.lineTo(i.x,i.y),a.stroke()):(a.beginPath(),a.arc(i.x,i.y,F/2,0,2*Math.PI),a.fill())}else{r.globalCompositeOperation="destination-out",r.lineCap="round",r.lineJoin="round",r.lineWidth=o,e?(r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(t.x,t.y),r.stroke()):(r.beginPath(),r.arc(t.x,t.y,o/2,0,2*Math.PI),r.fill()),r.globalCompositeOperation="source-over",a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineJoin="round",a.lineWidth=F;const n=e?{x:e.x*ee,y:e.y*ee}:null,i={x:t.x*ee,y:t.y*ee};n?(a.beginPath(),a.moveTo(n.x,n.y),a.lineTo(i.x,i.y),a.stroke()):(a.beginPath(),a.arc(i.x,i.y,F/2,0,2*Math.PI),a.fill()),a.globalCompositeOperation="source-over"}},[F,B,U,ee]),me=Pt.useCallback(e=>{e.preventDefault();const t=he(e);t&&(D(!0),W(t),pe(null,t))},[he,pe]),fe=Pt.useCallback(e=>{if(!j)return;const t=he(e);t&&(pe(V,t),W(t))},[j,he,V,pe]),ge=Pt.useCallback(()=>{D(!1),W(null)},[]),ve=Pt.useCallback(()=>{const e=Y.current,t=Z.current;if(!e||!t)return;const n=e.getContext("2d"),i=t.getContext("2d");n&&i&&(n.clearRect(0,0,e.width,e.height),i.clearRect(0,0,t.width,t.height))},[]),ye=Pt.useCallback(()=>Math.abs(d.x)<2&&Math.abs(d.y)<2&&Math.abs(d.width-J.width)<2&&Math.abs(d.height-J.height)<2,[d,J]),_e=Pt.useCallback(()=>{const e=X.current,t=q.current,n=Y.current;if(!e)return console.error("[CropMaskEditor] No image ref"),void o();const i=!ye(),r=!!t&&function(e){const t=e.getContext("2d");if(!t)return!1;const n=t.getImageData(0,0,e.width,e.height).data;for(let i=0;i<n.length;i+=4)if(n[i]>0)return!0;return!1}(t),s=!!n&&function(e){const t=e.getContext("2d");if(!t)return!1;const n=t.getImageData(0,0,e.width,e.height).data;for(let i=3;i<n.length;i+=4)if(n[i]>0)return!0;return!1}(n);if(console.log("[CropMaskEditor] handleSave - hasPaint:",s,"hasMask:",r,"hasCrop:",i),console.log("[CropMaskEditor] handleSave - cropRect:",d),console.log("[CropMaskEditor] handleSave - imageSize:",J),!i&&!r&&!s)return console.log("[CropMaskEditor] No changes detected, closing without saving"),void a(null,null,null,null);const l=i?{x:d.x/J.width,y:d.y/J.height,width:d.width/J.width,height:d.height/J.height}:null,c=d.x/ee,u=d.y/ee,h=d.width/ee,p=d.height/ee,m=document.createElement("canvas");m.width=e.naturalWidth,m.height=e.naturalHeight;const f=m.getContext("2d");if(!f)return console.error("[CropMaskEditor] Failed to create base canvas context"),void o();f.drawImage(e,0,0),s&&n&&(console.log("[CropMaskEditor] Applying paint layer"),f.drawImage(n,0,0));const g=s&&n?n.toDataURL("image/png"):null;if(r&&t){console.log("[CropMaskEditor] Applying mask as alpha channel");const e=f.getImageData(0,0,m.width,m.height),n=e.data,i=t.getContext("2d");if(!i)return console.error("[CropMaskEditor] Failed to get mask context"),void o();const r=i.getImageData(0,0,t.width,t.height).data;for(let t=0;t<n.length;t+=4){const e=r[t];n[t+3]=e}f.putImageData(e,0,0)}const v=r&&t?t.toDataURL("image/png"):null;let y;if(i){console.log("[CropMaskEditor] Applying crop");const t=document.createElement("canvas");t.width=h,t.height=p;const n=t.getContext("2d");if(!n)return console.error("[CropMaskEditor] Failed to create cropped canvas context"),void o();n.drawImage(m,Math.max(0,c),Math.max(0,u),Math.min(h,e.naturalWidth-c),Math.min(p,e.naturalHeight-u),0,0,t.width,t.height),y=t.toDataURL("image/png")}else y=m.toDataURL("image/png");console.log("[CropMaskEditor] Result length:",y.length),a(y,v,l,g)},[d,J,ee,ye,a,o]),xe=Pt.useCallback(()=>{const e=q.current,t=K.current;if(!e||!t)return;const n=e.getContext("2d"),i=t.getContext("2d");n&&i&&(n.fillStyle="black",n.fillRect(0,0,e.width,e.height),i.clearRect(0,0,t.width,t.height))},[]),be=Pt.useCallback(e=>{if(u(e),d.width>0&&d.height>0&&null!==e){const t=d.width/d.height,n=d.x+d.width/2,i=d.y+d.height/2;let r=d.width,a=d.height;t>e?a=r/e:r=a*e,r=Math.min(r,J.width),a=Math.min(a,J.height);let o=n-r/2,s=i-a/2;o=Math.max(0,Math.min(o,J.width-r)),s=Math.max(0,Math.min(s,J.height-a)),h({x:o,y:s,width:r,height:a})}},[d,J]),Se=Pt.useCallback(()=>{h({x:0,y:0,width:J.width,height:J.height}),u(null)},[J]);return Ut.jsx("div",{className:"crop-mask-editor-overlay",children:Ut.jsxs("div",{className:"crop-mask-editor-modal",children:[Ut.jsxs("div",{className:"crop-mask-editor-header",children:[Ut.jsx("h3",{children:"crop"===s?"Crop Image":"mask"===s?"Edit Mask":"Paint on Image"}),Ut.jsxs("div",{className:"mode-toggle",children:[Ut.jsx("button",{className:"crop"===s?"active":"",onClick:()=>l("crop"),children:" Crop"}),Ut.jsx("button",{className:"mask"===s?"active":"",onClick:()=>l("mask"),children:" Mask"}),Ut.jsx("button",{className:"paint"===s?"active":"",onClick:()=>l("paint"),children:" Paint"})]}),Ut.jsx("button",{className:"close-btn",onClick:o,children:""})]}),Ut.jsxs("div",{className:"crop-mask-editor-toolbar",children:["crop"===s&&Ut.jsxs("div",{className:"crop-toolbar",children:[Ut.jsx("span",{children:"Aspect Ratio:"}),Ut.jsx("div",{className:"aspect-presets",children:Gg.map(e=>Ut.jsx("button",{className:c===e.ratio?"active":"",onClick:()=>be(e.ratio),children:e.label},e.label))}),Ut.jsx("button",{className:"reset-crop-btn",onClick:Se,title:"Reset crop to full image",children:" Reset"})]}),"mask"===s&&Ut.jsxs("div",{className:"mask-toolbar",children:[Ut.jsxs("div",{className:"brush-controls",children:[Ut.jsxs("label",{children:["Size:",Ut.jsx("input",{type:"range",min:"5",max:"100",value:k,onChange:e=>A(Number(e.target.value))}),Ut.jsxs("span",{children:[k,"px"]})]}),Ut.jsxs("label",{children:["Opacity:",Ut.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:N,onChange:e=>R(Number(e.target.value))}),Ut.jsxs("span",{children:[Math.round(100*N),"%"]})]})]}),Ut.jsxs("div",{className:"brush-modes",children:[Ut.jsx("button",{className:"add"===L?"active":"",onClick:()=>I("add"),children:" Add"}),Ut.jsx("button",{className:"erase"===L?"active":"",onClick:()=>I("erase"),children:" Erase"}),Ut.jsx("button",{onClick:xe,children:" Clear"})]})]}),"paint"===s&&Ut.jsxs("div",{className:"paint-toolbar",children:[Ut.jsxs("div",{className:"brush-controls",children:[Ut.jsxs("label",{children:["Size:",Ut.jsx("input",{type:"range",min:"1",max:"100",value:F,onChange:e=>z(Number(e.target.value))}),Ut.jsxs("span",{children:[F,"px"]})]}),Ut.jsxs("label",{className:"color-picker-label",children:["Color:",Ut.jsx("input",{type:"color",value:U,onChange:e=>O(e.target.value),className:"color-picker"}),Ut.jsx("span",{className:"color-preview",style:{backgroundColor:U}})]})]}),Ut.jsxs("div",{className:"brush-modes",children:[Ut.jsx("button",{className:"paint"===B?"active":"",onClick:()=>H("paint"),children:" Paint"}),Ut.jsx("button",{className:"erase"===B?"active":"",onClick:()=>H("erase"),children:" Erase"}),Ut.jsx("button",{onClick:ve,children:" Clear"})]})]})]}),Ut.jsxs("div",{className:"crop-mask-editor-canvas",ref:G,children:[Ut.jsxs("div",{ref:$,className:"image-wrapper",style:{width:J.width,height:J.height,position:"relative"},children:[Ut.jsx("img",{ref:X,src:e,alt:"Source",onLoad:ne,style:{width:"100%",height:"100%",display:"block"}}),Ut.jsx("canvas",{ref:K,className:"mask-display-canvas",style:{display:"mask"===s?"block":"none",position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"mask"===s?"auto":"none"},onMouseDown:ce,onMouseMove:ue,onMouseUp:de,onMouseLeave:de}),Ut.jsx("canvas",{ref:Z,className:"paint-display-canvas",style:{display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"paint"===s?"auto":"none"},onMouseDown:me,onMouseMove:fe,onMouseUp:ge,onMouseLeave:ge}),"crop"===s&&Ut.jsxs("div",{className:"crop-overlay",onMouseDown:re,onMouseMove:ae,onMouseUp:oe,onMouseLeave:oe,children:[Ut.jsx("div",{className:"crop-darken",style:{clipPath:`polygon(\n                    0 0, 100% 0, 100% 100%, 0 100%,\n                    0 ${d.y}px,\n                    ${d.x}px ${d.y}px,\n                    ${d.x}px ${d.y+d.height}px,\n                    ${d.x+d.width}px ${d.y+d.height}px,\n                    ${d.x+d.width}px ${d.y}px,\n                    ${d.x}px ${d.y}px,\n                    0 ${d.y}px\n                  )`}}),Ut.jsx("div",{className:"crop-rect",style:{left:d.x,top:d.y,width:d.width,height:d.height},children:Ut.jsxs("div",{className:"crop-handles",children:[Ut.jsx("div",{className:"crop-handle tl"}),Ut.jsx("div",{className:"crop-handle tr"}),Ut.jsx("div",{className:"crop-handle bl"}),Ut.jsx("div",{className:"crop-handle br"})]})})]})]}),Ut.jsx("canvas",{ref:q,className:"mask-canvas",style:{display:"none"}}),Ut.jsx("canvas",{ref:Y,className:"paint-canvas",style:{display:"none"}})]}),Ut.jsxs("div",{className:"crop-mask-editor-footer",children:[Ut.jsx("div",{className:"crop-info",children:"crop"===s&&d.width>0&&Ut.jsxs("span",{children:[Math.round(d.width/ee),"  ",Math.round(d.height/ee)," px"]})}),Ut.jsxs("div",{className:"action-buttons",children:[Ut.jsx("button",{className:"cancel-btn",onClick:o,children:"Cancel"}),Ut.jsx("button",{className:"save-btn",onClick:_e,children:"crop"===s?"Apply Crop":"mask"===s?"Save Mask":"Apply Changes"})]})]})]})})}function Xg({originalImage:e,cropRect:t,displayMask:n}){const i=Pt.useRef(null),[r,a]=Pt.useState(null);return Pt.useEffect(()=>{if(!t)return void a(e);const n=new Image;n.onload=()=>{const e=t.x*n.naturalWidth,i=t.y*n.naturalHeight,r=t.width*n.naturalWidth,o=t.height*n.naturalHeight,s=document.createElement("canvas");s.width=r,s.height=o;const l=s.getContext("2d");l&&(l.drawImage(n,e,i,r,o,0,0,r,o),a(s.toDataURL("image/png")))},n.src=e},[e,t]),Ut.jsxs("div",{ref:i,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[r&&Ut.jsx("img",{src:r,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"contain"}}),n&&Ut.jsx(qg,{maskData:n})]})}function qg({maskData:e}){const t=Pt.useRef(null);return Pt.useEffect(()=>{const n=t.current;if(!n)return;const i=n.getContext("2d");if(!i)return;const r=new Image;r.onload=()=>{n.width=r.width,n.height=r.height,i.drawImage(r,0,0);const e=i.getImageData(0,0,n.width,n.height).data,t=i.createImageData(n.width,n.height);for(let n=0;n<e.length;n+=4){const i=e[n];i>10?(t.data[n]=255,t.data[n+1]=50,t.data[n+2]=50,t.data[n+3]=Math.floor(.6*i)):(t.data[n]=0,t.data[n+1]=0,t.data[n+2]=0,t.data[n+3]=0)}i.clearRect(0,0,n.width,n.height),i.putImageData(t,0,0)},r.src=e},[e]),Ut.jsx("canvas",{ref:t,className:"mask-overlay"})}function Kg({name:e,displayName:t,value:n,onChange:i,onBrowse:r,disabled:a=!1,acceptType:o="image",isBypassed:s=!1,onBypassChange:l,comfyUrl:c}){const[u,d]=Pt.useState(!1),[h,p]=Pt.useState(!1),[m,f]=Pt.useState(null),g=Pt.useRef(null),v=Pt.useCallback(()=>{switch(o){case"image":default:return"image/*";case"video":return"video/*";case"any":return"image/*,video/*"}},[o]),y=Pt.useCallback(e=>{const t=e.type.startsWith("image/"),n=e.type.startsWith("video/");switch(o){case"image":default:return t;case"video":return n;case"any":return t||n}},[o]),_=Pt.useCallback(e=>{console.log("[DropZone] DragEnter fired"),e.preventDefault(),e.stopPropagation(),a||(d(!0),p(!0))},[a]),x=Pt.useCallback(e=>{console.log("[DropZone] DragLeave fired"),e.preventDefault(),e.stopPropagation(),p(!1),d(!1)},[]),b=Pt.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),S=Pt.useCallback(t=>{if(!y(t))return;const n=t.type.startsWith("video/");f(n?"video":"image"),R(null),I(null),D(null),O(null),z(null);const r=new FileReader;r.onload=t=>{var n;(null==(n=t.target)?void 0:n.result)&&i(e,t.target.result)},r.readAsDataURL(t)},[y,e,i]),w=Pt.useCallback(async t=>{if(console.log("[DropZone] Drop fired!"),t.preventDefault(),t.stopPropagation(),d(!1),p(!1),a)return void console.log("[DropZone] Drop ignored - disabled");console.log("[DropZone] Drop data types:",t.dataTransfer.types),console.log("[DropZone] Drop text data:",t.dataTransfer.getData("text/plain").substring(0,100));const n=t.dataTransfer.files;if(n.length>0)return void S(n[0]);const r=t.dataTransfer.getData("text/plain");if(r){R(null),I(null),D(null),O(null),z(null),f("video"===o?"video":"image");try{const t=JSON.parse(r),n="";if(t.url&&"string"==typeof t.url){console.log("[DropZone] Fetching media from URL:",t.url.substring(0,80));const r=t.url.toLowerCase();[".mp4",".mov",".avi",".webm",".mkv"].some(e=>r.includes(e))&&f("video");try{const n=await fetch(t.url);if(n.ok){const t=await n.blob();console.log("[DropZone] Got blob via direct fetch, size:",t.size);const r=new FileReader;return r.onload=()=>{console.log("[DropZone] FileReader loaded, calling onChange"),i(e,r.result)},r.onerror=e=>{console.error("[DropZone] FileReader error:",e)},void r.readAsDataURL(t)}}catch(s){console.log("[DropZone] Direct fetch failed (likely CORS), trying CPE proxy...");try{const r=await fetch(`${n}/api/fetch-image?url=${encodeURIComponent(t.url)}`),a=await r.json();if(a.success&&a.dataUrl)return console.log("[DropZone] Successfully fetched via CPE proxy"),void i(e,a.dataUrl);console.warn("[DropZone] CPE proxy failed:",a.message)}catch(l){console.warn("[DropZone] CPE proxy error:",l)}}}if(t.filePath&&"string"==typeof t.filePath){console.log("[DropZone] Trying CPE backend for filePath:",t.filePath);const r=await fetch(`${n}/api/read-image?path=${encodeURIComponent(t.filePath)}`),a=await r.json();if(a.success&&a.dataUrl)return void i(e,a.dataUrl)}}catch(c){console.warn("[DropZone] Error parsing/handling dropped data:",c)}r.startsWith("data:")&&i(e,r)}},[a,e,i,S]),M=Pt.useCallback(e=>{const t=e.target.files;t&&t.length>0&&S(t[0])},[S]),E=Pt.useCallback(()=>{var e;r?r():null==(e=g.current)||e.click()},[r]),C=Pt.useCallback(()=>{i(e,null),f(null),R(null),I(null),D(null),O(null),z(null)},[e,i]),[T,P]=Pt.useState(!1),[k,A]=Pt.useState("crop"),[N,R]=Pt.useState(null),[L,I]=Pt.useState(null),[j,D]=Pt.useState(null),[U,O]=Pt.useState(null),[F,z]=Pt.useState(null),B=Pt.useCallback(()=>{console.log("[ImageDropZone] handleCropClick called, value:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] originalImage exists:",!!N),n&&!N&&(console.log("[ImageDropZone] Storing original image"),R(n)),A("crop"),P(!0)},[n,N]),H=Pt.useCallback(()=>{console.log("[ImageDropZone] handleMaskClick called, value:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] originalImage exists:",!!N),n&&!N&&(console.log("[ImageDropZone] Storing original image"),R(n)),A("mask"),P(!0)},[n,N]),V=Pt.useCallback(()=>{console.log("[ImageDropZone] handlePaintClick called, value:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] originalImage exists:",!!N),n&&!N&&(console.log("[ImageDropZone] Storing original image"),R(n)),A("paint"),P(!0)},[n,N]),W=Pt.useCallback((e,t,n)=>new Promise(i=>{if(!t)return void i(e);const r=new Image;r.onload=()=>{const n=new Image;n.onload=()=>{const a=t.x*r.naturalWidth,o=t.y*r.naturalHeight,s=t.width*r.naturalWidth,l=t.height*r.naturalHeight,c=document.createElement("canvas");c.width=s,c.height=l;const u=c.getContext("2d");u?(u.drawImage(n,a,o,s,l,0,0,s,l),i(c.toDataURL("image/png"))):i(e)},n.src=e},r.src=n}),[]),G=Pt.useCallback(async(t,n,r,a)=>{if(console.log("[ImageDropZone] handleCropMaskSave called"),console.log("[ImageDropZone] processedImage:",t?t.substring(0,50)+"...":"null"),console.log("[ImageDropZone] rawMaskData:",n?n.substring(0,50)+"...":"null"),console.log("[ImageDropZone] rawPaintData:",a?a.substring(0,50)+"...":"null"),console.log("[ImageDropZone] newCropRect:",r),!(t||n||r||a))return console.log("[ImageDropZone] No changes detected, closing dialog"),void P(!1);if(void 0!==r&&O(r),void 0!==n)if(I(n),n&&N){const e=await W(n,r,N);z(e)}else z(n);void 0!==a&&D(a),t&&(console.log("[ImageDropZone] Calling onChange with processed image"),i(e,t)),P(!1)},[e,i,N,W]),$=Pt.useCallback(()=>{P(!1)},[]),X=(null==n?void 0:n.startsWith("data:video"))?"video":m||"image",q=(()=>{switch(o){case"video":return{icon:"",text:u?"Drop video here":"Drag video or browse"};case"any":return{icon:"",text:u?"Drop media here":"Drag image/video or browse"};default:return{icon:"",text:u?"Drop image here":"Drag image from canvas or browse"}}})();return Ut.jsxs("div",{className:"image-drop-zone-container "+(s?"bypassed":""),children:[Ut.jsxs("div",{className:"image-drop-zone-header",children:[Ut.jsx("label",{className:"image-drop-zone-label",children:t}),l&&Ut.jsxs("label",{className:"bypass-toggle",title:s?"Enable this input":"Bypass this input (skip in workflow)",children:[Ut.jsx("input",{type:"checkbox",checked:s,onChange:e=>l(e.target.checked)}),Ut.jsx("span",{className:"bypass-label",children:s?"Bypassed":"Active"})]})]}),s?Ut.jsx("div",{className:"image-drop-zone bypassed-placeholder",children:Ut.jsxs("div",{className:"bypassed-content",children:[Ut.jsx("div",{className:"bypassed-icon",children:""}),Ut.jsx("div",{className:"bypassed-text",children:"Input bypassed"}),Ut.jsx("div",{className:"bypassed-hint",children:"This input will be skipped"})]})}):Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("div",{className:`image-drop-zone ${h?"drag-over":""} ${n?"has-image":""} ${a?"disabled":""}`,onDragEnter:_,onDragLeave:x,onDragOver:b,onDrop:w,children:n?Ut.jsxs("div",{className:"image-preview",children:["video"===X?Ut.jsx("video",{src:n,controls:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"contain"}}):Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("img",{src:n,alt:t,style:{opacity:L?0:1}}),L&&N&&Ut.jsx(Xg,{originalImage:N,cropRect:U,displayMask:F})]}),Ut.jsxs("div",{className:"image-preview-actions",children:[Ut.jsx("button",{className:"image-action-btn crop-btn",onClick:B,disabled:a||"video"===X,title:"Crop image",children:""}),Ut.jsx("button",{className:"image-action-btn mask-btn",onClick:H,disabled:a||"video"===X,title:"Add mask",children:""}),Ut.jsx("button",{className:"image-action-btn paint-btn",onClick:V,disabled:a||"video"===X,title:"Paint on image",children:""}),Ut.jsx("button",{className:"image-action-btn clear-btn",onClick:C,disabled:a,title:"Remove media",children:""})]})]}):Ut.jsxs("div",{className:"drop-placeholder",children:[Ut.jsx("div",{className:"drop-icon",children:q.icon}),Ut.jsx("div",{className:"drop-text",children:q.text}),Ut.jsx("div",{className:"drop-actions",children:Ut.jsx("button",{className:"browse-btn",onClick:E,disabled:a,children:"Browse..."})})]})}),Ut.jsx("input",{ref:g,type:"file",accept:v(),onChange:M,style:{display:"none"}})]}),T&&n&&Ut.jsx($g,{imageData:N||n,mode:k,initialMask:L,initialCrop:U,initialPaint:j,onSave:G,onCancel:$})]})}const Yg=["front","front-right quarter","right side","back-right quarter","back","back-left quarter","left side","front-left quarter"],Zg=["low-angle","eye-level","elevated","high-angle"],Jg=["close-up","medium","wide"];function Qg(e){return`<sks> ${e.direction} view ${e.height} shot ${e.size} shot`}function ev(e){return`${e.direction.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")} ${e.height.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("-")} ${e.size.charAt(0).toUpperCase()+e.size.slice(1)}`}const tv=function(){const e=[];for(const t of Yg)for(const n of Zg)for(const i of Jg){const r=`${t.replace(/\s+/g,"-")}_${n}_${i}`,a=Qg({direction:t,height:n,size:i}),o=ev({direction:t,height:n,size:i});e.push({id:r,direction:t,height:n,size:i,prompt:a,displayName:o})}return e}();function nv(e){const t=e.match(/^<sks>\s+([\w\s-]+?)\s+view\s+([\w-]+?)\s+shot\s+([\w-]+?)\s+shot/i);if(!t)return null;const[,n,i,r]=t,a=function(e){const t=e.replace(/-/g," ").replace(/\s+/g," ").trim(),n=Yg.find(e=>{const n=e.toLowerCase();return t===n});return n||null}(n.toLowerCase().trim()),o=function(e){const t=Zg.find(t=>t.toLowerCase()===e);return t||null}(i.toLowerCase().trim()),s=function(e){const t=Jg.find(t=>t.toLowerCase()===e);return t||null}(r.toLowerCase().trim());return a&&o&&s?function(e,t,n){return tv.find(i=>i.direction===e&&i.height===t&&i.size===n)}(a,o,s)??null:null}function iv(e){return e.replace(/^<sks>\s+[\w\s-]+?\s+view\s+[\w-]+?\s+shot\s+[\w-]+?\s+shot\s*/i,"").trim()}
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const rv="162",av=0,ov=1,sv=2,lv=0,cv=1,uv=2,dv=3,hv=0,pv=1,mv=2,fv=100,gv=101,vv=102,yv=200,_v=201,xv=202,bv=203,Sv=204,wv=205,Mv=206,Ev=207,Cv=208,Tv=209,Pv=210,kv=211,Av=212,Nv=213,Rv=214,Lv=301,Iv=302,jv=306,Dv=1e3,Uv=1001,Ov=1002,Fv=1003,zv=1004,Bv=1005,Hv=1006,Vv=1007,Wv=1008,Gv=1009,$v=1012,Xv=1013,qv=1014,Kv=1015,Yv=1016,Zv=1020,Jv=1023,Qv=1026,ey=1027,ty=33776,ny=33777,iy=33778,ry=33779,ay=36492,oy="",sy="srgb",ly="srgb-linear",cy="display-p3",uy="display-p3-linear",dy="linear",hy="srgb",py="rec709",my="p3",fy=7680,gy=512,vy=513,yy=514,_y=515,xy=516,by=517,Sy=518,wy=519,My="300 es",Ey=1035,Cy=2e3,Ty=2001;class Py{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const ky=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ay=Math.PI/180,Ny=180/Math.PI;function Ry(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ky[255&e]+ky[e>>8&255]+ky[e>>16&255]+ky[e>>24&255]+"-"+ky[255&t]+ky[t>>8&255]+"-"+ky[t>>16&15|64]+ky[t>>24&255]+"-"+ky[63&n|128]+ky[n>>8&255]+"-"+ky[n>>16&255]+ky[n>>24&255]+ky[255&i]+ky[i>>8&255]+ky[i>>16&255]+ky[i>>24&255]).toLowerCase()}function Ly(e,t,n){return Math.max(t,Math.min(n,e))}function Iy(e,t,n){return(1-n)*e+n*t}function jy(e){return!(e&e-1)&&0!==e}function Dy(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Uy(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Oy(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const Fy=Ay;class zy{constructor(e=0,t=0){zy.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ly(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class By{constructor(e,t,n,i,r,a,o,s,l){By.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,a,o,s,l)}set(e,t,n,i,r,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],m=i[0],f=i[3],g=i[6],v=i[1],y=i[4],_=i[7],x=i[2],b=i[5],S=i[8];return r[0]=a*m+o*v+s*x,r[3]=a*f+o*y+s*b,r[6]=a*g+o*_+s*S,r[1]=l*m+c*v+u*x,r[4]=l*f+c*y+u*b,r[7]=l*g+c*_+u*S,r[2]=d*m+h*v+p*x,r[5]=d*f+h*y+p*b,r[8]=d*g+h*_+p*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*r*c+n*o*s+i*r*l-i*a*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,d=o*s-c*r,h=l*r-a*s,p=t*u+n*d+i*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=u*m,e[1]=(i*l-c*n)*m,e[2]=(o*n-i*a)*m,e[3]=d*m,e[4]=(c*t-i*s)*m,e[5]=(i*r-o*t)*m,e[6]=h*m,e[7]=(n*s-l*t)*m,e[8]=(a*t-n*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,o){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Hy.makeScale(e,t)),this}rotate(e){return this.premultiply(Hy.makeRotation(-e)),this}translate(e,t){return this.premultiply(Hy.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Hy=new By;function Vy(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function Wy(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Gy(){const e=Wy("canvas");return e.style.display="block",e}const $y={};const Xy=(new By).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),qy=(new By).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Ky={[ly]:{transfer:dy,primaries:py,toReference:e=>e,fromReference:e=>e},[sy]:{transfer:hy,primaries:py,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[uy]:{transfer:dy,primaries:my,toReference:e=>e.applyMatrix3(qy),fromReference:e=>e.applyMatrix3(Xy)},[cy]:{transfer:hy,primaries:my,toReference:e=>e.convertSRGBToLinear().applyMatrix3(qy),fromReference:e=>e.applyMatrix3(Xy).convertLinearToSRGB()}},Yy=new Set([ly,uy]),Zy={enabled:!0,_workingColorSpace:ly,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!Yy.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=Ky[t].toReference;return(0,Ky[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return Ky[e].primaries},getTransfer:function(e){return e===oy?dy:Ky[e].transfer}};function Jy(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Qy(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let e_;class t_{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===e_&&(e_=Wy("canvas")),e_.width=e.width,e_.height=e.height;const n=e_.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=e_}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Wy("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Jy(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Jy(t[e]/255)):t[e]=Jy(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let n_=0;class i_{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:n_++}),this.uuid=Ry(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(r_(i[t].image)):e.push(r_(i[t]))}else e=r_(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function r_(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?t_.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let a_=0;class o_ extends Py{constructor(e=o_.DEFAULT_IMAGE,t=o_.DEFAULT_MAPPING,n=1001,i=1001,r=1006,a=1008,o=1023,s=1009,l=o_.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:a_++}),this.uuid=Ry(),this.name="",this.source=new i_(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new zy(0,0),this.repeat=new zy(1,1),this.center=new zy(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new By,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Dv:e.x=e.x-Math.floor(e.x);break;case Uv:e.x=e.x<0?0:1;break;case Ov:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Dv:e.y=e.y-Math.floor(e.y);break;case Uv:e.y=e.y<0?0:1;break;case Ov:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}o_.DEFAULT_IMAGE=null,o_.DEFAULT_MAPPING=300,o_.DEFAULT_ANISOTROPY=1;class s_{constructor(e=0,t=0,n=0,i=1){s_.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],d=s[1],h=s[5],p=s[9],m=s[2],f=s[6],g=s[10];if(Math.abs(c-d)<a&&Math.abs(u-m)<a&&Math.abs(p-f)<a){if(Math.abs(c+d)<o&&Math.abs(u+m)<o&&Math.abs(p+f)<o&&Math.abs(l+h+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(h+1)/2,v=(g+1)/2,y=(c+d)/4,_=(u+m)/4,x=(p+f)/4;return e>s&&e>v?e<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=_/n):s>v?s<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=y/i,r=x/i):v<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=_/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((f-p)*(f-p)+(u-m)*(u-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(u-m)/v,this.z=(d-c)/v,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class l_ extends Py{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new s_(0,0,e,t),this.scissorTest=!1,this.viewport=new s_(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Hv,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},n);const r=new o_(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,i=e.textures.length;n<i;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new i_(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class c_ extends l_{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class u_ extends o_{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Fv,this.minFilter=Fv,this.wrapR=Uv,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class d_ extends o_{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Fv,this.minFilter=Fv,this.wrapR=Uv,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class h_{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,a,o){let s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const d=r[a+0],h=r[a+1],p=r[a+2],m=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=m);if(u!==m||s!==d||l!==h||c!==p){let e=1-o;const t=s*d+l*h+c*p+u*m,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,t*n);e=Math.sin(e*a)/r,o=Math.sin(o*a)/r}const r=o*n;if(s=s*e+d*r,l=l*e+h*r,c=c*e+p*r,u=u*e+m*r,e===1-o){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,a){const o=n[i],s=n[i+1],l=n[i+2],c=n[i+3],u=r[a],d=r[a+1],h=r[a+2],p=r[a+3];return e[t]=o*p+c*u+s*h-l*d,e[t+1]=s*p+c*d+l*u-o*h,e[t+2]=l*p+c*h+o*d-s*u,e[t+3]=c*p-o*u-s*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),d=s(n/2),h=s(i/2),p=s(r/2);switch(a){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+o+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(r-l)*e,this._z=(a-i)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-s)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(r+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(r-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(a-i)/e,this._x=(r+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ly(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+i*l-r*s,this._y=i*c+a*s+r*o-n*l,this._z=r*c+a*l+n*s-i*o,this._w=a*c-n*o-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,a=this._w;let o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class p_{constructor(e=0,t=0,n=0){p_.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(f_.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(f_.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=2*(a*i-o*n),c=2*(o*t-r*i),u=2*(r*n-a*t);return this.x=t+s*l+a*u-o*c,this.y=n+s*c+o*l-r*u,this.z=i+s*u+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return m_.copy(this).projectOnVector(e),this.sub(m_)}reflect(e){return this.sub(m_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ly(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const m_=new p_,f_=new h_;class g_{constructor(e=new p_(1/0,1/0,1/0),t=new p_(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(y_.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(y_.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=y_.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,y_):y_.fromBufferAttribute(i,t),y_.applyMatrix4(e.matrixWorld),this.expandByPoint(y_);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),__.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),__.copy(n.boundingBox)),__.applyMatrix4(e.matrixWorld),this.union(__)}const i=e.children;for(let r=0,a=i.length;r<a;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,y_),y_.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(C_),T_.subVectors(this.max,C_),x_.subVectors(e.a,C_),b_.subVectors(e.b,C_),S_.subVectors(e.c,C_),w_.subVectors(b_,x_),M_.subVectors(S_,b_),E_.subVectors(x_,S_);let t=[0,-w_.z,w_.y,0,-M_.z,M_.y,0,-E_.z,E_.y,w_.z,0,-w_.x,M_.z,0,-M_.x,E_.z,0,-E_.x,-w_.y,w_.x,0,-M_.y,M_.x,0,-E_.y,E_.x,0];return!!A_(t,x_,b_,S_,T_)&&(t=[1,0,0,0,1,0,0,0,1],!!A_(t,x_,b_,S_,T_)&&(P_.crossVectors(w_,M_),t=[P_.x,P_.y,P_.z],A_(t,x_,b_,S_,T_)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,y_).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(y_).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(v_[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),v_[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),v_[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),v_[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),v_[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),v_[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),v_[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),v_[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(v_)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const v_=[new p_,new p_,new p_,new p_,new p_,new p_,new p_,new p_],y_=new p_,__=new g_,x_=new p_,b_=new p_,S_=new p_,w_=new p_,M_=new p_,E_=new p_,C_=new p_,T_=new p_,P_=new p_,k_=new p_;function A_(e,t,n,i,r){for(let a=0,o=e.length-3;a<=o;a+=3){k_.fromArray(e,a);const o=r.x*Math.abs(k_.x)+r.y*Math.abs(k_.y)+r.z*Math.abs(k_.z),s=t.dot(k_),l=n.dot(k_),c=i.dot(k_);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const N_=new g_,R_=new p_,L_=new p_;class I_{constructor(e=new p_,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):N_.setFromPoints(e).getCenter(n);let i=0;for(let r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;R_.subVectors(e,this.center);const t=R_.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(R_,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(L_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(R_.copy(e.center).add(L_)),this.expandByPoint(R_.copy(e.center).sub(L_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const j_=new p_,D_=new p_,U_=new p_,O_=new p_,F_=new p_,z_=new p_,B_=new p_;class H_{constructor(e=new p_,t=new p_(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,j_)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=j_.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(j_.copy(this.origin).addScaledVector(this.direction,t),j_.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){D_.copy(e).add(t).multiplyScalar(.5),U_.copy(t).sub(e).normalize(),O_.copy(this.origin).sub(D_);const r=.5*e.distanceTo(t),a=-this.direction.dot(U_),o=O_.dot(this.direction),s=-O_.dot(U_),l=O_.lengthSq(),c=Math.abs(1-a*a);let u,d,h,p;if(c>0)if(u=a*s-o,d=a*o-s,p=r*c,u>=0)if(d>=-p)if(d<=p){const e=1/c;u*=e,d*=e,h=u*(u+a*d+2*o)+d*(a*u+d+2*s)+l}else d=r,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d=-r,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d<=-p?(u=Math.max(0,-(-a*r+o)),d=u>0?-r:Math.min(Math.max(-r,-s),r),h=-u*u+d*(d+2*s)+l):d<=p?(u=0,d=Math.min(Math.max(-r,-s),r),h=d*(d+2*s)+l):(u=Math.max(0,-(a*r+o)),d=u>0?r:Math.min(Math.max(-r,-s),r),h=-u*u+d*(d+2*s)+l);else d=a>0?-r:r,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(D_).addScaledVector(U_,d),h}intersectSphere(e,t){j_.subVectors(e.center,this.origin);const n=j_.dot(this.direction),i=j_.dot(j_)-n*n,r=e.radius*e.radius;if(i>r)return null;const a=Math.sqrt(r-i),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),u>=0?(o=(e.min.z-d.z)*u,s=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,s=(e.min.z-d.z)*u),n>s||o>i?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,j_)}intersectTriangle(e,t,n,i,r){F_.subVectors(t,e),z_.subVectors(n,e),B_.crossVectors(F_,z_);let a,o=this.direction.dot(B_);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}O_.subVectors(this.origin,e);const s=a*this.direction.dot(z_.crossVectors(O_,z_));if(s<0)return null;const l=a*this.direction.dot(F_.cross(O_));if(l<0)return null;if(s+l>o)return null;const c=-a*O_.dot(B_);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class V_{constructor(e,t,n,i,r,a,o,s,l,c,u,d,h,p,m,f){V_.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,a,o,s,l,c,u,d,h,p,m,f)}set(e,t,n,i,r,a,o,s,l,c,u,d,h,p,m,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new V_).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/W_.setFromMatrixColumn(e,0).length(),r=1/W_.setFromMatrixColumn(e,1).length(),a=1/W_.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=a*c,n=a*u,i=o*c,r=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-o*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*c,n=s*u,i=l*c,r=l*u;t[0]=e+r*o,t[4]=i*o-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=n*o-i,t[6]=r+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*c,n=s*u,i=l*c,r=l*u;t[0]=e-r*o,t[4]=-a*u,t[8]=i+n*o,t[1]=n+i*o,t[5]=a*c,t[9]=r-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*c,n=a*u,i=o*c,r=o*u;t[0]=s*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*l,i=o*s,r=o*l;t[0]=s*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=a*s,n=a*l,i=o*s,r=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=a*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=o*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($_,e,X_)}lookAt(e,t,n){const i=this.elements;return Y_.subVectors(e,t),0===Y_.lengthSq()&&(Y_.z=1),Y_.normalize(),q_.crossVectors(n,Y_),0===q_.lengthSq()&&(1===Math.abs(n.z)?Y_.x+=1e-4:Y_.z+=1e-4,Y_.normalize(),q_.crossVectors(n,Y_)),q_.normalize(),K_.crossVectors(Y_,q_),i[0]=q_.x,i[4]=K_.x,i[8]=Y_.x,i[1]=q_.y,i[5]=K_.y,i[9]=Y_.y,i[2]=q_.z,i[6]=K_.z,i[10]=Y_.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],m=n[6],f=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=i[0],S=i[4],w=i[8],M=i[12],E=i[1],C=i[5],T=i[9],P=i[13],k=i[2],A=i[6],N=i[10],R=i[14],L=i[3],I=i[7],j=i[11],D=i[15];return r[0]=a*b+o*E+s*k+l*L,r[4]=a*S+o*C+s*A+l*I,r[8]=a*w+o*T+s*N+l*j,r[12]=a*M+o*P+s*R+l*D,r[1]=c*b+u*E+d*k+h*L,r[5]=c*S+u*C+d*A+h*I,r[9]=c*w+u*T+d*N+h*j,r[13]=c*M+u*P+d*R+h*D,r[2]=p*b+m*E+f*k+g*L,r[6]=p*S+m*C+f*A+g*I,r[10]=p*w+m*T+f*N+g*j,r[14]=p*M+m*P+f*R+g*D,r[3]=v*b+y*E+_*k+x*L,r[7]=v*S+y*C+_*A+x*I,r[11]=v*w+y*T+_*N+x*j,r[15]=v*M+y*P+_*R+x*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+r*s*u-i*l*u-r*o*d+n*l*d+i*o*h-n*s*h)+e[7]*(+t*s*h-t*l*d+r*a*d-i*a*h+i*l*c-r*s*c)+e[11]*(+t*l*u-t*o*h-r*a*u+n*a*h+r*o*c-n*l*c)+e[15]*(-i*o*c-t*s*u+t*o*d+i*a*u-n*a*d+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],m=e[13],f=e[14],g=e[15],v=u*f*l-m*d*l+m*s*h-o*f*h-u*s*g+o*d*g,y=p*d*l-c*f*l-p*s*h+a*f*h+c*s*g-a*d*g,_=c*m*l-p*u*l+p*o*h-a*m*h-c*o*g+a*u*g,x=p*u*s-c*m*s-p*o*d+a*m*d+c*o*f-a*u*f,b=t*v+n*y+i*_+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/b;return e[0]=v*S,e[1]=(m*d*r-u*f*r-m*i*h+n*f*h+u*i*g-n*d*g)*S,e[2]=(o*f*r-m*s*r+m*i*l-n*f*l-o*i*g+n*s*g)*S,e[3]=(u*s*r-o*d*r-u*i*l+n*d*l+o*i*h-n*s*h)*S,e[4]=y*S,e[5]=(c*f*r-p*d*r+p*i*h-t*f*h-c*i*g+t*d*g)*S,e[6]=(p*s*r-a*f*r-p*i*l+t*f*l+a*i*g-t*s*g)*S,e[7]=(a*d*r-c*s*r+c*i*l-t*d*l-a*i*h+t*s*h)*S,e[8]=_*S,e[9]=(p*u*r-c*m*r-p*n*h+t*m*h+c*n*g-t*u*g)*S,e[10]=(a*m*r-p*o*r+p*n*l-t*m*l-a*n*g+t*o*g)*S,e[11]=(c*o*r-a*u*r-c*n*l+t*u*l+a*n*h-t*o*h)*S,e[12]=x*S,e[13]=(c*m*i-p*u*i+p*n*d-t*m*d-c*n*f+t*u*f)*S,e[14]=(p*o*i-a*m*i-p*n*s+t*m*s+a*n*f-t*o*f)*S,e[15]=(a*u*i-c*o*i+c*n*s-t*u*s-a*n*d+t*o*d)*S,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,c=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,c*o+n,c*s-i*a,0,l*s-i*o,c*s+i*a,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,c=a+a,u=o+o,d=r*l,h=r*c,p=r*u,m=a*c,f=a*u,g=o*u,v=s*l,y=s*c,_=s*u,x=n.x,b=n.y,S=n.z;return i[0]=(1-(m+g))*x,i[1]=(h+_)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(h-_)*b,i[5]=(1-(d+g))*b,i[6]=(f+v)*b,i[7]=0,i[8]=(p+y)*S,i[9]=(f-v)*S,i[10]=(1-(d+m))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=W_.set(i[0],i[1],i[2]).length();const a=W_.set(i[4],i[5],i[6]).length(),o=W_.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],G_.copy(this);const s=1/r,l=1/a,c=1/o;return G_.elements[0]*=s,G_.elements[1]*=s,G_.elements[2]*=s,G_.elements[4]*=l,G_.elements[5]*=l,G_.elements[6]*=l,G_.elements[8]*=c,G_.elements[9]*=c,G_.elements[10]*=c,t.setFromRotationMatrix(G_),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,i,r,a,o=2e3){const s=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i);let h,p;if(o===Cy)h=-(a+r)/(a-r),p=-2*a*r/(a-r);else{if(o!==Ty)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);h=-a/(a-r),p=-a*r/(a-r)}return s[0]=l,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=c,s[9]=d,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,i,r,a,o=2e3){const s=this.elements,l=1/(t-e),c=1/(n-i),u=1/(a-r),d=(t+e)*l,h=(n+i)*c;let p,m;if(o===Cy)p=(a+r)*u,m=-2*u;else{if(o!==Ty)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=r*u,m=-1*u}return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-d,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=m,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const W_=new p_,G_=new V_,$_=new p_(0,0,0),X_=new p_(1,1,1),q_=new p_,K_=new p_,Y_=new p_,Z_=new V_,J_=new h_;class Q_{constructor(e=0,t=0,n=0,i=Q_.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],c=i[9],u=i[2],d=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(Ly(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ly(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ly(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Ly(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Ly(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-Ly(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Z_.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Z_,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return J_.setFromEuler(this),this.setFromQuaternion(J_,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Q_.DEFAULT_ORDER="XYZ";class ex{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let tx=0;const nx=new p_,ix=new h_,rx=new V_,ax=new p_,ox=new p_,sx=new p_,lx=new h_,cx=new p_(1,0,0),ux=new p_(0,1,0),dx=new p_(0,0,1),hx={type:"added"},px={type:"removed"},mx={type:"childadded",child:null},fx={type:"childremoved",child:null};class gx extends Py{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:tx++}),this.uuid=Ry(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gx.DEFAULT_UP.clone();const e=new p_,t=new Q_,n=new h_,i=new p_(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new V_},normalMatrix:{value:new By}}),this.matrix=new V_,this.matrixWorld=new V_,this.matrixAutoUpdate=gx.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=gx.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ex,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ix.setFromAxisAngle(e,t),this.quaternion.multiply(ix),this}rotateOnWorldAxis(e,t){return ix.setFromAxisAngle(e,t),this.quaternion.premultiply(ix),this}rotateX(e){return this.rotateOnAxis(cx,e)}rotateY(e){return this.rotateOnAxis(ux,e)}rotateZ(e){return this.rotateOnAxis(dx,e)}translateOnAxis(e,t){return nx.copy(e).applyQuaternion(this.quaternion),this.position.add(nx.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(cx,e)}translateY(e){return this.translateOnAxis(ux,e)}translateZ(e){return this.translateOnAxis(dx,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(rx.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ax.copy(e):ax.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ox.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rx.lookAt(ox,ax,this.up):rx.lookAt(ax,ox,this.up),this.quaternion.setFromRotationMatrix(rx),i&&(rx.extractRotation(i.matrixWorld),ix.setFromRotationMatrix(rx),this.quaternion.premultiply(ix.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(hx),mx.child=e,this.dispatchEvent(mx),mx.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(px),fx.child=e,this.dispatchEvent(fx),fx.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),rx.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),rx.multiply(e.parent.matrixWorld)),e.applyMatrix4(rx),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ox,e,sx),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ox,lx,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=a(e.geometries),i=a(e.materials),r=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function a(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}gx.DEFAULT_UP=new p_(0,1,0),gx.DEFAULT_MATRIX_AUTO_UPDATE=!0,gx.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vx=new p_,yx=new p_,_x=new p_,xx=new p_,bx=new p_,Sx=new p_,wx=new p_,Mx=new p_,Ex=new p_,Cx=new p_;class Tx{constructor(e=new p_,t=new p_,n=new p_){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),vx.subVectors(e,t),i.cross(vx);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){vx.subVectors(i,t),yx.subVectors(n,t),_x.subVectors(e,t);const a=vx.dot(vx),o=vx.dot(yx),s=vx.dot(_x),l=yx.dot(yx),c=yx.dot(_x),u=a*l-o*o;if(0===u)return r.set(0,0,0),null;const d=1/u,h=(l*s-o*c)*d,p=(a*c-o*s)*d;return r.set(1-h-p,p,h)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,xx)&&(xx.x>=0&&xx.y>=0&&xx.x+xx.y<=1)}static getInterpolation(e,t,n,i,r,a,o,s){return null===this.getBarycoord(e,t,n,i,xx)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(r,xx.x),s.addScaledVector(a,xx.y),s.addScaledVector(o,xx.z),s)}static isFrontFacing(e,t,n,i){return vx.subVectors(n,t),yx.subVectors(e,t),vx.cross(yx).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vx.subVectors(this.c,this.b),yx.subVectors(this.a,this.b),.5*vx.cross(yx).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Tx.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Tx.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return Tx.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Tx.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Tx.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let a,o;bx.subVectors(i,n),Sx.subVectors(r,n),Mx.subVectors(e,n);const s=bx.dot(Mx),l=Sx.dot(Mx);if(s<=0&&l<=0)return t.copy(n);Ex.subVectors(e,i);const c=bx.dot(Ex),u=Sx.dot(Ex);if(c>=0&&u<=c)return t.copy(i);const d=s*u-c*l;if(d<=0&&s>=0&&c<=0)return a=s/(s-c),t.copy(n).addScaledVector(bx,a);Cx.subVectors(e,r);const h=bx.dot(Cx),p=Sx.dot(Cx);if(p>=0&&h<=p)return t.copy(r);const m=h*l-s*p;if(m<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(Sx,o);const f=c*p-h*u;if(f<=0&&u-c>=0&&h-p>=0)return wx.subVectors(r,i),o=(u-c)/(u-c+(h-p)),t.copy(i).addScaledVector(wx,o);const g=1/(f+m+d);return a=m*g,o=d*g,t.copy(n).addScaledVector(bx,a).addScaledVector(Sx,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Px={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kx={h:0,s:0,l:0},Ax={h:0,s:0,l:0};function Nx(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Rx{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=sy){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Zy.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Zy.workingColorSpace){return this.r=e,this.g=t,this.b=n,Zy.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Zy.workingColorSpace){var r;if(e=(e%(r=1)+r)%r,t=Ly(t,0,1),n=Ly(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Nx(r,i,e+1/3),this.g=Nx(r,i,e),this.b=Nx(r,i,e-1/3)}return Zy.toWorkingColorSpace(this,i),this}setStyle(e,t=sy){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=sy){const n=Px[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Jy(e.r),this.g=Jy(e.g),this.b=Jy(e.b),this}copyLinearToSRGB(e){return this.r=Qy(e.r),this.g=Qy(e.g),this.b=Qy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=sy){return Zy.fromWorkingColorSpace(Lx.copy(this),e),65536*Math.round(Ly(255*Lx.r,0,255))+256*Math.round(Ly(255*Lx.g,0,255))+Math.round(Ly(255*Lx.b,0,255))}getHexString(e=sy){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Zy.workingColorSpace){Zy.fromWorkingColorSpace(Lx.copy(this),t);const n=Lx.r,i=Lx.g,r=Lx.b,a=Math.max(n,i,r),o=Math.min(n,i,r);let s,l;const c=(o+a)/2;if(o===a)s=0,l=0;else{const e=a-o;switch(l=c<=.5?e/(a+o):e/(2-a-o),a){case n:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-n)/e+2;break;case r:s=(n-i)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e,t=Zy.workingColorSpace){return Zy.fromWorkingColorSpace(Lx.copy(this),t),e.r=Lx.r,e.g=Lx.g,e.b=Lx.b,e}getStyle(e=sy){Zy.fromWorkingColorSpace(Lx.copy(this),e);const t=Lx.r,n=Lx.g,i=Lx.b;return e!==sy?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(kx),this.setHSL(kx.h+e,kx.s+t,kx.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(kx),e.getHSL(Ax);const n=Iy(kx.h,Ax.h,t),i=Iy(kx.s,Ax.s,t),r=Iy(kx.l,Ax.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Lx=new Rx;Rx.NAMES=Px;let Ix=0;class jx extends Py{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ix++}),this.uuid=Ry(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=fv,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Rx(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=fy,this.stencilZFail=fy,this.stencilZPass=fy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==fv&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==fy&&(n.stencilFail=this.stencilFail),this.stencilZFail!==fy&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==fy&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Dx extends jx{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Rx(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Q_,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ux=new p_,Ox=new zy;class Fx{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Kv,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){var e;return(e="THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead.")in $y||($y[e]=!0,console.warn(e)),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ox.fromBufferAttribute(this,t),Ox.applyMatrix3(e),this.setXY(t,Ox.x,Ox.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ux.fromBufferAttribute(this,t),Ux.applyMatrix3(e),this.setXYZ(t,Ux.x,Ux.y,Ux.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ux.fromBufferAttribute(this,t),Ux.applyMatrix4(e),this.setXYZ(t,Ux.x,Ux.y,Ux.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ux.fromBufferAttribute(this,t),Ux.applyNormalMatrix(e),this.setXYZ(t,Ux.x,Ux.y,Ux.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ux.fromBufferAttribute(this,t),Ux.transformDirection(e),this.setXYZ(t,Ux.x,Ux.y,Ux.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Uy(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Oy(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Uy(t,this.array)),t}setX(e,t){return this.normalized&&(t=Oy(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Uy(t,this.array)),t}setY(e,t){return this.normalized&&(t=Oy(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Uy(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Oy(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Uy(t,this.array)),t}setW(e,t){return this.normalized&&(t=Oy(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Oy(t,this.array),n=Oy(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Oy(t,this.array),n=Oy(n,this.array),i=Oy(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Oy(t,this.array),n=Oy(n,this.array),i=Oy(i,this.array),r=Oy(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class zx extends Fx{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Bx extends Fx{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Hx extends Fx{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Vx=0;const Wx=new V_,Gx=new gx,$x=new p_,Xx=new g_,qx=new g_,Kx=new p_;class Yx extends Py{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vx++}),this.uuid=Ry(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Vy(e)?Bx:zx)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new By).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Wx.makeRotationFromQuaternion(e),this.applyMatrix4(Wx),this}rotateX(e){return Wx.makeRotationX(e),this.applyMatrix4(Wx),this}rotateY(e){return Wx.makeRotationY(e),this.applyMatrix4(Wx),this}rotateZ(e){return Wx.makeRotationZ(e),this.applyMatrix4(Wx),this}translate(e,t,n){return Wx.makeTranslation(e,t,n),this.applyMatrix4(Wx),this}scale(e,t,n){return Wx.makeScale(e,t,n),this.applyMatrix4(Wx),this}lookAt(e){return Gx.lookAt(e),Gx.updateMatrix(),this.applyMatrix4(Gx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($x).negate(),this.translate($x.x,$x.y,$x.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Hx(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new g_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new p_(-1/0,-1/0,-1/0),new p_(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];Xx.setFromBufferAttribute(e),this.morphTargetsRelative?(Kx.addVectors(this.boundingBox.min,Xx.min),this.boundingBox.expandByPoint(Kx),Kx.addVectors(this.boundingBox.max,Xx.max),this.boundingBox.expandByPoint(Kx)):(this.boundingBox.expandByPoint(Xx.min),this.boundingBox.expandByPoint(Xx.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new I_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new p_,1/0);if(e){const n=this.boundingSphere.center;if(Xx.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];qx.setFromBufferAttribute(n),this.morphTargetsRelative?(Kx.addVectors(Xx.min,qx.min),Xx.expandByPoint(Kx),Kx.addVectors(Xx.max,qx.max),Xx.expandByPoint(Kx)):(Xx.expandByPoint(qx.min),Xx.expandByPoint(qx.max))}Xx.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Kx.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Kx));if(t)for(let r=0,a=t.length;r<a;r++){const a=t[r],o=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)Kx.fromBufferAttribute(a,t),o&&($x.fromBufferAttribute(e,t),Kx.add($x)),i=Math.max(i,n.distanceToSquared(Kx))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Fx(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let w=0;w<n.count;w++)o[w]=new p_,s[w]=new p_;const l=new p_,c=new p_,u=new p_,d=new zy,h=new zy,p=new zy,m=new p_,f=new p_;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),d.fromBufferAttribute(r,e),h.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),h.sub(d),p.sub(d);const a=1/(h.x*p.y-p.x*h.y);isFinite(a)&&(m.copy(c).multiplyScalar(p.y).addScaledVector(u,-h.y).multiplyScalar(a),f.copy(u).multiplyScalar(h.x).addScaledVector(c,-p.x).multiplyScalar(a),o[e].add(m),o[t].add(m),o[i].add(m),s[e].add(f),s[t].add(f),s[i].add(f))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let w=0,M=v.length;w<M;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const y=new p_,_=new p_,x=new p_,b=new p_;function S(e){x.fromBufferAttribute(i,e),b.copy(x);const t=o[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),_.crossVectors(b,t);const n=_.dot(s[e])<0?-1:1;a.setXYZW(e,y.x,y.y,y.z,n)}for(let w=0,M=v.length;w<M;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)S(e.getX(i+0)),S(e.getX(i+1)),S(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Fx(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new p_,r=new p_,a=new p_,o=new p_,s=new p_,l=new p_,c=new p_,u=new p_;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);i.fromBufferAttribute(t,h),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,m),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,h),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),o.add(c),s.add(c),l.add(c),n.setXYZ(h,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Kx.fromBufferAttribute(e,t),Kx.normalize(),e.setXYZ(t,Kx.x,Kx.y,Kx.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i);let o=0,s=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)a[s++]=n[o++]}return new Fx(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Yx,n=this.index.array,i=this.attributes;for(const o in i){const r=e(i[o],n);t.setAttribute(o,r)}const r=this.morphAttributes;for(const o in r){const i=[],a=r[o];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);i.push(r)}t.morphAttributes[o]=i}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const i={};let r=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[s]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Zx=new V_,Jx=new H_,Qx=new I_,eb=new p_,tb=new p_,nb=new p_,ib=new p_,rb=new p_,ab=new p_,ob=new zy,sb=new zy,lb=new zy,cb=new p_,ub=new p_,db=new p_,hb=new p_,pb=new p_;class mb extends gx{constructor(e=new Yx,t=new Dx){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(r&&o){ab.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=o[n],s=r[n];0!==i&&(rb.fromBufferAttribute(s,e),a?ab.addScaledVector(rb,i):ab.addScaledVector(rb.sub(t),i))}t.add(ab)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Qx.copy(n.boundingSphere),Qx.applyMatrix4(r),Jx.copy(e.ray).recast(e.near),!1===Qx.containsPoint(Jx.origin)){if(null===Jx.intersectSphere(Qx,eb))return;if(Jx.origin.distanceToSquared(eb)>(e.far-e.near)**2)return}Zx.copy(r).invert(),Jx.copy(e.ray).applyMatrix4(Zx),null!==n.boundingBox&&!1===Jx.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Jx)}}_computeIntersections(e,t,n){let i;const r=this.geometry,a=this.material,o=r.index,s=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,d=r.groups,h=r.drawRange;if(null!==o)if(Array.isArray(a))for(let p=0,m=d.length;p<m;p++){const r=d[p],s=a[r.materialIndex];for(let a=Math.max(r.start,h.start),d=Math.min(o.count,Math.min(r.start+r.count,h.start+h.count));a<d;a+=3){i=fb(this,s,e,n,l,c,u,o.getX(a),o.getX(a+1),o.getX(a+2)),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,h.start),s=Math.min(o.count,h.start+h.count);r<s;r+=3){i=fb(this,a,e,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==s)if(Array.isArray(a))for(let p=0,m=d.length;p<m;p++){const r=d[p],o=a[r.materialIndex];for(let a=Math.max(r.start,h.start),d=Math.min(s.count,Math.min(r.start+r.count,h.start+h.count));a<d;a+=3){i=fb(this,o,e,n,l,c,u,a,a+1,a+2),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,h.start),o=Math.min(s.count,h.start+h.count);r<o;r+=3){i=fb(this,a,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function fb(e,t,n,i,r,a,o,s,l,c){e.getVertexPosition(s,tb),e.getVertexPosition(l,nb),e.getVertexPosition(c,ib);const u=function(e,t,n,i,r,a,o,s){let l;if(l=1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,0===t.side,s),null===l)return null;pb.copy(s),pb.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(pb);return c<n.near||c>n.far?null:{distance:c,point:pb.clone(),object:e}}(e,t,n,i,tb,nb,ib,hb);if(u){r&&(ob.fromBufferAttribute(r,s),sb.fromBufferAttribute(r,l),lb.fromBufferAttribute(r,c),u.uv=Tx.getInterpolation(hb,tb,nb,ib,ob,sb,lb,new zy)),a&&(ob.fromBufferAttribute(a,s),sb.fromBufferAttribute(a,l),lb.fromBufferAttribute(a,c),u.uv1=Tx.getInterpolation(hb,tb,nb,ib,ob,sb,lb,new zy)),o&&(cb.fromBufferAttribute(o,s),ub.fromBufferAttribute(o,l),db.fromBufferAttribute(o,c),u.normal=Tx.getInterpolation(hb,tb,nb,ib,cb,ub,db,new p_),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a:s,b:l,c:c,normal:new p_,materialIndex:0};Tx.getNormal(tb,nb,ib,e.normal),u.face=e}return u}class gb extends Yx{constructor(e=1,t=1,n=1,i=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const o=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const s=[],l=[],c=[],u=[];let d=0,h=0;function p(e,t,n,i,r,a,p,m,f,g,v){const y=a/f,_=p/g,x=a/2,b=p/2,S=m/2,w=f+1,M=g+1;let E=0,C=0;const T=new p_;for(let o=0;o<M;o++){const a=o*_-b;for(let s=0;s<w;s++){const d=s*y-x;T[e]=d*i,T[t]=a*r,T[n]=S,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=m>0?1:-1,c.push(T.x,T.y,T.z),u.push(s/f),u.push(1-o/g),E+=1}}for(let o=0;o<g;o++)for(let e=0;e<f;e++){const t=d+e+w*o,n=d+e+w*(o+1),i=d+(e+1)+w*(o+1),r=d+(e+1)+w*o;s.push(t,n,r),s.push(n,i,r),C+=6}o.addGroup(h,C,v),h+=C,d+=E}p("z","y","x",-1,-1,n,t,e,a,r,0),p("z","y","x",1,-1,n,t,-e,a,r,1),p("x","z","y",1,1,e,n,t,i,a,2),p("x","z","y",1,-1,e,n,-t,i,a,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new Hx(l,3)),this.setAttribute("normal",new Hx(c,3)),this.setAttribute("uv",new Hx(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gb(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function vb(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function yb(e){const t={};for(let n=0;n<e.length;n++){const i=vb(e[n]);for(const e in i)t[e]=i[e]}return t}function _b(e){return null===e.getRenderTarget()?e.outputColorSpace:Zy.workingColorSpace}const xb={clone:vb,merge:yb};class bb extends jx{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=vb(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Sb extends gx{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new V_,this.projectionMatrix=new V_,this.projectionMatrixInverse=new V_,this.coordinateSystem=Cy}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const wb=new p_,Mb=new zy,Eb=new zy;class Cb extends Sb{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ny*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ay*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ny*Math.atan(Math.tan(.5*Ay*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){wb.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(wb.x,wb.y).multiplyScalar(-e/wb.z),wb.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(wb.x,wb.y).multiplyScalar(-e/wb.z)}getViewSize(e,t){return this.getViewBounds(e,Mb,Eb),t.subVectors(Eb,Mb)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ay*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;r+=a.offsetX*i/e,t-=a.offsetY*n/o,i*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Tb=-90;class Pb extends gx{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Cb(Tb,1,e,t);i.layers=this.layers,this.add(i);const r=new Cb(Tb,1,e,t);r.layers=this.layers,this.add(r);const a=new Cb(Tb,1,e,t);a.layers=this.layers,this.add(a);const o=new Cb(Tb,1,e,t);o.layers=this.layers,this.add(o);const s=new Cb(Tb,1,e,t);s.layers=this.layers,this.add(s);const l=new Cb(Tb,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,a,o,s]=t;for(const l of t)this.remove(l);if(e===Cy)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==Ty)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,s,l,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,s),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,d,h),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class kb extends o_{constructor(e,t,n,i,r,a,o,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Lv,n,i,r,a,o,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ab extends c_{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new kb(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Hv}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new gb(5,5,5),r=new bb({name:"CubemapFromEquirect",uniforms:vb(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const a=new mb(i,r),o=t.minFilter;t.minFilter===Wv&&(t.minFilter=Hv);return new Pb(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}const Nb=new p_,Rb=new p_,Lb=new By;class Ib{constructor(e=new p_(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Nb.subVectors(n,t).cross(Rb.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Nb),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Lb.getNormalMatrix(e),i=this.coplanarPoint(Nb).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const jb=new I_,Db=new p_;class Ub{constructor(e=new Ib,t=new Ib,n=new Ib,i=new Ib,r=new Ib,a=new Ib){this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],p=i[9],m=i[10],f=i[11],g=i[12],v=i[13],y=i[14],_=i[15];if(n[0].setComponents(s-r,d-l,f-h,_-g).normalize(),n[1].setComponents(s+r,d+l,f+h,_+g).normalize(),n[2].setComponents(s+a,d+c,f+p,_+v).normalize(),n[3].setComponents(s-a,d-c,f-p,_-v).normalize(),n[4].setComponents(s-o,d-u,f-m,_-y).normalize(),t===Cy)n[5].setComponents(s+o,d+u,f+m,_+y).normalize();else{if(t!==Ty)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,u,m,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),jb.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),jb.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(jb)}intersectsSprite(e){return jb.center.set(0,0,0),jb.radius=.7071067811865476,jb.applyMatrix4(e.matrixWorld),this.intersectsSphere(jb)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Db.x=i.normal.x>0?e.max.x:e.min.x,Db.y=i.normal.y>0?e.max.y:e.min.y,Db.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Db)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ob(){let e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Fb(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=i.get(t);if(void 0===a)i.set(t,function(t,i){const r=t.array,a=t.usage,o=r.byteLength,s=e.createBuffer();let l;if(e.bindBuffer(i,s),e.bufferData(i,r,a),t.onUploadCallback(),r instanceof Float32Array)l=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=e.HALF_FLOAT}else l=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)l=e.SHORT;else if(r instanceof Uint32Array)l=e.UNSIGNED_INT;else if(r instanceof Int32Array)l=e.INT;else if(r instanceof Int8Array)l=e.BYTE;else if(r instanceof Uint8Array)l=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);l=e.UNSIGNED_BYTE}return{buffer:s,type:l,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:o}}(t,r));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,i,r){const a=i.array,o=i._updateRange,s=i.updateRanges;if(e.bindBuffer(r,t),-1===o.count&&0===s.length&&e.bufferSubData(r,0,a),0!==s.length){for(let t=0,i=s.length;t<i;t++){const i=s[t];n?e.bufferSubData(r,i.start*a.BYTES_PER_ELEMENT,a,i.start,i.count):e.bufferSubData(r,i.start*a.BYTES_PER_ELEMENT,a.subarray(i.start,i.start+i.count))}i.clearUpdateRanges()}-1!==o.count&&(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(a.buffer,t,r),a.version=t.version}}}}class zb extends Yx{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,a=t/2,o=Math.floor(n),s=Math.floor(i),l=o+1,c=s+1,u=e/o,d=t/s,h=[],p=[],m=[],f=[];for(let g=0;g<c;g++){const e=g*d-a;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),m.push(0,0,1),f.push(t/o),f.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;h.push(t,n,r),h.push(n,i,r)}this.setIndex(h),this.setAttribute("position",new Hx(p,3)),this.setAttribute("normal",new Hx(m,3)),this.setAttribute("uv",new Hx(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zb(e.width,e.height,e.widthSegments,e.heightSegments)}}const Bb={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tfloat startCompression = 0.8 - 0.04;\n\tfloat desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min(color.r, min(color.g, color.b));\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max(color.r, max(color.g, color.b));\n\tif (peak < startCompression) return color;\n\tfloat d = 1. - startCompression;\n\tfloat newPeak = 1. - d * d / (peak + d - startCompression);\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);\n\treturn mix(color, vec3(1, 1, 1), g);\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Hb={common:{diffuse:{value:new Rx(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new By},alphaMap:{value:null},alphaMapTransform:{value:new By},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new By}},envmap:{envMap:{value:null},envMapRotation:{value:new By},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new By}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new By}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new By},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new By},normalScale:{value:new zy(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new By},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new By}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new By}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new By}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rx(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rx(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new By},alphaTest:{value:0},uvTransform:{value:new By}},sprite:{diffuse:{value:new Rx(16777215)},opacity:{value:1},center:{value:new zy(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new By},alphaMap:{value:null},alphaMapTransform:{value:new By},alphaTest:{value:0}}},Vb={basic:{uniforms:yb([Hb.common,Hb.specularmap,Hb.envmap,Hb.aomap,Hb.lightmap,Hb.fog]),vertexShader:Bb.meshbasic_vert,fragmentShader:Bb.meshbasic_frag},lambert:{uniforms:yb([Hb.common,Hb.specularmap,Hb.envmap,Hb.aomap,Hb.lightmap,Hb.emissivemap,Hb.bumpmap,Hb.normalmap,Hb.displacementmap,Hb.fog,Hb.lights,{emissive:{value:new Rx(0)}}]),vertexShader:Bb.meshlambert_vert,fragmentShader:Bb.meshlambert_frag},phong:{uniforms:yb([Hb.common,Hb.specularmap,Hb.envmap,Hb.aomap,Hb.lightmap,Hb.emissivemap,Hb.bumpmap,Hb.normalmap,Hb.displacementmap,Hb.fog,Hb.lights,{emissive:{value:new Rx(0)},specular:{value:new Rx(1118481)},shininess:{value:30}}]),vertexShader:Bb.meshphong_vert,fragmentShader:Bb.meshphong_frag},standard:{uniforms:yb([Hb.common,Hb.envmap,Hb.aomap,Hb.lightmap,Hb.emissivemap,Hb.bumpmap,Hb.normalmap,Hb.displacementmap,Hb.roughnessmap,Hb.metalnessmap,Hb.fog,Hb.lights,{emissive:{value:new Rx(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Bb.meshphysical_vert,fragmentShader:Bb.meshphysical_frag},toon:{uniforms:yb([Hb.common,Hb.aomap,Hb.lightmap,Hb.emissivemap,Hb.bumpmap,Hb.normalmap,Hb.displacementmap,Hb.gradientmap,Hb.fog,Hb.lights,{emissive:{value:new Rx(0)}}]),vertexShader:Bb.meshtoon_vert,fragmentShader:Bb.meshtoon_frag},matcap:{uniforms:yb([Hb.common,Hb.bumpmap,Hb.normalmap,Hb.displacementmap,Hb.fog,{matcap:{value:null}}]),vertexShader:Bb.meshmatcap_vert,fragmentShader:Bb.meshmatcap_frag},points:{uniforms:yb([Hb.points,Hb.fog]),vertexShader:Bb.points_vert,fragmentShader:Bb.points_frag},dashed:{uniforms:yb([Hb.common,Hb.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Bb.linedashed_vert,fragmentShader:Bb.linedashed_frag},depth:{uniforms:yb([Hb.common,Hb.displacementmap]),vertexShader:Bb.depth_vert,fragmentShader:Bb.depth_frag},normal:{uniforms:yb([Hb.common,Hb.bumpmap,Hb.normalmap,Hb.displacementmap,{opacity:{value:1}}]),vertexShader:Bb.meshnormal_vert,fragmentShader:Bb.meshnormal_frag},sprite:{uniforms:yb([Hb.sprite,Hb.fog]),vertexShader:Bb.sprite_vert,fragmentShader:Bb.sprite_frag},background:{uniforms:{uvTransform:{value:new By},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Bb.background_vert,fragmentShader:Bb.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new By}},vertexShader:Bb.backgroundCube_vert,fragmentShader:Bb.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Bb.cube_vert,fragmentShader:Bb.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Bb.equirect_vert,fragmentShader:Bb.equirect_frag},distanceRGBA:{uniforms:yb([Hb.common,Hb.displacementmap,{referencePosition:{value:new p_},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Bb.distanceRGBA_vert,fragmentShader:Bb.distanceRGBA_frag},shadow:{uniforms:yb([Hb.lights,Hb.fog,{color:{value:new Rx(0)},opacity:{value:1}}]),vertexShader:Bb.shadow_vert,fragmentShader:Bb.shadow_frag}};Vb.physical={uniforms:yb([Vb.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new By},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new By},clearcoatNormalScale:{value:new zy(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new By},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new By},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new By},sheen:{value:0},sheenColor:{value:new Rx(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new By},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new By},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new By},transmissionSamplerSize:{value:new zy},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new By},attenuationDistance:{value:0},attenuationColor:{value:new Rx(0)},specularColor:{value:new Rx(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new By},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new By},anisotropyVector:{value:new zy},anisotropyMap:{value:null},anisotropyMapTransform:{value:new By}}]),vertexShader:Bb.meshphysical_vert,fragmentShader:Bb.meshphysical_frag};const Wb={r:0,b:0,g:0},Gb=new Q_,$b=new V_;function Xb(e,t,n,i,r,a,o){const s=new Rx(0);let l,c,u=!0===a?0:1,d=null,h=0,p=null;function m(t,n){t.getRGB(Wb,_b(e)),i.buffers.color.setClear(Wb.r,Wb.g,Wb.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),u=t,m(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(s,u)},render:function(a,f){let g=!1,v=!0===f.isScene?f.background:null;if(v&&v.isTexture){v=(f.backgroundBlurriness>0?n:t).get(v)}null===v?m(s,u):v&&v.isColor&&(m(v,1),g=!0);const y=e.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,o),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===jv)?(void 0===c&&(c=new mb(new gb(1,1,1),new bb({name:"BackgroundCubeMaterial",uniforms:vb(Vb.backgroundCube.uniforms),vertexShader:Vb.backgroundCube.vertexShader,fragmentShader:Vb.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Gb.copy(f.backgroundRotation),Gb.x*=-1,Gb.y*=-1,Gb.z*=-1,v.isCubeTexture&&!1===v.isRenderTargetTexture&&(Gb.y*=-1,Gb.z*=-1),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4($b.makeRotationFromEuler(Gb)),c.material.toneMapped=Zy.getTransfer(v.colorSpace)!==hy,d===v&&h===v.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=v,h=v.version,p=e.toneMapping),c.layers.enableAll(),a.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===l&&(l=new mb(new zb(2,2),new bb({name:"BackgroundMaterial",uniforms:vb(Vb.background.uniforms),vertexShader:Vb.background.vertexShader,fragmentShader:Vb.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,l.material.toneMapped=Zy.getTransfer(v.colorSpace)!==hy,!0===v.matrixAutoUpdate&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),d===v&&h===v.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=v,h=v.version,p=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function qb(e,t,n,i){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},l=p(null);let c=l,u=!1;function d(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function m(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){g(e,0)}function g(n,r){const a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;if(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r}}function v(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function y(t,n,i,r,a,o,s){!0===s?e.vertexAttribIPointer(t,n,i,a,o):e.vertexAttribPointer(t,n,i,r,a,o)}function _(){x(),u=!0,c!==l&&(c=l,d(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,_,x){let b=!1;if(o){const t=function(t,n,r){const o=!0===r.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[o]=u);return u}(_,h,l);c!==t&&(c=t,d(c.object)),b=function(e,t,n,i){const r=c.attributes,a=t.attributes;let o=0;const s=n.getAttributes();for(const l in s){if(s[l].location>=0){const t=r[l];let n=a[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return c.attributesNum!==o||c.index!==i}(r,_,h,x),b&&function(e,t,n,i){const r={},a=t.attributes;let o=0;const s=n.getAttributes();for(const l in s){if(s[l].location>=0){let t=a[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[l]=n,o++}}c.attributes=r,c.attributesNum=o,c.index=i}(r,_,h,x)}else{const e=!0===l.wireframe;c.geometry===_.id&&c.program===h.id&&c.wireframe===e||(c.geometry=_.id,c.program=h.id,c.wireframe=e,b=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(b||u)&&(u=!1,function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;m();const l=s.attributes,c=o.getAttributes(),u=a.defaultAttributeValues;for(const t in c){const a=c[t];if(a.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){const t=o.normalized,l=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,d=c.type,h=c.bytesPerElement,p=!0===i.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||o.gpuType===Xv);if(o.isInterleavedBufferAttribute){const n=o.data,i=n.stride,c=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<a.locationSize;e++)f(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,i*h,(c+l/a.locationSize*e)*h,p)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<a.locationSize;e++)f(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,l*h,l/a.locationSize*e*h,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(a.location,n);break;case 3:e.vertexAttrib3fv(a.location,n);break;case 4:e.vertexAttrib4fv(a.location,n);break;default:e.vertexAttrib1fv(a.location,n)}}}}v()}(r,l,h,_),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:_,resetDefaultState:x,dispose:function(){_();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const n in t){const e=t[n];for(const t in e)h(e[t].object),delete e[t];delete t[n]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:v}}function Kb(e,t,n,i){const r=i.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,i){e.drawArrays(a,t,i),n.update(i,a,1)},this.renderInstances=function(i,o,s){if(0===s)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](a,i,o,s),n.update(o,a,s)},this.renderMultiDraw=function(e,i,r){if(0===r)return;const o=t.get("WEBGL_multi_draw");if(null===o)for(let t=0;t<r;t++)this.render(e[t],i[t]);else{o.multiDrawArraysWEBGL(a,e,0,i,0,r);let t=0;for(let e=0;e<r;e++)t+=i[e];n.update(t,a,1)}}}function Yb(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==n.precision?n.precision:"highp";const s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,_=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function Zb(e){const t=this;let n=null,i=0,r=!1,a=!1;const o=new Ib,s=new By,l={value:null,needsUpdate:!1};function c(e,n,i,r){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==r||null===c){const t=i+4*a,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==a;++n,l+=4)o.copy(e[n]).applyMatrix4(r,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,s,u){const d=o.clippingPlanes,h=o.clipIntersection,p=o.clipShadows,m=e.get(o);if(!r||null===d||0===d.length||a&&!p)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=a?0:i,t=4*e;let r=m.clippingState||null;l.value=r,r=c(d,s,t,u);for(let i=0;i!==t;++i)r[i]=n[i];m.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function Jb(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=Lv:304===t&&(e.mapping=Iv),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping;if(303===a||304===a){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const a=r.image;if(a&&a.height>0){const o=new Ab(a.height);return o.fromEquirectangularTexture(e,r),t.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class Qb extends Sb{constructor(e=-1,t=1,n=1,i=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const eS=[.125,.215,.35,.446,.526,.582],tS=20,nS=new Qb,iS=new Rx;let rS=null,aS=0,oS=0;const sS=(1+Math.sqrt(5))/2,lS=1/sS,cS=[new p_(1,1,1),new p_(-1,1,1),new p_(1,1,-1),new p_(-1,1,-1),new p_(0,sS,lS),new p_(0,sS,-lS),new p_(lS,0,sS),new p_(-lS,0,sS),new p_(sS,lS,0),new p_(-sS,lS,0)];class uS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){rS=this._renderer.getRenderTarget(),aS=this._renderer.getActiveCubeFace(),oS=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=mS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=pS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(rS,aS,oS),e.scissorTest=!1,hS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Lv||e.mapping===Iv?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),rS=this._renderer.getRenderTarget(),aS=this._renderer.getActiveCubeFace(),oS=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Hv,minFilter:Hv,generateMipmaps:!1,type:Yv,format:Jv,colorSpace:ly,depthBuffer:!1},i=dS(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=dS(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const a=e-4+1+eS.length;for(let o=0;o<a;o++){const a=Math.pow(2,r);n.push(a);let s=1/a;o>e-4?s=eS[o-e+4-1]:0===o&&(s=0),i.push(s);const l=1/(a-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,m=3,f=2,g=1,v=new Float32Array(m*p*h),y=new Float32Array(f*p*h),_=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,m*p*e),y.set(d,f*p*e);const r=[e,e,e,e,e,e];_.set(r,g*p*e)}const x=new Yx;x.setAttribute("position",new Fx(v,m)),x.setAttribute("uv",new Fx(y,f)),x.setAttribute("faceIndex",new Fx(_,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(tS),r=new p_(0,1,0),a=new bb({name:"SphericalGaussianBlur",defines:{n:tS,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:fS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return a}(i,e,t)}return i}_compileMaterial(e){const t=new mb(this._lodPlanes[0],e);this._renderer.compile(t,nS)}_sceneToCubeUV(e,t,n,i){const r=new Cb(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.toneMapping;s.getClearColor(iS),s.toneMapping=0,s.autoClear=!1;const u=new Dx({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new mb(new gb,u);let h=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,h=!0):(u.color.copy(iS),h=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(r.up.set(0,a[m],0),r.lookAt(o[m],0,0)):1===t?(r.up.set(0,0,a[m]),r.lookAt(0,o[m],0)):(r.up.set(0,a[m],0),r.lookAt(0,0,o[m]));const n=this._cubeSize;hS(i,t*n,m>2?n:0,n,n),s.setRenderTarget(i),h&&s.render(d,r),s.render(e,r)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Lv||e.mapping===Iv;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=mS()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=pS());const r=i?this._cubemapMaterial:this._equirectMaterial,a=new mb(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const o=this._cubeSize;hS(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,nS)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=cS[(i-1)%cS.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new mb(this._lodPlanes[i],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/h,m=isFinite(r)?1+Math.floor(3*p):tS;m>tS&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let _=0;_<tS;++_){const e=_/p,t=Math.exp(-e*e/2);f.push(t),0===_?g+=t:_<m&&(g+=2*t)}for(let _=0;_<f.length;_++)f[_]=f[_]/g;u.envMap.value=e.texture,u.samples.value=m,u.weights.value=f,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=h,u.mipInt.value=v-n;const y=this._sizeLods[i];hS(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(c,nS)}}function dS(e,t,n){const i=new c_(e,t,n);return i.texture.mapping=jv,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function hS(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function pS(){return new bb({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:fS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function mS(){return new bb({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:fS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function fS(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function gS(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping,o=303===a||304===a,s=a===Lv||a===Iv;if(o||s){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new uS(e)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const a=r.image;if(o&&a&&a.height>0||s&&a&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(a)){null===n&&(n=new uS(e));const a=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,a),r.addEventListener("dispose",i),a.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function vS(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?(n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance")):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function yS(e,t,n,i){const r={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);for(const n in s.morphAttributes){const e=s.morphAttributes[n];for(let n=0,i=e.length;n<i;n++)t.remove(e[n])}s.removeEventListener("dispose",o),delete r[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],i=e.index,r=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],a=e[t+2];n.push(i,r,r,a,a,i)}}else{if(void 0===r)return;{const e=r.array;o=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const s=new(Vy(n)?Bx:zx)(n,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const a in i)t.update(i[a],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const a in r){const n=r[a];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function _S(e,t,n,i){const r=i.isWebGL2;let a,o,s;this.setMode=function(e){a=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(a,i,o,t*s),n.update(i,a,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,d;if(r)u=e,d="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](a,l,o,i*s,c),n.update(l,a,c)},this.renderMultiDraw=function(e,i,r){if(0===r)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<r;t++)this.render(e[t]/s,i[t]);else{l.multiDrawElementsWEBGL(a,i,0,o,e,0,r);let t=0;for(let e=0;e<r;e++)t+=i[e];n.update(t,a,1)}}}function xS(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function bS(e,t){return e[0]-t[0]}function SS(e,t){return Math.abs(t[1])-Math.abs(e[1])}function wS(e,t,n){const i={},r=new Float32Array(8),a=new WeakMap,o=new s_,s=[];for(let l=0;l<8;l++)s[l]=[l,0];return{update:function(l,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const i=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==i?i.length:0;let s=a.get(c);if(void 0===s||s.count!==r){let e=function(){v.dispose(),a.delete(c),c.removeEventListener("dispose",e)};void 0!==s&&s.texture.dispose();const n=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,u=c.morphAttributes.position||[],d=c.morphAttributes.normal||[],h=c.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===i&&(p=2),!0===l&&(p=3);let m=c.attributes.position.count*p,f=1;m>t.maxTextureSize&&(f=Math.ceil(m/t.maxTextureSize),m=t.maxTextureSize);const g=new Float32Array(m*f*4*r),v=new u_(g,m,f,r);v.type=Kv,v.needsUpdate=!0;const y=4*p;for(let t=0;t<r;t++){const e=u[t],r=d[t],a=h[t],s=m*f*4*t;for(let t=0;t<e.count;t++){const c=t*y;!0===n&&(o.fromBufferAttribute(e,t),g[s+c+0]=o.x,g[s+c+1]=o.y,g[s+c+2]=o.z,g[s+c+3]=0),!0===i&&(o.fromBufferAttribute(r,t),g[s+c+4]=o.x,g[s+c+5]=o.y,g[s+c+6]=o.z,g[s+c+7]=0),!0===l&&(o.fromBufferAttribute(a,t),g[s+c+8]=o.x,g[s+c+9]=o.y,g[s+c+10]=o.z,g[s+c+11]=4===a.itemSize?o.w:1)}}s={count:r,texture:v,size:new zy(m,f)},a.set(c,s),c.addEventListener("dispose",e)}if(!0===l.isInstancedMesh&&null!==l.morphTexture)u.getUniforms().setValue(e,"morphTexture",l.morphTexture,n);else{let t=0;for(let e=0;e<d.length;e++)t+=d[e];const n=c.morphTargetsRelative?1:1-t;u.getUniforms().setValue(e,"morphTargetBaseInfluence",n),u.getUniforms().setValue(e,"morphTargetInfluences",d)}u.getUniforms().setValue(e,"morphTargetsTexture",s.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",s.size)}else{const t=void 0===d?0:d.length;let n=i[c.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[c.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=d[e]}n.sort(SS);for(let e=0;e<8;e++)e<t&&n[e][1]?(s[e][0]=n[e][0],s[e][1]=n[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(bS);const a=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=s[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(a&&c.getAttribute("morphTarget"+e)!==a[n]&&c.setAttribute("morphTarget"+e,a[n]),o&&c.getAttribute("morphNormal"+e)!==o[n]&&c.setAttribute("morphNormal"+e,o[n]),r[e]=i,l+=i):(a&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",h),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function MS(e,t,n,i){let r=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const s=i.render.frame,l=o.geometry,c=t.get(o,l);if(r.get(c)!==s&&(t.update(c),r.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),r.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),r.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;r.get(e)!==s&&(e.update(),r.set(e,s))}return c},dispose:function(){r=new WeakMap}}}class ES extends o_{constructor(e,t,n,i,r,a,o,s,l,c){if((c=void 0!==c?c:Qv)!==Qv&&c!==ey)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Qv&&(n=qv),void 0===n&&c===ey&&(n=Zv),super(null,i,r,a,o,s,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:Fv,this.minFilter=void 0!==s?s:Fv,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const CS=new o_,TS=new ES(1,1);TS.compareFunction=515;const PS=new u_,kS=new d_,AS=new kb,NS=[],RS=[],LS=new Float32Array(16),IS=new Float32Array(9),jS=new Float32Array(4);function DS(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let a=NS[r];if(void 0===a&&(a=new Float32Array(r),NS[r]=a),0!==t){i.toArray(a,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(a,r)}return a}function US(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function OS(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function FS(e,t){let n=RS[t];void 0===n&&(n=new Int32Array(t),RS[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function zS(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function BS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(US(n,t))return;e.uniform2fv(this.addr,t),OS(n,t)}}function HS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(US(n,t))return;e.uniform3fv(this.addr,t),OS(n,t)}}function VS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(US(n,t))return;e.uniform4fv(this.addr,t),OS(n,t)}}function WS(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(US(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),OS(n,t)}else{if(US(n,i))return;jS.set(i),e.uniformMatrix2fv(this.addr,!1,jS),OS(n,i)}}function GS(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(US(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),OS(n,t)}else{if(US(n,i))return;IS.set(i),e.uniformMatrix3fv(this.addr,!1,IS),OS(n,i)}}function $S(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(US(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),OS(n,t)}else{if(US(n,i))return;LS.set(i),e.uniformMatrix4fv(this.addr,!1,LS),OS(n,i)}}function XS(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function qS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(US(n,t))return;e.uniform2iv(this.addr,t),OS(n,t)}}function KS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(US(n,t))return;e.uniform3iv(this.addr,t),OS(n,t)}}function YS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(US(n,t))return;e.uniform4iv(this.addr,t),OS(n,t)}}function ZS(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function JS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(US(n,t))return;e.uniform2uiv(this.addr,t),OS(n,t)}}function QS(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(US(n,t))return;e.uniform3uiv(this.addr,t),OS(n,t)}}function ew(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(US(n,t))return;e.uniform4uiv(this.addr,t),OS(n,t)}}function tw(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r);const a=this.type===e.SAMPLER_2D_SHADOW?TS:CS;n.setTexture2D(t||a,r)}function nw(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||kS,r)}function iw(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||AS,r)}function rw(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||PS,r)}function aw(e,t){e.uniform1fv(this.addr,t)}function ow(e,t){const n=DS(t,this.size,2);e.uniform2fv(this.addr,n)}function sw(e,t){const n=DS(t,this.size,3);e.uniform3fv(this.addr,n)}function lw(e,t){const n=DS(t,this.size,4);e.uniform4fv(this.addr,n)}function cw(e,t){const n=DS(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function uw(e,t){const n=DS(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function dw(e,t){const n=DS(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function hw(e,t){e.uniform1iv(this.addr,t)}function pw(e,t){e.uniform2iv(this.addr,t)}function mw(e,t){e.uniform3iv(this.addr,t)}function fw(e,t){e.uniform4iv(this.addr,t)}function gw(e,t){e.uniform1uiv(this.addr,t)}function vw(e,t){e.uniform2uiv(this.addr,t)}function yw(e,t){e.uniform3uiv(this.addr,t)}function _w(e,t){e.uniform4uiv(this.addr,t)}function xw(e,t,n){const i=this.cache,r=t.length,a=FS(n,r);US(i,a)||(e.uniform1iv(this.addr,a),OS(i,a));for(let o=0;o!==r;++o)n.setTexture2D(t[o]||CS,a[o])}function bw(e,t,n){const i=this.cache,r=t.length,a=FS(n,r);US(i,a)||(e.uniform1iv(this.addr,a),OS(i,a));for(let o=0;o!==r;++o)n.setTexture3D(t[o]||kS,a[o])}function Sw(e,t,n){const i=this.cache,r=t.length,a=FS(n,r);US(i,a)||(e.uniform1iv(this.addr,a),OS(i,a));for(let o=0;o!==r;++o)n.setTextureCube(t[o]||AS,a[o])}function ww(e,t,n){const i=this.cache,r=t.length,a=FS(n,r);US(i,a)||(e.uniform1iv(this.addr,a),OS(i,a));for(let o=0;o!==r;++o)n.setTexture2DArray(t[o]||PS,a[o])}class Mw{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return zS;case 35664:return BS;case 35665:return HS;case 35666:return VS;case 35674:return WS;case 35675:return GS;case 35676:return $S;case 5124:case 35670:return XS;case 35667:case 35671:return qS;case 35668:case 35672:return KS;case 35669:case 35673:return YS;case 5125:return ZS;case 36294:return JS;case 36295:return QS;case 36296:return ew;case 35678:case 36198:case 36298:case 36306:case 35682:return tw;case 35679:case 36299:case 36307:return nw;case 35680:case 36300:case 36308:case 36293:return iw;case 36289:case 36303:case 36311:case 36292:return rw}}(t.type)}}class Ew{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return aw;case 35664:return ow;case 35665:return sw;case 35666:return lw;case 35674:return cw;case 35675:return uw;case 35676:return dw;case 5124:case 35670:return hw;case 35667:case 35671:return pw;case 35668:case 35672:return mw;case 35669:case 35673:return fw;case 5125:return gw;case 36294:return vw;case 36295:return yw;case 36296:return _w;case 35678:case 36198:case 36298:case 36306:case 35682:return xw;case 35679:case 36299:case 36307:return bw;case 35680:case 36300:case 36308:case 36293:return Sw;case 36289:case 36303:case 36311:case 36292:return ww}}(t.type)}}class Cw{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const a=i[r];a.setValue(e,t[a.id],n)}}}const Tw=/(\w+)(\])?(\[|\.)?/g;function Pw(e,t){e.seq.push(t),e.map[t.id]=t}function kw(e,t,n){const i=e.name,r=i.length;for(Tw.lastIndex=0;;){const a=Tw.exec(i),o=Tw.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){Pw(n,void 0===c?new Mw(s,e,t):new Ew(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new Cw(s),Pw(n,e)),n=e}}}class Aw{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);kw(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,a=t.length;r!==a;++r){const a=t[r],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function Nw(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let Rw=0;function Lw(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const i=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=r;o<a;o++){const e=o+1;i.push(`${e===t?">":" "} ${e}: ${n[o]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function Iw(e,t){const n=function(e){const t=Zy.getPrimaries(Zy.workingColorSpace),n=Zy.getPrimaries(e);let i;switch(t===n?i="":t===my&&n===py?i="LinearDisplayP3ToLinearSRGB":t===py&&n===my&&(i="LinearSRGBToLinearDisplayP3"),e){case ly:case uy:return[i,"LinearTransferOETF"];case sy:case cy:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function jw(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Dw(e){return""!==e}function Uw(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ow(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Fw=/^[ \t]*#include +<([\w\d./]+)>/gm;function zw(e){return e.replace(Fw,Hw)}const Bw=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Hw(e,t){let n=Bb[t];if(void 0===n){const e=Bw.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=Bb[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return zw(n)}const Vw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ww(e){return e.replace(Vw,Gw)}function Gw(e,t,n,i){let r="";for(let a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function $w(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\t`;return e.isWebGL2&&(t+=`precision ${e.precision} sampler3D;\n\t\tprecision ${e.precision} sampler2DArray;\n\t\tprecision ${e.precision} sampler2DShadow;\n\t\tprecision ${e.precision} samplerCubeShadow;\n\t\tprecision ${e.precision} sampler2DArrayShadow;\n\t\tprecision ${e.precision} isampler2D;\n\t\tprecision ${e.precision} isampler3D;\n\t\tprecision ${e.precision} isamplerCube;\n\t\tprecision ${e.precision} isampler2DArray;\n\t\tprecision ${e.precision} usampler2D;\n\t\tprecision ${e.precision} usampler3D;\n\t\tprecision ${e.precision} usamplerCube;\n\t\tprecision ${e.precision} usampler2DArray;\n\t\t`),"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Xw(e,t,n,i){const r=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Lv:case Iv:t="ENVMAP_TYPE_CUBE";break;case jv:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Iv&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||e.alphaToCoverage||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Dw).join("\n")}(n),m=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Dw).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(a),g=r.createProgram();let v,y,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Dw).join("\n"),v.length>0&&(v+="\n"),y=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Dw).join("\n"),y.length>0&&(y+="\n")):(v=[$w(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Dw).join("\n"),y=[p,$w(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Bb.tonemapping_pars_fragment:"",0!==n.toneMapping?jw("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Bb.colorspace_pars_fragment,Iw("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Dw).join("\n")),o=zw(o),o=Uw(o,n),o=Ow(o,n),s=zw(s),s=Uw(s,n),s=Ow(s,n),o=Ww(o),s=Ww(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",v=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,y=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===My?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===My?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const x=_+v+o,b=_+y+s,S=Nw(r,r.VERTEX_SHADER,x),w=Nw(r,r.FRAGMENT_SHADER,b);function M(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(g).trim(),i=r.getShaderInfoLog(S).trim(),a=r.getShaderInfoLog(w).trim();let o=!0,s=!0;if(!1===r.getProgramParameter(g,r.LINK_STATUS))if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,g,S,w);else{const e=Lw(r,S,"vertex"),i=Lw(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==a||(s=!1);s&&(t.diagnostics={runnable:o,programLog:n,vertexShader:{log:i,prefix:v},fragmentShader:{log:a,prefix:y}})}r.deleteShader(S),r.deleteShader(w),E=new Aw(r,g),C=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),a=i.name;let o=1;i.type===e.FLOAT_MAT2&&(o=2),i.type===e.FLOAT_MAT3&&(o=3),i.type===e.FLOAT_MAT4&&(o=4),n[a]={type:i.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(r,g)}let E,C;r.attachShader(g,S),r.attachShader(g,w),void 0!==n.index0AttributeName?r.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g),this.getUniforms=function(){return void 0===E&&M(this),E},this.getAttributes=function(){return void 0===C&&M(this),C};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=r.getProgramParameter(g,37297)),T},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Rw++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=w,this}let qw=0;class Kw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Yw(e),t.set(e,n)),n}}class Yw{constructor(e){this.id=qw++,this.code=e,this.usedTimes=0}}function Zw(e,t,n,i,r,a,o){const s=new ex,l=new Kw,c=new Set,u=[],d=r.isWebGL2,h=r.logarithmicDepthBuffer,p=r.vertexTextures;let m=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,s,u,v,y){const _=v.fog,x=y.geometry,b=a.isMeshStandardMaterial?v.environment:null,S=(a.isMeshStandardMaterial?n:t).get(a.envMap||b),w=S&&S.mapping===jv?S.image.height:null,M=f[a.type];null!==a.precision&&(m=r.getMaxPrecision(a.precision),m!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",m,"instead."));const E=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,C=void 0!==E?E.length:0;let T,P,k,A,N=0;if(void 0!==x.morphAttributes.position&&(N=1),void 0!==x.morphAttributes.normal&&(N=2),void 0!==x.morphAttributes.color&&(N=3),M){const e=Vb[M];T=e.vertexShader,P=e.fragmentShader}else T=a.vertexShader,P=a.fragmentShader,l.update(a),k=l.getVertexShaderID(a),A=l.getFragmentShaderID(a);const R=e.getRenderTarget(),L=!0===y.isInstancedMesh,I=!0===y.isBatchedMesh,j=!!a.map,D=!!a.matcap,U=!!S,O=!!a.aoMap,F=!!a.lightMap,z=!!a.bumpMap,B=!!a.normalMap,H=!!a.displacementMap,V=!!a.emissiveMap,W=!!a.metalnessMap,G=!!a.roughnessMap,$=a.anisotropy>0,X=a.clearcoat>0,q=a.iridescence>0,K=a.sheen>0,Y=a.transmission>0,Z=$&&!!a.anisotropyMap,J=X&&!!a.clearcoatMap,Q=X&&!!a.clearcoatNormalMap,ee=X&&!!a.clearcoatRoughnessMap,te=q&&!!a.iridescenceMap,ne=q&&!!a.iridescenceThicknessMap,ie=K&&!!a.sheenColorMap,re=K&&!!a.sheenRoughnessMap,ae=!!a.specularMap,oe=!!a.specularColorMap,se=!!a.specularIntensityMap,le=Y&&!!a.transmissionMap,ce=Y&&!!a.thicknessMap,ue=!!a.gradientMap,de=!!a.alphaMap,he=a.alphaTest>0,pe=!!a.alphaHash,me=!!a.extensions;let fe=0;a.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(fe=e.toneMapping));const ge={isWebGL2:d,shaderID:M,shaderType:a.type,shaderName:a.name,vertexShader:T,fragmentShader:P,defines:a.defines,customVertexShaderID:k,customFragmentShaderID:A,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:m,batching:I,instancing:L,instancingColor:L&&null!==y.instanceColor,instancingMorph:L&&null!==y.morphTexture,supportsVertexTextures:p,outputColorSpace:null===R?e.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:ly,alphaToCoverage:!!a.alphaToCoverage,map:j,matcap:D,envMap:U,envMapMode:U&&S.mapping,envMapCubeUVHeight:w,aoMap:O,lightMap:F,bumpMap:z,normalMap:B,displacementMap:p&&H,emissiveMap:V,normalMapObjectSpace:B&&1===a.normalMapType,normalMapTangentSpace:B&&0===a.normalMapType,metalnessMap:W,roughnessMap:G,anisotropy:$,anisotropyMap:Z,clearcoat:X,clearcoatMap:J,clearcoatNormalMap:Q,clearcoatRoughnessMap:ee,iridescence:q,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:K,sheenColorMap:ie,sheenRoughnessMap:re,specularMap:ae,specularColorMap:oe,specularIntensityMap:se,transmission:Y,transmissionMap:le,thicknessMap:ce,gradientMap:ue,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:de,alphaTest:he,alphaHash:pe,combine:a.combine,mapUv:j&&g(a.map.channel),aoMapUv:O&&g(a.aoMap.channel),lightMapUv:F&&g(a.lightMap.channel),bumpMapUv:z&&g(a.bumpMap.channel),normalMapUv:B&&g(a.normalMap.channel),displacementMapUv:H&&g(a.displacementMap.channel),emissiveMapUv:V&&g(a.emissiveMap.channel),metalnessMapUv:W&&g(a.metalnessMap.channel),roughnessMapUv:G&&g(a.roughnessMap.channel),anisotropyMapUv:Z&&g(a.anisotropyMap.channel),clearcoatMapUv:J&&g(a.clearcoatMap.channel),clearcoatNormalMapUv:Q&&g(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&g(a.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&g(a.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&g(a.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&g(a.sheenColorMap.channel),sheenRoughnessMapUv:re&&g(a.sheenRoughnessMap.channel),specularMapUv:ae&&g(a.specularMap.channel),specularColorMapUv:oe&&g(a.specularColorMap.channel),specularIntensityMapUv:se&&g(a.specularIntensityMap.channel),transmissionMapUv:le&&g(a.transmissionMap.channel),thicknessMapUv:ce&&g(a.thicknessMap.channel),alphaMapUv:de&&g(a.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(B||$),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!x.attributes.uv&&(j||de),fog:!!_,useFog:!0===a.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:C,morphTextureStride:N,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:fe,useLegacyLights:e._useLegacyLights,decodeVideoTexture:j&&!0===a.map.isVideoTexture&&Zy.getTransfer(a.map.colorSpace)===hy,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:me&&!0===a.extensions.derivatives,extensionFragDepth:me&&!0===a.extensions.fragDepth,extensionDrawBuffers:me&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:me&&!0===a.extensions.shaderTextureLOD,extensionClipCullDistance:me&&!0===a.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:me&&!0===a.extensions.multiDraw&&i.has("WEBGL_multi_draw"),rendererExtensionFragDepth:d||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ge.vertexUv1s=c.has(1),ge.vertexUv2s=c.has(2),ge.vertexUv3s=c.has(3),c.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.instancingMorph&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.normalMapObjectSpace&&s.enable(7);t.normalMapTangentSpace&&s.enable(8);t.clearcoat&&s.enable(9);t.iridescence&&s.enable(10);t.alphaTest&&s.enable(11);t.vertexColors&&s.enable(12);t.vertexAlphas&&s.enable(13);t.vertexUv1s&&s.enable(14);t.vertexUv2s&&s.enable(15);t.vertexUv3s&&s.enable(16);t.vertexTangents&&s.enable(17);t.anisotropy&&s.enable(18);t.alphaHash&&s.enable(19);t.batching&&s.enable(20);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);t.decodeVideoTexture&&s.enable(19);t.alphaToCoverage&&s.enable(20);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=Vb[t];n=xb.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=u.length;e<r;e++){const t=u[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Xw(e,n,t,a),u.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function Jw(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Qw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function eM(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function tM(){const e=[];let t=0;const n=[],i=[],r=[];function a(n,i,r,a,o,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Qw),i.length>1&&i.sort(t||eM),r.length>1&&r.sort(t||eM)}}}function nM(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new tM,e.set(t,[r])):n>=i.length?(r=new tM,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function iM(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new p_,color:new Rx};break;case"SpotLight":n={position:new p_,direction:new p_,color:new Rx,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new p_,color:new Rx,distance:0,decay:0};break;case"HemisphereLight":n={direction:new p_,skyColor:new Rx,groundColor:new Rx};break;case"RectAreaLight":n={color:new Rx,position:new p_,halfWidth:new p_,halfHeight:new p_}}return e[t.id]=n,n}}}let rM=0;function aM(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function oM(e,t){const n=new iM,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zy};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zy,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new p_);const a=new p_,o=new V_,s=new V_;return{setup:function(a,o){let s=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,d=0,h=0,p=0,m=0,f=0,g=0,v=0,y=0,_=0,x=0;a.sort(aM);const b=!0===o?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],o=t.color,S=t.intensity,w=t.distance,M=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=o.r*S*b,l+=o.g*S*b,c+=o.b*S*b;else if(t.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],S);x++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=M,r.directionalShadowMatrix[u]=t.shadow.matrix,f++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(S*b),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[h]=e;const a=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&_++),r.spotLightMatrix[h]=a.matrix,t.castShadow){const e=i.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[h]=e,r.spotShadowMap[h]=M,v++}h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(S),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[d]=n,r.pointShadowMap[d]=M,r.pointShadowMatrix[d]=t.shadow.matrix,g++}r.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(S*b),e.groundColor.copy(t.groundColor).multiplyScalar(S*b),r.hemi[m]=e,m++}}p>0&&(t.isWebGL2?!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Hb.LTC_FLOAT_1,r.rectAreaLTC2=Hb.LTC_FLOAT_2):(r.rectAreaLTC1=Hb.LTC_HALF_1,r.rectAreaLTC2=Hb.LTC_HALF_2):!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Hb.LTC_FLOAT_1,r.rectAreaLTC2=Hb.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Hb.LTC_HALF_1,r.rectAreaLTC2=Hb.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=c;const S=r.hash;S.directionalLength===u&&S.pointLength===d&&S.spotLength===h&&S.rectAreaLength===p&&S.hemiLength===m&&S.numDirectionalShadows===f&&S.numPointShadows===g&&S.numSpotShadows===v&&S.numSpotMaps===y&&S.numLightProbes===x||(r.directional.length=u,r.spot.length=h,r.rectArea.length=p,r.point.length=d,r.hemi.length=m,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-_,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=_,r.numLightProbes=x,S.directionalLength=u,S.pointLength=d,S.spotLength=h,S.rectAreaLength=p,S.hemiLength=m,S.numDirectionalShadows=f,S.numPointShadows=g,S.numSpotShadows=v,S.numSpotMaps=y,S.numLightProbes=x,r.version=rM++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let h=0,p=e.length;h<p;h++){const t=e[h];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),s.identity(),o.copy(t.matrixWorld),o.premultiply(d),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),i++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),u++}}},state:r}}function sM(e,t){const n=new oM(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function lM(e,t){let n=new WeakMap;return{get:function(i,r=0){const a=n.get(i);let o;return void 0===a?(o=new sM(e,t),n.set(i,[o])):r>=a.length?(o=new sM(e,t),a.push(o)):o=a[r],o},dispose:function(){n=new WeakMap}}}class cM extends jx{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class uM extends jx{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function dM(e,t,n){let i=new Ub;const r=new zy,a=new zy,o=new s_,s=new cM({depthPacking:3201}),l=new uM,c={},u=n.maxTextureSize,d={[hv]:1,[pv]:0,[mv]:2},h=new bb({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new zy},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const m=new Yx;m.setAttribute("position",new Fx(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new mb(m,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function y(n,i){const a=t.update(f);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new c_(r.x,r.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,a,h,f,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,a,p,f,null)}function _(t,n,i,r){let a=null;const o=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=a.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=a.clone(),i[t]=r,n.addEventListener("dispose",b)),a=r}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=i}return a}function x(n,r,a,o,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],d=l[u.materialIndex];if(d&&d.visible){const t=_(n,d,o,s);n.onBeforeShadow(e,n,r,a,i,t,u),e.renderBufferDirect(a,null,i,t,n,u),n.onAfterShadow(e,n,r,a,i,t,u)}}}else if(l.visible){const t=_(n,l,o,s);n.onBeforeShadow(e,n,r,a,i,t,null),e.renderBufferDirect(a,null,i,t,n,null),n.onAfterShadow(e,n,r,a,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,a,o,s)}function b(e){e.target.removeEventListener("dispose",b);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=3!==v&&3===this.type,m=3===v&&3!==this.type;for(let f=0,g=t.length;f<g;f++){const l=t[f],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const d=c.getFrameExtents();if(r.multiply(d),a.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/d.x),r.x=a.x*d.x,c.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/d.y),r.y=a.y*d.y,c.mapSize.y=a.y)),null===c.map||!0===p||!0===m){const e=3!==this.type?{minFilter:Fv,magFilter:Fv}:{};null!==c.map&&c.map.dispose(),c.map=new c_(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),h.viewport(o),c.updateMatrices(l,e),i=c.getFrustum(),x(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&y(c,s),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function hM(e,t,n){const i=n.isWebGL2;const r=new function(){let t=!1;const n=new s_;let i=null;const r=new s_(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?H(e.DEPTH_TEST):V(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},o=new function(){let t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){t||(n?H(e.STENCIL_TEST):V(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&l===i||(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null}}},s=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],p=null,m=!1,f=null,g=null,v=null,y=null,_=null,x=null,b=null,S=new Rx(0,0,0),w=0,M=!1,E=null,C=null,T=null,P=null,k=null;const A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,R=0;const L=e.getParameter(e.VERSION);-1!==L.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(L)[1]),N=R>=1):-1!==L.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),N=R>=2);let I=null,j={};const D=e.getParameter(e.SCISSOR_BOX),U=e.getParameter(e.VIEWPORT),O=(new s_).fromArray(D),F=(new s_).fromArray(U);function z(t,n,r,a){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let l=0;l<r;l++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+l,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const B={};function H(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function V(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}B[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),B[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(B[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),B[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),H(e.DEPTH_TEST),a.setFunc(3),X(!1),q(1),H(e.CULL_FACE),$(0);const W={[fv]:e.FUNC_ADD,[gv]:e.FUNC_SUBTRACT,[vv]:e.FUNC_REVERSE_SUBTRACT};if(i)W[103]=e.MIN,W[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(W[103]=e.MIN_EXT,W[104]=e.MAX_EXT)}const G={[yv]:e.ZERO,[_v]:e.ONE,[xv]:e.SRC_COLOR,[Sv]:e.SRC_ALPHA,[Pv]:e.SRC_ALPHA_SATURATE,[Cv]:e.DST_COLOR,[Mv]:e.DST_ALPHA,[bv]:e.ONE_MINUS_SRC_COLOR,[wv]:e.ONE_MINUS_SRC_ALPHA,[Tv]:e.ONE_MINUS_DST_COLOR,[Ev]:e.ONE_MINUS_DST_ALPHA,[kv]:e.CONSTANT_COLOR,[Av]:e.ONE_MINUS_CONSTANT_COLOR,[Nv]:e.CONSTANT_ALPHA,[Rv]:e.ONE_MINUS_CONSTANT_ALPHA};function $(t,n,i,r,a,o,s,l,c,u){if(0!==t){if(!1===m&&(H(e.BLEND),m=!0),5===t)a=a||n,o=o||i,s=s||r,n===g&&a===_||(e.blendEquationSeparate(W[n],W[a]),g=n,_=a),i===v&&r===y&&o===x&&s===b||(e.blendFuncSeparate(G[i],G[r],G[o],G[s]),v=i,y=r,x=o,b=s),!1!==l.equals(S)&&c===w||(e.blendColor(l.r,l.g,l.b,c),S.copy(l),w=c),f=t,M=!1;else if(t!==f||u!==M){if(g===fv&&_===fv||(e.blendEquation(e.FUNC_ADD),g=fv,_=fv),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,b=null,S.set(0,0,0),w=0,f=t,M=u}}else!0===m&&(V(e.BLEND),m=!1)}function X(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function q(t){0!==t?(H(e.CULL_FACE),t!==C&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):V(e.CULL_FACE),C=t}function K(t,n,i){t?(H(e.POLYGON_OFFSET_FILL),P===n&&k===i||(e.polygonOffset(n,i),P=n,k=i)):V(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:a,stencil:o},enable:H,disable:V,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let a=h,o=!1;if(i){a=d.get(r),void 0===a&&(a=[],d.set(r,a));const t=i.textures;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)a[n]=e.COLOR_ATTACHMENT0+n;a.length=t.length,o=!0}}else a[0]!==e.BACK&&(a[0]=e.BACK,o=!0);if(o)if(n.isWebGL2)e.drawBuffers(a);else{if(!0!==t.has("WEBGL_draw_buffers"))throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension");t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a)}},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:$,setMaterial:function(t,n){2===t.side?V(e.CULL_FACE):H(e.CULL_FACE);let i=1===t.side;n&&(i=!i),X(i),1===t.blending&&!1===t.transparent?$(0):$(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite);const s=t.stencilWrite;o.setTest(s),s&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),K(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(e.SAMPLE_ALPHA_TO_COVERAGE):V(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:X,setCullFace:q,setLineWidth:function(t){t!==T&&(N&&e.lineWidth(t),T=t)},setPolygonOffset:K,setScissorTest:function(t){t?H(e.SCISSOR_TEST):V(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),I!==t&&(e.activeTexture(t),I=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===I?e.TEXTURE0+A-1:I);let r=j[i];void 0===r&&(r={type:void 0,texture:void 0},j[i]=r),r.type===t&&r.texture===n||(I!==i&&(e.activeTexture(i),I=i),e.bindTexture(t,n||B[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=j[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=l.get(n).get(t);s.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),s.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===O.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},I=null,j={},u={},d=new WeakMap,h=[],p=null,m=!1,f=null,g=null,v=null,y=null,_=null,x=null,b=null,S=new Rx(0,0,0),w=0,M=!1,E=null,C=null,T=null,P=null,k=null,O.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),o.reset()}}}function pM(e,t,n,i,r,a,o){const s=r.isWebGL2,l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new zy,d=new WeakMap;let h;const p=new WeakMap;let m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(B){}function f(e,t){return m?new OffscreenCanvas(e,t):Wy("canvas")}function g(e,t,n,i){let r=1;const a=z(e);if((a.width>i||a.height>i)&&(r=i/Math.max(a.width,a.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const i=t?Dy:Math.floor,o=i(r*a.width),s=i(r*a.height);void 0===h&&(h=f(o,s));const l=n?f(o,s):h;l.width=o,l.height=s;return l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),e}return e}function v(e){const t=z(e);return jy(t.width)&&jy(t.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==Fv&&e.minFilter!==Hv}function _(t){e.generateMipmap(t)}function x(n,i,r,a,o=!1){if(!1===s)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;if(i===e.RED&&(r===e.FLOAT&&(l=e.R32F),r===e.HALF_FLOAT&&(l=e.R16F),r===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(l=e.R8UI),r===e.UNSIGNED_SHORT&&(l=e.R16UI),r===e.UNSIGNED_INT&&(l=e.R32UI),r===e.BYTE&&(l=e.R8I),r===e.SHORT&&(l=e.R16I),r===e.INT&&(l=e.R32I)),i===e.RG&&(r===e.FLOAT&&(l=e.RG32F),r===e.HALF_FLOAT&&(l=e.RG16F),r===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(l=e.RG8UI),r===e.UNSIGNED_SHORT&&(l=e.RG16UI),r===e.UNSIGNED_INT&&(l=e.RG32UI),r===e.BYTE&&(l=e.RG8I),r===e.SHORT&&(l=e.RG16I),r===e.INT&&(l=e.RG32I)),i===e.RGBA){const t=o?dy:Zy.getTransfer(a);r===e.FLOAT&&(l=e.RGBA32F),r===e.HALF_FLOAT&&(l=e.RGBA16F),r===e.UNSIGNED_BYTE&&(l=t===hy?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function b(e,t,n){return!0===y(e,n)||e.isFramebufferTexture&&e.minFilter!==Fv&&e.minFilter!==Hv?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(t){return t===Fv||1004===t||t===Bv?e.NEAREST:e.LINEAR}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=p.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&E(e),0===Object.keys(r).length&&p.delete(n)}i.remove(e)}(t),t.isVideoTexture&&d.delete(t)}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=i.get(t);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let a=0,s=r.length;a<s;a++){const t=i.get(r[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),i.remove(r[a])}i.remove(t)}(n)}function E(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete p.get(r)[n.__cacheKey],o.memory.textures--}let C=0;function T(t,r){const a=i.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void L(a,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+r)}const P={[Dv]:e.REPEAT,[Uv]:e.CLAMP_TO_EDGE,[Ov]:e.MIRRORED_REPEAT},k={[Fv]:e.NEAREST,[zv]:e.NEAREST_MIPMAP_NEAREST,[Bv]:e.NEAREST_MIPMAP_LINEAR,[Hv]:e.LINEAR,[Vv]:e.LINEAR_MIPMAP_NEAREST,[Wv]:e.LINEAR_MIPMAP_LINEAR},A={[gy]:e.NEVER,[wy]:e.ALWAYS,[vy]:e.LESS,[_y]:e.LEQUAL,[yy]:e.EQUAL,[Sy]:e.GEQUAL,[xy]:e.GREATER,[by]:e.NOTEQUAL};function N(n,a,o){if(a.type!==Kv||!1!==t.has("OES_texture_float_linear")||a.magFilter!==Hv&&a.magFilter!==Vv&&a.magFilter!==Bv&&a.magFilter!==Wv&&a.minFilter!==Hv&&a.minFilter!==Vv&&a.minFilter!==Bv&&a.minFilter!==Wv||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),o?(e.texParameteri(n,e.TEXTURE_WRAP_S,P[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,P[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,P[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,k[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,k[a.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===Uv&&a.wrapT===Uv||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,S(a.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,S(a.minFilter)),a.minFilter!==Fv&&a.minFilter!==Hv&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,A[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===Fv)return;if(a.minFilter!==Bv&&a.minFilter!==Wv)return;if(a.type===Kv&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===Yv&&!1===t.has("OES_texture_half_float_linear"))return;if(a.anisotropy>1||i.get(a).__currentAnisotropy){const o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy}}}function R(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const r=n.source;let a=p.get(r);void 0===a&&(a={},p.set(r,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),a[s].usedTimes++;const r=a[t.__cacheKey];void 0!==r&&(a[t.__cacheKey].usedTimes--,0===r.usedTimes&&E(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return i}function L(t,o,l){let c=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(c=e.TEXTURE_3D);const u=R(t,o),d=o.source;n.bindTexture(c,t.__webglTexture,e.TEXTURE0+l);const h=i.get(d);if(d.version!==h.__version||!0===u){n.activeTexture(e.TEXTURE0+l);const t=Zy.getPrimaries(Zy.workingColorSpace),i=o.colorSpace===oy?null:Zy.getPrimaries(o.colorSpace),p=o.colorSpace===oy||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const m=function(e){return!s&&(e.wrapS!==Uv||e.wrapT!==Uv||e.minFilter!==Fv&&e.minFilter!==Hv)}(o)&&!1===v(o.image);let f=g(o.image,m,!1,r.maxTextureSize);f=F(o,f);const S=v(f)||s,w=a.convert(o.format,o.colorSpace);let M,E=a.convert(o.type),C=x(o.internalFormat,w,E,o.colorSpace,o.isVideoTexture);N(c,o,S);const T=o.mipmaps,P=s&&!0!==o.isVideoTexture&&36196!==C,k=void 0===h.__version||!0===u,A=d.dataReady,R=b(o,f,S);if(o.isDepthTexture)C=e.DEPTH_COMPONENT,s?C=o.type===Kv?e.DEPTH_COMPONENT32F:o.type===qv?e.DEPTH_COMPONENT24:o.type===Zv?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:o.type===Kv&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),o.format===Qv&&C===e.DEPTH_COMPONENT&&o.type!==$v&&o.type!==qv&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),o.type=qv,E=a.convert(o.type)),o.format===ey&&C===e.DEPTH_COMPONENT&&(C=e.DEPTH_STENCIL,o.type!==Zv&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),o.type=Zv,E=a.convert(o.type))),k&&(P?n.texStorage2D(e.TEXTURE_2D,1,C,f.width,f.height):n.texImage2D(e.TEXTURE_2D,0,C,f.width,f.height,0,w,E,null));else if(o.isDataTexture)if(T.length>0&&S){P&&k&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)M=T[t],P?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,w,E,M.data):n.texImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,w,E,M.data);o.generateMipmaps=!1}else P?(k&&n.texStorage2D(e.TEXTURE_2D,R,C,f.width,f.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f.width,f.height,w,E,f.data)):n.texImage2D(e.TEXTURE_2D,0,C,f.width,f.height,0,w,E,f.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){P&&k&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,T[0].width,T[0].height,f.depth);for(let t=0,i=T.length;t<i;t++)M=T[t],o.format!==Jv?null!==w?P?A&&n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,M.width,M.height,f.depth,w,M.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,C,M.width,M.height,f.depth,0,M.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):P?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,M.width,M.height,f.depth,w,E,M.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,C,M.width,M.height,f.depth,0,w,E,M.data)}else{P&&k&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)M=T[t],o.format!==Jv?null!==w?P?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,w,M.data):n.compressedTexImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):P?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,M.width,M.height,w,E,M.data):n.texImage2D(e.TEXTURE_2D,t,C,M.width,M.height,0,w,E,M.data)}else if(o.isDataArrayTexture)P?(k&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,f.width,f.height,f.depth),A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,f.width,f.height,f.depth,w,E,f.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,C,f.width,f.height,f.depth,0,w,E,f.data);else if(o.isData3DTexture)P?(k&&n.texStorage3D(e.TEXTURE_3D,R,C,f.width,f.height,f.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,f.width,f.height,f.depth,w,E,f.data)):n.texImage3D(e.TEXTURE_3D,0,C,f.width,f.height,f.depth,0,w,E,f.data);else if(o.isFramebufferTexture){if(k)if(P)n.texStorage2D(e.TEXTURE_2D,R,C,f.width,f.height);else{let t=f.width,i=f.height;for(let r=0;r<R;r++)n.texImage2D(e.TEXTURE_2D,r,C,t,i,0,w,E,null),t>>=1,i>>=1}}else if(T.length>0&&S){if(P&&k){const t=z(T[0]);n.texStorage2D(e.TEXTURE_2D,R,C,t.width,t.height)}for(let t=0,i=T.length;t<i;t++)M=T[t],P?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w,E,M):n.texImage2D(e.TEXTURE_2D,t,C,w,E,M);o.generateMipmaps=!1}else if(P){if(k){const t=z(f);n.texStorage2D(e.TEXTURE_2D,R,C,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,w,E,f)}else n.texImage2D(e.TEXTURE_2D,0,C,w,E,f);y(o,S)&&_(c),h.__version=d.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function I(t,r,o,s,c,u){const d=a.convert(o.format,o.colorSpace),h=a.convert(o.type),p=x(o.internalFormat,d,h,o.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,i,r.depth,0,d,h,null):n.texImage2D(c,u,p,t,i,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),O(r)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,c,i.get(o).__webglTexture,0,U(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,c,i.get(o).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function j(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let r=!0===s?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(i||O(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Kv?r=e.DEPTH_COMPONENT32F:t.type===qv&&(r=e.DEPTH_COMPONENT24));const i=U(n);O(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=U(n);i&&!1===O(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):O(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const o=t[r],s=a.convert(o.format,o.colorSpace),c=a.convert(o.type),u=x(o.internalFormat,s,c,o.colorSpace),d=U(n);i&&!1===O(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,u,n.width,n.height):O(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t){const r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);const a=i.get(r.depthTexture).__webglTexture,o=U(r);if(r.depthTexture.format===Qv)O(r)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(r.depthTexture.format!==ey)throw new Error("Unknown depthTexture format");O(r)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),j(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),j(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(e){return Math.min(r.maxSamples,e.samples)}function O(e){const n=i.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function F(e,n){const i=e.colorSpace,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Ey||i!==ly&&i!==oy&&(Zy.getTransfer(i)===hy?!1===s?!0===t.has("EXT_sRGB")&&r===Jv?(e.format=Ey,e.minFilter=Hv,e.generateMipmaps=!1):n=t_.sRGBToLinear(n):r===Jv&&a===Gv||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}function z(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=C;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=T,this.setTexture2DArray=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?L(a,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?L(a,t,r):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,o){const l=i.get(t);t.version>0&&l.__version!==t.version?function(t,o,l){if(6!==o.image.length)return;const c=R(t,o),u=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+l);const d=i.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+l);const t=Zy.getPrimaries(Zy.workingColorSpace),i=o.colorSpace===oy?null:Zy.getPrimaries(o.colorSpace),h=o.colorSpace===oy||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const p=o.isCompressedTexture||o.image[0].isCompressedTexture,m=o.image[0]&&o.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=p||m?m?o.image[e].image:o.image[e]:g(o.image[e],!1,!0,r.maxCubemapSize),f[e]=F(o,f[e]);const S=f[0],w=v(S)||s,M=a.convert(o.format,o.colorSpace),E=a.convert(o.type),C=x(o.internalFormat,M,E,o.colorSpace),T=s&&!0!==o.isVideoTexture,P=void 0===d.__version||!0===c,k=u.dataReady;let A,R=b(o,S,w);if(N(e.TEXTURE_CUBE_MAP,o,w),p){T&&P&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,S.width,S.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];o.format!==Jv?null!==M?T?k&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,M,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,C,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?k&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,M,E,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,C,r.width,r.height,0,M,E,r.data)}}}else{if(A=o.mipmaps,T&&P){A.length>0&&R++;const t=z(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,t.width,t.height)}for(let t=0;t<6;t++)if(m){T?k&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,M,E,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,f[t].width,f[t].height,0,M,E,f[t].data);for(let i=0;i<A.length;i++){const r=A[i].image[t].image;T?k&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,M,E,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,C,r.width,r.height,0,M,E,r.data)}}else{T?k&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,M,E,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,M,E,f[t]);for(let i=0;i<A.length;i++){const r=A[i];T?k&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,M,E,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,C,M,E,r.image[t])}}}y(o,w)&&_(e.TEXTURE_CUBE_MAP),d.__version=u.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(l,t,o):n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(t,n,r){const a=i.get(t);void 0!==n&&I(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&D(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener("dispose",M);const d=t.textures,h=!0===t.isWebGLCubeRenderTarget,p=d.length>1,m=v(t)||s;if(p||(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(s&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(s&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(p)if(r.drawBuffers)for(let t=0,n=d.length;t<n;t++){const n=i.get(d[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===O(t)){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<d.length;n++){const i=d[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const r=a.convert(i.format,i.colorSpace),o=a.convert(i.type),s=x(i.internalFormat,r,o,i.colorSpace,!0===t.isXRRenderTarget),l=U(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,l,s,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),j(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),N(e.TEXTURE_CUBE_MAP,l,m);for(let n=0;n<6;n++)if(s&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)I(c.__webglFramebuffer[n][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else I(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);y(l,m)&&_(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(p){for(let r=0,a=d.length;r<a;r++){const a=d[r],o=i.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),N(e.TEXTURE_2D,a,m),I(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),y(a,m)&&_(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,u.__webglTexture),N(i,l,m),s&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)I(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,i,n);else I(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);y(l,m)&&_(i),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(t){const r=v(t)||s,a=t.textures;for(let o=0,s=a.length;o<s;o++){const s=a[o];if(y(s,r)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=i.get(s).__webglTexture;n.bindTexture(r,a),_(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===O(t)){const r=t.textures,a=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const l=[],u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,d=i.get(t),h=r.length>1;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,d.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(u);const p=void 0!==d.__ignoreDepthValues&&d.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d.__webglColorRenderbuffer[n]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[u]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[u])),h){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),c&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,d.__webglColorRenderbuffer[t]);const a=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=I,this.useMultisampledRTT=O}function mM(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=""){let a;const o=Zy.getTransfer(r);if(n===Gv)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===$v)return e.UNSIGNED_SHORT;if(n===Xv)return e.INT;if(n===qv)return e.UNSIGNED_INT;if(n===Kv)return e.FLOAT;if(n===Yv)return i?e.HALF_FLOAT:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===Jv)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===Qv)return e.DEPTH_COMPONENT;if(n===ey)return e.DEPTH_STENCIL;if(n===Ey)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===ty||n===ny||n===iy||n===ry)if(o===hy){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(n===ty)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===ny)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===iy)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ry)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(n===ty)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===ny)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===iy)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ry)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===n)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===n)return o===hy?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return o===hy?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===ay||36494===n||36495===n){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(n===ay)return o===hy?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(n===ay)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Zv?i?e.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class fM extends Cb{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class gM extends gx{constructor(){super(),this.isGroup=!0,this.type="Group"}}const vM={type:"move"};class yM{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new gM,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new gM,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new p_,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new p_),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new gM,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new p_,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new p_),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),i=this._getHandJoint(l,a);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(vM)))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new gM;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class _M{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const i=new o_;e.properties.get(i).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}render(e,t){if(null!==this.texture){if(null===this.mesh){const e=t.cameras[0].viewport,n=new bb({extensions:{fragDepth:!0},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new mb(new zb(20,20),n)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class xM extends Py{constructor(e,t){super();const n=this;let i=null,r=1,a=null,o="local-floor",s=1,l=null,c=null,u=null,d=null,h=null,p=null;const m=new _M,f=t.getContextAttributes();let g=null,v=null;const y=[],_=[],x=new zy;let b=null;const S=new Cb;S.layers.enable(1),S.viewport=new s_;const w=new Cb;w.layers.enable(2),w.viewport=new s_;const M=[S,w],E=new fM;E.layers.enable(1),E.layers.enable(2);let C=null,T=null;function P(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function k(){i.removeEventListener("select",P),i.removeEventListener("selectstart",P),i.removeEventListener("selectend",P),i.removeEventListener("squeeze",P),i.removeEventListener("squeezestart",P),i.removeEventListener("squeezeend",P),i.removeEventListener("end",k),i.removeEventListener("inputsourceschange",A);for(let e=0;e<y.length;e++){const t=_[e];null!==t&&(_[e]=null,y[e].disconnect(t))}C=null,T=null,m.reset(),e.setRenderTarget(g),h=null,d=null,u=null,i=null,v=null,j.stop(),n.isPresenting=!1,e.setPixelRatio(b),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function A(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=_.indexOf(n);i>=0&&(_[i]=null,y[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=_.indexOf(n);if(-1===i){for(let e=0;e<y.length;e++){if(e>=_.length){_.push(n),i=e;break}if(null===_[e]){_[e]=n,i=e;break}}if(-1===i)break}const r=y[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new yM,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new yM,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new yM,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(g=e.getRenderTarget(),i.addEventListener("select",P),i.addEventListener("selectstart",P),i.addEventListener("selectend",P),i.addEventListener("squeeze",P),i.addEventListener("squeezestart",P),i.addEventListener("squeezeend",P),i.addEventListener("end",k),i.addEventListener("inputsourceschange",A),!0!==f.xrCompatible&&await t.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(x),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),v=new c_(h.framebufferWidth,h.framebufferHeight,{format:Jv,type:Gv,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,a=null,o=null;f.depth&&(o=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?ey:Qv,a=f.stencil?Zv:qv);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:r};u=new XRWebGLBinding(i,t),d=u.createProjectionLayer(s),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new c_(d.textureWidth,d.textureHeight,{format:Jv,type:Gv,depthTexture:new ES(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0});e.properties.get(v).__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await i.requestReferenceSpace(o),j.setContext(i),j.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const N=new p_,R=new p_;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;null!==m.texture&&(e.near=m.depthNear,e.far=m.depthFar),E.near=w.near=S.near=e.near,E.far=w.far=S.far=e.far,C===E.near&&T===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,T=E.far,S.near=C,S.far=T,w.near=C,w.far=T,S.updateProjectionMatrix(),w.updateProjectionMatrix(),e.updateProjectionMatrix());const t=e.parent,n=E.cameras;L(E,t);for(let i=0;i<n.length;i++)L(n[i],t);2===n.length?function(e,t,n){N.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const i=N.distanceTo(R),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(a[8]+1)/a[0],h=o*u,p=o*d,m=i/(-u+d),f=m*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+m,v=s+m,y=h-f,_=p+(i-f),x=l*s/v*g,b=c*s/v*g;e.projectionMatrix.makePerspective(y,_,x,b,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(E,S,w):E.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Ny*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,t)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==d||null!==h)return s},this.setFoveation=function(e){s=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture};let I=null;const j=new Ob;j.setAnimationLoop(function(t,r){if(c=r.getViewerPose(l||a),p=r,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(v,h.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let a=null;if(null!==h)a=h.getViewport(r);else{const t=u.getViewSubImage(d,r);a=t.viewport,0===i&&(e.setRenderTargetTextures(v,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let o=M[i];void 0===o&&(o=new Cb,o.layers.enable(i),o.viewport=new s_,M[i]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===i&&(E.matrix.copy(o.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(o)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&m.init(e,n,i.renderState)}}for(let e=0;e<y.length;e++){const t=_[e],n=y[e];null!==t&&void 0!==n&&n.update(t,r,l||a)}m.render(e,E),I&&I(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null}),this.setAnimationLoop=function(e){I=e},this.dispose=function(){}}}const bM=new Q_,SM=new V_;function wM(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,1===r.side&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),1===r.side&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const a=t.get(r),o=a.envMap,s=a.envMapRotation;if(o&&(i.envMap.value=o,bM.copy(s),bM.x*=-1,bM.y*=-1,bM.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&(bM.y*=-1,bM.z*=-1),i.envMapRotation.value.setFromMatrix4(SM.makeRotationFromEuler(bM)),i.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,_b(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,a,o,s){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform));e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));const r=t.get(i).envMap;r&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,s)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,a,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function MM(e,t,n,i){let r={},a={},o=[];const s=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n,i){const r=e.value,a=t+"_"+n;if(void 0===i[a])return i[a]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const e=i[a];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return i[a]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,d){let h=r[n.id];void 0===h&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let a=0,o=t.length;a<o;a++){const e=Array.isArray(t[a])?t[a]:[t[a]];for(let t=0,r=e.length;t<r;t++){const r=e[t],a=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=a.length;e<t;e++){const t=c(a[e]),o=n%i;0!==o&&i-o<t.boundary&&(n+=i-o),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=h,n.addEventListener("dispose",u));const p=d.program;i.updateUBOMapping(n,p);const m=t.render.frame;a[n.id]!==m&&(!function(t){const n=r[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,o=i.length;r<o;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,a)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let a=0;a<n.length;a++){const o=n[a],s=c(o);"number"==typeof o||"boolean"==typeof o?(i.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=0,i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=0,i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=0):(o.toArray(i.__data,r),r+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=m)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);o=[],r={},a={}}}}class EM{constructor(e={}){const{canvas:t=Gy(),context:n=null,depth:i=!0,stencil:r=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:a;const h=new Uint32Array(4),p=new Int32Array(4);let m=null,f=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=sy,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let _=!1,x=0,b=0,S=null,w=-1,M=null;const E=new s_,C=new s_;let T=null;const P=new Rx(0);let k=0,A=t.width,N=t.height,R=1,L=null,I=null;const j=new s_(0,0,A,N),D=new s_(0,0,A,N);let U=!1;const O=new Ub;let F=!1,z=!1,B=null;const H=new V_,V=new zy,W=new p_,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return null===S?R:1}let X,q,K,Y,Z,J,Q,ee,te,ne,ie,re,ae,oe,se,le,ce,ue,de,he,pe,me,fe,ge,ve=n;function ye(e,n){for(let i=0;i<e.length;i++){const r=e[i],a=t.getContext(r,n);if(null!==a)return a}return null}try{const e={alpha:!0,depth:i,stencil:r,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${rv}`),t.addEventListener("webglcontextlost",be,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",we,!1),null===ve){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&ve instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ue){throw console.error("THREE.WebGLRenderer: "+Ue.message),Ue}function _e(){X=new vS(ve),q=new Yb(ve,X,e),X.init(q),me=new mM(ve,X,q),K=new hM(ve,X,q),Y=new xS(ve),Z=new Jw,J=new pM(ve,X,K,Z,q,me,Y),Q=new Jb(y),ee=new gS(y),te=new Fb(ve,q),fe=new qb(ve,X,te,q),ne=new yS(ve,te,Y,fe),ie=new MS(ve,ne,te,Y),de=new wS(ve,q,J),le=new Zb(Z),re=new Zw(y,Q,ee,X,q,fe,le),ae=new wM(y,Z),oe=new nM,se=new lM(X,q),ue=new Xb(y,Q,ee,K,ie,d,s),ce=new dM(y,ie,q),ge=new MM(ve,Y,q,K),he=new Kb(ve,X,Y,q),pe=new _S(ve,X,Y,q),Y.programs=re.programs,y.capabilities=q,y.extensions=X,y.properties=Z,y.renderLists=oe,y.shadowMap=ce,y.state=K,y.info=Y}_e();const xe=new xM(y,ve);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const e=Y.autoReset,t=ce.enabled,n=ce.autoUpdate,i=ce.needsUpdate,r=ce.type;_e(),Y.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=i,ce.type=r}function we(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){const t=e.target;t.removeEventListener("dispose",Me),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){re.releaseProgram(e)}),e.isShaderMaterial&&re.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ie(e,t,n),e.side=0,e.needsUpdate=!0,Ie(e,t,n),e.side=2):Ie(e,t,n)}this.xr=xe,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=X.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=X.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(A,N,!1))},this.getSize=function(e){return e.set(A,N)},this.setSize=function(e,n,i=!0){xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(A=e,N=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(A*R,N*R).floor()},this.setDrawingBufferSize=function(e,n,i){A=e,N=n,R=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(j)},this.setViewport=function(e,t,n,i){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,i),K.viewport(E.copy(j).multiplyScalar(R).round())},this.getScissor=function(e){return e.copy(D)},this.setScissor=function(e,t,n,i){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,i),K.scissor(C.copy(D).multiplyScalar(R).round())},this.getScissorTest=function(){return U},this.setScissorTest=function(e){K.setScissorTest(U=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==S){const t=S.texture.format;e=1033===t||1031===t||1029===t}if(e){const e=S.texture.type,t=e===Gv||e===qv||e===$v||e===Zv||1017===e||1018===e,n=ue.getClearColor(),i=ue.getClearAlpha(),r=n.r,a=n.g,o=n.b;t?(h[0]=r,h[1]=a,h[2]=o,h[3]=i,ve.clearBufferuiv(ve.COLOR,0,h)):(p[0]=r,p[1]=a,p[2]=o,p[3]=i,ve.clearBufferiv(ve.COLOR,0,p))}else i|=ve.COLOR_BUFFER_BIT}t&&(i|=ve.DEPTH_BUFFER_BIT),n&&(i|=ve.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ve.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",be,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",we,!1),oe.dispose(),se.dispose(),Z.dispose(),Q.dispose(),ee.dispose(),ie.dispose(),fe.dispose(),ge.dispose(),re.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",Te),xe.removeEventListener("sessionend",Pe),B&&(B.dispose(),B=null),ke.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=G);const o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(e,t,n,i,r){!0!==t.isScene&&(t=G);J.resetTextureUnits();const a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===S?y.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:ly,l=(i.isMeshStandardMaterial?ee:Q).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let m=0;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(m=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,_=Z.get(i),x=f.state.lights;if(!0===F&&(!0===z||e!==M)){const t=e===M&&i.id===w;le.setState(i,e,t)}let b=!1;i.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputColorSpace!==s||r.isBatchedMesh&&!1===_.batching?b=!0:r.isBatchedMesh||!0!==_.batching?r.isInstancedMesh&&!1===_.instancing?b=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?b=!0:r.isSkinnedMesh||!0!==_.skinning?r.isInstancedMesh&&!0===_.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===_.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===_.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===_.instancingMorph&&null!==r.morphTexture||_.envMap!==l||!0===i.fog&&_.fog!==a?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===le.numPlanes&&_.numIntersection===le.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==d||_.morphNormals!==h||_.morphColors!==p||_.toneMapping!==m||!0===q.isWebGL2&&_.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,_.__version=i.version);let E=_.currentProgram;!0===b&&(E=Ie(i,t,r));let C=!1,T=!1,P=!1;const k=E.getUniforms(),A=_.uniforms;K.useProgram(E.program)&&(C=!0,T=!0,P=!0);i.id!==w&&(w=i.id,T=!0);if(C||M!==e){k.setValue(ve,"projectionMatrix",e.projectionMatrix),k.setValue(ve,"viewMatrix",e.matrixWorldInverse);const t=k.map.cameraPosition;void 0!==t&&t.setValue(ve,W.setFromMatrixPosition(e.matrixWorld)),q.logarithmicDepthBuffer&&k.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&k.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,T=!0,P=!0)}if(r.isSkinnedMesh){k.setOptional(ve,r,"bindMatrix"),k.setOptional(ve,r,"bindMatrixInverse");const e=r.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),k.setValue(ve,"boneTexture",e.boneTexture,J)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}r.isBatchedMesh&&(k.setOptional(ve,r,"batchingTexture"),k.setValue(ve,"batchingTexture",r._matricesTexture,J));const L=n.morphAttributes;(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===q.isWebGL2)&&de.update(r,n,E);(T||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,k.setValue(ve,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(A.envMap.value=l,A.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);T&&(k.setValue(ve,"toneMappingExposure",y.toneMappingExposure),_.needsLights&&(j=P,(I=A).ambientLightColor.needsUpdate=j,I.lightProbe.needsUpdate=j,I.directionalLights.needsUpdate=j,I.directionalLightShadows.needsUpdate=j,I.pointLights.needsUpdate=j,I.pointLightShadows.needsUpdate=j,I.spotLights.needsUpdate=j,I.spotLightShadows.needsUpdate=j,I.rectAreaLights.needsUpdate=j,I.hemisphereLights.needsUpdate=j),a&&!0===i.fog&&ae.refreshFogUniforms(A,a),ae.refreshMaterialUniforms(A,i,R,N,B),Aw.upload(ve,je(_),A,J));var I,j;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Aw.upload(ve,je(_),A,J),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&k.setValue(ve,"center",r.center);if(k.setValue(ve,"modelViewMatrix",r.modelViewMatrix),k.setValue(ve,"normalMatrix",r.normalMatrix),k.setValue(ve,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(q.isWebGL2){const n=e[t];ge.update(n,E),ge.bind(n,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,n,i,r);K.setMaterial(i,o);let l=n.index,c=1;if(!0===i.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,p=(u.start+u.count)*c;null!==a&&(h=Math.max(h,a.start*c),p=Math.min(p,(a.start+a.count)*c)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):null!=d&&(h=Math.max(h,0),p=Math.min(p,d.count));const m=p-h;if(m<0||m===1/0)return;let g;fe.setup(r,i,s,n,l);let v=he;if(null!==l&&(g=te.get(l),v=pe,v.setIndex(g)),r.isMesh)!0===i.wireframe?(K.setLineWidth(i.wireframeLinewidth*$()),v.setMode(ve.LINES)):v.setMode(ve.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),K.setLineWidth(e*$()),r.isLineSegments?v.setMode(ve.LINES):r.isLineLoop?v.setMode(ve.LINE_LOOP):v.setMode(ve.LINE_STRIP)}else r.isPoints?v.setMode(ve.POINTS):r.isSprite&&v.setMode(ve.TRIANGLES);if(r.isBatchedMesh)v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else if(r.isInstancedMesh)v.renderInstances(h,m,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(h,m,t)}else v.render(h,m)},this.compile=function(e,t,n=null){null===n&&(n=e),f=se.get(n),f.init(),v.push(f),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))}),f.setupLights(y._useLegacyLights);const i=new Set;return e.traverse(function(e){const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const a=t[r];Ee(a,n,e),i.add(a)}else Ee(t,n,e),i.add(t)}),v.pop(),f=null,i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise(t=>{function n(){i.forEach(function(e){Z.get(e).currentProgram.isReady()&&i.delete(e)}),0!==i.size?setTimeout(n,10):t(e)}null!==X.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ce=null;function Te(){ke.stop()}function Pe(){ke.start()}const ke=new Ob;function Ae(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){i&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),r=e.material;r.visible&&m.push(e,t,r,n,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||O.intersectsObject(e))){const t=ie.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)),W.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(r)){const i=t.groups;for(let a=0,o=i.length;a<o;a++){const o=i[a],s=r[o.materialIndex];s&&s.visible&&m.push(e,t,s,n,W.z,o)}}else r.visible&&m.push(e,t,r,n,W.z,null)}const r=e.children;for(let a=0,o=r.length;a<o;a++)Ae(r[a],t,n,i)}function Ne(e,t,n,i){const r=e.opaque,a=e.transmissive,o=e.transparent;f.setupLightsView(n),!0===F&&le.setGlobalState(y.clippingPlanes,n),a.length>0&&function(e,t,n,i){const r=!0===n.isScene?n.overrideMaterial:null;if(null!==r)return;const a=q.isWebGL2;null===B&&(B=new c_(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")?Yv:Gv,minFilter:Wv,samples:a?4:0}));y.getDrawingBufferSize(V),a?B.setSize(V.x,V.y):B.setSize(Dy(V.x),Dy(V.y));const o=y.getRenderTarget();y.setRenderTarget(B),y.getClearColor(P),k=y.getClearAlpha(),k<1&&y.setClearColor(16777215,.5);y.clear();const s=y.toneMapping;y.toneMapping=0,Re(e,n,i),J.updateMultisampleRenderTarget(B),J.updateRenderTargetMipmap(B);let l=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c],r=e.object,a=e.geometry,o=e.material,s=e.group;if(2===o.side&&r.layers.test(i.layers)){const e=o.side;o.side=1,o.needsUpdate=!0,Le(r,n,i,a,o,s),o.side=e,o.needsUpdate=!0,l=!0}}!0===l&&(J.updateMultisampleRenderTarget(B),J.updateRenderTargetMipmap(B));y.setRenderTarget(o),y.setClearColor(P,k),y.toneMapping=s}(r,a,t,n),i&&K.viewport(E.copy(i)),r.length>0&&Re(r,t,n),a.length>0&&Re(a,t,n),o.length>0&&Re(o,t,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Re(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){const a=e[r],o=a.object,s=a.geometry,l=null===i?a.material:i,c=a.group;o.layers.test(n.layers)&&Le(o,t,n,s,l,c)}}function Le(e,t,n,i,r,a){e.onBeforeRender(y,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,a),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,a),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,a),r.side=2):y.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(y,t,n,i,r,a)}function Ie(e,t,n){!0!==t.isScene&&(t=G);const i=Z.get(e),r=f.state.lights,a=f.state.shadowsArray,o=r.state.version,s=re.getParameters(e,r.state,a,t,n),l=re.getProgramCacheKey(s);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ee:Q).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Me),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return De(e,s),u}else s.uniforms=re.getUniforms(e),e.onBuild(n,s,y),e.onBeforeCompile(s,y),u=re.acquireProgram(s,l),c.set(l,u),i.uniforms=s.uniforms;const d=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),De(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function je(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Aw.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function De(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}ke.setAnimationLoop(function(e){Ce&&Ce(e)}),"undefined"!=typeof self&&ke.setContext(self),this.setAnimationLoop=function(e){Ce=e,xe.setAnimationLoop(e),null===e?ke.stop():ke.start()},xe.addEventListener("sessionstart",Te),xe.addEventListener("sessionend",Pe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,S),f=se.get(e,v.length),f.init(),v.push(f),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(H),z=this.localClippingEnabled,F=le.init(this.clippingPlanes,z),m=oe.get(e,g.length),m.init(),g.push(m),Ae(e,t,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(L,I),this.info.render.frame++,!0===F&&le.beginShadows();const n=f.state.shadowsArray;if(ce.render(n,e,t),!0===F&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),!1!==xe.enabled&&!1!==xe.isPresenting&&!1!==xe.hasDepthSensing()||ue.render(m,e),f.setupLights(y._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Ne(m,e,i,i.viewport)}}else Ne(m,e,t);null!==S&&(J.updateMultisampleRenderTarget(S),J.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(y,e,t),fe.resetDefaultState(),w=-1,M=null,v.pop(),f=v.length>0?v[v.length-1]:null,g.pop(),m=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const i=Z.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){S=e,x=t,b=n;let i=!0,r=null,a=!1,o=!1;if(e){const s=Z.get(e);void 0!==s.__useDefaultFramebuffer?(K.bindFramebuffer(ve.FRAMEBUFFER,null),i=!1):void 0===s.__webglFramebuffer?J.setupRenderTarget(e):s.__hasExternalTextures&&J.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],a=!0):r=q.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),C.copy(e.scissor),T=e.scissorTest}else E.copy(j).multiplyScalar(R).floor(),C.copy(D).multiplyScalar(R).floor(),T=U;if(K.bindFramebuffer(ve.FRAMEBUFFER,r)&&q.drawBuffers&&i&&K.drawBuffers(e,r),K.viewport(E),K.scissor(C),K.setScissorTest(T),a){const i=Z.get(e.texture);ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(o){const i=Z.get(e.texture),r=t||0;ve.framebufferTextureLayer(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}w=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){K.bindFramebuffer(ve.FRAMEBUFFER,s);try{const o=e.texture,s=o.format,l=o.type;if(s!==Jv&&me.convert(s)!==ve.getParameter(ve.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Yv&&(X.has("EXT_color_buffer_half_float")||q.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(l===Gv||me.convert(l)===ve.getParameter(ve.IMPLEMENTATION_COLOR_READ_TYPE)||l===Kv&&(q.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ve.readPixels(t,n,i,r,me.convert(s),me.convert(l),a)}finally{const e=null!==S?Z.get(S).__webglFramebuffer:null;K.bindFramebuffer(ve.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);J.setTexture2D(t,0),ve.copyTexSubImage2D(ve.TEXTURE_2D,n,0,0,e.x,e.y,r,a),K.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,a=t.image.height,o=me.convert(n.format),s=me.convert(n.type);J.setTexture2D(n,0),ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,n.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ve.texSubImage2D(ve.TEXTURE_2D,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(ve.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ve.texSubImage2D(ve.TEXTURE_2D,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&ve.generateMipmap(ve.TEXTURE_2D),K.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=Math.round(e.max.x-e.min.x),o=Math.round(e.max.y-e.min.y),s=e.max.z-e.min.z+1,l=me.convert(i.format),c=me.convert(i.type);let u;if(i.isData3DTexture)J.setTexture3D(i,0),u=ve.TEXTURE_3D;else{if(!i.isDataArrayTexture&&!i.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(i,0),u=ve.TEXTURE_2D_ARRAY}ve.pixelStorei(ve.UNPACK_FLIP_Y_WEBGL,i.flipY),ve.pixelStorei(ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),ve.pixelStorei(ve.UNPACK_ALIGNMENT,i.unpackAlignment);const d=ve.getParameter(ve.UNPACK_ROW_LENGTH),h=ve.getParameter(ve.UNPACK_IMAGE_HEIGHT),p=ve.getParameter(ve.UNPACK_SKIP_PIXELS),m=ve.getParameter(ve.UNPACK_SKIP_ROWS),f=ve.getParameter(ve.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[r]:n.image;ve.pixelStorei(ve.UNPACK_ROW_LENGTH,g.width),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,g.height),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,e.min.x),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,e.min.y),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?ve.texSubImage3D(u,r,t.x,t.y,t.z,a,o,s,l,c,g.data):i.isCompressedArrayTexture?ve.compressedTexSubImage3D(u,r,t.x,t.y,t.z,a,o,s,l,g.data):ve.texSubImage3D(u,r,t.x,t.y,t.z,a,o,s,l,c,g),ve.pixelStorei(ve.UNPACK_ROW_LENGTH,d),ve.pixelStorei(ve.UNPACK_IMAGE_HEIGHT,h),ve.pixelStorei(ve.UNPACK_SKIP_PIXELS,p),ve.pixelStorei(ve.UNPACK_SKIP_ROWS,m),ve.pixelStorei(ve.UNPACK_SKIP_IMAGES,f),0===r&&i.generateMipmaps&&ve.generateMipmap(u),K.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){x=0,b=0,S=null,K.reset(),fe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Cy}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===cy?"display-p3":"srgb",t.unpackColorSpace=Zy.workingColorSpace===uy?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends EM{}).prototype.isWebGL1Renderer=!0;class CM extends gx{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Q_,this.environmentRotation=new Q_,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class TM extends jx{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Rx(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const PM=new p_,kM=new p_,AM=new V_,NM=new H_,RM=new I_;class LM extends gx{constructor(e=new Yx,t=new TM){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)PM.fromBufferAttribute(t,e-1),kM.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=PM.distanceTo(kM);e.setAttribute("lineDistance",new Hx(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),RM.copy(n.boundingSphere),RM.applyMatrix4(i),RM.radius+=r,!1===e.ray.intersectsSphere(RM))return;AM.copy(i).invert(),NM.copy(e.ray).applyMatrix4(AM);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new p_,c=new p_,u=new p_,d=new p_,h=this.isLineSegments?2:1,p=n.index,m=n.attributes.position;if(null!==p){for(let n=Math.max(0,a.start),i=Math.min(p.count,a.start+a.count)-1;n<i;n+=h){const i=p.getX(n),r=p.getX(n+1);l.fromBufferAttribute(m,i),c.fromBufferAttribute(m,r);if(NM.distanceSqToSegment(l,c,d,u)>s)continue;d.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(d);a<e.near||a>e.far||t.push({distance:a,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,a.start),i=Math.min(m.count,a.start+a.count)-1;n<i;n+=h){l.fromBufferAttribute(m,n),c.fromBufferAttribute(m,n+1);if(NM.distanceSqToSegment(l,c,d,u)>s)continue;d.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(d);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const IM=new p_,jM=new p_;class DM extends LM{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)IM.fromBufferAttribute(t,e),jM.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+IM.distanceTo(jM);e.setAttribute("lineDistance",new Hx(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class UM extends Yx{constructor(e=.5,t=1,n=32,i=1,r=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},n=Math.max(3,n);const o=[],s=[],l=[],c=[];let u=e;const d=(t-e)/(i=Math.max(1,i)),h=new p_,p=new zy;for(let m=0;m<=i;m++){for(let e=0;e<=n;e++){const i=r+e/n*a;h.x=u*Math.cos(i),h.y=u*Math.sin(i),s.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,c.push(p.x,p.y)}u+=d}for(let m=0;m<i;m++){const e=m*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,a=i+n+1,s=i+n+2,l=i+1;o.push(r,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new Hx(s,3)),this.setAttribute("normal",new Hx(l,3)),this.setAttribute("uv",new Hx(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new UM(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class OM extends Yx{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new p_,d=new p_,h=[],p=[],m=[],f=[];for(let g=0;g<=n;g++){const h=[],v=g/n;let y=0;0===g&&0===a?y=.5/t:g===n&&s===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(i+s*r)*Math.sin(a+v*o),u.y=e*Math.cos(a+v*o),u.z=e*Math.sin(i+s*r)*Math.sin(a+v*o),p.push(u.x,u.y,u.z),d.copy(u).normalize(),m.push(d.x,d.y,d.z),f.push(s+y,1-v),h.push(l++)}c.push(h)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],o=c[g+1][e+1];(0!==g||a>0)&&h.push(t,i,o),(g!==n-1||s<Math.PI)&&h.push(i,r,o)}this.setIndex(h),this.setAttribute("position",new Hx(p,3)),this.setAttribute("normal",new Hx(m,3)),this.setAttribute("uv",new Hx(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OM(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class FM extends jx{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Rx(16777215),this.specular=new Rx(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rx(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new zy(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Q_,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zM extends gx{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Rx(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const BM=new V_,HM=new p_,VM=new p_;class WM{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new zy(512,512),this.map=null,this.mapPass=null,this.matrix=new V_,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ub,this._frameExtents=new zy(1,1),this._viewportCount=1,this._viewports=[new s_(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;HM.setFromMatrixPosition(e.matrixWorld),t.position.copy(HM),VM.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(VM),t.updateMatrixWorld(),BM.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(BM),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(BM)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class GM extends WM{constructor(){super(new Qb(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class $M extends zM{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gx.DEFAULT_UP),this.updateMatrix(),this.target=new gx,this.shadow=new GM}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class XM extends zM{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const qM=new V_;class KM{constructor(e,t,n=0,i=1/0){this.ray=new H_(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new ex,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return qM.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(qM),this}intersectObject(e,t=!0,n=[]){return ZM(e,this,n,t),n.sort(YM),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)ZM(e[i],this,n,t);return n.sort(YM),n}}function YM(e,t){return e.distance-t.distance}function ZM(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)ZM(i[e],t,n,!0)}}class JM{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ly(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class QM extends DM{constructor(e=10,t=10,n=4473924,i=8947848){n=new Rx(n),i=new Rx(i);const r=t/2,a=e/t,o=e/2,s=[],l=[];for(let u=0,d=0,h=-o;u<=t;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);const e=u===r?n:i;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new Yx;c.setAttribute("position",new Hx(s,3)),c.setAttribute("color",new Hx(l,3));super(c,new TM({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:rv}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=rv);const eE={type:"change"},tE={type:"start"},nE={type:"end"},iE=new H_,rE=new Ib,aE=Math.cos(70*Fy);class oE extends Py{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new p_,this.cursor=new p_,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:av,MIDDLE:ov,RIGHT:sv},this.touches={ONE:lv,TWO:uv},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",K),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",K),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(eE),n.update(),r=i.NONE},this.update=function(){const t=new p_,u=(new h_).setFromUnitVectors(e.up,new p_(0,1,0)),d=u.clone().invert(),h=new p_,p=new h_,m=new p_,f=2*Math.PI;return function(g=null){const v=n.object.position;t.copy(v).sub(n.target),t.applyQuaternion(u),o.setFromVector3(t),n.autoRotate&&r===i.NONE&&C(function(e){return null!==e?2*Math.PI/60*n.autoRotateSpeed*e:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(o.theta+=s.theta*n.dampingFactor,o.phi+=s.phi*n.dampingFactor):(o.theta+=s.theta,o.phi+=s.phi);let y=n.minAzimuthAngle,S=n.maxAzimuthAngle;isFinite(y)&&isFinite(S)&&(y<-Math.PI?y+=f:y>Math.PI&&(y-=f),S<-Math.PI?S+=f:S>Math.PI&&(S-=f),o.theta=y<=S?Math.max(y,Math.min(S,o.theta)):o.theta>(y+S)/2?Math.max(y,o.theta):Math.min(S,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let w=!1;if(n.zoomToCursor&&b||n.object.isOrthographicCamera)o.radius=I(o.radius);else{const e=o.radius;o.radius=I(o.radius*l),w=e!=o.radius}if(t.setFromSpherical(o),t.applyQuaternion(d),v.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(s.theta*=1-n.dampingFactor,s.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(s.set(0,0,0),c.set(0,0,0)),n.zoomToCursor&&b){let i=null;if(n.object.isPerspectiveCamera){const e=t.length();i=I(e*l);const r=e-i;n.object.position.addScaledVector(_,r),n.object.updateMatrixWorld(),w=!!r}else if(n.object.isOrthographicCamera){const e=new p_(x.x,x.y,0);e.unproject(n.object);const r=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),w=r!==n.object.zoom;const a=new p_(x.x,x.y,0);a.unproject(n.object),n.object.position.sub(a).add(e),n.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(iE.origin.copy(n.object.position),iE.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(iE.direction))<aE?e.lookAt(n.target):(rE.setFromNormalAndCoplanarPoint(n.object.up,n.target),iE.intersectPlane(rE,n.target))))}else if(n.object.isOrthographicCamera){const e=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),e!==n.object.zoom&&(n.object.updateProjectionMatrix(),w=!0)}return l=1,b=!1,!!(w||h.distanceToSquared(n.object.position)>a||8*(1-p.dot(n.object.quaternion))>a||m.distanceToSquared(n.target)>a)&&(n.dispatchEvent(eE),h.copy(n.object.position),p.copy(n.object.quaternion),m.copy(n.target),!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Z),n.domElement.removeEventListener("pointerdown",V),n.domElement.removeEventListener("pointercancel",G),n.domElement.removeEventListener("wheel",$),n.domElement.removeEventListener("pointermove",W),n.domElement.removeEventListener("pointerup",G);n.domElement.getRootNode().removeEventListener("keydown",X,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",K),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const a=1e-6,o=new JM,s=new JM;let l=1;const c=new p_,u=new zy,d=new zy,h=new zy,p=new zy,m=new zy,f=new zy,g=new zy,v=new zy,y=new zy,_=new p_,x=new zy;let b=!1;const S=[],w={};let M=!1;function E(e){const t=Math.abs(.01*e);return Math.pow(.95,n.zoomSpeed*t)}function C(e){s.theta-=e}function T(e){s.phi-=e}const P=function(){const e=new p_;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),c.add(e)}}(),k=function(){const e=new p_;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),A=function(){const e=new p_;return function(t,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const a=n.object.position;e.copy(a).sub(n.target);let o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),P(2*t*o/r.clientHeight,n.object.matrix),k(2*i*o/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(P(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),k(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function N(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(e,t){if(!n.zoomToCursor)return;b=!0;const i=n.domElement.getBoundingClientRect(),r=e-i.left,a=t-i.top,o=i.width,s=i.height;x.x=r/o*2-1,x.y=-a/s*2+1,_.set(x.x,x.y,1).unproject(n.object).sub(n.object.position).normalize()}function I(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function j(e){u.set(e.clientX,e.clientY)}function D(e){p.set(e.clientX,e.clientY)}function U(e){if(1===S.length)u.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);u.set(n,i)}}function O(e){if(1===S.length)p.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);p.set(n,i)}}function F(e){const t=Q(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);g.set(0,r)}function z(e){if(1==S.length)d.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);d.set(n,i)}h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*h.x/t.clientHeight),T(2*Math.PI*h.y/t.clientHeight),u.copy(d)}function B(e){if(1===S.length)m.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);m.set(n,i)}f.subVectors(m,p).multiplyScalar(n.panSpeed),A(f.x,f.y),p.copy(m)}function H(e){const t=Q(e),i=e.pageX-t.x,r=e.pageY-t.y,a=Math.sqrt(i*i+r*r);v.set(0,a),y.set(0,Math.pow(v.y/g.y,n.zoomSpeed)),N(y.y),g.copy(v);L(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}function V(e){!1!==n.enabled&&(0===S.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",W),n.domElement.addEventListener("pointerup",G)),function(e){for(let t=0;t<S.length;t++)if(S[t]==e.pointerId)return!0;return!1}(e)||(function(e){S.push(e.pointerId)}(e),"touch"===e.pointerType?Y(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case ov:if(!1===n.enableZoom)return;!function(e){L(e.clientX,e.clientX),g.set(e.clientX,e.clientY)}(e),r=i.DOLLY;break;case av:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;D(e),r=i.PAN}else{if(!1===n.enableRotate)return;j(e),r=i.ROTATE}break;case sv:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;j(e),r=i.ROTATE}else{if(!1===n.enablePan)return;D(e),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(tE)}(e)))}function W(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;z(e),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;B(e),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&H(e),n.enablePan&&B(e)}(e),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&H(e),n.enableRotate&&z(e)}(e),n.update();break;default:r=i.NONE}}(e):function(e){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*h.x/t.clientHeight),T(2*Math.PI*h.y/t.clientHeight),u.copy(d),n.update()}(e);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,g),y.y>0?N(E(y.y)):y.y<0&&R(E(y.y)),g.copy(v),n.update()}(e);break;case i.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY),f.subVectors(m,p).multiplyScalar(n.panSpeed),A(f.x,f.y),p.copy(m),n.update()}(e)}}(e))}function G(e){switch(function(e){delete w[e.pointerId];for(let t=0;t<S.length;t++)if(S[t]==e.pointerId)return void S.splice(t,1)}(e),S.length){case 0:n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",W),n.domElement.removeEventListener("pointerup",G),n.dispatchEvent(nE),r=i.NONE;break;case 1:const t=S[0],a=w[t];Y({pointerId:t,pageX:a.x,pageY:a.y})}}function $(e){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(e.preventDefault(),n.dispatchEvent(tE),function(e){L(e.clientX,e.clientY),e.deltaY<0?R(E(e.deltaY)):e.deltaY>0&&N(E(e.deltaY)),n.update()}(function(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}e.ctrlKey&&!M&&(n.deltaY*=10);return n}(e)),n.dispatchEvent(nE))}function X(e){if("Control"===e.key){M=!0;n.domElement.getRootNode().addEventListener("keyup",q,{passive:!0,capture:!0})}}function q(e){if("Control"===e.key){M=!1;n.domElement.getRootNode().removeEventListener("keyup",q,{passive:!0,capture:!0})}}function K(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?T(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?T(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?C(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?C(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function Y(e){switch(J(e),S.length){case 1:switch(n.touches.ONE){case lv:if(!1===n.enableRotate)return;U(e),r=i.TOUCH_ROTATE;break;case cv:if(!1===n.enablePan)return;O(e),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case uv:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&F(e),n.enablePan&&O(e)}(e),r=i.TOUCH_DOLLY_PAN;break;case dv:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&F(e),n.enableRotate&&U(e)}(e),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(tE)}function Z(e){!1!==n.enabled&&e.preventDefault()}function J(e){let t=w[e.pointerId];void 0===t&&(t=new zy,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){const t=e.pointerId===S[0]?S[1]:S[0];return w[t]}n.domElement.addEventListener("contextmenu",Z),n.domElement.addEventListener("pointerdown",V),n.domElement.addEventListener("pointercancel",G),n.domElement.addEventListener("wheel",$,{passive:!1});n.domElement.getRootNode().addEventListener("keydown",X,{passive:!0,capture:!0}),this.update()}}function sE({isOpen:e,onClose:t,onSelect:n,currentAngle:i}){const r=Pt.useRef(null),a=Pt.useRef(null),o=Pt.useRef(null),s=Pt.useRef(null),l=Pt.useRef(null),c=Pt.useRef(null),u=Pt.useRef(new Map),d=Pt.useRef(new KM),h=Pt.useRef(new zy),p=Pt.useRef(0),m=Pt.useRef(!1),[f,g]=Pt.useState(i),[v,y]=Pt.useState(null),[_,x]=Pt.useState({directions:Yg.map(()=>!0),heights:Zg.map(()=>!0),sizes:Jg.map(()=>!0)});Pt.useEffect(()=>{if(!e||!r.current||m.current)return;const t=r.current,n=a.current;if(!n)return;console.log("Initializing Three.js scene...");const i=new CM;i.background=new Rx(1710618),o.current=i;const d=new Cb(45,n.clientWidth/n.clientHeight,.1,1e3);d.position.set(0,3,6),s.current=d;const h=new EM({canvas:t,antialias:!0,alpha:!0});h.setSize(n.clientWidth,n.clientHeight),h.setPixelRatio(Math.min(window.devicePixelRatio,2)),l.current=h;const f=new oE(d,h.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=3,f.maxDistance=10,f.target.set(0,1.5,0),f.enablePan=!1,c.current=f;const g=new XM(16777215,.6);i.add(g);const v=new $M(16777215,.8);v.position.set(5,10,7),i.add(v);const y=new QM(10,10,4473924,2236962);y.position.y=0,i.add(y);const _=new OM(.15,16,16),x=new Dx({color:16777215}),b=new mb(_,x);b.position.set(0,1,0),i.add(b);[.3,1,1.7,2.4].forEach(e=>{const t=new UM(3.5,3.6,64),n=new Dx({color:4473924,side:2,transparent:!0,opacity:.3}),r=new mb(t,n);r.rotation.x=-Math.PI/2,r.position.y=e,i.add(r)}),console.log("Creating markers for",tv.length,"angles"),tv.forEach(e=>{const[t,n,r]=function(e){const t=Yg.indexOf(e.direction),n=Zg.indexOf(e.height),i=Jg.indexOf(e.size),r=t/Yg.length*Math.PI*2,a=[2,2.5,3][i],o=[.3,1,1.7,2.4][n];return[Math.sin(r)*a,o,Math.cos(r)*a]}(e),a=function(e){const t=Yg.indexOf(e);if(0===t)return 65280;if(4===t)return 16711680;const n=t/Yg.length;return Math.floor(255*n)<<16|Math.floor(255*(1-n))<<8}(e.direction),o=new OM(.1,16,16),s=new FM({color:a,emissive:a,emissiveIntensity:.3}),l=new mb(o,s);l.position.set(t,n,r),l.userData={angle:e},i.add(l),u.current.set(e.id,l)}),console.log("Created",u.current.size,"markers");const S=()=>{n&&d&&h&&(d.aspect=n.clientWidth/n.clientHeight,d.updateProjectionMatrix(),h.setSize(n.clientWidth,n.clientHeight))};window.addEventListener("resize",S),m.current=!0;const w=()=>{p.current=requestAnimationFrame(w),f.update(),h.render(i,d)};return w(),console.log("Three.js scene initialized successfully"),()=>{console.log("Cleaning up Three.js scene..."),window.removeEventListener("resize",S),cancelAnimationFrame(p.current),f.dispose(),h.dispose(),u.current.forEach(e=>{e.geometry.dispose(),e.material.dispose()}),u.current.clear(),m.current=!1,o.current=null,s.current=null,l.current=null,c.current=null}},[e]),Pt.useEffect(()=>{m.current&&tv.forEach(e=>{const t=u.current.get(e.id);if(t){const n=_.directions[Yg.indexOf(e.direction)],i=_.heights[Zg.indexOf(e.height)],r=_.sizes[Jg.indexOf(e.size)];t.visible=n&&i&&r}})},[_]),Pt.useEffect(()=>{if(m.current&&(u.current.forEach(e=>{e.material.emissiveIntensity=.3,e.scale.set(1,1,1)}),f)){const e=u.current.get(f.id);if(e){e.material.emissiveIntensity=1,e.scale.set(1.5,1.5,1.5)}}},[f]);const b=Pt.useCallback(e=>{if(!(r.current&&s.current&&o.current&&m.current))return void console.log("Canvas click ignored - not initialized");const t=r.current.getBoundingClientRect();h.current.x=(e.clientX-t.left)/t.width*2-1,h.current.y=-(e.clientY-t.top)/t.height*2+1,console.log("Click at:",h.current.x,h.current.y),d.current.setFromCamera(h.current,s.current);const n=[];u.current.forEach(e=>{e.visible&&n.push(e)}),console.log("Checking",n.length,"visible markers");const i=d.current.intersectObjects(n);if(console.log("Intersections:",i.length),i.length>0){const e=i[0].object.userData.angle;console.log("Selected angle:",e.displayName),g(e)}},[]),S=Pt.useCallback(e=>{if(!(r.current&&s.current&&o.current&&m.current))return;const t=r.current.getBoundingClientRect();h.current.x=(e.clientX-t.left)/t.width*2-1,h.current.y=-(e.clientY-t.top)/t.height*2+1,d.current.setFromCamera(h.current,s.current);const n=[];u.current.forEach(e=>{e.visible&&n.push(e)});const i=d.current.intersectObjects(n);if(i.length>0){const e=i[0].object.userData.angle;y(e),r.current.style.cursor="pointer"}else y(null),r.current.style.cursor="default"},[]),w=Pt.useCallback((e,t,n)=>{x(i=>({...i,[e]:i[e].map((e,i)=>i===t?n:e)}))},[]),M=Pt.useCallback((e,t)=>{x(n=>({...n,[e]:n[e].map(()=>t)}))},[]),E=Pt.useCallback(()=>{f&&n(f),t()},[f,n,t]);return Pt.useEffect(()=>{e&&g(i)},[e,i]),e?Ut.jsx("div",{className:"camera-angle-overlay",onClick:t,children:Ut.jsxs("div",{className:"camera-angle-modal",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("header",{className:"camera-angle-header",children:[Ut.jsx("h2",{children:"Select Camera Angle"}),Ut.jsx("button",{className:"camera-angle-close",onClick:t,children:""})]}),Ut.jsxs("div",{className:"camera-angle-content",children:[Ut.jsxs("aside",{className:"camera-angle-filters",children:[Ut.jsxs("div",{className:"filter-group",children:[Ut.jsxs("div",{className:"filter-group-header",children:[Ut.jsx("label",{children:"View Direction"}),Ut.jsx("button",{className:"filter-toggle-all",onClick:()=>M("directions",!_.directions.every(Boolean)),children:_.directions.every(Boolean)?"None":"All"})]}),Ut.jsx("div",{className:"filter-checkboxes",children:Yg.map((e,t)=>Ut.jsxs("label",{className:"filter-checkbox",children:[Ut.jsx("input",{type:"checkbox",checked:_.directions[t],onChange:e=>w("directions",t,e.target.checked)}),Ut.jsx("span",{className:"checkbox-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),Ut.jsxs("div",{className:"filter-group",children:[Ut.jsxs("div",{className:"filter-group-header",children:[Ut.jsx("label",{children:"Height"}),Ut.jsx("button",{className:"filter-toggle-all",onClick:()=>M("heights",!_.heights.every(Boolean)),children:_.heights.every(Boolean)?"None":"All"})]}),Ut.jsx("div",{className:"filter-checkboxes",children:Zg.map((e,t)=>Ut.jsxs("label",{className:"filter-checkbox",children:[Ut.jsx("input",{type:"checkbox",checked:_.heights[t],onChange:e=>w("heights",t,e.target.checked)}),Ut.jsx("span",{className:"checkbox-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),Ut.jsxs("div",{className:"filter-group",children:[Ut.jsxs("div",{className:"filter-group-header",children:[Ut.jsx("label",{children:"Shot Size"}),Ut.jsx("button",{className:"filter-toggle-all",onClick:()=>M("sizes",!_.sizes.every(Boolean)),children:_.sizes.every(Boolean)?"None":"All"})]}),Ut.jsx("div",{className:"filter-checkboxes",children:Jg.map((e,t)=>Ut.jsxs("label",{className:"filter-checkbox",children:[Ut.jsx("input",{type:"checkbox",checked:_.sizes[t],onChange:e=>w("sizes",t,e.target.checked)}),Ut.jsx("span",{className:"checkbox-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]})]}),Ut.jsxs("div",{className:"camera-angle-canvas-container",ref:a,children:[Ut.jsx("canvas",{ref:r,onClick:b,onMouseMove:S}),v&&Ut.jsx("div",{className:"camera-angle-tooltip",children:v.displayName})]})]}),Ut.jsxs("footer",{className:"camera-angle-footer",children:[Ut.jsx("div",{className:"camera-angle-selected",children:f?Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("span",{className:"selected-label",children:"Selected:"}),Ut.jsx("span",{className:"selected-value",children:f.displayName}),Ut.jsx("code",{className:"selected-prompt",children:f.prompt})]}):Ut.jsx("span",{className:"selected-empty",children:"No angle selected"})}),Ut.jsxs("div",{className:"camera-angle-actions",children:[Ut.jsx("button",{className:"camera-angle-btn secondary",onClick:t,children:"Cancel"}),Ut.jsx("button",{className:"camera-angle-btn primary",onClick:E,disabled:!f,children:"Apply Angle"})]})]})]})}):null}function lE({parameter:e,value:t,onChange:n,disabled:i}){const[r,a]=Pt.useState(t??e.default);Pt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=Pt.useCallback(t=>{const i=parseInt(t.target.value);a(i),n(e.name,i)},[e.name,n]),s=Pt.useCallback(t=>{const i=parseInt(t.target.value)||0;a(i),n(e.name,i)},[e.name,n]),l=e.constraints||{};return Ut.jsxs("div",{className:"parameter-widget integer-widget",children:[Ut.jsx("label",{className:"parameter-label",children:e.display_name}),Ut.jsxs("div",{className:"parameter-control",children:[Ut.jsx("input",{type:"range",className:"parameter-slider",min:l.min??0,max:l.max??100,step:l.step??1,value:r,onChange:o,disabled:i}),Ut.jsx("input",{type:"number",className:"parameter-input",min:l.min??0,max:l.max??100,step:l.step??1,value:r,onChange:s,disabled:i})]}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description})]})}function cE({parameter:e,value:t,onChange:n,disabled:i}){const[r,a]=Pt.useState(t??e.default);Pt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=Pt.useCallback(t=>{const i=parseFloat(t.target.value);a(i),n(e.name,i)},[e.name,n]),s=Pt.useCallback(t=>{const i=parseFloat(t.target.value)||0;a(i),n(e.name,i)},[e.name,n]),l=e.constraints||{};return Ut.jsxs("div",{className:"parameter-widget float-widget",children:[Ut.jsx("label",{className:"parameter-label",children:e.display_name}),Ut.jsxs("div",{className:"parameter-control",children:[Ut.jsx("input",{type:"range",className:"parameter-slider",min:l.min??0,max:l.max??1,step:l.step??.01,value:r,onChange:o,disabled:i}),Ut.jsx("input",{type:"number",className:"parameter-input",min:l.min??0,max:l.max??1,step:l.step??.01,value:r,onChange:s,disabled:i})]}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description})]})}function uE({parameter:e,value:t,onChange:n,disabled:i}){const[r,a]=Pt.useState(t??e.default);Pt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=Pt.useCallback(t=>{const i=parseInt(t.target.value)||-1;a(i),n(e.name,i)},[e.name,n]),s=Pt.useCallback(()=>{const t=Math.floor(2147483647*Math.random());a(t),n(e.name,t)},[e.name,n]);return Ut.jsxs("div",{className:"parameter-widget seed-widget",children:[Ut.jsx("label",{className:"parameter-label",children:e.display_name}),Ut.jsxs("div",{className:"parameter-control seed-control",children:[Ut.jsx("input",{type:"number",className:"parameter-input seed-input",value:r,onChange:o,disabled:i}),Ut.jsx("button",{className:"seed-randomize-btn",onClick:s,disabled:i,title:"Randomize seed",children:""})]}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description})]})}const dE=[".safetensors",".pt",".pth",".bin",".ckpt",".gguf",".sft"],hE=e=>dE.some(t=>e.toLowerCase().endsWith(t));function pE(e){const t=e.replace(/\\/g,"/"),n=t.lastIndexOf("/"),i=n>0?t.substring(n+1):t,r=i.lastIndexOf(".");return r>0?i.substring(0,r):i}function mE(e,t){if(!e)return t[0]||"";const n=e.replace(/\\/g,"/");return t.find(e=>e.replace(/\\/g,"/")===n)||n}function fE({parameter:e,value:t,onChange:n,disabled:i}){var r;const a=(null==(r=e.constraints)?void 0:r.options)||[],o=a.length>0&&a.every(hE),[s,l]=Pt.useState(()=>o?mE(t??e.default,a):t??e.default);Pt.useEffect(()=>{l(o?mE(t??e.default,a):t??e.default)},[t,e.default,a,o]);const c=Pt.useCallback(t=>{const i=t.target.value;l(i),n(e.name,i)},[e.name,n]),u=Pt.useMemo(()=>o?function(e){const t=new Map;for(const n of e){const e=n.replace(/\\/g,"/"),i=e.lastIndexOf("/"),r=i>0?e.substring(0,i):"(root)";t.has(r)||t.set(r,[]),t.get(r).push(n)}return t}(a):null,[a,o]);return Ut.jsxs("div",{className:"parameter-widget enum-widget",children:[Ut.jsx("label",{className:"parameter-label",children:e.display_name}),Ut.jsx("select",{className:"parameter-select",value:s,onChange:c,disabled:i,children:o&&u?Array.from(u.entries()).map(([e,t])=>Ut.jsx("optgroup",{label:e,children:t.map(e=>Ut.jsx("option",{value:e,children:pE(e)},e))},e)):a.map(e=>Ut.jsx("option",{value:e,children:e},e))}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description})]})}function gE({parameter:e,value:t,onChange:n,disabled:i}){const[r,a]=Pt.useState(t??e.default);Pt.useEffect(()=>{a(t??e.default)},[t,e.default]);const o=Pt.useCallback(t=>{const i=t.target.checked;a(i),n(e.name,i)},[e.name,n]);return Ut.jsxs("div",{className:"parameter-widget boolean-widget",children:[Ut.jsxs("label",{className:"parameter-label boolean-label",children:[Ut.jsx("input",{type:"checkbox",className:"parameter-checkbox",checked:r,onChange:o,disabled:i}),Ut.jsx("span",{children:e.display_name})]}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description})]})}function vE({parameter:e,value:t,onChange:n,disabled:i,onEnhance:r,cameraAngle:a,onCameraAngleChange:o}){const{cpePromptForStoryboard:s,setCpePromptForStoryboard:l}=Rm(),c="string"==typeof t?t:t?String(t):"",[u,d]=Pt.useState(c??e.default??""),[h,p]=Pt.useState(!1),[m,f]=Pt.useState(!1);Pt.useEffect(()=>{const n="string"==typeof t?t:t?String(t):"";d(n??e.default??"")},[t,e.default]);const g=Pt.useCallback(t=>{const i=t.target.value;d(i),n(e.name,i)},[e.name,n]),v=Pt.useCallback(()=>{s&&(d(s),n(e.name,s),l(null))},[s,e.name,n,l]),y=Pt.useCallback(async()=>{if(r&&u.trim()&&!h){p(!0);try{const t=await r(u);d(t),n(e.name,t)}catch(t){console.error("Failed to enhance prompt:",t)}finally{p(!1)}}},[u,r,h,e.name,n]),_=Pt.useCallback(t=>{const i=iv(u),r=`${t.prompt} ${i}`.trim();d(r),n(e.name,r),null==o||o(t)},[u,e.name,n,o]),x=Pt.useCallback(()=>{const t=iv(u);d(t),n(e.name,t),null==o||o(null)},[u,e.name,n,o]);Pt.useEffect(()=>{const e=nv(u);(null==e?void 0:e.id)!==(null==a?void 0:a.id)&&(null==o||o(e))},[u,null==a?void 0:a.id,o]);const b=e.name.includes("negative"),S=b?"prompt-textarea negative":"prompt-textarea positive",w=r&&!b;return Ut.jsxs("div",{className:"parameter-widget prompt-widget",children:[a&&!b&&Ut.jsxs("div",{className:"camera-angle-badge",children:[Ut.jsx("span",{className:"badge-icon",children:""}),Ut.jsx("span",{className:"badge-text",children:a.displayName}),Ut.jsx("button",{className:"badge-clear",onClick:x,title:"Clear angle",disabled:i,children:""})]}),Ut.jsxs("div",{className:"prompt-header",children:[Ut.jsx("label",{className:"parameter-label",children:e.display_name}),Ut.jsxs("div",{className:"prompt-toolbar",children:[!b&&s&&Ut.jsx("button",{className:"cpe-paste-btn",onClick:v,disabled:i,title:"Paste prompt from Cinema Prompt Engineering",children:""}),!b&&Ut.jsx("button",{className:"angle-selector-btn "+(a?"has-angle":""),onClick:()=>f(!0),disabled:i,title:"Select camera angle",children:""}),w&&Ut.jsx("button",{className:"ai-enhance-btn "+(h?"enhancing":""),onClick:y,disabled:i||h||!u.trim(),title:h?"Enhancing prompt...":"Enhance with AI",children:h?"...":""})]})]}),Ut.jsx("textarea",{className:S,value:u,onChange:g,disabled:i,rows:4,placeholder:`Enter ${b?"negative":"positive"} prompt...`}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description}),!b&&Ut.jsx(sE,{isOpen:m,onClose:()=>f(!1),onSelect:_,currentAngle:a??null})]})}function yE({parameter:e,value:t,onChange:n,disabled:i,comfyUrl:r}){const a=Pt.useCallback((t,i)=>{n(e.name,i)},[e.name,n]),o="__BYPASSED__"===t,s=Pt.useCallback(t=>{n(e.name,t?"__BYPASSED__":null)},[e.name,n]);return Ut.jsx(Kg,{name:e.name,displayName:e.display_name,value:o?null:t,onChange:a,disabled:i,acceptType:"image",isBypassed:o,onBypassChange:s,comfyUrl:r})}function _E({parameter:e,value:t,onChange:n,disabled:i,comfyUrl:r}){const a=Pt.useCallback((t,i)=>{n(e.name,i)},[e.name,n]),o="__BYPASSED__"===t,s=Pt.useCallback(t=>{n(e.name,t?"__BYPASSED__":null)},[e.name,n]);return Ut.jsx(Kg,{name:e.name,displayName:e.display_name,value:o?null:t,onChange:a,disabled:i,acceptType:"video",isBypassed:o,onBypassChange:s,comfyUrl:r})}function xE({parameter:e,value:t,onChange:n,disabled:i,comfyUrl:r}){const a=Pt.useCallback((t,i)=>{n(e.name,i)},[e.name,n]),o="__BYPASSED__"===t,s=Pt.useCallback(t=>{n(e.name,t?"__BYPASSED__":null)},[e.name,n]);return Ut.jsx(Kg,{name:e.name,displayName:e.display_name,value:o?null:t,onChange:a,disabled:i,acceptType:"any",isBypassed:o,onBypassChange:s,comfyUrl:r})}function bE({parameter:e,value:t,onChange:n,disabled:i,availableLoras:r=[],onBypassChange:a,isBypassed:o=!1}){var s;const l="object"==typeof t&&null!==t,c=e=>e.replace(/\\/g,"/"),u=e=>{if(!e||0===r.length)return"";const t=c(e);return r.find(e=>c(e)===t)||""},[d,h]=Pt.useState(u(l?t.lora_name:(null==(s=e.constraints)?void 0:s.lora_name)||"")),[p,m]=Pt.useState(l?t.strength:"number"==typeof t?t:e.default??1),[f,g]=Pt.useState(l?t.bypassed??o:o);Pt.useEffect(()=>{"object"==typeof t&&null!==t?(h(u(t.lora_name||"")),m(t.strength??1),g(t.bypassed??!1)):"number"==typeof t&&m(t)},[t,r]),Pt.useEffect(()=>{g(o)},[o]);const v=Pt.useCallback(i=>{const r=i.target.value;h(r),l?n(e.name,{...t,lora_name:r}):n(e.name+"_lora_name",r)},[e.name,n,t,l]),y=Pt.useCallback(i=>{const r=parseFloat(i.target.value);m(r),n(e.name,l?{...t,strength:r}:r)},[e.name,n,t,l]),_=Pt.useCallback(()=>{const i=!f;g(i),a&&a(e.name,i),l&&n(e.name,{...t,bypassed:i})},[f,e.name,n,a,t,l]),x=e.constraints||{},b=e=>{if(!e)return"";return(e.split(/[/\\]/).pop()||e).replace(/\.safetensors$|\.ckpt$/i,"")};return Ut.jsxs("div",{className:"parameter-widget lora-widget "+(f?"bypassed":""),children:[Ut.jsxs("div",{className:"lora-header",children:[Ut.jsx("label",{className:"parameter-label",children:e.display_name}),Ut.jsx("button",{className:"bypass-toggle "+(f?"bypassed":"active"),onClick:_,disabled:i,title:f?"Enable this LoRA":"Bypass this LoRA",children:f?" Bypassed":" Active"})]}),!f&&Ut.jsxs("div",{className:"lora-controls",children:[r.length>0&&Ut.jsx("div",{className:"lora-dropdown-container",children:Ut.jsxs("select",{className:"parameter-select lora-select",value:d,onChange:v,disabled:i,children:[Ut.jsx("option",{value:"",children:"-- Select LoRA --"}),(()=>{const e={},t=[];return r.forEach(n=>{const i=c(n).split("/");if(i.length>1){const t=i.slice(0,-1).join("/");e[t]||(e[t]=[]),e[t].push(n)}else t.push(n)}),Ut.jsxs(Ut.Fragment,{children:[t.map(e=>Ut.jsx("option",{value:e,children:b(e)},e)),Object.keys(e).sort().map(t=>Ut.jsx("optgroup",{label:t,children:e[t].map(e=>Ut.jsx("option",{value:e,children:b(e)},e))},t))]})})()]})}),Ut.jsxs("div",{className:"lora-strength-container",children:[Ut.jsx("label",{className:"strength-label",children:"Strength"}),Ut.jsxs("div",{className:"parameter-control",children:[Ut.jsx("input",{type:"range",className:"parameter-slider",min:x.min??-2,max:x.max??2,step:x.step??.01,value:p,onChange:y,disabled:i}),Ut.jsx("input",{type:"number",className:"parameter-input",min:x.min??-2,max:x.max??2,step:x.step??.01,value:p,onChange:y,disabled:i})]})]})]}),f&&Ut.jsxs("div",{className:"lora-bypassed-placeholder",children:[Ut.jsx("span",{className:"bypassed-icon",children:""}),Ut.jsx("span",{className:"bypassed-text",children:"LoRA bypassed - will not be applied"})]}),e.description&&Ut.jsx("span",{className:"parameter-description",children:e.description})]})}function SE({parameter:e,value:t,onChange:n,disabled:i,onEnhancePrompt:r,cameraAngle:a,onCameraAngleChange:o,comfyUrl:s}){var l,c;switch(e.type){case"integer":return Ut.jsx(lE,{parameter:e,value:t,onChange:n,disabled:i});case"float":return Ut.jsx(cE,{parameter:e,value:t,onChange:n,disabled:i});case"seed":return Ut.jsx(uE,{parameter:e,value:t,onChange:n,disabled:i});case"enum":return Ut.jsx(fE,{parameter:e,value:t,onChange:n,disabled:i});case"boolean":return Ut.jsx(gE,{parameter:e,value:t,onChange:n,disabled:i});case"prompt":return Ut.jsx(vE,{parameter:e,value:t,onChange:n,disabled:i,onEnhance:r,cameraAngle:a,onCameraAngleChange:t=>null==o?void 0:o(e.name,t)});case"image":case"image_list":return Ut.jsx(yE,{parameter:e,value:t,onChange:n,disabled:i,comfyUrl:s});case"video":case"video_list":return Ut.jsx(_E,{parameter:e,value:t,onChange:n,disabled:i,comfyUrl:s});case"media":return Ut.jsx(xE,{parameter:e,value:t,onChange:n,disabled:i,comfyUrl:s});case"lora":return Ut.jsx(bE,{parameter:e,value:t,onChange:n,disabled:i,availableLoras:(null==(l=e.constraints)?void 0:l.availableLoras)||[],isBypassed:(null==(c=e.constraints)?void 0:c.bypassed)||!1});default:return Ut.jsx(vE,{parameter:e,value:t,onChange:n,disabled:i,onEnhance:r})}}function wE({parameters:e,values:t,onChange:n,disabled:i,onEnhancePrompt:r,cameraAngles:a,onCameraAngleChange:o,comfyUrl:s}){return 0===e.length?Ut.jsx("div",{className:"parameter-panel empty",children:Ut.jsx("p",{children:"No parameters available for this template."})}):Ut.jsxs("div",{className:"parameter-panel",children:[Ut.jsx("div",{className:"parameter-panel-title",children:"Parameters"}),Ut.jsx("div",{className:"parameter-list",children:e.map(e=>Ut.jsx(SE,{parameter:e,value:t[e.name],onChange:n,disabled:i,onEnhancePrompt:r,cameraAngle:(null==a?void 0:a[e.name])??null,onCameraAngleChange:o,comfyUrl:s},e.name))})]})}const ME=new class{constructor(){je(this,"cache",null),je(this,"cacheTimestamp",0),je(this,"cacheTTL",3e5),je(this,"fetchPromise",null)}async fetchDefinitions(e){const t=Date.now();if(this.cache&&t-this.cacheTimestamp<this.cacheTTL)return this.cache;if(this.fetchPromise)return this.fetchPromise;this.fetchPromise=this._doFetch(e);try{return this.cache=await this.fetchPromise,this.cacheTimestamp=t,this.cache}finally{this.fetchPromise=null}}async _doFetch(e){const t=e.replace(/\/ws$/,"").replace(/\/$/,""),n=await fetch(`${t}/object_info`);if(!n.ok)throw new Error(`Failed to fetch object_info: ${n.statusText}`);const i=await n.json();return console.log(`[NodeDefinitions] Loaded ${Object.keys(i).length} node definitions`),i}getNodeDefinition(e){return this.cache&&this.cache[e]||null}getEnumOptions(e,t){var n,i;const r=this.getNodeDefinition(e);if(!r)return null;if(null==(n=r.input.required)?void 0:n[t]){const e=r.input.required[t];return this._extractEnumOptions(e)}if(null==(i=r.input.optional)?void 0:i[t]){const e=r.input.optional[t];return this._extractEnumOptions(e)}return null}_extractEnumOptions(e){if(Array.isArray(e)){const[t]=e;if(Array.isArray(t))return t}return null}getInputDefinition(e,t){const n=this.getNodeDefinition(e);if(!n)return null;const i=e=>{if(!(null==e?void 0:e[t]))return null;const n=e[t];if(Array.isArray(n)){const[e,t]=n;return Array.isArray(e)?{type:"enum",isEnum:!0,options:e,default:(null==t?void 0:t.default)??e[0]}:{type:e,isEnum:!1,min:null==t?void 0:t.min,max:null==t?void 0:t.max,step:null==t?void 0:t.step,default:null==t?void 0:t.default}}return{type:String(n),isEnum:!1}};return i(n.input.required)||i(n.input.optional)}isLoaded(){return null!==this.cache}async getLoras(e){return await this.fetchDefinitions(e),this.getEnumOptions("LoraLoader","lora_name")||[]}clearCache(){this.cache=null,this.cacheTimestamp=0}},EE={seed:"seed",steps:"integer",cfg:"float",denoise:"float",strength:"float",noise_seed:"seed",text:"prompt",prompt:"prompt",positive:"prompt",negative:"prompt",width:"integer",height:"integer",batch_size:"integer",sampler_name:"enum",scheduler:"enum"},CE={sampler_name:["euler","euler_cfg_pp","euler_ancestral","euler_ancestral_cfg_pp","heun","heunpp2","dpm_2","dpm_2_ancestral","lms","dpm_fast","dpm_adaptive","dpmpp_2s_ancestral","dpmpp_sde","dpmpp_2m","ddpm","lcm","ipndm","ddim","uni_pc"],scheduler:["normal","karras","exponential","sgm_uniform","simple"]};function TE({workflow:e,parsedWorkflow:t,initialConfig:n,comfyUrl:i,onSave:r,onCancel:a}){const[o,s]=Pt.useState([]),[l,c]=Pt.useState(null),[u,d]=Pt.useState("exposed"),[h,p]=Pt.useState(""),[m,f]=Pt.useState(!1),[g,v]=Pt.useState(null),y=Pt.useRef(null),[_,x]=Pt.useState(!1),[b,S]=Pt.useState([]);Pt.useEffect(()=>{i&&!_&&(ME.fetchDefinitions(i).then(()=>{x(!0),console.log("[WorkflowEditor] Node definitions loaded")}).catch(e=>{console.error("[WorkflowEditor] Failed to load node definitions:",e)}),ME.getLoras(i).then(e=>{S(e),console.log(`[WorkflowEditor] Loaded ${e.length} available LoRAs`)}).catch(e=>{console.error("[WorkflowEditor] Failed to load LoRAs:",e)}))},[i,_]),Pt.useEffect(()=>{if(n&&n.length>0){const e=[...n].sort((e,t)=>e.order-t.order);s(e)}else if(t){const e=[];t.parameters.forEach((t,n)=>{e.push({name:t.name,display_name:t.display_name,node_id:t.node_id,input_name:t.input_name,type:t.type,default:t.default,description:t.description,constraints:t.constraints,order:n,exposed:!0,category:"parameter",auto_detected:!0,user_modified:!1})}),t.image_inputs.forEach((n,i)=>{const r="video"===n.type?"video":"image";e.push({name:n.name,display_name:n.display_name,node_id:n.node_id,input_name:n.input_name,type:r,default:"",description:n.description,order:t.parameters.length+i,exposed:!0,category:"image_input",auto_detected:!0,user_modified:!1})}),t.loras.forEach((n,i)=>{e.push({name:n.name,display_name:n.display_name,node_id:n.node_id,input_name:"strength_model",type:"lora",default:n.default_strength,description:`LoRA: ${n.display_name}`,constraints:{min:-10,max:10,step:.01,availableLoras:b,lora_name:n.lora_name||"",bypassed:!1},order:t.parameters.length+t.image_inputs.length+i,exposed:!0,category:"lora",auto_detected:!0,user_modified:!1})}),s(e)}},[t,n,b]),Pt.useEffect(()=>{b.length>0&&o.length>0&&s(e=>e.map(e=>"lora"===e.category?{...e,constraints:{...e.constraints,availableLoras:b}}:e))},[b]),Pt.useEffect(()=>{if(m&&o.length>0){const t=setTimeout(()=>{const t=e?JSON.stringify(e).slice(0,50):"unknown";localStorage.setItem(`workflow_config_${t}`,JSON.stringify(o)),console.log("Auto-saved workflow configuration")},1e3);return()=>clearTimeout(t)}},[o,m,e]);const w=Pt.useCallback(()=>{var t;if(!e)return[];const n=[];for(const[i,r]of Object.entries(e)){if("meta"===i||"object"!=typeof r||null===r)continue;const e=r,a=[];if(e.inputs)for(const[t,n]of Object.entries(e.inputs)){if(Array.isArray(n))continue;const e=o.some(e=>e.node_id===i&&e.input_name===t&&e.exposed);a.push({name:t,value:n,type:typeof n,exposed:e})}a.length>0&&n.push({id:i,class_type:e.class_type||"Unknown",title:(null==(t=e._meta)?void 0:t.title)||e.class_type||`Node ${i}`,inputs:a})}return n},[e,o]),M=Pt.useCallback((t,n,i)=>{let r=function(e,t){const n=e.toLowerCase();return EE[n]?EE[n]:"boolean"==typeof t?"boolean":"number"==typeof t?Number.isInteger(t)?"integer":"float":"string"==typeof t&&(n.includes("prompt")||n.includes("text"))?"prompt":"string"}(n,i),a=function(e){switch(e){case"integer":return{min:0,max:100,step:1};case"float":return{min:0,max:1,step:.01};case"seed":return{min:-1,max:2147483647,step:1};case"enum":return{options:[]};default:return}}(r)||{};const l=null==e?void 0:e[t];if(null==l?void 0:l.class_type){const e=ME.getInputDefinition(l.class_type,n);(null==e?void 0:e.isEnum)&&e.options&&(r="enum",a={options:e.options},console.log(`[WorkflowEditor] Detected enum from node definitions: ${l.class_type}.${n}`,e.options))}"enum"===r&&!a.options&&CE[n.toLowerCase()]&&(a.options=CE[n.toLowerCase()]);const c={name:`${n}_${t}`,display_name:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),node_id:t,input_name:n,type:r,default:i,description:`Parameter ${n} from node ${t}`,constraints:a,order:o.length,exposed:!0,category:"parameter",auto_detected:!1,user_modified:!0};s(e=>[...e,c]),f(!0)},[o.length]),E=Pt.useCallback((e,t)=>{s(n=>{const i=[...n];return i[e]={...i[e],...t,user_modified:!0},i}),f(!0)},[]),C=Pt.useCallback(e=>{s(t=>t.filter((t,n)=>n!==e)),f(!0),l&&o[e]===l&&c(null)},[o,l]),T=Pt.useCallback((e,t)=>{v(t),y.current=t,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},[]),P=Pt.useCallback(()=>{y.current=null,v(null)},[]),k=Pt.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation();const n=y.current;null!==n&&n!==t&&(s(e=>{const i=[...e],r=i[n];return i.splice(n,1),i.splice(t,0,r),i.forEach((e,t)=>{e.order=t}),i}),y.current=t,v(t),f(!0))},[]),A=Pt.useCallback((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),N=Pt.useCallback(e=>{e.preventDefault(),y.current=null,v(null)},[]),R=o.filter(e=>{const t=e.name.toLowerCase().includes(h.toLowerCase())||e.display_name.toLowerCase().includes(h.toLowerCase())||e.node_id.toLowerCase().includes(h.toLowerCase());return"exposed"===u?e.exposed&&t:t}),L=Pt.useCallback(()=>{const e=[...o].sort((e,t)=>e.order-t.order);r(e)},[o,r]),I=w();return e?Ut.jsxs("div",{className:"workflow-editor",children:[Ut.jsxs("div",{className:"editor-header",children:[Ut.jsx("h2",{children:"Workflow Editor"}),Ut.jsxs("div",{className:"editor-actions",children:[Ut.jsx("button",{className:"editor-btn secondary",onClick:a,children:"Cancel"}),Ut.jsx("button",{className:"editor-btn primary",onClick:L,children:"Save Configuration"})]})]}),Ut.jsxs("div",{className:"editor-tabs",children:[Ut.jsxs("button",{className:"editor-tab "+("exposed"===u?"active":""),onClick:()=>d("exposed"),children:["Exposed Parameters (",o.filter(e=>e.exposed).length,")"]}),Ut.jsx("button",{className:"editor-tab "+("all"===u?"active":""),onClick:()=>d("all"),children:"All Nodes"})]}),Ut.jsx("div",{className:"editor-search",children:Ut.jsx("input",{type:"text",placeholder:"Search parameters...",value:h,onChange:e=>p(e.target.value)})}),Ut.jsxs("div",{className:"editor-content",children:["exposed"===u&&Ut.jsx("div",{className:"parameters-list",children:0===R.length?Ut.jsx("p",{className:"empty-message",children:'No exposed parameters. Add parameters from the "All Nodes" tab.'}):R.map((t,n)=>Ut.jsx(PE,{config:t,workflow:e,isSelected:l===t,onSelect:()=>c(t),onUpdate:e=>E(n,e),onRemove:()=>C(n),onDragStart:e=>T(e,n),onDragOver:e=>A(e,n),onDragEnter:e=>k(e,n),onDrop:N,onDragEnd:P,isDragging:g===n},`${t.node_id}-${t.input_name}`))}),"all"===u&&Ut.jsx("div",{className:"nodes-list",children:I.map(e=>Ut.jsx(kE,{node:e,onAddParameter:(t,n)=>M(e.id,t,n)},e.id))})]}),m&&Ut.jsx("div",{className:"editor-status",children:"Unsaved changes will be auto-saved"})]}):Ut.jsx("div",{className:"workflow-editor",children:Ut.jsxs("div",{className:"editor-empty",children:[Ut.jsx("p",{children:"No workflow loaded. Please import a workflow first."}),Ut.jsx("button",{className:"editor-btn",onClick:a,children:"Close"})]})})}function PE({config:e,workflow:t,isSelected:n,onSelect:i,onUpdate:r,onRemove:a,onDragStart:o,onDragOver:s,onDragEnter:l,onDrop:c,onDragEnd:u,isDragging:d}){var h,p,m,f,g;const[v,y]=Pt.useState(!1);return Ut.jsxs("div",{className:`parameter-config-card ${n?"selected":""} ${e.auto_detected?"auto":"manual"} ${d?"dragging":""}`,onClick:i,onDragOver:s,onDragEnter:l,onDrop:c,children:[Ut.jsxs("div",{className:"config-header",children:[Ut.jsx("div",{className:"config-order",children:Ut.jsx("div",{className:"drag-handle",title:"Drag to reorder",draggable:"true",onDragStart:e=>{e.stopPropagation(),o(e)},onDragEnd:e=>{e.stopPropagation(),u()},onClick:e=>e.stopPropagation(),children:""})}),Ut.jsxs("div",{className:"config-info",children:[Ut.jsx("input",{type:"text",className:"config-name",value:e.display_name,onChange:e=>r({display_name:e.target.value}),onClick:e=>e.stopPropagation(),placeholder:"Display Name"}),Ut.jsxs("span",{className:"config-meta",children:[e.node_id,"  ",e.input_name," (",e.type,")"]})]}),Ut.jsxs("div",{className:"config-actions",children:[Ut.jsx("button",{className:"config-toggle",onClick:e=>{e.stopPropagation(),y(!v)},children:v?"":""}),Ut.jsx("button",{className:"config-remove",onClick:e=>{e.stopPropagation(),a()},title:"Remove parameter",children:""})]})]}),v&&Ut.jsxs("div",{className:"config-details",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Name (internal):"}),Ut.jsx("input",{type:"text",value:e.name,onChange:e=>r({name:e.target.value}),placeholder:"snake_case_name"})]}),Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Type:"}),Ut.jsxs("select",{value:e.type,onChange:e=>r({type:e.target.value}),children:[Ut.jsx("option",{value:"integer",children:"Integer"}),Ut.jsx("option",{value:"float",children:"Float"}),Ut.jsx("option",{value:"seed",children:"Seed"}),Ut.jsx("option",{value:"boolean",children:"Boolean"}),Ut.jsx("option",{value:"enum",children:"Enum"}),Ut.jsx("option",{value:"prompt",children:"Prompt"}),Ut.jsx("option",{value:"string",children:"String"}),Ut.jsx("option",{value:"image",children:"Image"}),Ut.jsx("option",{value:"video",children:"Video"}),Ut.jsx("option",{value:"media",children:"Media (Image/Video)"})]})]}),Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Default Value:"}),Ut.jsx("input",{type:"text",value:String(e.default),onChange:t=>{let n=t.target.value;"integer"===e.type||"seed"===e.type?n=parseInt(n)||0:"float"===e.type?n=parseFloat(n)||0:"boolean"===e.type&&(n="true"===n),r({default:n})}})]}),Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Description:"}),Ut.jsx("input",{type:"text",value:e.description,onChange:e=>r({description:e.target.value}),placeholder:"Parameter description"})]}),("integer"===e.type||"float"===e.type||"seed"===e.type)&&Ut.jsxs("div",{className:"config-constraints",children:[Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Min:"}),Ut.jsx("input",{type:"number",value:(null==(h=e.constraints)?void 0:h.min)??0,onChange:t=>r({constraints:{...e.constraints,min:parseFloat(t.target.value)}})})]}),Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Max:"}),Ut.jsx("input",{type:"number",value:(null==(p=e.constraints)?void 0:p.max)??100,onChange:t=>r({constraints:{...e.constraints,max:parseFloat(t.target.value)}})})]}),Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Step:"}),Ut.jsx("input",{type:"number",value:(null==(m=e.constraints)?void 0:m.step)??1,onChange:t=>r({constraints:{...e.constraints,step:parseFloat(t.target.value)}})})]})]}),"enum"===e.type&&Ut.jsxs("div",{className:"config-row",children:[Ut.jsx("label",{children:"Options (comma-separated):"}),Ut.jsxs("div",{className:"enum-options-row",children:[Ut.jsx("input",{type:"text",value:(null==(g=null==(f=e.constraints)?void 0:f.options)?void 0:g.join(", "))||"",onChange:t=>r({constraints:{...e.constraints,options:t.target.value.split(",").map(e=>e.trim()).filter(Boolean)}}),placeholder:"option1, option2, option3"}),Ut.jsx("button",{type:"button",className:"fetch-options-btn",onClick:()=>{if(!t)return;const n=t[e.node_id];if(null==n?void 0:n.class_type){const t=ME.getEnumOptions(n.class_type,e.input_name);t&&t.length>0?r({constraints:{...e.constraints,options:t}}):alert(`No enum options found for ${n.class_type}.${e.input_name}.\nMake sure ComfyUI is connected.`)}},title:"Fetch options from ComfyUI",children:" Fetch"})]})]}),Ut.jsxs("div",{className:"config-flags",children:[Ut.jsxs("label",{className:"flag",children:[Ut.jsx("input",{type:"checkbox",checked:e.exposed,onChange:e=>r({exposed:e.target.checked})}),"Exposed in UI"]}),Ut.jsx("span",{className:"config-source",children:e.auto_detected?" Auto-detected":" User-defined"})]})]})]})}function kE({node:e,onAddParameter:t}){const[n,i]=Pt.useState(!1);return Ut.jsxs("div",{className:"node-card",children:[Ut.jsxs("div",{className:"node-header",onClick:()=>i(!n),children:[Ut.jsx("span",{className:"node-toggle",children:n?"":""}),Ut.jsxs("div",{className:"node-info",children:[Ut.jsx("span",{className:"node-title",children:e.title}),Ut.jsx("span",{className:"node-type",children:e.class_type})]}),Ut.jsxs("span",{className:"node-id",children:["ID: ",e.id]})]}),n&&Ut.jsx("div",{className:"node-inputs",children:e.inputs.map(e=>Ut.jsxs("div",{className:"node-input "+(e.exposed?"exposed":""),children:[Ut.jsxs("div",{className:"input-info",children:[Ut.jsx("span",{className:"input-name",children:e.name}),Ut.jsx("span",{className:"input-type",children:e.type}),Ut.jsx("span",{className:"input-value",children:String(e.value).slice(0,50)})]}),e.exposed?Ut.jsx("span",{className:"input-added",children:" Exposed"}):Ut.jsx("button",{className:"input-add-btn",onClick:()=>t(e.name,e.value),children:"+ Expose"})]},e.name))})]})}class AE{normalizeWorkflowFormat(e){var t;if("nodes"in e&&Array.isArray(e.nodes)&&e.nodes.length>0){const n=e,i={},r=new Map;if(n.links)for(const e of n.links){const t=e[0],n=e[1],i=e[2];r.set(t,[n,i])}for(const e of n.nodes){const n=String(e.id),a=e,o=a.type||e.class_type||"",s={};if(a.inputs&&Array.isArray(a.inputs))for(const e of a.inputs)if(null!==e.link&&void 0!==e.link){const t=r.get(e.link);t&&(s[e.name]=[String(t[0]),t[1]])}i[n]={class_type:o,inputs:s,widgets_values:a.widgets_values,_meta:{title:a.title||(null==(t=a.properties)?void 0:t["Node name for S&R"])||""},mode:a.mode}}return i}return e}parseWorkflow(e){const t=this.normalizeWorkflowFormat(e),n=this._extractParameters(t),i=this._extractImageInputs(t),r=this._extractLoRAs(t),a=this._extractOutputs(t),o=this._detectCategories(t),s=this._detectNextSceneSupport(t),l=r.some(e=>"qwen-image-edit-2511-multiple-angles-lora.safetensors"===e.lora_name);return{parameters:n,image_inputs:i,loras:r,outputs:a,categories:o,has_next_scene_support:s,hasMultiAngleLora:l}}_normalizeNode(e){const t=e.class_type||e.type||"";let n=e.inputs||{};if(e.widgets_values&&Array.isArray(e.widgets_values)){const i=this._getWidgetNames(t);e.widgets_values.forEach((e,t)=>{i[t]&&(n[i[t]]=e)})}return{class_type:t,inputs:n}}_getWidgetNames(e){return{KSampler:["seed","control_after_generate","steps","cfg","sampler_name","scheduler","denoise"],KSamplerAdvanced:["add_noise","noise_seed","steps","cfg","sampler_name","scheduler","start_at_step","end_at_step","return_with_leftover_noise"],CLIPTextEncode:["text"],EmptyLatentImage:["width","height","batch_size"],EmptySD3LatentImage:["width","height","batch_size"],LoadImage:["image","upload"],LoraLoader:["lora_name","strength_model","strength_clip"],LoraLoaderModelOnly:["lora_name","strength_model"],VAELoader:["vae_name"],CLIPLoader:["clip_name","type","device"],UNETLoader:["unet_name","weight_dtype"],VAEEncode:[],VAEDecode:[],SaveImage:["filename_prefix"],PreviewImage:[],ModelSamplingAuraFlow:["shift"],ConditioningZeroOut:[],QwenImageIntegratedKSampler:["prompt","negative_prompt","mode","batch_size","image1_weight","image2_weight","seed","control_after_generate","steps","denoise","sampler_name","scheduler","scale_method","cfg","image_count","tile_vae","use_teacache","use_fp8_linear","custom_prompt","save_prefix","system_prompt"],FluxResolutionNode:["megapixels","aspect_ratio","divisor","preview","last_ratio"],ImageResizeKJv2:["width","height","upscale_method","crop","pad_color","pad_position","divisor","device"],ImageScaleToTotalPixels:["upscale_method","megapixels"],VHS_LoadVideo:["video","force_rate","custom_width","custom_height","frame_load_cap","skip_first_frames","select_every_nth","format"],OlmDragCrop:["seed","crop_left","crop_right","crop_top","crop_bottom","crop_width","crop_height","img_width","img_height","snap","aspect_ratio","lock_aspect","action","refresh","mask","color","reset"],OpenposePreprocessor:["detect_hand","detect_body","detect_face","resolution","bbox_detector"],DepthAnything_V2:[],DownloadAndLoadDepthAnythingV2Model:["model"],UnetLoaderGGUF:["unet_name"],PathchSageAttentionKJ:["attention_mode","force_fp16"],"Power Lora Loader (rgthree)":[],"LayerUtility: SaveImagePlus":["output_path","filename_prefix","timestamp","format","quality","save_metadata","custom_metadata","overwrite","preview"],"Image Comparer (rgthree)":[]}[e]||[]}_extractParameters(e){let t=[];for(const[n,i]of Object.entries(e)){if("meta"===n||"object"!=typeof i||null===i)continue;const e=i,{class_type:r,inputs:a}=this._normalizeNode(e);if("KSampler"===r&&("steps"in a&&t.push({name:"steps",display_name:"Sampling Steps",type:"integer",node_id:n,input_name:"steps",default:a.steps??20,constraints:{min:1,max:150,step:1},description:"Number of sampling steps"}),"cfg"in a&&t.push({name:"cfg",display_name:"CFG Scale",type:"float",node_id:n,input_name:"cfg",default:a.cfg??7,constraints:{min:0,max:30,step:.1},description:"Classifier-free guidance scale"}),"seed"in a&&t.push({name:"seed",display_name:"Seed",type:"seed",node_id:n,input_name:"seed",default:a.seed??-1,description:"Random seed for reproducibility"}),"denoise"in a&&t.push({name:"denoise",display_name:"Denoise Strength",type:"float",node_id:n,input_name:"denoise",default:a.denoise??1,constraints:{min:.1,max:1,step:.05},description:"Denoising strength (img2img)"})),"QwenImageIntegratedKSampler"===r){const i=e.widgets_values||[];t.push({name:"positive_prompt",display_name:"Prompt",type:"prompt",node_id:n,input_name:"positive_prompt",default:i[0]||a.positive_prompt||"",description:"Main prompt for image generation/editing"}),t.push({name:"negative_prompt",display_name:"Negative Prompt",type:"prompt",node_id:n,input_name:"negative_prompt",default:i[1]||a.negative_prompt||"",description:"What to avoid in generation"}),t.push({name:"generation_mode",display_name:"Mode",type:"enum",node_id:n,input_name:"generation_mode",default:i[2]||a.generation_mode||" image-to-image",constraints:{options:[" text-to-image"," image-to-image"," image-edit"]},description:"Generation mode"}),t.push({name:"seed",display_name:"Seed",type:"seed",node_id:n,input_name:"seed",default:i[6]||a.seed||-1,description:"Random seed"}),t.push({name:"steps",display_name:"Steps",type:"integer",node_id:n,input_name:"steps",default:i[8]||a.steps||4,constraints:{min:1,max:50,step:1},description:"Sampling steps"}),t.push({name:"denoise",display_name:"Denoise",type:"float",node_id:n,input_name:"denoise",default:i[9]||a.denoise||1,constraints:{min:0,max:1,step:.05},description:"Denoising strength"}),t.push({name:"cfg",display_name:"CFG Scale",type:"float",node_id:n,input_name:"cfg",default:i[13]||a.cfg||3,constraints:{min:1,max:20,step:.5},description:"Classifier-free guidance"})}"EmptyLatentImage"===r&&("width"in a&&t.push({name:"width",display_name:"Width",type:"integer",node_id:n,input_name:"width",default:a.width??512,constraints:{min:256,max:2048,step:64},description:"Output image width"}),"height"in a&&t.push({name:"height",display_name:"Height",type:"integer",node_id:n,input_name:"height",default:a.height??512,constraints:{min:256,max:2048,step:64},description:"Output image height"}))}return t=this._extractPromptParameters(e,t),t}_extractPromptParameters(e,t){var n;const i=[...t],r=[],a={CLIPTextEncode:"text",TextEncodeQwenImageEditPlus:"prompt",TextEncodeQwenImageEdit:"prompt",TextEncodeQwen:"prompt",CLIPTextEncodeSDXL:"text_g",PromptStyler:"text_positive",ShowText:"text",StringFunction:"text"};for(const[h,p]of Object.entries(e)){if("meta"===h||"object"!=typeof p||null===p)continue;const e=p,t=e.class_type||"",i=e.inputs||{};if(t in a){const o=a[t];if(o in i){const a=String(i[o]??""),s=(null==(n=e._meta)?void 0:n.title)||"";r.push({node_id:h,class_type:t,input_name:o,text:a,title:s,title_lower:s.toLowerCase()})}}}if(0===r.length)return i;const o=[],s=[],l=[],c=["positive","pos ","(pos)","prompt","main prompt","subject"],u=["negative","neg ","(neg)","bad","ugly","worst","low quality","avoid"],d=["ugly","blurry","bad anatomy","worst quality","low quality","normal quality","lowres","watermark","deformed","disfigured","mutation","extra limbs"];for(const h of r){const e=h.title_lower,t=h.text.toLowerCase().slice(0,200),n=c.some(t=>e.includes(t)),i=u.some(t=>e.includes(t));let r=i;n||i||(r=d.some(e=>t.includes(e))),r&&!n?s.push(h):n&&!r?o.push(h):l.push(h)}for(const h of l)if(0===o.length)o.push(h);else if(0===s.length)s.push(h);else{const e=`prompt_${h.node_id}`,t=h.title||`Prompt (Node ${h.node_id})`;i.push({name:e,display_name:t,type:"prompt",node_id:h.node_id,input_name:h.input_name,default:h.text,description:`Text prompt for ${h.class_type} node ${h.node_id}`})}for(let h=0;h<o.length;h++){const e=o[h],t=i.find(e=>"positive_prompt"===e.name);if(0!==h||t){const t=h>0?`positive_prompt_${h+1}`:`positive_prompt_${e.node_id}`,n=e.title||`Positive Prompt ${h+2}`;i.push({name:t,display_name:n,type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Additional positive prompt"})}else i.push({name:"positive_prompt",display_name:"Positive Prompt",type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Positive prompt (what to generate)"})}for(let h=0;h<s.length;h++){const e=s[h],t=i.find(e=>"negative_prompt"===e.name);if(0!==h||t){const t=h>0?`negative_prompt_${h+1}`:`negative_prompt_${e.node_id}`,n=e.title||`Negative Prompt ${h+2}`;i.push({name:t,display_name:n,type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Additional negative prompt"})}else i.push({name:"negative_prompt",display_name:"Negative Prompt",type:"prompt",node_id:e.node_id,input_name:e.input_name,default:e.text,description:"Negative prompt (things to avoid)"})}return i}_extractLoRAs(e){const t=[];let n=0;for(const[i,r]of Object.entries(e)){if("meta"===i||"object"!=typeof r||null===r)continue;const e=r,a=e.class_type||"";if(a.includes("LoraLoader")||"LoraLoaderModelOnly"===a){n++;const r=e.inputs||{},a=r.lora_name||"";let o;if(a){const e=a.split(/[\\/]/);o=e[e.length-1].replace(/\.[^/.]+$/,"")}else o=`LoRA ${n}`;t.push({name:`lora_${n}`,display_name:o,node_id:i,strength_inputs:{model:"strength_model",clip:"strength_clip"},default_enabled:!0,default_strength:r.strength_model??.75,required:!0,lora_name:a})}}return t}_extractImageInputs(e){const t=[];let n=0;for(const[i,r]of Object.entries(e)){if("meta"===i||"object"!=typeof r||null===r)continue;const e=r.class_type||"";"LoadImage"===e&&(n++,t.push({name:`reference_image_${n}`,display_name:`Reference Image ${n}`,node_id:i,input_name:"image",type:"image",required:!1,batch_min:1,batch_max:1,description:`Reference image for node ${i}`})),"LoadImageMask"===e&&(n++,t.push({name:`mask_image_${n}`,display_name:`Mask Image ${n}`,node_id:i,input_name:"image",type:"mask",required:!1,batch_min:1,batch_max:1,description:`Mask image for node ${i}`}));if("VHS_LoadVideo"===e||"VHS_LoadVideoPath"===e||"LoadVideo"===e||"LoadVideoUpload"===e||"VideoLoader"===e||e.includes("LoadVideo")){n++;const r="VHS_LoadVideoPath"===e?"video_path":"video";t.push({name:`video_input_${n}`,display_name:`Video Input ${n}`,node_id:i,input_name:r,type:"video",required:!1,batch_min:1,batch_max:1,description:`Video input for node ${i}`})}}return t}imageInputsToParameters(e){return e.map(e=>{let t="image";return"video"===e.type||e.name.includes("video")?t="video":"mask"===e.type&&(t="image"),{name:e.name,display_name:e.display_name,type:t,node_id:e.node_id,input_name:e.input_name,default:"",description:e.description,constraints:{min:e.batch_min,max:e.batch_max}}})}_extractOutputs(e){const t=[];let n=0;for(const[i,r]of Object.entries(e)){if("meta"===i||"object"!=typeof r||null===r)continue;const e=r.class_type||"";"SaveImage"!==e&&"PreviewImage"!==e||(n++,t.push({node_id:i,name:`Output ${n} (${e})`,type:"image",selected:1===n})),"SaveAnimatedWEBP"!==e&&"SaveAnimatedPNG"!==e||(n++,t.push({node_id:i,name:`Output ${n} (${e})`,type:"video",selected:1===n})),("VHS_VideoCombine"===e||"VHS_SaveVideo"===e||"ADE_AnimateDiffCombine"===e||e.includes("SaveVideo")||e.includes("VideoSave")||e.includes("VideoCombine")||e.includes("WanVideo")||e.includes("VideoOutput"))&&(t.some(e=>e.node_id===i)||(n++,t.push({node_id:i,name:`Output ${n} (Video: ${e})`,type:"video",selected:1===n})))}return t}_detectCategories(e){let t=!1,n=!1,i=!1,r=!1;for(const[o,s]of Object.entries(e)){if("meta"===o||"object"!=typeof s||null===s)continue;const e=s.class_type||"";"LoadImage"===e&&(t=!0),e.includes("EmptyLatent")&&(n=!0),"KSampler"===e&&(i=!0),["VAEEncodeForInpaint","InpaintModelConditioning","Inpaint"].includes(e)&&(r=!0)}const a=[];return t&&!n&&a.push("editing"),t&&n&&a.push("img2img"),n&&i&&a.push("generation"),r&&(a.includes("img2img")||a.push("img2img")),0===a.length&&a.push("generation"),a}_detectNextSceneSupport(e){for(const[t,n]of Object.entries(e)){if("meta"===t||"object"!=typeof n||null===n)continue;const e=n.class_type||"";if(e.includes("VAEEncode")||"LoadImage"===e)return!0}return!1}buildWorkflow(e,t,n,i,r){const a=this.normalizeWorkflowFormat(e),o=JSON.parse(JSON.stringify(a));this.normalizeWorkflowPaths(o);const s=this.parseWorkflow(e),l=[...s.parameters];if(r)for(const d of r){if(!d.exposed)continue;l.some(e=>e.node_id===d.node_id&&e.input_name===d.input_name)||l.push({name:d.name,display_name:d.name,description:"",type:"enum",node_id:d.node_id,input_name:d.input_name,default:null})}console.log("[buildWorkflow] Applying parameters:",t),console.log("[buildWorkflow] Available params:",l.map(e=>({name:e.name,node_id:e.node_id,input_name:e.input_name})));for(const[d,h]of Object.entries(t)){let e=l.find(e=>e.name===d);if(e||(e=l.find(e=>d===`${e.name}_${e.node_id}`)),e||(e=l.find(e=>d===`${e.input_name}_${e.node_id}`)),e){console.log(`[buildWorkflow] Matched param "${d}" to node ${e.node_id}.${e.input_name}`);const t=o[e.node_id];if(t){if(t.widgets_values&&Array.isArray(t.widgets_values)){const n=this._getWidgetIndex(t.class_type||"",e.input_name);n>=0&&(t.widgets_values[n]=h)}t.inputs||(t.inputs={});let n=h;"unet_name"!==e.input_name&&"ckpt_name"!==e.input_name&&"model_name"!==e.input_name&&"lora_name"!==e.input_name||"string"==typeof h&&h.includes("\\")&&(n=h.replace(/\\/g,"/"),console.log(`[buildWorkflow] Normalized path for ${e.input_name}: ${h} -> ${n}`)),t.inputs[e.input_name]=n}}else console.log(`[buildWorkflow] No match for param "${d}"`)}console.log("[buildWorkflow] === APPLYING IMAGE INPUTS ==="),console.log("[buildWorkflow] imageInputs received:",Object.entries(n).map(([e,t])=>`${e}=${t}`)),console.log("[buildWorkflow] parsed.image_inputs:",s.image_inputs.map(e=>({name:e.name,node_id:e.node_id,input_name:e.input_name})));for(const[d,h]of Object.entries(n)){const e=s.image_inputs.find(e=>e.name===d);if(e){const t=o[e.node_id];if(console.log(`[buildWorkflow] Processing image input "${d}" -> node ${e.node_id}.${e.input_name}, path=${h}, node exists=${!!t}`),t){if("__BYPASSED__"===h){console.log(`[buildWorkflow] !!! BYPASSING image input node ${e.node_id} (${d}, class_type=${t.class_type}) !!!`),t.mode=4;continue}t.inputs||(t.inputs={}),t.inputs[e.input_name]=h,t.widgets_values&&Array.isArray(t.widgets_values)&&(t.widgets_values[0]=h)}}}console.log(`[buildWorkflow] Processing ${s.loras.length} LoRAs, loraValues has ${Object.keys(i).length} entries`);for(const d of s.loras){const e=o[d.node_id];if(!e){console.warn(`[buildWorkflow] LoRA node ${d.node_id} not found in workflow`);continue}const t=i[d.name];if(t){!0===t.bypassed||!1===t.enabled?(console.log(`[buildWorkflow] Bypassing LoRA node ${d.node_id} (${d.name})`),e.mode=4):e.inputs&&(e.inputs[d.strength_inputs.model]=t.strength,e.inputs[d.strength_inputs.clip]=t.strength,t.lora_name&&(e.inputs.lora_name=t.lora_name),console.log(`[buildWorkflow] Applied LoRA ${d.name} (node ${d.node_id}): strength=${t.strength}`))}else console.log(`[buildWorkflow] Using defaults for LoRA ${d.name} (node ${d.node_id}) - not in UI params`),4===e.mode&&delete e.mode,e.inputs&&d.strength_inputs.model in e.inputs&&console.log(`[buildWorkflow] Keeping original strength: ${e.inputs[d.strength_inputs.model]}`)}const c={},u=new Set;console.log("[buildWorkflow] === BYPASS ANALYSIS START ==="),console.log("[buildWorkflow] All nodes in workflow:",Object.keys(o).filter(e=>"meta"!==e&&"version"!==e));for(const[d,h]of Object.entries(o)){if("meta"===d||"version"===d)continue;const e=h;4===e.mode&&(u.add(d),console.log(`[buildWorkflow] Node ${d} (${e.class_type}) is BYPASSED (mode=4)`))}if(console.log(`[buildWorkflow] Total bypassed nodes: ${u.size}`,Array.from(u)),u.size>0){console.log("[buildWorkflow] === CASCADE BYPASS TO DOWNSTREAM ===");const e=this.cascadeBypassToDownstream(o,u);for(const t of e)u.add(t);console.log(`[buildWorkflow] After cascade: ${u.size} bypassed nodes`,Array.from(u))}for(const[d,h]of Object.entries(o)){if("meta"===d||"version"===d)continue;const e=h;if(e.class_type){if(this._isUiOnlyNode(e.class_type)){console.log(`[buildWorkflow] Skipping UI-only node ${d} (${e.class_type})`);continue}if(4===e.mode){console.log(`[buildWorkflow] Skipping bypassed node ${d} (${e.class_type})`);continue}const t={...e.inputs||{}};if(e.widgets_values&&Array.isArray(e.widgets_values)){const n=this._getWidgetNames(e.class_type);e.widgets_values.forEach((e,i)=>{n[i]&&void 0!==e&&(n[i]in t||(t[n[i]]=e))})}c[d]={class_type:e.class_type,inputs:t},e._meta&&(c[d]._meta=e._meta)}}if(u.size>0){const e=new Map;for(const[s,l]of Object.entries(o))if(u.has(s)){const t=l;t.inputs&&e.set(s,{...t.inputs})}console.log("[buildWorkflow] Bypassed node inputs map:",Object.fromEntries(e));const t=(n,i)=>{if(console.log(`[findUpstreamSource] Checking node ${n} (output ${i}), bypassed=${u.has(n)}`),!u.has(n))return console.log(`[findUpstreamSource] Node ${n} is NOT bypassed, returning as source`),[n,i];const r=e.get(n);if(console.log(`[findUpstreamSource] Node ${n} is bypassed, inputs:`,r),!r)return null;const a=0===i?"model":"clip",o=r[a];if(console.log(`[findUpstreamSource] Looking for upstream via input "${a}":`,o),Array.isArray(o)&&o.length>=2){const e=String(o[0]),n=Number(o[1]);return console.log(`[findUpstreamSource] Following to upstream ${e}:${n}`),t(e,n)}return console.log(`[findUpstreamSource] No upstream found for node ${n}`),null};console.log("[buildWorkflow] === PROCESSING INPUT REFERENCES ==="),console.log("[buildWorkflow] API Workflow nodes:",Object.keys(c));const n=new Set,i=(e,t)=>{if(!e)return!1;return!("image"!==t||!["LoadImage","ImageScale","ImageScaleToTotalPixels","ImageResize","ImageResizeKJv2","ImageCrop","VAEEncode","DWPose","OpenposePreprocessor","CannyEdgePreprocessor","LineartPreprocessor","DepthAnything","InstantIDFaceAnalysis","ReActorFaceSwap","IPAdapter","ControlNetLoader"].some(t=>null==e?void 0:e.includes(t)))||!("pixels"!==t||!(null==e?void 0:e.includes("VAEEncode")))};for(const[o,s]of Object.entries(c)){const e=s;if(e.inputs){const r=[],a=[];for(const[s,l]of Object.entries(e.inputs))if(Array.isArray(l)&&l.length>=2){const c=String(l[0]),d=Number(l[1]);if(console.log(`[buildWorkflow] Node ${o} input "${s}" references [${c}, ${d}], bypassed=${u.has(c)}`),u.has(c)){console.log(`[buildWorkflow] Attempting to rewire through bypassed node ${c}`);const l=t(c,d);l?(console.log(`[buildWorkflow]  Rewiring input "${s}" from bypassed node ${c} to upstream ${l[0]}:${l[1]}`),r.push({name:s,value:l})):i(e.class_type,s)?(console.log(`[buildWorkflow]  Node ${o} (${e.class_type}) loses required input "${s}" - will remove entire node`),n.add(o)):(console.log(`[buildWorkflow]  Removing optional input "${s}" from node ${o}`),a.push(s))}}if(!n.has(o)){for(const t of r)e.inputs[t.name]=t.value;for(const t of a)delete e.inputs[t]}}}let r=0;const a=10;for(;n.size>0&&r<a;){r++,console.log(`[buildWorkflow] Removal iteration ${r}: removing ${Array.from(n)}`);for(const t of n)c[t]&&(delete c[t],console.log(`[buildWorkflow] Removed node ${t}`));const e=new Set;for(const[t,r]of Object.entries(c)){const a=r;if(a.inputs)for(const[r,o]of Object.entries(a.inputs))if(Array.isArray(o)&&o.length>=2){const s=String(o[0]);!n.has(s)&&c[s]||(console.log(`[buildWorkflow] Node ${t} loses input "${r}" (referenced ${s} was removed)`),delete a.inputs[r],i(a.class_type,r)&&(console.log(`[buildWorkflow] Node ${t} (${a.class_type}) lost required input "${r}" - will remove`),e.add(t)))}}n.clear();for(const t of e)n.add(t)}r>=a&&console.warn("[buildWorkflow] Warning: Hit max iterations for cascading removal"),console.log(`[buildWorkflow] Cascading removal completed after ${r} iterations`),console.log("[buildWorkflow] === BYPASS ANALYSIS END ===")}return c[76]&&console.log("[buildWorkflow] FINAL STATE: Node 76:",c[76].inputs),c[81]&&console.log("[buildWorkflow] FINAL STATE: Node 81:",c[81].inputs),c[120]&&console.log("[buildWorkflow] FINAL STATE: Node 120:",c[120].inputs),c[122]&&console.log("[buildWorkflow] FINAL STATE: Node 122:",c[122].inputs),c}_isUiOnlyNode(e){if(["Note","MarkdownNote","PrimitiveNode","Reroute","GroupNode","ttN pipeLoader","ShowText|pysssss","ShowAnything"].includes(e))return!0;return[/^Note$/i,/Note$/,/^Comment/i,/^Sticky/i].some(t=>t.test(e))}_getWidgetIndex(e,t){if("QwenImageIntegratedKSampler"===e){return{prompt:0,negative_prompt:1,mode:2,batch_size:3,image1_weight:4,image2_weight:5,seed:6,control_after_generate:7,steps:8,denoise:9,sampler_name:10,scheduler:11,scale_method:12,cfg:13}[t]??-1}return-1}normalizeWorkflowPaths(e){const t=["unet_name","ckpt_name","model_name","lora_name","clip_name","vae_name","control_net_name","style_model_name","positive","negative"];for(const[n,i]of Object.entries(e))if("meta"!==n&&"version"!==n&&"inputs"in i&&i.inputs)for(const[e,r]of Object.entries(i.inputs))if(t.includes(e)&&"string"==typeof r&&r.includes("\\")){const t=r.replace(/\\/g,"/");i.inputs[e]=t,console.log(`[normalizeWorkflowPaths] Node ${n} ${e}: ${r} -> ${t}`)}}findDownstreamNodes(e,t){const n=new Map,i=new Set,r=[t];for(;r.length>0;){const t=r.shift();if(!i.has(t)){i.add(t);for(const[i,a]of Object.entries(e)){if("meta"===i||"version"===i)continue;if(!("inputs"in a)||!a.inputs)continue;const e=a,o=[];for(const[n,i]of Object.entries(e.inputs||{}))if(Array.isArray(i)&&i.length>=2){String(i[0])===t&&o.push(n)}o.length>0&&(n.set(i,o),r.push(i))}}}return n}_isRequiredInputForNode(e,t){if(!e)return!1;const n=["KSampler","KSamplerAdvanced","SamplerCustom","SamplerEuler","QwenImageIntegratedKSampler","ImageOnlyKSampler"],i=["CLIPTextEncode","CLIPTextEncodeSDXL","CLIPTextEncodeThree","CLIPSetLastLayer","CLIPLoader","DualCLIPLoader"];if("image"===t||"pixels"===t||"background"===t){if(["LoadImage","ImageScale","ImageScaleToTotalPixels","ImageResize","ImageResizeKJv2","ImageCrop","VAEEncode","DWPose","OpenposePreprocessor","CannyEdgePreprocessor","LineartPreprocessor","DepthAnything","InstantIDFaceAnalysis","ReActorFaceSwap","IPAdapter","ControlNetLoader","ControlNetApply","ControlNetApplyAdvanced","ControlNetStack","DWPreprocessor","AIO_Preprocessor","MiDaS","BAE","LineaArt","ScribblePreprocessor","SemanticSegmentationPreprocessor","MediaPipe","FaceDetect","FaceRestore","FaceRestoreModel","GFPGAN","CodeFormer","IPAdapterApply","IPAdapterApplyLoader","IPAdapterIdentity","Inspire","FreeU","FreeUChen","ImagePass","ImageBatch","LoraLoader","LoraLoaderModelOnly","LoraLoaderStack","StyleModelLoader","CLIPVisionLoader","Sigmas","QwenImageControlNetIntegratedLoader","QwenImageEdit"].some(t=>e.includes(t)))return!0;if(("pixels"===t||"image"===t)&&e.includes("VAEEncode"))return!0}if("mask"===t){if(["VAEEncode","ImageBatchWithMask","ImageCropByMask","InpaintModelConditioning"].some(t=>e.includes(t)))return!0}return!("model"!==t||!n.some(t=>e.includes(t)))||(!("clip"!==t||!i.some(t=>e.includes(t)))||(!("control_net"!==t&&"controlnet"!==t||!e.includes("ControlNetApply")&&!e.includes("ControlNet"))||!("lora_name"!==t&&!t.startsWith("lora_name_")||!e.includes("LoraLoader"))))}cascadeBypassToDownstream(e,t){const n=new Set(t);let i=!0,r=0;for(console.log("[cascadeBypass] Starting with bypassed nodes:",Array.from(t));i&&r<20;){i=!1,r++;for(const t of n){const r=this.findDownstreamNodes(e,t);for(const[a,o]of r){if(n.has(a))continue;const r=e[a];if(!r||!r.inputs)continue;if(o.some(e=>this._isRequiredInputForNode(r.class_type,e))){(Object.entries(r.inputs||{}).every(([e,t])=>{if(Array.isArray(t)&&t.length>=2){const e=String(t[0]);return n.has(e)}return!0})||4===r.mode)&&(r.mode=4,n.add(a),i=!0,console.log(`[cascadeBypass] Cascaded bypass to node ${a} (${r.class_type}) - depends on ${t} via inputs: ${o.join(", ")}`))}}}}return r>=20&&console.warn("[cascadeBypass] Warning: Hit max iterations"),console.log("[cascadeBypass] Final bypassed nodes:",Array.from(n)),n}}let NE=null;function RE(){return NE||(NE=new AE),NE}function LE({message:e,type:t="error",onClose:n,duration:i=5e3}){const[r,a]=Pt.useState(!0),[o,s]=Pt.useState(100);Pt.useEffect(()=>{if(i>0){const e=Date.now(),t=setInterval(()=>{const r=Date.now()-e,o=Math.max(0,100-r/i*100);s(o),r>=i&&(clearInterval(t),a(!1),null==n||n())},50);return()=>clearInterval(t)}},[i]);return r?Ut.jsxs("div",{className:`error-notification ${t}`,children:[Ut.jsxs("div",{className:"error-content",children:[Ut.jsxs("span",{className:"error-icon",children:["error"===t&&"","warning"===t&&"","info"===t&&""]}),Ut.jsx("span",{className:"error-message",children:e}),Ut.jsx("button",{className:"error-close",onClick:()=>{a(!1),null==n||n()},children:""})]}),Ut.jsx("div",{className:"error-progress",children:Ut.jsx("div",{className:"error-progress-bar",style:{width:`${o}%`}})})]}):null}let IE=0;const jE=new Map;function DE(e,t){const n=`${e}:${t}`,i=Date.now(),r=jE.get(n);for(const[a,o]of jE.entries())i-o>1e4&&jE.delete(a);return!(r&&i-r<1e3)&&(jE.set(n,i),!0)}function UE({notifications:e,onRemove:t}){return Ut.jsx("div",{className:"error-notification-container",children:e.map(e=>Ut.jsx(LE,{message:e.message,type:e.type,onClose:()=>t(e.id)},e.id))})}class OE{constructor(e,t="storyboard-ui"){je(this,"ws",null),je(this,"url"),je(this,"baseUrl"),je(this,"clientId"),je(this,"pendingPrompts",new Map),je(this,"reconnectTimeout",null),je(this,"statusCallback",null),je(this,"kayToolMetricsCallback",null),je(this,"isConnected",!1),je(this,"kayToolMonitorStarted",!1),je(this,"reconnectAttempts",0),je(this,"maxReconnectAttempts",20),je(this,"minReconnectDelay",1e3),je(this,"maxReconnectDelay",3e4),je(this,"isIntentionallyClosed",!1),this.baseUrl=e,this.url=e.replace(/^http/,"ws")+"/ws?clientId="+t,this.clientId=t}connect(){return new Promise((e,t)=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN)e();else{this.cancelReconnect(),this.isIntentionallyClosed=!1;try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("[ComfyUI WS] Connected"),this.isConnected=!0,this.reconnectAttempts=0,e()},this.ws.onclose=e=>{console.log(`[ComfyUI WS] Disconnected (code: ${e.code}, reason: ${e.reason||"none"})`),this.isConnected=!1,this.isIntentionallyClosed||this.scheduleReconnect()},this.ws.onerror=e=>{console.error("[ComfyUI WS] Error:",e),this.isConnected=!1,t(e)},this.ws.onmessage=e=>{if(!(e.data instanceof Blob))try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("[ComfyUI WS] Failed to parse message:",t)}}}catch(n){t(n)}}})}disconnect(){this.isIntentionallyClosed=!0,this.cancelReconnect(),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1,this.reconnectAttempts=0}cancelReconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}calculateReconnectDelay(){const e=Math.min(this.maxReconnectDelay,this.minReconnectDelay*Math.pow(2,this.reconnectAttempts)),t=.25*Math.random()*e;return Math.floor(e+t)}scheduleReconnect(){if(this.reconnectTimeout)return;if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.warn(`[ComfyUI WS] Max reconnect attempts (${this.maxReconnectAttempts}) reached. Giving up.`);const e=this.calculateReconnectDelay();this.reconnectAttempts++,console.log(`[ComfyUI WS] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimeout=window.setTimeout(()=>{this.reconnectTimeout=null,this.connect().catch(e=>{console.error("[ComfyUI WS] Reconnection failed:",e)})},e)}resetReconnectAttempts(){this.reconnectAttempts=0,this.isIntentionallyClosed=!1}handleMessage(e){const{type:t,data:n}=e;switch(this.statusCallback&&!this.isMonitoringEvent(t)&&this.statusCallback({type:t,data:n}),t){case"progress":this.handleProgress(n);break;case"executing":this.handleExecuting(n);break;case"executed":this.handleExecuted(n);break;case"execution_error":this.handleError(n);break;case"execution_start":case"execution_cached":case"status":case"crystools.monitor":case"kikostats.monitor":break;case"kaytool.resources":this.kayToolMetricsCallback&&n&&this.kayToolMetricsCallback(n);break;default:this.isMonitoringEvent(t)||console.log("[ComfyUI WS] Unknown message type:",t)}}isMonitoringEvent(e){return e.includes(".monitor")||e.includes("crystools")||e.includes("kikostats")||"kaytool.resources"===e}handleProgress(e){const{value:t,max:n,prompt_id:i,node:r}=e;console.log("[ComfyUI WS] Progress:",i,t,"/",n,"node:",r);const a=this.pendingPrompts.get(i);if(!a)return void console.warn("[ComfyUI WS] No pending prompt found for:",i);const o=a.executionState,s=a.workflowInfo;let l;r&&r!==o.currentSamplerNodeId?(o.currentSamplerNodeId&&(o.completedSteps+=o.currentPhaseMax,o.completedSamplerPhases.includes(o.currentSamplerNodeId)||o.completedSamplerPhases.push(o.currentSamplerNodeId)),o.currentSamplerNodeId=r,o.currentPhaseMax=n):r&&n>o.currentPhaseMax&&(o.currentPhaseMax=n);let c=1,u=1;if(s&&s.samplerNodeIds.length>1){u=s.samplerNodeIds.length,c=o.completedSamplerPhases.length+1;const e=n*u,i=o.completedSteps+t;l=Math.round(i/e*100)}else l=Math.round(t/n*100);const d=(null==s?void 0:s.nodeTypes[r])||void 0;a.onProgress({value:t,max:n,promptId:i,nodeId:r,overallPercent:l,currentPhase:c,totalPhases:u,currentNodeName:d,nodesExecuted:o.executedNodes.length,totalNodes:null==s?void 0:s.totalNodes})}handleExecuting(e){const{prompt_id:t,node:n}=e;if(console.log("[ComfyUI WS] Executing:",t,"node:",n),null===n){console.log("[ComfyUI WS] Execution complete for:",t);const e=this.pendingPrompts.get(t);e?(console.log("[ComfyUI WS] Calling onCompleted callback"),e.onCompleted(t,null),this.pendingPrompts.delete(t)):console.warn("[ComfyUI WS] No pending prompt found for completion:",t)}else{const e=this.pendingPrompts.get(t);if(e){e.executionState.executedNodes.includes(n)||e.executionState.executedNodes.push(n);const i=e.workflowInfo,r=(null==i?void 0:i.nodeTypes[n])||void 0;i&&e.onProgress({value:0,max:1,promptId:t,nodeId:n,overallPercent:e.executionState.completedSamplerPhases.length>0?Math.round(e.executionState.completedSamplerPhases.length/i.samplerNodeIds.length*100):void 0,currentPhase:e.executionState.completedSamplerPhases.length+1,totalPhases:i.samplerNodeIds.length,currentNodeName:r,nodesExecuted:e.executionState.executedNodes.length,totalNodes:i.totalNodes})}console.log("[ComfyUI WS] Executing node:",n,"for prompt:",t)}}handleExecuted(e){const{prompt_id:t,output:n,node:i}=e;console.log("[ComfyUI WS] Executed node:",i,"for prompt:",t,"output:",n)}handleError(e){const{prompt_id:t,exception_message:n,exception_type:i}=e,r=this.pendingPrompts.get(t);r&&(r.onError(t,`${i}: ${n}`),this.pendingPrompts.delete(t))}trackPrompt(e,t,n,i,r,a){console.log("[ComfyUI WS] Tracking prompt:",e,"for panel:",t,"clientId:",this.clientId),a&&console.log("[ComfyUI WS] Workflow info:",a.totalNodes,"nodes,",a.samplerNodeIds.length,"sampler phases:",a.samplerNodeIds),this.pendingPrompts.set(e,{promptId:e,panelId:t,onProgress:n,onCompleted:i,onError:r,workflowInfo:a,executionState:{executedNodes:[],completedSamplerPhases:[],currentSamplerNodeId:null,completedSteps:0,totalStepsEstimate:0,currentPhaseMax:0}}),console.log("[ComfyUI WS] Pending prompts after add:",Array.from(this.pendingPrompts.keys()))}untrackPrompt(e){this.pendingPrompts.delete(e)}async cancelGeneration(){try{const e=await fetch(`${this.baseUrl}/interrupt`,{method:"POST"});return e.ok?(console.log("[ComfyUI WS] Generation interrupted"),!0):(console.error("[ComfyUI WS] Failed to interrupt:",e.statusText),!1)}catch(e){return console.error("[ComfyUI WS] Error interrupting generation:",e),!1}}onStatus(e){this.statusCallback=e}onKayToolMetrics(e){this.kayToolMetricsCallback=e,e&&!this.kayToolMonitorStarted&&this.startKayToolMonitor()}async startKayToolMonitor(){if(!this.kayToolMonitorStarted)try{const e=await fetch(`${this.baseUrl}/kaytool/start_monitor`,{method:"POST",headers:{"Content-Type":"application/json"}});e.ok?(this.kayToolMonitorStarted=!0,console.log("[KayTool] Monitor started")):console.warn("[KayTool] Failed to start monitor:",e.status)}catch(e){console.warn("[KayTool] Monitor not available:",e)}}async stopKayToolMonitor(){if(this.kayToolMonitorStarted)try{await fetch(`${this.baseUrl}/kaytool/stop_monitor`,{method:"POST",headers:{"Content-Type":"application/json"}}),this.kayToolMonitorStarted=!1,console.log("[KayTool] Monitor stopped")}catch(e){}}get connected(){var e;return this.isConnected&&(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN}getClientId(){return this.clientId}}const FE=new Map;function zE(e,t){const n=`${e}:${t||"storyboard-ui"}`;return FE.has(n)||FE.set(n,new OE(e,t)),FE.get(n)}function BE(e,t){const n=`${e}:${t||"storyboard-ui"}`,i=FE.get(n);i&&(i.disconnect(),FE.delete(n))}function HE(){FE.forEach(e=>e.disconnect()),FE.clear()}const VE=new class{constructor(){je(this,"nodes",new Map),je(this,"listeners",new Set),je(this,"pollingInterval",null),je(this,"nodeWebSockets",new Map),je(this,"removedNodeIds",new Set)}async fetchBackendsFromAPI(e){try{const t=await fetch(`${e}/api/backends`);if(!t.ok)return void console.error("[Orchestrator] Failed to fetch backends:",t.status);const n=await t.json();for(const e of n.backends||[]){if(this.removedNodeIds.has(e.id)){console.log(`[Orchestrator] Skipping removed node: ${e.id}`);continue}const t=e.online?"busy"===e.status?"busy":"online":"offline",n={id:e.id,name:e.name,url:`http://${e.host}:${e.port}`,status:t,gpuName:e.gpu_name||"Unknown",vramTotal:e.gpu_memory_total||0,vramUsed:e.gpu_memory_used||0,gpuUsage:e.gpu_utilization||0,gpuTemp:e.gpu_temperature||0,cpuUsage:e.cpu_utilization||0,ramUsed:e.ram_used||0,ramTotal:e.ram_total||0,lastSeen:e.last_seen?new Date(e.last_seen):new Date,priority:this.nodes.size};this.nodes.set(n.id,n),e.online&&this.connectNodeWebSocket(n)}this.notifyListeners(),this.saveToStorage(),console.log(`[Orchestrator] Loaded ${this.nodes.size} backends from API`)}catch(t){console.error("[Orchestrator] Error fetching backends:",t)}}addNode(e,t,n){const i=n||`node_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this.removedNodeIds.has(i)&&(this.removedNodeIds.delete(i),console.log(`[Orchestrator] Re-adding previously removed node: ${i}`));const r={id:i,name:t,url:e,status:"offline",gpuName:"Unknown",vramTotal:0,vramUsed:0,gpuUsage:0,gpuTemp:0,cpuUsage:0,ramUsed:0,ramTotal:0,lastSeen:new Date,priority:this.nodes.size};return this.nodes.set(i,r),this.notifyListeners(),this.pollNode(r),r}removeNode(e){const t=this.nodes.delete(e);return t&&(this.removedNodeIds.add(e),this.saveToStorage(),this.notifyListeners()),t}getNodes(){return Array.from(this.nodes.values())}getAvailableNodes(){return this.getNodes().filter(e=>"online"===e.status||"busy"===e.status).sort((e,t)=>e.priority-t.priority)}getBestNode(){const e=this.getAvailableNodes();return 0===e.length?null:e.filter(e=>"online"===e.status).sort((e,t)=>t.vramTotal-t.vramUsed-(e.vramTotal-e.vramUsed))[0]||e[0]}setNodePriority(e,t){const n=this.nodes.get(e);n&&(n.priority=t,this.notifyListeners())}parseGpuName(e){if(!e)return"Unknown GPU";let t=e.replace(/^cuda:\d+\s+/,"");return t=t.replace(/:\w+Alloc\w*$/,""),t.trim()||"Unknown GPU"}async pollNode(e){var t;try{const n=await fetch(`${e.url}/system_stats`,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(5e3)});if(n.ok){const i=null==(t=(await n.json()).devices)?void 0:t[0];i&&(e.gpuName=this.parseGpuName(i.name||"Unknown GPU"),e.vramTotal=Math.round((i.vram_total||0)/1024/1024),e.vramUsed=Math.round(i.vram_total-i.vram_free||0)/1024/1024,void 0!==i.vram_free&&(e.vramUsed=Math.round((i.vram_total-i.vram_free)/1024/1024))),e.status="online",e.lastSeen=new Date,this.connectNodeWebSocket(e)}else e.status="error"}catch(n){e.status="offline",this.disconnectNodeWebSocket(e.id)}this.nodes.set(e.id,e),this.notifyListeners()}async connectNodeWebSocket(e){if(!this.nodeWebSockets.has(e.id))try{const t=zE(e.url,`orchestrator-${e.id}`);await t.connect(),t.onKayToolMetrics(t=>{this.updateNodeFromKayTool(e.id,t)}),this.nodeWebSockets.set(e.id,t),console.log(`[Orchestrator] WebSocket connected to ${e.name} for KayTool metrics`)}catch(t){console.warn(`[Orchestrator] Failed to connect WebSocket to ${e.name}:`,t)}}disconnectNodeWebSocket(e){const t=this.nodeWebSockets.get(e);t&&(t.stopKayToolMonitor(),t.disconnect(),this.nodeWebSockets.delete(e))}updateNodeFromKayTool(e,t){const n=this.nodes.get(e);if(n){if(n.cpuUsage=t.cpu_percent||0,n.ramTotal=t.ram_total||0,n.ramUsed=t.ram_used||0,t.gpu&&t.gpu.length>0){const e=t.gpu[0];n.gpuName=e.name||n.gpuName,n.gpuUsage=e.load||0,n.gpuTemp=e.temperature||0,n.vramUsed=1024*(e.memory_used||0),n.vramTotal=1024*(e.memory_total||0)}n.lastSeen=new Date,this.nodes.set(e,n),this.notifyListeners()}}startPolling(e=5e3){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=window.setInterval(()=>{this.nodes.forEach(e=>{this.pollNode(e)})},e)}stopPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}subscribe(e){return this.listeners.add(e),e(this.getNodes()),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getNodes();this.listeners.forEach(t=>t(e))}saveToStorage(){const e=Array.from(this.nodes.values()).map(e=>({id:e.id,name:e.name,url:e.url,priority:e.priority}));localStorage.setItem("orchestrator_nodes",JSON.stringify(e)),localStorage.setItem("orchestrator_removed_nodes",JSON.stringify(Array.from(this.removedNodeIds)))}loadFromStorage(){const e=localStorage.getItem("orchestrator_removed_nodes");if(e)try{const t=JSON.parse(e);this.removedNodeIds=new Set(t),console.log(`[Orchestrator] Loaded ${this.removedNodeIds.size} removed node IDs from storage`)}catch(n){console.error("Failed to load removed node IDs from storage:",n)}const t=localStorage.getItem("orchestrator_nodes");if(t)try{JSON.parse(t).forEach(e=>{if(this.removedNodeIds.has(e.id))return void console.log(`[Orchestrator] Skipping removed node during load: ${e.id}`);const t=this.nodes.get(e.id);if(t)return void(void 0!==e.priority&&(t.priority=e.priority));const n={id:e.id,name:e.name,url:e.url,status:"offline",gpuName:"Unknown",vramTotal:0,vramUsed:0,gpuUsage:0,gpuTemp:0,cpuUsage:0,ramUsed:0,ramTotal:0,lastSeen:new Date,priority:e.priority??this.nodes.size};this.nodes.set(e.id,n),this.pollNode(n)}),this.notifyListeners()}catch(n){console.error("Failed to load nodes from storage:",n)}}clearAllNodes(){this.nodes.clear(),this.notifyListeners(),localStorage.removeItem("orchestrator_nodes")}async restartBackend(e,t={}){const n=this.nodes.get(e);if(!n)return{success:!1,message:`Backend ${e} not found`};try{if(console.log(`[Orchestrator] Restarting ComfyUI backend ${e} at ${n.url}`),!1!==t.interrupt_jobs)try{const t=await fetch(`${n.url}/interrupt`,{method:"POST"});t.ok?console.log(`[Orchestrator] Interrupted jobs on ${e}`):console.warn(`[Orchestrator] Interrupt failed for ${e}: ${t.status}`)}catch(i){console.warn(`[Orchestrator] Failed to interrupt ${e}:`,i)}if(!1!==t.free_memory)try{const t=await fetch(`${n.url}/free`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({unload_models:!0,free_memory:!0})});t.ok?console.log(`[Orchestrator] Freed memory on ${e}`):console.warn(`[Orchestrator] Free memory failed for ${e}: ${t.status}`)}catch(i){console.warn(`[Orchestrator] Failed to free memory on ${e}:`,i)}try{const t=await fetch(`${n.url}/system_stats`,{method:"GET"});return t.ok?(console.log(`[Orchestrator] Backend ${e} health check passed`),{success:!0,message:"ComfyUI backend restarted successfully. Jobs interrupted, memory freed."}):{success:!1,message:`Health check failed with status ${t.status}`}}catch(i){return{success:!1,message:`Health check failed: ${i instanceof Error?i.message:"Unknown error"}`}}}catch(r){return console.error(`[Orchestrator] Error restarting backend ${e}:`,r),{success:!1,message:r instanceof Error?r.message:"Unknown error occurred"}}}async restartAllBackends(){const e=this.getNodes(),t=[];for(const n of e)if("online"===n.status||"busy"===n.status){const e=await this.restartBackend(n.id);t.push({backendId:n.id,success:e.success,message:e.message})}return t}async cancelAllGenerations(){const e=this.getNodes(),t=[];for(const i of e)if("busy"===i.status)try{console.log(`[Orchestrator] Cancelling generation on ${i.id} at ${i.url}`);const e=await fetch(`${i.url}/interrupt`,{method:"POST"});e.ok?t.push({backendId:i.id,success:!0,message:"Generation cancelled"}):t.push({backendId:i.id,success:!1,message:`Failed to cancel: HTTP ${e.status}`})}catch(n){t.push({backendId:i.id,success:!1,message:n instanceof Error?n.message:"Unknown error"})}return t}};function WE(){const[e,t]=Pt.useState([]);return Pt.useEffect(()=>VE.subscribe(t),[]),e}
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GE=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),$E=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)};
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var XE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qE=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1},KE=Pt.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:a,iconNode:o,...s},l)=>Pt.createElement("svg",{ref:l,...XE,width:t,height:t,stroke:e,strokeWidth:i?24*Number(n)/Number(t):n,className:GE("lucide",r),...!a&&!qE(s)&&{"aria-hidden":"true"},...s},[...o.map(([e,t])=>Pt.createElement(e,t)),...Array.isArray(a)?a:[a]])),YE=(e,t)=>{const n=Pt.forwardRef(({className:n,...i},r)=>{return Pt.createElement(KE,{ref:r,iconNode:t,className:GE(`lucide-${a=$E(e),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...i});var a});return n.displayName=$E(e),n},ZE=YE("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),JE=YE("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),QE=YE("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),eC=YE("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),tC=YE("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),nC=YE("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),iC=YE("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),rC=YE("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),aC=YE("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),oC=YE("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]),sC=YE("crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),lC=YE("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),cC=YE("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),uC=YE("file-plus",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]),dC=YE("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),hC=YE("folder-input",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]),pC=YE("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),mC=YE("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),fC=YE("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),gC=YE("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),vC=YE("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),yC=YE("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),_C=YE("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),xC=YE("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),bC=YE("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),SC=YE("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),wC=YE("maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),MC=YE("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),EC=YE("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),CC=YE("octagon-x",[["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z",key:"2d38gg"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),TC=YE("panel-right-close",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),PC=YE("panel-right",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),kC=YE("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),AC=YE("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),NC=YE("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),RC=YE("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),LC=YE("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),IC=YE("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),jC=YE("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),DC=YE("save-all",[["path",{d:"M10 2v3a1 1 0 0 0 1 1h5",key:"1xspal"}],["path",{d:"M18 18v-6a1 1 0 0 0-1-1h-6a1 1 0 0 0-1 1v6",key:"1ra60u"}],["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"M8 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9.172a2 2 0 0 1 1.414.586l2.828 2.828A2 2 0 0 1 22 6.828V16a2 2 0 0 1-2.01 2z",key:"1yve0x"}]]),UC=YE("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),OC=YE("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),FC=YE("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),zC=YE("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),BC=YE("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),HC=YE("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),VC=YE("tags",[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]]),WC=YE("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),GC=YE("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),$C=YE("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),XC=YE("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),qC=YE("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),KC=YE("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);
/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function YC({onClose:e,onRestartNodes:t}){const n=WE(),[i,r]=Pt.useState(""),[a,o]=Pt.useState(""),[s,l]=Pt.useState(!1),[c,u]=Pt.useState(new Set),[d,h]=Pt.useState(!1),p=e=>e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`,m=e=>{switch(e){case"online":return"#4dff6d";case"busy":return"#ffcc00";case"error":return"#ff4444";default:return"#666"}};return Ut.jsx("div",{className:"node-manager-overlay",children:Ut.jsxs("div",{className:"node-manager-modal",children:[Ut.jsxs("div",{className:"node-manager-header",children:[Ut.jsx("h2",{children:"Render Nodes"}),Ut.jsxs("div",{className:"header-actions",children:[c.size>0&&Ut.jsxs("button",{className:"restart-selected-btn",onClick:async()=>{if(0!==c.size){h(!0);try{if(t)await t(Array.from(c));else for(const e of c)await VE.restartBackend(e);u(new Set)}catch(e){console.error("Failed to restart nodes:",e)}finally{h(!1)}}else alert("Please select at least one node to restart")},disabled:d,title:`Restart ${c.size} selected node(s)`,children:[Ut.jsx(IC,{size:16,className:d?"spinning":""}),Ut.jsx("span",{children:d?"Restarting...":`Restart ${c.size}`})]}),Ut.jsx("button",{className:"close-btn",onClick:e,children:""})]})]}),Ut.jsxs("div",{className:"node-manager-content",children:[Ut.jsxs("div",{className:"add-node-form",children:[Ut.jsx("input",{type:"text",placeholder:"Node Name (e.g., 5090-Node-1)",value:a,onChange:e=>o(e.target.value)}),Ut.jsx("input",{type:"text",placeholder:"ComfyUI URL (e.g., http://192.168.1.100:8188)",value:i,onChange:e=>r(e.target.value)}),Ut.jsx("button",{onClick:()=>{i&&a&&(VE.addNode(i,a),VE.saveToStorage(),r(""),o(""))},disabled:!i||!a,children:"Add Node"})]}),Ut.jsx("div",{className:"polling-control",children:Ut.jsx("button",{className:"polling-btn "+(s?"active":""),onClick:()=>{s?VE.stopPolling():(VE.startPolling(5e3),n.forEach(e=>VE.pollNode(e))),l(!s)},children:s?" Stop Monitoring":" Start Monitoring"})}),Ut.jsxs("div",{className:"node-list",children:[n.length>0&&Ut.jsx("div",{className:"select-all-row",children:Ut.jsxs("label",{className:"checkbox-label",children:[Ut.jsx("input",{type:"checkbox",checked:c.size===n.length&&n.length>0,onChange:()=>{c.size===n.length?u(new Set):u(new Set(n.map(e=>e.id)))}}),Ut.jsxs("span",{children:["Select All (",c.size,"/",n.length,")"]})]})}),0===n.length?Ut.jsx("p",{className:"no-nodes",children:"No render nodes configured. Add nodes to distribute rendering."}):n.map(e=>Ut.jsxs("div",{className:"node-card "+(c.has(e.id)?"selected":""),children:[Ut.jsxs("div",{className:"node-header",children:[Ut.jsxs("div",{className:"node-info",children:[Ut.jsx("label",{className:"checkbox-label node-checkbox",children:Ut.jsx("input",{type:"checkbox",checked:c.has(e.id),onChange:()=>(e=>{const t=new Set(c);t.has(e)?t.delete(e):t.add(e),u(t)})(e.id)})}),Ut.jsx("span",{className:"node-name",children:e.name}),Ut.jsxs("span",{className:"node-status",style:{color:m(e.status)},children:[" ",e.status.toUpperCase()]})]}),Ut.jsx("button",{className:"remove-btn",onClick:()=>{return t=e.id,VE.removeNode(t),void VE.saveToStorage();var t},children:"Remove"})]}),Ut.jsx("div",{className:"node-url",children:e.url}),"offline"!==e.status&&"Unknown"!==e.gpuName&&Ut.jsxs("div",{className:"node-stats",children:[Ut.jsxs("div",{className:"stat-row",children:[Ut.jsx("span",{className:"stat-label",children:"GPU:"}),Ut.jsx("span",{className:"stat-value",children:e.gpuName})]}),Ut.jsxs("div",{className:"stat-row",children:[Ut.jsx("span",{className:"stat-label",children:"VRAM:"}),Ut.jsxs("span",{className:"stat-value",children:[p(e.vramUsed)," / ",p(e.vramTotal)," ",Ut.jsxs("span",{className:"vram-percent",children:["(",e.vramTotal>0?Math.round(e.vramUsed/e.vramTotal*100):0,"%)"]})]})]}),Ut.jsxs("div",{className:"stat-row",children:[Ut.jsx("span",{className:"stat-label",children:"GPU Usage:"}),Ut.jsxs("span",{className:"stat-value",children:[e.gpuUsage,"%"]})]}),Ut.jsx("div",{className:"vram-bar",children:Ut.jsx("div",{className:"vram-fill",style:{width:(e.vramTotal>0?e.vramUsed/e.vramTotal*100:0)+"%"}})})]})]},e.id))]})]})]})})}function ZC({onProjectSettings:e,onSaveProject:t,onSaveProjectAs:n,onLoadProject:i,onManageNodes:r,onNewProject:a,onRestartNodes:o,onCancelGenerations:s,onPrintStoryboard:l,nodeCount:c,projectName:u,isSaving:d,isLoading:h,isRestarting:p,isGenerating:m}){const[f,g]=Pt.useState(!1),v=Pt.useRef(null);Pt.useEffect(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),Pt.useEffect(()=>{const e=e=>{"Escape"===e.key&&g(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);const y=navigator.platform.toUpperCase().indexOf("MAC")>=0?"":"Ctrl";return Ut.jsxs("div",{className:"main-menu",ref:v,children:[Ut.jsxs("button",{className:"main-menu-trigger "+(f?"active":""),onClick:()=>g(!f),children:[Ut.jsx(MC,{size:18}),Ut.jsx("span",{className:"project-name",children:u||"Untitled Project"}),Ut.jsx(JE,{size:14,className:"chevron "+(f?"rotated":"")})]}),f&&Ut.jsxs("div",{className:"main-menu-dropdown",children:[Ut.jsxs("div",{className:"menu-section",children:[Ut.jsx("div",{className:"menu-section-title",children:"Project"}),Ut.jsxs("button",{className:"menu-item",onClick:()=>{a(),g(!1)},children:[Ut.jsx(uC,{size:16}),Ut.jsx("span",{children:"New Project"}),Ut.jsxs("span",{className:"menu-shortcut",children:[y,"+N"]})]}),Ut.jsxs("button",{className:"menu-item",onClick:()=>{i(),g(!1)},disabled:h,children:[Ut.jsx(hC,{size:16}),Ut.jsx("span",{children:h?"Loading...":"Load Project"}),Ut.jsxs("span",{className:"menu-shortcut",children:[y,"+O"]})]}),Ut.jsxs("button",{className:"menu-item",onClick:()=>{t(),g(!1)},disabled:d,children:[Ut.jsx(UC,{size:16}),Ut.jsx("span",{children:d?"Saving...":"Save Project"}),Ut.jsxs("span",{className:"menu-shortcut",children:[y,"+S"]})]}),n&&Ut.jsxs("button",{className:"menu-item",onClick:()=>{n(),g(!1)},disabled:d,children:[Ut.jsx(DC,{size:16}),Ut.jsx("span",{children:"Save As..."}),Ut.jsxs("span",{className:"menu-shortcut",children:[y,"++S"]})]}),Ut.jsxs("button",{className:"menu-item",onClick:()=>{e(),g(!1)},children:[Ut.jsx(FC,{size:16}),Ut.jsx("span",{children:"Project Settings"}),Ut.jsxs("span",{className:"menu-shortcut",children:[y,"+,"]})]}),l&&Ut.jsxs("button",{className:"menu-item",onClick:()=>{l(),g(!1)},children:[Ut.jsx(LC,{size:16}),Ut.jsx("span",{children:"Print Storyboard"}),Ut.jsxs("span",{className:"menu-shortcut",children:[y,"+P"]})]})]}),Ut.jsx("div",{className:"menu-divider"}),Ut.jsxs("div",{className:"menu-section",children:[Ut.jsx("div",{className:"menu-section-title",children:"System"}),Ut.jsxs("button",{className:"menu-item",onClick:()=>{r(),g(!1)},children:[Ut.jsx(OC,{size:16}),Ut.jsx("span",{children:"Manage Nodes"}),Ut.jsx("span",{className:"menu-badge",children:c})]}),o&&Ut.jsxs("button",{className:"menu-item",onClick:()=>{o(),g(!1)},disabled:p||0===c,title:0===c?"No nodes available to restart":"Restart all ComfyUI backends",children:[Ut.jsx(IC,{size:16,className:p?"spinning":""}),Ut.jsx("span",{children:p?"Restarting...":"Restart Nodes"})]}),s&&Ut.jsxs("button",{className:"menu-item cancel-btn",onClick:()=>{s(),g(!1)},disabled:!m,title:m?"Cancel all running generations":"No generations running",children:[Ut.jsx(CC,{size:16}),Ut.jsx("span",{children:"Cancel All Generations"})]})]})]})]})}function JC({options:e,onChange:t,placeholder:n="Select options...",title:i}){const[r,a]=Pt.useState(!1),o=Pt.useRef(null),s=e.filter(e=>e.selected).length,l=s===e.length,c=0===s;Pt.useEffect(()=>{const e=e=>{o.current&&!o.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return Ut.jsxs("div",{className:"multiselect-dropdown",ref:o,children:[i&&Ut.jsx("div",{className:"multiselect-title",children:i}),Ut.jsxs("button",{className:"multiselect-trigger "+(r?"open":""),onClick:()=>a(!r),type:"button",children:[Ut.jsx("span",{className:"multiselect-label",children:(()=>{if(c)return n;if(l)return`All (${e.length})`;if(1===s){const t=e.find(e=>e.selected);return(null==t?void 0:t.label)||"1 selected"}return`${s} selected`})()}),Ut.jsx(JE,{size:14,className:"chevron "+(r?"rotated":"")})]}),r&&Ut.jsxs("div",{className:"multiselect-menu",children:[Ut.jsxs("div",{className:"multiselect-actions",children:[Ut.jsx("button",{className:"action-btn",onClick:()=>{t(e.map(e=>e.id))},disabled:l,children:"Select All"}),Ut.jsx("button",{className:"action-btn",onClick:()=>{t([])},disabled:c,children:"Clear"})]}),Ut.jsx("div",{className:"multiselect-divider"}),Ut.jsx("div",{className:"multiselect-options",children:e.map(n=>Ut.jsxs("button",{className:"multiselect-option "+(n.selected?"selected":""),onClick:()=>(n=>{const i=e.map(e=>e.id===n?{...e,selected:!e.selected}:e).filter(e=>e.selected).map(e=>e.id);t(i)})(n.id),children:[Ut.jsx("span",{className:"option-check",children:n.selected&&Ut.jsx(ZE,{size:14})}),Ut.jsx("span",{className:"option-label",children:n.label})]},n.id))})]})]})}function QC({selectedBackendIds:e,onSelectionChange:t,maxSelections:n=10,disabled:i=!1,className:r=""}){const a=WE(),[o,s]=Pt.useState(()=>"true"===localStorage.getItem("multiNodeSelector_collapsed"));Pt.useEffect(()=>{localStorage.setItem("multiNodeSelector_collapsed",o.toString())},[o]);const l=[...a.filter(e=>"online"===e.status||"busy"===e.status)].sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:e.name.localeCompare(t.name)),c=e=>{switch(e.status){case"online":return Ut.jsx(RC,{className:"status-icon online",size:10});case"busy":return Ut.jsx(bC,{className:"status-icon busy",size:10});case"error":return Ut.jsx(nC,{className:"status-icon error",size:10});default:return Ut.jsx(RC,{className:"status-icon offline",size:10})}},u=e=>e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`,d=e.length>1,h=e.length>=n,p=l.length>0&&e.length===l.length;return Ut.jsxs("div",{className:`multi-node-selector ${r} ${o?"collapsed":""}`,children:[Ut.jsxs("div",{className:"selector-header",children:[Ut.jsxs("div",{className:"selector-label",children:[Ut.jsx(oC,{size:14}),Ut.jsx("span",{children:"Target Nodes"}),Ut.jsxs("span",{className:"selection-count",children:["(",e.length,"/",l.length,")"]})]}),Ut.jsxs("div",{className:"selector-actions",children:[!o&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("button",{type:"button",className:"action-btn select-all",onClick:()=>{i||t(l.slice(0,n).map(e=>e.id))},disabled:i||p||0===l.length,title:"Select all available nodes",children:[Ut.jsx(ZE,{size:12}),"All"]}),Ut.jsxs("button",{type:"button",className:"action-btn clear-all",onClick:()=>{i||t([])},disabled:i||0===e.length,title:"Clear all selections",children:[Ut.jsx($C,{size:12}),"Clear"]})]}),Ut.jsx("button",{type:"button",className:"action-btn collapse-toggle",onClick:()=>s(!o),title:o?"Expand node selector":"Collapse node selector",children:o?Ut.jsx(JE,{size:12}):Ut.jsx(tC,{size:12})})]})]}),!o&&Ut.jsx("div",{className:"node-chips-container",children:0===l.length?Ut.jsxs("div",{className:"no-nodes-message",children:[Ut.jsx(nC,{size:16}),Ut.jsx("span",{children:"No render nodes available"}),Ut.jsx("span",{className:"hint",children:"Add nodes in the Node Manager to enable parallel generation"})]}):Ut.jsx("div",{className:"node-chips",children:l.map(r=>{const a=e.includes(r.id),o=(e=>{switch(e.status){case"online":return"online";case"busy":return"busy";case"error":return"error";default:return"offline"}})(r);return Ut.jsxs("button",{type:"button",className:`node-chip ${a?"selected":""} ${o} ${i?"disabled":""}`,onClick:()=>{return a=r.id,void(i||(e.includes(a)?t(e.filter(e=>e!==a)):e.length<n&&t([...e,a])));var a},disabled:i||!a&&h,title:`${r.name} - ${r.gpuName} - ${u(r.vramTotal)} VRAM`,children:[c(r),Ut.jsx("span",{className:"node-name",children:r.name}),a&&Ut.jsx("span",{className:"selection-indicator",children:Ut.jsx(ZE,{size:10})}),r.vramTotal>0&&Ut.jsx("span",{className:"vram-badge",children:u(r.vramTotal)})]},r.id)})})}),!o&&d&&Ut.jsxs("div",{className:"parallel-hint",children:[Ut.jsx(XC,{size:12}),Ut.jsxs("span",{children:[Ut.jsx("strong",{children:e.length})," parallel generations with unique seeds"]})]}),!o&&h&&Ut.jsxs("div",{className:"max-selection-warning",children:[Ut.jsx(nC,{size:10}),Ut.jsxs("span",{children:["Maximum ",n," nodes can be selected"]})]})]})}const eT=({isOpen:e,onClose:t,workflows:n,onUpdateWorkflow:i})=>{const[r,a]=Pt.useState(null),[o,s]=Pt.useState([]),[l,c]=Pt.useState(""),u=Pt.useCallback(e=>{a(e),s(e.categories||[])},[]),d=Pt.useCallback(e=>{s(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),h=Pt.useCallback(()=>{r&&i({...r,categories:o})},[r,o,i]),p=n.filter(e=>e.name.toLowerCase().includes(l.toLowerCase())||e.description.toLowerCase().includes(l.toLowerCase())),m=e=>({"Image Generation":"#3d8b6e","Text to Image":"#4a7aa8","Image to Image":"#8b5a7a",InPainting:"#9b7a4a","Image Editing":"#7a6a9a",Upscaling:"#8a8a4a","Video Generation":"#9a5a5a"}[e]||"#6a7a8a");return e?Ut.jsx("div",{className:"workflow-categories-modal-overlay",onClick:t,children:Ut.jsxs("div",{className:"workflow-categories-modal",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"modal-header",children:[Ut.jsxs("h2",{children:[Ut.jsx(VC,{size:20})," Manage Workflow Categories"]}),Ut.jsx("button",{className:"close-btn",onClick:t,children:Ut.jsx($C,{size:20})})]}),Ut.jsxs("div",{className:"modal-content",children:[Ut.jsxs("div",{className:"workflows-list-section",children:[Ut.jsx("div",{className:"search-box",children:Ut.jsx("input",{type:"text",placeholder:"Search workflows...",value:l,onChange:e=>c(e.target.value)})}),Ut.jsx("div",{className:"workflows-list",children:p.map(e=>{var t,n;return Ut.jsxs("div",{className:"workflow-item "+((null==r?void 0:r.id)===e.id?"selected":""),onClick:()=>u(e),children:[Ut.jsxs("div",{className:"workflow-info",children:[Ut.jsx("div",{className:"workflow-name",children:e.name}),Ut.jsx("div",{className:"workflow-description",children:e.description})]}),Ut.jsxs("div",{className:"workflow-categories-preview",children:[null==(t=e.categories)?void 0:t.map(e=>Ut.jsx("span",{className:"category-tag",style:{backgroundColor:m(e)},children:e},e)),!(null==(n=e.categories)?void 0:n.length)&&Ut.jsx("span",{className:"no-categories",children:"No categories"})]})]},e.id)})})]}),Ut.jsx("div",{className:"categories-section",children:r?Ut.jsxs(Ut.Fragment,{children:[Ut.jsxs("h3",{children:["Assign Categories to: ",r.name]}),Ut.jsx("p",{className:"help-text",children:"Select all categories that apply to this workflow. A workflow can have multiple categories."}),Ut.jsx("div",{className:"categories-grid",children:LR.map(e=>Ut.jsxs("button",{className:"category-btn "+(o.includes(e)?"selected":""),onClick:()=>d(e),style:{borderColor:m(e),backgroundColor:o.includes(e)?`${m(e)}20`:"transparent"},children:[Ut.jsx("span",{className:"category-indicator",style:{backgroundColor:m(e)}}),Ut.jsx("span",{className:"category-name",children:e}),o.includes(e)&&Ut.jsx(ZE,{size:16,className:"check-icon"})]},e))}),Ut.jsxs("div",{className:"selected-categories-summary",children:[Ut.jsx("h4",{children:"Selected Categories:"}),Ut.jsxs("div",{className:"selected-tags",children:[o.map(e=>Ut.jsx("span",{className:"selected-tag",style:{backgroundColor:m(e)},children:e},e)),!o.length&&Ut.jsx("span",{className:"no-selection",children:"No categories selected"})]})]}),Ut.jsxs("div",{className:"modal-actions",children:[Ut.jsx("button",{className:"save-btn",onClick:h,children:"Save Categories"}),Ut.jsx("button",{className:"cancel-btn",onClick:()=>a(null),children:"Cancel"})]})]}):Ut.jsxs("div",{className:"no-selection-message",children:[Ut.jsx(VC,{size:48}),Ut.jsx("p",{children:"Select a workflow from the list to assign categories"})]})})]})]})}):null},tT=[".mp4",".mov",".avi",".webm",".mkv",".flv",".wmv"],nT=[".gif",".webp",".apng"];function iT(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return tT.includes(t)?"video":nT.includes(t)?"animated":"image"}function rT(e){try{const t=new URL(e,"http://localhost");return"video"===iT(t.searchParams.get("filename")||t.searchParams.get("path")||e)}catch{const t=e.toLowerCase().substring(e.lastIndexOf("."));return tT.includes(t)}}function aT(e,t){const n=[],i=["images","gifs","videos"];for(const r of i){const i=e[r];if(i&&Array.isArray(i)&&0!==i.length)for(const e of i){if(!e.filename)continue;const i=iT(e.filename);n.push({filename:e.filename,subfolder:e.subfolder||"",type:e.type||"output",url:`${t}/view?filename=${encodeURIComponent(e.filename)}&subfolder=${encodeURIComponent(e.subfolder||"")}&type=${e.type||"output"}`,mediaType:i})}}return n}function oT(){return"undefined"!=typeof window?`${window.location.protocol}//${window.location.hostname}:9820`:"http://localhost:9820"}function sT(e){if(!e)return e;try{const t=new URL(e);if("8020"===t.port)return t.port="9820",t.toString().replace(/\/$/,"")}catch{}return e.replace(/:8020(\b|\/)/,":9820$1")}const lT={name:"Untitled Project",path:"",namingTemplate:"{project}_Panel{panel}_{version}",autoSave:!1,orchestratorUrl:oT(),created:new Date,lastModified:new Date};const cT=new class{constructor(){je(this,"currentProject",{...lT}),je(this,"storageKey","storyboard_project_settings"),this.loadFromStorage()}normalizePath(e){return e.replace(/\\/g,"/")}getProject(){return{...this.currentProject}}setProject(e){this.currentProject={...this.currentProject,...e,lastModified:new Date},this.saveToStorage(),this.syncProjectWithBackend()}async syncProjectWithBackend(){const e=this.currentProject.orchestratorUrl;if(e)try{const t=await fetch(`${e}/api/project`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:{name:this.currentProject.name,path:this.normalizePath(this.currentProject.path),naming_template:this.currentProject.namingTemplate,orchestrator_url:this.currentProject.orchestratorUrl,auto_save:this.currentProject.autoSave}})});t.ok?console.log("[ProjectManager] Project synced with backend"):console.warn("[ProjectManager] Failed to sync project with backend:",t.status)}catch(t){console.warn("[ProjectManager] Error syncing project:",t)}}resetProject(){this.currentProject={...lT,created:new Date,lastModified:new Date},this.saveToStorage()}getExtensionFromUrl(e){try{const t=new URL(e,"http://localhost").searchParams.get("filename");if(t){const e=t.lastIndexOf(".");if(e>=0)return t.substring(e).toLowerCase()}}catch{const t=e.lastIndexOf(".");if(t>=0){const n=e.substring(t).split(/[?#]/)[0].toLowerCase();if(n.length<=6)return n}}return".png"}generateFilename(e,t,n){const i=new Date,r=(e,t=2)=>e.toString().padStart(t,"0"),a={"{project}":this.sanitizeFilename(this.currentProject.name),"{panel}":r(e),"{version}":`v${r(t,3)}`,"{timestamp}":`${i.getFullYear()}${r(i.getMonth()+1)}${r(i.getDate())}_${r(i.getHours())}${r(i.getMinutes())}${r(i.getSeconds())}`,"{date}":`${i.getFullYear()}${r(i.getMonth()+1)}${r(i.getDate())}`,"{time}":`${r(i.getHours())}${r(i.getMinutes())}${r(i.getSeconds())}`,"{seed}":(n.seed??0).toString(),"{workflow}":this.sanitizeFilename(n.workflowName??"unknown")};let o=this.currentProject.namingTemplate;for(const[s,l]of Object.entries(a))o=o.split(s).join(l);return o=(null==n?void 0:n.nodeName)?o.replace("{node}",n.nodeName.replace(/[^a-zA-Z0-9-_]/g,"_")):o.replace("_{node}","").replace("{node}_","").replace("{node}",""),o}async validateProjectPath(e,t){if(!e||""===e.trim())return{valid:!1,exists:!1,message:"Path is required"};try{const n=await fetch(`${t}/api/browse-folders?path=${encodeURIComponent(e)}`);if(!n.ok)return{valid:!1,exists:!1,message:"Path does not exist"};const i=await n.json();return!1===i.success?{valid:!1,exists:!1,message:i.error||"Path does not exist"}:{valid:!0,exists:!0,message:"Path is valid"}}catch(n){return{valid:!1,exists:!1,message:`Cannot validate path: ${n}`}}}sanitizeFilename(e){return e.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").substring(0,50)}splitTemplateParts(){const e=this.currentProject.namingTemplate,t=e.replace(/\\/g,"/");if(t.includes("/")){const e=t.lastIndexOf("/");return{folder:t.substring(0,e),filename:t.substring(e+1)}}return{folder:null,filename:e}}resolvePanelFolder(e,t){const n=this.sanitizeFilename(e),i=this.normalizePath(this.currentProject.path),{folder:r}=this.splitTemplateParts();if(r){const e={"{project}":this.sanitizeFilename(this.currentProject.name),"{panel}":n,"{workflow}":this.sanitizeFilename((null==t?void 0:t.workflowName)??"unknown")};let a=r;for(const[t,n]of Object.entries(e))a=a.split(t).join(n);return`${i}/${a}`}return`${i}/${n}`}generateFilenameForPanel(e,t,n){const i=new Date,r=(e,t=2)=>e.toString().padStart(t,"0"),a=this.sanitizeFilename(e),o={"{project}":this.sanitizeFilename(this.currentProject.name),"{panel}":a,"{version}":`v${r(t,3)}`,"{timestamp}":`${i.getFullYear()}${r(i.getMonth()+1)}${r(i.getDate())}_${r(i.getHours())}${r(i.getMinutes())}${r(i.getSeconds())}`,"{date}":`${i.getFullYear()}${r(i.getMonth()+1)}${r(i.getDate())}`,"{time}":`${r(i.getHours())}${r(i.getMinutes())}${r(i.getSeconds())}`,"{seed}":(n.seed??0).toString(),"{workflow}":this.sanitizeFilename(n.workflowName??"unknown")},{filename:s}=this.splitTemplateParts();let l=s;for(const[c,u]of Object.entries(o))l=l.split(c).join(u);return l=(null==n?void 0:n.nodeName)?l.replace("{node}",n.nodeName.replace(/[^a-zA-Z0-9-_]/g,"_")):l.replace("_{node}","").replace("{node}_","").replace("{node}",""),l}createHistoryEntry(e,t,n,i,r,a,o,s){const l=this.extractSeed(o),c=this.extractPromptSummary(o),u={timestamp:new Date,workflowId:i,workflowName:r,seed:l,promptSummary:c,parameters:{...o},workflow:{...a},sourceUrl:e,version:n,generationTime:s};return{id:`${t}_${n}_${Date.now()}`,url:e,metadata:u}}extractSeed(e){const t=["seed","noise_seed","Seed","random_seed"];for(const n of t){if("number"==typeof e[n])return e[n];for(const[t,i]of Object.entries(e))if(t.startsWith(n)&&"number"==typeof i)return i}return-1}extractPromptSummary(e){const t=["positive_prompt","prompt","text","positive"];for(const n of t){if("string"==typeof e[n])return e[n];for(const[t,i]of Object.entries(e))if(t.startsWith(n)&&"string"==typeof i)return i}return""}async saveToProjectFolder(e,t,n,i,r){const a=this.currentProject.orchestratorUrl;if(!this.currentProject.path)return{success:!1,error:"No project folder configured. Set a folder path in Project Settings."};if(!a)return{success:!1,error:"No Orchestrator URL configured. Set it in Project Settings."};const o=r?this.resolvePanelFolder(r):this.currentProject.path,s=this.getExtensionFromUrl(e),l=(r?this.generateFilenameForPanel(r,n,i):this.generateFilename(t,n,i))+s;try{const t=await fetch(`${a}/api/save-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_url:e,folder_path:this.normalizePath(o),filename:l})});if(!t.ok){const e=await t.text();return console.error(`[ProjectManager] Orchestrator error: ${t.status} - ${e}`),{success:!1,error:`Orchestrator error: ${t.status}`}}const n=await t.json();return n.success?(console.log(`[ProjectManager] Saved to: ${n.saved_path}`),{success:!0,savedPath:n.saved_path}):(console.error(`[ProjectManager] Save failed: ${n.message}`),{success:!1,error:n.message})}catch(c){return console.error("[ProjectManager] Error saving to project folder:",c),{success:!1,error:`Network error: ${String(c)}`}}}async checkOrchestratorHealth(){const e=this.currentProject.orchestratorUrl;if(!e)return{online:!1,error:"No Orchestrator URL configured"};try{const t=await fetch(`${e}/api/health`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(t.ok){const e=await t.json();return{online:"healthy"===e.status||"degraded"===e.status}}return{online:!1,error:`HTTP ${t.status}`}}catch(t){return{online:!1,error:String(t)}}}async downloadImage(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to download image: ${t.statusText}`);return t.blob()}async saveImageToProject(e,t,n,i){const r=this.getExtensionFromUrl(e);return{filename:this.generateFilename(t,n,i)+r,blob:await this.downloadImage(e)}}triggerDownload(e,t){const n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}generateMetadataJson(e){return JSON.stringify({...e.metadata,timestamp:e.metadata.timestamp instanceof Date?e.metadata.timestamp.toISOString():e.metadata.timestamp},null,2)}saveToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify({...this.currentProject,created:this.currentProject.created instanceof Date?this.currentProject.created.toISOString():this.currentProject.created,lastModified:this.currentProject.lastModified instanceof Date?this.currentProject.lastModified.toISOString():this.currentProject.lastModified}))}catch(e){console.error("[ProjectManager] Failed to save to storage:",e)}}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.currentProject={...lT,...t,orchestratorUrl:sT(t.orchestratorUrl||""),created:new Date(t.created),lastModified:new Date(t.lastModified)}}}catch(e){console.error("[ProjectManager] Failed to load from storage:",e)}}async scanExistingVersions(){const e=this.currentProject.orchestratorUrl,t=this.currentProject.path;if(console.log(`[ProjectManager] scanExistingVersions - orchestrator: ${e}, folder: ${t}, pattern: ${this.currentProject.namingTemplate}`),!e||!t)return console.log("[ProjectManager] scanExistingVersions - skipping (no orchestrator or folder)"),{success:!0,panelVersions:{}};try{const n={folder_path:t,pattern:this.currentProject.namingTemplate};console.log("[ProjectManager] scanExistingVersions - request:",JSON.stringify(n));const i=await fetch(`${e}/api/scan-versions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)return console.error(`[ProjectManager] scanExistingVersions - HTTP error: ${i.status}`),{success:!1,panelVersions:{},error:`HTTP ${i.status}`};const r=await i.json();console.log("[ProjectManager] scanExistingVersions - response:",JSON.stringify(r)),r.message&&r.message.includes(" DEBUG_CODE_RUNNING ")&&(console.log("%c DEBUG CODE IS RUNNING! ","background: #ff0000; color: #ffffff; font-size: 20px; font-weight: bold; padding: 10px;"),console.log("%cThis means server.py dummy code executed successfully!","background: #00aa00; color: #ffffff; font-size: 16px; padding: 5px;"),console.log("Message from server:",r.message));const a={};if(r.panel_versions)for(const[e,t]of Object.entries(r.panel_versions))a[e]="string"==typeof t?parseInt(t,10):t;return{success:r.success,panelVersions:a,error:r.message}}catch(n){return console.error("[ProjectManager] Failed to scan versions:",n),{success:!1,panelVersions:{},error:String(n)}}}async getNextVersion(e,t=[]){var n;const i=await this.scanExistingVersions(),r=this.sanitizeFilename(e),a=i.panelVersions[r]||0;let o=0;for(const l of t)(null==(n=l.metadata)?void 0:n.version)&&l.metadata.version>o&&(o=l.metadata.version);const s=Math.max(a,o)+1;return console.log(`[ProjectManager] getNextVersion for "${e}": filesystem=${a}, history=${o}, next=${s}`),s}async saveProjectState(e,t,n,i){const r=this.currentProject.orchestratorUrl,a=this.currentProject.path;if(!r)return{success:!1,error:"No Orchestrator URL configured"};if(!a)return{success:!1,error:"No project folder configured"};try{const t=e.map(e=>{var t,n;const i=e;console.log("[ProjectManager] Saving panel:",{id:i.id,name:i.name,notes:i.notes,hasImageHistory:Array.isArray(i.imageHistory)?i.imageHistory.length:0});const r=i.imageHistory,a={};if(r&&Array.isArray(r))for(const o of r)void 0!==(null==(t=o.metadata)?void 0:t.rating)&&(null==(n=o.metadata)?void 0:n.savedPath)&&(a[o.metadata.savedPath]=o.metadata.rating,console.log("[ProjectManager] Saving rating:",o.metadata.savedPath,o.metadata.rating));return{id:i.id,x:i.x,y:i.y,width:i.width,height:i.height,name:i.name,notes:i.notes,workflowId:i.workflowId,parameterValues:i.parameterValues,nodeId:i.nodeId,imageRatings:a}});console.log("[ProjectManager] Sanitized panels:",JSON.stringify(t,null,2));const o=await fetch(`${r}/api/save-project`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_path:a,filename:`${this.sanitizeFilename(this.currentProject.name)}_project.json`,state:{project_settings:{...this.currentProject,created:this.currentProject.created instanceof Date?this.currentProject.created.toISOString():this.currentProject.created,lastModified:(new Date).toISOString()},panels:t,parameter_values:n||null,selected_workflow_id:(null==i?void 0:i.selectedWorkflowId)||null,render_nodes:(null==i?void 0:i.renderNodes)||null,comfy_url:(null==i?void 0:i.comfyUrl)||null,deleted_images:(null==i?void 0:i.deletedImages)||[],saved_at:(new Date).toISOString()}})});if(!o.ok)return{success:!1,error:`HTTP ${o.status}`};const s=await o.json();return{success:s.success,savedPath:s.saved_path,error:s.message}}catch(o){return console.error("[ProjectManager] Failed to save project:",o),{success:!1,error:String(o)}}}async loadProjectState(e){const t=this.currentProject.orchestratorUrl;if(!t)return{success:!1,error:"No Orchestrator URL configured"};try{const n=await fetch(`${t}/api/load-project`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:e})});if(!n.ok)return{success:!1,error:`HTTP ${n.status}`};const i=await n.json();if(i.success&&i.state){const e=i.state.project_settings;return this.currentProject={...lT,...e,orchestratorUrl:sT(e.orchestratorUrl||""),created:new Date(e.created),lastModified:new Date(e.lastModified)},this.saveToStorage(),{success:!0,state:i.state}}return{success:!1,error:i.message}}catch(n){return console.error("[ProjectManager] Failed to load project:",n),{success:!1,error:String(n)}}}async listProjects(e){const t=this.currentProject.orchestratorUrl,n=e||this.currentProject.path;if(!t||!n)return{success:!0,projects:[]};try{const e=await fetch(`${t}/api/list-projects?folder_path=${encodeURIComponent(n)}`,{method:"GET"});if(!e.ok)return{success:!1,projects:[],error:`HTTP ${e.status}`};const i=await e.json();return{success:i.success,projects:i.projects||[],error:i.message}}catch(i){return console.error("[ProjectManager] Failed to list projects:",i),{success:!1,projects:[],error:String(i)}}}async scanProjectImages(e){const t=this.currentProject.orchestratorUrl;if(!t)return{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:[],error:"No Orchestrator URL configured"};try{const e=this.currentProject.path.replace(/\\/g,"/"),n=this.currentProject.namingTemplate.replace(/\\/g,"/");console.log("[ProjectManager] scanProjectImages - original path:",this.currentProject.path),console.log("[ProjectManager] scanProjectImages - normalized path:",e),console.log("[ProjectManager] scanProjectImages - normalized pattern:",n);const i={folder_path:e,naming_pattern:n,project_name:this.currentProject.name};console.log("[ProjectManager] scanProjectImages - request:",JSON.stringify(i));const r=await fetch(`${t}/api/scan-project-images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok)return{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:[],error:`HTTP ${r.status}`};const a=await r.json();if(!a.success)return{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:a.skipped_files||[],error:a.message};const o=new Map;let s=0;for(const t of a.images)o.has(t.panel_number)||o.set(t.panel_number,[]),o.get(t.panel_number).push(t),s=Math.max(s,t.panel_number);return o.forEach(e=>{e.sort((e,t)=>e.version-t.version)}),{success:!0,imagesByPanel:o,maxPanelNumber:s,skippedFiles:a.skipped_files||[]}}catch(n){return console.error("[ProjectManager] Failed to scan project images:",n),{success:!1,imagesByPanel:new Map,maxPanelNumber:0,skippedFiles:[],error:String(n)}}}async scanProjectPanels(){const e=this.currentProject.orchestratorUrl;if(!e)return{success:!1,panels:[],error:"No Orchestrator URL configured"};if(!this.currentProject.path)return{success:!1,panels:[],error:"No project path configured"};try{const t=this.normalizePath(this.currentProject.path);console.log("[ProjectManager] scanProjectPanels - path:",t);const n=await fetch(`${e}/api/scan-project-panels`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_path:t})});if(!n.ok)return{success:!1,panels:[],error:`HTTP ${n.status}`};const i=await n.json();return console.log("[ProjectManager] scanProjectPanels - result:",i),i.success?{success:!0,panels:i.panels}:{success:!1,panels:[],error:i.message}}catch(t){return console.error("[ProjectManager] Failed to scan project panels:",t),{success:!1,panels:[],error:String(t)}}}async deleteImage(e){const t=this.currentProject.orchestratorUrl||oT();console.log("[ProjectManager] deleteImage called with path:",e),console.log("[ProjectManager] Using orchestratorUrl:",t);try{const n=await fetch(`${t}/api/delete-image`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_path:e})}),i=await n.json();return console.log("[ProjectManager] Delete API response:",i),{success:i.success,deletedFiles:i.deleted_files||[],error:i.message}}catch(n){return console.error("[ProjectManager] Failed to delete image:",n),{success:!1,deletedFiles:[],error:String(n)}}}};function uT({node:e,level:t,selectedPath:n,expandedPaths:i,onSelectFolder:r,onExpandFolder:a,onCollapseFolder:o}){const s=e.path===n,l=i.has(e.path);return Ut.jsxs("div",{className:"tree-node-wrapper",children:[Ut.jsxs("div",{className:"tree-node "+(s?"selected":""),style:{paddingLeft:12*t+8+"px"},onClick:()=>{r(e.path)},children:["folder"===e.type&&Ut.jsx("button",{className:"tree-expand-btn",onClick:t=>{t.stopPropagation(),l?o(e.path):a(e.path)},disabled:e.isLoading,children:e.isLoading?Ut.jsx(bC,{size:14,className:"tree-loading-icon"}):l?Ut.jsx(JE,{size:14}):Ut.jsx(eC,{size:14})}),"drive"===e.type&&Ut.jsx("span",{className:"tree-spacer"}),"drive"===e.type?Ut.jsx(vC,{size:16,className:"tree-icon drive"}):l?Ut.jsx(pC,{size:16,className:"tree-icon folder-open"}):Ut.jsx(fC,{size:16,className:"tree-icon folder"}),Ut.jsx("span",{className:"tree-label",children:e.name})]}),l&&e.children&&e.children.length>0&&Ut.jsx("div",{className:"tree-children",children:e.children.map(e=>Ut.jsx(uT,{node:e,level:t+1,selectedPath:n,expandedPaths:i,onSelectFolder:r,onExpandFolder:a,onCollapseFolder:o},e.path))}),l&&e.children&&0===e.children.length&&!e.isLoading&&Ut.jsx("div",{className:"tree-empty-children",style:{paddingLeft:12*(t+1)+32+"px"},children:"(empty)"})]})}function dT({nodes:e,selectedPath:t,expandedPaths:n,onSelectFolder:i,onExpandFolder:r,onCollapseFolder:a}){return Ut.jsxs("div",{className:"drive-tree-view",children:[Ut.jsx("div",{className:"tree-header",children:Ut.jsx("span",{children:"Quick Access"})}),Ut.jsx("div",{className:"tree-content",children:0===e.length?Ut.jsx("div",{className:"tree-empty",children:"No drives found"}):e.map(e=>Ut.jsx(uT,{node:e,level:0,selectedPath:t,expandedPaths:n,onSelectFolder:i,onExpandFolder:r,onCollapseFolder:a},e.path))})]})}function hT(e){const t=new Date(e),n=(new Date).getTime()-t.getTime(),i=Math.floor(n/864e5);if(0===i){const e=Math.floor(n/36e5);if(0===e){const e=Math.floor(n/6e4);return e<=1?"Just now":`${e} minutes ago`}return`${e} hours ago`}return 1===i?"Yesterday":i<7?`${i} days ago`:i<30?`${Math.floor(i/7)} weeks ago`:t.toLocaleDateString()}function pT({items:e,selectedItem:t,onSelectItem:n,onOpenItem:i,isLoading:r}){const a=e=>{n(e)},o=e=>{i(e)},s=e=>{switch(e.type){case"drive":return Ut.jsx(vC,{size:24,className:"item-icon drive"});case"folder":return Ut.jsx(fC,{size:24,className:"item-icon folder"});case"project":return Ut.jsx(dC,{size:24,className:"item-icon project"});default:return Ut.jsx(fC,{size:24,className:"item-icon"})}},l=[...e].sort((e,t)=>{const n={drive:0,folder:1,project:2},i=n[e.type]-n[t.type];return 0!==i?i:e.name.localeCompare(t.name)}),c=l.filter(e=>"drive"===e.type||"folder"===e.type),u=l.filter(e=>"project"===e.type);return r?Ut.jsx("div",{className:"folder-contents-view loading",children:Ut.jsxs("div",{className:"contents-loading",children:[Ut.jsx("div",{className:"loading-spinner"}),Ut.jsx("span",{children:"Loading..."})]})}):0===l.length?Ut.jsx("div",{className:"folder-contents-view empty",children:Ut.jsxs("div",{className:"contents-empty",children:[Ut.jsx(fC,{size:48,className:"empty-icon"}),Ut.jsx("span",{children:"This folder is empty"})]})}):Ut.jsxs("div",{className:"folder-contents-view",children:[c.length>0&&Ut.jsxs("div",{className:"contents-section",children:[Ut.jsxs("div",{className:"section-header",children:[Ut.jsx(fC,{size:14}),Ut.jsxs("span",{children:["Folders (",c.length,")"]})]}),Ut.jsx("div",{className:"items-grid",children:c.map(e=>Ut.jsxs("div",{className:`content-item ${(null==t?void 0:t.path)===e.path?"selected":""} ${e.type}`,onClick:()=>a(e),onDoubleClick:()=>o(e),title:e.name,children:[s(e),Ut.jsx("span",{className:"item-name",children:e.name})]},e.path))})]}),u.length>0&&Ut.jsxs("div",{className:"contents-section",children:[Ut.jsxs("div",{className:"section-header",children:[Ut.jsx(dC,{size:14}),Ut.jsxs("span",{children:["Projects (",u.length,")"]})]}),Ut.jsx("div",{className:"items-grid",children:u.map(e=>Ut.jsxs("div",{className:`content-item ${(null==t?void 0:t.path)===e.path?"selected":""} ${e.type}`,onClick:()=>a(e),onDoubleClick:()=>o(e),title:e.name,children:[s(e),Ut.jsxs("div",{className:"item-details",children:[Ut.jsx("span",{className:"item-name",children:e.name}),e.metadata&&Ut.jsxs("div",{className:"item-meta",children:[Ut.jsxs("span",{className:"meta-item",children:[Ut.jsx(aC,{size:12}),hT(e.metadata.savedAt)]}),Ut.jsxs("span",{className:"meta-item",children:[Ut.jsx(xC,{size:12}),e.metadata.panelCount," panels"]})]})]})]},e.path))})]})]})}function mT({path:e,onNavigate:t,onRefresh:n,isLoading:i}){const[r,a]=Pt.useState(!1),[o,s]=Pt.useState(e),l=Pt.useRef(null);Pt.useEffect(()=>{r||s(e)},[e,r]),Pt.useEffect(()=>{r&&l.current&&(l.current.focus(),l.current.select())},[r]);const c=Pt.useCallback(e=>{if(!e)return[{name:"Computer",path:""}];const t=e.replace(/\\/g,"/").split("/").filter(Boolean),n=[];let i="";if(t.length>0&&t[0].includes(":")){n.push({name:t[0],path:t[0]+(t[0].endsWith(":")?"\\":"")}),i=t[0]+(t[0].endsWith(":")?"\\":"");for(let e=1;e<t.length;e++)i+=(i.endsWith("\\")?"":"\\")+t[e],n.push({name:t[e],path:i})}else{n.push({name:"Computer",path:""});for(const e of t)i+=(i?"/":"")+e,n.push({name:e,path:i})}return n},[])(e),u=()=>{const e=o.trim();t(e||""),a(!1)};return Ut.jsxs("div",{className:"breadcrumb-bar",children:[Ut.jsx("button",{className:"breadcrumb-home-btn",onClick:()=>{t("")},title:"Go to Computer",children:Ut.jsx(yC,{size:14})}),r?Ut.jsx("div",{className:"breadcrumb-edit-container",children:Ut.jsx("input",{ref:l,type:"text",className:"breadcrumb-input",value:o,onChange:e=>s(e.target.value),onKeyDown:t=>{"Enter"===t.key?u():"Escape"===t.key&&(s(e),a(!1))},onBlur:u,placeholder:"Enter path..."})}):Ut.jsx("div",{className:"breadcrumb-segments",onClick:()=>{a(!0)},title:"Click to edit path",children:c.map((e,n)=>Ut.jsxs("div",{className:"breadcrumb-segment-wrapper",children:[n>0&&Ut.jsx(eC,{size:14,className:"breadcrumb-separator"}),Ut.jsx("button",{className:"breadcrumb-segment "+(n===c.length-1?"current":""),onClick:n=>{var i;n.stopPropagation(),i=e.path,t(i)},disabled:n===c.length-1,children:e.name})]},e.path))}),Ut.jsx("button",{className:"breadcrumb-refresh-btn",onClick:n,disabled:i,title:"Refresh",children:Ut.jsx(IC,{size:14,className:i?"spinning":""})})]})}function fT({isOpen:e,onClose:t,mode:n,orchestratorUrl:i,initialPath:r="",projectName:a="",title:o,onOpenProject:s,onSaveProject:l,onSelectFolder:c}){var u,d,h,p;const{state:m,navigateTo:f,selectItem:g,expandTreeNode:v,collapseTreeNode:y,refresh:_,goToParent:x}=function(e,t="",n=!0){const[i,r]=Pt.useState({currentPath:t,selectedItem:null,treeNodes:[],folderContents:[],isLoading:!1,error:null,expandedPaths:new Set}),a=Pt.useRef(new Map),o=Pt.useCallback(async(t,n=!0)=>{if(n&&a.current.has(t))return{items:a.current.get(t),parent:null};try{const n=await fetch(`${e}/api/browse-folders?path=${encodeURIComponent(t)}`,{method:"GET"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const r=await n.json();if(!r.success)throw new Error(r.error||"Failed to browse folder");const o=[...(r.items??r.folders??[]).map(e=>({...e,type:e.type}))];if(r.current)try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),i=await fetch(`${e}/api/list-projects?folder_path=${encodeURIComponent(r.current)}`,{method:"GET",signal:t.signal});if(clearTimeout(n),i.ok){const e=await i.json();if(e.success&&e.projects){const t=e.projects.map(e=>({name:e.name,path:e.path,type:"project",metadata:{name:e.name,savedAt:e.saved_at,panelCount:e.panel_count}}));o.push(...t)}}}catch(i){console.warn("[useFileBrowser] Failed to fetch projects:",i)}return a.current.set(t,o),{items:o,parent:r.parent}}catch(T){throw console.error("[useFileBrowser] Failed to fetch folder contents:",T),T}},[e]),s=Pt.useCallback(async t=>{try{const n=await fetch(`${e}/api/browse-folders?path=${encodeURIComponent(t)}`,{method:"GET"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=await n.json();if(!i.success)throw new Error(i.error||"Failed to browse folder");return(i.items??i.folders??[]).filter(e=>"folder"===e.type).map(e=>({id:e.path,name:e.name,path:e.path,type:"folder",children:void 0,isLoading:!1,isExpanded:!1}))}catch(T){return console.error("[useFileBrowser] Failed to fetch tree children:",T),[]}},[e]),l=Pt.useCallback(async e=>{r(e=>({...e,isLoading:!0,error:null}));try{const{items:t}=await o(e);r(n=>({...n,currentPath:e,folderContents:t,isLoading:!1,selectedItem:null}))}catch(t){r(e=>({...e,isLoading:!1,error:t instanceof Error?t.message:"Failed to navigate"}))}},[o]),c=Pt.useCallback(e=>{r(t=>({...t,selectedItem:e}))},[]),u=Pt.useCallback(async e=>{r(t=>{const n=new Set(t.expandedPaths);return n.add(e),{...t,expandedPaths:n}});const t=(e,n)=>{for(const i of e){if(i.path===n)return i;if(i.children){const e=t(i.children,n);if(e)return e}}return null},n=t(i.treeNodes,e);if(n&&n.children&&n.children.length>0)r(t=>{const n=t=>t.map(t=>t.path===e?{...t,isExpanded:!0}:t.children?{...t,children:n(t.children)}:t);return{...t,treeNodes:n(t.treeNodes)}});else{r(t=>{const n=t=>t.map(t=>t.path===e?{...t,isLoading:!0}:t.children?{...t,children:n(t.children)}:t);return{...t,treeNodes:n(t.treeNodes)}});try{const t=await s(e);r(n=>{const i=n=>n.map(n=>n.path===e?{...n,children:t,isLoading:!1,isExpanded:!0}:n.children?{...n,children:i(n.children)}:n);return{...n,treeNodes:i(n.treeNodes)}})}catch(a){r(t=>{const n=t=>t.map(t=>t.path===e?{...t,isLoading:!1}:t.children?{...t,children:n(t.children)}:t);return{...t,treeNodes:n(t.treeNodes)}})}}},[i.treeNodes,s]),d=Pt.useCallback(e=>{r(t=>{const n=new Set(t.expandedPaths);n.delete(e);const i=t=>t.map(t=>t.path===e?{...t,isExpanded:!1}:t.children?{...t,children:i(t.children)}:t);return{...t,expandedPaths:n,treeNodes:i(t.treeNodes)}})},[]),h=Pt.useCallback(async()=>{a.current.delete(i.currentPath),await l(i.currentPath)},[i.currentPath,l]),p=Pt.useCallback(async()=>{try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),r=await fetch(`${e}/api/browse-folders?path=${encodeURIComponent(i.currentPath)}`,{method:"GET",signal:t.signal});if(clearTimeout(n),!r.ok)throw new Error(`HTTP ${r.status}`);const a=await r.json();a.success&&a.parent&&await l(a.parent)}catch(t){console.error("[useFileBrowser] Failed to go to parent:",t)}},[i.currentPath,e,l]),m=Pt.useCallback(async()=>{await l("")},[l]);return Pt.useEffect(()=>{n&&(a.current.clear(),r({currentPath:t,selectedItem:null,treeNodes:[],folderContents:[],isLoading:!0,error:null,expandedPaths:new Set}),(async()=>{try{const n=await fetch(`${e}/api/browse-folders?path=`,{method:"GET"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=await n.json();if(i.success){const e=i.items??i.folders??[],n=e.filter(e=>"drive"===e.type).map(e=>({id:e.path,name:e.name,path:e.path,type:"drive",children:void 0,isLoading:!1,isExpanded:!1}));r(t=>({...t,isLoading:!1,treeNodes:n,folderContents:e.map(e=>({...e,type:e.type}))})),t&&await l(t)}else r(e=>({...e,isLoading:!1,error:i.error||"Failed to load drives"}))}catch(n){r(e=>({...e,isLoading:!1,error:n instanceof Error?n.message:"Failed to load drives"}))}})())},[e,n,t,l]),{state:i,navigateTo:l,selectItem:c,expandTreeNode:u,collapseTreeNode:d,refresh:h,goToParent:p,goToRoot:m}}(i,r,e),[b,S]=Pt.useState(a),[w,M]=Pt.useState(!1),[E,C]=Pt.useState(""),[T,P]=Pt.useState(null);Pt.useEffect(()=>{a&&S(a)},[a]),Pt.useEffect(()=>{P(null)},[m.currentPath]),Pt.useEffect(()=>{if(!e)return;const i=e=>{var i;if("Escape"===e.key)return e.preventDefault(),void t();if("Enter"===e.key)return e.preventDefault(),void(("select-folder"===n&&m.currentPath||"open"===n&&"project"===(null==(i=m.selectedItem)?void 0:i.type)||"save"===n&&b.trim())&&R());if("Backspace"===e.key&&!e.shiftKey){"INPUT"!==e.target.tagName&&(e.preventDefault(),x())}};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[e,n,m.selectedItem,b,t,x]);const k=Pt.useCallback(async e=>{await f(e)},[f]),A=Pt.useCallback(e=>{if(g(e),"save"===n&&"project"===e.type){const t=e.name.replace(/_project\.json$/i,"");S(t)}},[g,n]),N=Pt.useCallback(e=>{"folder"===e.type||"drive"===e.type?f(e.path):"project"===e.type&&"open"===n&&s(e.path)},[f,s,n]),R=()=>{var e,i,r,a;if("select-folder"===n){const n="folder"===(null==(e=m.selectedItem)?void 0:e.type)||"drive"===(null==(i=m.selectedItem)?void 0:i.type)?m.selectedItem.path:m.currentPath;if(!n)return void P("Please select a folder");c&&c(n),t()}else if("open"===n)"project"===(null==(r=m.selectedItem)?void 0:r.type)?s(m.selectedItem.path):"folder"===(null==(a=m.selectedItem)?void 0:a.type)?f(m.selectedItem.path):P("Please select a project file to open");else if("save"===n){if(!b.trim())return void P("Please enter a project name");if(!m.currentPath)return void P("Please select a folder to save in");l&&l(m.currentPath,b.trim())}},L=async()=>{if(E.trim())try{const e=await fetch(`${i}/api/create-folder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_path:m.currentPath,folder_name:E.trim()})});if(e.ok){const t=await e.json();t.success?(M(!1),C(""),await _(),t.folder_path&&await f(t.folder_path)):P(t.message||"Failed to create folder")}else P("Failed to create folder")}catch(e){P(`Error creating folder: ${e}`)}};return e?Ut.jsx("div",{className:"file-browser-overlay",onClick:t,children:Ut.jsxs("div",{className:"file-browser-dialog",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"file-browser-header",children:[Ut.jsx("div",{className:"file-browser-title",children:"select-folder"===n?Ut.jsxs(Ut.Fragment,{children:[Ut.jsx(pC,{size:18}),Ut.jsx("span",{children:o||"Select Folder"})]}):"open"===n?Ut.jsxs(Ut.Fragment,{children:[Ut.jsx(pC,{size:18}),Ut.jsx("span",{children:o||"Load Project"})]}):Ut.jsxs(Ut.Fragment,{children:[Ut.jsx(UC,{size:18}),Ut.jsx("span",{children:o||"Save Project As"})]})}),Ut.jsx("button",{className:"close-btn",onClick:t,children:Ut.jsx($C,{size:18})})]}),Ut.jsxs("div",{className:"file-browser-body",children:[Ut.jsx("div",{className:"file-browser-left-pane",children:Ut.jsx(dT,{nodes:m.treeNodes,selectedPath:m.currentPath,expandedPaths:m.expandedPaths,onSelectFolder:k,onExpandFolder:v,onCollapseFolder:y})}),Ut.jsxs("div",{className:"file-browser-right-pane",children:[Ut.jsx(mT,{path:m.currentPath,onNavigate:f,onRefresh:_,isLoading:m.isLoading}),Ut.jsx(pT,{items:m.folderContents,selectedItem:m.selectedItem,onSelectItem:A,onOpenItem:N,isLoading:m.isLoading}),T&&Ut.jsxs("div",{className:"file-browser-error",children:[Ut.jsx(nC,{size:16}),Ut.jsx("span",{children:T})]}),"save"===n&&Ut.jsxs("div",{className:"file-browser-save-input",children:[Ut.jsx("label",{children:"Project Name:"}),Ut.jsx("input",{type:"text",value:b,onChange:e=>S(e.target.value),placeholder:"Enter project name...",onKeyDown:e=>{"Enter"===e.key&&R()},autoFocus:!0})]}),w&&Ut.jsxs("div",{className:"file-browser-new-folder",children:[Ut.jsx("input",{type:"text",value:E,onChange:e=>C(e.target.value),placeholder:"New folder name...",onKeyDown:e=>{"Enter"===e.key?L():"Escape"===e.key&&(M(!1),C(""))},autoFocus:!0}),Ut.jsx("button",{onClick:L,children:"Create"}),Ut.jsx("button",{onClick:()=>{M(!1),C("")},children:"Cancel"})]})]})]}),Ut.jsxs("div",{className:"file-browser-footer",children:[Ut.jsxs("button",{className:"new-folder-btn",onClick:()=>M(!0),disabled:w||!m.currentPath,children:[Ut.jsx(mC,{size:16}),Ut.jsx("span",{children:"New Folder"})]}),"select-folder"===n&&m.currentPath&&Ut.jsxs("div",{className:"file-browser-selected-path",title:"folder"===(null==(u=m.selectedItem)?void 0:u.type)||"drive"===(null==(d=m.selectedItem)?void 0:d.type)?m.selectedItem.path:m.currentPath,children:[Ut.jsx("span",{className:"selected-path-label",children:"Selected:"}),Ut.jsx("span",{className:"selected-path-value",children:"folder"===(null==(h=m.selectedItem)?void 0:h.type)||"drive"===(null==(p=m.selectedItem)?void 0:p.type)?m.selectedItem.path:m.currentPath})]}),Ut.jsxs("div",{className:"file-browser-actions",children:[Ut.jsx("button",{className:"cancel-btn",onClick:t,children:"Cancel"}),Ut.jsx("button",{className:"primary-btn",onClick:R,disabled:(()=>{var e,t,i,r;if("select-folder"===n){return!("folder"===(null==(e=m.selectedItem)?void 0:e.type)||"drive"===(null==(t=m.selectedItem)?void 0:t.type)||!!m.currentPath)}return"open"===n?"project"!==(null==(i=m.selectedItem)?void 0:i.type)&&"folder"!==(null==(r=m.selectedItem)?void 0:r.type):!b.trim()||!m.currentPath})(),children:"select-folder"===n?"Select Folder":"open"===n?"project"===(null==(I=m.selectedItem)?void 0:I.type)?"Open Project":"Select Folder":"Save"})]})]})]})}):null;var I}function gT({isOpen:e,onClose:t,settings:n,onSave:i}){const[r,a]=Pt.useState(n.name),[o,s]=Pt.useState(n.path),[l,c]=Pt.useState(n.namingTemplate),[u,d]=Pt.useState(n.autoSave),[h,p]=Pt.useState(n.orchestratorUrl||oT()),[m,f]=Pt.useState("checking"),[g,v]=Pt.useState(!1),[y,_]=Pt.useState(null),[x,b]=Pt.useState(!1);if(Pt.useEffect(()=>{e&&(a(n.name),s(n.path),c(n.namingTemplate),d(n.autoSave),p(n.orchestratorUrl||oT()))},[e,n]),Pt.useEffect(()=>{if(!e||!h)return;f("checking");const t=new AbortController;return fetch(`${h}/api/health`,{signal:t.signal}).then(e=>e.ok?f("online"):f("offline")).catch(()=>f("offline")),()=>t.abort()},[e,h]),!e)return null;const S=async()=>{if(!o||!h)return;b(!0);const e=await cT.validateProjectPath(o,h);_(e),b(!1)};return Ut.jsxs("div",{className:"modal-overlay",onClick:t,children:[Ut.jsxs("div",{className:"project-settings-modal",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"modal-header",children:[Ut.jsx("h2",{children:"Project Settings"}),Ut.jsx("button",{className:"close-btn",onClick:t,children:""})]}),Ut.jsxs("div",{className:"modal-body",children:[Ut.jsxs("div",{className:"form-group",children:[Ut.jsx("label",{htmlFor:"project-name",children:"Project Name"}),Ut.jsx("input",{id:"project-name",type:"text",value:r,onChange:e=>a(e.target.value),placeholder:"My VFX Project"})]}),Ut.jsxs("div",{className:"form-group",children:[Ut.jsx("label",{htmlFor:"project-path",children:"Output Folder Path"}),Ut.jsxs("div",{className:"input-with-button",children:[Ut.jsx("input",{id:"project-path",type:"text",value:o,onChange:e=>{s(e.target.value),_(null)},onBlur:S,placeholder:"e.g., Z:\\Projects\\MyProject\\renders"}),Ut.jsx("button",{type:"button",className:"browse-btn",onClick:()=>v(!0),disabled:"online"!==m,title:"online"!==m?"Orchestrator must be online to browse folders":"Browse folders",children:Ut.jsx(pC,{size:16})}),Ut.jsx("button",{type:"button",className:"validate-btn",onClick:S,disabled:!o||!h||x,title:"Validate path",children:x?"...":"Validate"})]}),y&&Ut.jsxs("div",{className:"path-validation-indicator "+(y.valid?"valid":"invalid"),children:[y.valid?Ut.jsx(iC,{size:14}):Ut.jsx(rC,{size:14}),Ut.jsx("span",{children:y.message})]}),Ut.jsx("small",{className:"help-text",children:"Full path where images will be saved. Leave empty for browser downloads."})]}),Ut.jsxs("div",{className:"form-group",children:[Ut.jsxs("label",{htmlFor:"orchestrator-url",children:["Orchestrator URL",Ut.jsx("span",{className:`status-indicator ${m}`,children:"checking"===m?"...":"online"===m?" (Online)":" (Offline)"})]}),Ut.jsx("input",{id:"orchestrator-url",type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"http://localhost:9820"}),Ut.jsx("small",{className:"help-text",children:"URL of the Director's Console Orchestrator API (for auto-save to filesystem)."})]}),Ut.jsxs("div",{className:"form-group",children:[Ut.jsx("label",{htmlFor:"naming-template",children:"Naming Template"}),Ut.jsx("input",{id:"naming-template",type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"{project}_Panel{panel}_{version}"}),Ut.jsxs("small",{className:"help-text",children:["Available tokens: ","{project}",", ","{panel}",", ","{version}",", ","{timestamp}",", ","{date}",", ","{time}",", ","{seed}",", ","{workflow}",Ut.jsx("br",{}),Ut.jsx("strong",{children:"{panel}"}),' = Full panel name (e.g., "Panel_01", "Hero_Shot", "Opening_Scene")']}),Ut.jsxs("div",{className:"preview",children:[Ut.jsx("strong",{children:"Preview:"})," ",(()=>{const e=new Date,t=(e,t=2)=>e.toString().padStart(t,"0"),n={"{project}":r.replace(/[<>:"/\\|?*\s]/g,"_").substring(0,50),"{panel}":"Panel_01","{version}":"v001","{timestamp}":`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}_${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`,"{date}":`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}`,"{time}":`${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`,"{seed}":"12345678","{workflow}":"MyWorkflow"};let i=l;for(const[r,a]of Object.entries(n))i=i.split(r).join(a);return i+".png"})()]})]}),Ut.jsxs("div",{className:"form-group checkbox-group",children:[Ut.jsxs("label",{children:[Ut.jsx("input",{type:"checkbox",checked:u,onChange:e=>d(e.target.checked)}),"Auto-save on generation completion"]}),Ut.jsx("small",{className:"help-text",children:"Automatically save images when generation completes (requires output folder)."})]}),Ut.jsxs("div",{className:"template-examples",children:[Ut.jsx("h4",{children:"Common Templates:"}),Ut.jsxs("div",{className:"template-list",children:[Ut.jsxs("button",{type:"button",className:"template-btn",onClick:()=>c("{project}_{panel}_{version}"),children:["Panel-based: ","{project}_{panel}_{version}",Ut.jsx("small",{children:"Result: Eliot_Panel_01_v001.png"})]}),Ut.jsxs("button",{type:"button",className:"template-btn",onClick:()=>c("{panel}\\{project}_{panel}_{version}"),children:["Per-panel folders: ","{panel}\\{project}_{panel}_{version}",Ut.jsx("small",{children:"Creates Panel_01\\Eliot_Panel_01_v001.png"})]}),Ut.jsxs("button",{type:"button",className:"template-btn",onClick:()=>c("{project}_SHOT{panel}_{version}"),children:["Shot-based: ","{project}_SHOT{panel}_{version}",Ut.jsx("small",{children:"Result: Eliot_SHOTPanel_01_v001.png"})]}),Ut.jsxs("button",{type:"button",className:"template-btn",onClick:()=>c("{project}_{panel}_{timestamp}"),children:["Timestamped: ","{project}_{panel}_{timestamp}",Ut.jsx("small",{children:"Result: Eliot_Panel_01_20250206_143022.png"})]}),Ut.jsxs("button",{type:"button",className:"template-btn",onClick:()=>c("{workflow}_{seed}_{version}"),children:["Seed-based: ","{workflow}_{seed}_{version}",Ut.jsx("small",{children:"Result: MyWorkflow_12345678_v001.png"})]})]})]})]}),Ut.jsxs("div",{className:"modal-footer",children:[Ut.jsx("button",{className:"btn-secondary",onClick:t,children:"Cancel"}),Ut.jsx("button",{className:"btn-primary",onClick:()=>{i({name:r,path:o,namingTemplate:l,autoSave:u,orchestratorUrl:h}),t()},children:"Save Settings"})]})]}),Ut.jsx(fT,{isOpen:g,onClose:()=>v(!1),mode:"select-folder",orchestratorUrl:h,initialPath:o,title:"Select Output Folder",onOpenProject:()=>{},onSelectFolder:e=>{s(e),v(!1)}})]})}function vT({isOpen:e,onClose:t,onSelect:n,orchestratorUrl:i,initialPath:r="",title:a="Select Folder"}){const[o,s]=Pt.useState(r),[l,c]=Pt.useState([]),[u,d]=Pt.useState(null),[h,p]=Pt.useState(!1),[m,f]=Pt.useState(null),[g,v]=Pt.useState(""),[y,_]=Pt.useState(!1),x=Pt.useCallback(async e=>{if(i){p(!0),f(null);try{const t=await fetch(`${i}/api/browse-folders?path=${encodeURIComponent(e)}`,{method:"GET"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();n.success?(s(n.current||""),c(n.items||[]),d(n.parent)):f(n.error||"Failed to load folder")}catch(t){f(`Failed to connect: ${t}`)}finally{p(!1)}}else f("Orchestrator URL not configured")},[i]);Pt.useEffect(()=>{e&&x(r)},[e,r,x]);const b=async()=>{if(g.trim())try{const e=await fetch(`${i}/api/create-folder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_path:o||"C:/",folder_name:g.trim()})}),t=await e.json();if(!t.success)return void f(t.message);_(!1),v("");const n=t.created_path.replace(/\//g,"\\");s(n),await x(n)}catch(e){f(`Failed to create folder: ${e}`)}};return e?Ut.jsx("div",{className:"folder-browser-overlay",onClick:t,children:Ut.jsxs("div",{className:"folder-browser-modal",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"folder-browser-header",children:[Ut.jsx("h3",{children:a}),Ut.jsx("button",{className:"close-btn",onClick:t,children:Ut.jsx($C,{size:18})})]}),Ut.jsxs("div",{className:"folder-browser-toolbar",children:[Ut.jsx("button",{onClick:()=>u&&x(u),disabled:!u||h,title:"Go to parent folder",children:Ut.jsx(QE,{size:18})}),Ut.jsx("input",{type:"text",value:o,onChange:e=>s(e.target.value),onKeyDown:e=>"Enter"===e.key&&x(o),placeholder:"Enter path..."}),Ut.jsx("button",{onClick:()=>x(o),disabled:h,title:"Refresh",children:Ut.jsx(IC,{size:18,className:h?"spinning":""})})]}),Ut.jsxs("div",{className:"folder-browser-content",children:[m&&Ut.jsx("div",{className:"folder-error",children:m}),h?Ut.jsx("div",{className:"folder-loading",children:"Loading..."}):Ut.jsxs("div",{className:"folder-list",children:[0===l.length&&!m&&Ut.jsx("div",{className:"folder-empty",children:"No folders found"}),l.map(e=>Ut.jsxs("div",{className:"folder-item",onDoubleClick:()=>x(e.path),children:["drive"===e.type?Ut.jsx(vC,{size:18}):Ut.jsx(fC,{size:18}),Ut.jsx("span",{children:e.name})]},e.path))]})]}),y&&Ut.jsxs("div",{className:"new-folder-input",children:[Ut.jsx("input",{type:"text",value:g,onChange:e=>v(e.target.value),placeholder:"New folder name...",onKeyDown:e=>"Enter"===e.key&&b(),autoFocus:!0}),Ut.jsx("button",{onClick:b,children:"Create"}),Ut.jsx("button",{onClick:()=>_(!1),children:"Cancel"})]}),Ut.jsxs("div",{className:"folder-browser-footer",children:[Ut.jsxs("div",{className:"folder-path-display",children:[Ut.jsx(pC,{size:16}),Ut.jsx("span",{children:o||"No folder selected"})]}),Ut.jsxs("div",{className:"folder-actions",children:[Ut.jsx("button",{className:"new-folder-btn",onClick:()=>_(!0),disabled:!o,children:"New Folder"}),Ut.jsx("button",{className:"cancel-btn",onClick:t,children:"Cancel"}),Ut.jsxs("button",{className:"select-btn",onClick:()=>{o&&(n(o),t())},disabled:!o,children:[Ut.jsx(ZE,{size:16}),"Select"]})]})]})]})}):null}function yT({isOpen:e,filename:t,onConfirm:n,onCancel:i,onSuppressForSession:r}){const[a,o]=Pt.useState(!1);return e?Ut.jsx("div",{className:"modal-overlay delete-confirm-overlay",children:Ut.jsxs("div",{className:"delete-confirm-dialog",children:[Ut.jsx("h3",{children:"Delete Image?"}),Ut.jsx("p",{children:"Are you sure you want to permanently delete:"}),Ut.jsx("p",{className:"delete-filename",children:t}),Ut.jsx("p",{className:"delete-warning",children:"This will remove the file from disk and cannot be undone."}),Ut.jsxs("label",{className:"dont-ask-checkbox",children:[Ut.jsx("input",{type:"checkbox",checked:a,onChange:e=>o(e.target.checked)}),Ut.jsx("span",{children:"Don't ask again this session"})]}),Ut.jsxs("div",{className:"dialog-actions",children:[Ut.jsx("button",{className:"cancel-btn",onClick:i,children:"Cancel"}),Ut.jsx("button",{className:"delete-btn",onClick:()=>{a&&r(),n()},children:"Delete"})]})]})}):null}function _T(){}function xT(){}const bT=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,ST=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,wT={};function MT(e,t){return(wT.jsx?ST:bT).test(e)}const ET=/[ \t\n\f\r]/g;function CT(e){return""===e.replace(ET,"")}class TT{constructor(e,t,n){this.normal=t,this.property=e,n&&(this.space=n)}}function PT(e,t){const n={},i={};for(const r of e)Object.assign(n,r.property),Object.assign(i,r.normal);return new TT(n,i,t)}function kT(e){return e.toLowerCase()}TT.prototype.normal={},TT.prototype.property={},TT.prototype.space=void 0;class AT{constructor(e,t){this.attribute=t,this.property=e}}AT.prototype.attribute="",AT.prototype.booleanish=!1,AT.prototype.boolean=!1,AT.prototype.commaOrSpaceSeparated=!1,AT.prototype.commaSeparated=!1,AT.prototype.defined=!1,AT.prototype.mustUseProperty=!1,AT.prototype.number=!1,AT.prototype.overloadedBoolean=!1,AT.prototype.property="",AT.prototype.spaceSeparated=!1,AT.prototype.space=void 0;let NT=0;const RT=FT(),LT=FT(),IT=FT(),jT=FT(),DT=FT(),UT=FT(),OT=FT();function FT(){return 2**++NT}const zT=Object.freeze(Object.defineProperty({__proto__:null,boolean:RT,booleanish:LT,commaOrSpaceSeparated:OT,commaSeparated:UT,number:jT,overloadedBoolean:IT,spaceSeparated:DT},Symbol.toStringTag,{value:"Module"})),BT=Object.keys(zT);class HT extends AT{constructor(e,t,n,i){let r=-1;if(super(e,t),VT(this,"space",i),"number"==typeof n)for(;++r<BT.length;){const e=BT[r];VT(this,BT[r],(n&zT[e])===zT[e])}}}function VT(e,t,n){n&&(e[t]=n)}function WT(e){const t={},n={};for(const[i,r]of Object.entries(e.properties)){const a=new HT(i,e.transform(e.attributes||{},i),r,e.space);e.mustUseProperty&&e.mustUseProperty.includes(i)&&(a.mustUseProperty=!0),t[i]=a,n[kT(i)]=i,n[kT(a.attribute)]=i}return new TT(t,n,e.space)}HT.prototype.defined=!0;const GT=WT({properties:{ariaActiveDescendant:null,ariaAtomic:LT,ariaAutoComplete:null,ariaBusy:LT,ariaChecked:LT,ariaColCount:jT,ariaColIndex:jT,ariaColSpan:jT,ariaControls:DT,ariaCurrent:null,ariaDescribedBy:DT,ariaDetails:null,ariaDisabled:LT,ariaDropEffect:DT,ariaErrorMessage:null,ariaExpanded:LT,ariaFlowTo:DT,ariaGrabbed:LT,ariaHasPopup:null,ariaHidden:LT,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:DT,ariaLevel:jT,ariaLive:null,ariaModal:LT,ariaMultiLine:LT,ariaMultiSelectable:LT,ariaOrientation:null,ariaOwns:DT,ariaPlaceholder:null,ariaPosInSet:jT,ariaPressed:LT,ariaReadOnly:LT,ariaRelevant:null,ariaRequired:LT,ariaRoleDescription:DT,ariaRowCount:jT,ariaRowIndex:jT,ariaRowSpan:jT,ariaSelected:LT,ariaSetSize:jT,ariaSort:null,ariaValueMax:jT,ariaValueMin:jT,ariaValueNow:jT,ariaValueText:null,role:null},transform:(e,t)=>"role"===t?t:"aria-"+t.slice(4).toLowerCase()});function $T(e,t){return t in e?e[t]:t}function XT(e,t){return $T(e,t.toLowerCase())}const qT=WT({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:UT,acceptCharset:DT,accessKey:DT,action:null,allow:null,allowFullScreen:RT,allowPaymentRequest:RT,allowUserMedia:RT,alt:null,as:null,async:RT,autoCapitalize:null,autoComplete:DT,autoFocus:RT,autoPlay:RT,blocking:DT,capture:null,charSet:null,checked:RT,cite:null,className:DT,cols:jT,colSpan:null,content:null,contentEditable:LT,controls:RT,controlsList:DT,coords:jT|UT,crossOrigin:null,data:null,dateTime:null,decoding:null,default:RT,defer:RT,dir:null,dirName:null,disabled:RT,download:IT,draggable:LT,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:RT,formTarget:null,headers:DT,height:jT,hidden:IT,high:jT,href:null,hrefLang:null,htmlFor:DT,httpEquiv:DT,id:null,imageSizes:null,imageSrcSet:null,inert:RT,inputMode:null,integrity:null,is:null,isMap:RT,itemId:null,itemProp:DT,itemRef:DT,itemScope:RT,itemType:DT,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:RT,low:jT,manifest:null,max:null,maxLength:jT,media:null,method:null,min:null,minLength:jT,multiple:RT,muted:RT,name:null,nonce:null,noModule:RT,noValidate:RT,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:RT,optimum:jT,pattern:null,ping:DT,placeholder:null,playsInline:RT,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:RT,referrerPolicy:null,rel:DT,required:RT,reversed:RT,rows:jT,rowSpan:jT,sandbox:DT,scope:null,scoped:RT,seamless:RT,selected:RT,shadowRootClonable:RT,shadowRootDelegatesFocus:RT,shadowRootMode:null,shape:null,size:jT,sizes:null,slot:null,span:jT,spellCheck:LT,src:null,srcDoc:null,srcLang:null,srcSet:null,start:jT,step:null,style:null,tabIndex:jT,target:null,title:null,translate:null,type:null,typeMustMatch:RT,useMap:null,value:LT,width:jT,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:DT,axis:null,background:null,bgColor:null,border:jT,borderColor:null,bottomMargin:jT,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:RT,declare:RT,event:null,face:null,frame:null,frameBorder:null,hSpace:jT,leftMargin:jT,link:null,longDesc:null,lowSrc:null,marginHeight:jT,marginWidth:jT,noResize:RT,noHref:RT,noShade:RT,noWrap:RT,object:null,profile:null,prompt:null,rev:null,rightMargin:jT,rules:null,scheme:null,scrolling:LT,standby:null,summary:null,text:null,topMargin:jT,valueType:null,version:null,vAlign:null,vLink:null,vSpace:jT,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:RT,disableRemotePlayback:RT,prefix:null,property:null,results:jT,security:null,unselectable:null},space:"html",transform:XT}),KT=WT({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:OT,accentHeight:jT,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:jT,amplitude:jT,arabicForm:null,ascent:jT,attributeName:null,attributeType:null,azimuth:jT,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:jT,by:null,calcMode:null,capHeight:jT,className:DT,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:jT,diffuseConstant:jT,direction:null,display:null,dur:null,divisor:jT,dominantBaseline:null,download:RT,dx:null,dy:null,edgeMode:null,editable:null,elevation:jT,enableBackground:null,end:null,event:null,exponent:jT,externalResourcesRequired:null,fill:null,fillOpacity:jT,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:UT,g2:UT,glyphName:UT,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:jT,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:jT,horizOriginX:jT,horizOriginY:jT,id:null,ideographic:jT,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:jT,k:jT,k1:jT,k2:jT,k3:jT,k4:jT,kernelMatrix:OT,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:jT,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:jT,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:jT,overlineThickness:jT,paintOrder:null,panose1:null,path:null,pathLength:jT,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:DT,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:jT,pointsAtY:jT,pointsAtZ:jT,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:OT,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:OT,rev:OT,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:OT,requiredFeatures:OT,requiredFonts:OT,requiredFormats:OT,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:jT,specularExponent:jT,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:jT,strikethroughThickness:jT,string:null,stroke:null,strokeDashArray:OT,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:jT,strokeOpacity:jT,strokeWidth:null,style:null,surfaceScale:jT,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:OT,tabIndex:jT,tableValues:null,target:null,targetX:jT,targetY:jT,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:OT,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:jT,underlineThickness:jT,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:jT,values:null,vAlphabetic:jT,vMathematical:jT,vectorEffect:null,vHanging:jT,vIdeographic:jT,version:null,vertAdvY:jT,vertOriginX:jT,vertOriginY:jT,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:jT,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:$T}),YT=WT({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform:(e,t)=>"xlink:"+t.slice(5).toLowerCase()}),ZT=WT({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:XT}),JT=WT({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform:(e,t)=>"xml:"+t.slice(3).toLowerCase()}),QT={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},eP=/[A-Z]/g,tP=/-[a-z]/g,nP=/^data[-\w.:]+$/i;function iP(e){return"-"+e.toLowerCase()}function rP(e){return e.charAt(1).toUpperCase()}const aP=PT([GT,qT,YT,ZT,JT],"html"),oP=PT([GT,KT,YT,ZT,JT],"svg");var sP={},lP=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,cP=/\n/g,uP=/^\s*/,dP=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,hP=/^:\s*/,pP=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,mP=/^[;\s]*/,fP=/^\s+|\s+$/g,gP="";function vP(e){return e?e.replace(fP,gP):gP}var yP=function(e,t){if("string"!=typeof e)throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var n=1,i=1;function r(e){var t=e.match(cP);t&&(n+=t.length);var r=e.lastIndexOf("\n");i=~r?e.length-r:i+e.length}function a(){var e={line:n,column:i};return function(t){return t.position=new o(e),c(),t}}function o(e){this.start=e,this.end={line:n,column:i},this.source=t.source}function s(r){var a=new Error(t.source+":"+n+":"+i+": "+r);if(a.reason=r,a.filename=t.source,a.line=n,a.column=i,a.source=e,!t.silent)throw a}function l(t){var n=t.exec(e);if(n){var i=n[0];return r(i),e=e.slice(i.length),n}}function c(){l(uP)}function u(e){var t;for(e=e||[];t=d();)!1!==t&&e.push(t);return e}function d(){var t=a();if("/"==e.charAt(0)&&"*"==e.charAt(1)){for(var n=2;gP!=e.charAt(n)&&("*"!=e.charAt(n)||"/"!=e.charAt(n+1));)++n;if(n+=2,gP===e.charAt(n-1))return s("End of comment missing");var o=e.slice(2,n-2);return i+=2,r(o),e=e.slice(n),i+=2,t({type:"comment",comment:o})}}function h(){var e=a(),t=l(dP);if(t){if(d(),!l(hP))return s("property missing ':'");var n=l(pP),i=e({type:"declaration",property:vP(t[0].replace(lP,gP)),value:n?vP(n[0].replace(lP,gP)):gP});return l(mP),i}}return o.prototype.content=e,c(),function(){var e,t=[];for(u(t);e=h();)!1!==e&&(t.push(e),u(t));return t}()},_P=He&&He.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(sP,"__esModule",{value:!0}),sP.default=function(e,t){let n=null;if(!e||"string"!=typeof e)return n;const i=(0,xP.default)(e),r="function"==typeof t;return i.forEach(e=>{if("declaration"!==e.type)return;const{property:i,value:a}=e;r?t(i,a,e):a&&(n=n||{},n[i]=a)}),n};const xP=_P(yP);var bP={};Object.defineProperty(bP,"__esModule",{value:!0}),bP.camelCase=void 0;var SP=/^--[a-zA-Z0-9_-]+$/,wP=/-([a-z])/g,MP=/^[^-]+$/,EP=/^-(webkit|moz|ms|o|khtml)-/,CP=/^-(ms)-/,TP=function(e,t){return t.toUpperCase()},PP=function(e,t){return"".concat(t,"-")};bP.camelCase=function(e,t){return void 0===t&&(t={}),function(e){return!e||MP.test(e)||SP.test(e)}(e)?e:(e=e.toLowerCase(),(e=t.reactCompat?e.replace(CP,PP):e.replace(EP,PP)).replace(wP,TP))};var kP=(He&&He.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(sP),AP=bP;function NP(e,t){var n={};return e&&"string"==typeof e?((0,kP.default)(e,function(e,i){e&&i&&(n[(0,AP.camelCase)(e,t)]=i)}),n):n}NP.default=NP;const RP=Ve(NP),LP=jP("end"),IP=jP("start");function jP(e){return function(t){const n=t&&t.position&&t.position[e]||{};if("number"==typeof n.line&&n.line>0&&"number"==typeof n.column&&n.column>0)return{line:n.line,column:n.column,offset:"number"==typeof n.offset&&n.offset>-1?n.offset:void 0}}}function DP(e){return e&&"object"==typeof e?"position"in e||"type"in e?OP(e.position):"start"in e||"end"in e?OP(e):"line"in e||"column"in e?UP(e):"":""}function UP(e){return FP(e&&e.line)+":"+FP(e&&e.column)}function OP(e){return UP(e&&e.start)+"-"+UP(e&&e.end)}function FP(e){return e&&"number"==typeof e?e:1}class zP extends Error{constructor(e,t,n){super(),"string"==typeof t&&(n=t,t=void 0);let i="",r={},a=!1;if(t&&(r="line"in t&&"column"in t||"start"in t&&"end"in t?{place:t}:"type"in t?{ancestors:[t],place:t.position}:{...t}),"string"==typeof e?i=e:!r.cause&&e&&(a=!0,i=e.message,r.cause=e),!r.ruleId&&!r.source&&"string"==typeof n){const e=n.indexOf(":");-1===e?r.ruleId=n:(r.source=n.slice(0,e),r.ruleId=n.slice(e+1))}if(!r.place&&r.ancestors&&r.ancestors){const e=r.ancestors[r.ancestors.length-1];e&&(r.place=e.position)}const o=r.place&&"start"in r.place?r.place.start:r.place;this.ancestors=r.ancestors||void 0,this.cause=r.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=i,this.line=o?o.line:void 0,this.name=DP(r.place)||"1:1",this.place=r.place||void 0,this.reason=this.message,this.ruleId=r.ruleId||void 0,this.source=r.source||void 0,this.stack=a&&r.cause&&"string"==typeof r.cause.stack?r.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}zP.prototype.file="",zP.prototype.name="",zP.prototype.reason="",zP.prototype.message="",zP.prototype.stack="",zP.prototype.column=void 0,zP.prototype.line=void 0,zP.prototype.ancestors=void 0,zP.prototype.cause=void 0,zP.prototype.fatal=void 0,zP.prototype.place=void 0,zP.prototype.ruleId=void 0,zP.prototype.source=void 0;const BP={}.hasOwnProperty,HP=new Map,VP=/[A-Z]/g,WP=new Set(["table","tbody","thead","tfoot","tr"]),GP=new Set(["td","th"]),$P="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function XP(e,t){if(!t||void 0===t.Fragment)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let i;if(t.development){if("function"!=typeof t.jsxDEV)throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=function(e,t){return n;function n(n,i,r,a){const o=Array.isArray(r.children),s=IP(n);return t(i,r,a,o,{columnNumber:s?s.column-1:void 0,fileName:e,lineNumber:s?s.line:void 0},void 0)}}(n,t.jsxDEV)}else{if("function"!=typeof t.jsx)throw new TypeError("Expected `jsx` in production options");if("function"!=typeof t.jsxs)throw new TypeError("Expected `jsxs` in production options");i=function(e,t,n){return i;function i(e,i,r,a){const o=Array.isArray(r.children)?n:t;return a?o(i,r,a):o(i,r)}}(0,t.jsx,t.jsxs)}const r={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:i,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:!1!==t.passKeys,passNode:t.passNode||!1,schema:"svg"===t.space?oP:aP,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==t.tableCellAlignToStyle},a=qP(r,e,void 0);return a&&"string"!=typeof a?a:r.create(e,r.Fragment,{children:a||void 0},void 0)}function qP(e,t,n){return"element"===t.type?function(e,t,n){const i=e.schema;let r=i;"svg"===t.tagName.toLowerCase()&&"html"===i.space&&(r=oP,e.schema=r);e.ancestors.push(t);const a=QP(e,t.tagName,!1),o=function(e,t){const n={};let i,r;for(r in t.properties)if("children"!==r&&BP.call(t.properties,r)){const a=JP(e,r,t.properties[r]);if(a){const[r,o]=a;e.tableCellAlignToStyle&&"align"===r&&"string"==typeof o&&GP.has(t.tagName)?i=o:n[r]=o}}if(i){(n.style||(n.style={}))["css"===e.stylePropertyNameCase?"text-align":"textAlign"]=i}return n}(e,t);let s=ZP(e,t);WP.has(t.tagName)&&(s=s.filter(function(e){return"string"!=typeof e||!("object"==typeof(t=e)?"text"===t.type&&CT(t.value):CT(t));var t}));return KP(e,o,a,t),YP(o,s),e.ancestors.pop(),e.schema=i,e.create(t,a,o,n)}(e,t,n):"mdxFlowExpression"===t.type||"mdxTextExpression"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater){const n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}ek(e,t.position)}(e,t):"mdxJsxFlowElement"===t.type||"mdxJsxTextElement"===t.type?function(e,t,n){const i=e.schema;let r=i;"svg"===t.name&&"html"===i.space&&(r=oP,e.schema=r);e.ancestors.push(t);const a=null===t.name?e.Fragment:QP(e,t.name,!0),o=function(e,t){const n={};for(const i of t.attributes)if("mdxJsxExpressionAttribute"===i.type)if(i.data&&i.data.estree&&e.evaluater){const t=i.data.estree.body[0];_T(t.type);const r=t.expression;_T(r.type);const a=r.properties[0];_T(a.type),Object.assign(n,e.evaluater.evaluateExpression(a.argument))}else ek(e,t.position);else{const r=i.name;let a;if(i.value&&"object"==typeof i.value)if(i.value.data&&i.value.data.estree&&e.evaluater){const t=i.value.data.estree.body[0];_T(t.type),a=e.evaluater.evaluateExpression(t.expression)}else ek(e,t.position);else a=null===i.value||i.value;n[r]=a}return n}(e,t),s=ZP(e,t);return KP(e,o,a,t),YP(o,s),e.ancestors.pop(),e.schema=i,e.create(t,a,o,n)}(e,t,n):"mdxjsEsm"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);ek(e,t.position)}(e,t):"root"===t.type?function(e,t,n){const i={};return YP(i,ZP(e,t)),e.create(t,e.Fragment,i,n)}(e,t,n):"text"===t.type?function(e,t){return t.value}(0,t):void 0}function KP(e,t,n,i){"string"!=typeof n&&n!==e.Fragment&&e.passNode&&(t.node=i)}function YP(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function ZP(e,t){const n=[];let i=-1;const r=e.passKeys?new Map:HP;for(;++i<t.children.length;){const a=t.children[i];let o;if(e.passKeys){const e="element"===a.type?a.tagName:"mdxJsxFlowElement"===a.type||"mdxJsxTextElement"===a.type?a.name:void 0;if(e){const t=r.get(e)||0;o=e+"-"+t,r.set(e,t+1)}}const s=qP(e,a,o);void 0!==s&&n.push(s)}return n}function JP(e,t,n){const i=function(e,t){const n=kT(t);let i=t,r=AT;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&"data"===n.slice(0,4)&&nP.test(t)){if("-"===t.charAt(4)){const e=t.slice(5).replace(tP,rP);i="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{const e=t.slice(4);if(!tP.test(e)){let n=e.replace(eP,iP);"-"!==n.charAt(0)&&(n="-"+n),t="data"+n}}r=HT}return new r(i,t)}(e.schema,t);if(!(null==n||"number"==typeof n&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?function(e){const t={};return(""===e[e.length-1]?[...e,""]:e).join((t.padRight?" ":"")+","+(!1===t.padLeft?"":" ")).trim()}(n):n.join(" ").trim()),"style"===i.property){let t="object"==typeof n?n:function(e,t){try{return RP(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const t=n,i=new zP("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:t,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=e.filePath||void 0,i.url=$P+"#cannot-parse-style-attribute",i}}(e,String(n));return"css"===e.stylePropertyNameCase&&(t=function(e){const t={};let n;for(n in e)BP.call(e,n)&&(t[tk(n)]=e[n]);return t}(t)),["style",t]}return["react"===e.elementAttributeNameCase&&i.space?QT[i.property]||i.property:i.attribute,n]}}function QP(e,t,n){let i;if(n)if(t.includes(".")){const e=t.split(".");let n,r=-1;for(;++r<e.length;){const t=MT(e[r])?{type:"Identifier",name:e[r]}:{type:"Literal",value:e[r]};n=n?{type:"MemberExpression",object:n,property:t,computed:Boolean(r&&"Literal"===t.type),optional:!1}:t}i=n}else i=MT(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};else i={type:"Literal",value:t};if("Literal"===i.type){const t=i.value;return BP.call(e.components,t)?e.components[t]:t}if(e.evaluater)return e.evaluater.evaluateExpression(i);ek(e)}function ek(e,t){const n=new zP("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=$P+"#cannot-handle-mdx-estrees-without-createevaluater",n}function tk(e){let t=e.replace(VP,nk);return"ms-"===t.slice(0,3)&&(t="-"+t),t}function nk(e){return"-"+e.toLowerCase()}const ik={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},rk={};function ak(e,t,n){if(function(e){return Boolean(e&&"object"==typeof e)}(e)){if("value"in e)return"html"!==e.type||n?e.value:"";if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return ok(e.children,t,n)}return Array.isArray(e)?ok(e,t,n):""}function ok(e,t,n){const i=[];let r=-1;for(;++r<e.length;)i[r]=ak(e[r],t,n);return i.join("")}const sk=document.createElement("i");function lk(e){const t="&"+e+";";sk.innerHTML=t;const n=sk.textContent;return(59!==n.charCodeAt(n.length-1)||"semi"===e)&&(n!==t&&n)}function ck(e,t,n,i){const r=e.length;let a,o=0;if(t=t<0?-t>r?0:r+t:t>r?r:t,n=n>0?n:0,i.length<1e4)a=Array.from(i),a.unshift(t,n),e.splice(...a);else for(n&&e.splice(t,n);o<i.length;)a=i.slice(o,o+1e4),a.unshift(t,0),e.splice(...a),o+=1e4,t+=1e4}function uk(e,t){return e.length>0?(ck(e,e.length,0,t),e):t}const dk={}.hasOwnProperty;function hk(e,t){let n;for(n in t){const i=(dk.call(e,n)?e[n]:void 0)||(e[n]={}),r=t[n];let a;if(r)for(a in r){dk.call(i,a)||(i[a]=[]);const e=r[a];pk(i[a],Array.isArray(e)?e:e?[e]:[])}}}function pk(e,t){let n=-1;const i=[];for(;++n<t.length;)("after"===t[n].add?e:i).push(t[n]);ck(e,0,0,i)}function mk(e,t){const n=Number.parseInt(e,t);return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||!(65535&~n)||65534==(65535&n)||n>1114111?"":String.fromCodePoint(n)}function fk(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const gk=Pk(/[A-Za-z]/),vk=Pk(/[\dA-Za-z]/),yk=Pk(/[#-'*+\--9=?A-Z^-~]/);function _k(e){return null!==e&&(e<32||127===e)}const xk=Pk(/\d/),bk=Pk(/[\dA-Fa-f]/),Sk=Pk(/[!-/:-@[-`{-~]/);function wk(e){return null!==e&&e<-2}function Mk(e){return null!==e&&(e<0||32===e)}function Ek(e){return-2===e||-1===e||32===e}const Ck=Pk(new RegExp("\\p{P}|\\p{S}","u")),Tk=Pk(/\s/);function Pk(e){return function(t){return null!==t&&t>-1&&e.test(String.fromCharCode(t))}}function kk(e){const t=[];let n=-1,i=0,r=0;for(;++n<e.length;){const a=e.charCodeAt(n);let o="";if(37===a&&vk(e.charCodeAt(n+1))&&vk(e.charCodeAt(n+2)))r=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(o=String.fromCharCode(a));else if(a>55295&&a<57344){const t=e.charCodeAt(n+1);a<56320&&t>56319&&t<57344?(o=String.fromCharCode(a,t),r=1):o=""}else o=String.fromCharCode(a);o&&(t.push(e.slice(i,n),encodeURIComponent(o)),i=n+r+1,o=""),r&&(n+=r,r=0)}return t.join("")+e.slice(i)}function Ak(e,t,n,i){const r=i?i-1:Number.POSITIVE_INFINITY;let a=0;return function(i){if(Ek(i))return e.enter(n),o(i);return t(i)};function o(i){return Ek(i)&&a++<r?(e.consume(i),o):(e.exit(n),t(i))}}const Nk={tokenize:function(e){const t=e.attempt(this.parser.constructs.contentInitial,function(n){if(null===n)return void e.consume(n);return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),Ak(e,t,"linePrefix")},function(t){return e.enter("paragraph"),i(t)});let n;return t;function i(t){const i=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=i),n=i,r(t)}function r(t){return null===t?(e.exit("chunkText"),e.exit("paragraph"),void e.consume(t)):wk(t)?(e.consume(t),e.exit("chunkText"),i):(e.consume(t),r)}}};const Rk={tokenize:function(e){const t=this,n=[];let i,r,a,o=0;return s;function s(i){if(o<n.length){const r=n[o];return t.containerState=r[1],e.attempt(r[0].continuation,l,c)(i)}return c(i)}function l(e){if(o++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,i&&y();const n=t.events.length;let r,a=n;for(;a--;)if("exit"===t.events[a][0]&&"chunkFlow"===t.events[a][1].type){r=t.events[a][1].end;break}v(o);let s=n;for(;s<t.events.length;)t.events[s][1].end={...r},s++;return ck(t.events,a+1,0,t.events.slice(n)),t.events.length=s,c(e)}return s(e)}function c(r){if(o===n.length){if(!i)return h(r);if(i.currentConstruct&&i.currentConstruct.concrete)return m(r);t.interrupt=Boolean(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Lk,u,d)(r)}function u(e){return i&&y(),v(o),h(e)}function d(e){return t.parser.lazy[t.now().line]=o!==n.length,a=t.now().offset,m(e)}function h(n){return t.containerState={},e.attempt(Lk,p,m)(n)}function p(e){return o++,n.push([t.currentConstruct,t.containerState]),h(e)}function m(n){return null===n?(i&&y(),v(0),void e.consume(n)):(i=i||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:r}),f(n))}function f(n){return null===n?(g(e.exit("chunkFlow"),!0),v(0),void e.consume(n)):wk(n)?(e.consume(n),g(e.exit("chunkFlow")),o=0,t.interrupt=void 0,s):(e.consume(n),f)}function g(e,n){const s=t.sliceStream(e);if(n&&s.push(null),e.previous=r,r&&(r.next=e),r=e,i.defineSkip(e.start),i.write(s),t.parser.lazy[e.start.line]){let e=i.events.length;for(;e--;)if(i.events[e][1].start.offset<a&&(!i.events[e][1].end||i.events[e][1].end.offset>a))return;const n=t.events.length;let r,s,l=n;for(;l--;)if("exit"===t.events[l][0]&&"chunkFlow"===t.events[l][1].type){if(r){s=t.events[l][1].end;break}r=!0}for(v(o),e=n;e<t.events.length;)t.events[e][1].end={...s},e++;ck(t.events,l+1,0,t.events.slice(n)),t.events.length=e}}function v(i){let r=n.length;for(;r-- >i;){const i=n[r];t.containerState=i[1],i[0].exit.call(t,e)}n.length=i}function y(){i.write([null]),r=void 0,i=void 0,t.containerState._closeFlow=void 0}}},Lk={tokenize:function(e,t,n){return Ak(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}};function Ik(e){return null===e||Mk(e)||Tk(e)?1:Ck(e)?2:void 0}function jk(e,t,n){const i=[];let r=-1;for(;++r<e.length;){const a=e[r].resolveAll;a&&!i.includes(a)&&(t=a(t,n),i.push(a))}return t}const Dk={name:"attention",resolveAll:function(e,t){let n,i,r,a,o,s,l,c,u=-1;for(;++u<e.length;)if("enter"===e[u][0]&&"attentionSequence"===e[u][1].type&&e[u][1]._close)for(n=u;n--;)if("exit"===e[n][0]&&"attentionSequence"===e[n][1].type&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[u][1]).charCodeAt(0)){if((e[n][1]._close||e[u][1]._open)&&(e[u][1].end.offset-e[u][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[u][1].end.offset-e[u][1].start.offset)%3))continue;s=e[n][1].end.offset-e[n][1].start.offset>1&&e[u][1].end.offset-e[u][1].start.offset>1?2:1;const d={...e[n][1].end},h={...e[u][1].start};Uk(d,-s),Uk(h,s),a={type:s>1?"strongSequence":"emphasisSequence",start:d,end:{...e[n][1].end}},o={type:s>1?"strongSequence":"emphasisSequence",start:{...e[u][1].start},end:h},r={type:s>1?"strongText":"emphasisText",start:{...e[n][1].end},end:{...e[u][1].start}},i={type:s>1?"strong":"emphasis",start:{...a.start},end:{...o.end}},e[n][1].end={...a.start},e[u][1].start={...o.end},l=[],e[n][1].end.offset-e[n][1].start.offset&&(l=uk(l,[["enter",e[n][1],t],["exit",e[n][1],t]])),l=uk(l,[["enter",i,t],["enter",a,t],["exit",a,t],["enter",r,t]]),l=uk(l,jk(t.parser.constructs.insideSpan.null,e.slice(n+1,u),t)),l=uk(l,[["exit",r,t],["enter",o,t],["exit",o,t],["exit",i,t]]),e[u][1].end.offset-e[u][1].start.offset?(c=2,l=uk(l,[["enter",e[u][1],t],["exit",e[u][1],t]])):c=0,ck(e,n-1,u-n+3,l),u=n+l.length-c-2;break}u=-1;for(;++u<e.length;)"attentionSequence"===e[u][1].type&&(e[u][1].type="data");return e},tokenize:function(e,t){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,r=Ik(i);let a;return function(t){return a=t,e.enter("attentionSequence"),o(t)};function o(s){if(s===a)return e.consume(s),o;const l=e.exit("attentionSequence"),c=Ik(s),u=!c||2===c&&r||n.includes(s),d=!r||2===r&&c||n.includes(i);return l._open=Boolean(42===a?u:u&&(r||!d)),l._close=Boolean(42===a?d:d&&(c||!u)),t(s)}}};function Uk(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const Ok={name:"autolink",tokenize:function(e,t,n){let i=0;return function(t){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(t),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),r};function r(t){return gk(t)?(e.consume(t),a):64===t?n(t):l(t)}function a(e){return 43===e||45===e||46===e||vk(e)?(i=1,o(e)):l(e)}function o(t){return 58===t?(e.consume(t),i=0,s):(43===t||45===t||46===t||vk(t))&&i++<32?(e.consume(t),o):(i=0,l(t))}function s(i){return 62===i?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(i),e.exit("autolinkMarker"),e.exit("autolink"),t):null===i||32===i||60===i||_k(i)?n(i):(e.consume(i),s)}function l(t){return 64===t?(e.consume(t),c):yk(t)?(e.consume(t),l):n(t)}function c(e){return vk(e)?u(e):n(e)}function u(n){return 46===n?(e.consume(n),i=0,c):62===n?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(n),e.exit("autolinkMarker"),e.exit("autolink"),t):d(n)}function d(t){if((45===t||vk(t))&&i++<63){const n=45===t?d:u;return e.consume(t),n}return n(t)}}};const Fk={partial:!0,tokenize:function(e,t,n){return function(t){return Ek(t)?Ak(e,i,"linePrefix")(t):i(t)};function i(e){return null===e||wk(e)?t(e):n(e)}}};const zk={continuation:{tokenize:function(e,t,n){const i=this;return function(t){if(Ek(t))return Ak(e,r,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t);return r(t)};function r(i){return e.attempt(zk,t,n)(i)}}},exit:function(e){e.exit("blockQuote")},name:"blockQuote",tokenize:function(e,t,n){const i=this;return function(t){if(62===t){const n=i.containerState;return n.open||(e.enter("blockQuote",{_container:!0}),n.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(t),e.exit("blockQuoteMarker"),r}return n(t)};function r(n){return Ek(n)?(e.enter("blockQuotePrefixWhitespace"),e.consume(n),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(n))}}};const Bk={name:"characterEscape",tokenize:function(e,t,n){return function(t){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(t),e.exit("escapeMarker"),i};function i(i){return Sk(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(i)}}};const Hk={name:"characterReference",tokenize:function(e,t,n){const i=this;let r,a,o=0;return function(t){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(t),e.exit("characterReferenceMarker"),s};function s(t){return 35===t?(e.enter("characterReferenceMarkerNumeric"),e.consume(t),e.exit("characterReferenceMarkerNumeric"),l):(e.enter("characterReferenceValue"),r=31,a=vk,c(t))}function l(t){return 88===t||120===t?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(t),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),r=6,a=bk,c):(e.enter("characterReferenceValue"),r=7,a=xk,c(t))}function c(s){if(59===s&&o){const r=e.exit("characterReferenceValue");return a!==vk||lk(i.sliceSerialize(r))?(e.enter("characterReferenceMarker"),e.consume(s),e.exit("characterReferenceMarker"),e.exit("characterReference"),t):n(s)}return a(s)&&o++<r?(e.consume(s),c):n(s)}}};const Vk={partial:!0,tokenize:function(e,t,n){const i=this;return function(t){if(null===t)return n(t);return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),r};function r(e){return i.parser.lazy[i.now().line]?n(e):t(e)}}},Wk={concrete:!0,name:"codeFenced",tokenize:function(e,t,n){const i=this,r={partial:!0,tokenize:function(e,t,n){let r=0;return o;function o(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),l}function l(t){return e.enter("codeFencedFence"),Ek(t)?Ak(e,c,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):c(t)}function c(t){return t===a?(e.enter("codeFencedFenceSequence"),u(t)):n(t)}function u(t){return t===a?(r++,e.consume(t),u):r>=s?(e.exit("codeFencedFenceSequence"),Ek(t)?Ak(e,d,"whitespace")(t):d(t)):n(t)}function d(i){return null===i||wk(i)?(e.exit("codeFencedFence"),t(i)):n(i)}}};let a,o=0,s=0;return function(t){return function(t){const n=i.events[i.events.length-1];return o=n&&"linePrefix"===n[1].type?n[2].sliceSerialize(n[1],!0).length:0,a=t,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),l(t)}(t)};function l(t){return t===a?(s++,e.consume(t),l):s<3?n(t):(e.exit("codeFencedFenceSequence"),Ek(t)?Ak(e,c,"whitespace")(t):c(t))}function c(n){return null===n||wk(n)?(e.exit("codeFencedFence"),i.interrupt?t(n):e.check(Vk,p,y)(n)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),u(n))}function u(t){return null===t||wk(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),c(t)):Ek(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),Ak(e,d,"whitespace")(t)):96===t&&t===a?n(t):(e.consume(t),u)}function d(t){return null===t||wk(t)?c(t):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),h(t))}function h(t){return null===t||wk(t)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),c(t)):96===t&&t===a?n(t):(e.consume(t),h)}function p(t){return e.attempt(r,y,m)(t)}function m(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),f}function f(t){return o>0&&Ek(t)?Ak(e,g,"linePrefix",o+1)(t):g(t)}function g(t){return null===t||wk(t)?e.check(Vk,p,y)(t):(e.enter("codeFlowValue"),v(t))}function v(t){return null===t||wk(t)?(e.exit("codeFlowValue"),g(t)):(e.consume(t),v)}function y(n){return e.exit("codeFenced"),t(n)}}};const Gk={name:"codeIndented",tokenize:function(e,t,n){const i=this;return function(t){return e.enter("codeIndented"),Ak(e,r,"linePrefix",5)(t)};function r(e){const t=i.events[i.events.length-1];return t&&"linePrefix"===t[1].type&&t[2].sliceSerialize(t[1],!0).length>=4?a(e):n(e)}function a(t){return null===t?s(t):wk(t)?e.attempt($k,a,s)(t):(e.enter("codeFlowValue"),o(t))}function o(t){return null===t||wk(t)?(e.exit("codeFlowValue"),a(t)):(e.consume(t),o)}function s(n){return e.exit("codeIndented"),t(n)}}},$k={partial:!0,tokenize:function(e,t,n){const i=this;return r;function r(t){return i.parser.lazy[i.now().line]?n(t):wk(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),r):Ak(e,a,"linePrefix",5)(t)}function a(e){const a=i.events[i.events.length-1];return a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(e):wk(e)?r(e):n(e)}}};const Xk={name:"codeText",previous:function(e){return 96!==e||"characterEscape"===this.events[this.events.length-1][1].type},resolve:function(e){let t,n,i=e.length-4,r=3;if(!("lineEnding"!==e[r][1].type&&"space"!==e[r][1].type||"lineEnding"!==e[i][1].type&&"space"!==e[i][1].type))for(t=r;++t<i;)if("codeTextData"===e[t][1].type){e[r][1].type="codeTextPadding",e[i][1].type="codeTextPadding",r+=2,i-=2;break}t=r-1,i++;for(;++t<=i;)void 0===n?t!==i&&"lineEnding"!==e[t][1].type&&(n=t):t!==i&&"lineEnding"!==e[t][1].type||(e[n][1].type="codeTextData",t!==n+2&&(e[n][1].end=e[t-1][1].end,e.splice(n+2,t-n-2),i-=t-n-2,t=n+2),n=void 0);return e},tokenize:function(e,t,n){let i,r,a=0;return function(t){return e.enter("codeText"),e.enter("codeTextSequence"),o(t)};function o(t){return 96===t?(e.consume(t),a++,o):(e.exit("codeTextSequence"),s(t))}function s(t){return null===t?n(t):32===t?(e.enter("space"),e.consume(t),e.exit("space"),s):96===t?(r=e.enter("codeTextSequence"),i=0,c(t)):wk(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),s):(e.enter("codeTextData"),l(t))}function l(t){return null===t||32===t||96===t||wk(t)?(e.exit("codeTextData"),s(t)):(e.consume(t),l)}function c(n){return 96===n?(e.consume(n),i++,c):i===a?(e.exit("codeTextSequence"),e.exit("codeText"),t(n)):(r.type="codeTextData",l(n))}}};class qk{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const n=null==t?Number.POSITIVE_INFINITY:t;return n<this.left.length?this.left.slice(e,n):e>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(e,t,n){const i=t||0;this.setCursor(Math.trunc(e));const r=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return n&&Kk(this.left,n),r.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Kk(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Kk(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&0===this.right.length||e<0&&0===this.left.length))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);Kk(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Kk(this.left,t.reverse())}}}function Kk(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function Yk(e){const t={};let n,i,r,a,o,s,l,c=-1;const u=new qk(e);for(;++c<u.length;){for(;c in t;)c=t[c];if(n=u.get(c),c&&"chunkFlow"===n[1].type&&"listItemPrefix"===u.get(c-1)[1].type&&(s=n[1]._tokenizer.events,r=0,r<s.length&&"lineEndingBlank"===s[r][1].type&&(r+=2),r<s.length&&"content"===s[r][1].type))for(;++r<s.length&&"content"!==s[r][1].type;)"chunkText"===s[r][1].type&&(s[r][1]._isInFirstContentOfListItem=!0,r++);if("enter"===n[0])n[1].contentType&&(Object.assign(t,Zk(u,c)),c=t[c],l=!0);else if(n[1]._container){for(r=c,i=void 0;r--;)if(a=u.get(r),"lineEnding"===a[1].type||"lineEndingBlank"===a[1].type)"enter"===a[0]&&(i&&(u.get(i)[1].type="lineEndingBlank"),a[1].type="lineEnding",i=r);else if("linePrefix"!==a[1].type&&"listItemIndent"!==a[1].type)break;i&&(n[1].end={...u.get(i)[1].start},o=u.slice(i,c),o.unshift(n),u.splice(i,c-i+1,o))}}return ck(e,0,Number.POSITIVE_INFINITY,u.slice(0)),!l}function Zk(e,t){const n=e.get(t)[1],i=e.get(t)[2];let r=t-1;const a=[];let o=n._tokenizer;o||(o=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const s=o.events,l=[],c={};let u,d,h=-1,p=n,m=0,f=0;const g=[f];for(;p;){for(;e.get(++r)[1]!==p;);a.push(r),p._tokenizer||(u=i.sliceStream(p),p.next||u.push(null),d&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=n;++h<s.length;)"exit"===s[h][0]&&"enter"===s[h-1][0]&&s[h][1].type===s[h-1][1].type&&s[h][1].start.line!==s[h][1].end.line&&(f=h+1,g.push(f),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),h=g.length;h--;){const t=s.slice(g[h],g[h+1]),n=a.pop();l.push([n,n+t.length-1]),e.splice(n,2,t)}for(l.reverse(),h=-1;++h<l.length;)c[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return c}const Jk={resolve:function(e){return Yk(e),e},tokenize:function(e,t){let n;return function(t){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),i(t)};function i(t){return null===t?r(t):wk(t)?e.check(Qk,a,r)(t):(e.consume(t),i)}function r(n){return e.exit("chunkContent"),e.exit("content"),t(n)}function a(t){return e.consume(t),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,i}}},Qk={partial:!0,tokenize:function(e,t,n){const i=this;return function(t){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),Ak(e,r,"linePrefix")};function r(r){if(null===r||wk(r))return n(r);const a=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(r):e.interrupt(i.parser.constructs.flow,n,t)(r)}}};function eA(e,t,n,i,r,a,o,s,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return function(t){if(60===t)return e.enter(i),e.enter(r),e.enter(a),e.consume(t),e.exit(a),d;if(null===t||32===t||41===t||_k(t))return n(t);return e.enter(i),e.enter(o),e.enter(s),e.enter("chunkString",{contentType:"string"}),m(t)};function d(n){return 62===n?(e.enter(a),e.consume(n),e.exit(a),e.exit(r),e.exit(i),t):(e.enter(s),e.enter("chunkString",{contentType:"string"}),h(n))}function h(t){return 62===t?(e.exit("chunkString"),e.exit(s),d(t)):null===t||60===t||wk(t)?n(t):(e.consume(t),92===t?p:h)}function p(t){return 60===t||62===t||92===t?(e.consume(t),h):h(t)}function m(r){return u||null!==r&&41!==r&&!Mk(r)?u<c&&40===r?(e.consume(r),u++,m):41===r?(e.consume(r),u--,m):null===r||32===r||40===r||_k(r)?n(r):(e.consume(r),92===r?f:m):(e.exit("chunkString"),e.exit(s),e.exit(o),e.exit(i),t(r))}function f(t){return 40===t||41===t||92===t?(e.consume(t),m):m(t)}}function tA(e,t,n,i,r,a){const o=this;let s,l=0;return function(t){return e.enter(i),e.enter(r),e.consume(t),e.exit(r),e.enter(a),c};function c(d){return l>999||null===d||91===d||93===d&&!s||94===d&&!l&&"_hiddenFootnoteSupport"in o.parser.constructs?n(d):93===d?(e.exit(a),e.enter(r),e.consume(d),e.exit(r),e.exit(i),t):wk(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),u(d))}function u(t){return null===t||91===t||93===t||wk(t)||l++>999?(e.exit("chunkString"),c(t)):(e.consume(t),s||(s=!Ek(t)),92===t?d:u)}function d(t){return 91===t||92===t||93===t?(e.consume(t),l++,u):u(t)}}function nA(e,t,n,i,r,a){let o;return function(t){if(34===t||39===t||40===t)return e.enter(i),e.enter(r),e.consume(t),e.exit(r),o=40===t?41:t,s;return n(t)};function s(n){return n===o?(e.enter(r),e.consume(n),e.exit(r),e.exit(i),t):(e.enter(a),l(n))}function l(t){return t===o?(e.exit(a),s(o)):null===t?n(t):wk(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),Ak(e,l,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(t))}function c(t){return t===o||null===t||wk(t)?(e.exit("chunkString"),l(t)):(e.consume(t),92===t?u:c)}function u(t){return t===o||92===t?(e.consume(t),c):c(t)}}function iA(e,t){let n;return function i(r){if(wk(r))return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),n=!0,i;if(Ek(r))return Ak(e,i,n?"linePrefix":"lineSuffix")(r);return t(r)}}const rA={name:"definition",tokenize:function(e,t,n){const i=this;let r;return function(t){return e.enter("definition"),function(t){return tA.call(i,e,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(t)}(t)};function a(t){return r=fk(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),o):n(t)}function o(t){return Mk(t)?iA(e,s)(t):s(t)}function s(t){return eA(e,l,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(t)}function l(t){return e.attempt(aA,c,c)(t)}function c(t){return Ek(t)?Ak(e,u,"whitespace")(t):u(t)}function u(a){return null===a||wk(a)?(e.exit("definition"),i.parser.defined.push(r),t(a)):n(a)}}},aA={partial:!0,tokenize:function(e,t,n){return function(t){return Mk(t)?iA(e,i)(t):n(t)};function i(t){return nA(e,r,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(t)}function r(t){return Ek(t)?Ak(e,a,"whitespace")(t):a(t)}function a(e){return null===e||wk(e)?t(e):n(e)}}};const oA={name:"hardBreakEscape",tokenize:function(e,t,n){return function(t){return e.enter("hardBreakEscape"),e.consume(t),i};function i(i){return wk(i)?(e.exit("hardBreakEscape"),t(i)):n(i)}}};const sA={name:"headingAtx",resolve:function(e,t){let n,i,r=e.length-2,a=3;"whitespace"===e[a][1].type&&(a+=2);r-2>a&&"whitespace"===e[r][1].type&&(r-=2);"atxHeadingSequence"===e[r][1].type&&(a===r-1||r-4>a&&"whitespace"===e[r-2][1].type)&&(r-=a+1===r?2:4);r>a&&(n={type:"atxHeadingText",start:e[a][1].start,end:e[r][1].end},i={type:"chunkText",start:e[a][1].start,end:e[r][1].end,contentType:"text"},ck(e,a,r-a+1,[["enter",n,t],["enter",i,t],["exit",i,t],["exit",n,t]]));return e},tokenize:function(e,t,n){let i=0;return function(t){return e.enter("atxHeading"),function(t){return e.enter("atxHeadingSequence"),r(t)}(t)};function r(t){return 35===t&&i++<6?(e.consume(t),r):null===t||Mk(t)?(e.exit("atxHeadingSequence"),a(t)):n(t)}function a(n){return 35===n?(e.enter("atxHeadingSequence"),o(n)):null===n||wk(n)?(e.exit("atxHeading"),t(n)):Ek(n)?Ak(e,a,"whitespace")(n):(e.enter("atxHeadingText"),s(n))}function o(t){return 35===t?(e.consume(t),o):(e.exit("atxHeadingSequence"),a(t))}function s(t){return null===t||35===t||Mk(t)?(e.exit("atxHeadingText"),a(t)):(e.consume(t),s)}}};const lA=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],cA=["pre","script","style","textarea"],uA={concrete:!0,name:"htmlFlow",resolveTo:function(e){let t=e.length;for(;t--&&("enter"!==e[t][0]||"htmlFlow"!==e[t][1].type););t>1&&"linePrefix"===e[t-2][1].type&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2));return e},tokenize:function(e,t,n){const i=this;let r,a,o,s,l;return function(t){return function(t){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(t),c}(t)};function c(s){return 33===s?(e.consume(s),u):47===s?(e.consume(s),a=!0,p):63===s?(e.consume(s),r=3,i.interrupt?t:I):gk(s)?(e.consume(s),o=String.fromCharCode(s),m):n(s)}function u(a){return 45===a?(e.consume(a),r=2,d):91===a?(e.consume(a),r=5,s=0,h):gk(a)?(e.consume(a),r=4,i.interrupt?t:I):n(a)}function d(r){return 45===r?(e.consume(r),i.interrupt?t:I):n(r)}function h(r){const a="CDATA[";return r===a.charCodeAt(s++)?(e.consume(r),6===s?i.interrupt?t:C:h):n(r)}function p(t){return gk(t)?(e.consume(t),o=String.fromCharCode(t),m):n(t)}function m(s){if(null===s||47===s||62===s||Mk(s)){const l=47===s,c=o.toLowerCase();return l||a||!cA.includes(c)?lA.includes(o.toLowerCase())?(r=6,l?(e.consume(s),f):i.interrupt?t(s):C(s)):(r=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(s):a?g(s):v(s)):(r=1,i.interrupt?t(s):C(s))}return 45===s||vk(s)?(e.consume(s),o+=String.fromCharCode(s),m):n(s)}function f(r){return 62===r?(e.consume(r),i.interrupt?t:C):n(r)}function g(t){return Ek(t)?(e.consume(t),g):M(t)}function v(t){return 47===t?(e.consume(t),M):58===t||95===t||gk(t)?(e.consume(t),y):Ek(t)?(e.consume(t),v):M(t)}function y(t){return 45===t||46===t||58===t||95===t||vk(t)?(e.consume(t),y):_(t)}function _(t){return 61===t?(e.consume(t),x):Ek(t)?(e.consume(t),_):v(t)}function x(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),l=t,b):Ek(t)?(e.consume(t),x):S(t)}function b(t){return t===l?(e.consume(t),l=null,w):null===t||wk(t)?n(t):(e.consume(t),b)}function S(t){return null===t||34===t||39===t||47===t||60===t||61===t||62===t||96===t||Mk(t)?_(t):(e.consume(t),S)}function w(e){return 47===e||62===e||Ek(e)?v(e):n(e)}function M(t){return 62===t?(e.consume(t),E):n(t)}function E(t){return null===t||wk(t)?C(t):Ek(t)?(e.consume(t),E):n(t)}function C(t){return 45===t&&2===r?(e.consume(t),A):60===t&&1===r?(e.consume(t),N):62===t&&4===r?(e.consume(t),j):63===t&&3===r?(e.consume(t),I):93===t&&5===r?(e.consume(t),L):!wk(t)||6!==r&&7!==r?null===t||wk(t)?(e.exit("htmlFlowData"),T(t)):(e.consume(t),C):(e.exit("htmlFlowData"),e.check(dA,D,T)(t))}function T(t){return e.check(hA,P,D)(t)}function P(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),k}function k(t){return null===t||wk(t)?T(t):(e.enter("htmlFlowData"),C(t))}function A(t){return 45===t?(e.consume(t),I):C(t)}function N(t){return 47===t?(e.consume(t),o="",R):C(t)}function R(t){if(62===t){const n=o.toLowerCase();return cA.includes(n)?(e.consume(t),j):C(t)}return gk(t)&&o.length<8?(e.consume(t),o+=String.fromCharCode(t),R):C(t)}function L(t){return 93===t?(e.consume(t),I):C(t)}function I(t){return 62===t?(e.consume(t),j):45===t&&2===r?(e.consume(t),I):C(t)}function j(t){return null===t||wk(t)?(e.exit("htmlFlowData"),D(t)):(e.consume(t),j)}function D(n){return e.exit("htmlFlow"),t(n)}}},dA={partial:!0,tokenize:function(e,t,n){return function(i){return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),e.attempt(Fk,t,n)}}},hA={partial:!0,tokenize:function(e,t,n){const i=this;return function(t){if(wk(t))return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),r;return n(t)};function r(e){return i.parser.lazy[i.now().line]?n(e):t(e)}}};const pA={name:"htmlText",tokenize:function(e,t,n){const i=this;let r,a,o;return function(t){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(t),s};function s(t){return 33===t?(e.consume(t),l):47===t?(e.consume(t),x):63===t?(e.consume(t),y):gk(t)?(e.consume(t),w):n(t)}function l(t){return 45===t?(e.consume(t),c):91===t?(e.consume(t),a=0,p):gk(t)?(e.consume(t),v):n(t)}function c(t){return 45===t?(e.consume(t),h):n(t)}function u(t){return null===t?n(t):45===t?(e.consume(t),d):wk(t)?(o=u,R(t)):(e.consume(t),u)}function d(t){return 45===t?(e.consume(t),h):u(t)}function h(e){return 62===e?N(e):45===e?d(e):u(e)}function p(t){const i="CDATA[";return t===i.charCodeAt(a++)?(e.consume(t),6===a?m:p):n(t)}function m(t){return null===t?n(t):93===t?(e.consume(t),f):wk(t)?(o=m,R(t)):(e.consume(t),m)}function f(t){return 93===t?(e.consume(t),g):m(t)}function g(t){return 62===t?N(t):93===t?(e.consume(t),g):m(t)}function v(t){return null===t||62===t?N(t):wk(t)?(o=v,R(t)):(e.consume(t),v)}function y(t){return null===t?n(t):63===t?(e.consume(t),_):wk(t)?(o=y,R(t)):(e.consume(t),y)}function _(e){return 62===e?N(e):y(e)}function x(t){return gk(t)?(e.consume(t),b):n(t)}function b(t){return 45===t||vk(t)?(e.consume(t),b):S(t)}function S(t){return wk(t)?(o=S,R(t)):Ek(t)?(e.consume(t),S):N(t)}function w(t){return 45===t||vk(t)?(e.consume(t),w):47===t||62===t||Mk(t)?M(t):n(t)}function M(t){return 47===t?(e.consume(t),N):58===t||95===t||gk(t)?(e.consume(t),E):wk(t)?(o=M,R(t)):Ek(t)?(e.consume(t),M):N(t)}function E(t){return 45===t||46===t||58===t||95===t||vk(t)?(e.consume(t),E):C(t)}function C(t){return 61===t?(e.consume(t),T):wk(t)?(o=C,R(t)):Ek(t)?(e.consume(t),C):M(t)}function T(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),r=t,P):wk(t)?(o=T,R(t)):Ek(t)?(e.consume(t),T):(e.consume(t),k)}function P(t){return t===r?(e.consume(t),r=void 0,A):null===t?n(t):wk(t)?(o=P,R(t)):(e.consume(t),P)}function k(t){return null===t||34===t||39===t||60===t||61===t||96===t?n(t):47===t||62===t||Mk(t)?M(t):(e.consume(t),k)}function A(e){return 47===e||62===e||Mk(e)?M(e):n(e)}function N(i){return 62===i?(e.consume(i),e.exit("htmlTextData"),e.exit("htmlText"),t):n(i)}function R(t){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),L}function L(t){return Ek(t)?Ak(e,I,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):I(t)}function I(t){return e.enter("htmlTextData"),o(t)}}};const mA={name:"labelEnd",resolveAll:function(e){let t=-1;const n=[];for(;++t<e.length;){const i=e[t][1];if(n.push(e[t]),"labelImage"===i.type||"labelLink"===i.type||"labelEnd"===i.type){const e="labelImage"===i.type?4:2;i.type="data",t+=e}}e.length!==n.length&&ck(e,0,e.length,n);return e},resolveTo:function(e,t){let n,i,r,a,o=e.length,s=0;for(;o--;)if(n=e[o][1],i){if("link"===n.type||"labelLink"===n.type&&n._inactive)break;"enter"===e[o][0]&&"labelLink"===n.type&&(n._inactive=!0)}else if(r){if("enter"===e[o][0]&&("labelImage"===n.type||"labelLink"===n.type)&&!n._balanced&&(i=o,"labelLink"!==n.type)){s=2;break}}else"labelEnd"===n.type&&(r=o);const l={type:"labelLink"===e[i][1].type?"link":"image",start:{...e[i][1].start},end:{...e[e.length-1][1].end}},c={type:"label",start:{...e[i][1].start},end:{...e[r][1].end}},u={type:"labelText",start:{...e[i+s+2][1].end},end:{...e[r-2][1].start}};return a=[["enter",l,t],["enter",c,t]],a=uk(a,e.slice(i+1,i+s+3)),a=uk(a,[["enter",u,t]]),a=uk(a,jk(t.parser.constructs.insideSpan.null,e.slice(i+s+4,r-3),t)),a=uk(a,[["exit",u,t],e[r-2],e[r-1],["exit",c,t]]),a=uk(a,e.slice(r+1)),a=uk(a,[["exit",l,t]]),ck(e,i,e.length,a),e},tokenize:function(e,t,n){const i=this;let r,a,o=i.events.length;for(;o--;)if(("labelImage"===i.events[o][1].type||"labelLink"===i.events[o][1].type)&&!i.events[o][1]._balanced){r=i.events[o][1];break}return function(t){if(!r)return n(t);if(r._inactive)return u(t);return a=i.parser.defined.includes(fk(i.sliceSerialize({start:r.end,end:i.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelEnd"),s};function s(t){return 40===t?e.attempt(fA,c,a?c:u)(t):91===t?e.attempt(gA,c,a?l:u)(t):a?c(t):u(t)}function l(t){return e.attempt(vA,c,u)(t)}function c(e){return t(e)}function u(e){return r._balanced=!0,n(e)}}},fA={tokenize:function(e,t,n){return function(t){return e.enter("resource"),e.enter("resourceMarker"),e.consume(t),e.exit("resourceMarker"),i};function i(t){return Mk(t)?iA(e,r)(t):r(t)}function r(t){return 41===t?c(t):eA(e,a,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(t)}function a(t){return Mk(t)?iA(e,s)(t):c(t)}function o(e){return n(e)}function s(t){return 34===t||39===t||40===t?nA(e,l,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(t):c(t)}function l(t){return Mk(t)?iA(e,c)(t):c(t)}function c(i){return 41===i?(e.enter("resourceMarker"),e.consume(i),e.exit("resourceMarker"),e.exit("resource"),t):n(i)}}},gA={tokenize:function(e,t,n){const i=this;return function(t){return tA.call(i,e,r,a,"reference","referenceMarker","referenceString")(t)};function r(e){return i.parser.defined.includes(fk(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function a(e){return n(e)}}},vA={tokenize:function(e,t,n){return function(t){return e.enter("reference"),e.enter("referenceMarker"),e.consume(t),e.exit("referenceMarker"),i};function i(i){return 93===i?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):n(i)}}};const yA={name:"labelStartImage",resolveAll:mA.resolveAll,tokenize:function(e,t,n){const i=this;return function(t){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(t),e.exit("labelImageMarker"),r};function r(t){return 91===t?(e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelImage"),a):n(t)}function a(e){return 94===e&&"_hiddenFootnoteSupport"in i.parser.constructs?n(e):t(e)}}};const _A={name:"labelStartLink",resolveAll:mA.resolveAll,tokenize:function(e,t,n){const i=this;return function(t){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelLink"),r};function r(e){return 94===e&&"_hiddenFootnoteSupport"in i.parser.constructs?n(e):t(e)}}};const xA={name:"lineEnding",tokenize:function(e,t){return function(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),Ak(e,t,"linePrefix")}}};const bA={name:"thematicBreak",tokenize:function(e,t,n){let i,r=0;return function(t){return e.enter("thematicBreak"),function(e){return i=e,a(e)}(t)};function a(a){return a===i?(e.enter("thematicBreakSequence"),o(a)):r>=3&&(null===a||wk(a))?(e.exit("thematicBreak"),t(a)):n(a)}function o(t){return t===i?(e.consume(t),r++,o):(e.exit("thematicBreakSequence"),Ek(t)?Ak(e,a,"whitespace")(t):a(t))}}};const SA={continuation:{tokenize:function(e,t,n){const i=this;return i.containerState._closeFlow=void 0,e.check(Fk,function(n){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,Ak(e,t,"listItemIndent",i.containerState.size+1)(n)},function(n){if(i.containerState.furtherBlankLines||!Ek(n))return i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,r(n);return i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,e.attempt(MA,t,r)(n)});function r(r){return i.containerState._closeFlow=!0,i.interrupt=void 0,Ak(e,e.attempt(SA,t,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(r)}}},exit:function(e){e.exit(this.containerState.type)},name:"list",tokenize:function(e,t,n){const i=this,r=i.events[i.events.length-1];let a=r&&"linePrefix"===r[1].type?r[2].sliceSerialize(r[1],!0).length:0,o=0;return function(t){const r=i.containerState.type||(42===t||43===t||45===t?"listUnordered":"listOrdered");if("listUnordered"===r?!i.containerState.marker||t===i.containerState.marker:xk(t)){if(i.containerState.type||(i.containerState.type=r,e.enter(r,{_container:!0})),"listUnordered"===r)return e.enter("listItemPrefix"),42===t||45===t?e.check(bA,n,l)(t):l(t);if(!i.interrupt||49===t)return e.enter("listItemPrefix"),e.enter("listItemValue"),s(t)}return n(t)};function s(t){return xk(t)&&++o<10?(e.consume(t),s):(!i.interrupt||o<2)&&(i.containerState.marker?t===i.containerState.marker:41===t||46===t)?(e.exit("listItemValue"),l(t)):n(t)}function l(t){return e.enter("listItemMarker"),e.consume(t),e.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||t,e.check(Fk,i.interrupt?n:c,e.attempt(wA,d,u))}function c(e){return i.containerState.initialBlankLine=!0,a++,d(e)}function u(t){return Ek(t)?(e.enter("listItemPrefixWhitespace"),e.consume(t),e.exit("listItemPrefixWhitespace"),d):n(t)}function d(n){return i.containerState.size=a+i.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(n)}}},wA={partial:!0,tokenize:function(e,t,n){const i=this;return Ak(e,function(e){const r=i.events[i.events.length-1];return!Ek(e)&&r&&"listItemPrefixWhitespace"===r[1].type?t(e):n(e)},"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5)}},MA={partial:!0,tokenize:function(e,t,n){const i=this;return Ak(e,function(e){const r=i.events[i.events.length-1];return r&&"listItemIndent"===r[1].type&&r[2].sliceSerialize(r[1],!0).length===i.containerState.size?t(e):n(e)},"listItemIndent",i.containerState.size+1)}};const EA={name:"setextUnderline",resolveTo:function(e,t){let n,i,r,a=e.length;for(;a--;)if("enter"===e[a][0]){if("content"===e[a][1].type){n=a;break}"paragraph"===e[a][1].type&&(i=a)}else"content"===e[a][1].type&&e.splice(a,1),r||"definition"!==e[a][1].type||(r=a);const o={type:"setextHeading",start:{...e[n][1].start},end:{...e[e.length-1][1].end}};e[i][1].type="setextHeadingText",r?(e.splice(i,0,["enter",o,t]),e.splice(r+1,0,["exit",e[n][1],t]),e[n][1].end={...e[r][1].end}):e[n][1]=o;return e.push(["exit",o,t]),e},tokenize:function(e,t,n){const i=this;let r;return function(t){let o,s=i.events.length;for(;s--;)if("lineEnding"!==i.events[s][1].type&&"linePrefix"!==i.events[s][1].type&&"content"!==i.events[s][1].type){o="paragraph"===i.events[s][1].type;break}if(!i.parser.lazy[i.now().line]&&(i.interrupt||o))return e.enter("setextHeadingLine"),r=t,function(t){return e.enter("setextHeadingLineSequence"),a(t)}(t);return n(t)};function a(t){return t===r?(e.consume(t),a):(e.exit("setextHeadingLineSequence"),Ek(t)?Ak(e,o,"lineSuffix")(t):o(t))}function o(i){return null===i||wk(i)?(e.exit("setextHeadingLine"),t(i)):n(i)}}};const CA={tokenize:function(e){const t=this,n=e.attempt(Fk,function(i){if(null===i)return void e.consume(i);return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n},e.attempt(this.parser.constructs.flowInitial,i,Ak(e,e.attempt(this.parser.constructs.flow,i,e.attempt(Jk,i)),"linePrefix")));return n;function i(i){if(null!==i)return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,n;e.consume(i)}}};const TA={resolveAll:NA()},PA=AA("string"),kA=AA("text");function AA(e){return{resolveAll:NA("text"===e?RA:void 0),tokenize:function(t){const n=this,i=this.parser.constructs[e],r=t.attempt(i,a,o);return a;function a(e){return l(e)?r(e):o(e)}function o(e){if(null!==e)return t.enter("data"),t.consume(e),s;t.consume(e)}function s(e){return l(e)?(t.exit("data"),r(e)):(t.consume(e),s)}function l(e){if(null===e)return!0;const t=i[e];let r=-1;if(t)for(;++r<t.length;){const e=t[r];if(!e.previous||e.previous.call(n,n.previous))return!0}return!1}}}}function NA(e){return function(t,n){let i,r=-1;for(;++r<=t.length;)void 0===i?t[r]&&"data"===t[r][1].type&&(i=r,r++):t[r]&&"data"===t[r][1].type||(r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),r=i+2),i=void 0);return e?e(t,n):t}}function RA(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||"lineEnding"===e[n][1].type)&&"data"===e[n-1][1].type){const i=e[n-1][1],r=t.sliceStream(i);let a,o=r.length,s=-1,l=0;for(;o--;){const e=r[o];if("string"==typeof e){for(s=e.length;32===e.charCodeAt(s-1);)l++,s--;if(s)break;s=-1}else if(-2===e)a=!0,l++;else if(-1!==e){o++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(l=0),l){const r={type:n===e.length||a||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:o?s:i.start._bufferIndex+s,_index:i.start._index+o,line:i.end.line,column:i.end.column-l,offset:i.end.offset-l},end:{...i.end}};i.end={...r.start},i.start.offset===i.end.offset?Object.assign(i,r):(e.splice(n,0,["enter",r,t],["exit",r,t]),n+=2)}n++}return e}const LA={42:SA,43:SA,45:SA,48:SA,49:SA,50:SA,51:SA,52:SA,53:SA,54:SA,55:SA,56:SA,57:SA,62:zk},IA={91:rA},jA={[-2]:Gk,[-1]:Gk,32:Gk},DA={35:sA,42:bA,45:[EA,bA],60:uA,61:EA,95:bA,96:Wk,126:Wk},UA={38:Hk,92:Bk},OA={[-5]:xA,[-4]:xA,[-3]:xA,33:yA,38:Hk,42:Dk,60:[Ok,pA],91:_A,92:[oA,Bk],93:mA,95:Dk,96:Xk},FA={null:[Dk,TA]},zA=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:IA,disable:{null:[]},document:LA,flow:DA,flowInitial:jA,insideSpan:FA,string:UA,text:OA},Symbol.toStringTag,{value:"Module"}));function BA(e,t,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const r={},a=[];let o=[],s=[];const l={attempt:g(function(e,t){v(e,t.from)}),check:g(f),consume:function(e){wk(e)?(i.line++,i.column=1,i.offset+=-3===e?2:1,y()):-1!==e&&(i.column++,i.offset++);i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++));c.previous=e},enter:function(e,t){const n=t||{};return n.type=e,n.start=h(),c.events.push(["enter",n,c]),s.push(n),n},exit:function(e){const t=s.pop();return t.end=h(),c.events.push(["exit",t,c]),t},interrupt:g(f,{interrupt:!0})},c={code:null,containerState:{},defineSkip:function(e){r[e.line]=e.column,y()},events:[],now:h,parser:e,previous:null,sliceSerialize:function(e,t){return function(e,t){let n=-1;const i=[];let r;for(;++n<e.length;){const a=e[n];let o;if("string"==typeof a)o=a;else switch(a){case-5:o="\r";break;case-4:o="\n";break;case-3:o="\r\n";break;case-2:o=t?" ":"\t";break;case-1:if(!t&&r)continue;o=" ";break;default:o=String.fromCharCode(a)}r=-2===a,i.push(o)}return i.join("")}(d(e),t)},sliceStream:d,write:function(e){if(o=uk(o,e),p(),null!==o[o.length-1])return[];return v(t,0),c.events=jk(a,c.events,c),c.events}};let u=t.tokenize.call(c,l);return t.resolveAll&&a.push(t),c;function d(e){return function(e,t){const n=t.start._index,i=t.start._bufferIndex,r=t.end._index,a=t.end._bufferIndex;let o;if(n===r)o=[e[n].slice(i,a)];else{if(o=e.slice(n,r),i>-1){const e=o[0];"string"==typeof e?o[0]=e.slice(i):o.shift()}a>0&&o.push(e[r].slice(0,a))}return o}(o,e)}function h(){const{_bufferIndex:e,_index:t,line:n,column:r,offset:a}=i;return{_bufferIndex:e,_index:t,line:n,column:r,offset:a}}function p(){let e;for(;i._index<o.length;){const t=o[i._index];if("string"==typeof t)for(e=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===e&&i._bufferIndex<t.length;)m(t.charCodeAt(i._bufferIndex));else m(t)}}function m(e){u=u(e)}function f(e,t){t.restore()}function g(e,t){return function(n,r,a){let o,u,d,p;return Array.isArray(n)?m(n):"tokenize"in n?m([n]):function(e){return t;function t(t){const n=null!==t&&e[t],i=null!==t&&e.null;return m([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(i)?i:i?[i]:[]])(t)}}(n);function m(e){return o=e,u=0,0===e.length?a:f(e[u])}function f(e){return function(n){p=function(){const e=h(),t=c.previous,n=c.currentConstruct,r=c.events.length,a=Array.from(s);return{from:r,restore:o};function o(){i=e,c.previous=t,c.currentConstruct=n,c.events.length=r,s=a,y()}}(),d=e,e.partial||(c.currentConstruct=e);if(e.name&&c.parser.constructs.disable.null.includes(e.name))return v();return e.tokenize.call(t?Object.assign(Object.create(c),t):c,l,g,v)(n)}}function g(t){return e(d,p),r}function v(e){return p.restore(),++u<o.length?f(o[u]):a}}}function v(e,t){e.resolveAll&&!a.includes(e)&&a.push(e),e.resolve&&ck(c.events,t,c.events.length-t,e.resolve(c.events.slice(t),c)),e.resolveTo&&(c.events=e.resolveTo(c.events,c))}function y(){i.line in r&&i.column<2&&(i.column=r[i.line],i.offset+=r[i.line]-1)}}function HA(e){const t={constructs:function(e){const t={};let n=-1;for(;++n<e.length;)hk(t,e[n]);return t}([zA,...(e||{}).extensions||[]]),content:n(Nk),defined:[],document:n(Rk),flow:n(CA),lazy:{},string:n(PA),text:n(kA)};return t;function n(e){return function(n){return BA(t,e,n)}}}const VA=/[\0\t\n\r]/g;const WA=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function GA(e,t,n){if(t)return t;if(35===n.charCodeAt(0)){const e=n.charCodeAt(1),t=120===e||88===e;return mk(n.slice(t?2:1),t?16:10)}return lk(n)||e}const $A={}.hasOwnProperty;function XA(e,t,n){return"string"!=typeof t&&(n=t,t=void 0),function(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(te),autolinkProtocol:E,autolinkEmail:E,atxHeading:a(Z),blockQuote:a($),characterEscape:E,characterReference:E,codeFenced:a(X),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:a(X,o),codeText:a(q,o),codeTextData:E,data:E,codeFlowValue:E,definition:a(K),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:a(Y),hardBreakEscape:a(J),hardBreakTrailing:a(J),htmlFlow:a(Q,o),htmlFlowData:E,htmlText:a(Q,o),htmlTextData:E,image:a(ee),label:o,link:a(te),listItem:a(ie),listItemValue:h,listOrdered:a(ne,d),listUnordered:a(ne),paragraph:a(re),reference:F,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:a(Z),strong:a(ae),thematicBreak:a(se)},exit:{atxHeading:l(),atxHeadingSequence:b,autolink:l(),autolinkEmail:G,autolinkProtocol:W,blockQuote:l(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:B,characterReferenceMarkerNumeric:B,characterReferenceValue:H,characterReference:V,codeFenced:l(g),codeFencedFence:f,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:C,codeIndented:l(v),codeText:l(N),codeTextData:C,data:C,definition:l(),definitionDestinationString:x,definitionLabelString:y,definitionTitleString:_,emphasis:l(),hardBreakEscape:l(P),hardBreakTrailing:l(P),htmlFlow:l(k),htmlFlowData:C,htmlText:l(A),htmlTextData:C,image:l(L),label:j,labelText:I,lineEnding:T,link:l(R),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:z,resourceDestinationString:D,resourceTitleString:U,resource:O,setextHeading:l(M),setextHeadingLineSequence:w,setextHeadingText:S,strong:l(),thematicBreak:l()}};KA(t,(e||{}).mdastExtensions||[]);const n={};return i;function i(e){let i={type:"root",children:[]};const a={stack:[i],tokenStack:[],config:t,enter:s,exit:c,buffer:o,resume:u,data:n},l=[];let d=-1;for(;++d<e.length;)if("listOrdered"===e[d][1].type||"listUnordered"===e[d][1].type)if("enter"===e[d][0])l.push(d);else{d=r(e,l.pop(),d)}for(d=-1;++d<e.length;){const n=t[e[d][0]];$A.call(n,e[d][1].type)&&n[e[d][1].type].call(Object.assign({sliceSerialize:e[d][2].sliceSerialize},a),e[d][1])}if(a.tokenStack.length>0){const e=a.tokenStack[a.tokenStack.length-1];(e[1]||ZA).call(a,void 0,e[0])}for(i.position={start:qA(e.length>0?e[0][1].start:{line:1,column:1,offset:0}),end:qA(e.length>0?e[e.length-2][1].end:{line:1,column:1,offset:0})},d=-1;++d<t.transforms.length;)i=t.transforms[d](i)||i;return i}function r(e,t,n){let i,r,a,o,s=t-1,l=-1,c=!1;for(;++s<=n;){const t=e[s];switch(t[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===t[0]?l++:l--,o=void 0;break;case"lineEndingBlank":"enter"===t[0]&&(!i||o||l||a||(a=s),o=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:o=void 0}if(!l&&"enter"===t[0]&&"listItemPrefix"===t[1].type||-1===l&&"exit"===t[0]&&("listUnordered"===t[1].type||"listOrdered"===t[1].type)){if(i){let o=s;for(r=void 0;o--;){const t=e[o];if("lineEnding"===t[1].type||"lineEndingBlank"===t[1].type){if("exit"===t[0])continue;r&&(e[r][1].type="lineEndingBlank",c=!0),t[1].type="lineEnding",r=o}else if("linePrefix"!==t[1].type&&"blockQuotePrefix"!==t[1].type&&"blockQuotePrefixWhitespace"!==t[1].type&&"blockQuoteMarker"!==t[1].type&&"listItemIndent"!==t[1].type)break}a&&(!r||a<r)&&(i._spread=!0),i.end=Object.assign({},r?e[r][1].start:t[1].end),e.splice(r||s,0,["exit",i,t[2]]),s++,n++}if("listItemPrefix"===t[1].type){const r={type:"listItem",_spread:!1,start:Object.assign({},t[1].start),end:void 0};i=r,e.splice(s,0,["enter",r,t[2]]),s++,n++,a=void 0,o=!0}}}return e[t][1]._spread=c,n}function a(e,t){return n;function n(n){s.call(this,e(n),n),t&&t.call(this,n)}}function o(){this.stack.push({type:"fragment",children:[]})}function s(e,t,n){this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n||void 0]),e.position={start:qA(t.start),end:void 0}}function l(e){return t;function t(t){e&&e.call(this,t),c.call(this,t)}}function c(e,t){const n=this.stack.pop(),i=this.tokenStack.pop();if(!i)throw new Error("Cannot close `"+e.type+"` ("+DP({start:e.start,end:e.end})+"): its not open");if(i[0].type!==e.type)if(t)t.call(this,e,i[0]);else{(i[1]||ZA).call(this,e,i[0])}n.position.end=qA(e.end)}function u(){return function(e){return ak(e,"boolean"!=typeof rk.includeImageAlt||rk.includeImageAlt,"boolean"!=typeof rk.includeHtml||rk.includeHtml)}(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function h(e){if(this.data.expectingFirstListItemValue){this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(e),10),this.data.expectingFirstListItemValue=void 0}}function p(){const e=this.resume();this.stack[this.stack.length-1].lang=e}function m(){const e=this.resume();this.stack[this.stack.length-1].meta=e}function f(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function v(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/(\r?\n|\r)$/g,"")}function y(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=fk(this.sliceSerialize(e)).toLowerCase()}function _(){const e=this.resume();this.stack[this.stack.length-1].title=e}function x(){const e=this.resume();this.stack[this.stack.length-1].url=e}function b(e){const t=this.stack[this.stack.length-1];if(!t.depth){const n=this.sliceSerialize(e).length;t.depth=n}}function S(){this.data.setextHeadingSlurpLineEnding=!0}function w(e){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(e).codePointAt(0)?1:2}function M(){this.data.setextHeadingSlurpLineEnding=void 0}function E(e){const t=this.stack[this.stack.length-1].children;let n=t[t.length-1];n&&"text"===n.type||(n=oe(),n.position={start:qA(e.start),end:void 0},t.push(n)),this.stack.push(n)}function C(e){const t=this.stack.pop();t.value+=this.sliceSerialize(e),t.position.end=qA(e.end)}function T(e){const n=this.stack[this.stack.length-1];if(this.data.atHardBreak){return n.children[n.children.length-1].position.end=qA(e.end),void(this.data.atHardBreak=void 0)}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(n.type)&&(E.call(this,e),C.call(this,e))}function P(){this.data.atHardBreak=!0}function k(){const e=this.resume();this.stack[this.stack.length-1].value=e}function A(){const e=this.resume();this.stack[this.stack.length-1].value=e}function N(){const e=this.resume();this.stack[this.stack.length-1].value=e}function R(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function L(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function I(e){const t=this.sliceSerialize(e),n=this.stack[this.stack.length-2];n.label=function(e){return e.replace(WA,GA)}(t),n.identifier=fk(t).toLowerCase()}function j(){const e=this.stack[this.stack.length-1],t=this.resume(),n=this.stack[this.stack.length-1];if(this.data.inReference=!0,"link"===n.type){const t=e.children;n.children=t}else n.alt=t}function D(){const e=this.resume();this.stack[this.stack.length-1].url=e}function U(){const e=this.resume();this.stack[this.stack.length-1].title=e}function O(){this.data.inReference=void 0}function F(){this.data.referenceType="collapsed"}function z(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=fk(this.sliceSerialize(e)).toLowerCase(),this.data.referenceType="full"}function B(e){this.data.characterReferenceType=e.type}function H(e){const t=this.sliceSerialize(e),n=this.data.characterReferenceType;let i;if(n)i=mk(t,"characterReferenceMarkerNumeric"===n?10:16),this.data.characterReferenceType=void 0;else{i=lk(t)}this.stack[this.stack.length-1].value+=i}function V(e){this.stack.pop().position.end=qA(e.end)}function W(e){C.call(this,e);this.stack[this.stack.length-1].url=this.sliceSerialize(e)}function G(e){C.call(this,e);this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(e)}function $(){return{type:"blockquote",children:[]}}function X(){return{type:"code",lang:null,meta:null,value:""}}function q(){return{type:"inlineCode",value:""}}function K(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Y(){return{type:"emphasis",children:[]}}function Z(){return{type:"heading",depth:0,children:[]}}function J(){return{type:"break"}}function Q(){return{type:"html",value:""}}function ee(){return{type:"image",title:null,url:"",alt:null}}function te(){return{type:"link",title:null,url:"",children:[]}}function ne(e){return{type:"list",ordered:"listOrdered"===e.type,start:null,spread:e._spread,children:[]}}function ie(e){return{type:"listItem",spread:e._spread,checked:null,children:[]}}function re(){return{type:"paragraph",children:[]}}function ae(){return{type:"strong",children:[]}}function oe(){return{type:"text",value:""}}function se(){return{type:"thematicBreak"}}}(n)(function(e){for(;!Yk(e););return e}(HA(n).document().write(function(){let e,t=1,n="",i=!0;return function(r,a,o){const s=[];let l,c,u,d,h;for(r=n+("string"==typeof r?r.toString():new TextDecoder(a||void 0).decode(r)),u=0,n="",i&&(65279===r.charCodeAt(0)&&u++,i=void 0);u<r.length;){if(VA.lastIndex=u,l=VA.exec(r),d=l&&void 0!==l.index?l.index:r.length,h=r.charCodeAt(d),!l){n=r.slice(u);break}if(10===h&&u===d&&e)s.push(-3),e=void 0;else switch(e&&(s.push(-5),e=void 0),u<d&&(s.push(r.slice(u,d)),t+=d-u),h){case 0:s.push(65533),t++;break;case 9:for(c=4*Math.ceil(t/4),s.push(-2);t++<c;)s.push(-1);break;case 10:s.push(-4),t=1;break;default:e=!0,t=1}u=d+1}return o&&(e&&s.push(-5),n&&s.push(n),s.push(null)),s}}()(e,t,!0))))}function qA(e){return{line:e.line,column:e.column,offset:e.offset}}function KA(e,t){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?KA(e,i):YA(e,i)}}function YA(e,t){let n;for(n in t)if($A.call(t,n))switch(n){case"canContainEols":{const i=t[n];i&&e[n].push(...i);break}case"transforms":{const i=t[n];i&&e[n].push(...i);break}case"enter":case"exit":{const i=t[n];i&&Object.assign(e[n],i);break}}}function ZA(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+DP({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+DP({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+DP({start:t.start,end:t.end})+") is still open")}function JA(e){const t=this;t.parser=function(n){return XA(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function QA(e,t){const n=t.referenceType;let i="]";if("collapsed"===n?i+="[]":"full"===n&&(i+="["+(t.label||t.identifier)+"]"),"imageReference"===t.type)return[{type:"text",value:"!["+t.alt+i}];const r=e.all(t),a=r[0];a&&"text"===a.type?a.value="["+a.value:r.unshift({type:"text",value:"["});const o=r[r.length-1];return o&&"text"===o.type?o.value+=i:r.push({type:"text",value:i}),r}function eN(e){const t=e.spread;return null==t?e.children.length>1:t}function tN(e){const t=String(e),n=/\r?\n|\r/g;let i=n.exec(t),r=0;const a=[];for(;i;)a.push(nN(t.slice(r,i.index),r>0,!0),i[0]),r=i.index+i[0].length,i=n.exec(t);return a.push(nN(t.slice(r),r>0,!1)),a.join("")}function nN(e,t,n){let i=0,r=e.length;if(t){let t=e.codePointAt(i);for(;9===t||32===t;)i++,t=e.codePointAt(i)}if(n){let t=e.codePointAt(r-1);for(;9===t||32===t;)r--,t=e.codePointAt(r-1)}return r>i?e.slice(i,r):""}const iN={blockquote:function(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)},break:function(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:"\n"}]},code:function(e,t){const n=t.value?t.value+"\n":"",i={},r=t.lang?t.lang.split(/\s+/):[];r.length>0&&(i.className=["language-"+r[0]]);let a={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return t.meta&&(a.data={meta:t.meta}),e.patch(t,a),a=e.applyData(t,a),a={type:"element",tagName:"pre",properties:{},children:[a]},e.patch(t,a),a},delete:function(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},emphasis:function(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},footnoteReference:function(e,t){const n="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",i=String(t.identifier).toUpperCase(),r=kk(i.toLowerCase()),a=e.footnoteOrder.indexOf(i);let o,s=e.footnoteCounts.get(i);void 0===s?(s=0,e.footnoteOrder.push(i),o=e.footnoteOrder.length):o=a+1,s+=1,e.footnoteCounts.set(i,s);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+r,id:n+"fnref-"+r+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};e.patch(t,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,c),e.applyData(t,c)},heading:function(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},html:function(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}},imageReference:function(e,t){const n=String(t.identifier).toUpperCase(),i=e.definitionById.get(n);if(!i)return QA(e,t);const r={src:kk(i.url||""),alt:t.alt};null!==i.title&&void 0!==i.title&&(r.title=i.title);const a={type:"element",tagName:"img",properties:r,children:[]};return e.patch(t,a),e.applyData(t,a)},image:function(e,t){const n={src:kk(t.url)};null!==t.alt&&void 0!==t.alt&&(n.alt=t.alt),null!==t.title&&void 0!==t.title&&(n.title=t.title);const i={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,i),e.applyData(t,i)},inlineCode:function(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,i),e.applyData(t,i)},linkReference:function(e,t){const n=String(t.identifier).toUpperCase(),i=e.definitionById.get(n);if(!i)return QA(e,t);const r={href:kk(i.url||"")};null!==i.title&&void 0!==i.title&&(r.title=i.title);const a={type:"element",tagName:"a",properties:r,children:e.all(t)};return e.patch(t,a),e.applyData(t,a)},link:function(e,t){const n={href:kk(t.url)};null!==t.title&&void 0!==t.title&&(n.title=t.title);const i={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)},listItem:function(e,t,n){const i=e.all(t),r=n?function(e){let t=!1;if("list"===e.type){t=e.spread||!1;const n=e.children;let i=-1;for(;!t&&++i<n.length;)t=eN(n[i])}return t}(n):eN(t),a={},o=[];if("boolean"==typeof t.checked){const e=i[0];let n;e&&"element"===e.type&&"p"===e.tagName?n=e:(n={type:"element",tagName:"p",properties:{},children:[]},i.unshift(n)),n.children.length>0&&n.children.unshift({type:"text",value:" "}),n.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let s=-1;for(;++s<i.length;){const e=i[s];(r||0!==s||"element"!==e.type||"p"!==e.tagName)&&o.push({type:"text",value:"\n"}),"element"!==e.type||"p"!==e.tagName||r?o.push(e):o.push(...e.children)}const l=i[i.length-1];l&&(r||"element"!==l.type||"p"!==l.tagName)&&o.push({type:"text",value:"\n"});const c={type:"element",tagName:"li",properties:a,children:o};return e.patch(t,c),e.applyData(t,c)},list:function(e,t){const n={},i=e.all(t);let r=-1;for("number"==typeof t.start&&1!==t.start&&(n.start=t.start);++r<i.length;){const e=i[r];if("element"===e.type&&"li"===e.tagName&&e.properties&&Array.isArray(e.properties.className)&&e.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const a={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(i,!0)};return e.patch(t,a),e.applyData(t,a)},paragraph:function(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},root:function(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)},strong:function(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},table:function(e,t){const n=e.all(t),i=n.shift(),r=[];if(i){const n={type:"element",tagName:"thead",properties:{},children:e.wrap([i],!0)};e.patch(t.children[0],n),r.push(n)}if(n.length>0){const i={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},a=IP(t.children[1]),o=LP(t.children[t.children.length-1]);a&&o&&(i.position={start:a,end:o}),r.push(i)}const a={type:"element",tagName:"table",properties:{},children:e.wrap(r,!0)};return e.patch(t,a),e.applyData(t,a)},tableCell:function(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},tableRow:function(e,t,n){const i=n?n.children:void 0,r=0===(i?i.indexOf(t):1)?"th":"td",a=n&&"table"===n.type?n.align:void 0,o=a?a.length:t.children.length;let s=-1;const l=[];for(;++s<o;){const n=t.children[s],i={},o=a?a[s]:void 0;o&&(i.align=o);let c={type:"element",tagName:r,properties:i,children:[]};n&&(c.children=e.all(n),e.patch(n,c),c=e.applyData(n,c)),l.push(c)}const c={type:"element",tagName:"tr",properties:{},children:e.wrap(l,!0)};return e.patch(t,c),e.applyData(t,c)},text:function(e,t){const n={type:"text",value:tN(String(t.value))};return e.patch(t,n),e.applyData(t,n)},thematicBreak:function(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)},toml:rN,yaml:rN,definition:rN,footnoteDefinition:rN};function rN(){}const aN="object"==typeof self?self:globalThis,oN=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),i=r=>{if(e.has(r))return e.get(r);const[a,o]=t[r];switch(a){case 0:case-1:return n(o,r);case 1:{const e=n([],r);for(const t of o)e.push(i(t));return e}case 2:{const e=n({},r);for(const[t,n]of o)e[i(t)]=i(n);return e}case 3:return n(new Date(o),r);case 4:{const{source:e,flags:t}=o;return n(new RegExp(e,t),r)}case 5:{const e=n(new Map,r);for(const[t,n]of o)e.set(i(t),i(n));return e}case 6:{const e=n(new Set,r);for(const t of o)e.add(i(t));return e}case 7:{const{name:e,message:t}=o;return n(new aN[e](t),r)}case 8:return n(BigInt(o),r);case"BigInt":return n(Object(BigInt(o)),r);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:e}=new Uint8Array(o);return n(new DataView(e),o)}}return n(new aN[a](o),r)};return i})(new Map,e)(0),sN="",{toString:lN}={},{keys:cN}=Object,uN=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=lN.call(e).slice(8,-1);switch(n){case"Array":return[1,sN];case"Object":return[2,sN];case"Date":return[3,sN];case"RegExp":return[4,sN];case"Map":return[5,sN];case"Set":return[6,sN];case"DataView":return[1,n]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},dN=([e,t])=>0===e&&("function"===t||"symbol"===t),hN=(e,{json:t,lossy:n}={})=>{const i=[];return((e,t,n,i)=>{const r=(e,t)=>{const r=i.push(e)-1;return n.set(t,r),r},a=i=>{if(n.has(i))return n.get(i);let[o,s]=uN(i);switch(o){case 0:{let t=i;switch(s){case"bigint":o=8,t=i.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+s);t=null;break;case"undefined":return r([-1],i)}return r([o,t],i)}case 1:{if(s){let e=i;return"DataView"===s?e=new Uint8Array(i.buffer):"ArrayBuffer"===s&&(e=new Uint8Array(i)),r([s,[...e]],i)}const e=[],t=r([o,e],i);for(const n of i)e.push(a(n));return t}case 2:{if(s)switch(s){case"BigInt":return r([s,i.toString()],i);case"Boolean":case"Number":case"String":return r([s,i.valueOf()],i)}if(t&&"toJSON"in i)return a(i.toJSON());const n=[],l=r([o,n],i);for(const t of cN(i))!e&&dN(uN(i[t]))||n.push([a(t),a(i[t])]);return l}case 3:return r([o,i.toISOString()],i);case 4:{const{source:e,flags:t}=i;return r([o,{source:e,flags:t}],i)}case 5:{const t=[],n=r([o,t],i);for(const[r,o]of i)(e||!dN(uN(r))&&!dN(uN(o)))&&t.push([a(r),a(o)]);return n}case 6:{const t=[],n=r([o,t],i);for(const r of i)!e&&dN(uN(r))||t.push(a(r));return n}}const{message:l}=i;return r([o,{name:s,message:l}],i)};return a})(!(t||n),!!t,new Map,i)(e),i},pN="function"==typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?oN(hN(e,t)):structuredClone(e):(e,t)=>oN(hN(e,t));function mN(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function fN(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}const gN=function(e){if(null==e)return yN;if("function"==typeof e)return vN(e);if("object"==typeof e)return Array.isArray(e)?function(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=gN(e[n]);return vN(i);function i(...e){let n=-1;for(;++n<t.length;)if(t[n].apply(this,e))return!0;return!1}}(e):function(e){const t=e;return vN(n);function n(n){const i=n;let r;for(r in e)if(i[r]!==t[r])return!1;return!0}}(e);if("string"==typeof e)return function(e){return vN(t);function t(t){return t&&t.type===e}}(e);throw new Error("Expected function, string, or object as test")};function vN(e){return function(t,n,i){return Boolean(function(e){return null!==e&&"object"==typeof e&&"type"in e}(t)&&e.call(this,t,"number"==typeof n?n:void 0,i||void 0))}}function yN(){return!0}const _N=[],xN=!0,bN=!1;function SN(e,t,n,i){let r;"function"==typeof t&&"function"!=typeof n?(i=n,n=t):r=t;const a=gN(r),o=i?-1:1;!function e(r,s,l){const c=r&&"object"==typeof r?r:{};if("string"==typeof c.type){const e="string"==typeof c.tagName?c.tagName:"string"==typeof c.name?c.name:void 0;Object.defineProperty(u,"name",{value:"node ("+r.type+(e?"<"+e+">":"")+")"})}return u;function u(){let c,u,d,h=_N;if((!t||a(r,s,l[l.length-1]||void 0))&&(h=function(e){if(Array.isArray(e))return e;if("number"==typeof e)return[xN,e];return null==e?_N:[e]}(n(r,l)),h[0]===bN))return h;if("children"in r&&r.children){const t=r;if(t.children&&"skip"!==h[0])for(u=(i?t.children.length:-1)+o,d=l.concat(t);u>-1&&u<t.children.length;){const n=t.children[u];if(c=e(n,u,d)(),c[0]===bN)return c;u="number"==typeof c[1]?c[1]:u+o}}return h}}(e,void 0,[])()}function wN(e,t,n,i){let r,a,o;"function"==typeof t&&"function"!=typeof n?(a=void 0,o=t,r=n):(a=t,o=n,r=i),SN(e,a,function(e,t){const n=t[t.length-1],i=n?n.children.indexOf(e):void 0;return o(e,i,n)},r)}const MN={}.hasOwnProperty,EN={};function CN(e,t){e.position&&(t.position=function(e){const t=IP(e),n=LP(e);if(t&&n)return{start:t,end:n}}(e))}function TN(e,t){let n=t;if(e&&e.data){const t=e.data.hName,i=e.data.hChildren,r=e.data.hProperties;if("string"==typeof t)if("element"===n.type)n.tagName=t;else{n={type:"element",tagName:t,properties:{},children:"children"in n?n.children:[n]}}"element"===n.type&&r&&Object.assign(n.properties,pN(r)),"children"in n&&n.children&&null!=i&&(n.children=i)}return n}function PN(e,t){const n=t.data||{},i=!("value"in t)||MN.call(n,"hProperties")||MN.call(n,"hChildren")?{type:"element",tagName:"div",properties:{},children:e.all(t)}:{type:"text",value:t.value};return e.patch(t,i),e.applyData(t,i)}function kN(e,t){const n=[];let i=-1;for(t&&n.push({type:"text",value:"\n"});++i<e.length;)i&&n.push({type:"text",value:"\n"}),n.push(e[i]);return t&&e.length>0&&n.push({type:"text",value:"\n"}),n}function AN(e){let t=0,n=e.charCodeAt(t);for(;9===n||32===n;)t++,n=e.charCodeAt(t);return e.slice(t)}function NN(e,t){const n=function(e,t){const n=t||EN,i=new Map,r=new Map,a=new Map,o={...iN,...n.handlers},s={all:function(e){const t=[];if("children"in e){const n=e.children;let i=-1;for(;++i<n.length;){const r=s.one(n[i],e);if(r){if(i&&"break"===n[i-1].type&&(Array.isArray(r)||"text"!==r.type||(r.value=AN(r.value)),!Array.isArray(r)&&"element"===r.type)){const e=r.children[0];e&&"text"===e.type&&(e.value=AN(e.value))}Array.isArray(r)?t.push(...r):t.push(r)}}}return t},applyData:TN,definitionById:i,footnoteById:r,footnoteCounts:a,footnoteOrder:[],handlers:o,one:function(e,t){const n=e.type,i=s.handlers[n];if(MN.call(s.handlers,n)&&i)return i(s,e,t);if(s.options.passThrough&&s.options.passThrough.includes(n)){if("children"in e){const{children:t,...n}=e,i=pN(n);return i.children=s.all(e),i}return pN(e)}return(s.options.unknownHandler||PN)(s,e,t)},options:n,patch:CN,wrap:kN};return wN(e,function(e){if("definition"===e.type||"footnoteDefinition"===e.type){const t="definition"===e.type?i:r,n=String(e.identifier).toUpperCase();t.has(n)||t.set(n,e)}}),s}(e,t),i=n.one(e,void 0),r=function(e){const t="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||mN,i=e.options.footnoteBackLabel||fN,r=e.options.footnoteLabel||"Footnotes",a=e.options.footnoteLabelTagName||"h2",o=e.options.footnoteLabelProperties||{className:["sr-only"]},s=[];let l=-1;for(;++l<e.footnoteOrder.length;){const r=e.footnoteById.get(e.footnoteOrder[l]);if(!r)continue;const a=e.all(r),o=String(r.identifier).toUpperCase(),c=kk(o.toLowerCase());let u=0;const d=[],h=e.footnoteCounts.get(o);for(;void 0!==h&&++u<=h;){d.length>0&&d.push({type:"text",value:" "});let e="string"==typeof n?n:n(l,u);"string"==typeof e&&(e={type:"text",value:e}),d.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+c+(u>1?"-"+u:""),dataFootnoteBackref:"",ariaLabel:"string"==typeof i?i:i(l,u),className:["data-footnote-backref"]},children:Array.isArray(e)?e:[e]})}const p=a[a.length-1];if(p&&"element"===p.type&&"p"===p.tagName){const e=p.children[p.children.length-1];e&&"text"===e.type?e.value+=" ":p.children.push({type:"text",value:" "}),p.children.push(...d)}else a.push(...d);const m={type:"element",tagName:"li",properties:{id:t+"fn-"+c},children:e.wrap(a,!0)};e.patch(r,m),s.push(m)}if(0!==s.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...pN(o),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:e.wrap(s,!0)},{type:"text",value:"\n"}]}}(n),a=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return r&&a.children.push({type:"text",value:"\n"},r),a}function RN(e,t){return e&&"run"in e?async function(n,i){const r=NN(n,{file:i,...t});await e.run(r,i)}:function(n,i){return NN(n,{file:i,...e||t})}}function LN(e){if(e)throw e}var IN=Object.prototype.hasOwnProperty,jN=Object.prototype.toString,DN=Object.defineProperty,UN=Object.getOwnPropertyDescriptor,ON=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===jN.call(e)},FN=function(e){if(!e||"[object Object]"!==jN.call(e))return!1;var t,n=IN.call(e,"constructor"),i=e.constructor&&e.constructor.prototype&&IN.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!i)return!1;for(t in e);return void 0===t||IN.call(e,t)},zN=function(e,t){DN&&"__proto__"===t.name?DN(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},BN=function(e,t){if("__proto__"===t){if(!IN.call(e,t))return;if(UN)return UN(e,t).value}return e[t]};const HN=Ve(function e(){var t,n,i,r,a,o,s=arguments[0],l=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},l=2),(null==s||"object"!=typeof s&&"function"!=typeof s)&&(s={});l<c;++l)if(null!=(t=arguments[l]))for(n in t)i=BN(s,n),s!==(r=BN(t,n))&&(u&&r&&(FN(r)||(a=ON(r)))?(a?(a=!1,o=i&&ON(i)?i:[]):o=i&&FN(i)?i:{},zN(s,{name:n,newValue:e(u,o,r)})):void 0!==r&&zN(s,{name:n,newValue:r}));return s});function VN(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}function WN(){const e=[],t={run:function(...t){let n=-1;const i=t.pop();if("function"!=typeof i)throw new TypeError("Expected function as last argument, not "+i);!function r(a,...o){const s=e[++n];let l=-1;if(a)i(a);else{for(;++l<t.length;)null!==o[l]&&void 0!==o[l]||(o[l]=t[l]);t=o,s?function(e,t){let n;return i;function i(...t){const i=e.length>t.length;let s;i&&t.push(r);try{s=e.apply(this,t)}catch(a){if(i&&n)throw a;return r(a)}i||(s&&s.then&&"function"==typeof s.then?s.then(o,r):s instanceof Error?r(s):o(s))}function r(e,...i){n||(n=!0,t(e,...i))}function o(e){r(null,e)}}(s,r)(...o):i(null,...o)}}(null,...t)},use:function(n){if("function"!=typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n);return e.push(n),t}};return t}const GN={basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');$N(e);let n,i=0,r=-1,a=e.length;if(void 0===t||0===t.length||t.length>e.length){for(;a--;)if(47===e.codePointAt(a)){if(n){i=a+1;break}}else r<0&&(n=!0,r=a+1);return r<0?"":e.slice(i,r)}if(t===e)return"";let o=-1,s=t.length-1;for(;a--;)if(47===e.codePointAt(a)){if(n){i=a+1;break}}else o<0&&(n=!0,o=a+1),s>-1&&(e.codePointAt(a)===t.codePointAt(s--)?s<0&&(r=a):(s=-1,r=o));i===r?r=o:r<0&&(r=e.length);return e.slice(i,r)},dirname:function(e){if($N(e),0===e.length)return".";let t,n=-1,i=e.length;for(;--i;)if(47===e.codePointAt(i)){if(t){n=i;break}}else t||(t=!0);return n<0?47===e.codePointAt(0)?"/":".":1===n&&47===e.codePointAt(0)?"//":e.slice(0,n)},extname:function(e){$N(e);let t,n=e.length,i=-1,r=0,a=-1,o=0;for(;n--;){const s=e.codePointAt(n);if(47!==s)i<0&&(t=!0,i=n+1),46===s?a<0?a=n:1!==o&&(o=1):a>-1&&(o=-1);else if(t){r=n+1;break}}if(a<0||i<0||0===o||1===o&&a===i-1&&a===r+1)return"";return e.slice(a,i)},join:function(...e){let t,n=-1;for(;++n<e.length;)$N(e[n]),e[n]&&(t=void 0===t?e[n]:t+"/"+e[n]);return void 0===t?".":function(e){$N(e);const t=47===e.codePointAt(0);let n=function(e,t){let n,i,r="",a=0,o=-1,s=0,l=-1;for(;++l<=e.length;){if(l<e.length)n=e.codePointAt(l);else{if(47===n)break;n=47}if(47===n){if(o===l-1||1===s);else if(o!==l-1&&2===s){if(r.length<2||2!==a||46!==r.codePointAt(r.length-1)||46!==r.codePointAt(r.length-2))if(r.length>2){if(i=r.lastIndexOf("/"),i!==r.length-1){i<0?(r="",a=0):(r=r.slice(0,i),a=r.length-1-r.lastIndexOf("/")),o=l,s=0;continue}}else if(r.length>0){r="",a=0,o=l,s=0;continue}t&&(r=r.length>0?r+"/..":"..",a=2)}else r.length>0?r+="/"+e.slice(o+1,l):r=e.slice(o+1,l),a=l-o-1;o=l,s=0}else 46===n&&s>-1?s++:s=-1}return r}(e,!t);0!==n.length||t||(n=".");n.length>0&&47===e.codePointAt(e.length-1)&&(n+="/");return t?"/"+n:n}(t)},sep:"/"};function $N(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const XN={cwd:function(){return"/"}};function qN(e){return Boolean(null!==e&&"object"==typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}function KN(e){if("string"==typeof e)e=new URL(e);else if(!qN(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if("file:"!==e.protocol){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return function(e){if(""!==e.hostname){const e=new TypeError('File URL host must be "localhost" or empty on darwin');throw e.code="ERR_INVALID_FILE_URL_HOST",e}const t=e.pathname;let n=-1;for(;++n<t.length;)if(37===t.codePointAt(n)&&50===t.codePointAt(n+1)){const e=t.codePointAt(n+2);if(70===e||102===e){const e=new TypeError("File URL path must not include encoded / characters");throw e.code="ERR_INVALID_FILE_URL_PATH",e}}return decodeURIComponent(t)}(e)}const YN=["history","path","basename","stem","extname","dirname"];class ZN{constructor(e){let t;t=e?qN(e)?{path:e}:"string"==typeof e||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)?{value:e}:e:{},this.cwd="cwd"in t?"":XN.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n,i=-1;for(;++i<YN.length;){const e=YN[i];e in t&&void 0!==t[e]&&null!==t[e]&&(this[e]="history"===e?[...t[e]]:t[e])}for(n in t)YN.includes(n)||(this[n]=t[n])}get basename(){return"string"==typeof this.path?GN.basename(this.path):void 0}set basename(e){QN(e,"basename"),JN(e,"basename"),this.path=GN.join(this.dirname||"",e)}get dirname(){return"string"==typeof this.path?GN.dirname(this.path):void 0}set dirname(e){eR(this.basename,"dirname"),this.path=GN.join(e||"",this.basename)}get extname(){return"string"==typeof this.path?GN.extname(this.path):void 0}set extname(e){if(JN(e,"extname"),eR(this.dirname,"extname"),e){if(46!==e.codePointAt(0))throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=GN.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){qN(e)&&(e=KN(e)),QN(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return"string"==typeof this.path?GN.basename(this.path,this.extname):void 0}set stem(e){QN(e,"stem"),JN(e,"stem"),this.path=GN.join(this.dirname||"",e+(this.extname||""))}fail(e,t,n){const i=this.message(e,t,n);throw i.fatal=!0,i}info(e,t,n){const i=this.message(e,t,n);return i.fatal=void 0,i}message(e,t,n){const i=new zP(e,t,n);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){if(void 0===this.value)return"";if("string"==typeof this.value)return this.value;return new TextDecoder(e||void 0).decode(this.value)}}function JN(e,t){if(e&&e.includes(GN.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+GN.sep+"`")}function QN(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function eR(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}const tR=function(e){const t=this.constructor.prototype,n=t[e],i=function(){return n.apply(i,arguments)};return Object.setPrototypeOf(i,t),i},nR={}.hasOwnProperty;class iR extends tR{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=WN()}copy(){const e=new iR;let t=-1;for(;++t<this.attachers.length;){const n=this.attachers[t];e.use(...n)}return e.data(HN(!0,{},this.namespace)),e}data(e,t){return"string"==typeof e?2===arguments.length?(sR("data",this.frozen),this.namespace[e]=t,this):nR.call(this.namespace,e)&&this.namespace[e]||void 0:e?(sR("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...n]=this.attachers[this.freezeIndex];if(!1===n[0])continue;!0===n[0]&&(n[0]=void 0);const i=t.call(e,...n);"function"==typeof i&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=uR(e),n=this.parser||this.Parser;return aR("parse",n),n(String(t),t)}process(e,t){const n=this;return this.freeze(),aR("process",this.parser||this.Parser),oR("process",this.compiler||this.Compiler),t?i(void 0,t):new Promise(i);function i(i,r){const a=uR(e),o=n.parse(a);function s(e,n){e||!n?r(e):i?i(n):t(void 0,n)}n.run(o,a,function(e,t,i){if(e||!t||!i)return s(e);const r=t,a=n.stringify(r,i);var o;"string"==typeof(o=a)||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(o)?i.value=a:i.result=a,s(e,i)})}}processSync(e){let t,n=!1;return this.freeze(),aR("processSync",this.parser||this.Parser),oR("processSync",this.compiler||this.Compiler),this.process(e,function(e,i){n=!0,LN(e),t=i}),cR("processSync","process",n),t}run(e,t,n){lR(e),this.freeze();const i=this.transformers;return n||"function"!=typeof t||(n=t,t=void 0),n?r(void 0,n):new Promise(r);function r(r,a){const o=uR(t);i.run(e,o,function(t,i,o){const s=i||e;t?a(t):r?r(s):n(void 0,s,o)})}}runSync(e,t){let n,i=!1;return this.run(e,t,function(e,t){LN(e),n=t,i=!0}),cR("runSync","run",i),n}stringify(e,t){this.freeze();const n=uR(t),i=this.compiler||this.Compiler;return oR("stringify",i),lR(e),i(e,n)}use(e,...t){const n=this.attachers,i=this.namespace;if(sR("use",this.frozen),null==e);else if("function"==typeof e)s(e,t);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");Array.isArray(e)?o(e):a(e)}return this;function r(e){if("function"==typeof e)s(e,[]);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");if(Array.isArray(e)){const[t,...n]=e;s(t,n)}else a(e)}}function a(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(e.plugins),e.settings&&(i.settings=HN(!0,i.settings,e.settings))}function o(e){let t=-1;if(null==e);else{if(!Array.isArray(e))throw new TypeError("Expected a list of plugins, not `"+e+"`");for(;++t<e.length;){r(e[t])}}}function s(e,t){let i=-1,r=-1;for(;++i<n.length;)if(n[i][0]===e){r=i;break}if(-1===r)n.push([e,...t]);else if(t.length>0){let[i,...a]=t;const o=n[r][1];VN(o)&&VN(i)&&(i=HN(!0,o,i)),n[r]=[e,i,...a]}}}}const rR=(new iR).freeze();function aR(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `parser`")}function oR(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `compiler`")}function sR(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function lR(e){if(!VN(e)||"string"!=typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function cR(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function uR(e){return function(e){return Boolean(e&&"object"==typeof e&&"message"in e&&"messages"in e)}(e)?e:new ZN(e)}const dR=[],hR={allowDangerousHtml:!0},pR=/^(https?|ircs?|mailto|xmpp)$/i,mR=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function fR(e){const t=function(e){const t=e.rehypePlugins||dR,n=e.remarkPlugins||dR,i=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...hR}:hR,r=rR().use(JA).use(n).use(RN,i).use(t);return r}(e),n=function(e){const t=e.children||"",n=new ZN;"string"==typeof t&&(n.value=t);return n}(e);return function(e,t){const n=t.allowedElements,i=t.allowElement,r=t.components,a=t.disallowedElements,o=t.skipHtml,s=t.unwrapDisallowed,l=t.urlTransform||gR;for(const u of mR)Object.hasOwn(t,u.from)&&xT((u.from,u.to&&u.to,u.id));return wN(e,c),XP(e,{Fragment:Ut.Fragment,components:r,ignoreInvalidStyle:!0,jsx:Ut.jsx,jsxs:Ut.jsxs,passKeys:!0,passNode:!0});function c(e,t,r){if("raw"===e.type&&r&&"number"==typeof t)return o?r.children.splice(t,1):r.children[t]={type:"text",value:e.value},t;if("element"===e.type){let t;for(t in ik)if(Object.hasOwn(ik,t)&&Object.hasOwn(e.properties,t)){const n=e.properties[t],i=ik[t];(null===i||i.includes(e.tagName))&&(e.properties[t]=l(String(n||""),t,e))}}if("element"===e.type){let o=n?!n.includes(e.tagName):!!a&&a.includes(e.tagName);if(!o&&i&&"number"==typeof t&&(o=!i(e,t,r)),o&&r&&"number"==typeof t)return s&&e.children?r.children.splice(t,1,...e.children):r.children.splice(t,1),t}}}(t.runSync(t.parse(n),n),e)}function gR(e){const t=e.indexOf(":"),n=e.indexOf("?"),i=e.indexOf("#"),r=e.indexOf("/");return-1===t||-1!==r&&t>r||-1!==n&&t>n||-1!==i&&t>i||pR.test(e.slice(0,t))?e:""}function vR({notes:e,onNotesChange:t}){const[n,i]=Pt.useState(!1),[r,a]=Pt.useState(e),o=Pt.useRef(null),s=Pt.useRef(null);Pt.useEffect(()=>{a(e)},[e]),Pt.useEffect(()=>{n&&o.current&&o.current.focus()},[n]);const l=Pt.useCallback(e=>{s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{t(e)},300)},[t]),c=e.trim().length>0;return Ut.jsxs("div",{className:"panel-notes-footer",children:[Ut.jsxs("div",{className:"panel-notes-header",children:[Ut.jsxs("div",{className:"panel-notes-title",children:[Ut.jsx(EC,{size:12}),Ut.jsx("span",{children:"Notes"}),c&&Ut.jsx("span",{className:"notes-indicator",children:""})]}),Ut.jsx("button",{className:"panel-notes-toggle",onClick:()=>{i(!n),n&&(s.current&&clearTimeout(s.current),t(r))},title:n?"View mode":"Edit mode",children:n?Ut.jsx(cC,{size:12}):Ut.jsx(kC,{size:12})})]}),n?Ut.jsx("textarea",{ref:o,className:"panel-notes-textarea",value:r,onChange:e=>{const t=e.target.value;a(t),l(t)},placeholder:"Add notes (supports Markdown)...",rows:3}):Ut.jsx("div",{className:"panel-notes-view",children:c?Ut.jsx(fR,{components:{p:({children:e})=>Ut.jsx("p",{className:"markdown-paragraph",children:e}),strong:({children:e})=>Ut.jsx("strong",{className:"markdown-bold",children:e}),em:({children:e})=>Ut.jsx("em",{className:"markdown-italic",children:e}),code:({children:e})=>Ut.jsx("code",{className:"markdown-code",children:e}),ul:({children:e})=>Ut.jsx("ul",{className:"markdown-list",children:e}),ol:({children:e})=>Ut.jsx("ol",{className:"markdown-list",children:e}),li:({children:e})=>Ut.jsx("li",{className:"markdown-list-item",children:e})},children:e}):Ut.jsx("span",{className:"panel-notes-placeholder",children:"Click edit to add notes..."})})]})}function yR({panelId:e,name:t,locked:n,selected:i=!1,onNameChange:r,onRemove:a,onMouseDown:o,dragHandleListeners:s={}}){const[l,c]=Pt.useState(!1),[u,d]=Pt.useState(t),h=Pt.useRef(null);Pt.useEffect(()=>{l&&h.current&&(h.current.focus(),h.current.select())},[l]),Pt.useEffect(()=>{d(t)},[t]);const p=()=>{const e=function(e){return e.replace(/[<>:"\/\\|?*]/g,"_").replace(/\.\./g,"_").replace(/^\s+|\s+$/g,"").substring(0,30)}(u);e&&e!==t&&r(e),c(!1),d(e||t)};return Ut.jsxs("div",{className:"panel-header "+(i?"selected":""),onMouseDown:o,children:[Ut.jsx("div",{className:"panel-drag-handle",title:"Drag to move panel",...s,children:Ut.jsx(gC,{size:16})}),Ut.jsxs("div",{className:"panel-name-container",children:[l?Ut.jsx("input",{ref:h,type:"text",className:"panel-name-input",value:u,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key?p():"Escape"===e.key&&(d(t),c(!1))},onBlur:()=>{p()},placeholder:`Panel_${String(e).padStart(2,"0")}`,maxLength:30}):Ut.jsx("span",{className:"panel-name "+(n?"locked":"editable"),onDoubleClick:()=>{n||c(!0)},title:n?"Panel locked (has generated images)":"Double-click to rename",children:t}),n&&Ut.jsx(SC,{size:12,className:"panel-lock-icon"})]}),Ut.jsx("div",{className:"panel-header-actions",children:Ut.jsx("button",{className:"panel-remove-btn",onClick:e=>{e.stopPropagation(),a()},title:"Remove panel",children:Ut.jsx($C,{size:14})})})]})}function _R({rating:e,onRatingChange:t,maxStars:n=5,size:i=14}){const[r,a]=Pt.useState(0);return Ut.jsx("div",{className:"star-rating",children:Array.from({length:n},(n,o)=>{const s=o+1,l=s<=(r||e);return Ut.jsx("button",{className:"star-btn "+(l?"filled":"empty"),onClick:()=>{var n;t((n=s)===e?0:n)},onMouseEnter:()=>a(s),onMouseLeave:()=>a(0),title:`${s} star${1!==s?"s":""}`,type:"button",children:Ut.jsx(HC,{size:i,fill:l?"currentColor":"none",strokeWidth:2})},s)})})}function xR({isOpen:e,onClose:t,projectName:n="Untitled Project",selectedPanelIds:i=[],panels:r}){const[a,o]=Pt.useState(3),[s,l]=Pt.useState("all"),[c,u]=Pt.useState(new Set),[d,h]=Pt.useState("a4"),[p,m]=Pt.useState("landscape"),f=Pt.useRef(null),[g,v]=Pt.useState("");Pt.useEffect(()=>{e&&(i.length>0?(l("selected"),u(new Set(i))):(l("all"),u(new Set(r.filter(e=>e.image).map(e=>e.id)))))},[e,r,i]);const y="all"===s?r.filter(e=>e.image):r.filter(e=>e.image&&c.has(e.id)),_=r.filter(e=>e.image),x=Pt.useCallback(e=>{u(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},[]),b=Pt.useCallback(()=>{u(new Set(r.filter(e=>e.image).map(e=>e.id)))},[r]),S=Pt.useCallback(()=>{u(new Set)},[]),w=Pt.useCallback(()=>{const e=Math.floor(100/a),t=a<=2?11:9,i="a4"===d?"landscape"===p?"size: A4 landscape;":"size: A4 portrait;":"landscape"===p?"size: letter landscape;":"size: letter portrait;",r=y.map(t=>{const n=t.name||`Panel ${t.id}`,i=t.rating&&t.rating>0?`<span class="cell-rating">${"".repeat(t.rating)}${"".repeat(5-t.rating)}</span>`:"",r=t.notes&&t.notes.trim()?`<div class="cell-notes">${bR(t.notes)}</div>`:"",a=t.imageHistory&&t.imageHistory.length>0?t.imageHistory[0]:null;let o="";if(a){const e=[];null!=a.metadata.version&&e.push(`v${a.metadata.version}`),a.metadata.generationTime&&e.push(`${a.metadata.generationTime.toFixed(1)}s`),a.metadata.workflowName&&e.push(bR(a.metadata.workflowName)),e.length>0&&(o=`<div class="cell-meta">${e.join("  ")}</div>`)}return`\n        <div class="cell" style="width:${e}%">\n          <div class="cell-inner">\n            <div class="cell-header">\n              <span class="cell-label">${bR(n)}</span>\n              ${i}\n            </div>\n            <img src="${t.image}" />\n            ${o}\n            ${r}\n          </div>\n        </div>`}).join("\n");return`<!DOCTYPE html>\n<html>\n<head>\n<meta charset="utf-8"/>\n<title>${bR(n)}  Storyboard</title>\n<style>\n  @page { ${i} margin: 10mm; }\n  * { box-sizing: border-box; margin: 0; padding: 0; }\n  body {\n    font-family: 'Segoe UI', 'Inter', Arial, sans-serif;\n    background: #fff;\n    color: #1a1a1a;\n    -webkit-print-color-adjust: exact;\n    print-color-adjust: exact;\n  }\n  .header {\n    text-align: center;\n    padding: 8px 0 6px;\n    border-bottom: 2px solid #222;\n    margin-bottom: 8px;\n  }\n  .header h1 { font-size: 18px; font-weight: 600; }\n  .header .subtitle { font-size: 10px; color: #888; margin-top: 2px; }\n  .grid {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0;\n  }\n  .cell {\n    padding: 4px;\n    break-inside: avoid;\n  }\n  .cell-inner {\n    border: 1px solid #d0d0d0;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fafafa;\n  }\n  .cell-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 3px 6px;\n    background: #222;\n    color: #fff;\n  }\n  .cell-label {\n    font-size: 9px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n  .cell-rating {\n    font-size: 10px;\n    color: #e0b967;\n  }\n  .cell-inner img {\n    display: block;\n    width: 100%;\n    height: auto;\n    object-fit: contain;\n  }\n  .cell-meta {\n    padding: 2px 6px;\n    font-size: 8px;\n    color: #888;\n    background: #f0f0f0;\n    border-top: 1px solid #e0e0e0;\n  }\n  .cell-notes {\n    padding: 4px 6px;\n    font-size: ${t}px;\n    line-height: 1.35;\n    color: #333;\n    background: #f4f4f4;\n    border-top: 1px solid #e0e0e0;\n    white-space: pre-wrap;\n    word-break: break-word;\n  }\n  @media print {\n    body { background: #fff; }\n    .header { page-break-after: avoid; }\n    .cell { break-inside: avoid; }\n  }\n</style>\n</head>\n<body>\n  <div class="header">\n    <h1>${bR(n)}</h1>\n    <div class="subtitle">${y.length} panel${1!==y.length?"s":""}  ${(new Date).toLocaleDateString()}</div>\n  </div>\n  <div class="grid">\n    ${r}\n  </div>\n</body>\n</html>`},[y,a,n,d,p]);Pt.useEffect(()=>{e&&v(w())},[e,w]),Pt.useEffect(()=>{const e=f.current;if(!e||!g)return;const t=e.contentDocument;t&&(t.open(),t.write(g),t.close())},[g]);const M=Pt.useCallback(()=>{const e=f.current;(null==e?void 0:e.contentWindow)&&(e.contentWindow.focus(),e.contentWindow.print())},[]);return e?Ut.jsx("div",{className:"print-dialog-overlay",onClick:t,children:Ut.jsxs("div",{className:"print-dialog",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"print-dialog-header",children:[Ut.jsxs("h2",{children:[Ut.jsx(LC,{size:18}),"Print Storyboard"]}),Ut.jsx("button",{className:"close-btn",onClick:t,children:Ut.jsx($C,{size:18})})]}),Ut.jsxs("div",{className:"print-toolbar",children:[Ut.jsxs("div",{className:"print-toolbar-group",children:[Ut.jsx("span",{className:"toolbar-label",children:"Grid:"}),[1,2,3,4].map(e=>Ut.jsxs("button",{className:"grid-btn "+(a===e?"active":""),onClick:()=>o(e),children:[e," col"]},e))]}),Ut.jsxs("div",{className:"print-toolbar-group",children:[Ut.jsx("span",{className:"toolbar-label",children:"Page:"}),Ut.jsxs("select",{className:"page-select",value:d,onChange:e=>h(e.target.value),children:[Ut.jsx("option",{value:"a4",children:"A4"}),Ut.jsx("option",{value:"letter",children:"Letter"})]}),Ut.jsxs("select",{className:"page-select",value:p,onChange:e=>m(e.target.value),children:[Ut.jsx("option",{value:"landscape",children:"Landscape"}),Ut.jsx("option",{value:"portrait",children:"Portrait"})]})]}),Ut.jsxs("div",{className:"print-toolbar-group",children:[Ut.jsx("span",{className:"toolbar-label",children:"Panels:"}),Ut.jsxs("button",{className:"mode-btn "+("all"===s?"active":""),onClick:()=>l("all"),children:["All (",_.length,")"]}),Ut.jsxs("button",{className:"mode-btn "+("selected"===s?"active":""),onClick:()=>l("selected"),children:["Selected (",c.size,")"]})]}),Ut.jsxs("button",{className:"print-action-btn",onClick:M,disabled:0===y.length,children:[Ut.jsx(LC,{size:16})," Print"]})]}),"selected"===s&&Ut.jsxs("div",{className:"print-panel-selector",children:[Ut.jsxs("div",{className:"selector-actions",children:[Ut.jsx("button",{onClick:b,className:"selector-action-btn",children:"Select All"}),Ut.jsx("button",{onClick:S,className:"selector-action-btn",children:"Deselect All"})]}),Ut.jsx("div",{className:"panel-chips",children:_.map(e=>Ut.jsxs("button",{className:"panel-chip "+(c.has(e.id)?"selected":""),onClick:()=>x(e.id),children:[c.has(e.id)?Ut.jsx(zC,{size:14}):Ut.jsx(BC,{size:14}),Ut.jsx("span",{className:"chip-thumb",children:e.image&&Ut.jsx("img",{src:e.image,alt:""})}),Ut.jsx("span",{children:e.name||`Panel ${e.id}`})]},e.id))})]}),Ut.jsx("div",{className:"print-preview-container",children:0===y.length?Ut.jsxs("div",{className:"print-empty",children:[Ut.jsx("p",{children:"No panels selected for printing."}),Ut.jsx("p",{className:"hint",children:'Choose panels with images above, or switch to "All" mode.'})]}):Ut.jsx("iframe",{ref:f,className:"print-preview-iframe",title:"Print Preview"})})]})}):null}function bR(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function SR({nodeName:e,progress:t,status:n,phase:i,currentNode:r,nodesExecuted:a,totalNodes:o}){const s="running"===n?`${t}%`:"pending"===n?"Queued":"complete"===n?"Done":"error"===n?"Error":n,l=[];i&&l.push(i),r&&l.push(r);const c=l.length>0?l.join("  "):void 0,u=null!=a&&null!=o&&o>0?`Step ${a}/${o}`:void 0;return Ut.jsxs("div",{className:"gen-progress-job",children:[Ut.jsxs("div",{className:"gen-progress-job-header",children:[Ut.jsx("span",{className:"gen-progress-node-name",children:e}),Ut.jsx("span",{className:`gen-progress-status ${n}`,children:s})]}),(c||u)&&Ut.jsxs("div",{className:"gen-progress-stage",children:[c&&Ut.jsx("span",{children:c}),c&&u&&Ut.jsx("span",{className:"gen-progress-stage-sep",children:"  "}),u&&Ut.jsx("span",{className:"gen-progress-node-counter",children:u})]}),Ut.jsx("div",{className:"gen-progress-bar-track",children:Ut.jsx("div",{className:`gen-progress-bar-fill ${n}`,style:{width:`${Math.min(100,t)}%`}})})]})}function wR({panels:e,onCancelSingle:t,onCancelParallelJob:n}){const i=e.filter(e=>"generating"===e.status);return 0===i.length?null:Ut.jsxs("div",{className:"gen-progress-section",children:[Ut.jsxs("div",{className:"gen-progress-header",children:[Ut.jsx("span",{className:"gen-progress-title",children:"Generation Progress"}),Ut.jsxs("span",{className:"gen-progress-count",children:[i.length," active"]})]}),i.map(e=>{const i=e.name||`Panel ${e.id}`,r=e.parallelJobs&&e.parallelJobs.length>0;return Ut.jsxs("div",{className:"gen-progress-panel-card",children:[Ut.jsxs("div",{className:"gen-progress-panel-header",children:[Ut.jsx("span",{className:"gen-progress-panel-name",children:i}),!r&&t&&Ut.jsx("button",{className:"gen-progress-cancel-btn",onClick:()=>t(e.id),title:"Cancel generation",children:""})]}),r?e.parallelJobs.filter(e=>"complete"!==e.status).map(t=>Ut.jsxs("div",{className:"gen-progress-job-wrapper",children:[Ut.jsx(SR,{nodeName:t.nodeName,progress:t.progress,status:t.status,phase:t.progressPhase,currentNode:t.currentNodeName,nodesExecuted:t.nodesExecuted,totalNodes:t.totalNodes}),n&&"running"===t.status&&Ut.jsx("button",{className:"gen-progress-cancel-job-btn",onClick:()=>n(e.id,t.nodeId),title:`Cancel on ${t.nodeName}`,children:""})]},`${e.id}-${t.nodeId}`)):Ut.jsx(SR,{nodeName:"Render Node",progress:e.progress,status:"running",phase:e.progressPhase,currentNode:e.progressNodeName,nodesExecuted:e.progressNodesExecuted,totalNodes:e.progressTotalNodes})]},e.id)})]})}const MR=new class{constructor(){je(this,"baseUrl","/api/workflows")}async loadAll(){const e=await fetch(this.baseUrl,{signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to load workflows: HTTP ${e.status}`);return e.json()}async save(e){const t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`Failed to save workflow: HTTP ${t.status}`)}return t.json()}async saveAll(e){const t=await fetch(`${this.baseUrl}/bulk`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({workflows:e}),signal:AbortSignal.timeout(15e3)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`Failed to bulk save workflows: HTTP ${t.status}`)}return t.json()}async update(e,t){const n=await fetch(`${this.baseUrl}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.detail||`Failed to update workflow: HTTP ${n.status}`)}return n.json()}async delete(e){const t=await fetch(`${this.baseUrl}/${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||`Failed to delete workflow: HTTP ${t.status}`)}return t.json()}async getStorageInfo(){const e=await fetch(`${this.baseUrl}/storage-info`);if(!e.ok)throw new Error(`Failed to get storage info: HTTP ${e.status}`);return e.json()}};function ER(e,t){if(e)return e.length<=t?e:e.substring(0,t-3)+"..."}function CR(e,t=.1,n=5){return Math.max(t,Math.min(n,e))}function TR(e){if(!e)return;const t="string"==typeof e?new Date(e):e;return isNaN(t.getTime())?void 0:t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function PR(e){if(e.includes("\\")||e.includes("/"))return e.split(/[\\\/]/).pop()||"";const t=e.match(/path=([^&]+)/);return t?decodeURIComponent(t[1]).split(/[\\\/]/).pop()||"":e}function kR(e,t){return 320*((e-1)%3)}function AR(e,t){return 320*Math.floor((e-1)/3)}const NR=new Set(["KSampler","KSamplerAdvanced","KSampler (Efficient)","SamplerCustom","SamplerCustomAdvanced","KSamplerSelect","SamplerDPMPP_2M_SDE","ADE_AnimateDiffSampler","ADE_AnimateDiffSamplerAdvanced","FreeU_V2","SamplerDPMPP_3M_SDE","WanSampler","HunyuanSampler","Efficient Loader","ImpactKSamplerBasicPipe","ImpactKSamplerAdvancedBasicPipe"]);function RR(e){const t={},n=[];for(const[i,r]of Object.entries(e)){if("object"!=typeof r||null===r)continue;const e=r.class_type||"";t[i]=e,(NR.has(e)||e.toLowerCase().includes("ksampler")||e.toLowerCase().includes("sampler"))&&n.push(i)}return{totalNodes:Object.keys(e).length,samplerNodeIds:n,nodeTypes:t}}const LR=["Image Generation","Text to Image","Image to Image","InPainting","Image Editing","Upscaling","Video Generation"],IR={text2img:"Text to Image",img2img:"Image to Image",inpainting:"InPainting",editing:"Image Editing",upscale:"Upscaling",video:"Video Generation"};function jR(){var e,t,n,i,r,a,o,s,l,c,u;const{showError:d,showWarning:h,showInfo:p,notifications:m,removeNotification:f}=function(){const[e,t]=Pt.useState([]),n=Pt.useRef(new Set);return{showError:Pt.useCallback(e=>{if(!DE("error",e))return"";IE+=1;const n=`${Date.now()}-${IE}`;return t(t=>[...t,{id:n,message:e,type:"error"}]),n},[]),showWarning:Pt.useCallback(e=>{if(!DE("warning",e))return"";IE+=1;const n=`${Date.now()}-${IE}`;return t(t=>[...t,{id:n,message:e,type:"warning"}]),n},[]),showInfo:Pt.useCallback(e=>{if(!DE("info",e))return"";IE+=1;const n=`${Date.now()}-${IE}`;return t(t=>[...t,{id:n,message:e,type:"info"}]),n},[]),notifications:e,removeNotification:Pt.useCallback(e=>{n.current.delete(e),t(t=>t.filter(t=>t.id!==e))},[])}}(),[g,v]=Pt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).activeTab??"image-generation"}catch{}return"image-generation"}),[y,_]=Pt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).activeSubTab??"text2img"}catch{}return"text2img"}),[x,b]=Pt.useState(null),[S,w]=Pt.useState(()=>[{id:1,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:0,y:0,width:300,height:300},{id:2,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:320,y:0,width:300,height:300},{id:3,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:640,y:0,width:300,height:300},{id:4,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:0,y:320,width:300,height:300},{id:5,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:320,y:320,width:300,height:300},{id:6,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:640,y:320,width:300,height:300}]),[M,E]=Pt.useState(null),[C,T]=Pt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).canvasZoom??1}catch{}return 1}),[P,k]=Pt.useState({x:0,y:0}),[A,N]=Pt.useState(!1),[R,L]=Pt.useState({x:0,y:0}),[I,j]=Pt.useState(null),[D,U]=Pt.useState({x:0,y:0,width:0,height:0}),[O,F]=Pt.useState(null),[z,B]=Pt.useState({x:0,y:0,panelX:0,panelY:0,selectedPanelPositions:new Map}),[H,V]=Pt.useState(!1),[W,G]=Pt.useState({x:0,y:0}),[$,X]=Pt.useState({x:0,y:0}),[q,K]=Pt.useState([]),[,Y]=Pt.useState(null),[Z,J]=Pt.useState(!1),[Q,ee]=Pt.useState(!1),[te,ne]=Pt.useState(""),ie=Pt.useRef(null),re=Pt.useRef(!1),ae=Pt.useRef(new Map),[oe,se]=Pt.useState([]),le=Pt.useRef(!1),[ce,ue]=Pt.useState(null),[de,he]=Pt.useState(!1),[pe,me]=Pt.useState(null),[fe,ge]=Pt.useState(!1),[ve,ye]=Pt.useState(!1),[_e,xe]=Pt.useState(!1),[be,Se]=Pt.useState(null),[we,Me]=Pt.useState(""),[Ee,Ce]=Pt.useState({}),[Te,Pe]=Pt.useState({}),[ke,Ae]=Pt.useState(""),[Ne,Re]=Pt.useState(!1),[Le,Ie]=Pt.useState(!1),[je,De]=Pt.useState(null),[Ue,Oe]=Pt.useState(null),[Fe,ze]=Pt.useState(1),[Be,He]=Pt.useState({x:0,y:0}),[Ve,We]=Pt.useState(!1),[Ge,$e]=Pt.useState(null),[Xe,qe]=Pt.useState(50),Ke=Pt.useRef(null),[Ye,Ze]=Pt.useState({visible:!1,x:0,y:0,panelId:null}),[Je,Qe]=Pt.useState(()=>!function(e=768){return window.innerWidth<e}(768)),[et,tt]=Pt.useState(!1),[nt,it]=Pt.useState(),[rt,at]=Pt.useState(),[ot,st]=Pt.useState(null),[lt,ct]=Pt.useState(!1),[ut,dt]=Pt.useState("actual"),ht=Pt.useRef(null),[pt,mt]=Pt.useState(`${window.location.protocol}//${window.location.hostname}:8188`),[ft,gt]=Pt.useState("disconnected"),[vt,yt]=Pt.useState(null),[_t,xt]=Pt.useState([]),[bt,St]=Pt.useState("ALL"),[wt,Mt]=Pt.useState(!0),[Et,Ct]=Pt.useState(!1),Tt=Pt.useRef(null),[kt,At]=Pt.useState(!1),[Nt,Rt]=Pt.useState(!1),Lt=WE(),It=Pt.useRef(null),jt=Pt.useRef(new Set),Dt=Pt.useRef(new Set),Ot=Pt.useRef(new Map),Ft=Pt.useRef(new Set),zt=Pt.useRef(0),Bt=Pt.useRef(Ee),Ht=Pt.useRef(M),Vt=Pt.useRef(S);Bt.current=Ee,Ht.current=M,Vt.current=S;const Wt=Pt.useCallback((e,t)=>{t.preventDefault(),t.stopPropagation();const n=S.find(t=>t.id===e);n&&(j(e),U({x:t.clientX,y:t.clientY,width:n.width,height:n.height}))},[S]),Gt=Pt.useCallback(e=>{if(null===I)return;const t=e.clientX-D.x,n=e.clientY-D.y,i=Math.max(200,D.width+t),r=Math.max(200,D.height+n);w(e=>e.map(e=>e.id===I?{...e,width:i,height:r}:e))},[I,D]),$t=Pt.useCallback(()=>{j(null),U({x:0,y:0,width:0,height:0})},[]);Pt.useEffect(()=>{if(null!==I)return window.addEventListener("mousemove",Gt),window.addEventListener("mouseup",$t),()=>{window.removeEventListener("mousemove",Gt),window.removeEventListener("mouseup",$t)}},[I,Gt,$t]);const Xt=Pt.useCallback(e=>{w(t=>t.map(t=>t.id===e?{...t,selected:!t.selected}:t))},[]),qt=Pt.useCallback((e,t)=>{const n=t.target;if("BUTTON"===n.tagName||"INPUT"===n.tagName||n.closest("button"))return;if(t.ctrlKey||t.metaKey||t.shiftKey)return t.preventDefault(),t.stopPropagation(),void Xt(e);t.preventDefault(),t.stopPropagation();const i=S.find(t=>t.id===e);if(!i)return;F(e);const r=new Map;i.selected&&S.filter(e=>e.selected).forEach(e=>{r.set(e.id,{x:e.x,y:e.y})}),B({x:t.clientX,y:t.clientY,panelX:i.x,panelY:i.y,selectedPanelPositions:r}),w(t=>t.map(t=>t.id===e?{...t,zIndex:100}:t))},[S,Xt]),Kt=Pt.useCallback(e=>{if(null===O)return;const t=(e.clientX-z.x)/C,n=(e.clientY-z.y)/C,i=z.panelX+t,r=z.panelY+n,a=z.selectedPanelPositions.size>1;w(e=>e.map(e=>{if(e.id===O)return{...e,x:i,y:r};if(a&&e.selected&&e.id!==O){const i=z.selectedPanelPositions.get(e.id);if(i)return{...e,x:i.x+t,y:i.y+n}}return e}))},[O,z,C]),Yt=Pt.useCallback(()=>{null!==O&&w(e=>e.map(e=>e.id===O?{...e,zIndex:void 0}:e)),F(null),B({x:0,y:0,panelX:0,panelY:0,selectedPanelPositions:new Map})},[O]);Pt.useEffect(()=>{if(null!==O)return window.addEventListener("mousemove",Kt),window.addEventListener("mouseup",Yt),()=>{window.removeEventListener("mousemove",Kt),window.removeEventListener("mouseup",Yt)}},[O,Kt,Yt]);const Zt=Pt.useCallback(e=>{const t=S.find(t=>t.id===e);if(!t)return;if(t.imageHistory.length>0)Y({open:!0,title:"Remove Panel",message:`Remove "${t.name||`Panel_${String(e).padStart(2,"0")}`}"?\n\nThis panel has ${t.imageHistory.length} generated image(s). This action cannot be undone.`,onConfirm:()=>{if(w(t=>t.filter(t=>t.id!==e)),M===e){const t=S.filter(t=>t.id!==e);E(t.length>0?t[0].id:null)}Y(null)},onCancel:()=>Y(null)});else if(w(t=>t.filter(t=>t.id!==e)),M===e){const t=S.filter(t=>t.id!==e);E(t.length>0?t[0].id:null)}},[S,M]),Jt=Pt.useCallback(e=>{const t=S.filter(e=>e.selected);if(t.length<2)return;let n;switch(e){case"left":n=Math.min(...t.map(e=>e.x));break;case"right":n=Math.max(...t.map(e=>e.x+e.width));break;case"top":n=Math.min(...t.map(e=>e.y));break;case"bottom":n=Math.max(...t.map(e=>e.y+e.height))}w(t=>t.map(t=>{if(!t.selected)return t;switch(e){case"left":return{...t,x:n};case"right":return{...t,x:n-t.width};case"top":return{...t,y:n};case"bottom":return{...t,y:n-t.height};default:return t}}))},[S]),Qt=Pt.useCallback(e=>{const t=S.filter(e=>e.selected);if(t.length<3)return;const n=[...t].sort((t,n)=>"horizontal"===e?t.x-n.x:t.y-n.y),i=n[0],r=n[n.length-1];let a,o;"horizontal"===e?(a=r.x+r.width-i.x,o=n.reduce((e,t)=>e+t.width,0)):(a=r.y+r.height-i.y,o=n.reduce((e,t)=>e+t.height,0));const s=(a-o)/(n.length-1);w(t=>{let r="horizontal"===e?i.x:i.y;const a=new Map;return n.forEach((t,i)=>{if(0===i)r+="horizontal"===e?t.width:t.height;else if(i===n.length-1);else{const n=r+s;a.set(t.id,{x:"horizontal"===e?n:t.x,y:"vertical"===e?n:t.y}),r=n+("horizontal"===e?t.width:t.height)}}),t.map(e=>{if(!e.selected)return e;const t=a.get(e.id);return t?{...e,...t}:e})})},[S]),en=Pt.useCallback(async e=>{var t;e.preventDefault(),e.stopPropagation();const n=e.dataTransfer.items;if(n)for(let i=0;i<n.length;i++){const e=n[i];if("file"===e.kind){const n=null==(t=e.webkitGetAsEntry)?void 0:t.call(e);if(null==n?void 0:n.isDirectory){const e=n.name;ne(e),ee(!0);break}}}},[]),tn=Pt.useCallback((e,t)=>{const n={id:String(++zt.current),timestamp:new Date,tag:e,message:t};xt(e=>[...e.slice(-499),n])},[]),[nn,rn]=Pt.useState([]),[an,on]=Pt.useState(!1),[sn,ln]=function(){const[e,t]=Pt.useState(cT.getProject());return[e,Pt.useCallback(e=>{cT.setProject(e),t(cT.getProject())},[])]}(),[cn,un]=Pt.useState(new Set),[dn,hn]=Pt.useState(!1),[pn,mn]=Pt.useState({progress:0,currentFile:""}),[fn,gn]=Pt.useState(null),[vn,yn]=Pt.useState(!1),[_n,xn]=Pt.useState(new Set),[bn,Sn]=Pt.useState(!1);Pt.useEffect(()=>{const e=e=>{"Shift"===e.key&&J(!0)},t=e=>{"Shift"===e.key&&(J(!1),K([]))};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),Pt.useEffect(()=>{const e=()=>{HE(),VE.stopPolling()};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e),HE(),VE.stopPolling()}},[]),Pt.useEffect(()=>(sn.orchestratorUrl&&(VE.fetchBackendsFromAPI(sn.orchestratorUrl),VE.startPolling(5e3),setTimeout(()=>{VE.getNodes().forEach(e=>VE.pollNode(e))},100)),()=>{VE.stopPolling()}),[sn.orchestratorUrl]),Pt.useEffect(()=>{(async()=>{if(!sn.orchestratorUrl)return xn(new Set),void Sn(!1);const e=[{path:"/api/health",method:"GET"},{path:"/api/scan-project-images",method:"POST",body:JSON.stringify({folder_path:"",naming_pattern:"",project_name:""})},{path:"/api/serve-image",method:"GET"},{path:"/api/delete-image",method:"DELETE",body:JSON.stringify({file_path:""})}],t=new Set;for(const n of e)try{const e=await fetch(`${sn.orchestratorUrl}${n.path}`,{method:n.method,headers:n.body?{"Content-Type":"application/json"}:void 0,body:n.body,signal:AbortSignal.timeout(5e3)});404!==e.status&&405!==e.status&&t.add(n.path)}catch{}xn(t),Sn(!0),t.has("/api/scan-project-images")||h("Orchestrator server is running but project scanning endpoints are not available. Please update the Orchestrator server to the latest version for full functionality.")})()},[sn.orchestratorUrl]);const[wn,Mn]=Pt.useState(null),[En,Cn]=Pt.useState(!1),[Tn,Pn]=Pt.useState([]),[kn,An]=Pt.useState(""),[Nn,Rn]=Pt.useState(!1),[Ln,In]=Pt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).leftPanelWidth??250}catch{}return 250}),[jn,Dn]=Pt.useState(()=>{const e=localStorage.getItem("storyboard-ui-state");if(e)try{return JSON.parse(e).rightPanelWidth??200}catch{}return 200}),[Un,On]=Pt.useState(!1),[Fn,zn]=Pt.useState(!1);Pt.useEffect(()=>{const e=e=>{if(Un){const t=Math.max(150,Math.min(500,e.clientX));In(t)}if(Fn){const t=Math.max(150,Math.min(400,window.innerWidth-e.clientX));Dn(t)}},t=()=>{On(!1),zn(!1),document.body.style.cursor="",document.body.style.userSelect=""};return(Un||Fn)&&(document.body.style.cursor="col-resize",document.body.style.userSelect="none",document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[Un,Fn]),Pt.useEffect(()=>{const e=()=>{x&&b(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[x]),Pt.useEffect(()=>{wt&&Tt.current&&Tt.current.scrollIntoView({behavior:"smooth"})},[_t,wt]),Pt.useEffect(()=>{(async()=>{try{const t=await MR.loadAll();if(t.workflows&&t.workflows.length>0){const{migrated:e,changed:n}=(e=>{let t=!1;return{migrated:e.map(e=>{var n,i;let r=!1;const a=(null==(n=e.config)?void 0:n.map(e=>{var t;return"image_input"===e.category&&(null==(t=e.name)?void 0:t.includes("video"))&&"image"===e.type?(r=!0,{...e,type:"video"}):e}))||[],o=e.parsed?{...e.parsed,image_inputs:(null==(i=e.parsed.image_inputs)?void 0:i.map(e=>{var t;return(null==(t=e.name)?void 0:t.includes("video"))&&"video"!==e.type?(r=!0,{...e,type:"video"}):e}))||[]}:e.parsed;return r?(t=!0,{...e,config:a,parsed:o}):e}),changed:t}})(t.workflows);se(e),n&&(console.log('[Workflows] Migrated video input types from "image" to "video" in stored workflows'),await MR.saveAll(e).catch(e=>console.warn("[Workflows] Failed to persist video type migration:",e))),ce||ue(t.workflows[0].id),console.log(`[Workflows] Loaded ${t.count} workflows from ${t.storage_path}`)}else{const t=localStorage.getItem("storyboard_workflows");if(t)try{const e=JSON.parse(t);Array.isArray(e)&&e.length>0&&(console.log(`[Workflows] Migrating ${e.length} workflows from localStorage to backend...`),se(e),ce||ue(e[0].id),await MR.saveAll(e),localStorage.removeItem("storyboard_workflows"),console.log("[Workflows] Migration complete  localStorage cleared"))}catch(e){console.error("[Workflows] Failed to migrate from localStorage:",e)}}}catch(t){console.error("[Workflows] Failed to load from backend, falling back to localStorage:",t);const n=localStorage.getItem("storyboard_workflows");if(n)try{const e=JSON.parse(n);se(e),e.length>0&&!ce&&ue(e[0].id)}catch(e){console.error("[Workflows] localStorage fallback also failed:",e)}}le.current=!0})(),VE.loadFromStorage()},[]),Pt.useEffect(()=>{if(!le.current)return;const e=setTimeout(()=>{MR.saveAll(oe).catch(e=>{console.error("[Workflows] Failed to save to backend:",e)})},500);return()=>clearTimeout(e)},[oe]),Pt.useEffect(()=>{Le&&Ke.current&&Ke.current.focus()},[Le]),Pt.useEffect(()=>{const e={leftPanelWidth:Ln,rightPanelWidth:jn,canvasZoom:C,activeTab:g,activeSubTab:y};localStorage.setItem("storyboard-ui-state",JSON.stringify(e))},[Ln,jn,C,g,y]),Pt.useEffect(()=>{if(re.current)return re.current=!1,void console.log("[Effect] Skipping parameter reset (skipParameterReset was true)");const e=oe.find(e=>e.id===ce);if(e){console.log("[Effect] Workflow change detected, resetting parameters to defaults for workflow:",ce);const t={},n=Bt.current;e.config.forEach(e=>{if(e.exposed){("image_input"===e.category||"prompt"===e.name||"prompt"===e.input_name)&&void 0!==n[e.name]?t[e.name]=n[e.name]:t[e.name]=e.default}}),Bt.current=t,Ce(t)}},[ce]),Pt.useEffect(()=>{var e;if(!Ue||!Le)return void st(null);const t=S.find(e=>e.id===Ue),n=null==t?void 0:t.imageHistory[(null==t?void 0:t.historyIndex)??0];if(!n)return void st(null);if((null==(e=n.metadata)?void 0:e.promptSummary)&&n.metadata.promptSummary.length>0)return void st(null);if(!n.url.includes("/api/serve-image"))return void st(null);const i=new URLSearchParams(n.url.split("?")[1]).get("path");if(!i)return void st(null);(async()=>{ct(!0);try{const e=cT.getProject().orchestratorUrl||oT(),t=await fetch(`${e}/api/png-metadata?path=${encodeURIComponent(i)}`);if(t.ok){const e=await t.json();e.success?st({prompt:e.prompt,workflow:e.workflow,parameters:e.parameters}):(console.warn("[PNG Metadata] Failed to extract:",e.error),st(null))}else console.warn("[PNG Metadata] Request failed:",t.status),st(null)}catch(e){console.error("[PNG Metadata] Error:",e),st(null)}finally{ct(!1)}})()},[Ue,Le,S]),Pt.useEffect(()=>{if(!je||!Le)return it(void 0),void at(void 0);(async()=>{try{const e=await fetch(je);if(e.ok){const t=await e.blob();at(t.size);const n=URL.createObjectURL(t),i=new Image;i.onload=()=>{it({width:i.naturalWidth,height:i.naturalHeight}),URL.revokeObjectURL(n)},i.onerror=()=>{it(void 0),URL.revokeObjectURL(n)},i.src=n}else at(void 0),it(void 0)}catch{at(void 0),it(void 0)}})()},[je,Le]);const Bn=Pt.useCallback(()=>{Ie(!1),ze(1),He({x:0,y:0}),We(!1),$e(null),tt(!1),dt("actual")},[]),Hn=Pt.useCallback(e=>{if(!Ue)return;const t=S.find(e=>e.id===Ue);if(!t||t.imageHistory.length<=1)return;const n=Math.max(0,Math.min(t.imageHistory.length-1,t.historyIndex+e));if(n===t.historyIndex)return;const i=t.imageHistory[n];i&&(w(e=>e.map(e=>e.id===Ue?{...e,historyIndex:n,image:i.url}:e)),De(i.url),dt("actual"),He({x:0,y:0}))},[Ue,S]),Vn=Pt.useCallback(()=>{dt("custom"),ze(e=>CR(1.25*e))},[]),Wn=Pt.useCallback(()=>{dt("custom"),ze(e=>CR(e/1.25))},[]),Gn=Pt.useCallback(()=>{if(dt("fit"),He({x:0,y:0}),nt&&ht.current){const e=ht.current,t=function(e,t,n,i,r=20){const a=(n-2*r)/e,o=(i-2*r)/t;return Math.min(a,o,1)}(nt.width,nt.height,e.clientWidth,e.clientHeight,Je?40:20);ze(t)}else ze(.8)},[nt,Je]),$n=Pt.useCallback(()=>{dt("actual"),ze(1),He({x:0,y:0})},[]),Xn=Pt.useCallback(()=>{if(!Ue)return;const e=S.find(e=>e.id===Ue);!e||e.imageHistory.length<=1||We(t=>{var n;const i=!t;return i&&e.historyIndex>0&&$e((null==(n=e.imageHistory[e.historyIndex-1])?void 0:n.url)||null),i})},[Ue,S]);Pt.useEffect(()=>{if(!Ye.visible)return;const e=()=>Ze(e=>({...e,visible:!1})),t=e=>{"Escape"===e.key&&Ze(e=>({...e,visible:!1}))};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}},[Ye.visible]);const qn=Pt.useCallback(async e=>{var t;const n=S.find(t=>t.id===e);if(!n)return;const i=n.imageHistory[n.historyIndex],r=null==(t=null==i?void 0:i.metadata)?void 0:t.savedPath;if(r)try{const e="",t=await fetch(`${e}/api/open-explorer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:r})}),n=await t.json();n.success||d(n.message||"Failed to open explorer")}catch(a){d(`Failed to open explorer: ${a}`)}else d("Image has no saved path. Save the image first.")},[S,d]),Kn=Pt.useCallback(e=>{se(t=>t.map(t=>t.id===e.id?e:t)),tn("info",`Updated categories for workflow: ${e.name}`)},[tn]),Yn=Pt.useCallback(()=>{const e={workflows:oe,exportedAt:(new Date).toISOString(),version:"1.0"},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=`workflows_export_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n),tn("info",`Exported ${oe.length} workflows`)},[oe,tn]),Zn=Pt.useCallback(async e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){try{const e=await n.text(),t=JSON.parse(e);if(t.workflows&&Array.isArray(t.workflows)){const e=t.workflows.map((e,t)=>({...e,id:`imported_${Date.now()}_${t}`,name:e.name||`Imported Workflow ${t+1}`}));se(t=>[...t,...e]),tn("info",`Successfully imported ${e.length} workflows from export file`),p(`Imported ${e.length} workflows`)}else{if(!t.nodes&&!Object.values(t).some(e=>e&&e.class_type))throw new Error("Invalid file format: not a bulk export or ComfyUI workflow");{const e=t;"nodes"in e&&Array.isArray(e.nodes)&&(h('This workflow is in Graph format. For best results, export from ComfyUI using "Save (API Format)" or "Export API". Graph format may have widget mapping issues.'),tn("warning","Imported graph-format workflow - API format recommended"));const i=RE().parseWorkflow(e),r={id:`workflow_${Date.now()}`,name:n.name.replace(".json",""),description:"Imported from ComfyUI",category:g,subCategory:y,workflow:e,parsed:i,config:[]};r.config=i.parameters.map((e,t)=>({name:e.name,display_name:e.display_name,node_id:e.node_id,input_name:e.input_name,type:e.type,default:e.default,description:e.description,constraints:e.constraints,order:t,exposed:!0,category:"parameter",auto_detected:!0,user_modified:!1})),i.image_inputs.forEach((e,t)=>{const n="video"===e.type?"video":"image";r.config.push({name:e.name,display_name:e.display_name,node_id:e.node_id,input_name:e.input_name,type:n,default:"",description:e.description,order:i.parameters.length+t,exposed:!0,category:"image_input",auto_detected:!0,user_modified:!1})}),se(e=>[...e,r]),ue(r.id),me(r),he(!0),tn("info",`Imported single workflow: ${r.name}`),p(`Successfully imported workflow: ${r.name}`)}}}catch(i){console.error("Failed to import:",i),d("Failed to import: "+i.message)}e.target.value=""}},[oe,se,tn,p,d,g,y,ue,me,he]),Jn=Pt.useCallback(()=>{w(e=>{const t=Math.max(...e.map(e=>e.id),0)+1,n=e.length,i=Math.floor(n/3),r=n%3;return[...e,{id:t,name:`Panel_${String(t).padStart(2,"0")}`,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,status:"empty",progress:0,notes:"",prompt:"",seed:-1,x:320*r,y:320*i,width:300,height:300}]})},[]),Qn=Pt.useCallback(e=>{if(1===e.button||0===e.button&&e.altKey)N(!0),L({x:e.clientX-P.x,y:e.clientY-P.y}),e.preventDefault();else if(0===e.button&&!e.ctrlKey&&!e.metaKey){const t=e.target;if(t.classList.contains("storyboard-canvas")||t.classList.contains("canvas-transform-container")){V(!0);const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left-P.x)/C,i=(e.clientY-t.top-P.y)/C;G({x:n,y:i}),X({x:n,y:i}),e.preventDefault()}}},[P,C]),ei=Pt.useCallback(e=>{if(H){const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left-P.x)/C,i=(e.clientY-t.top-P.y)/C;X({x:n,y:i})}},[H,P,C]),ti=Pt.useCallback(()=>{if(H){const e=Math.min(W.x,$.x),t=Math.max(W.x,$.x),n=Math.min(W.y,$.y),i=Math.max(W.y,$.y);if(t-e<5&&i-n<5)return w(e=>e.map(e=>({...e,selected:!1}))),void V(!1);w(r=>r.map(r=>{const a=r.x+r.width,o=r.y+r.height,s=!(a<e||r.x>t||o<n||r.y>i);return{...r,selected:s}})),V(!1)}},[H,W,$]),ni=Pt.useCallback(e=>{A&&k({x:e.clientX-R.x,y:e.clientY-R.y})},[A,R]),ii=Pt.useCallback(()=>{N(!1)},[]),ri=Pt.useCallback(e=>{e.preventDefault();const t=ie.current;if(!t)return;const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,a=(i-P.x)/C,o=(r-P.y)/C,s=e.deltaY>0?.9:1.1,l=Math.max(.1,Math.min(5,C*s)),c=i-a*l,u=r-o*l;T(l),k({x:c,y:u})},[C,P]);Pt.useEffect(()=>{const e=ie.current;if(e)return e.addEventListener("wheel",ri,{passive:!1}),()=>{e.removeEventListener("wheel",ri)}},[ri]);const ai=Pt.useCallback(async(e,t)=>{const n=S.find(t=>t.id===e),i=Bt.current,r=ce||(null==n?void 0:n.workflowId),a=oe.find(e=>e.id===r);if(n&&a)if(0!==t.length)try{tn("comfyui",`Starting parallel generation on ${t.length} nodes for panel ${e}...`);const u=i,h=RE(),m={...u},f={};console.log("[Parallel] Processing parameter values:",Object.keys(u));for(const[e,n]of Object.entries(u))if("__BYPASSED__"!==n){if("string"==typeof n&&n.includes("/view?"))try{const i=new URL(n),r=i.searchParams.get("filename"),a=i.searchParams.get("subfolder")||"",s=i.searchParams.get("type")||"output";if(r){if("output"===s){console.log(`[Parallel] Image from output folder: ${r}, re-uploading to ALL nodes' input folders`),tn("info",`Re-uploading ${r} from output to input folder on all ${t.length} nodes`);const i=Lt.filter(e=>t.includes(e.id)&&"online"===e.status);if(0===i.length){const e="Cannot re-upload image: no online render nodes";return tn("error",e),void d(e)}try{const t=await fetch(n);if(t.ok){const n=await t.blob(),a=`storyboard_${Date.now()}_${r}`,o=new File([n],a,{type:n.type||"image/png"}),s=i.map(async e=>{const t=new FormData;t.append("image",o),t.append("overwrite","true");const n=await fetch(`${e.url}/upload/image`,{method:"POST",body:t});if(!n.ok)throw new Error(`Upload to ${e.id} failed with status ${n.status}`);return await n.json()}),l=(await Promise.all(s))[0].name;console.log(`[Parallel] Re-uploaded to ${i.length} nodes as ${l}`),tn("info",`Re-uploaded to ${i.length} nodes as ${l}`),m[e]=l,f[e]=l;continue}tn("warning","Image download failed, using original path")}catch(o){console.warn("[Parallel] Re-upload failed:",o),tn("warning",`Re-upload failed: ${o}`)}const s=a?`${a}/${r}`:r;m[e]=s,f[e]=s;continue}{const t=a?`${a}/${r}`:r;tn("info",`Using image path: ${t}`),m[e]=t,f[e]=t;continue}}}catch(s){console.warn("[Parallel] Failed to process ComfyUI URL:",n,s)}if("string"==typeof n&&(n.startsWith("data:image")||n.startsWith("data:video"))){const i=n.startsWith("data:video");console.log(`[Parallel] ${i?"Video":"Image"} parameter ${e} has data URL, uploading to ALL nodes`),tn("info",`Uploading data URL ${i?"video":"image"} for ${e} to all ${t.length} nodes`);const r=Lt.filter(e=>t.includes(e.id)&&"online"===e.status);if(0===r.length){const e="Cannot upload data URL media: no online render nodes";return tn("error",e),void d(e)}try{const t=n.match(/^data:((?:image|video)\/[^;]+);base64,(.+)$/);if(!t)throw new Error("Invalid data URL format");const i=t[1],a=t[2],o=atob(a),s=new Array(o.length);for(let e=0;e<o.length;e++)s[e]=o.charCodeAt(e);const l=new Uint8Array(s),c=new Blob([l],{type:i}),u=i.split("/")[1]||"png",d=`parallel_data_${Date.now()}_${e}.${u}`,h=new File([c],d,{type:i}),p=r.map(async e=>{const t=new FormData;t.append("image",h),t.append("overwrite","true");const n=await fetch(`${e.url}/upload/image`,{method:"POST",body:t});if(!n.ok)throw new Error(`Upload to ${e.id} failed with status ${n.status}`);return await n.json()}),g=(await Promise.all(p))[0].name;console.log(`[Parallel] Uploaded data URL to ${r.length} nodes as ${g}`),tn("info",`Uploaded data URL to ${r.length} nodes as ${g}`),m[e]=g,f[e]=g;continue}catch(o){const t=`Failed to upload data URL for ${e}: ${o}`;return console.error("[Parallel] Upload error:",o),tn("error",t),void d(t)}}}else tn("info",`Image input ${e} is bypassed`),f[e]="__BYPASSED__",delete m[e];if(Ne&&ke.trim())for(const e of Object.keys(m))(e.toLowerCase().includes("prompt")||"text"===e||"positive"===e)&&(m[e]=ke);const g=h.parseWorkflow(a.workflow),v={},y={},_=new Set(g.loras.map(e=>e.name));for(const[e,t]of Object.entries(m))_.has(e)?"object"==typeof t&&null!==t?v[e]={strength:t.strength??1,bypassed:t.bypassed??!1,lora_name:t.lora_name,enabled:!t.bypassed}:"number"==typeof t&&(v[e]={strength:t,enabled:!0}):y[e]=t;const x=h.buildWorkflow(a.workflow,y,f,v,a.config);console.log("[Parallel] Base workflow built:",JSON.stringify(x,null,2)),tn("info",`Base workflow nodes: ${Object.keys(x).length}`);const b=RR(x);b.samplerNodeIds.length>1&&tn("info",`Multi-sampler workflow: ${b.samplerNodeIds.length} sampler phases detected`);const S=(e,t)=>{var n,i;for(const r of Object.keys(e)){const a=e[r];((null==(n=a.class_type)?void 0:n.includes("Sampler"))||(null==(i=a.class_type)?void 0:i.includes("KSampler")))&&(a.inputs&&"seed"in a.inputs&&(a.inputs.seed=t),a.inputs&&"noise_seed"in a.inputs&&(a.inputs.noise_seed=t)),"RandomNoise"===a.class_type&&a.inputs&&"noise_seed"in a.inputs&&(a.inputs.noise_seed=t)}},M=[],E=t.map(e=>{const t=Lt.find(t=>t.id===e);return{nodeId:e,nodeName:(null==t?void 0:t.name)||e,promptId:"",seed:0,progress:0,status:"pending"}}),C=(null==n?void 0:n.name)||`Panel_${String(e).padStart(2,"0")}`,T=(null==n?void 0:n.imageHistory)||[],P=await cT.getNextVersion(C,T);Ot.current.set(e,P),w(t=>t.map(t=>t.id===e?{...t,status:"generating",progress:0,parameterValues:{...u},workflowId:r||void 0,parallelJobs:E}:t)),ae.current.set(e,Date.now()),jt.current.delete(String(e)),Dt.current.clear();for(let n=0;n<t.length;n++){const i=t[n],r=Lt.find(e=>e.id===i);if(!r||"online"!==r.status){tn("warning",`Skipping offline node: ${(null==r?void 0:r.name)||i}`),w(t=>t.map(t=>t.id===e&&t.parallelJobs?{...t,parallelJobs:t.parallelJobs.map(e=>e.nodeId===i?{...e,status:"error"}:e)}:t));continue}const a=JSON.parse(JSON.stringify(x)),o=Math.floor(2147483647*Math.random());S(a,o),console.log(`[Parallel] Submitting to node ${r.name} with seed ${o}`),tn("comfyui",`Submitting variation ${n+1}/${t.length} to ${r.name} (seed: ${o})`);try{const t=`storyboard-parallel-${e}-${n}-${Date.now()}`,c=zE(r.url,t);try{await c.connect()}catch(l){tn("warning",`WebSocket to ${r.name} failed, will use polling`)}const u=await fetch(`${r.url}/prompt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:a,client_id:t})});if(!u.ok){let e=`HTTP ${u.status}`;try{const t=await u.json();console.error("ComfyUI error response:",t),t.error&&(e="string"==typeof t.error?t.error:JSON.stringify(t.error))}catch(s){}throw new Error(e)}const d=await u.json();tn("comfyui",`Queued on ${r.name}: ${d.prompt_id}`),w(t=>t.map(t=>t.id===e&&t.parallelJobs?{...t,parallelJobs:t.parallelJobs.map(e=>e.nodeId===i?{...e,promptId:d.prompt_id,seed:o,status:"running"}:e)}:t)),M.push({nodeId:i,nodeName:r.name,promptId:d.prompt_id,seed:o}),c.connected?ui(d.prompt_id,e,i,r.url,c,t,b):di(d.prompt_id,e,i,r.url)}catch(c){const t=`Failed to submit to ${r.name}: ${c}`;tn("error",t),d(t),w(t=>t.map(t=>t.id===e&&t.parallelJobs?{...t,parallelJobs:t.parallelJobs.map(e=>e.nodeId===i?{...e,status:"error"}:e)}:t))}}if(0===M.length)return d("Failed to submit to any nodes"),void w(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t));p(`Started parallel generation on ${M.length} node(s)`)}catch(c){const t=`Parallel generation failed: ${c.message||String(c)}`;tn("error",t),d(t),w(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t))}else d("No render nodes selected for parallel generation");else d("Panel or workflow not found")},[S,oe,ce,Ee,Ne,ke,Lt,tn,d,p,M]),oi=Pt.useCallback(async e=>{var t,n;if(nn.length>1)return void(await ai(e,nn));const i=S.find(t=>t.id===e);let r="",a="";if(1===nn.length){const e=Lt.find(e=>e.id===nn[0]);e&&"online"===e.status&&(r=e.url,a=e.name)}if(!r&&(null==i?void 0:i.nodeId)){const e=Lt.find(e=>e.id===i.nodeId);e&&"online"===e.status&&(r=e.url,a=e.name)}if(!r){const e=Lt.filter(e=>"online"===e.status);if(e.length>0){const t=e[0];r=t.url,a=t.name}}if(!r&&pt&&"connected"===ft&&(r=pt,a="Direct Connection"),!r){const e="No render nodes available. Add nodes in Manage Nodes or connect via URL.";return tn("error",e),void d(e)}try{if(!(await fetch(`${r}/system_stats`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)throw new Error(`Node ${a} is not responding`)}catch(_){const e=`Cannot connect to ${a}: ${_}`;return tn("error",e),void d(e)}const o=Bt.current,s=ce||(null==i?void 0:i.workflowId),l=oe.find(e=>e.id===s);if(!l)return void tn("warning","No workflow selected");const c=o;w(t=>t.map(t=>t.id===e?{...t,status:"generating",progress:0,parameterValues:{...c},workflowId:s||void 0,parallelJobs:void 0}:t)),ae.current.set(e,Date.now()),tn("comfyui",`Starting generation for panel ${e} on ${a}...`),console.log("[Generation] ==== GENERATION START ===="),console.log("[Generation] Panel ID:",e),console.log("[Generation] Using parameters from UI ref (always)"),console.log("[Generation] paramsToUse:",JSON.stringify(c,null,2)),console.log("[Generation] Seed:",c.seed),console.log("[Generation] Prompt preview:",(null==(t=c.positive_prompt)?void 0:t.substring(0,50))||(null==(n=c.prompt)?void 0:n.substring(0,50)));const u={...c},h={};console.log("[Generation] Processing parameter values for panel:",e,Object.keys(c));for(const[S,E]of Object.entries(c))if("__BYPASSED__"!==E){if("string"==typeof E&&E.includes("/view?"))try{const e=new URL(E),t=e.searchParams.get("filename"),n=e.searchParams.get("subfolder")||"",i=e.searchParams.get("type")||"output";if(t){if("output"===i){console.log(`[Generation] Downloading ${t} from output to re-upload to input`),tn("info",`Downloading ${t} from output folder for re-upload`);const e=await fetch(E);if(e.ok){const n=await e.blob(),i=`storyboard_${Date.now()}_${t}`,a=new File([n],i,{type:n.type||"image/png"}),o=new FormData;o.append("image",a),o.append("overwrite","true");const s=await fetch(`${r}/upload/image`,{method:"POST",body:o});if(s.ok){const e=await s.json();console.log(`[Generation] Re-uploaded ${t} as ${e.name}`),tn("info",`Re-uploaded ${t} as ${e.name}`),u[S]=e.name,h[S]=e.name;continue}console.error("[Generation] Failed to upload image:",await s.text()),tn("error",`Failed to upload image ${t}: HTTP ${s.status}`)}else console.error("[Generation] Failed to download image from view URL"),tn("error",`Failed to download image ${t} from output folder`);const i=n?`${n}/${t}`:t;console.log(`[Generation] Falling back to original path: ${i}`),tn("warning",`Re-upload failed, falling back to: ${i}`),u[S]=i,h[S]=i;continue}{const e=n?`${n}/${t}`:t;tn("info",`Using image path from ComfyUI URL: ${e}`),console.log(`[Generation] ${S} using image path: ${e}`),u[S]=e,h[S]=e;continue}}}catch(x){console.warn("[Generation] Failed to process ComfyUI URL:",E,x)}if("string"==typeof E&&(E.startsWith("data:image")||E.startsWith("data:video"))){const t=E.startsWith("data:video");console.log(`[Generation] ${S} is a data:${t?"video":"image"} URL, uploading...`);try{tn("info",`Uploading ${t?"video":"image"} for parameter: ${S}`);const e=await fetch(E),n=await e.blob(),i=n.type.split("/")[1]||(t?"mp4":"png"),a=`storyboard_${Date.now()}_${S}.${i}`,o=new File([n],a,{type:n.type}),s=new FormData;s.append("image",o),s.append("overwrite","true");const l=await fetch(`${r}/upload/image`,{method:"POST",body:s});if(!l.ok)throw new Error(`Upload failed: HTTP ${l.status}`);const c=(await l.json()).name;tn("info",`${t?"Video":"Image"} uploaded as: ${c}`),console.log(`[Generation] ${S} uploaded as: ${c}`),u[S]=c,h[S]=c}catch(b){const n=`Failed to upload ${t?"video":"image"} ${S}: ${b}`;return tn("error",n),d(n),void w(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t))}}else console.log(`[Generation] ${S} is not media (type: ${typeof E}, startsWith data: ${"string"==typeof E?E.startsWith("data:"):"N/A"})`)}else tn("info",`Image input ${S} is bypassed, will skip in workflow`),console.log(`[Generation] ${S} is BYPASSED`),h[S]="__BYPASSED__",delete u[S];if(console.log("[Generation] Final imageInputs:",h),console.log("[Generation] Final processedParams keys:",Object.keys(u)),Ne&&ke.trim())for(const d of Object.keys(u))(d.toLowerCase().includes("prompt")||"text"===d||"positive"===d)&&(u[d]=ke,tn("info",`Applied global prompt override to: ${d}`));const p=RE(),m=p.parseWorkflow(l.workflow),f={},g={},v=new Set(m.loras.map(e=>e.name));for(const[d,S]of Object.entries(u))v.has(d)?"object"==typeof S&&null!==S?f[d]={strength:S.strength??1,bypassed:S.bypassed??!1,lora_name:S.lora_name,enabled:!S.bypassed}:"number"==typeof S&&(f[d]={strength:S,enabled:!0}):g[d]=S;console.log("Parameters being applied:",g),console.log("LoRA values being applied:",f),console.log("Parsed workflow parameters:",m.parameters),console.log("Custom param configs:",l.config);const y=p.buildWorkflow(l.workflow,g,h,f,l.config);console.log("Workflow being sent to ComfyUI:",JSON.stringify(y,null,2)),tn("info",`Workflow nodes: ${Object.keys(y).length}`);try{const t=`storyboard-panel-${e}-${Date.now()}`,n=zE(r,t);try{await n.connect()}catch(M){tn("warning",`WebSocket to ${r} failed, will use polling`)}const i=await fetch(`${r}/prompt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:y,client_id:t})});if(!i.ok){let e=`HTTP ${i.status}`;try{const t=await i.json();console.error("ComfyUI error response:",t),t.error&&(e="string"==typeof t.error?t.error:JSON.stringify(t.error)),t.node_errors&&(console.error("Node errors:",t.node_errors),e+=` | Node errors: ${JSON.stringify(t.node_errors)}`)}catch(x){}throw new Error(e)}const o=await i.json();tn("comfyui",`Queued prompt: ${o.prompt_id} on ${a}`);const s=RR(y);s.samplerNodeIds.length>1&&tn("info",`Multi-sampler workflow detected: ${s.samplerNodeIds.length} sampler phases`),n.connected?li(o.prompt_id,e,r,n,t,s):(tn("warning","WebSocket not connected, falling back to polling"),si(o.prompt_id,e,r))}catch(_){const t=`Failed to queue generation: ${_}`;tn("error",t),d(t),w(t=>t.map(t=>t.id===e?{...t,status:"error",progress:0}:t))}},[ft,oe,ce,Ee,pt,tn,d,S,Lt,M]),si=Pt.useCallback(async(e,t,n)=>{const i=`${t}-${e}`;Ft.current.forEach(e=>{e.startsWith(`${t}-`)&&Ft.current.delete(e)}),Ft.current.add(i);let r=0;const a=async()=>{var o;if(Ft.current.has(i)){if(r>=600)return tn("error",`Generation timeout for panel ${t}`),w(e=>e.map(e=>e.id===t?{...e,status:"error",progress:0}:e)),void Ft.current.delete(i);r++;try{const s=await fetch(`${n}/history/${e}`);if(s.ok){const r=await s.json();if(r[e]){const a=r[e].outputs,o=[];for(const e in a){const t=aT(a[e],n);for(const e of t)o.push(e.url)}if(o.length>0){tn("comfyui",`Generation complete for panel ${t} (polling): ${o.length} output(s)`),Ft.current.delete(i);const e=cT.getProject();if(e.autoSave&&e.path){tn("info",`Auto-saving ${o.length} image(s) to ${e.path}...`);const n=ae.current.get(t),i=n?(Date.now()-n)/1e3:void 0;(async()=>{try{const e=await new Promise(e=>{w(n=>{const i=n.find(e=>e.id===t);return e((null==i?void 0:i.name)||`Panel_${String(t).padStart(2,"0")}`),n})}),n=await cT.getNextVersion(e,[]);tn("info",`Starting from version ${n}`);for(let r=0;r<o.length;r++){const a=o[r],s=n+r,l=await new Promise(e=>{w(n=>{const i=n.find(e=>e.id===t);return e((null==i?void 0:i.workflowId)||""),n})}),c=await new Promise(e=>{w(n=>{const i=n.find(e=>e.id===t);return e((null==i?void 0:i.parameterValues)||{}),n})}),u=cT.createHistoryEntry(a,t,s,l,l||"Unknown",{},c,i);tn("info",`Saving v${s} from URL: ${a}`);const d=await cT.saveToProjectFolder(a,t,s,u.metadata,e);d.success?(tn("info",`Saved: ${d.savedPath}`),w(e=>e.map(e=>{if(e.id!==t)return e;const n=e.imageHistory.map(e=>e.url!==a||e.metadata.savedPath?e:{...e,metadata:{...e.metadata,savedPath:d.savedPath}});return{...e,imageHistory:n}}))):tn("error",`Auto-save failed for v${s}: ${d.error}`)}}catch(e){tn("error",`Auto-save exception: ${e}`)}})()}else e.autoSave&&!e.path?tn("warning","Auto-save enabled but no project folder configured"):e.autoSave||tn("info","Auto-save is disabled. Enable it in Project Settings to save images automatically.");const n=ae.current.get(t),r=n?(Date.now()-n)/1e3:void 0;return ae.current.delete(t),void w(e=>{var n;const i=e.find(e=>e.id===t),a=(null==(n=null==i?void 0:i.imageHistory)?void 0:n.length)||0,s=o.map((e,n)=>cT.createHistoryEntry(e,t,a+n+1,(null==i?void 0:i.workflowId)||"","Unknown",{},(null==i?void 0:i.parameterValues)||{},r));return e.map(e=>{if(e.id!==t)return e;const n=[...e.imageHistory,...s];return{...e,status:"complete",progress:100,image:o[o.length-1],images:o,currentImageIndex:0,imageHistory:n,historyIndex:n.length-1}})})}if(Object.keys(a).length>0){const e=Object.keys(a).map(e=>{const t=a[e];return`${e}: [${Object.keys(t).join(", ")}]`});tn("warning",`Generation completed but no media found in outputs. Node output keys: ${e.join("; ")}`)}}}const l=await fetch(`${n}/queue`);if(l.ok){const n=await l.json();(null==(o=n.queue_running)?void 0:o.find(t=>t[1]===e))&&w(e=>e.map(e=>e.id===t?{...e,progress:Math.min(r/100*100,90)}:e))}Ft.current.has(i)&&setTimeout(a,1e3)}catch(s){tn("error",`Error polling for result: ${s}`),Ft.current.has(i)&&setTimeout(a,1e3)}}};a()},[tn]),li=Pt.useCallback((e,t,n,i,r,a)=>{const o=i||It.current;if(!o)return void si(e,t,n);const s=()=>{r&&BE(n,r)};o.trackPrompt(e,t,e=>{const n=e.overallPercent??Math.round(e.value/e.max*100);let i=`Progress: ${n}%`;e.totalPhases&&e.totalPhases>1?i+=` (phase ${e.currentPhase}/${e.totalPhases}: ${e.value}/${e.max})`:i+=` (${e.value}/${e.max})`,e.currentNodeName&&(i+=` [${e.currentNodeName}]`),tn("info",i);const r=e.totalPhases&&e.totalPhases>1?`Phase ${e.currentPhase}/${e.totalPhases}`:void 0;w(i=>i.map(i=>i.id===t?{...i,progress:n,progressPhase:r,progressNodeName:e.currentNodeName,progressNodesExecuted:e.nodesExecuted,progressTotalNodes:e.totalNodes}:i))},async(i,r)=>{var a;tn("comfyui",`Generation complete for panel ${t}`);const o=cT.getProject(),l=Vt.current.find(e=>e.id===t);if((null==l?void 0:l.parallelJobs)&&l.parallelJobs.length>0)tn("comfyui","Skipping single-node save - panel has parallel jobs, handled by parallel tracker");else{try{const i=await fetch(`${n}/history/${e}`);if(i.ok){const r=(await i.json())[e];if(null==r?void 0:r.outputs){const e=(null==(a=null==fi?void 0:fi.parsed.outputs)?void 0:a.filter(e=>e.selected).map(e=>e.node_id))||[],i=0===e.length,l=[],c={};for(const t of Object.keys(r.outputs)){if(!i&&!e.includes(t)){tn("comfyui",`Skipping node ${t} (not selected)`);continue}const a=aT(r.outputs[t],n);if(a.length>0){const e=a.map(e=>e.url);l.push(...e),c[t]=e,tn("comfyui",`Node ${t} produced ${a.length} output(s)`)}}if(l.length>0){if(tn("comfyui",`Total: ${l.length} images from ${Object.keys(c).length} output node(s)`),o.autoSave&&o.path){tn("info",`Auto-saving ${l.length} image(s) to ${o.path}...`);const e=ae.current.get(t),n=e?(Date.now()-e)/1e3:void 0,i=[...Vt.current];(async()=>{try{const e=i.find(e=>e.id===t),r=(null==e?void 0:e.imageHistory)||[],a=(null==e?void 0:e.name)||`Panel_${String(t).padStart(2,"0")}`,o=await cT.getNextVersion(a,r);tn("info",`Starting from version ${o}`);for(let i=0;i<l.length;i++){const e=l[i],r=o+i,s=cT.createHistoryEntry(e,t,r,ce||"",(null==fi?void 0:fi.name)||"Unknown",(null==fi?void 0:fi.workflow)||{},Ee,n);tn("info",`Saving v${r} from URL: ${e}`);const c=await cT.saveToProjectFolder(e,t,r,s.metadata,a);c.success?(tn("info",`Saved: ${c.savedPath}`),w(n=>n.map(n=>{if(n.id!==t)return n;const i=n.imageHistory.map(t=>t.url!==e||t.metadata.savedPath?t:{...t,metadata:{...t.metadata,savedPath:c.savedPath}});return{...n,imageHistory:i}}))):tn("error",`Auto-save failed for v${r}: ${c.error}`)}}catch(e){tn("error",`Auto-save exception: ${e}`)}})()}else o.autoSave&&!o.path?tn("warning","Auto-save enabled but no project folder configured"):o.autoSave||tn("info","Auto-save is disabled. Enable it in Project Settings to save images automatically.");const e=ae.current.get(t),n=e?(Date.now()-e)/1e3:void 0;return ae.current.delete(t),console.log("[Generation] Panel",t,"took",null==n?void 0:n.toFixed(1),"seconds"),w(e=>{var i;const r=e.find(e=>e.id===t),a=(null==(i=null==r?void 0:r.imageHistory)?void 0:i.length)||0,o=l.map((e,i)=>cT.createHistoryEntry(e,t,a+i+1,(null==r?void 0:r.workflowId)||ce||"",(null==fi?void 0:fi.name)||"Unknown",(null==fi?void 0:fi.workflow)||{},(null==r?void 0:r.parameterValues)||Ee,n));return e.map(e=>{if(e.id!==t)return e;const n=[...e.imageHistory,...o];return{...e,status:"complete",progress:100,image:l[l.length-1],images:l,currentImageIndex:0,imageHistory:n,historyIndex:n.length-1}})}),void s()}}}}catch(c){tn("error",`Error fetching result: ${c}`)}w(e=>e.map(e=>e.id===t?{...e,status:"error",progress:0}:e)),s()}},(e,n)=>{const i=`Generation failed: ${n}`;tn("error",i),d(i),w(e=>e.map(e=>e.id===t?{...e,status:"error",progress:0}:e)),s()},a)},[tn,d,si,S]),ci=Pt.useCallback(async(e,t)=>{const n=Vt.current.find(t=>t.id===e);if(!n||!t.resultUrl)return;const i=`${e}-${t.nodeId}-${t.seed}`;if(Dt.current.has(i))console.log(`[Parallel] Job ${i} already saved, skipping duplicate`);else{Dt.current.add(i),console.log(`[Parallel] Saving individual result from ${t.nodeName}`),tn("info",`Saving result from ${t.nodeName}...`);try{const i=oe.find(e=>e.id===(n.workflowId||ce)),r=ae.current.get(e),a=r?(Date.now()-r)/1e3:void 0,o={...n.parameterValues||Ee,seed:t.seed},s=(null==n?void 0:n.name)||`Panel_${String(e).padStart(2,"0")}`,l=Ot.current.get(e)||1;Ot.current.set(e,l+1);const c=cT.createHistoryEntry(t.resultUrl,e,l,n.workflowId||ce||"",(null==i?void 0:i.name)||"Unknown",(null==i?void 0:i.workflow)||{},o,a);c.metadata.nodeName=t.nodeName,w(n=>n.map(n=>{var i;if(n.id!==e)return n;const r=[...n.imageHistory||[],c],a=(null==(i=n.parallelJobs)?void 0:i.map(e=>e.nodeId===t.nodeId?{...e,status:"complete",progress:100}:e))||[],o=a.every(e=>"complete"===e.status||"error"===e.status||"cancelled"===e.status),s=a.some(e=>"error"===e.status);return{...n,image:c.url,imageHistory:r,historyIndex:r.length-1,parallelJobs:a,status:o?s?"error":"complete":"generating"}})),tn("info",` Result from ${t.nodeName} saved to history (v${l})`);const u=cT.getProject();if(u.autoSave&&u.path){tn("info",`Auto-saving ${t.nodeName} result to folder...`);const n=await cT.saveToProjectFolder(t.resultUrl,e,l,c.metadata,s);n.success?(tn("info",` Saved: ${n.savedPath}`),w(t=>t.map(t=>{if(t.id!==e)return t;const i=t.imageHistory.map(e=>e.id===c.id?{...e,metadata:{...e.metadata,savedPath:n.savedPath}}:e);return{...t,imageHistory:i}}))):tn("error",` Save failed for ${t.nodeName}: ${n.error}`)}else u.autoSave&&!u.path&&tn("warning","Auto-save enabled but no project folder configured")}catch(r){console.error(`[Parallel] Failed to save result from ${t.nodeName}:`,r),tn("error",`Failed to save result from ${t.nodeName}: ${r}`)}}},[oe,ce,Ee,tn,cT]),ui=Pt.useCallback((e,t,n,i,r,a,o)=>{const s=()=>{a&&BE(i,a)};r.trackPrompt(e,t,e=>{const i=e.overallPercent??Math.round(e.value/e.max*100),r=e.totalPhases&&e.totalPhases>1?`Phase ${e.currentPhase}/${e.totalPhases}`:void 0;w(a=>a.map(a=>{if(a.id!==t||!a.parallelJobs)return a;const o=a.parallelJobs.map(t=>t.nodeId===n?{...t,progress:i,currentNodeName:e.currentNodeName||t.currentNodeName,progressPhase:r,nodesExecuted:e.nodesExecuted,totalNodes:e.totalNodes}:t),s=Math.round(o.reduce((e,t)=>e+t.progress,0)/o.length);return{...a,parallelJobs:o,progress:s}}))},async(r,a)=>{tn("comfyui",`Parallel job complete on node ${n} for panel ${t}`);try{const r=await fetch(`${i}/history/${e}`);if(!r.ok)throw new Error(`HTTP ${r.status}`);const a=(await r.json())[e];if(null==a?void 0:a.outputs){let e;for(const t of Object.keys(a.outputs)){const n=aT(a.outputs[t],i);if(n.length>0){e=n[0].url;break}}e&&(w(i=>i.map(i=>{if(i.id!==t||!i.parallelJobs)return i;const r=i.parallelJobs.map(t=>t.nodeId===n?{...t,status:"complete",progress:100,resultUrl:e}:t),a=r.find(e=>e.nodeId===n);a&&a.resultUrl&&setTimeout(()=>{ci(t,{nodeId:a.nodeId,nodeName:a.nodeName,resultUrl:a.resultUrl,seed:a.seed})},0);if(r.every(e=>"complete"===e.status||"error"===e.status||"cancelled"===e.status)){const e=r.filter(e=>"complete"===e.status).length;return tn("info",`All parallel jobs finished! ${e} successful, ${r.length-e} failed`),{...i,parallelJobs:r,status:e>0?"complete":"error",batchSaveTriggered:!0}}return{...i,parallelJobs:r}})),s())}}catch(o){tn("error",`Error fetching parallel result: ${o}`),w(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"error"}:e)}:e)),s()}},(e,i)=>{tn("error",`Parallel job failed on node ${n}: ${i}`),w(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"error"}:e)}:e)),s()},o)},[tn,ci]),di=Pt.useCallback(async(e,t,n,i)=>{let r=0;const a=async()=>{var o;if(r>=600)return tn("error",`Parallel job timeout on node ${n}`),void w(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"error"}:e)}:e));r++;try{const s=await fetch(`${i}/history/${e}`);if(s.ok){const r=await s.json();if(null==(o=r[e])?void 0:o.outputs){let a;for(const t of Object.keys(r[e].outputs)){const n=aT(r[e].outputs[t],i);if(n.length>0){a=n[0].url;break}}if(a)return void w(e=>e.map(e=>{if(e.id!==t||!e.parallelJobs)return e;const i=e.parallelJobs.map(e=>e.nodeId===n?{...e,status:"complete",progress:100,resultUrl:a}:e),r=i.find(e=>e.nodeId===n);r&&r.resultUrl&&setTimeout(()=>{ci(t,{nodeId:r.nodeId,nodeName:r.nodeName,resultUrl:r.resultUrl,seed:r.seed})},0);if(i.every(e=>"complete"===e.status||"error"===e.status||"cancelled"===e.status)){const t=i.filter(e=>"complete"===e.status).length;return tn("info",`All parallel jobs finished! ${t} successful, ${i.length-t} failed`),{...e,parallelJobs:i,status:t>0?"complete":"error",batchSaveTriggered:!0}}return{...e,parallelJobs:i}}))}}const l=Math.min(r/100*100,90);w(e=>e.map(e=>e.id===t&&e.parallelJobs?{...e,parallelJobs:e.parallelJobs.map(e=>e.nodeId===n?{...e,progress:l}:e)}:e)),setTimeout(a,1e3)}catch(s){tn("error",`Error polling parallel result: ${s}`),setTimeout(a,1e3)}};a()},[tn,ci]),hi=Pt.useCallback((e,t)=>{console.log("[handleParameterChange] Called with:",e,"=","string"==typeof t?t.substring(0,50):t);const n={...Bt.current,[e]:t};Bt.current=n,console.log("[handleParameterChange] Updated ref BEFORE setter, keys:",Object.keys(n)),Ce(n),M&&w(e=>e.map(e=>e.id===M?{...e,parameterValues:n}:e))},[M]),pi=Pt.useCallback((e,t)=>{Pe(n=>({...n,[e]:t}))},[]),mi=Pt.useCallback(async e=>{const t=Jm();if(!t)throw new Error("No LLM provider configured. Please configure in Settings.");const{provider:n,model:i}=t,r=af().find(e=>e.providerId===n);if(!r)throw new Error("Selected provider not found. Please configure in Settings.");try{const t=await Im.enhancePrompt({userPrompt:e.trim(),llmProvider:n,llmModel:i,targetModel:"flux",projectType:"live_action",config:{},credentials:{apiKey:r.credentials.apiKey,endpoint:r.credentials.endpoint,oauthToken:r.credentials.oauthToken}});if(t.success)return p("Prompt enhanced successfully"),t.enhanced_prompt;throw new Error(t.error||"Enhancement failed")}catch(a){const e=a instanceof Error?a.message:"Failed to enhance prompt";throw d(e),a}},[p,d]),fi=oe.find(e=>e.id===ce),gi=(null==fi?void 0:fi.config.filter(e=>e.exposed))||[],vi=async()=>{const e=await cT.saveProjectState(S,void 0,Ee,{selectedWorkflowId:ce||void 0,renderNodes:Lt,comfyUrl:pt,cameraAngles:Te});e.success?p(`Project saved to ${e.savedPath}`):d(`Failed to save project: ${e.error}`)},yi=()=>{Mn("save")},_i=()=>{Mn("open")},xi=(e,t)=>{var n;const i=S.find(t=>t.id===e);if(!i)return;const r=i.imageHistory.find(e=>e.id===t);if(!r)return console.error("[Delete] Entry not found:",t),void d("Cannot delete: image entry not found");const a=(null==(n=null==r?void 0:r.metadata)?void 0:n.savedPath)?PR(r.metadata.savedPath):PR(r.url)||"image";vn?bi(e,t):gn({isOpen:!0,panelId:e,entryId:t,filename:a})},bi=async(e,t)=>{var n;const i=S.find(t=>t.id===e);if(!i)return;const r=i.imageHistory.findIndex(e=>e.id===t);if(-1===r)return console.error("[Delete] Entry not found:",t),void d("Cannot delete: image entry not found");const a=i.imageHistory[r],o=null==(n=null==a?void 0:a.metadata)?void 0:n.savedPath;let s=!0;if(o){console.log("[Delete] Attempting to delete:",o);const e=await cT.deleteImage(o);console.log("[Delete] Result:",e),e.success?(un(e=>new Set([...e,o])),p(`Deleted: ${PR(o)}`)):(console.error("[Delete] Failed:",e.error),d(`Delete failed: ${e.error||"Unknown error"}`),s=!1)}else console.warn("[Delete] No savedPath in entry metadata - removing from UI only:",null==a?void 0:a.metadata);s&&w(n=>n.map(n=>{var i;if(n.id!==e)return n;const r=n.imageHistory.findIndex(e=>e.id===t);if(-1===r)return n;const a=[...n.imageHistory];a.splice(r,1);let o=n.historyIndex;return r<=n.historyIndex&&(o=Math.max(0,n.historyIndex-1)),0===a.length&&(o=-1),{...n,imageHistory:a,historyIndex:o,image:a.length>0?null==(i=a[o])?void 0:i.url:null,status:a.length>0?"complete":"empty"}}))},Si=async()=>{const e=Lt.some(e=>"busy"===e.status),t=S.some(e=>"generating"===e.status);if(e||t){p("Cancelling all running generations...");try{const e=(await VE.cancelAllGenerations()).filter(e=>e.success).length;e>0?p(`Cancelled ${e} generation(s)`):d("Failed to cancel generations"),w(e=>e.map(e=>"generating"===e.status?{...e,status:"error",error:"Cancelled by user"}:e))}catch(n){d(`Error cancelling generations: ${n instanceof Error?n.message:"Unknown error"}`),console.error("[Cancel] Error:",n)}}else p("No generations are currently running")},wi=Pt.useCallback(async()=>{if(S.some(e=>e.image||e.images.length>0||""!==e.notes.trim())){window.confirm("You have unsaved work. Would you like to save before creating a new project?\n\nClick OK to save first, or Cancel to discard changes.")&&await vi()}const e=Array.from({length:6},(e,t)=>({id:t+1,image:null,images:[],imageHistory:[],historyIndex:-1,currentImageIndex:0,x:t%3*320,y:320*Math.floor(t/3),width:300,height:300,status:"empty",progress:0,notes:"",nodeId:void 0,workflowId:void 0,parameterValues:void 0,prompt:"",seed:-1}));w(e),Ce({}),Bt.current={},ue(null);const t={name:"Untitled Project",path:"",namingTemplate:"{project}_Panel{panel}_{version}",autoSave:!0,orchestratorUrl:sn.orchestratorUrl,created:new Date,lastModified:new Date};ln(t),cT.setProject(t),on(!0)},[S,vi,sn.orchestratorUrl]);return Pt.useEffect(()=>{const e=e=>{const t=e.target;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&"SELECT"!==t.tagName)return!e.ctrlKey&&!e.metaKey||!e.shiftKey||"S"!==e.key&&"s"!==e.key?(e.ctrlKey||e.metaKey)&&"n"===e.key?(e.preventDefault(),void wi()):!e.ctrlKey&&!e.metaKey||e.shiftKey||"s"!==e.key?(e.ctrlKey||e.metaKey)&&"o"===e.key?(e.preventDefault(),void _i()):(e.ctrlKey||e.metaKey)&&","===e.key?(e.preventDefault(),void on(!0)):(e.ctrlKey||e.metaKey)&&"p"===e.key?(e.preventDefault(),void xe(!0)):void 0:(e.preventDefault(),void vi()):(e.preventDefault(),void yi())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[wi,vi,yi,_i]),Ut.jsxs("div",{className:"storyboard-ui",children:[dn&&Ut.jsx("div",{className:"loading-overlay",children:Ut.jsxs("div",{className:"loading-modal",children:[Ut.jsx("h3",{children:"Loading Project..."}),Ut.jsx("div",{className:"progress-bar",children:Ut.jsx("div",{className:"progress-fill",style:{width:`${pn.progress}%`}})}),Ut.jsxs("p",{className:"progress-text",children:[Math.round(pn.progress),"%"]}),Ut.jsx("p",{className:"current-file",children:pn.currentFile})]})}),Ut.jsxs("div",{className:"storyboard-top-bar",children:[Ut.jsx(ZC,{projectName:sn.name||"Untitled Project",nodeCount:Lt.length,onProjectSettings:()=>on(!0),onSaveProject:vi,onSaveProjectAs:yi,onLoadProject:_i,onNewProject:wi,onManageNodes:()=>At(!0),onRestartNodes:async()=>{if(0!==Lt.length){Rt(!0),p("Restarting all ComfyUI backends...");try{const e=await VE.restartAllBackends(),t=e.filter(e=>e.success).length,n=e.length-t;0===n?p(`Successfully restarted ${t} backend(s)`):0===t?d(`Failed to restart all ${n} backend(s). Check the console for details.`):p(`Restarted ${t} backend(s), ${n} failed. Check the console for details.`),e.forEach(e=>{e.success?console.log(`[Restart] ${e.backendId}: ${e.message}`):console.error(`[Restart] ${e.backendId}: ${e.message}`)})}catch(e){d(`Error restarting nodes: ${e instanceof Error?e.message:"Unknown error"}`),console.error("[Restart] Error:",e)}finally{Rt(!1)}}else d("No render nodes available to restart.")},onCancelGenerations:Si,onPrintStoryboard:()=>xe(!0),isRestarting:Nt,isGenerating:S.some(e=>"generating"===e.status)||Lt.some(e=>"busy"===e.status)}),Ut.jsx("div",{className:"workflow-dropdown-bar",children:Ut.jsxs("select",{value:ce||"",onChange:e=>ue(e.target.value),className:"workflow-select",children:[Ut.jsx("option",{value:"",children:"Select workflow..."}),oe.filter(e=>{var t;const n=e.category===g&&e.subCategory===y,i=IR[y],r=i&&(null==(t=e.categories)?void 0:t.includes(i));return n||r}).map(e=>Ut.jsx("option",{value:e.id,children:e.name},e.id))]})}),Ut.jsxs("div",{className:"storyboard-tabs",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"tab-with-dropdown",children:[Ut.jsxs("button",{className:"storyboard-tab "+("image-generation"===g?"active":""),onClick:()=>b("image-generation"===x?null:"image-generation"),children:["Image Generation ",Ut.jsx(JE,{size:14,style:{marginLeft:4,opacity:.7}})]}),"image-generation"===x&&Ut.jsxs("div",{className:"tab-dropdown",children:[Ut.jsx("button",{className:"text2img"===y?"active":"",onClick:()=>{v("image-generation"),_("text2img"),b(null)},children:"Text to Image"}),Ut.jsx("button",{className:"img2img"===y?"active":"",onClick:()=>{v("image-generation"),_("img2img"),b(null)},children:"Image to Image"}),Ut.jsx("button",{className:"inpainting"===y?"active":"",onClick:()=>{v("image-generation"),_("inpainting"),b(null)},children:"Inpainting"})]})]}),Ut.jsx("button",{className:"storyboard-tab "+("image-editing"===g?"active":""),onClick:()=>{v("image-editing"),_("editing"),b(null)},children:"Image Editing"}),Ut.jsx("button",{className:"storyboard-tab "+("upscaling"===g?"active":""),onClick:()=>{v("upscaling"),_("upscale"),b(null)},children:"Upscaling"}),Ut.jsxs("div",{className:"tab-with-dropdown",children:[Ut.jsxs("button",{className:"storyboard-tab "+("video-generation"===g?"active":""),onClick:()=>b("video-generation"===x?null:"video-generation"),children:["Video Generation ",Ut.jsx(JE,{size:14,style:{marginLeft:4,opacity:.7}})]}),"video-generation"===x&&Ut.jsxs("div",{className:"tab-dropdown",children:[Ut.jsx("button",{className:"img2vid"===y?"active":"",onClick:()=>{v("video-generation"),_("img2vid"),b(null)},children:"Image to Video"}),Ut.jsx("button",{className:"txt2vid"===y?"active":"",onClick:()=>{v("video-generation"),_("txt2vid"),b(null)},children:"Text to Video"}),Ut.jsx("button",{className:"fflf"===y?"active":"",onClick:()=>{v("video-generation"),_("fflf"),b(null)},children:"FFLF"})]})]})]})]}),Ut.jsxs("div",{className:"storyboard-main",children:[Ut.jsxs("aside",{className:"storyboard-sidebar",style:{width:Ln},children:[Ut.jsx("div",{className:"sidebar-section",children:Ut.jsxs("div",{className:"sidebar-section-header",children:[Ut.jsx("span",{className:"sidebar-section-title",children:"Workflow"}),Ut.jsxs("div",{className:"workflow-icon-buttons",children:[Ut.jsx("button",{className:"icon-btn",onClick:()=>{const e=oe.find(e=>e.id===ce);e&&(me(e),he(!0))},disabled:!fi,title:"Edit workflow parameters",children:Ut.jsx(AC,{size:14})}),Ut.jsx("button",{className:"icon-btn rename",onClick:()=>{const e=oe.find(e=>e.id===ce);e&&(Se(e),Me(e.name),ye(!0))},disabled:!fi,title:"Rename workflow",children:Ut.jsx(kC,{size:14})}),Ut.jsx("button",{className:"icon-btn delete",onClick:()=>{if(ce&&confirm("Are you sure you want to delete this workflow?")){const e=oe.find(e=>e.id===ce);se(e=>e.filter(e=>e.id!==ce)),ue(null),MR.delete(ce).catch(e=>{console.error("[Workflows] Failed to delete from backend:",e),tn("error",`Failed to delete workflow file from storage: ${e}`)}),e&&tn("info",`Deleted workflow: ${e.name}`)}},disabled:!fi,title:"Delete workflow",children:Ut.jsx(WC,{size:14})}),Ut.jsx("button",{className:"icon-btn export",onClick:Yn,disabled:0===oe.length,title:`Export all ${oe.length} workflows`,children:Ut.jsx(lC,{size:14})}),Ut.jsxs("label",{className:"icon-btn import",title:"Import workflows from JSON",children:[Ut.jsx(GC,{size:14}),Ut.jsx("input",{type:"file",accept:".json",style:{display:"none"},onChange:Zn})]}),Ut.jsx("button",{className:"icon-btn categories",onClick:()=>ge(!0),disabled:0===oe.length,title:`Manage categories for ${oe.length} workflows`,children:Ut.jsx(VC,{size:14})})]})]})}),fi&&fi.parsed.outputs&&fi.parsed.outputs.length>0&&Ut.jsxs("div",{className:"sidebar-section",children:[Ut.jsx("div",{className:"sidebar-section-title",children:"Output Nodes"}),Ut.jsx(JC,{options:fi.parsed.outputs.map(e=>({id:e.node_id,label:e.name,selected:e.selected})),onChange:e=>{const t=fi.parsed.outputs.map(t=>({...t,selected:e.includes(t.node_id)}));se(e=>e.map(e=>e.id===fi.id?{...e,parsed:{...e.parsed,outputs:t}}:e))},placeholder:"Select output nodes..."})]}),fi&&Ut.jsxs("div",{className:"sidebar-section parameters-section",children:[Ut.jsxs("div",{className:"global-prompt-section",children:[Ut.jsx("div",{className:"global-prompt-header",children:Ut.jsxs("label",{className:"checkbox-label",children:[Ut.jsx("input",{type:"checkbox",checked:Ne,onChange:e=>Re(e.target.checked)}),"Global Prompt Override"]})}),Ne&&Ut.jsx("textarea",{className:"global-prompt-input",placeholder:"Enter prompt to use for all panels...",value:ke,onChange:e=>Ae(e.target.value),rows:3})]}),Ut.jsx(wE,{parameters:gi.map(e=>({name:e.name,display_name:e.display_name,type:"string"===e.type?"prompt":e.type,node_id:e.node_id,input_name:e.input_name,default:e.default,constraints:e.constraints,description:e.description})),values:Ee,onChange:hi,disabled:!1,onEnhancePrompt:mi,cameraAngles:Te,onCameraAngleChange:pi,comfyUrl:pt})]})]}),Ut.jsx("div",{className:"resize-handle resize-handle-left",onMouseDown:e=>{e.preventDefault(),On(!0)}}),Ut.jsxs("main",{className:"storyboard-canvas",ref:ie,onMouseDown:Qn,onMouseMove:e=>{ni(e),ei(e)},onMouseUp:()=>{ii(),ti()},onMouseLeave:()=>{ii(),ti()},onDragOver:e=>e.preventDefault(),onDrop:en,children:[Ut.jsxs("div",{className:"canvas-toolbar",children:[Ut.jsx("button",{className:"icon-btn",onClick:()=>T(e=>Math.min(5,1.2*e)),title:"Zoom In",children:Ut.jsx(qC,{size:16})}),Ut.jsx("button",{className:"icon-btn",onClick:()=>T(e=>Math.max(.1,e/1.2)),title:"Zoom Out",children:Ut.jsx(KC,{size:16})}),Ut.jsx("button",{className:"icon-btn",onClick:()=>{T(1),k({x:0,y:0})},title:"Reset View",children:Ut.jsx(jC,{size:16})}),Ut.jsxs("span",{className:"zoom-level",children:[Math.round(100*C),"%"]}),Ut.jsxs("button",{onClick:Jn,className:"add-panel-btn",title:"Add Panel",children:[Ut.jsx(NC,{size:14})," Add Panel"]}),Ut.jsxs("button",{onClick:()=>xe(!0),className:"add-panel-btn",title:"Print Storyboard",children:[Ut.jsx(LC,{size:14})," Print"]}),S.filter(e=>e.selected).length>=2&&Ut.jsxs("div",{className:"alignment-toolbar",children:[Ut.jsx("button",{className:"icon-btn",onClick:()=>Jt("left"),title:"Align Left",children:Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ut.jsx("rect",{x:"2",y:"2",width:"2",height:"12"}),Ut.jsx("rect",{x:"6",y:"4",width:"8",height:"3"}),Ut.jsx("rect",{x:"6",y:"9",width:"6",height:"3"})]})}),Ut.jsx("button",{className:"icon-btn",onClick:()=>Jt("right"),title:"Align Right",children:Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ut.jsx("rect",{x:"12",y:"2",width:"2",height:"12"}),Ut.jsx("rect",{x:"2",y:"4",width:"8",height:"3"}),Ut.jsx("rect",{x:"2",y:"9",width:"6",height:"3"})]})}),Ut.jsx("button",{className:"icon-btn",onClick:()=>Jt("top"),title:"Align Top",children:Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ut.jsx("rect",{x:"2",y:"2",width:"12",height:"2"}),Ut.jsx("rect",{x:"4",y:"6",width:"3",height:"8"}),Ut.jsx("rect",{x:"9",y:"6",width:"3",height:"6"})]})}),Ut.jsx("button",{className:"icon-btn",onClick:()=>Jt("bottom"),title:"Align Bottom",children:Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ut.jsx("rect",{x:"2",y:"12",width:"12",height:"2"}),Ut.jsx("rect",{x:"4",y:"2",width:"3",height:"8"}),Ut.jsx("rect",{x:"9",y:"2",width:"3",height:"6"})]})}),Ut.jsx("div",{className:"toolbar-separator"}),Ut.jsx("button",{className:"icon-btn",onClick:()=>Qt("horizontal"),title:"Distribute Horizontally",children:Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ut.jsx("rect",{x:"1",y:"4",width:"2",height:"8"}),Ut.jsx("rect",{x:"6",y:"4",width:"4",height:"8"}),Ut.jsx("rect",{x:"13",y:"4",width:"2",height:"8"})]})}),Ut.jsx("button",{className:"icon-btn",onClick:()=>Qt("vertical"),title:"Distribute Vertically",children:Ut.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:[Ut.jsx("rect",{x:"4",y:"1",width:"8",height:"2"}),Ut.jsx("rect",{x:"4",y:"6",width:"8",height:"4"}),Ut.jsx("rect",{x:"4",y:"13",width:"8",height:"2"})]})})]})]}),Ut.jsxs("div",{className:"canvas-transform-container",style:{transform:`translate(${P.x}px, ${P.y}px) scale(${C})`},children:[H&&Ut.jsx("div",{className:"marquee-selection",style:{position:"absolute",left:Math.min(W.x,$.x),top:Math.min(W.y,$.y),width:Math.abs($.x-W.x),height:Math.abs($.y-W.y),backgroundColor:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.5)",pointerEvents:"none",zIndex:1e3}}),q.map((e,t)=>Ut.jsx("div",{className:"snap-guide",style:{position:"absolute",left:"vertical"===e.type?e.position:0,top:"horizontal"===e.type?e.position:0,width:"vertical"===e.type?1:"100%",height:"horizontal"===e.type?1:"100%",backgroundColor:"rgba(239, 68, 68, 0.6)",pointerEvents:"none",zIndex:999}},t)),S.map(e=>{var t,n,i,r;return Ut.jsxs("div",{className:`panel-slot ${M===e.id?"selected":""} ${e.status} ${e.selected?"multi-selected":""}`,style:{left:e.x,top:e.y,width:e.width,height:e.height,zIndex:e.zIndex||(e.selected?10:1)},onMouseDown:t=>{(t.ctrlKey||t.metaKey||t.shiftKey)&&(t.stopPropagation(),Xt(e.id))},onClick:t=>{t.stopPropagation(),t.ctrlKey||t.metaKey||t.shiftKey||(E(e.id),Ht.current=e.id)},onContextMenu:t=>{t.preventDefault(),t.stopPropagation(),Ze({visible:!0,x:t.clientX,y:t.clientY,panelId:e.id})},children:[Ut.jsx(yR,{panelId:e.id,name:e.name||`Panel_${String(e.id).padStart(2,"0")}`,locked:e.locked||e.imageHistory.length>0,selected:e.selected,onNameChange:t=>{w(n=>n.map(n=>n.id===e.id?{...n,name:t}:n))},onRemove:()=>Zt(e.id),onMouseDown:t=>{"generating"!==e.status&&qt(e.id,t)}}),Ut.jsxs("div",{className:"panel-content",children:[e.image&&Ut.jsx("div",{className:"panel-image-container",children:rT(e.image)?Ut.jsx("video",{src:e.image,controls:!0,loop:!0,muted:!0,autoPlay:!0,playsInline:!0,draggable:!0,onDragStart:t=>{var n;const i=e.imageHistory[e.historyIndex],r=null==(n=null==i?void 0:i.metadata)?void 0:n.savedPath,a=JSON.stringify({url:e.image,filePath:r||null});t.dataTransfer.setData("application/x-storyboard-image",a),t.dataTransfer.setData("text/plain",a),t.dataTransfer.effectAllowed="copy"},onClick:t=>{t.preventDefault(),t.stopPropagation(),De(e.image),Oe(e.id),dt("actual"),ze(1),He({x:0,y:0}),Ie(!0)},style:{cursor:"pointer",width:"100%",height:"100%",objectFit:"contain"}}):Ut.jsx("img",{src:e.image,alt:`Panel ${e.id}`,draggable:!0,onDragStart:t=>{var n;const i=e.imageHistory[e.historyIndex],r=null==(n=null==i?void 0:i.metadata)?void 0:n.savedPath,a=JSON.stringify({url:e.image,filePath:r||null});t.dataTransfer.setData("application/x-storyboard-image",a),t.dataTransfer.setData("text/plain",a),t.dataTransfer.effectAllowed="copy"},onClick:t=>{t.preventDefault(),t.stopPropagation(),De(e.image),Oe(e.id),dt("actual"),ze(1),He({x:0,y:0}),Ie(!0)},style:{cursor:"pointer"}})}),e.imageHistory.length>0&&e.historyIndex>=0&&(null==(n=null==(t=e.imageHistory[e.historyIndex])?void 0:t.metadata)?void 0:n.generationTime)&&Ut.jsxs("div",{className:"generation-time",children:[e.imageHistory[e.historyIndex].metadata.generationTime.toFixed(1),"s"]}),e.imageHistory.length>0&&e.historyIndex>=0&&Ut.jsx("div",{className:"image-rating",onClick:e=>e.stopPropagation(),children:Ut.jsx(_R,{rating:(null==(r=null==(i=e.imageHistory[e.historyIndex])?void 0:i.metadata)?void 0:r.rating)||0,onRatingChange:t=>{w(n=>n.map(n=>{if(n.id!==e.id)return n;const i=[...n.imageHistory];return i[n.historyIndex]&&(i[n.historyIndex]={...i[n.historyIndex],metadata:{...i[n.historyIndex].metadata,rating:t}}),{...n,imageHistory:i}}))},size:14})}),e.imageHistory.length>1&&Ut.jsxs("div",{className:"image-nav history-nav",children:[Ut.jsx("button",{onClick:t=>{t.stopPropagation(),w(t=>t.map(t=>{if(t.id!==e.id)return t;const n=Math.max(0,t.historyIndex-1),i=t.imageHistory[n];return{...t,historyIndex:n,image:(null==i?void 0:i.url)||t.image}}))},disabled:e.historyIndex<=0,title:"Previous version",children:""}),Ut.jsxs("span",{className:"history-counter",title:`Version ${e.historyIndex+1} of ${e.imageHistory.length}`,children:["v",e.historyIndex+1,"/",e.imageHistory.length]}),Ut.jsx("button",{onClick:t=>{t.stopPropagation(),w(t=>t.map(t=>{if(t.id!==e.id)return t;const n=Math.min(t.imageHistory.length-1,t.historyIndex+1),i=t.imageHistory[n];return{...t,historyIndex:n,image:(null==i?void 0:i.url)||t.image}}))},disabled:e.historyIndex>=e.imageHistory.length-1,title:"Next version",children:""}),Ut.jsx("button",{className:"restore-btn",onClick:async t=>{var n,i,r,a,o,s;t.stopPropagation();const l=e.imageHistory[e.historyIndex];if((null==(n=null==l?void 0:l.metadata)?void 0:n.parameters)&&(null==(i=null==l?void 0:l.metadata)?void 0:i.workflowId)){l.metadata.workflowId!==ce&&(re.current=!0,ue(l.metadata.workflowId));const t=l.metadata.parameters;return Ce(t),Bt.current=t,void p(`Restored parameters from v${e.historyIndex+1}`)}const c=null==(r=null==l?void 0:l.metadata)?void 0:r.savedPath;if(c)try{const e=cT.getProject().orchestratorUrl||oT(),t=await fetch(`${e}/api/png-metadata?path=${encodeURIComponent(c)}`),n=await t.json();if(!n.success||!n.prompt)return void d("Could not read PNG metadata");const i=n.prompt;let r;const l=Object.keys(i).filter(e=>"meta"!==e&&"version"!==e);let m=0;for(const s of oe){const e=Object.keys(s.workflow).filter(e=>"meta"!==e&&"version"!==e);let t=0;for(const r of l)if(s.workflow[r]){const e=null==(a=i[r])?void 0:a.class_type,n=null==(o=s.workflow[r])?void 0:o.class_type;e&&e===n&&t++}const n=l.length>0?t/Math.max(l.length,e.length):0;n>m&&n>.5&&(m=n,r=s)}if(!r){let e=null;for(const t of Object.values(i))if("SaveImage"===t.class_type&&(null==(s=t.inputs)?void 0:s.filename_prefix)){e=t.inputs.filename_prefix;break}if(e&&(r=oe.find(t=>t.id===e),!r)){const t=e=>e.toLowerCase().replace(/[_\s-]/g,""),n=t(e);r=oe.find(e=>t(e.id).includes(n)||n.includes(t(e.id))||t(e.name||"").includes(n)||n.includes(t(e.name||"")))}}r||h("Could not find matching workflow. Extracting parameters only.");const f={},g={};if(r){for(const e of r.parsed.parameters){const t=e.node_id,n=e.input_name,r=i[t];if((null==r?void 0:r.inputs)&&n in r.inputs){const t=r.inputs[n];Array.isArray(t)||(f[e.name]=t)}}for(const e of r.parsed.image_inputs){const t=e.node_id,n=e.input_name,r=i[t];if((null==r?void 0:r.inputs)&&n in r.inputs){const t=r.inputs[n];t&&"string"==typeof t&&(g[e.name]=t)}}}if(0===Object.keys(f).length)for(const a of Object.values(i)){if(!a.inputs)continue;const e=a.class_type||"";if((e.includes("KSampler")||e.includes("Sampler"))&&(void 0!==a.inputs.seed&&(f.seed=a.inputs.seed),void 0!==a.inputs.steps&&(f.steps=a.inputs.steps),void 0!==a.inputs.cfg&&(f.cfg=a.inputs.cfg),a.inputs.sampler_name&&(f.sampler_name=a.inputs.sampler_name),a.inputs.scheduler&&(f.scheduler=a.inputs.scheduler),void 0!==a.inputs.denoise&&(f.denoise=a.inputs.denoise),a.inputs.positive_prompt&&(f.positive_prompt=a.inputs.positive_prompt),a.inputs.negative_prompt&&(f.negative_prompt=a.inputs.negative_prompt)),"CLIPTextEncode"===e&&a.inputs.text){const e=a.inputs.text;"string"==typeof e&&e.length>20&&!f.positive_prompt&&(f.positive_prompt=e)}if(e.includes("TextEncode")&&!f.positive_prompt){const e=a.inputs.prompt||a.inputs.text;"string"==typeof e&&e.length>20&&(f.positive_prompt=e)}if("LoadImage"===e&&a.inputs.image){const e=a.inputs.image;g.reference_image||(g.reference_image=e)}}let v=0;r&&r.id!==ce&&(re.current=!0,ue(r.id),v++),Object.keys(f).length>0&&(Ce(e=>{const t={...e,...f};return Bt.current=t,t}),v+=Object.keys(f).length);const y=Object.keys(g).length;if(y>0){const e=Lt.filter(e=>"online"===e.status);if(e.length>0){const t=e[0].url.replace(/\/$/,"");for(const[e,n]of Object.entries(g))try{const i=`${t}/view?filename=${encodeURIComponent(n)}&type=input`,r=await fetch(i);if(r.ok){const t=await r.blob(),n=await new Promise(e=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(t)});f[e]=n,v++}}catch(u){console.warn(`Could not fetch image ${n}:`,u)}Object.keys(g).some(e=>f[e])&&Ce(e=>{const t={...e,...f};return Bt.current=t,t})}}if(v>0){const e=r?`workflow "${r.name||r.id}"`:"",t=`${Object.keys(f).length} parameters`;p(`Restored ${e?e+", ":""}${t}${y>0?`, ${y} images`:""}`)}else h("No parameters could be extracted from PNG")}catch(u){console.error("Failed to restore from PNG:",u),d("Failed to restore parameters")}else d("No image path available")},title:"Restore workflow and parameters from this version",children:""}),Ut.jsx("button",{className:"save-btn",onClick:async t=>{t.stopPropagation();const n=e.imageHistory[e.historyIndex];if(n)try{if(sn.path){const t=e.name||`Panel_${String(e.id).padStart(2,"0")}`,i=await cT.saveToProjectFolder(n.url,e.id,n.metadata.version,n.metadata,t);i.success?p(`Saved: ${i.savedPath}`):d(`Failed to save: ${i.error}`)}else{const{filename:t,blob:i}=await cT.saveImageToProject(n.url,e.id,n.metadata.version,n.metadata);cT.triggerDownload(i,t);const r=cT.generateMetadataJson(n),a=new Blob([r],{type:"application/json"});cT.triggerDownload(a,t.replace(".png","_metadata.json")),p(`Downloaded: ${t}`)}}catch(i){d(`Failed to save: ${i}`)}},title:sn.path?`Save to ${sn.path}`:"Download image",children:""})]}),"generating"===e.status&&Ut.jsxs("div",{className:"panel-generating-mini",children:[Ut.jsx("div",{className:"panel-gen-mini-bar",children:Ut.jsx("div",{className:"panel-gen-mini-bar-fill",style:{width:`${e.progress}%`}})}),Ut.jsxs("span",{className:"panel-gen-mini-badge",children:[Ut.jsx("span",{className:"panel-gen-mini-spinner"}),e.progress,"%"]})]}),"empty"===e.status&&!e.image&&Ut.jsx("button",{className:"panel-generate-btn large",onClick:t=>{t.stopPropagation(),oi(e.id)},disabled:!fi||"connected"!==ft&&0===Lt.filter(e=>"online"===e.status).length,title:"Generate",children:""}),Ut.jsx("span",{className:"panel-index",children:e.id})]}),Ut.jsxs("div",{className:"panel-controls",children:[("empty"===e.status||"complete"===e.status||"error"===e.status)&&Ut.jsx("button",{className:"panel-generate-btn "+("empty"!==e.status?"regenerate":""),onClick:t=>{t.stopPropagation(),w(t=>t.map(t=>{if(t.id!==e.id)return t;const n=t.image&&!t.images.includes(t.image)?[...t.images,t.image]:t.images;return{...t,status:"empty",progress:0,images:n}})),oi(e.id)},disabled:!fi||"connected"!==ft&&0===Lt.filter(e=>"online"===e.status).length,title:"empty"===e.status?"Generate":"Regenerate",children:"error"===e.status?"":""}),Ut.jsxs("select",{className:"panel-node-selector",value:e.nodeId||"",onChange:t=>{const n=t.target.value||void 0;w(t=>t.map(t=>t.id===e.id?{...t,nodeId:n}:t))},onClick:e=>e.stopPropagation(),children:[Ut.jsx("option",{value:"",children:"Auto"}),Lt.map(e=>Ut.jsxs("option",{value:e.id,disabled:"offline"===e.status,children:[e.name," (",e.status,")"]},e.id))]}),e.imageHistory.length>0&&e.historyIndex>=0&&Ut.jsx("button",{className:"panel-delete-btn",onClick:t=>{t.stopPropagation();const n=e.imageHistory[e.historyIndex];n&&xi(e.id,n.id)},title:"Delete image",children:Ut.jsx(WC,{size:14})})]}),Ut.jsx(vR,{panelId:e.id,notes:e.notes||"",onNotesChange:t=>{w(n=>n.map(n=>n.id===e.id?{...n,notes:t}:n))}}),Ut.jsx("div",{className:"panel-resize-handle",title:"Drag to resize",onMouseDown:t=>Wt(e.id,t)})]},e.id)})]})]}),Ut.jsx("div",{className:"resize-handle resize-handle-right",onMouseDown:e=>{e.preventDefault(),zn(!0)}}),Ut.jsxs("aside",{className:"stats-panel",style:{width:jn},children:[Ut.jsx("div",{className:"stats-header",children:"System Stats"}),Ut.jsx(wR,{panels:S,onCancelSingle:async e=>{if(It.current){await It.current.cancelGeneration()?(w(t=>t.map(t=>t.id===e?{...t,status:"empty",progress:0,parallelJobs:void 0}:t)),h("Generation cancelled")):d("Failed to cancel generation")}},onCancelParallelJob:async(e,t)=>{const n=Lt.find(e=>e.id===t);if(n)try{await fetch(`${n.url}/interrupt`,{method:"POST"}),h(`Cancelled generation on ${n.name}`)}catch(i){d(`Failed to cancel on ${n.name}: ${i}`)}}}),Lt.length>0&&Ut.jsx("div",{style:{padding:"8px",borderBottom:"1px solid #3d3d3d"},children:Ut.jsx(QC,{selectedBackendIds:nn,onSelectionChange:rn,disabled:!1})}),Ut.jsx("div",{className:"stats-content",children:0!==Lt.length||vt?Ut.jsxs("div",{className:"node-metrics-list",children:[Lt.map(e=>Ut.jsxs("div",{className:"node-metrics-card",children:[Ut.jsxs("div",{className:"node-metrics-header",children:[Ut.jsx("span",{className:"node-status-dot",style:{color:"online"===e.status?"#4dff6d":"busy"===e.status?"#ffcc00":"#ff4444"},children:""}),Ut.jsx("span",{className:"node-name",children:e.name})]}),(()=>{const t=S.filter(e=>"generating"===e.status&&e.parallelJobs).flatMap(e=>e.parallelJobs||[]).find(t=>t.nodeId===e.id&&("running"===t.status||"pending"===t.status));return t?Ut.jsxs("div",{className:"node-progress-container",children:[Ut.jsx("div",{className:"node-progress-bar",children:Ut.jsx("div",{className:"node-progress-fill",style:{width:`${t.progress}%`}})}),Ut.jsx("span",{className:"node-progress-text",children:"running"===t.status?`${t.progress}%`:"Queued"})]}):null})(),"online"===e.status&&Ut.jsxs("div",{className:"node-metrics-body",children:[Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"GPU"}),Ut.jsx("span",{className:"metric-value",children:e.gpuName})]}),Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"VRAM"}),Ut.jsxs("span",{className:"metric-value",children:[(e.vramUsed/1024).toFixed(1),"/",(e.vramTotal/1024).toFixed(1)," GB"]}),Ut.jsx("div",{className:"metric-bar",children:Ut.jsx("div",{className:"metric-bar-fill",style:{width:`${Math.min(100,e.vramUsed/e.vramTotal*100)}%`}})})]}),Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"GPU%"}),Ut.jsxs("span",{className:"metric-value",children:[(e.gpuUsage||0).toFixed(0),"%"]}),Ut.jsx("div",{className:"metric-bar",children:Ut.jsx("div",{className:"metric-bar-fill gpu",style:{width:`${e.gpuUsage||0}%`}})})]}),Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"Temp"}),Ut.jsxs("span",{className:"metric-value",children:[e.gpuTemp||0,"C"]})]}),Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"CPU"}),Ut.jsxs("span",{className:"metric-value",children:[(e.cpuUsage||0).toFixed(0),"%"]}),Ut.jsx("div",{className:"metric-bar",children:Ut.jsx("div",{className:"metric-bar-fill cpu",style:{width:`${e.cpuUsage||0}%`}})})]}),Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"RAM"}),Ut.jsxs("span",{className:"metric-value",children:[(e.ramUsed||0).toFixed(1),"/",(e.ramTotal||0).toFixed(1)," GB"]}),Ut.jsx("div",{className:"metric-bar",children:Ut.jsx("div",{className:"metric-bar-fill ram",style:{width:(e.ramTotal?e.ramUsed/e.ramTotal*100:0)+"%"}})})]})]}),"online"!==e.status&&Ut.jsx("div",{className:"node-metrics-offline",children:"offline"===e.status?"Offline":e.status})]},e.id)),0===Lt.length&&vt&&Ut.jsxs("div",{className:"node-metrics-card",children:[Ut.jsxs("div",{className:"node-metrics-header",children:[Ut.jsx("span",{className:"node-status-dot",style:{color:"#4dff6d"},children:""}),Ut.jsx("span",{className:"node-name",children:"Top Bar URL"})]}),Ut.jsxs("div",{className:"node-metrics-body",children:[Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"GPU"}),Ut.jsx("span",{className:"metric-value",children:(null==(n=null==(t=null==(e=vt.devices)?void 0:e[0])?void 0:t.name)?void 0:n.replace(/^cuda:\d+\s+/,"").replace(/:\w+Alloc\w*$/,""))||"Unknown"})]}),Ut.jsxs("div",{className:"metric-row",children:[Ut.jsx("span",{className:"metric-label",children:"VRAM"}),Ut.jsx("span",{className:"metric-value",children:(null==(r=null==(i=vt.devices)?void 0:i[0])?void 0:r.vram_total)?`${((vt.devices[0].vram_total-(vt.devices[0].vram_free||0))/1024/1024/1024).toFixed(1)}/${(vt.devices[0].vram_total/1024/1024/1024).toFixed(1)} GB`:"N/A"})]})]})]})]}):Ut.jsx("span",{className:"no-stats",children:"No nodes configured"})})]})]}),Et&&Ut.jsxs("div",{className:"log-panel",children:[Ut.jsxs("div",{className:"log-header",children:[Ut.jsx("span",{children:"Application Log"}),Ut.jsxs("div",{className:"log-controls",children:[Ut.jsxs("select",{value:bt,onChange:e=>St(e.target.value),children:[Ut.jsx("option",{value:"ALL",children:"All"}),Ut.jsx("option",{value:"COMFYUI",children:"COMFYUI"}),Ut.jsx("option",{value:"ERROR",children:"Error"})]}),Ut.jsxs("label",{children:[Ut.jsx("input",{type:"checkbox",checked:wt,onChange:e=>Mt(e.target.checked)}),"Auto-scroll"]}),Ut.jsx("button",{onClick:()=>Ct(!1),className:"toggle-log-btn",children:"Hide"})]})]}),Ut.jsxs("div",{className:"log-content",children:[_t.filter(e=>"ALL"===bt||e.tag.toUpperCase()===bt).map(e=>{return Ut.jsxs("div",{className:`log-entry ${e.tag}`,children:[Ut.jsxs("span",{className:"log-time",children:["[",(t=e.timestamp,t.toTimeString().split(" ")[0]),"]"]}),Ut.jsx("span",{className:"log-tag",children:e.tag}),Ut.jsx("span",{className:"log-message",children:e.message})]},e.id);var t}),Ut.jsx("div",{ref:Tt})]})]}),!Et&&Ut.jsx("button",{className:"show-log-btn",onClick:()=>Ct(!0),children:"Show Log"}),de&&pe&&Ut.jsx("div",{className:"modal-overlay",children:Ut.jsx("div",{className:"modal-content",children:Ut.jsx(TE,{workflow:pe.workflow,parsedWorkflow:pe.parsed,initialConfig:pe.config,comfyUrl:pt,onSave:e=>{re.current=!0,se(t=>t.map(t=>t.id===pe.id?{...t,config:e}:t)),he(!1),tn("info",`Updated workflow: ${pe.name}`)},onCancel:()=>he(!1)},pe.id)})}),ve&&be&&Ut.jsx("div",{className:"modal-overlay",children:Ut.jsxs("div",{className:"modal-content rename-dialog",children:[Ut.jsxs("div",{className:"modal-header",children:[Ut.jsx("h3",{children:"Rename Workflow"}),Ut.jsx("button",{className:"modal-close-btn",onClick:()=>ye(!1),children:Ut.jsx($C,{size:20})})]}),Ut.jsx("div",{className:"modal-body",children:Ut.jsxs("label",{className:"input-label",children:["Workflow Name",Ut.jsx("input",{type:"text",value:we,onChange:e=>Me(e.target.value),placeholder:"Enter workflow name...",className:"text-input",autoFocus:!0})]})}),Ut.jsxs("div",{className:"modal-footer",children:[Ut.jsx("button",{className:"btn-secondary",onClick:()=>ye(!1),children:"Cancel"}),Ut.jsx("button",{className:"btn-primary",onClick:()=>{we.trim()&&be&&(se(e=>e.map(e=>e.id===be.id?{...e,name:we.trim()}:e)),tn("info",`Renamed workflow from "${be.name}" to "${we.trim()}"`),ye(!1),Se(null),Me(""))},disabled:!we.trim(),children:"Rename"})]})]})}),Ut.jsx(eT,{isOpen:fe,onClose:()=>ge(!1),workflows:oe,onUpdateWorkflow:Kn}),Ut.jsx(xR,{isOpen:_e,onClose:()=>xe(!1),panels:S,projectName:sn.name||"Untitled Project",selectedPanelIds:S.filter(e=>e.selected).map(e=>e.id)}),kt&&Ut.jsx(YC,{onClose:()=>At(!1),onRestartNodes:async e=>{p(`Restarting ${e.length} selected node(s)...`);try{const t=[];for(const r of e){const e=await VE.restartBackend(r);t.push({nodeId:r,...e})}const n=t.filter(e=>e.success).length,i=t.length-n;0===i?p(`Successfully restarted ${n} node(s)`):0===n?d(`Failed to restart all ${i} node(s)`):p(`Restarted ${n} node(s), ${i} failed`)}catch(t){d(`Error restarting nodes: ${t instanceof Error?t.message:"Unknown error"}`)}}}),an&&Ut.jsx(gT,{isOpen:an,onClose:()=>on(!1),settings:sn,onSave:ln}),En&&Ut.jsx("div",{className:"modal-overlay",onClick:()=>Cn(!1),children:Ut.jsxs("div",{className:"modal-content load-project-modal",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"modal-header",children:[Ut.jsx("h2",{children:"Load Project"}),Ut.jsx("button",{className:"close-btn",onClick:()=>Cn(!1),children:Ut.jsx($C,{size:18})})]}),Ut.jsxs("div",{className:"load-project-content",children:[Ut.jsx("p",{className:"load-project-instruction",children:"Select a folder to browse for project files:"}),Ut.jsx(vT,{isOpen:!0,onClose:()=>{},onSelect:async e=>{An(e),Rn(!0);try{const t=await cT.listProjects(e);t.success&&t.projects.length>0?Pn(t.projects):t.success?(d("No project files found in the selected folder"),Pn([])):(d(`Failed to list projects: ${t.error}`),Pn([]))}catch(t){d(`Error loading projects: ${t}`),Pn([])}finally{Rn(!1)}},orchestratorUrl:sn.orchestratorUrl,initialPath:sn.path,title:"Select Folder"}),Nn&&Ut.jsx("div",{className:"loading-projects",children:"Loading projects..."}),Tn.length>0&&Ut.jsxs("div",{className:"available-projects",children:[Ut.jsx("h3",{children:"Select a project to load:"}),Ut.jsx("div",{className:"project-list",children:Tn.map(e=>Ut.jsxs("div",{className:"project-item",onClick:()=>(async e=>{var t;const n=await cT.loadProjectState(e);if(n.success&&n.state){const e=new Set(n.state.deleted_images||[]);un(e);const i=await cT.scanProjectPanels();if(i.success&&i.panels.length>0){const r=cT.getProject().orchestratorUrl||oT(),a=[],o=new Set,s=()=>{let e=1;for(;o.has(e);)e++;return o.add(e),e},l=n.state.panels,c=new Set,u=new Set;for(const e of i.panels){const t=l.find(t=>t.name===e.panel_name);t&&t.name&&(c.add(t.name),u.add(e.panel_name))}const d=i.panels.filter(e=>!u.has(e.panel_name)),h=l.filter(e=>!c.has(e.name??"")),p=new Map;for(let e=0;e<d.length&&e<h.length;e++)p.set(d[e].panel_name,h[e]),c.add(h[e].name??"");for(const n of i.panels){const i=n.images.filter(t=>!e.has(t.image_path));if(0===i.length)continue;const c=l.find(e=>e.name===n.panel_name)||p.get(n.panel_name)||void 0,u=(null==c?void 0:c.imageRatings)||{},d=i.map((e,t)=>({id:`${n.panel_name}_v${t+1}`,url:`${r}/api/serve-image?path=${encodeURIComponent(e.image_path)}`,metadata:{timestamp:new Date(1e3*e.modified_time),workflowId:"",workflowName:"Loaded",seed:0,promptSummary:"",parameters:{},workflow:{},sourceUrl:"",savedPath:e.image_path,version:t+1,rating:u[e.image_path]}}));let h;(null==c?void 0:c.id)&&!o.has(c.id)?(h=c.id,o.add(h)):h=s();const m=a.length;a.push({id:h,name:n.panel_name,x:(null==c?void 0:c.x)??kR(m+1),y:(null==c?void 0:c.y)??AR(m+1),width:(null==c?void 0:c.width)??300,height:(null==c?void 0:c.height)??300,notes:(null==c?void 0:c.notes)??"",workflowId:null==c?void 0:c.workflowId,parameterValues:null==c?void 0:c.parameterValues,nodeId:null==c?void 0:c.nodeId,imageHistory:d,historyIndex:d.length>0?d.length-1:-1,image:d.length>0?(null==(t=d[d.length-1])?void 0:t.url)??null:null,images:[],currentImageIndex:0,status:d.length>0?"complete":"empty",progress:d.length>0?100:0,locked:(null==c?void 0:c.locked)??!1,selected:!1})}for(const e of l){if(!e.name)continue;if(c.has(e.name))continue;let t;e.id&&!o.has(e.id)?(t=e.id,o.add(t)):t=s(),a.push({id:t,name:e.name,x:e.x,y:e.y,width:e.width??300,height:e.height??300,notes:e.notes??"",workflowId:e.workflowId,parameterValues:e.parameterValues,nodeId:e.nodeId,imageHistory:[],historyIndex:-1,image:null,images:[],currentImageIndex:0,status:"empty",progress:0,locked:!1,selected:!1})}a.sort((e,t)=>e.id-t.id),w(a)}else{const e=new Set,t=n.state.panels.map(t=>{let n=t.id;if(e.has(n))for(n=1;e.has(n);)n++;e.add(n);const i=t.image?"complete":"empty";return{...t,id:n,status:i,progress:t.image?100:0,parallelJobs:void 0}});w(t)}n.state.parameter_values&&(Ce(n.state.parameter_values),Bt.current=n.state.parameter_values),n.state.camera_angles&&Pe(n.state.camera_angles),n.state.selected_workflow_id&&ue(n.state.selected_workflow_id),n.state.comfy_url&&mt(n.state.comfy_url),ln(cT.getProject()),p(`Loaded project with ${n.state.panels.length} panels`),Cn(!1),Pn([])}else d(`Failed to load project: ${n.error}`)})(e.path),children:[Ut.jsx("span",{className:"project-name",children:e.name}),Ut.jsxs("span",{className:"project-meta",children:[e.panel_count," panels  ",new Date(e.saved_at).toLocaleString()]})]},e.path))})]}),kn&&!Nn&&0===Tn.length&&Ut.jsx("div",{className:"no-projects-found",children:"No project files found in this folder."})]}),Ut.jsx("div",{className:"modal-footer",children:Ut.jsx("button",{className:"cancel-btn",onClick:()=>Cn(!1),children:"Cancel"})})]})}),wn&&Ut.jsx(fT,{isOpen:!0,onClose:()=>Mn(null),mode:wn,orchestratorUrl:sn.orchestratorUrl,initialPath:sn.path,projectName:sn.name,onOpenProject:async e=>{var t;hn(!0),mn({progress:0,currentFile:"Loading project data..."});try{const n=await cT.loadProjectState(e);if(!n.success||!n.state)return d(`Failed to load project: ${n.error}`),void hn(!1);const i=new Set(n.state.deleted_images||[]);un(i),mn({progress:10,currentFile:"Scanning project panels..."});const r=await cT.scanProjectPanels();if(!r.success)return console.error("[Load] Failed to scan project panels:",r.error),d(`Failed to scan project: ${r.error}`),void hn(!1);mn({progress:50,currentFile:"Building panels..."});const a=cT.getProject().orchestratorUrl||oT(),o=[],s=new Set,l=()=>{let e=1;for(;s.has(e);)e++;return s.add(e),e},c=n.state.panels,u=new Set,h=new Set;for(const e of r.panels){const t=c.find(t=>t.name===e.panel_name);t&&t.name&&(u.add(t.name),h.add(e.panel_name))}const m=r.panels.filter(e=>!h.has(e.panel_name)),f=c.filter(e=>!u.has(e.name??"")),g=new Map;for(let e=0;e<m.length&&e<f.length;e++)g.set(m[e].panel_name,f[e]),u.add(f[e].name??""),console.log(`[Load] Paired renamed folder "${m[e].panel_name}" with saved panel "${f[e].name}"`);for(const e of r.panels){const n=e.images.filter(e=>!i.has(e.image_path));if(0===n.length)continue;const r=c.find(t=>t.name===e.panel_name)||g.get(e.panel_name)||void 0;console.log("[Load] Panel folder:",e.panel_name,"Saved panel found:",r?{name:r.name,notes:r.notes,imageRatings:null==r?void 0:r.imageRatings}:"NOT FOUND");const u=(null==r?void 0:r.imageRatings)||{},d=n.map((t,n)=>({id:`${e.panel_name}_v${n+1}`,url:`${a}/api/serve-image?path=${encodeURIComponent(t.image_path)}`,metadata:{timestamp:new Date(1e3*t.modified_time),workflowId:"",workflowName:"Loaded",seed:0,promptSummary:"",parameters:{},workflow:{},sourceUrl:"",savedPath:t.image_path,version:n+1,rating:u[t.image_path]}}));let h;(null==r?void 0:r.id)&&!s.has(r.id)?(h=r.id,s.add(h)):h=l();const p=o.length;o.push({id:h,name:e.panel_name,x:(null==r?void 0:r.x)??kR(p+1),y:(null==r?void 0:r.y)??AR(p+1),width:(null==r?void 0:r.width)??300,height:(null==r?void 0:r.height)??300,notes:(null==r?void 0:r.notes)??"",workflowId:null==r?void 0:r.workflowId,parameterValues:null==r?void 0:r.parameterValues,nodeId:null==r?void 0:r.nodeId,imageHistory:d,historyIndex:d.length>0?d.length-1:-1,image:d.length>0?(null==(t=d[d.length-1])?void 0:t.url)??null:null,images:[],currentImageIndex:0,status:d.length>0?"complete":"empty",progress:d.length>0?100:0,locked:(null==r?void 0:r.locked)??!1,selected:!1})}for(const e of c){if(!e.name)continue;if(u.has(e.name))continue;let t;e.id&&!s.has(e.id)?(t=e.id,s.add(t)):t=l(),o.push({id:t,name:e.name,x:e.x,y:e.y,width:e.width??300,height:e.height??300,notes:e.notes??"",workflowId:e.workflowId,parameterValues:e.parameterValues,nodeId:e.nodeId,imageHistory:[],historyIndex:-1,image:null,images:[],currentImageIndex:0,status:"empty",progress:0,locked:!1,selected:!1})}o.sort((e,t)=>e.id-t.id),w(o),n.state.parameter_values&&(Ce(n.state.parameter_values),Bt.current=n.state.parameter_values),n.state.camera_angles&&Pe(n.state.camera_angles),n.state.selected_workflow_id&&ue(n.state.selected_workflow_id),n.state.comfy_url&&mt(n.state.comfy_url),ln(cT.getProject()),mn({progress:100,currentFile:"Complete!"});let v=0;o.forEach(e=>v+=e.imageHistory.length),p(`Loaded project with ${o.length} panels, ${v} images`),setTimeout(()=>{Mn(null),hn(!1)},500)}catch(n){console.error("[Load] Failed to load project:",n),d(`Failed to load project: ${String(n)}`),hn(!1)}},onSaveProject:async(e,t)=>{const n={...sn,name:t,path:e};ln(n),cT.setProject(n);const i=await cT.saveProjectState(S,void 0,Ee,{selectedWorkflowId:ce||void 0,renderNodes:Lt,comfyUrl:pt,cameraAngles:Te});i.success?(p(`Project saved to ${i.savedPath}`),Mn(null)):d(`Failed to save project: ${i.error}`)}}),Q&&Ut.jsx("div",{className:"modal-overlay",onClick:()=>ee(!1),children:Ut.jsxs("div",{className:"modal-content folder-import-modal",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"modal-header",children:[Ut.jsx("h2",{children:"Import Folder"}),Ut.jsx("button",{className:"close-btn",onClick:()=>ee(!1),children:Ut.jsx($C,{size:18})})]}),Ut.jsxs("div",{className:"modal-body",children:[Ut.jsxs("p",{className:"folder-import-instruction",children:["Select a folder to import images from ",Ut.jsx("strong",{children:te}),":"]}),Ut.jsx(vT,{isOpen:!0,onClose:()=>{},onSelect:async e=>{const t=Math.max(...S.map(e=>e.id),0)+1,n=`Panel_${String(t).padStart(2,"0")}`,i=sn.orchestratorUrl||oT();try{tn("info",`Scanning folder ${e} for images...`);const r=await fetch(`${i}/api/scan-folder-images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_path:e})});if(!r.ok)throw new Error(`Scan failed: ${r.status}`);const a=await r.json();if(!a.success||0===a.images.length)return tn("warning",`No images found in folder: ${e}`),h("No images found in the selected folder"),ee(!1),void ne("");const o=a.images.map((e,n)=>({id:`import_${t}_${n}`,url:`${i}/api/serve-image?path=${encodeURIComponent(e.image_path)}`,metadata:{timestamp:new Date(1e3*e.modified_time),workflowId:"",workflowName:"Imported",seed:0,promptSummary:`Imported from ${e.filename}`,parameters:{},workflow:{},sourceUrl:"",savedPath:e.image_path,version:n+1}})),s=e.split(/[/\\]/).pop()||n,l=s.match(/^[a-zA-Z0-9_-]+$/)?s:n;w(e=>{var n;return[...e,{id:t,name:l,x:50+20*e.length,y:50+20*e.length,width:300,height:300,image:(null==(n=o[o.length-1])?void 0:n.url)||"",images:[],status:o.length>0?"complete":"empty",progress:o.length>0?100:0,imageHistory:o,historyIndex:o.length>0?o.length-1:-1,currentImageIndex:0,workflowId:void 0,parameterValues:{},notes:"",locked:o.length>0,selected:!1}]}),tn("info",`Imported ${o.length} images into panel ${l}`),p(`Imported ${o.length} images`)}catch(r){const e=r instanceof Error?r.message:"Unknown error";tn("error",`Failed to import folder: ${e}`),d(`Failed to import folder: ${e}`)}ee(!1),ne("")},orchestratorUrl:sn.orchestratorUrl,initialPath:sn.path,title:"Select Import Folder"})]}),Ut.jsx("div",{className:"modal-footer",children:Ut.jsx("button",{className:"cancel-btn",onClick:()=>ee(!1),children:"Cancel"})})]})}),Ut.jsx(UE,{notifications:m,onRemove:f}),Ut.jsx(yT,{isOpen:(null==fn?void 0:fn.isOpen)||!1,filename:(null==fn?void 0:fn.filename)||"",onConfirm:()=>{fn&&(bi(fn.panelId,fn.entryId),gn(null))},onCancel:()=>gn(null),onSuppressForSession:()=>yn(!0)}),Ut.jsxs("div",{className:"floating-action-container",children:[(S.some(e=>"generating"===e.status)||Lt.some(e=>"busy"===e.status))&&Ut.jsxs("button",{className:"floating-cancel-btn",onClick:Si,title:"Cancel All Generations",children:[Ut.jsx(CC,{size:18}),"Cancel"]}),Ut.jsx("button",{className:"floating-generate-btn",onClick:()=>{M?oi(M):S.length>0&&oi(S[0].id)},disabled:!fi||"connected"!==ft&&0===Lt.filter(e=>"online"===e.status).length,title:"Generate (G)",children:" Generate"})]}),Ye.visible&&Ut.jsxs("div",{className:"panel-context-menu",style:{position:"fixed",top:Ye.y,left:Ye.x,zIndex:1e4},onClick:e=>e.stopPropagation(),children:[Ut.jsxs("button",{className:"context-menu-item",onClick:()=>{Ye.panelId&&qn(Ye.panelId),Ze(e=>({...e,visible:!1}))},disabled:!Ye.panelId||!(null==(l=null==(s=null==(o=S.find(e=>e.id===Ye.panelId))?void 0:o.imageHistory[(null==(a=S.find(e=>e.id===Ye.panelId))?void 0:a.historyIndex)??0])?void 0:s.metadata)?void 0:l.savedPath),children:[Ut.jsx(pC,{size:14})," Open in Explorer"]}),Ut.jsxs("button",{className:"context-menu-item",onClick:async()=>{var e,t,n,i,r,a;if(!Ye.panelId)return;const o=S.find(e=>e.id===Ye.panelId);if(!o||0===o.imageHistory.length)return h("No image in this panel"),void Ze(e=>({...e,visible:!1}));const s=o.imageHistory[o.historyIndex];if((null==(e=null==s?void 0:s.metadata)?void 0:e.parameters)&&(null==(t=null==s?void 0:s.metadata)?void 0:t.workflowId)){s.metadata.workflowId!==ce&&(re.current=!0,ue(s.metadata.workflowId));const e=s.metadata.parameters;return Ce(e),Bt.current=e,p(`Restored parameters from v${o.historyIndex+1}`),void Ze(e=>({...e,visible:!1}))}const l=null==(n=null==s?void 0:s.metadata)?void 0:n.savedPath;if(!l)return d("No image path available for parameter extraction"),void Ze(e=>({...e,visible:!1}));try{const e=cT.getProject().orchestratorUrl||oT(),t=await fetch(`${e}/api/png-metadata?path=${encodeURIComponent(l)}`),n=await t.json();if(!n.success||!n.prompt)return d("Could not read PNG metadata"),void Ze(e=>({...e,visible:!1}));const o=n.prompt;let s;const u=Object.keys(o).filter(e=>"meta"!==e&&"version"!==e);let m=0;for(const a of oe){const e=Object.keys(a.workflow).filter(e=>"meta"!==e&&"version"!==e);let t=0;for(const s of u)if(a.workflow[s]){const e=null==(i=o[s])?void 0:i.class_type,n=null==(r=a.workflow[s])?void 0:r.class_type;e&&e===n&&t++}const n=u.length>0?t/Math.max(u.length,e.length):0;n>m&&n>.5&&(m=n,s=a)}if(!s){let e=null;for(const t of Object.values(o))if("SaveImage"===t.class_type&&(null==(a=t.inputs)?void 0:a.filename_prefix)){e=t.inputs.filename_prefix;break}if(e&&(s=oe.find(t=>t.id===e),!s)){const t=e=>e.toLowerCase().replace(/[_\s-]/g,""),n=t(e);s=oe.find(e=>t(e.id).includes(n)||n.includes(t(e.id))||t(e.name||"").includes(n)||n.includes(t(e.name||"")))}}s||h("Could not find matching workflow. Extracting parameters only.");const f={},g={};if(s){for(const e of s.parsed.parameters){const t=e.node_id,n=e.input_name,i=o[t];if((null==i?void 0:i.inputs)&&n in i.inputs){const t=i.inputs[n];Array.isArray(t)||(f[e.name]=t)}}for(const e of s.parsed.image_inputs){const t=e.node_id,n=e.input_name,i=o[t];if((null==i?void 0:i.inputs)&&n in i.inputs){const t=i.inputs[n];t&&"string"==typeof t&&(g[e.name]=t)}}}if(0===Object.keys(f).length)for(const i of Object.values(o)){if(!i.inputs)continue;const e=i.class_type||"";if((e.includes("KSampler")||e.includes("Sampler"))&&(void 0!==i.inputs.seed&&(f.seed=i.inputs.seed),void 0!==i.inputs.steps&&(f.steps=i.inputs.steps),void 0!==i.inputs.cfg&&(f.cfg=i.inputs.cfg),i.inputs.sampler_name&&(f.sampler_name=i.inputs.sampler_name),i.inputs.scheduler&&(f.scheduler=i.inputs.scheduler),void 0!==i.inputs.denoise&&(f.denoise=i.inputs.denoise)),"CLIPTextEncode"===e&&i.inputs.text){const e=i.inputs.text;"string"==typeof e&&e.length>20&&!f.positive_prompt&&(f.positive_prompt=e)}if("LoadImage"===e&&i.inputs.image){const e=i.inputs.image;g.reference_image||(g.reference_image=e)}}let v=0;s&&s.id!==ce&&(re.current=!0,ue(s.id),v++),Object.keys(f).length>0&&(Ce(e=>{const t={...e,...f};return Bt.current=t,t}),v+=Object.keys(f).length);const y=Object.keys(g).length;if(y>0){const e=Lt.filter(e=>"online"===e.status);if(e.length>0){const t=e[0].url.replace(/\/$/,"");for(const[e,n]of Object.entries(g))try{const i=`${t}/view?filename=${encodeURIComponent(n)}&type=input`,r=await fetch(i);if(r.ok){const t=await r.blob(),n=await new Promise(e=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(t)});f[e]=n,v++}}catch(c){console.warn(`Could not fetch image ${n}:`,c)}Object.keys(g).some(e=>f[e])&&Ce(e=>{const t={...e,...f};return Bt.current=t,t})}}if(v>0){const e=s?`workflow "${s.name||s.id}"`:"",t=`${Object.keys(f).length} parameters`;p(`Restored ${e?e+", ":""}${t}${y>0?`, ${y} images`:""}`)}else h("No parameters could be extracted from PNG")}catch(c){console.error("Failed to restore from PNG:",c),d("Failed to restore parameters")}Ze(e=>({...e,visible:!1}))},disabled:!Ye.panelId||0===(null==(c=S.find(e=>e.id===Ye.panelId))?void 0:c.imageHistory.length),children:[Ut.jsx(jC,{size:14})," Restore Parameters"]})]}),Le&&je&&Ut.jsxs("div",{ref:Ke,className:"image-viewer-overlay",onClick:Bn,tabIndex:0,onKeyDown:e=>{if("Escape"===e.key)e.preventDefault(),Bn();else if("ArrowLeft"===e.key){if(e.preventDefault(),Ue){const e=S.find(e=>e.id===Ue);e&&e.historyIndex>0&&Hn(-1)}}else if("ArrowRight"===e.key){if(e.preventDefault(),Ue){const e=S.find(e=>e.id===Ue);e&&e.historyIndex<e.imageHistory.length-1&&Hn(1)}}else if("Delete"===e.key&&(e.preventDefault(),Ue)){const e=S.find(e=>e.id===Ue);if(e&&e.historyIndex>=0&&e.imageHistory.length>0){const t=e.imageHistory[e.historyIndex];t&&xi(Ue,t.id)}}},children:[Ut.jsxs("div",{className:"image-viewer-toolbar",children:[Ut.jsx("div",{className:"toolbar-group",children:Ue&&(()=>{const e=S.find(e=>e.id===Ue);return e&&e.imageHistory.length>1?Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Hn(-1)},disabled:e.historyIndex<=0,title:"Previous version ()","aria-label":"Previous version",children:Ut.jsx(QE,{size:20})}),Ut.jsxs("span",{className:"viewer-version-badge",children:["v",e.historyIndex+1,"/",e.imageHistory.length]}),Ut.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Hn(1)},disabled:e.historyIndex>=e.imageHistory.length-1,title:"Next version ()","aria-label":"Next version",children:Ut.jsx(eC,{size:20})})]}):null})()}),Ut.jsxs("div",{className:"toolbar-group zoom-controls",children:[Ut.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Wn()},title:"Zoom Out (-)","aria-label":"Zoom out",children:Ut.jsx(KC,{size:20})}),Ut.jsxs("span",{className:"zoom-percentage",children:[Math.round(100*Fe),"%"]}),Ut.jsx("button",{className:"toolbar-btn",onClick:e=>{e.stopPropagation(),Vn()},title:"Zoom In (+)","aria-label":"Zoom in",children:Ut.jsx(qC,{size:20})}),Ut.jsx("div",{className:"toolbar-separator"}),Ut.jsx("button",{className:"toolbar-btn "+("fit"===ut?"active":""),onClick:e=>{e.stopPropagation(),Gn()},title:"Fit to Screen (F)","aria-label":"Fit to screen",children:Ut.jsx(wC,{size:20})}),Ut.jsx("button",{className:"toolbar-btn "+("actual"===ut?"active":""),onClick:e=>{e.stopPropagation(),$n()},title:"Actual Size (1)","aria-label":"Actual size",children:Ut.jsx(sC,{size:20})})]}),Ut.jsxs("div",{className:"toolbar-group",children:[Ue&&(()=>{const e=S.find(e=>e.id===Ue);return e&&e.imageHistory.length>1?Ut.jsx("button",{className:"toolbar-btn "+(Ve?"active":""),onClick:e=>{e.stopPropagation(),Xn()},title:"Compare Mode (C)","aria-label":"Toggle compare mode",children:Ut.jsx(cC,{size:20})}):null})(),Ut.jsx("button",{className:"toolbar-btn "+(Je?"active":""),onClick:e=>{e.stopPropagation(),Qe(e=>!e)},title:"Toggle Metadata Panel (I)","aria-label":"Toggle metadata panel",children:Je?Ut.jsx(TC,{size:20}):Ut.jsx(PC,{size:20})}),Ut.jsx("div",{className:"toolbar-separator"}),Ue&&(()=>{const e=S.find(e=>e.id===Ue);return e&&e.historyIndex>=0&&e.imageHistory.length>0?Ut.jsx("button",{className:"toolbar-btn delete-btn",onClick:t=>{t.stopPropagation();const n=e.imageHistory[e.historyIndex];n&&xi(Ue,n.id)},title:"Delete Image (Del)","aria-label":"Delete image",children:Ut.jsx(WC,{size:20})}):null})(),Ut.jsx("button",{className:"toolbar-btn close-btn",onClick:e=>{e.stopPropagation(),Bn()},title:"Close (Esc)","aria-label":"Close viewer",children:Ut.jsx($C,{size:20})})]})]}),Ve&&Ue&&Ut.jsxs("div",{className:"image-viewer-compare-selector",onClick:e=>e.stopPropagation(),children:[Ut.jsx("span",{children:"Compare with:"}),null==(u=S.find(e=>e.id===Ue))?void 0:u.imageHistory.map((e,t)=>Ut.jsxs("button",{onClick:()=>$e(e.url),className:Ge===e.url?"active":"",disabled:e.url===je,children:["v",t+1]},e.id))]}),Ut.jsxs("div",{className:"image-viewer-main",children:[Ut.jsxs("div",{ref:ht,className:"image-viewer-container",style:{flex:1,display:"flex",flexDirection:"row"},onClick:e=>e.stopPropagation(),children:[Ue&&(()=>{const e=S.find(e=>e.id===Ue);return!e||e.imageHistory.length<=1?null:Ut.jsx("div",{className:"thumbnail-strip-vertical",onClick:e=>e.stopPropagation(),children:e.imageHistory.map((t,n)=>{var i;return Ut.jsxs("div",{className:"thumbnail-item "+(n===e.historyIndex?"active":""),onClick:()=>{De(t.url),w(e=>e.map(e=>{var t;return e.id===Ue?{...e,historyIndex:n,image:(null==(t=e.imageHistory[n])?void 0:t.url)||null}:e}))},children:[rT(t.url)?Ut.jsx("video",{src:t.url,muted:!0,playsInline:!0,preload:"metadata",style:{maxHeight:256,maxWidth:256,objectFit:"contain"},draggable:!1}):Ut.jsx("img",{src:t.url,alt:`Version ${n+1}`,style:{maxHeight:256,maxWidth:256,objectFit:"contain"},draggable:!1}),Ut.jsx("span",{className:"thumbnail-filename",children:(null==(i=t.metadata)?void 0:i.savedPath)?t.metadata.savedPath.split(/[\\\/]/).pop():`v${String(n+1).padStart(3,"0")}`})]},t.id)})})})(),Ut.jsxs("div",{className:"image-viewer-main-area",onWheel:e=>{e.stopPropagation();const t=e.deltaY>0?-.1:.1;dt("custom"),ze(e=>CR(e+t))},onMouseDown:e=>{if(0!==e.button||Ve)return;const t=e.clientX-Be.x,n=e.clientY-Be.y,i=e=>{He({x:e.clientX-t,y:e.clientY-n})},r=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)},children:[!Ve&&Ut.jsxs(Ut.Fragment,{children:[rT(je)?Ut.jsx("video",{src:je,controls:!0,loop:!0,autoPlay:!0,playsInline:!0,style:{transform:`translate(${Be.x}px, ${Be.y}px) scale(${Fe})`,cursor:"grab",maxWidth:"100%",maxHeight:"calc(100% - 30px)",objectFit:"contain"},draggable:!1,onError:e=>{console.error("[ImageViewer] Failed to load video:",je),console.error("[ImageViewer] Error event:",e)},onLoadedData:()=>{console.log("[ImageViewer] Video loaded successfully")}}):Ut.jsx("img",{src:je,alt:"Viewer",style:{transform:`translate(${Be.x}px, ${Be.y}px) scale(${Fe})`,cursor:"grab",maxWidth:"100%",maxHeight:"calc(100% - 30px)",objectFit:"contain"},draggable:!1,onError:e=>{console.error("[ImageViewer] Failed to load image:",je),console.error("[ImageViewer] Error event:",e)},onLoad:()=>{console.log("[ImageViewer] Image loaded successfully")}}),Ue&&(()=>{var e;const t=S.find(e=>e.id===Ue),n=null==t?void 0:t.imageHistory[t.historyIndex],i=(null==(e=null==n?void 0:n.metadata)?void 0:e.savedPath)?n.metadata.savedPath.split(/[\\\/]/).pop():(null==je?void 0:je.split(/[\\\/]/).pop())||"Unknown";return Ut.jsx("div",{className:"image-viewer-filename",children:i})})()]}),Ve&&Ge&&Ut.jsxs("div",{className:"image-compare-container",onMouseMove:e=>{const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*100;qe(Math.max(0,Math.min(100,n)))},children:[Ut.jsx("img",{src:je,alt:"Current",className:"compare-base",draggable:!1}),Ut.jsx("div",{className:"compare-overlay",style:{clipPath:`inset(0 ${100-Xe}% 0 0)`},children:Ut.jsx("img",{src:Ge,alt:"Compare",draggable:!1})}),Ut.jsx("div",{className:"compare-slider",style:{left:`${Xe}%`},children:Ut.jsx("div",{className:"compare-slider-handle",children:""})})]})]})," "]})," ",Je&&Ue&&(()=>{const e=S.find(e=>e.id===Ue),t=null==e?void 0:e.imageHistory[e.historyIndex];if(!t)return null;const n=t.metadata,i=ot&&(ot.prompt||ot.workflow)?(()=>{if(!(null==ot?void 0:ot.prompt))return{seed:null,prompt:null,model:null,workflowName:null,steps:null,cfg:null,sampler:null,scheduler:null,denoise:null};const e=ot.prompt;let t=null,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;for(const[u,d]of Object.entries(e)){if(!d.inputs)continue;const e=d.class_type||"";if((e.includes("KSampler")||e.includes("Sampler"))&&(void 0!==d.inputs.seed&&null===t&&(t=d.inputs.seed),void 0!==d.inputs.steps&&null===a&&(a=d.inputs.steps),void 0!==d.inputs.cfg&&null===o&&(o=d.inputs.cfg),d.inputs.sampler_name&&!s&&(s=d.inputs.sampler_name),d.inputs.scheduler&&!l&&(l=d.inputs.scheduler),void 0!==d.inputs.denoise&&null===c&&(c=d.inputs.denoise),d.inputs.positive_prompt&&!n)){const e=d.inputs.positive_prompt;"string"==typeof e&&e.length>10&&(n=e)}if("CLIPTextEncode"===e&&d.inputs.text&&!n){const e=d.inputs.text;"string"==typeof e&&e.length>20&&(n=e)}if(e.includes("TextEncode")&&!n){const e=d.inputs.prompt||d.inputs.text;"string"==typeof e&&e.length>20&&(n=e)}"UnetLoaderGGUF"===e&&d.inputs.unet_name&&!i&&(i=d.inputs.unet_name),"UNETLoader"===e&&d.inputs.unet_name&&!i&&(i=d.inputs.unet_name),"CheckpointLoaderSimple"!==e&&"CheckpointLoader"!==e||!d.inputs.ckpt_name||i||(i=d.inputs.ckpt_name),"UpscaleModelLoader"===e&&d.inputs.model_name&&!i&&(i=d.inputs.model_name),e.includes("Loader")&&!i&&(d.inputs.unet_name?i=d.inputs.unet_name:d.inputs.ckpt_name?i=d.inputs.ckpt_name:d.inputs.model_name&&(i=d.inputs.model_name)),"SaveImage"===e&&d.inputs.filename_prefix&&!r&&(r=d.inputs.filename_prefix)}if(!r&&ot.workflow){r=ot.workflow.name||null}return{seed:t,prompt:n,model:i,workflowName:r,steps:a,cfg:o,sampler:s,scheduler:l,denoise:c}})():null,r=(e=>{if(!e)return{steps:null,cfg:null,sampler:null,scheduler:null,denoise:null,model:null};console.log("[Metadata] Entry parameters:",Object.keys(e),e);const t=t=>{for(const n of t){if(void 0!==e[n])return e[n];for(const[t,i]of Object.entries(e))if((t.startsWith(n+"_")||t===n)&&void 0!==i)return i}return null};return{steps:t(["steps"]),cfg:t(["cfg","cfg_scale","guidance_scale"]),sampler:t(["sampler_name","sampler"]),scheduler:t(["scheduler"]),denoise:t(["denoise","denoising_strength"]),model:t(["ckpt_name","unet_name","model_name","model"])}})(null==n?void 0:n.parameters),a=(null==n?void 0:n.seed)??(null==i?void 0:i.seed)??null,o=(null==n?void 0:n.promptSummary)||(null==i?void 0:i.prompt)||null,s=(null==r?void 0:r.model)||function(e){if(!e)return;const t=["model","ckpt_name","checkpoint","model_name","unet_name","clip_name","vae_name"];for(const n of t){const t=e[n];if("string"==typeof t&&t.trim()){const e=t.split(/[\\/]/);return e[e.length-1].replace(/\.(safetensors|ckpt|pt|pth|bin)$/i,"")}}for(const[n,i]of Object.entries(e))if("string"==typeof i&&i.trim())for(const e of t)if(n.toLowerCase().includes(e)){const e=i.split(/[\\/]/);return e[e.length-1].replace(/\.(safetensors|ckpt|pt|pth|bin)$/i,"")}}(null==n?void 0:n.parameters)||(null==i?void 0:i.model)||null,l=(null==n?void 0:n.workflowName)||(null==i?void 0:i.workflowName)||"Unknown",c=(null==n?void 0:n.nodeName)||null,u=(null==n?void 0:n.generationTime)||null,d=(null==n?void 0:n.timestamp)||null,h=(null==n?void 0:n.version)??(void 0!==(null==e?void 0:e.historyIndex)?e.historyIndex+1:1),p=(null==r?void 0:r.steps)??(null==i?void 0:i.steps)??null,m=(null==r?void 0:r.cfg)??(null==i?void 0:i.cfg)??null,f=(null==r?void 0:r.sampler)??(null==i?void 0:i.sampler)??null,g=(null==r?void 0:r.scheduler)??(null==i?void 0:i.scheduler)??null,v=(null==r?void 0:r.denoise)??(null==i?void 0:i.denoise)??null,y=function(e,t){if(t)return`${t.width}${t.height}`;if(!e)return;const n=e.width||e.image_width,i=e.height||e.image_height;return"number"==typeof n&&"number"==typeof i?`${n}${i}`:void 0}(null==n?void 0:n.parameters,nt),_=function(e){if(null==e||isNaN(e))return"Unknown";const t=["B","KB","MB","GB"];let n=e,i=0;for(;n>=1024&&i<t.length-1;)n/=1024,i++;return`${n.toFixed(0===i?0:1)} ${t[i]}`}(rt);return Ut.jsxs("div",{className:"image-viewer-metadata-panel",onClick:e=>e.stopPropagation(),children:[Ut.jsxs("div",{className:"metadata-panel-header",children:[Ut.jsx(_C,{size:16}),Ut.jsx("span",{children:"Image Info"}),lt&&Ut.jsx("span",{className:"metadata-loading",children:"Loading..."}),Ut.jsx("button",{className:"metadata-toggle-btn",onClick:()=>Qe(!1),title:"Hide metadata panel","aria-label":"Hide metadata panel",children:Ut.jsx(TC,{size:14})})]}),Ut.jsxs("div",{className:"metadata-panel-content",children:[Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Resolution"}),Ut.jsx("span",{className:"metadata-value",children:y||"Unknown"})]}),Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"File Size"}),Ut.jsx("span",{className:"metadata-value",children:_})]}),Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Workflow"}),Ut.jsx("span",{className:"metadata-value workflow-name",title:l,children:l})]}),s&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Model"}),Ut.jsx("span",{className:"metadata-value model-name",title:s,children:s})]}),Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Seed"}),Ut.jsx("span",{className:"metadata-value",children:null!==a&&-1!==a?a:"Unknown"})]}),null!==p&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Steps"}),Ut.jsx("span",{className:"metadata-value",children:p})]}),null!==m&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"CFG"}),Ut.jsx("span",{className:"metadata-value",children:m})]}),f&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Sampler"}),Ut.jsx("span",{className:"metadata-value",children:f})]}),g&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Scheduler"}),Ut.jsx("span",{className:"metadata-value",children:g})]}),null!==v&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Denoise"}),Ut.jsx("span",{className:"metadata-value",children:v})]}),c&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Render Node"}),Ut.jsx("span",{className:"metadata-value",children:c})]}),u&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Render Time"}),Ut.jsxs("span",{className:"metadata-value",children:[u.toFixed(1),"s"]})]}),d&&Ut.jsxs("div",{className:"metadata-row",children:[Ut.jsx("span",{className:"metadata-label",children:"Created"}),Ut.jsx("span",{className:"metadata-value",children:TR(d)||"Unknown"})]}),o&&Ut.jsxs("div",{className:"metadata-prompt-section",children:[Ut.jsx("div",{className:"metadata-label",children:"Prompt"}),Ut.jsx("div",{className:"metadata-prompt-text "+(et?"expanded":""),children:et?o:ER(o,150)}),o.length>150&&Ut.jsx("button",{className:"show-more-btn",onClick:()=>tt(e=>!e),children:et?"Show less":"Show more"})]}),Ut.jsxs("div",{className:"metadata-footer",children:["Version ",h,"  Panel ",Ue]})]})]})})()]})]})]})}function DR(){const[e,t]=Pt.useState({status:"processing",message:"Processing authorization..."});Pt.useEffect(()=>{(async()=>{const e=new URLSearchParams(window.location.search),n=e.get("code"),i=e.get("state"),r=e.get("error"),a=e.get("error_description");if(r)return t({status:"error",message:"Authorization failed",error:a||r}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:r,error_description:a},window.location.origin));if(!n)return t({status:"error",message:"Missing authorization code",error:"No authorization code received from provider"}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:"missing_code",error_description:"No authorization code received"},window.location.origin));const o=sessionStorage.getItem("oauth_state"),s=sessionStorage.getItem("oauth_provider");if(!i||i!==o)return t({status:"error",message:"Security validation failed",error:"State mismatch - possible CSRF attack. Please try again."}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:"state_mismatch",error_description:"State parameter mismatch"},window.location.origin));if(!s)return t({status:"error",message:"Session expired",error:"Provider information not found. Please try again."}),void(window.opener&&window.opener.postMessage({type:"oauth_callback",error:"no_provider",error_description:"Provider session data missing"},window.location.origin));try{t({status:"processing",message:"Exchanging authorization code for tokens..."});const e=`${window.location.origin}/oauth/callback`,r=await Im.exchangeOAuthCode(s,n,i,e);if(!r.success||!r.access_token)throw new Error("Token exchange failed - no access token received");sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_provider"),t({status:"success",message:"Authorization successful! You can close this window."}),window.opener&&(window.opener.postMessage({type:"oauth_callback",access_token:r.access_token,refresh_token:r.refresh_token,token_type:r.token_type,expires_in:r.expires_in,scope:r.scope},window.location.origin),setTimeout(()=>{window.close()},1500))}catch(l){const e=l instanceof Error?l.message:"Unknown error";t({status:"error",message:"Token exchange failed",error:e}),window.opener&&window.opener.postMessage({type:"oauth_callback",error:"token_exchange_failed",error_description:e},window.location.origin)}})()},[]);const n={fontSize:"3rem",marginBottom:"1rem"},i={fontSize:"1.25rem",fontWeight:600,marginBottom:"0.5rem"},r={fontSize:"0.9rem",color:"#a0a0a0",marginBottom:"1rem"};return Ut.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"2rem",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backgroundColor:"#1a1a2e",color:"#eaeaea"},children:[Ut.jsx("style",{children:"\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        "}),Ut.jsxs("div",{style:{backgroundColor:"#16213e",borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"100%",textAlign:"center",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"},children:["processing"===e.status&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #2a3a5e",borderTopColor:"#4a9eff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"}}),Ut.jsx("div",{style:i,children:e.message}),Ut.jsx("div",{style:r,children:"Please wait..."})]}),"success"===e.status&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("div",{style:n,children:""}),Ut.jsx("div",{style:i,children:e.message}),Ut.jsx("div",{style:r,children:"This window will close automatically."})]}),"error"===e.status&&Ut.jsxs(Ut.Fragment,{children:[Ut.jsx("div",{style:n,children:""}),Ut.jsx("div",{style:i,children:e.message}),e.error&&Ut.jsx("div",{style:{fontSize:"0.85rem",color:"#ff6b6b",backgroundColor:"rgba(255, 107, 107, 0.1)",padding:"0.75rem",borderRadius:"6px",marginTop:"1rem"},children:e.error}),Ut.jsx("button",{style:{marginTop:"1.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#4a9eff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",fontWeight:500},onClick:()=>window.close(),children:"Close Window"})]})]})]})}class UR extends Pt.Component{constructor(e){super(e),je(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var n,i;console.error("ErrorBoundary caught an error:",e),console.error("Component stack:",t.componentStack),this.setState({errorInfo:t}),null==(i=(n=this.props).onError)||i.call(n,e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:Ut.jsx("div",{style:OR.container,children:Ut.jsxs("div",{style:OR.card,children:[Ut.jsx("div",{style:OR.iconContainer,children:Ut.jsx("span",{style:OR.icon,children:"!"})}),Ut.jsx("h2",{style:OR.title,children:"Something went wrong"}),Ut.jsx("p",{style:OR.message,children:"An unexpected error occurred. Please try again or refresh the page."}),this.state.error&&Ut.jsxs("details",{style:OR.details,children:[Ut.jsx("summary",{style:OR.summary,children:"Error Details"}),Ut.jsx("pre",{style:OR.errorText,children:this.state.error.toString()}),this.state.errorInfo&&Ut.jsx("pre",{style:OR.stackTrace,children:this.state.errorInfo.componentStack})]}),Ut.jsxs("div",{style:OR.buttonContainer,children:[Ut.jsx("button",{onClick:this.handleReset,style:OR.button,children:"Try Again"}),Ut.jsx("button",{onClick:()=>window.location.reload(),style:OR.secondaryButton,children:"Refresh Page"})]})]})}):this.props.children}}const OR={container:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",backgroundColor:"#0d1117",padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},card:{backgroundColor:"#161b22",borderRadius:"12px",padding:"40px",maxWidth:"500px",width:"100%",textAlign:"center",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.4)",border:"1px solid #30363d"},iconContainer:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:"rgba(248, 81, 73, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},icon:{fontSize:"32px",color:"#f85149",fontWeight:"bold"},title:{color:"#e6edf3",fontSize:"24px",fontWeight:600,marginBottom:"12px",margin:"0 0 12px 0"},message:{color:"#8b949e",fontSize:"14px",lineHeight:1.6,marginBottom:"24px",margin:"0 0 24px 0"},details:{backgroundColor:"#0d1117",borderRadius:"8px",padding:"12px",marginBottom:"24px",textAlign:"left",border:"1px solid #30363d"},summary:{color:"#8b949e",cursor:"pointer",fontSize:"13px",fontWeight:500},errorText:{color:"#f85149",fontSize:"12px",marginTop:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word",margin:"12px 0 0 0"},stackTrace:{color:"#8b949e",fontSize:"11px",marginTop:"8px",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:"200px",overflow:"auto",margin:"8px 0 0 0"},buttonContainer:{display:"flex",gap:"12px",justifyContent:"center"},button:{backgroundColor:"#238636",color:"#ffffff",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"background-color 0.2s"},secondaryButton:{backgroundColor:"#21262d",color:"#c9d1d9",border:"1px solid #30363d",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"background-color 0.2s"}},FR=window.location.pathname.includes("/oauth/callback")||window.location.search.includes("code=")||window.location.search.includes("error="),zR=[{id:"cinema",label:"Cinema Prompt Engineering",icon:""},{id:"storyboard",label:"Storyboard",icon:""}];function BR(){const[e,t]=Pt.useState("cinema");return Ut.jsxs("div",{className:"directors-console",children:[Ut.jsxs("nav",{className:"directors-console__nav",children:[Ut.jsxs("div",{className:"directors-console__logo",children:[Ut.jsx("span",{className:"logo-icon",children:""}),Ut.jsx("span",{className:"logo-text",children:"Director's Console"})]}),Ut.jsx("div",{className:"directors-console__tabs",children:zR.map(n=>Ut.jsxs("button",{className:"tab-button "+(e===n.id?"active":""),onClick:()=>t(n.id),children:[Ut.jsx("span",{className:"tab-icon",children:n.icon}),Ut.jsx("span",{className:"tab-label",children:n.label})]},n.id))})]}),Ut.jsxs("main",{className:"directors-console__content",children:[Ut.jsx("div",{style:{display:"cinema"===e?"contents":"none"},children:Ut.jsx(UR,{children:Ut.jsx(Wg,{})})}),Ut.jsx("div",{style:{display:"storyboard"===e?"contents":"none"},children:Ut.jsx(UR,{children:Ut.jsx(jR,{})})})]})]})}function HR(){return FR?Ut.jsx(DR,{}):Ut.jsx(UR,{children:Ut.jsx(BR,{})})}const VR=new $p;Ot.createRoot(document.getElementById("root")).render(Ut.jsx(kt.StrictMode,{children:Ut.jsx(qp,{client:VR,children:Ut.jsx(HR,{})})}));
