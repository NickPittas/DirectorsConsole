{
  "meta": {
    "name": "Head Swap V4",
    "description": "",
    "author": "",
    "version": "1.0.0",
    "engine": "qwen",
    "categories": [
      "editing",
      "img2img"
    ],
    "supports_angles": false,
    "supports_next_scene": false,
    "requires_images": true
  },
  "parameters": [
    {
      "name": "positive_prompt",
      "type": "prompt",
      "node_id": "111",
      "input_name": "prompt",
      "display_name": "Positive Prompt",
      "description": "Positive prompt (what to generate)",
      "default": ""
    },
    {
      "name": "steps",
      "type": "integer",
      "node_id": "3",
      "input_name": "steps",
      "display_name": "Sampling Steps",
      "description": "Number of denoising steps",
      "default": 4,
      "constraints": {
        "min": 1,
        "max": 150,
        "step": 1
      }
    },
    {
      "name": "cfg_scale",
      "type": "float",
      "node_id": "3",
      "input_name": "cfg",
      "display_name": "CFG Scale",
      "description": "Classifier-free guidance scale",
      "default": 1.0,
      "constraints": {
        "min": 1.0,
        "max": 20.0,
        "step": 0.5
      }
    },
    {
      "name": "seed",
      "type": "seed",
      "node_id": "3",
      "input_name": "seed",
      "display_name": "Seed",
      "description": "Random seed (-1 for random)",
      "default": 1099414053461644
    },
    {
      "name": "denoise",
      "type": "float",
      "node_id": "3",
      "input_name": "denoise",
      "display_name": "Denoise Strength",
      "description": "Denoising strength (img2img)",
      "default": 1.0,
      "constraints": {
        "min": 0.1,
        "max": 1.0,
        "step": 0.05
      }
    }
  ],
  "loras": [
    {
      "name": "lora_1",
      "display_name": "Qwen\\Edit\\Qwen-Image-Edit-2511-Lightning-4steps-V1.0-bf16",
      "node_id": "89",
      "strength_inputs": {
        "model": "strength_model",
        "clip": "strength_clip",
        "lora_name": ""
      },
      "compatible_patterns": [],
      "default_enabled": true,
      "default_strength": 1,
      "required": true
    },
    {
      "name": "lora_2",
      "display_name": "Qwen\\bfs_head_swap_v4",
      "node_id": "455",
      "strength_inputs": {
        "model": "strength_model",
        "clip": "strength_clip",
        "lora_name": ""
      },
      "compatible_patterns": [],
      "default_enabled": true,
      "default_strength": 1,
      "required": true
    }
  ],
  "inputs": [
    {
      "name": "reference_image_1",
      "display_name": "Reference Image 1",
      "node_id": "78",
      "input_name": "image",
      "type": "image",
      "required": false,
      "description": "Reference image for node 78"
    },
    {
      "name": "reference_image_2",
      "display_name": "Reference Image 2",
      "node_id": "435",
      "input_name": "image",
      "type": "image",
      "required": false,
      "description": "Reference image for node 435"
    }
  ],
  "workflow": {
    "3": {
      "inputs": {
        "seed": 1099414053461644,
        "steps": 4,
        "cfg": 1,
        "sampler_name": "ddim",
        "scheduler": "bong_tangent",
        "denoise": 1,
        "model": [
          "75",
          0
        ],
        "positive": [
          "459",
          0
        ],
        "negative": [
          "460",
          0
        ],
        "latent_image": [
          "88",
          0
        ]
      },
      "class_type": "KSampler",
      "_meta": {
        "title": "KSampler"
      }
    },
    "8": {
      "inputs": {
        "samples": [
          "3",
          0
        ],
        "vae": [
          "39",
          0
        ]
      },
      "class_type": "VAEDecode",
      "_meta": {
        "title": "VAE Decode"
      }
    },
    "38": {
      "inputs": {
        "clip_name": "qwen_2.5_vl_7b_fp8_scaled.safetensors",
        "type": "qwen_image",
        "device": "default"
      },
      "class_type": "CLIPLoader",
      "_meta": {
        "title": "Load CLIP"
      }
    },
    "39": {
      "inputs": {
        "vae_name": "qwen_image_vae.safetensors"
      },
      "class_type": "VAELoader",
      "_meta": {
        "title": "Load VAE"
      }
    },
    "60": {
      "inputs": {
        "filename_prefix": "ComfyUI",
        "images": [
          "464",
          0
        ]
      },
      "class_type": "SaveImage",
      "_meta": {
        "title": "Save Image"
      }
    },
    "66": {
      "inputs": {
        "shift": 1,
        "model": [
          "89",
          0
        ]
      },
      "class_type": "ModelSamplingAuraFlow",
      "_meta": {
        "title": "ModelSamplingAuraFlow"
      }
    },
    "75": {
      "inputs": {
        "strength": 1,
        "model": [
          "66",
          0
        ]
      },
      "class_type": "CFGNorm",
      "_meta": {
        "title": "CFGNorm"
      }
    },
    "78": {
      "inputs": {
        "image": "clipspace/clipspace-painted-masked-1767929289009.png [input]"
      },
      "class_type": "LoadImage",
      "_meta": {
        "title": "Reference Body"
      }
    },
    "88": {
      "inputs": {
        "pixels": [
          "463",
          1
        ],
        "vae": [
          "39",
          0
        ]
      },
      "class_type": "VAEEncode",
      "_meta": {
        "title": "VAE Encode"
      }
    },
    "89": {
      "inputs": {
        "lora_name": "Qwen\\Edit\\Qwen-Image-Edit-2511-Lightning-4steps-V1.0-bf16.safetensors",
        "strength_model": 1,
        "model": [
          "455",
          0
        ]
      },
      "class_type": "LoraLoaderModelOnly",
      "_meta": {
        "title": "LoraLoaderModelOnly"
      }
    },
    "111": {
      "inputs": {
        "prompt": "h34d_sw4p: replace the head of Picture 1 by the head from Picture 2, ensuring the new head mimics the identical expression, angle, and rotation found in Picture 1.",
        "clip": [
          "38",
          0
        ],
        "vae": [
          "39",
          0
        ],
        "image1": [
          "463",
          1
        ],
        "image2": [
          "437",
          0
        ]
      },
      "class_type": "TextEncodeQwenImageEditPlus",
      "_meta": {
        "title": "TextEncodeQwenImageEditPlus"
      }
    },
    "435": {
      "inputs": {
        "image": "KARAGIANNIS_00010_.png"
      },
      "class_type": "LoadImage",
      "_meta": {
        "title": "Reference Face"
      }
    },
    "436": {
      "inputs": {
        "width": 1024,
        "height": 1024,
        "upscale_method": "lanczos",
        "keep_proportion": "resize",
        "pad_color": "0, 0, 0",
        "crop_position": "center",
        "divisible_by": 2,
        "device": "cpu",
        "image": [
          "78",
          0
        ],
        "mask": [
          "78",
          1
        ]
      },
      "class_type": "ImageResizeKJv2",
      "_meta": {
        "title": "Resize Image v2"
      }
    },
    "437": {
      "inputs": {
        "width": 1024,
        "height": 1024,
        "upscale_method": "lanczos",
        "keep_proportion": "resize",
        "pad_color": "0, 0, 0",
        "crop_position": "center",
        "divisible_by": 2,
        "device": "cpu",
        "image": [
          "435",
          0
        ]
      },
      "class_type": "ImageResizeKJv2",
      "_meta": {
        "title": "Resize Image v2"
      }
    },
    "438": {
      "inputs": {
        "conditioning": [
          "111",
          0
        ]
      },
      "class_type": "ConditioningZeroOut",
      "_meta": {
        "title": "ConditioningZeroOut"
      }
    },
    "455": {
      "inputs": {
        "lora_name": "Qwen\\bfs_head_swap_v4.safetensors",
        "strength_model": 1,
        "model": [
          "466",
          0
        ]
      },
      "class_type": "LoraLoaderModelOnly",
      "_meta": {
        "title": "LoraLoaderModelOnly"
      }
    },
    "459": {
      "inputs": {
        "reference_latents_method": "index_timestep_zero",
        "conditioning": [
          "111",
          0
        ]
      },
      "class_type": "FluxKontextMultiReferenceLatentMethod",
      "_meta": {
        "title": "FluxKontextMultiReferenceLatentMethod"
      }
    },
    "460": {
      "inputs": {
        "reference_latents_method": "index_timestep_zero",
        "conditioning": [
          "438",
          0
        ]
      },
      "class_type": "FluxKontextMultiReferenceLatentMethod",
      "_meta": {
        "title": "FluxKontextMultiReferenceLatentMethod"
      }
    },
    "463": {
      "inputs": {
        "downscale_algorithm": "lanczos",
        "upscale_algorithm": "lanczos",
        "preresize": false,
        "preresize_mode": "ensure minimum resolution",
        "preresize_min_width": 1024,
        "preresize_min_height": 1024,
        "preresize_max_width": 16384,
        "preresize_max_height": 16384,
        "mask_fill_holes": true,
        "mask_expand_pixels": 0,
        "mask_invert": false,
        "mask_blend_pixels": 32,
        "mask_hipass_filter": 0.1,
        "extend_for_outpainting": false,
        "extend_up_factor": 1,
        "extend_down_factor": 1,
        "extend_left_factor": 1,
        "extend_right_factor": 1,
        "context_from_mask_extend_factor": 1.2,
        "output_resize_to_target_size": false,
        "output_target_width": 1024,
        "output_target_height": 1024,
        "output_padding": "32",
        "image": [
          "436",
          0
        ],
        "mask": [
          "436",
          3
        ]
      },
      "class_type": "InpaintCropImproved",
      "_meta": {
        "title": "\u2702\ufe0f Inpaint Crop (Improved)"
      }
    },
    "464": {
      "inputs": {
        "stitcher": [
          "463",
          0
        ],
        "inpainted_image": [
          "8",
          0
        ]
      },
      "class_type": "InpaintStitchImproved",
      "_meta": {
        "title": "\u2702\ufe0f Inpaint Stitch (Improved)"
      }
    },
    "465": {
      "inputs": {
        "backend": "inductor",
        "fullgraph": false,
        "mode": "default",
        "dynamic": "auto",
        "compile_transformer_blocks_only": true,
        "dynamo_cache_size_limit": 64,
        "debug_compile_keys": false,
        "model": [
          "467",
          0
        ]
      },
      "class_type": "TorchCompileModelAdvanced",
      "_meta": {
        "title": "TorchCompileModelAdvanced"
      }
    },
    "466": {
      "inputs": {
        "sage_attention": "sageattn_qk_int8_pv_fp8_cuda++",
        "allow_compile": true,
        "model": [
          "465",
          0
        ]
      },
      "class_type": "PathchSageAttentionKJ",
      "_meta": {
        "title": "Patch Sage Attention KJ"
      }
    },
    "467": {
      "inputs": {
        "unet_name": "Qwen\\qwen-image-edit-2511-Q8_0.gguf"
      },
      "class_type": "UnetLoaderGGUF",
      "_meta": {
        "title": "Unet Loader (GGUF)"
      }
    }
  }
}