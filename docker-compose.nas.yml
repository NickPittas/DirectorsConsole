# Director's Console - Docker Compose with NAS/SMB Mounts
# 
# This version mounts SMB shares directly from the container (bypasses Windows drive mapping)
# Works with Docker Desktop WSL2 backend
#
# SETUP:
# 1. Copy to docker-compose.override.yml or use: docker-compose -f docker-compose.nas.yml up -d
# 2. Edit the NAS_* environment variables in the volumes section below
# 3. Create a .env file with your NAS credentials:
#    NAS_USER=your_username
#    NAS_PASS=your_password

services:
  cpe:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: directors-console-cpe
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
      - CPE_API_PORT=8000
    volumes:
      - cpe-data:/app/data
      - cpe-templates:/app/templates
      # NAS mounts via CIFS
      - nas1:/projects/nas1
      - nas2:/projects/nas2
      - nas3:/projects/nas3
      - nas4:/projects/nas4
    networks:
      - directors-console
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  orchestrator:
    build:
      context: .
      dockerfile: Dockerfile.orchestrator
    container_name: directors-console-orchestrator
    ports:
      - "8020:8020"
    environment:
      - PYTHONUNBUFFERED=1
      - ORCHESTRATOR_PORT=8020
    volumes:
      - orchestrator-data:/app/data
      - orchestrator-inbox:/app/inbox
      - orchestrator-outbox:/app/outbox
      # NAS mounts via CIFS (same as CPE)
      - nas1:/projects/nas1
      - nas2:/projects/nas2
      - nas3:/projects/nas3
      - nas4:/projects/nas4
    networks:
      - directors-console
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8020/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  directors-console:
    driver: bridge

volumes:
  cpe-data:
  cpe-templates:
  orchestrator-data:
  orchestrator-inbox:
  orchestrator-outbox:
  
  # ============================================================================
  # NAS VOLUMES - Edit these to match your network shares
  # ============================================================================
  # Format: //IP_ADDRESS/SHARE_NAME
  # Set NAS_USER and NAS_PASS in your .env file
  
  nas1:
    driver: local
    driver_opts:
      type: cifs
      device: //192.168.195.50/Yavin_Prime
      o: username=${NAS_USER},password=${NAS_PASS},vers=3.0,uid=0,gid=0
  
  nas2:
    driver: local
    driver_opts:
      type: cifs
      device: //192.168.195.50/Mandalore
      o: username=${NAS_USER},password=${NAS_PASS},vers=3.0,uid=0,gid=0
  
  nas3:
    driver: local
    driver_opts:
      type: cifs
      device: //192.168.195.60/Kessel
      o: username=${NAS_USER},password=${NAS_PASS},vers=3.0,uid=0,gid=0
  
  nas4:
    driver: local
    driver_opts:
      type: cifs
      device: //192.168.195.30/Projects
      o: username=${NAS_USER},password=${NAS_PASS},vers=3.0,uid=0,gid=0
